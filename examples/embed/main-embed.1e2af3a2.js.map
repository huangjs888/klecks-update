{"mappings":"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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-16182675b608aed8.js","node_modules/@parcel/runtime-js/lib/runtime-5ead3de76c1474dc.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-d1740b30150a4f0c.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-7804f826c52703e7.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-b662234ad753bdc3.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-31236e0fa2d81196.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-707e2b642bb44f9c.js","node_modules/@parcel/runtime-js/lib/runtime-6a1b58b1b46e27b9.js","node_modules/@parcel/runtime-js/lib/runtime-e0c64a9c0e7d67b2.js","node_modules/@parcel/runtime-js/lib/runtime-6e8362a8c592487d.js","node_modules/@parcel/runtime-js/lib/runtime-dce03d0585fe4596.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-1a24b259c77eae1a.js","node_modules/@parcel/runtime-js/lib/runtime-675a0f887f8c23de.js","node_modules/@parcel/runtime-js/lib/runtime-f1f5555683161429.js","node_modules/@parcel/runtime-js/lib/runtime-38f95a056f1182e9.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-bb5572796f066d49.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b09b862c21f90c10.js","node_modules/@parcel/runtime-js/lib/runtime-181303ffff669151.js","node_modules/@parcel/runtime-js/lib/runtime-009a672af02b8666.js","node_modules/@parcel/runtime-js/lib/runtime-10873d850a6d61d4.js","node_modules/@parcel/runtime-js/lib/runtime-349c390e7876fa2e.js","node_modules/@parcel/runtime-js/lib/runtime-76c875460c636e84.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-047df3bf7af37efc.js","node_modules/@parcel/runtime-js/lib/runtime-e0de48af5d3e9833.js","node_modules/@parcel/runtime-js/lib/runtime-4cf6bf9cc36913d0.js","node_modules/@parcel/runtime-js/lib/runtime-955195f39df4e4f9.js","node_modules/@parcel/runtime-js/lib/runtime-4f3eb36930b63cc6.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-4380d61b0af04700.js","node_modules/@parcel/runtime-js/lib/runtime-bd3009b658cd2ec7.js","node_modules/@parcel/runtime-js/lib/runtime-548d316a4648bff0.js","node_modules/@parcel/runtime-js/lib/runtime-b1e86dba974ce52c.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-09184558bdc657f6.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-733b04aa13f91c2c.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-1e11204013037f69.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-e4c8b829f3a1ea0a.js","node_modules/@parcel/runtime-js/lib/runtime-64c2d2e1bba90cfa.js","node_modules/@parcel/runtime-js/lib/runtime-36abd4314d242423.js","node_modules/@parcel/runtime-js/lib/runtime-de9c6d2dd30b7302.js","node_modules/@parcel/runtime-js/lib/runtime-2ee59197f679c1aa.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-f7bb022a955758e2.js","node_modules/@parcel/runtime-js/lib/runtime-96f94cf6799bd58b.js","node_modules/@parcel/runtime-js/lib/runtime-37694c99b297d781.js","node_modules/@parcel/runtime-js/lib/runtime-8e63318772c270d6.js","node_modules/@parcel/runtime-js/lib/runtime-3debf0851c1de166.js","node_modules/@parcel/runtime-js/lib/runtime-1e5ccfc9d317a4ac.js","node_modules/@parcel/runtime-js/lib/runtime-2b2bfde8fc6b3a2e.js","node_modules/@parcel/runtime-js/lib/runtime-91fa274fa3bb65cb.js","node_modules/@parcel/runtime-js/lib/runtime-8f602c3a9ac2052f.js","node_modules/@parcel/runtime-js/lib/runtime-69b705b117980b94.js","node_modules/@parcel/runtime-js/lib/runtime-59dd138054e8d31c.js","node_modules/@parcel/runtime-js/lib/runtime-67c50647b08308c7.js","node_modules/@parcel/runtime-js/lib/runtime-8f5a590e8c764392.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-5d3fa44bc8ead2b0.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-da6c563cd1c03805.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-ea0e192b8f082cae.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-bbe4e09277554262.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-acbaf7c85b905a30.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-57156d58bc4ec8b5.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-d2777968d0b19951.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-493c5c2b2925afc3.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-ebbec2c3d4cad04c.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-dc87be8b8fd0a83b.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-5a962f9b22e7e2e6.js","node_modules/@parcel/runtime-js/lib/runtime-86ae22abe373cec6.js","node_modules/@parcel/runtime-js/lib/runtime-15e7c4d4910efeba.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/gl-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script/klecks/filters/crop-extend.ts","src/app/script/klecks/filters/gl-curves.ts","src/app/script/klecks/filters/flip.ts","node_modules/@parcel/runtime-js/lib/runtime-836ed4dc47a4ff11.js","src/app/script/klecks/filters/gl-hue-saturation.ts","src/app/script/klecks/filters/invert.ts","src/app/script/klecks/filters/gl-perspective.ts","src/app/script/klecks/filters/resize.ts","node_modules/@parcel/runtime-js/lib/runtime-4eedc2bc1ab80afd.js","src/app/script/klecks/filters/rotate.ts","src/app/script/klecks/filters/gl-tilt-shift.ts","src/app/script/klecks/filters/transform.ts","src/app/script/klecks/filters/gl-blur.ts","src/app/script/klecks/filters/gl-unsharp-mask.ts","src/app/script/klecks/filters/to-alpha.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-f1d94d330952b28b.js","node_modules/@parcel/runtime-js/lib/runtime-399b879a4e797bda.js","node_modules/@parcel/runtime-js/lib/runtime-d15e8bf6982fc2e4.js","node_modules/@parcel/runtime-js/lib/runtime-b21c6934e1ce53e4.js"],"sourcesContent":["import './polyfills';\r\nimport { KlApp } from './app/kl-app';\r\nimport { KL } from './klecks/kl';\r\nimport { IKlProject } from './klecks/kl.types';\r\nimport { ProjectStore } from './klecks/storage/project-store';\r\nimport { SaveReminder } from './klecks/ui/components/save-reminder';\r\nimport { klHistory } from './klecks/history/kl-history';\r\nimport { klPsdToKlProject, readPsd } from './klecks/storage/psd';\r\nimport { LANG } from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n\tproject?: IKlProject;\r\n\tpsdBlob?: Blob;\r\n\tshowReminder?: boolean;\r\n\tchangeTitle?: boolean;\r\n\tcontainer?: HTMLElement;\r\n\tbottomBar?: HTMLElement;\r\n\taboutEl?: HTMLElement;\r\n\tisShare?: boolean;\r\n\thideFile?: boolean;\r\n\thelpPath?: string;\r\n\tlogoImg?: any; // app logo\r\n\tonLogo?: () => void;\r\n\tcustomSave: (blob: Blob, filename: string, onSuccess: () => void, onError: () => void) => void;\r\n\tembed?: {\r\n\t\turl: string;\r\n\t\tonSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n\t};\r\n}\r\n\r\nexport interface IReadPSD {\r\n\tblob: Blob;\r\n\tcallback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed(p: IEmbedParams) {\r\n\r\n\tlet isInitialized: boolean = false;\r\n\tlet klApp;\r\n\tconst psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n\tlet agPsd: any | 'error';\r\n\r\n\tlet loadingScreenEl = document.getElementById(\"loading-screen\");\r\n\tlet loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\r\n\tif (loadingScreenTextEl) {\r\n\t\tloadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n\t}\r\n\r\n\tfunction onProjectReady(project: IKlProject | null, projectStore: ProjectStore | null) {\r\n\t\ttry {\r\n\t\t\tif (isInitialized) {\r\n\t\t\t\tthrow new Error('Already called openProject');\r\n\t\t\t}\r\n\t\t\tisInitialized = true;\r\n\r\n\t\t\tconst saveReminder = new SaveReminder(\r\n\t\t\t\tklHistory,\r\n\t\t\t\tp.embed ? false : (p.changeTitle || false),\r\n\t\t\t\tp.embed ? false : (p.showReminder || false),\r\n\t\t\t\t() => klApp ? klApp.saveAsPsd() : null,\r\n\t\t\t\t() => klApp ? klApp.isDrawing() : false,\r\n\t\t\t\tp.embed ? null : projectStore,\r\n\t\t\t\tp.embed ? null : () => project,\r\n\t\t\t\t() => klApp ? klApp.getEl() : (p.container || document.body),\r\n\t\t\t\t() => klApp ? klApp.getBBox() : {},\r\n\t\t\t);\r\n\t\t\tklApp = new KlApp(\r\n\t\t\t\tproject,\r\n\t\t\t\t{\r\n\t\t\t\t\tsaveReminder,\r\n\t\t\t\t\tprojectStore: p.embed ? null : projectStore,\r\n\t\t\t\t\tembed: p.embed ? p.embed : undefined,\r\n\t\t\t\t\tlogoImg: p.logoImg,\r\n\t\t\t\t\tonLogo: p.onLogo,\r\n\t\t\t\t\tcustomSave: p.customSave,\r\n\t\t\t\t\thideFile: p.hideFile,\r\n\t\t\t\t\tisShare: p.isShare,\r\n\t\t\t\t\thelpPath: p.helpPath,\r\n\t\t\t\t\tbottomBar: p.bottomBar,\r\n\t\t\t\t\taboutEl: p.aboutEl,\r\n\t\t\t\t},\r\n\t\t\t\tp.container || document.body\r\n\t\t\t);\r\n\t\t\tsaveReminder.init();\r\n\r\n\t\t\tif (loadingScreenEl && loadingScreenEl.parentNode) {\r\n\t\t\t\tloadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n\t\t\t}\r\n\t\t\tloadingScreenEl = null;\r\n\t\t\tloadingScreenTextEl = null;\r\n\r\n\t\t\t(p.container || document.body).appendChild(klApp.getEl());\r\n\t\t} catch (e) {\r\n\t\t\tif (loadingScreenTextEl) {\r\n\t\t\t\tloadingScreenTextEl.textContent = '❌ ' + e;\r\n\t\t\t}\r\n\t\t\tif (loadingScreenEl) {\r\n\t\t\t\tloadingScreenEl.className += 'loading-screen-error';\r\n\t\t\t}\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t}\r\n\tlet projectStore = !p.embed ? new KL.ProjectStore() : null;\r\n\tif (p.project) {\r\n\t\tonProjectReady(p.project, projectStore);\r\n\t}\r\n\tthis.openProject = (project) => {\r\n\t\tif (!project.layers && projectStore) {// Read Browser Storage\r\n\t\t\ttry {\r\n\t\t\t\tprojectStore.read().then((readResult) => {\r\n\t\t\t\t\tlet p: IKlProject | null = null;\r\n\t\t\t\t\tif (readResult && readResult.project) {\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tklApp.out(LANG('file-storage-restored'));\r\n\t\t\t\t\t\t}, 100);\r\n\t\t\t\t\t\tp = readResult.project;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonProjectReady(p, projectStore);\r\n\t\t\t\t}).catch((e) => {\r\n\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\tklApp && klApp.out(e);\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t\tonProjectReady(null, projectStore);\r\n\t\t\t\t})\r\n\t\t\t} catch (e) {\r\n\t\t\t\tlet message;\r\n\t\t\t\tif (e.message.indexOf('db-error') === 0) {\r\n\t\t\t\t\tmessage = 'Failed to access Browser Storage';\r\n\t\t\t\t} else if (e.message.indexOf('format-error') === 0) {\r\n\t\t\t\t\tmessage = 'Failed to restore from Browser Storage';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmessage = 'Failed to restore from Browser Storage';\r\n\t\t\t\t}\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tklApp && klApp.out(message);\r\n\t\t\t\t}, 100);\r\n\t\t\t\tonProjectReady(null, projectStore);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tonProjectReady(project, projectStore);\r\n\t\t}\r\n\t};\r\n\tthis.initError = (error: string) => {\r\n\t\tif (loadingScreenTextEl) {\r\n\t\t\tloadingScreenTextEl.textContent = '❌ ' + error;\r\n\t\t}\r\n\t\tif (loadingScreenEl) {\r\n\t\t\tloadingScreenEl.className += 'loading-screen-error';\r\n\t\t}\r\n\t};\r\n\tthis.getPNG = (): Blob => {\r\n\t\tif (!klApp) {\r\n\t\t\tthrow new Error('App not initialized');\r\n\t\t}\r\n\t\treturn klApp.getPNG();\r\n\t};\r\n\tthis.getPSD = async (): Promise<Blob> => {\r\n\t\tif (!klApp) {\r\n\t\t\tthrow new Error('App not initialized');\r\n\t\t}\r\n\t\treturn await klApp.getPSD();\r\n\t};\r\n\tthis.readPSDs = (psds: IReadPSD[]) => {\r\n\t\tif (psds.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst readItem = (item: IReadPSD) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst psd = agPsd.readPsd(item.blob);\r\n\t\t\t\tconst project = klPsdToKlProject(readPsd(psd));\r\n\t\t\t\titem.callback(project);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('failed to read psd', e);\r\n\t\t\t\titem.callback(null);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (!agPsd) {\r\n\t\t\tif (psdQueue.length === 0) {\r\n\t\t\t\t// load ag-psd\r\n\t\t\t\t(async () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tagPsd = await import('ag-psd');\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tagPsd = 'error';\r\n\t\t\t\t\t}\r\n\t\t\t\t\twhile (psdQueue.length) {\r\n\t\t\t\t\t\treadItem(psdQueue.shift());\r\n\t\t\t\t\t}\r\n\t\t\t\t})();\r\n\t\t\t}\r\n\t\t\tpsds.forEach(item => {\r\n\t\t\t\tpsdQueue.push(item);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tpsds.forEach(readItem);\r\n\t\t}\r\n\t};\r\n\tthis.importImage = (a) => {\r\n\t\tif (!klApp) {\r\n\t\t\tthrow new Error('App not initialized');\r\n\t\t}\r\n\t\tklApp.importImage(a);\r\n\t}\r\n}","// import 'core-js';\nimport 'mdn-polyfills/Node.prototype.append';\nimport 'mdn-polyfills/Node.prototype.prepend';\nimport 'mdn-polyfills/String.prototype.padStart';\n\nif (!('scrollTo' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollTo', {\n        value: function (x, y) {\n            this.scrollLeft = x;\n            this.scrollTop = y;\n        }\n    });\n}\n\nif (!('scrollBy' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollBy', {\n        value: function (x, y) {\n            this.scrollLeft += x;\n            this.scrollTop += y;\n        }\n    });\n}\n\n// sometimes Android WebView has no localStorage\nif (!('localStorage' in window)) {\n    try {\n        window['localStorage'] = {\n            getItem: () => null,\n            setItem: () => {},\n            removeItem: () => {},\n        } as any;\n    } catch (e) {\n        // maybe it doesn't let me set this\n    }\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","import { KL } from '../klecks/kl';\r\nimport { klHistory } from '../klecks/history/kl-history';\r\nimport { BB } from '../bb/bb';\r\nimport { showIframePopup } from '../klecks/ui/modals/show-iframe-popup';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\nimport { exportType } from '../klecks/ui/tool-tabs/file-tab';\r\nimport { ToolspaceTopRow } from \"../embed/toolspace-top-row\";\r\nimport { IInitState, IKlProject, IKlPsd } from '../klecks/kl.types';\r\nimport { importFilters } from '../klecks/filters/filters-lazy';\r\nimport { base64ToBlob } from '../klecks/storage/base-64-to-blob';\r\nimport { klCanvasToPsdBlob } from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport { ProjectStore } from '../klecks/storage/project-store';\r\nimport { SaveReminder } from \"../klecks/ui/components/save-reminder\";\r\nimport { KlCanvasWorkspace } from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport { KlCanvas } from '../klecks/canvas/kl-canvas';\r\nimport { LANG } from '../language/language';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport tabEditImg from 'url:~/src/app/img/ui/tab-edit.svg';\r\n// @ts-ignore\r\nimport tabFileImg from 'url:~/src/app/img/ui/tab-file.svg';\r\n// @ts-ignore\r\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\r\n// @ts-ignore\r\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\r\nimport { LocalStorage } from '../bb/base/local-storage';\r\n\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore | null;\r\n    logoImg?: any; // app logo\r\n    onLogo?: () => void;\r\n    customSave?: (blob: Blob, filename: string, onSuccess: () => void, onError: () => void) => void;\r\n    hideFile?: boolean;\r\n    isShare?: boolean;\r\n    helpPath?: string;\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: {\r\n        url: string;\r\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    };\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions, container?: HTMLElement) {\r\n    function resetCanvas(param) {\r\n        klCanvas.reset(param);\r\n        layerManager.update(0);\r\n        setCurrentLayer(klCanvas.getLayer(0));\r\n        klCanvasWorkspace.resetView();\r\n        handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        isFirstImage = false;\r\n    }\r\n    const getBBox = () => {\r\n        const width = container ? (container.clientWidth || container.offsetWidth) : window.innerWidth;\r\n        const height = container ? (container.clientHeight || container.offsetHeight) : window.innerHeight;\r\n        return {\r\n            width,\r\n            height\r\n        };\r\n    };\r\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n    // but not larger than 4096 - a fairly arbitrary decision\r\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n    let collapseThreshold = 820;\r\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\r\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n    const projectStore = pOptions.projectStore;\r\n    let klRootEl = document.createElement(\"div\");\r\n    klRootEl.className = 'g-root';\r\n    const bbox = getBBox();\r\n    let uiWidth: number = Math.max(0, bbox.width);\r\n    let uiHeight: number = Math.max(0, bbox.height);\r\n    const toolWidth = 270;\r\n    let exportType: exportType = 'png';\r\n    let klCanvas: KlCanvas = new KL.KlCanvas(\r\n        pProject ? {\r\n            projectObj: pProject\r\n        } : {\r\n            width: Math.max(10, Math.min(klMaxCanvasSize, bbox.width < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\r\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\r\n        }, pOptions.embed ? -1 : 0);\r\n    klCanvas.setHistory(klHistory);\r\n    let initState: IInitState | null = null;\r\n    let mainTabRow;\r\n\r\n    if (!pOptions.saveReminder) {\r\n        pOptions.saveReminder = { init: () => { }, reset: () => { } } as SaveReminder;\r\n    }\r\n\r\n    function translateSmoothing(s: number): number {\r\n        if (s == 1) {\r\n            return 1 - 0.5;\r\n        }\r\n        if (s == 2) {\r\n            return 1 - 0.16;\r\n        }\r\n        if (s == 3) {\r\n            return 1 - 0.035;\r\n        }\r\n        if (s == 4) {\r\n            return 1 - 0.0175;\r\n        }\r\n        if (s == 5) {\r\n            return 1 - 0.00875;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let isFirstImage = true;\r\n\r\n    if (pProject) {\r\n        pProject.layers.forEach(layer => {\r\n            layer.image = null;\r\n        });\r\n        pProject = null;\r\n    } else {\r\n        klHistory.pause(true);\r\n        klCanvas.addLayer();\r\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255 });\r\n        klHistory.pause(false);\r\n    }\r\n    try {\r\n        initState = {\r\n            canvas: new KL.KlCanvas({ copy: klCanvas }, pOptions.embed ? -1 : 0),\r\n            focus: klCanvas.getLayerCount() - 1,\r\n            brushes: {},\r\n        };\r\n    } catch (e) {\r\n        if (e.message === 'kl-create-canvas-error') {\r\n            klCanvas.destroy();\r\n        }\r\n        throw e;\r\n    }\r\n    for (let b in KL.brushes) {\r\n        if (KL.brushes.hasOwnProperty(b)) {\r\n            initState.brushes[b] = new KL.brushes[b]();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    let currentColor = new BB.RGB(0, 0, 0);\r\n    let currentBrush, currentBrushId;\r\n    let lastNonEraserBrushId = 0;\r\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\r\n\r\n    function sizeWatcher(val) {\r\n        brushSettingService.emitSize(val);\r\n        if (klCanvasWorkspace) {\r\n            klCanvasWorkspace.setCursorSize(val * 2);\r\n        }\r\n    }\r\n\r\n    const brushSettingService = new KL.BrushSettingService(\r\n        (color) => {\r\n            klColorSlider.setColor(color);\r\n            currentBrush.setColor(color);\r\n            currentColor = BB.copyObj(color);\r\n        },\r\n        (size) => {\r\n            currentBrush.setSize(size);\r\n            klCanvasWorkspace.setCursorSize(size * 2);\r\n        },\r\n        (opacity) => {\r\n            currentBrush.setOpacity(opacity);\r\n        },\r\n        () => klColorSlider.getColor(),\r\n        () => brushUiObj[currentBrushId].getSize(),\r\n        () => brushUiObj[currentBrushId].getOpacity(),\r\n        () => {\r\n            return {\r\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n            };\r\n        }\r\n    );\r\n\r\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\r\n        smoothing: translateSmoothing(1),\r\n    });\r\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\r\n\r\n    let drawEventChain = new BB.EventChain.EventChain({\r\n        chainArr: [\r\n            lineSanitizer,\r\n            lineSmoothing\r\n        ],\r\n    });\r\n\r\n    drawEventChain.setChainOut(function (event) {\r\n        if (event.type === 'down') {\r\n            toolspace.style.pointerEvents = 'none';\r\n            currentBrush.startLine(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'move') {\r\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\r\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'up') {\r\n            toolspace.style.pointerEvents = '';\r\n            currentBrush.endLine();\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'line') {\r\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let textToolSettings = {\r\n        size: 20,\r\n        align: 'left' as ('left' | 'center' | 'right'),\r\n        isBold: false,\r\n        isItalic: false,\r\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n        opacity: 1\r\n    };\r\n\r\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n        klCanvas: klCanvas,\r\n        width: Math.max(0, uiWidth - toolWidth),\r\n        height: uiHeight,\r\n        onDraw: drawEventChain.chainIn,\r\n        onPick: function (rgbObj, isDragDone) {\r\n            brushSettingService.setColor(rgbObj);\r\n            if (isDragDone) {\r\n                klColorSlider.pickingDone();\r\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            }\r\n        },\r\n        onFill: function (canvasX, canvasY) {\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            klCanvas.floodFill(layerIndex, canvasX, canvasY, klColorSlider.getColor(), fillUi.getOpacity(), fillUi.getTolerance(), fillUi.getSample(), fillUi.getGrow(), fillUi.getContiguous());\r\n            klCanvasWorkspace.requestFrame();\r\n        },\r\n        onText: function (canvasX, canvasY, angleRad) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n\r\n            KL.textToolDialog({\r\n                klRootEl: klRootEl,\r\n                bbox: getBBox(),\r\n                klCanvas: klCanvas,\r\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                x: canvasX,\r\n                y: canvasY,\r\n                angleRad: angleRad,\r\n                color: klColorSlider.getColor(),\r\n                secondaryColor: klColorSlider.getSecondaryRGB(),\r\n                size: textToolSettings.size,\r\n                align: textToolSettings.align,\r\n                isBold: textToolSettings.isBold,\r\n                isItalic: textToolSettings.isItalic,\r\n                font: textToolSettings.font,\r\n                opacity: textToolSettings.opacity,\r\n                onConfirm: function (val) {\r\n\r\n                    let colorRGBA = val.color;\r\n                    colorRGBA.a = val.opacity;\r\n\r\n                    textToolSettings.size = val.size;\r\n                    textToolSettings.align = val.align;\r\n                    textToolSettings.isBold = val.isBold;\r\n                    textToolSettings.isItalic = val.isItalic;\r\n                    textToolSettings.font = val.font;\r\n                    textToolSettings.opacity = val.opacity;\r\n\r\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    klCanvas.text(layerIndex, {\r\n                        textStr: val.textStr,\r\n                        x: val.x,\r\n                        y: val.y,\r\n                        size: val.size,\r\n                        font: val.font,\r\n                        align: val.align,\r\n                        isBold: val.isBold,\r\n                        isItalic: val.isItalic,\r\n                        angleRad: angleRad,\r\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\r\n                    });\r\n                    klCanvasWorkspace.requestFrame();\r\n                }\r\n            });\r\n\r\n        },\r\n        onShape: function (typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                shapeTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                shapeTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                shapeTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n\r\n        onViewChange: function (viewChangeObj) {\r\n\r\n            if (viewChangeObj.changed.includes('scale')) {\r\n                statusOverlay.out({\r\n                    type: 'transform',\r\n                    scale: viewChangeObj.scale,\r\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\r\n                });\r\n            }\r\n\r\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\r\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\r\n\r\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n        },\r\n        onUndo: function () {\r\n            if (klHistory.canUndo()) {\r\n                if (undoRedoCatchup.undo()) {\r\n                    statusOverlay.out(LANG('undo'), true);\r\n                }\r\n            }\r\n        },\r\n        onRedo: function () {\r\n            if (klHistory.canRedo()) {\r\n                if (undoRedoCatchup.redo()) {\r\n                    statusOverlay.out(LANG('redo'), true);\r\n                }\r\n            }\r\n        },\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, event, comboStr) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n\r\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n            if (isDrawing) {\r\n                return;\r\n            }\r\n\r\n            if (comboStr === 'plus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1 / 8 : 1 / 2);\r\n            }\r\n            if (comboStr === 'minus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1 / 8 : -1 / 2);\r\n            }\r\n            if (comboStr === 'home') {\r\n                klCanvasWorkspace.fitView();\r\n            }\r\n            if (comboStr === 'end') {\r\n                klCanvasWorkspace.resetView(true);\r\n            }\r\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.undo();\r\n            }\r\n            if (\r\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                (\r\n                    (\r\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                        BB.sameKeys('cmd+shift+z', comboStr)\r\n                    ) && keyStr === 'z'\r\n                )\r\n            ) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.redo();\r\n            }\r\n            if (!pOptions.embed) {\r\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    saveToComputer.save();\r\n                }\r\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n\r\n                    (async () => {\r\n                        if (projectStore) {\r\n                            let success = true;\r\n                            try {\r\n                                await projectStore.store(klCanvas.getProject());\r\n                            } catch (e) {\r\n                                success = false;\r\n                                setTimeout(() => {\r\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                                }, 0);\r\n                                statusOverlay.out('❌ ' + LANG('file-storage-failed'), true);\r\n                            }\r\n                            if (success) {\r\n                                pOptions.saveReminder.reset();\r\n                                statusOverlay.out(LANG('file-storage-stored'), true);\r\n                            }\r\n\r\n                        }\r\n                    })();\r\n                }\r\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    copyToClipboard(true);\r\n                }\r\n            }\r\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n\r\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.translateView(1, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.translateView(-1, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    klCanvasWorkspace.translateView(0, 1);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    klCanvasWorkspace.translateView(0, -1);\r\n                }\r\n            }\r\n\r\n\r\n            if (['r+left', 'r+right'].includes(comboStr)) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.setAngle(-15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.setAngle(15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n            }\r\n            if (['r+up'].includes(comboStr)) {\r\n                klCanvasWorkspace.setAngle(0);\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n            }\r\n\r\n\r\n            if (comboStr === 'sqbr_open') {\r\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'sqbr_close') {\r\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'enter') {\r\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\r\n                statusOverlay.out(LANG('filled'), true);\r\n            }\r\n            if (['delete', 'backspace'].includes(comboStr)) {\r\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\r\n                    klCanvas.layerFill(layerIndex, { r: 255, g: 255, b: 255 }, 'source-in');\r\n                } else {\r\n                    klCanvas.clearLayer(layerIndex);\r\n                }\r\n                statusOverlay.out(LANG('cleared-layer'), true);\r\n            }\r\n            if (comboStr === 'e') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open('eraserBrush');\r\n            }\r\n            if (comboStr === 'b') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open(lastNonEraserBrushId);\r\n            }\r\n            if (comboStr === 'g') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('fill');\r\n                toolspaceToolRow.setActive('fill');\r\n                mainTabRow.open('fill');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 't') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('text');\r\n                toolspaceToolRow.setActive('text');\r\n                mainTabRow.open('text');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'u') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('shape');\r\n                toolspaceToolRow.setActive('shape');\r\n                mainTabRow.open('shape');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'x') {\r\n                event.preventDefault();\r\n                klColorSlider.swapColors();\r\n            }\r\n\r\n\r\n        },\r\n        onUp: function (keyStr, event) {\r\n        }\r\n    });\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    function importFinishedLoading(\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ) {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"error\",\r\n                message: LANG('import-broken-file'),\r\n                buttons: [\"Ok\"],\r\n            });\r\n            return;\r\n        }\r\n\r\n        function getResizedDimensions(width, height) {\r\n            let w = parseInt(width);\r\n            let h = parseInt(height);\r\n            if (w > klMaxCanvasSize) {\r\n                h = klMaxCanvasSize / w * h;\r\n                w = klMaxCanvasSize;\r\n            }\r\n            if (h > klMaxCanvasSize) {\r\n                w = klMaxCanvasSize / h * w;\r\n                h = klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h\r\n            }\r\n        }\r\n\r\n        function importAsImage(canvas) {\r\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            let tempCanvasCtx = tempCanvas.getContext('2d');\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            resetCanvas({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename\r\n            });\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\r\n\r\n            // crop\r\n            function crop(targetCanvas, cropCanvas, cropObj) {\r\n                cropCanvas.width = cropCanvas.width;\r\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\r\n            }\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width || cropObj.height !== convertedPsdObj.height)) {\r\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        let item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    let item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers\r\n                });\r\n            } else {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas\r\n                });\r\n            }\r\n            layerManager.update(layerIndex);\r\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        function importAsLayer(canvas) {\r\n            KL.showImportAsLayerDialog({\r\n                target: klRootEl,\r\n                bbox: getBBox(),\r\n                klCanvas: klCanvas,\r\n                importImage: canvas,\r\n                callback: function (transformObj, isPixelated: boolean) {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    klCanvas.addLayer();\r\n                    let layers = klCanvas.getLayers();\r\n                    let activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\r\n                    layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: [\"misc\"],\r\n                        action: \"importImage\",\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: klRootEl,\r\n                bbox: getBBox(),\r\n                maxSize: klMaxCanvasSize,\r\n                callback: function (res) {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function onPaste(e) {\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\r\n            if (pasteEvent.clipboardData == false) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            }\r\n\r\n            let items = pasteEvent.clipboardData.items;\r\n\r\n            if (items == undefined) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i].type.indexOf(\"image\") == -1) {\r\n                        continue;\r\n                    }\r\n                    let blob = items[i].getAsFile();\r\n\r\n                    if (typeof (callback) == \"function\") {\r\n                        callback(blob);\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\r\n                // If there's an image, display it in the canvas\r\n                if (imageBlob) {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        URL.revokeObjectURL(img.src);\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    let URLObj = window.URL || window.webkitURL;\r\n                    img.src = URLObj.createObjectURL(imageBlob);\r\n                }\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString(function (pasteStr) {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    img.onerror = function (e) {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    brushSettingService.setColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function handleFileSelect(files, optionStr) {\r\n\r\n        function showWarningPsdFlattened() {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"warning\",\r\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\r\n                buttons: [\"Ok\"],\r\n            });\r\n        }\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            let extension = file.name.split(\".\");\r\n            extension = extension[extension.length - 1].toLowerCase();\r\n            if (extension === \"psd\") {\r\n\r\n                (function (f) {\r\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    let maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            type: \"error\",\r\n                            message: \"File too big. Unable to import.<br /><br />\",\r\n                            buttons: [\"Ok\"],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: function (result) {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closefunc: function (f) {\r\n                                closeLoader = f;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n\r\n                    let reader = new FileReader();\r\n                    reader.onload = function (readerResult) {\r\n\r\n                        KL.loadAgPsd().then(function (agPsdLazy) {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: klRootEl,\r\n                                        type: \"error\",\r\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + \"<br /><br />\"\r\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\r\n                                            + \"<br /><br />\"\r\n                                        ,\r\n                                        buttons: [\"Ok\"],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    let convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n\r\n                            } catch (e) {\r\n                                if (closeLoader) {\r\n                                    closeLoader();\r\n                                }\r\n                                KL.popup({\r\n                                    target: klRootEl,\r\n                                    type: \"error\",\r\n                                    message: \"Failed to load PSD.<br /><br />\",\r\n                                    buttons: [\"Ok\"],\r\n                                });\r\n                            }\r\n                        }).catch(() => {\r\n                            closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                (function (f) {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    let url = window.URL.createObjectURL(f);\r\n                    let im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n\r\n    if (!pOptions.embed) {\r\n        new KL.KlImageDropper({\r\n            target: klRootEl,\r\n            onDrop: function (files, optionStr) {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n                handleFileSelect(files, optionStr);\r\n            },\r\n            enabledTest: function () {\r\n                return KL.dialogCounter.get() === 0;\r\n            }\r\n        });\r\n\r\n        BB.addEventListener(window, 'paste', onPaste, false);\r\n    }\r\n\r\n    const brushUiObj: any = {};\r\n\r\n    // create brush UIs\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            let ui = new KL.brushesUI[b].Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: function (opacity) {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\r\n                    });\r\n                }\r\n            });\r\n            brushUiObj[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        }\r\n    }\r\n\r\n\r\n    BB.css(klRootEl, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        right: '0',\r\n        bottom: '0'\r\n    });\r\n\r\n    let statusOverlay = new KL.StatusOverlay(klRootEl);\r\n\r\n    const toolspace = BB.el({});\r\n    const toolspaceInner = BB.el({\r\n        parent: toolspace,\r\n    });\r\n    toolspace.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    toolspace.onclick = BB.handleClick;\r\n\r\n\r\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\r\n        onChange: function () {\r\n            updateCollapse();\r\n        }\r\n    });\r\n    function updateCollapse() {\r\n\r\n        //collapser\r\n        if (uiWidth < collapseThreshold) {\r\n            toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            toolspaceCollapser.setDirection(uiState);\r\n            if (toolspaceCollapser.isOpen()) {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '271px'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'block';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n                statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'none';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\r\n                statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            toolspaceCollapser.getElement().style.display = 'none';\r\n            if (uiState === 'left') {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '271px'\r\n                });\r\n            } else {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '0'\r\n                });\r\n            }\r\n            toolspace.style.display = 'block';\r\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n            statusOverlay.setWide(false);\r\n\r\n        }\r\n    }\r\n    updateCollapse();\r\n\r\n    function updateUi() {\r\n        if (uiState === 'left') {\r\n            BB.css(toolspace, {\r\n                left: '0',\r\n                right: '',\r\n                borderLeft: 'none',\r\n                borderRight: '1px solid rgb(135, 135, 135)'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '271px'\r\n            });\r\n        } else {\r\n            BB.css(toolspace, {\r\n                left: '',\r\n                right: '0',\r\n                borderLeft: '1px solid rgb(135, 135, 135)',\r\n                borderRight: 'none'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '0'\r\n            });\r\n        }\r\n        statusOverlay.setUiState(uiState);\r\n        layerPreview.setUiState('' + uiState);\r\n        layerManager.setUiState('' + uiState);\r\n        updateCollapse();\r\n        toolspaceScroller.updateUiState(uiState);\r\n    }\r\n\r\n\r\n\r\n    let overlayToolspace;\r\n    setTimeout(function () {\r\n        overlayToolspace = new KL.OverlayToolspace({\r\n            enabledTest: function () {\r\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\r\n            },\r\n            brushSettingService,\r\n        });\r\n        klRootEl.appendChild(overlayToolspace.getElement());\r\n    }, 0);\r\n\r\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\r\n\r\n    BB.css(toolspace, {\r\n        position: \"absolute\",\r\n        right: '0',\r\n        top: '0',\r\n        bottom: '0',\r\n        width: (toolWidth - 1) + \"px\",\r\n\r\n        overflow: \"hidden\",\r\n        backgroundColor: \"#ddd\",\r\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\r\n        userSelect: 'none',\r\n        touchAction: 'none'\r\n    });\r\n\r\n    let toolspaceTopRow;\r\n    if (pOptions.embed) {\r\n        toolspaceTopRow = new ToolspaceTopRow({\r\n            onHelp: () => {\r\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed, klRootEl, getBBox());\r\n            },\r\n            onSubmit: () => {\r\n                KL.popup({\r\n                    target: klRootEl,\r\n                    message: LANG('submit-prompt'),\r\n                    buttons: [LANG('submit'), 'Cancel'],\r\n                    callback: async (result) => {\r\n                        if (result !== LANG('submit')) {\r\n                            return;\r\n                        }\r\n\r\n                        let overlay = BB.el({\r\n                            parent: klRootEl,\r\n                            className: 'upload-overlay',\r\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                        });\r\n\r\n                        pOptions.embed.onSubmit(\r\n                            () => {\r\n                                pOptions.saveReminder.reset();\r\n                                klRootEl.removeChild(overlay);\r\n                            },\r\n                            () => {\r\n                                klRootEl.removeChild(overlay);\r\n                            });\r\n                    }\r\n                });\r\n            },\r\n            onLeftRight: () => {\r\n                uiState = uiState === 'left' ? 'right' : 'left';\r\n                updateUi();\r\n            },\r\n        });\r\n    } else {\r\n        toolspaceTopRow = new KL.ToolspaceTopRow({\r\n            logoImg: pOptions.logoImg,\r\n            onLogo: pOptions.onLogo,\r\n            onNew: function () {\r\n                showNewImageDialog();\r\n            },\r\n            onImport: function () {\r\n                fileTab && fileTab.triggerImport();\r\n            },\r\n            onSave: function () {\r\n                saveToComputer.save();\r\n            },\r\n            onShare: pOptions.isShare ? function () {\r\n                shareImage();\r\n            } : null,\r\n            onHelp: pOptions.helpPath ? function () {\r\n                showIframePopup(pOptions.helpPath + '/help.html', !!pOptions.embed, klRootEl, getBBox());\r\n            } : null,\r\n        });\r\n    }\r\n    BB.addClassName(toolspaceTopRow.getElement(), 'toolspace-row-shadow');\r\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\r\n\r\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\r\n        klRootEl: klRootEl,\r\n        onActivate: function (activeStr) {\r\n            if (activeStr === 'draw') {\r\n                klCanvasWorkspace.setMode('draw');\r\n            } else if (activeStr === 'hand') {\r\n                klCanvasWorkspace.setMode('hand');\r\n            } else if (activeStr === 'fill') {\r\n                klCanvasWorkspace.setMode('fill');\r\n            } else if (activeStr === 'text') {\r\n                klCanvasWorkspace.setMode('text');\r\n            } else if (activeStr === 'shape') {\r\n                klCanvasWorkspace.setMode('shape');\r\n            } else {\r\n                throw new Error('unknown activeStr');\r\n            }\r\n            mainTabRow.open(activeStr);\r\n            updateMainTabVisibility();\r\n            klColorSlider.pickingDone();\r\n        },\r\n        onZoomIn: function () {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1 / 8 : 1 / 2);\r\n        },\r\n        onZoomOut: function () {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1 / 8 : -1 / 2);\r\n        },\r\n        onUndo: function () {\r\n            undoRedoCatchup.undo();\r\n        },\r\n        onRedo: function () {\r\n            undoRedoCatchup.redo();\r\n        }\r\n    });\r\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    klHistory.addListener(function () {\r\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n    });\r\n    BB.addClassName(toolspaceToolRow.getElement(), 'toolspace-row-shadow');\r\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\r\n\r\n    let klColorSlider;\r\n\r\n    function setCurrentBrush(brushId) {\r\n        if (brushId !== 'eraserBrush') {\r\n            lastNonEraserBrushId = brushId;\r\n        }\r\n\r\n        if (klColorSlider) {\r\n            if (brushId === 'eraserBrush') {\r\n                klColorSlider.enable(false);\r\n            } else {\r\n                klColorSlider.enable(true);\r\n            }\r\n        }\r\n\r\n        currentBrushId = brushId;\r\n        currentBrush = brushUiObj[brushId];\r\n        currentBrush.setColor(currentColor);\r\n        currentBrush.setContext(currentLayerCtx);\r\n        klCanvasWorkspace.setMode('draw');\r\n        toolspaceToolRow.setActive('draw');\r\n        updateMainTabVisibility();\r\n    }\r\n\r\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\r\n        currentLayerCtx = layer.context;\r\n        currentBrush.setContext(layer.context);\r\n        layerPreview.setLayer(layer);\r\n    }\r\n\r\n    function setBrushColor(p_color) {\r\n        currentColor = p_color;\r\n        currentBrush.setColor(p_color);\r\n        brushSettingService.emitColor(p_color);\r\n        klColorSlider.pickingDone();\r\n    }\r\n\r\n    klColorSlider = new KL.KlColorSlider({\r\n        width: 250,\r\n        height: 30,\r\n        svHeight: 100,\r\n        startValue: new BB.RGB(0, 0, 0),\r\n        onPick: setBrushColor,\r\n        klRootEl: klRootEl\r\n    });\r\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n    klColorSlider.setPickCallback(function (doPick) {\r\n\r\n        if (doPick) {\r\n            klCanvasWorkspace.setMode('pick');\r\n        } else {\r\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            updateMainTabVisibility();\r\n        }\r\n\r\n    });\r\n    let brushDiv = document.createElement(\"div\");\r\n    let colorDiv = document.createElement(\"div\");\r\n    BB.css(colorDiv, {\r\n        margin: '10px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-end'\r\n    });\r\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n        smoothing: 1,\r\n        onSelect: function (v) {\r\n            lineSmoothing.setSmoothing(translateSmoothing(v));\r\n        }\r\n    });\r\n\r\n\r\n    brushDiv.appendChild(colorDiv);\r\n    BB.append(\r\n        colorDiv,\r\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n    );\r\n\r\n    let brushTabRow = new KL.TabRow({\r\n        initialId: 'penBrush',\r\n        useAccent: true,\r\n        tabArr: (function () {\r\n            let result = [];\r\n\r\n            function createTab(keyStr) {\r\n                return {\r\n                    id: keyStr,\r\n                    image: KL.brushesUI[keyStr].image,\r\n                    title: KL.brushesUI[keyStr].tooltip,\r\n                    onOpen: function () {\r\n                        brushUiObj[keyStr].getElement().style.display = 'block';\r\n                        setCurrentBrush(keyStr);\r\n                        klColorSlider.pickingDone();\r\n                        brushSettingService.emitSliderConfig({\r\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\r\n                        });\r\n                        sizeWatcher(brushUiObj[keyStr].getSize());\r\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\r\n                    },\r\n                    onClose: function () {\r\n                        brushUiObj[keyStr].getElement().style.display = 'none';\r\n                    }\r\n                };\r\n            }\r\n\r\n            let keyArr = Object.keys(brushUiObj);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result.push(createTab(keyArr[i]));\r\n            }\r\n            return result;\r\n        })()\r\n    });\r\n    brushDiv.appendChild(brushTabRow.getElement());\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            brushDiv.appendChild(brushUiObj[b].getElement());\r\n        }\r\n    }\r\n\r\n    const handUi = new KL.HandUi({\r\n        scale: 1,\r\n        angleDeg: 0,\r\n        onReset: function () {\r\n            klCanvasWorkspace.resetView(true);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onFit: function () {\r\n            klCanvasWorkspace.fitView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onAngleChange: function (angleDeg, isRelative) {\r\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n    });\r\n\r\n    let fillUi = new KL.FillUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let textUi = new KL.TextUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeUi = new KL.ShapeUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeTool = new KL.ShapeTool({\r\n        onShape: function (isDone, x1, y1, x2, y2, angleRad) {\r\n\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n            let shapeObj: any = {\r\n                type: shapeUi.getShape(),\r\n                x1: x1,\r\n                y1: y1,\r\n                x2: x2,\r\n                y2: y2,\r\n                angleRad: angleRad,\r\n                isOutwards: shapeUi.getIsOutwards(),\r\n                opacity: shapeUi.getOpacity(),\r\n                isEraser: shapeUi.getIsEraser()\r\n            };\r\n            if (shapeUi.getShape() === 'line') {\r\n                shapeObj.strokeRgb = klColorSlider.getColor();\r\n                shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n            } else {\r\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                if (shapeUi.getMode() === 'stroke') {\r\n                    shapeObj.strokeRgb = klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                } else {\r\n                    shapeObj.fillRgb = klColorSlider.getColor();\r\n                }\r\n            }\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawShape(layerIndex, shapeObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function (ctx) {\r\n                        KL.drawShape(ctx, shapeObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n\r\n        }\r\n    });\r\n\r\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\r\n        setCurrentLayer(klCanvas.getLayer(val));\r\n        klHistory.push({\r\n            tool: [\"misc\"],\r\n            action: \"focusLayer\",\r\n            params: [val]\r\n        });\r\n    }, klRootEl) as any;\r\n    const layerPreview = new KL.LayerPreview({\r\n        klRootEl: klRootEl,\r\n        onClick: function () {\r\n            mainTabRow.open('layers');\r\n        }\r\n    });\r\n    layerPreview.setIsVisible(uiHeight >= 579);\r\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n    const filterTab = new KL.FilterTab(\r\n        this,\r\n        klColorSlider,\r\n        layerManager,\r\n        setCurrentLayer,\r\n        klCanvasWorkspace,\r\n        handUi,\r\n        () => { //get current color\r\n            return currentColor;\r\n        },\r\n        () => { // get max canvas size\r\n            return klMaxCanvasSize;\r\n        },\r\n        () => { // get kl canvas\r\n            return klCanvas;\r\n        },\r\n        () => { // get current layer ctx\r\n            return currentLayerCtx;\r\n        },\r\n        !!pOptions.embed,\r\n        statusOverlay,\r\n    );\r\n\r\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n        brushUiObj,\r\n        layerPreview,\r\n        layerManager,\r\n        handUi,\r\n        klCanvasWorkspace,\r\n        () => {\r\n            if (!initState) {\r\n                throw new Error('initState not initialized');\r\n            }\r\n            return initState;\r\n        },\r\n        () => klCanvas,\r\n        () => currentLayerCtx,\r\n        (clctx) => {\r\n            currentLayerCtx = clctx;\r\n        },\r\n        () => currentBrush,\r\n    );\r\n    klHistory.addListener((p) => {\r\n        undoRedoCatchup.catchup(p);\r\n    });\r\n\r\n    function showNewImageDialog() {\r\n        KL.newImageDialog({\r\n            klRootEl: klRootEl,\r\n            currentColor: currentColor,\r\n            secondaryColor: klColorSlider.getSecondaryRGB(),\r\n            maxCanvasSize: klMaxCanvasSize,\r\n            canvasWidth: klCanvas.getWidth(),\r\n            canvasHeight: klCanvas.getHeight(),\r\n            workspaceWidth: getBBox().width < collapseThreshold ? uiWidth : uiWidth - toolWidth,\r\n            workspaceHeight: uiHeight,\r\n            onConfirm: function (width, height, color) {\r\n                resetCanvas({\r\n                    width: width,\r\n                    height: height,\r\n                    color: color.a === 1 ? color : null\r\n                });\r\n            },\r\n            onCancel: function () { }\r\n        });\r\n    }\r\n\r\n    function shareImage(callback?) {\r\n        BB.shareCanvas({\r\n            canvas: klCanvas.getCompleteCanvas(1),\r\n            fileName: BB.getDate() + filenameBase + '.png',\r\n            title: BB.getDate() + filenameBase + '.png',\r\n            callback: callback ? callback : function () { }\r\n        });\r\n    }\r\n\r\n    const saveToComputer = new KL.SaveToComputer(\r\n        typeof pOptions.customSave === 'function' ? (blob, flename) => {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('submit-prompt'),\r\n                buttons: [LANG('submit'), 'Cancel'],\r\n                callback: async (result) => {\r\n                    if (result !== LANG('submit')) {\r\n                        return;\r\n                    }\r\n\r\n                    let overlay = BB.el({\r\n                        parent: klRootEl,\r\n                        className: 'upload-overlay',\r\n                        content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                    });\r\n                    pOptions.customSave(blob, flename,\r\n                        () => {\r\n                            pOptions.saveReminder.reset();\r\n                            klRootEl.removeChild(overlay);\r\n                        },\r\n                        () => {\r\n                            klRootEl.removeChild(overlay);\r\n                        });\r\n                }\r\n            });\r\n        } : null,\r\n        pOptions.saveReminder,\r\n        klRootEl,\r\n        () => exportType,\r\n        () => klCanvas,\r\n        filenameBase,\r\n    );\r\n\r\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\r\n        klRootEl,\r\n        projectStore,\r\n        () => klCanvas.getProject(),\r\n        exportType,\r\n        (type) => {\r\n            exportType = type;\r\n        },\r\n        handleFileSelect,\r\n        () => {\r\n            saveToComputer.save();\r\n        },\r\n        showNewImageDialog,\r\n        pOptions.isShare ? shareImage : null,\r\n        () => { // on upload\r\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null,);\r\n        },\r\n        copyToClipboard,\r\n        pOptions.saveReminder,\r\n    );\r\n\r\n    const settingsTab = new KL.SettingsTab(\r\n        () => {\r\n            uiState = uiState === 'left' ? 'right' : 'left';\r\n            updateUi();\r\n            if (!pOptions.embed) {\r\n                LocalStorage.setItem('uiState', uiState);\r\n            }\r\n        },\r\n        pOptions.aboutEl,\r\n        klRootEl,\r\n    );\r\n\r\n    mainTabRow = new KL.TabRow({\r\n        initialId: 'draw',\r\n        tabArr: [\r\n            {\r\n                id: 'draw',\r\n                title: LANG('tool-brush'),\r\n                image: toolPaintImg,\r\n                onOpen: function () {\r\n                    if (currentBrushId === 'eraserBrush') {\r\n                        klColorSlider.enable(false);\r\n                    }\r\n                    BB.append(\r\n                        colorDiv,\r\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                    );\r\n                    brushDiv.style.display = 'block';\r\n                },\r\n                onClose: function () {\r\n                    brushDiv.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'hand',\r\n                title: LANG('tool-hand'),\r\n                image: toolHandImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    handUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    handUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'fill',\r\n                title: LANG('tool-paint-bucket'),\r\n                image: toolFillImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    klColorSlider.enable(true);\r\n                    fillUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    fillUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'text',\r\n                title: LANG('tool-text'),\r\n                image: toolTextImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    klColorSlider.enable(true);\r\n                    textUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    textUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'shape',\r\n                title: LANG('tool-shape'),\r\n                image: toolShapeImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    klColorSlider.enable(true);\r\n                    shapeUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    shapeUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'layers',\r\n                title: LANG('tab-layers'),\r\n                image: tabLayersImg,\r\n                onOpen: function () {\r\n                    layerManager.update();\r\n                    layerManager.style.display = 'block';\r\n                },\r\n                onClose: function () {\r\n                    layerManager.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'edit',\r\n                title: LANG('tab-edit'),\r\n                image: tabEditImg,\r\n                onOpen: function () {\r\n                    filterTab.show();\r\n                },\r\n                onClose: function () {\r\n                    filterTab.hide();\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                },\r\n            },\r\n            {\r\n                id: 'file',\r\n                title: LANG('tab-file'),\r\n                image: tabFileImg,\r\n                isVisible: !pOptions.hideFile && !!fileTab,\r\n                onOpen: function () {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'block';\r\n                    fileTab.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'none';\r\n                    fileTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                },\r\n            },\r\n            {\r\n                id: 'settings',\r\n                title: LANG('tab-settings'),\r\n                image: tabSettingsImg,\r\n                onOpen: function () {\r\n                    settingsTab.getElement().style.display = 'block';\r\n                    // settingsTab.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    settingsTab.getElement().style.display = 'none';\r\n                    // settingsTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            }\r\n        ]\r\n    });\r\n    function updateMainTabVisibility() {\r\n        if (!mainTabRow) {\r\n            return;\r\n        }\r\n\r\n        let toolObj = {\r\n            'draw': {},\r\n            'hand': {},\r\n            'fill': {},\r\n            'text': {},\r\n            'shape': {}\r\n        };\r\n\r\n        let activeStr = toolspaceToolRow.getActive();\r\n        let oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n        let keysArr = Object.keys(toolObj);\r\n        for (let i = 0; i < keysArr.length; i++) {\r\n            if (activeStr === keysArr[i]) {\r\n                mainTabRow.setIsVisible(keysArr[i], true);\r\n            } else {\r\n                mainTabRow.setIsVisible(keysArr[i], false);\r\n                if (oldTabId === keysArr[i]) {\r\n                    mainTabRow.open(activeStr);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function copyToClipboard(showCrop?) {\r\n        KL.clipboardDialog(klRootEl, getBBox(), klCanvas.getCompleteCanvas(1), function (inputObj) {\r\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                return;\r\n            }\r\n            //do a crop\r\n            let p = {\r\n                context: currentLayerCtx,\r\n                canvas: klCanvas,\r\n                input: inputObj, //{left,right,top,bottom}\r\n                history: klHistory\r\n            };\r\n            KL.filterLib.cropExtend.apply(p);\r\n            layerManager.update();\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        }, statusOverlay, showCrop);\r\n    }\r\n\r\n    const bottomBarWrapper = BB.el({\r\n        css: {\r\n            width: \"270px\",\r\n            position: \"absolute\",\r\n            bottom: '0',\r\n            left: '0'\r\n        },\r\n    });\r\n    if (pOptions.bottomBar) {\r\n        bottomBarWrapper.append(pOptions.bottomBar);\r\n        const observer = new MutationObserver(() => updateBottomBar());\r\n        observer.observe(\r\n            toolspaceInner,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n    }\r\n    function updateBottomBar() {\r\n        if (!pOptions.bottomBar) {\r\n            return;\r\n        }\r\n        const bbox = getBBox();\r\n        const threshold = 617; //590\r\n        const isVisible = (\r\n            threshold < bbox.height &&\r\n            toolspaceInner.scrollHeight + 50 < bbox.height\r\n        );\r\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n\r\n\r\n    BB.append(toolspaceInner, [\r\n        layerPreview.getElement(),\r\n        mainTabRow.getElement(),\r\n        brushDiv,\r\n        handUi.getElement(),\r\n        fillUi.getElement(),\r\n        textUi.getElement(),\r\n        shapeUi.getElement(),\r\n        layerManager,\r\n        filterTab.getElement(),\r\n        fileTab ? fileTab.getElement() : null,\r\n        settingsTab.getElement(),\r\n        BB.el({\r\n            css: {\r\n                height: '10px', // a bit of spacing at the bottom\r\n            }\r\n        }),\r\n        bottomBarWrapper ? bottomBarWrapper : null\r\n    ]);\r\n\r\n    const toolspaceScroller = new KL.ToolspaceScroller({\r\n        toolspace,\r\n        uiState,\r\n    });\r\n\r\n    // --- interface ---\r\n\r\n    this.importImage = (image: { name?: string; content?: Blob; width?: number; height?: number; color?: string; }) => {\r\n        if (!image.content) {\r\n            resetCanvas({\r\n                width: image.width || klCanvas.getWidth(),\r\n                height: image.height || klCanvas.getHeight(),\r\n                color: image.color || { r: 255, g: 255, b: 255, a: 1 }\r\n            });\r\n        } else {\r\n            window.URL = window.URL || window.webkitURL;\r\n            let url = window.URL.createObjectURL(image.content);\r\n            let im = new Image();\r\n            im.src = url;\r\n            BB.loadImage(im, function () {\r\n                importFinishedLoading({\r\n                    type: 'image',\r\n                    width: im.width,\r\n                    height: im.height,\r\n                    canvas: im\r\n                }, image.name || 'newImage', 'image');\r\n            });\r\n        }\r\n    };\r\n\r\n    this.getBBox = getBBox;\r\n\r\n    this.getEl = () => {\r\n        return klRootEl;\r\n    };\r\n\r\n    this.resize = (w, h) => {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        uiWidth = Math.max(0, w);\r\n        uiHeight = Math.max(0, h);\r\n\r\n        updateCollapse();\r\n        updateBottomBar();\r\n\r\n        layerPreview.setIsVisible(uiHeight >= 579);\r\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    };\r\n\r\n    this.out = (msg) => {\r\n        statusOverlay.out(msg);\r\n    };\r\n\r\n    this.getPNG = function (): Blob {\r\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    };\r\n\r\n    this.getPSD = async function () {\r\n        return await klCanvasToPsdBlob(klCanvas);\r\n    };\r\n\r\n    this.getProject = () => klCanvas.getProject();\r\n\r\n    this.swapUiLeftRight = () => {\r\n        uiState = uiState === 'left' ? 'right' : 'left';\r\n        if (!pOptions.embed) {\r\n            LocalStorage.setItem('uiState', uiState);\r\n        }\r\n        updateUi();\r\n    };\r\n\r\n    this.saveAsPsd = () => {\r\n        saveToComputer.save('psd');\r\n    };\r\n\r\n    this.isDrawing = () => {\r\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n    };\r\n\r\n    // --- end interface ---\r\n\r\n    this.resize(uiWidth, uiHeight);\r\n    updateUi();\r\n\r\n    {\r\n        BB.addEventListener(window, 'resize', () => {\r\n            const bbox = getBBox();\r\n            this.resize(bbox.width, bbox.height);\r\n        });\r\n        BB.addEventListener(window, 'orientationchange', () => {\r\n            const bbox = getBBox();\r\n            this.resize(bbox.width, bbox.height);\r\n        });\r\n\r\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n        const windowResizeWatcher = BB.el({\r\n            parent: container || document.body,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n                zIndex: '-1',\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        try {\r\n            // Not all browsers support ResizeObserver. Not critical though.\r\n            const observer = new ResizeObserver(() => {\r\n                const bbox = getBBox();\r\n                this.resize(bbox.width, bbox.height);\r\n            });\r\n            observer.observe(windowResizeWatcher);\r\n        } catch (e) {\r\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n        }\r\n\r\n        // prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.getEl(), 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n        //maybe prevent zooming on safari mac os - I can't test it\r\n        const prevent = (e) => {\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener('gesturestart', prevent);\r\n        window.addEventListener('gesturechange', prevent);\r\n        window.addEventListener('gestureend', prevent);\r\n    }\r\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\nimport {Popup, popup} from './ui/modals/popup';\nimport {dialogCounter} from './ui/modals/modal-count';\nimport {Checkbox} from './ui/base-components/checkbox';\nimport {input} from './ui/base-components/input';\nimport {Select} from './ui/base-components/select';\nimport {ImageToggle} from './ui/base-components/image-toggle';\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\nimport {KlSlider} from './ui/base-components/kl-slider';\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\nimport {PointSlider} from './ui/base-components/point-slider';\nimport {ColorOptions} from './ui/base-components/color-options';\nimport {Options} from './ui/base-components/options';\nimport {StatusOverlay} from './ui/components/status-overlay';\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\nimport {CropCopy} from './ui/components/crop-copy';\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\nimport {FreeTransform} from './ui/components/free-transform';\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\nimport {Cropper} from './ui/components/cropper';\nimport {LayerPreview} from './ui/components/layer-preview';\nimport {FittedImage} from './ui/components/fitted-image';\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\nimport {ToolDropdown} from './ui/components/tool-dropdown';\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\nimport {TabRow} from './ui/components/tab-row';\nimport {HandUi} from './ui/tool-tabs/hand-ui';\nimport {FillUi} from './ui/tool-tabs/fill-ui';\nimport {TextUi} from './ui/tool-tabs/text-ui';\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\nimport {newImageDialog} from './ui/modals/new-image-dialog';\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\nimport {renderText} from './image-operations/render-text';\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\nimport {floodFillBits} from './image-operations/flood-fill';\nimport * as PSD from './storage/psd';\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\nimport {KlCanvas} from './canvas/kl-canvas';\nimport * as indexedDb from './storage/indexed-db';\nimport {filterLib, filterLibStatus} from './filters/filters';\nimport {brushes} from './brushes/brushes';\nimport {brushesUI} from './brushes-ui/brushes-ui';\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\nimport {RadioList} from './ui/base-components/radio-list';\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\nimport {drawProject} from './canvas/draw-project';\nimport {ProjectStore} from './storage/project-store';\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\nimport {SaveReminder} from \"./ui/components/save-reminder\";\nimport {SaveToComputer} from \"./storage/save-to-computer\";\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\nimport {setDbName} from './storage/indexed-db';\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\nimport {BoxToggle} from './ui/base-components/box-toggle';\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\n\n/**\n * paint tool functionality\n */\nexport const KL = {\n\n    // --- brushes ---\n    brushes,\n    brushesUI,\n    BrushSettingService,\n\n    // --- canvas ---\n    KlCanvas,\n    drawProject,\n\n    // --- canvas ui ---\n    WorkspaceSvgOverlay,\n    KlCanvasWorkspace,\n    KlCanvasPreview,\n\n    // --- filters ---\n    filterLibStatus,\n    filterLib,\n\n    // --- history ---\n    UndoRedoCatchup,\n\n    // --- image operations ---\n    renderText,\n    floodFillBits,\n    ShapeTool,\n    drawShape,\n\n    // --- storage ---\n    PSD,\n    setDbName,\n    indexedDb,\n    ProjectStore,\n    loadAgPsd,\n    SaveToComputer,\n\n    // --- ui - base components ---\n    calcSliderFalloffFactor,\n    Checkbox,\n    input,\n    Select,\n    ImageToggle,\n    ImageRadioList,\n    RadioList,\n    penPressureToggle,\n    KlSlider,\n    HexColorDialog,\n    KlColorSlider,\n    KlSmallColorSlider,\n    PointSlider,\n    ColorOptions,\n    Options,\n    BoxToggle,\n\n    // --- ui - components ---\n    StatusOverlay,\n    CropCopy,\n    FreeTransform,\n    FreeTransformCanvas,\n    Cropper,\n    LayerPreview,\n    FittedImage,\n    KlImageDropper,\n    OverlayToolspace,\n    ToolspaceTopRow,\n    ToolDropdown,\n    ToolspaceToolRow,\n    ToolspaceStabilizerRow,\n    TabRow,\n    ToolspaceCollapser,\n    BrowserStorageUi,\n    SaveReminder,\n    ToolspaceScroller,\n\n    // --- ui - modals ---\n    dialogCounter,\n    popup,\n    Popup,\n    exportDialog,\n    clipboardDialog,\n    showImportAsLayerDialog,\n    newImageDialog,\n    textToolDialog,\n    showImportImageDialog,\n    showIframePopup,\n    imgurUpload,\n\n    // --- ui - tool tabs ---\n    HandUi,\n    FillUi,\n    TextUi,\n    ShapeUi,\n    FileTab,\n    FilterTab,\n    SettingsTab,\n    klLayerManager,\n\n\n    klHistory,\n    DecoyKlHistory,\n};","\nexport interface IHistoryEntry {\n    tool: string[];\n    action?: string;\n    params?: any[];\n\n    actions?: {\n        action: string;\n        params: any[];\n    }[]\n}\n\nexport interface IHistoryBroadcast {\n    bufferUpdate: IHistoryEntry;\n}\n\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\n\nlet historyInstance: boolean = false;\n\nexport interface KlHistoryInterface {\n    pause (b: boolean): void;\n    addListener (l: IHistoryListener): void;\n    push (e: IHistoryEntry): void;\n    undo (): (IHistoryEntry | null)[];\n    redo (): (IHistoryEntry | null)[];\n    getAll (): (IHistoryEntry | null)[];\n    canRedo (): boolean;\n    canUndo (): boolean;\n    getState (): number;\n    getActionNumber (): number;\n}\n\nexport class DecoyKlHistory implements KlHistoryInterface {\n    pause (b: boolean): void {}\n    addListener (l: IHistoryListener): void {}\n    push (e: IHistoryEntry): void {}\n    undo (): (IHistoryEntry | null)[] { return []; }\n    redo (): (IHistoryEntry | null)[] { return []; }\n    getAll (): (IHistoryEntry | null)[] { return []; }\n    canRedo (): boolean { return false; }\n    canUndo (): boolean { return false; }\n    getState (): number { return 0; }\n    getActionNumber (): number { return 0; }\n}\n\nexport class KlHistory implements KlHistoryInterface {\n\n    private state: number; // on .push state increments by one\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\n    private listeners: IHistoryListener[];\n    private pauseStack: number; // how often paused without unpause\n    private readonly max: number = 20; // max number undo steps\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\n    \n    private broadcast (p: IHistoryBroadcast | null): void {\n        setTimeout(() => {\n            for (let i = 0; i < this.listeners.length; i++) {\n                this.listeners[i](p);\n            }\n            this.state++;\n        }, 1);\n    }\n    \n    // ---- public ----\n    \n    constructor () {\n        if (historyInstance) {\n            throw new Error('klHistory already instantiated');\n        }\n        historyInstance = true;\n        this.state = 0;\n        this.dataArr = [];\n        this.listeners = [];\n        this.pauseStack = 0;\n        this.maxState = -1;\n        this.actionNumber = -1;\n    }\n\n    /**\n     * you need pause because there are sometimes actions that would cause other\n     * undo steps\n     * for example a filter that does something crazy with two layers and then merges them\n     * you want that to be one undo step, and prevent merging from causing its undo step.\n     * so while that filter is doing its magic you should pause possible undo steps that\n     * that are caused by a part of its code(in this example: merging layers)\n     *\n     * @param b\n     */\n    pause (b: boolean): void {\n        if (b === false) {\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\n        } else {\n            this.pauseStack++;\n        }\n    }\n\n    addListener (l: IHistoryListener): void {\n        this.listeners.push(l);\n    }\n\n    push (e: IHistoryEntry): void {\n        if (this.pauseStack > 0) {\n            return;\n        }\n        while (this.actionNumber < this.dataArr.length - 1) {\n            this.dataArr.pop();\n        }\n\n        //taking care of actions that shouldn't cause a new undo step\n        const top = this.dataArr[this.dataArr.length - 1];\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\n            this.dataArr[this.dataArr.length - 1] = e;\n            this.state++; //still needs to increment because something changed\n            return;\n        }\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\n            this.dataArr[this.dataArr.length - 1] = e;\n            this.state++;\n            return;\n        }\n\n\n        this.dataArr[this.dataArr.length] = e;\n        this.actionNumber = this.dataArr.length - 1;\n        const maxBefore = this.maxState;\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\n        if (maxBefore < this.maxState) {\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\n        } else {\n            this.broadcast(null);\n        }\n        if (this.maxState >= 0) {\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\n        }\n    }\n\n    undo (): (IHistoryEntry | null)[] {\n        let result;\n        if (this.canUndo()) {\n            result = [];\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\n                result.push(this.dataArr[i]);\n            }\n            this.actionNumber--;\n            this.broadcast(null);\n        }\n\n        return result;\n    }\n\n    redo (): (IHistoryEntry | null)[] {\n        const result = [];\n        if (this.canRedo()) {\n            this.actionNumber++;\n            result.push(this.dataArr[this.actionNumber]);\n            this.broadcast(null);\n        }\n        return result;\n    }\n\n    getAll (): (IHistoryEntry | null)[] {\n        return [].concat(this.dataArr);\n    }\n\n    canRedo (): boolean {\n        return this.actionNumber < this.dataArr.length - 1;\n    }\n\n    canUndo (): boolean {\n        return this.actionNumber > this.maxState;\n    }\n\n    getState (): number {\n        return this.state;\n    }\n\n    /**\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\n     */\n    getActionNumber (): number {\n        return (this.actionNumber + 1);\n    }\n    \n}\n\nexport const klHistory = new KlHistory();\n","import { dialogCounter } from './modal-count';\r\nimport { BB } from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\r\n// @ts-ignore\r\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\r\nimport { LANG } from '../../../language/language';\r\nimport { IKeyString } from '../../../bb/bb.types';\r\n\r\nwindow.onscroll = (e) => {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function popup(\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: p.target || document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        }\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        }\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        }\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content: p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : null,\r\n                    marginRight: '15px',\r\n                }\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : null,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            }\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            }\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        BB.addClassName(boxEl, 'poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        BB.addClassName(boxEl, 'popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        BB.addClassName(boxEl, 'popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        BB.addClassName(boxEl, 'popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(function () {\r\n                    clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        }\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event) => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus = null;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = null;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        }\r\n    }) : null;\r\n    let clickOnEnterBtn;\r\n    const btnElArr = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    }\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [iconImg, label],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close(value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        {\r\n            /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n            const focusEl = BB.el({\r\n                parent: document.body,\r\n                tagName: 'input',\r\n                css: {\r\n                    opacity: '0',\r\n                    width: '0',\r\n                    height: '0',\r\n                }\r\n            }) as HTMLInputElement;\r\n            setTimeout(() => {\r\n                focusEl.select();\r\n                focusEl.focus();\r\n                focusEl.parentNode.removeChild(focusEl);\r\n            }, 10);\r\n        }\r\n        rootRootEl.parentNode.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => {\r\n            BB.destroyEl(item);\r\n        });\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closefunc) {\r\n        p.closefunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * popups that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n *\r\n * p = {\r\n *      title: DOM Element | string, // optional (todo allow string)\r\n *      icon: 'ok', // optional todo\r\n *      content: DOM Element, // optional\r\n *      buttonArr: [ // optional todo\r\n *          'Ok',\r\n *          'Cancel'\r\n *      ],\r\n *      autoFocus: string | false, //todo\r\n *      clickOnEnter: string, //todo\r\n *      onClose: function(result: string), // optional (todo result)\r\n *\r\n *      //size and position\r\n *      width: 500,\r\n *      isMaxHeight: boolean //todo, currently always true\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Popup = function (p) {\r\n    dialogCounter.increase();\r\n    const parent = p.target || document.body;\r\n    const div = BB.el({\r\n        parent: parent,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0',\r\n            background: 'rgba(0, 0, 0, 0.45)',\r\n            overflow: 'auto',\r\n            animationName: 'consoleIn',\r\n            animationDuration: '0.3s',\r\n            animationTimingFunction: 'ease-out'\r\n        }\r\n    });\r\n    div.onclick = BB.handleClick;\r\n\r\n    let updateInterval;\r\n\r\n    function close() {\r\n        dialogCounter.decrease();\r\n        div.onclick = null;\r\n        parent.removeChild(div);\r\n        clearInterval(updateInterval);\r\n        window.removeEventListener('resize', updatePos);\r\n        keyListener.destroy();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        if (p.onClose) {\r\n            p.onClose();\r\n        }\r\n    }\r\n\r\n    //background element registering clicks\r\n    const bgEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0'\r\n        },\r\n        onClick: close\r\n    });\r\n\r\n    //the actual popup box\r\n    const popupEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            width: (BB.isCssMinMaxSupported() ?\r\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                (p.width ? p.width : 400) + 'px'),\r\n            height: 'calc(100% - 40px)',\r\n            background: '#eee',\r\n            borderRadius: '10px',\r\n            overflow: 'hidden',\r\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\r\n        }\r\n    });\r\n\r\n    //x and y position via script. flex not powerful enough imo\r\n    function updatePos() {\r\n        const width = p.target ? (p.target.clientWidth || p.target.offsetWidth) : window.innerWidth;\r\n        const height = p.target ? (p.target.clientHeight || p.target.offsetHeight) : window.innerHeight;\r\n        const elW = popupEl.offsetWidth;\r\n        const elH = popupEl.offsetHeight;\r\n        BB.css(popupEl, {\r\n            left: Math.max(0, (width - elW) / 2) + 'px',\r\n            top: Math.max(20, (height - elH) / 2 - (elH * 0.20)) + 'px'\r\n        });\r\n    }\r\n    //todo also update when popup changes size - resizeobserver and fallback\r\n    //updateInterval = setInterval(updatePos, 100);\r\n    updatePos();\r\n    window.addEventListener('resize', updatePos);\r\n\r\n    //title row in popup\r\n    const titleHeight = 40;\r\n    const titleEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: titleHeight + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            paddingLeft: (titleHeight / 2) + 'px'\r\n        }\r\n    });\r\n    if (p.title) {\r\n        titleEl.appendChild(p.title);\r\n    }\r\n    const xButton = BB.el({\r\n        parent: titleEl,\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: close,\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n        custom: {\r\n            tabindex: '0',\r\n        }\r\n    });\r\n\r\n    const contentEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: 'calc(100% - ' + titleHeight + 'px)'\r\n        }\r\n    });\r\n    if (p.content) {\r\n        contentEl.appendChild(p.content);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e) {\r\n            if (keyStr === 'esc') {\r\n                e.stopPropagation();\r\n                close();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.close = function () {\r\n        close();\r\n    };\r\n};","\n// not the best\n\n/**\n * how many modals are open\n */\n\nexport class DialogCounter {\n    private listeners: ((v: number) => void)[] = [];\n    private count = 0;\n\n    private emit (): void {\n        this.listeners.forEach(item => {\n            item(this.count);\n        });\n    }\n\n    increase (v?: number): void {\n        if (v !== undefined) {\n            this.count += v;\n        } else {\n            this.count++;\n        }\n        this.emit();\n    }\n    decrease (v?: number): void {\n        if (v !== undefined) {\n            this.count -= v;\n        } else {\n            this.count--;\n        }\n        this.emit();\n    }\n    get (): number {\n        return this.count;\n    }\n    subscribe (listener: (v: number) => void): void {\n        this.listeners.push(listener);\n    }\n}\n\nexport const dialogCounter = new DialogCounter();\n","import * as BBEventListener from './input/event-listener';\nimport {\n    addClassName, append, centerWithin, copyObj, createSvg,\n    css, dateDayDifference, decToFraction,\n    fitInto, gcd, getDate,\n    handleClick, imageBlobToUrl,\n    insertAfter, loadImage,\n    reduce,\n    removeClassName, setAttributes, shareCanvas\n} from './base/base';\nimport {\n    canShareFiles,\n    eventUsesHighResTimeStamp,\n    getVisitor,\n    hasPointerEvents,\n    hasWebGl,\n    isCssMinMaxSupported,\n    mouseEventHasMovement\n} from './base/browser';\nimport {KeyListener, sameKeys} from './input/key-listener';\nimport {PointerListener} from './input/pointer-listener';\nimport * as EventChain from './input/event-chain';\nimport {\n    convertToAlphaChannelCanvas,\n    copyCanvas,\n    createCheckerCanvas, createCheckerDataUrl,\n    drawTransformedImageOnCanvas,\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\n} from './base/canvas';\nimport {Matrix} from './math/matrix';\nimport {Vec2} from './math/vec2';\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\nimport {appendTextDiv, clearSelection, destroyEl, el, isInputFocused, makeUnfocusable} from './base/ui';\nimport {\n    pointsToAngleDeg,\n    clamp,\n    dist,\n    mix,\n    pointsToAngleRad,\n    rotate,\n    rotateAround,\n    intDxy,\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea\n} from './math/math';\nimport {createCanvas} from './base/create-canvas';\nimport {BbLog} from './base/bb-log';\nimport {LocalStorage} from './base/local-storage';\n\nexport const BB = {\n\n    // ---- browser ----\n    eventUsesHighResTimeStamp,\n    mouseEventHasMovement,\n    hasPointerEvents,\n    hasWebGl,\n    getVisitor,\n    isCssMinMaxSupported,\n    canShareFiles,\n\n    // ---- base ----\n    insertAfter,\n    loadImage,\n    css,\n    setAttributes,\n    addClassName,\n    removeClassName,\n    append,\n    fitInto,\n    centerWithin,\n    getDate,\n    gcd,\n    reduce,\n    decToFraction,\n    imageBlobToUrl,\n    dateDayDifference,\n    copyObj,\n    shareCanvas,\n    handleClick,\n    createSvg,\n    BbLog,\n    LocalStorage,\n\n    // ---- math ----\n    mix,\n    dist,\n    distSquared,\n    lenSquared,\n    pointsToAngleRad,\n    pointsToAngleDeg,\n    clamp,\n    rotate,\n    rotateAround,\n    Matrix,\n    Vec2,\n    intDxy,\n    roundEven,\n    roundUneven,\n    updateBounds,\n    boundsInArea,\n\n    // ---- line ----\n    projectPointOnLine,\n    PointLine,\n    BezierLine,\n    SplineInterpolator,\n    quadraticSplineInput,\n\n    // ---- canvas ----\n    canvas: createCanvas,\n    copyCanvas,\n    testShouldPixelate,\n    drawTransformedImageWithBounds,\n    drawTransformedImageOnCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    resizeCanvas,\n    convertToAlphaChannelCanvas,\n    freeCanvas,\n\n    // ---- color ----\n    HSV,\n    RGB,\n    CMYK,\n    ColorConverter,\n    testIsWhiteBestContrast,\n\n    // ---- UI ----\n    appendTextDiv,\n    clearSelection,\n    makeUnfocusable,\n    el,\n    destroyEl,\n    isInputFocused: isInputFocused,\n\n\n    // ---- events / input ----\n\n    addEventListener: BBEventListener.addEventListener,\n    removeEventListener: BBEventListener.removeEventListener,\n    setEventListener: BBEventListener.setEventListener,\n\n    KeyListener,\n    PointerListener,\n    sameKeys,\n\n    EventChain,\n\n};\n","import {hasPointerEvents} from '../base/browser';\n\nconst listenerFuncObj = {}; // for debugging\n\nexport const setEventListener = function (DomEl, type, listener) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    DomEl[type] = listener;\n};\n\nexport const addEventListener = function (DomEl, type, listener, options?) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    /*if (!(type in listenerFuncObj)) {\n        listenerFuncObj[type] = [];\n    }\n    listenerFuncObj[type].push(listener);*/\n    DomEl.addEventListener(type, listener, options);\n};\n\nexport const removeEventListener = function (DomEl, type, listener, options?) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    /*if (type in listenerFuncObj) {\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\n            if (listenerFuncObj[type][i] === listener) {\n                listenerFuncObj[type].splice(i, 1);\n                i--;\n            }\n        }\n    }*/\n    DomEl.removeEventListener(type, listener, options);\n};","import {createCanvas} from './create-canvas';\n\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const eventUsesHighResTimeStamp = (function() {\n\n    let eventUsesHighResTimeStamp: boolean | null = null;\n    if (document.body) {\n        (function() {\n            const event = new Event('');\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\n        })();\n    } else {\n        window.addEventListener('DOMContentLoaded', function(event) {\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\n        });\n    }\n\n    return function(): boolean {\n        if (eventUsesHighResTimeStamp === null) {\n            throw 'eventUsesHighResTimeStamp not initialized';\n        }\n        return eventUsesHighResTimeStamp;\n    }\n})();\n\nexport const mouseEventHasMovement = (() => {\n\n    // no support: IE, Safari, Safari iOS\n    // supported but broken: Firefox\n\n    if (!('MouseEvent' in window)) {\n        return false;\n    }\n    let mouseEvent;\n    try {\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\n    } catch (e) {\n        return false;\n    }\n    if (!('movementX' in mouseEvent)) {\n        return false; // likely safari\n    }\n    return !isFirefox;\n})();\n\nexport const hasPointerEvents = !!window.PointerEvent;\n\nexport const hasWebGl = (function() {\n\n    const hasWebgl = (function() {\n        const canvas = createCanvas();\n        try {\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\n            return true;\n        } catch (e) {\n            return false;\n        }\n    })();\n\n    return function() {\n        return hasWebgl;\n    }\n})();\n\nexport const getVisitor = (function () {\n    const visitor = {\n        chrome: false,\n        gl: false\n    };\n    //Chrome\n    if ((window as any).chrome && (window as any).chrome.app) {\n        visitor.chrome = true;\n    }\n    //WebGL\n    visitor.gl = hasWebGl();\n    return function () {\n        return JSON.parse(JSON.stringify(visitor));\n    }\n})();\n\nexport const isCssMinMaxSupported = (function() {\n    let result: boolean | null = null;\n\n    function test() {\n        const div = document.createElement('div');\n        div.style.position = 'absolute';\n        div.style.top = '0';\n        div.style.left = 'max(0px, 25px)';\n        document.body.appendChild(div);\n        setTimeout(function() {\n            result = div.offsetLeft === 25;\n            document.body.removeChild(div);\n        }, 25);\n    }\n\n    if (document.body) {\n        test();\n    } else {\n        window.addEventListener('DOMContentLoaded', function() {\n            test();\n        });\n    }\n\n    return function(): boolean {\n        if (result === null) {\n            throw new Error('isCssMinMaxSupported not initialized');\n        }\n        return result;\n    };\n})();\n\nexport const canShareFiles = function(): boolean {\n    return 'share' in navigator && 'canShare' in navigator;\n};","/*window['canvases'] = [];\n\nwindow['printCanvases'] = () => {\n    let total = 0;\n\n    console.log(window['canvases'].map(item => {\n        total += item.width * item.height;\n        return {w: item.width, h: item.height};\n    }));\n\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\n};*/\n\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\n    const result = document.createElement('canvas');\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\n\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\n    if (referenceNode.parentNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    }\n}\n\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\n    let counter = 0;\n\n    function check() {\n        if (counter === 1000) {\n            alert(\"couldn't load\");\n            return;\n        }\n        if (im.complete) {\n            counter++;\n            callback();\n        } else {\n            setTimeout(check, 1);\n        }\n    }\n\n    check();\n}\n\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\n    const keyArr = Object.keys(styleObj);\n    let keyStr: string;\n    const style = (el.style as unknown) as IKeyString;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        style[keyStr] = styleObj[keyStr];\n        style.alignContent = 'true';\n        if (keyStr === 'userSelect') {\n            style.webkitUserSelect = styleObj[keyStr]; // safari\n        }\n    }\n}\n\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\n    const keyArr = Object.keys(attrObj);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        el.setAttribute(keyStr, attrObj[keyStr]);\n    }\n}\n\nexport function addClassName (el: HTMLElement | SVGElement, classStr: string): void {\n    const classAttr = el.getAttribute('class');\n    const splitArr = classAttr === null ? [] : classAttr.split(' ');\n    if (splitArr.includes(classStr)) {\n        return;\n    }\n    splitArr.push(classStr);\n    el.setAttribute('class', splitArr.join(' '));\n}\n\nexport function removeClassName (el: HTMLElement | SVGElement, classStr: string): void {\n    const classAttr = el.getAttribute('class');\n    const splitArr = classAttr === null ? [] : classAttr.split(' ');\n    if (!splitArr.includes(classStr)) {\n        return;\n    }\n    for (let i = 0; i < splitArr.length; i++) {\n        if (splitArr[i] === classStr) {\n            splitArr.splice(i, 1);\n            i--;\n        }\n    }\n    el.setAttribute('class', splitArr.join(' '));\n}\n\n/**\n * appendChild with an array\n * @param target\n * @param els\n */\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\n    const fragment = document.createDocumentFragment();\n    els.forEach(item => item ? fragment.append(item) : null);\n    target.append(fragment);\n}\n\n/**\n * a needs to fit into b\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n * @param min\n */\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\n    let width = aw * bw, height = ah * bw;\n    if (width > bw) {\n        height = bw / width * height;\n        width = bw;\n    }\n    if (height > bh) {\n        width = bh / height * width;\n        height = bh;\n    }\n    if (min) {\n        width = Math.max(min, width);\n        height = Math.max(min, height);\n    }\n    return {width, height};\n}\n\n/**\n * center b in a\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n */\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\n    return {\n        x: aw / 2 - bw / 2,\n        y: ah / 2 - bh / 2\n    };\n}\n\nexport function getDate (): string {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\n\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\n}\n\nexport function gcd (a: number, b: number): number {\n    return b ? gcd(b, a % b) : a;\n}\n\nexport function reduce (numerator: number, denominator: number): [number, number] {\n    const g = gcd(numerator, denominator);\n    return [numerator / g, denominator / g];\n}\n\nexport function decToFraction (decimalNumber: number): [number, number] {\n    const len = decimalNumber.toString().length - 2;\n    const denominator = Math.pow(10, len);\n    const numerator = decimalNumber * denominator;\n    return reduce(numerator, denominator);\n}\n\n/**\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\n * @param blobObj\n * @returns {string}\n */\nexport function imageBlobToUrl(blobObj: Blob): string {\n    if (!blobObj) {\n        throw new Error('blobObj is undefined or null');\n    }\n    if (window.Blob && blobObj instanceof Blob) {\n        return URL.createObjectURL(blobObj); // object url\n    } else if (blobObj.constructor.name === 'Object') {\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\n    } else {\n        throw new Error('unknown blob format');\n    }\n}\n\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\n    dateA = new Date(dateA);\n    dateB = new Date(dateB);\n    dateA.setHours(0, 0, 0, 0);\n    dateB.setHours(0, 0, 0, 0);\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function copyObj (obj: any): any {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * triggers Web Share API - share feature on mobile devices\n * Only works if they support file sharing - e.g. Safari can't do this yet\n * only call if BB.canShareFiles() -> true\n *\n * p = {\n *     canvas: Canvas,\n *     fileName: string,\n *     title: string\n * }\n *\n * @param p\n */\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\n    const mimetype = 'image/png';\n    const err = () => alert('sharing not supported');\n    p.canvas.toBlob(function(blob) {\n        if (blob === null) {\n            err();\n            p.callback();\n            return;\n        }\n        try {\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\n            navigator.share({\n                title: p.title,\n                files: filesArray,\n            } as any)\n                .then(r => {\n\n                })\n                .catch(e => {\n                    err();\n            });\n        } catch(e) {\n            err();\n        }\n        p.callback();\n    }, mimetype);\n}\n\n/**\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\n * Give it your click event\n *\n * @param clickEvent\n * @returns {boolean}\n */\nexport function handleClick (clickEvent: MouseEvent): boolean {\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\n    if (!target) {\n        return false;\n    }\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\n        return true;\n    }\n    clickEvent.preventDefault();\n    return false;\n}\n\n\n/**\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\n * @returns svg element tree\n */\nexport function createSvg (el: ISVG): SVGElement {\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\n    const keyArr = Object.keys(el);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        if (keyStr === 'childrenArr') {\n            for (let e = 0; e < el.childrenArr.length; e++) {\n                result.appendChild(createSvg(el.childrenArr[e]));\n            }\n        } else if (keyStr !== 'elementType') {\n            result.setAttribute(keyStr, el[keyStr] as string);\n        }\n    }\n    return result;\n}","import {addEventListener, removeEventListener} from './event-listener';\n\n\nconst globalKey = (() => {\n\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\n        'space': [' ', 'Spacebar'], // Spacebar in IE\n        'alt': ['Alt', 'AltGraph'],\n        'shift': 'Shift',\n        'ctrl': 'Control',\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\n        'enter': 'Enter',\n        'esc': 'Escape',\n        'backspace': 'Backspace',\n        'delete': 'Delete',\n        'sqbr_open': '[',\n        'sqbr_close': ']',\n        'a': ['a', 'A'],\n        'b': ['b', 'B'],\n        'c': ['c', 'C'],\n        'e': ['e', 'E'],\n        'f': ['f', 'F'],\n        'g': ['g', 'G'],\n        'r': ['r', 'R'], // when holding shift\n        's': ['s', 'S'],\n        't': ['t', 'T'],\n        'u': ['u', 'U'],\n        'x': ['x', 'X'],\n        'y': ['y', 'Y'],\n        'z': ['z', 'Z'],\n        'plus': '+',\n        'minus': '-',\n        'left': 'ArrowLeft',\n        'right': 'ArrowRight',\n        'up': 'ArrowUp',\n        'down': 'ArrowDown',\n        'home': 'Home',\n        'end': 'End'\n    };\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\n    const isDownObj = {};\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\n    let comboArr = [];\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\n    const listenerArr = [];\n\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\n        isDownObj[keyToKeyStrArr[i]] = false;\n\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\n        if (typeof code === 'string') {\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\n        } else {\n            for (let e = 0; e < code.length; e++) {\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\n            }\n        }\n    }\n\n    function emitDown(a, b, c, d?) {\n        listenerArr.forEach(item => {\n            if (!item[0]) {\n                return;\n            }\n            item[0](a, b, c, d);\n        });\n    }\n\n    function emitUp(a, b, c) {\n        listenerArr.forEach(item => {\n            if (!item[1]) {\n                return;\n            }\n            item[1](a, b, c);\n        });\n    }\n\n    function emitBlur() {\n        listenerArr.forEach(item => {\n            if (!item[2]) {\n                return;\n            }\n            item[2]();\n        });\n    }\n\n    function keyDown(e) {\n        const key = e.key;\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\n\n        if (key in keyToKeyStrObj) {\n            const keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join('+'), true);\n                return;\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n\n            //add to combo\n            comboArr.push(keyStr);\n\n            emitDown(keyStr, e, comboArr.join('+'));\n        }\n    }\n\n\n    function keyUp(e) {\n        const key = e.key;\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\n        const oldComboStr = comboArr.join('+');\n\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if ([\n            'Meta', 'MetaLeft', 'MetaRight',\n            'OSLeft', 'OSRight', // Firefox\n        ].includes(code)) {\n            blur(null);\n            return;\n        }\n\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\n            const keyStr = codeIsDownObj[code];\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = null;\n\n            //remove from combo\n            for (let i = 0; i < comboArr.length; i++) {\n                if (comboArr[i] == keyStr) {\n                    comboArr.splice(i, 1);\n                    i--;\n                }\n            }\n\n            emitUp(keyStr, e, oldComboStr);\n        }\n    }\n\n    function blur(event) {\n        const oldComboStr = comboArr.join('+');\n        comboArr = [];\n        codeIsDownObj = {};\n\n        const eventArr = [];\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\n            if (isDownObj[keyToKeyStrArr[i]]) {\n                isDownObj[keyToKeyStrArr[i]] = false;\n                eventArr.push(keyToKeyStrArr[i]);\n            }\n        }\n        for (let i = 0; i < eventArr.length; i++) {\n            emitUp(\n                eventArr[i],\n                {\n                    preventDefault: function () {},\n                    stopPropagation: function () {},\n                },\n                oldComboStr,\n            );\n        }\n        emitBlur();\n    }\n\n\n\n    return {\n        add: (keyListener) => {\n            if (listenerArr.includes(keyListener)) {\n                return;\n            }\n            const first = listenerArr.length === 0;\n            listenerArr.push(keyListener);\n\n            if (first) {\n                addEventListener(document, 'keydown', keyDown);\n                addEventListener(document, 'keyup', keyUp);\n                addEventListener(window, 'blur', blur);\n            }\n        },\n        remove: (keyListener) => {\n            if (!listenerArr.includes(keyListener)) {\n                return;\n            }\n            const last = listenerArr.length === 1;\n            for (let i = 0; i < listenerArr.length; i++) {\n                if (listenerArr[i] === keyListener) {\n                    listenerArr.splice(i, 1);\n                    break;\n                }\n            }\n            if (last) {\n                removeEventListener(document, 'keydown', keyDown);\n                removeEventListener(document, 'keyup', keyUp);\n                removeEventListener(window, 'blur', blur);\n            }\n        },\n        getIsDown: () => {\n            return isDownObj;\n        },\n        getCombo: () => {\n            return comboArr;\n        },\n    };\n})();\n\n\n\n/**\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\n *\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\n * comboStr - string joins currently pressed keyStr with a +\n *              e.g. 'ctrl+z'\n *\n */\nexport class KeyListener {\n\n    private readonly onDown;\n    private readonly onUp;\n    private readonly onBlur;\n    private readonly ref;\n\n    constructor (\n        p: {\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\n            onBlur?: () => void;\n        },\n    ) {\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [this.onDown, this.onUp, this.onBlur];\n        globalKey.add(this.ref);\n    }\n\n    isPressed (keyStr: string): boolean {\n        if (!(keyStr in globalKey.getIsDown())) {\n            throw 'key \"' + keyStr + '\" not found';\n        }\n        return globalKey.getIsDown()[keyStr];\n    }\n\n    getComboStr (): string {\n        return globalKey.getCombo().join('+');\n    }\n\n    comboOnlyContains (keyStrArr: string[]): boolean {\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    destroy (): void {\n        globalKey.remove(this.ref);\n    }\n}\n\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\n}","import {addEventListener, removeEventListener} from './event-listener';\n\n\n/**\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\n * Normalizes regular scrolls.\n *\n * Why:\n * - trackpad scrolling is different from old school mouse scrolling\n * - but there is not way to learn from the browser if it's trackpad scrolling\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\n *      continue an arbitrary amount, at an arbitrary scale\n * - each browser does this differently. So you can't offer a coherent experience\n *\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\n *\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\n * @constructor\n */\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\nimport {mix} from '../math/math';\n\nconst WheelCleaner = function (callback) {\n    const sequenceTimeoutMs = 200;\n\n    const knownUnitArr = [100];\n    let sequenceLength = 0;\n    let sequenceUnit = null;\n    let endSequenceTimeout;\n    let toEmitDelta = null;\n    let position = null;\n\n\n    function emit(delta) {\n        callback({\n            deltaY: Math.round(delta / sequenceUnit),\n            pageX: position.pageX,\n            pageY: position.pageY,\n            clientX: position.clientX,\n            clientY: position.clientY,\n        });\n    }\n\n    function endSequence() {\n        if (toEmitDelta !== null) {\n            emit(toEmitDelta);\n            toEmitDelta = null;\n        }\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\n            knownUnitArr.push(sequenceUnit);\n        }\n        sequenceLength = 0;\n        sequenceUnit = null;\n    }\n\n    // --- interface ---\n    this.process = function (event) {\n\n        position = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            clientX: event.clientX,\n            clientY: event.clientY,\n        };\n\n        clearTimeout(endSequenceTimeout);\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\n\n        //prep delta\n        let delta = event.deltaY;\n        if ('deltaMode' in event && event.deltaMode === 1) {\n            delta *= 100 / 3;\n        }\n        const absDelta = Math.abs(delta);\n\n\n        if (sequenceLength > 0 && sequenceUnit === null) {\n            //previously determined dirty sequence\n            toEmitDelta = null;\n            return;\n        }\n\n        //sequence begins\n        if (sequenceLength === 0) {\n            sequenceLength++;\n            if (absDelta < 50) {\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\n                return;\n            }\n\n            sequenceUnit = absDelta;\n            if (knownUnitArr.includes(sequenceUnit)) {\n                //we know this unit - emit right away\n                emit(delta);\n            } else {\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n                toEmitDelta = delta;\n            }\n            return;\n        }\n\n        //sequence continues\n        if (absDelta === 0) {\n            //ignore zero scroll\n            return;\n        }\n        if (\n            absDelta === sequenceUnit ||\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\n        ) {\n            //fine\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\n            //unit was actually a multiple - update it\n            sequenceUnit = absDelta;\n\n        } else if (absDelta !== sequenceUnit) {\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n            sequenceUnit = null;\n            toEmitDelta = null;\n            return;\n        }\n\n\n        if (toEmitDelta !== null) {\n            emit(toEmitDelta);\n            toEmitDelta = null;\n        }\n        emit(delta);\n    };\n};\n\n\n/**\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\n *\n * p = {\n *     target: DOM element,\n *     onPointer: func (pointerEvent), //optional\n *     onWheel: func (wheelEvent), //optional\n *     onEnterLeave: func (isOver: boolean), //optional\n *     maxPointers: int (1 - n), //default is 1\n *     fixScribble: boolean, // fix ipad scribble issue\n * }\n *\n * pointerEvent = {\n *     type: 'pointerdown'|'pointermove'|'pointerup',\n *     pointerId: long,\n *     pointerType: 'touch'|'mouse'|'pen',\n *     pageX: number,\n *     pageY: number,\n *     clientX: number,\n *     clientY: number,\n *     relX: number, //position relative to top left of target\n *     relY: number,\n *     dX: number, //movementX not supported by safari on iOS, so need my own\n *     dY: number,\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\n *     downPageY: number,\n *     coalescedArr: Array of {\n *         pageX: number,\n *         pageY: number,\n *         clientX: number,\n *         clientY: number,\n *         relX: number, //position relative to top left of target\n *         relY: number,\n *         dX: number,\n *         dY: number,\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\n *     },\n *     time: number, // same timescale as performance.now()\n *     button: 'left'|'middle'|'right',\n *     pressure: number (0-1), // always 1 for touch and mouse\n *     eventPreventDefault: function(),\n *     eventStopPropagation: function(),\n * }\n *\n * wheelEvent = {\n *     deltaY: number, // increments of 1\n *     pageX: number,\n *     pageY: number,\n *     relX: number,\n *     relY: number,\n * }\n *\n * isOver(): boolean - if pointer over the target\n *\n * @param p\n */\nexport const PointerListener = (function () {\n\n    //keeping track of pointers for movement fallback\n    const pointerArr = [];\n\n    function addPointer(event) {\n        const pointerObj = {\n            pointerId: event.pointerId,\n            lastPageX: null,\n            lastPageY: null\n        };\n        pointerArr.push(pointerObj);\n\n        if (pointerArr.length > 15) {\n            pointerArr.shift();\n        }\n\n        return pointerObj;\n    }\n\n    function getPointer(event) {\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\n            if (event.pointerId === pointerArr[i].pointerId) {\n                return pointerArr[i];\n            }\n        }\n        return null;\n    }\n\n\n    let pressureNormalizeAvgCount = 0;\n    let pressureNormalizeAvgPressure = null;\n    let pressureNormalizeIsComplete = false;\n    let pressureNormalizeFactor = 1;\n\n    return function (p) {\n        const targetElement = p.target;\n        const onPointerCallback = p.onPointer;\n        const onWheelCallback = p.onWheel;\n        const onEnterLeaveCallback = p.onEnterLeave;\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\n        const buttonsToStr = { // translation\n            '1': 'left',\n            '2': 'right',\n            '4': 'middle'\n        };\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\n            if (isDestroyed) {\n                return;\n            }\n            if (onWheelCallback) {\n                const bounds = targetElement.getBoundingClientRect();\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\n                onWheelCallback(wheelEvent);\n            }\n        });\n        let isDestroyed = false;\n\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\n\n\n        //to circumvent a chrome input glitch\n        let lastPointerType = '';\n        let didSkip = false;\n\n\n        /*\n        pointers that are pressing a button\n        dragObj = {\n            pointerId: long,\n            pointerType: 'mouse'|'pen'|'touch',\n            downPageX: number, //where was pointer when down-event occurred\n            downPageY: number,\n            button: long,\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\n            lastPageY: number,\n            lastTimeStamp: number\n        }\n         */\n        const dragObjArr = [];\n        const dragPointerIdArr = [];\n\n        function getDragObj(pointerId) {\n            for (let i = 0; i < dragObjArr.length; i++) {\n                if (pointerId === dragObjArr[i].pointerId) {\n                    return dragObjArr[i];\n                }\n            }\n            return null;\n        }\n\n        function removeDragObj(pointerId) {\n            let removedDragObj = null;\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\n                if (dragPointerIdArr[i] === pointerId) {\n                    removedDragObj = dragObjArr[i];\n                    dragObjArr.splice(i, 1);\n                    dragPointerIdArr.splice(i, 1);\n                    i--;\n                }\n            }\n            return removedDragObj;\n        }\n\n\n        function normalizePressure(pressure, type?) {\n            if (pressure === 0 || pressure === 1) {\n                return pressure;\n            }\n\n            // was this there to prevent some glitch?\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\n                pressure *= 0.004;\n            }*/\n\n            if (pressureNormalizeAvgCount < 60) {\n                if (pressureNormalizeAvgCount === 0) {\n                    pressureNormalizeAvgPressure = pressure;\n                } else {\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\n                }\n                pressureNormalizeAvgCount++;\n            } else if (!pressureNormalizeIsComplete) {\n                pressureNormalizeIsComplete = true;\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\n                    pressureNormalizeFactor = 2.3;\n                }\n            }\n\n\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\n        }\n\n\n        /**\n         *\n         * More trustworthy pointer attributes. that behave the same across browsers.\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\n         *\n         * @param event\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\n         */\n        function correctPointerEvent(event) {\n            if (event.corrected) {\n                return event.corrected;\n            }\n\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\n                if (event.type === 'pointermove') {\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\n                }\n            }*/\n\n            const correctedObj = {\n                pointerId: event.pointerId,\n                pointerType: event.pointerType,\n                pageX: event.pageX,\n                pageY: event.pageY,\n                clientX: event.clientX,\n                clientY: event.clientY,\n                movementX: event.movementX,\n                movementY: event.movementY,\n                timeStamp: event.timeStamp + timeStampOffset,\n                pressure: normalizePressure(event.pressure, event.type),\n                buttons: event.buttons,\n                button: event.button,\n                coalescedArr: [],\n                eventPreventDefault: function () {\n                    event.preventDefault();\n                },\n                eventStopPropagation: function () {\n                    event.stopPropagation();\n                }\n            };\n            event.corrected = correctedObj;\n\n            let customPressure = null;\n            if ('pointerId' in event) {\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\n                    correctedObj.pressure = 1;\n                    customPressure = 1;\n                }\n            } else {\n                correctedObj.pointerId = 0;\n                correctedObj.pointerType = 'mouse';\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\n                customPressure = correctedObj.pressure;\n            }\n\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\n            }\n\n            let coalescedEventArr = [];\n            if ('getCoalescedEvents' in event) {\n                coalescedEventArr = event.getCoalescedEvents();\n            }\n\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\n            // so make my own\n\n            let pointerObj = getPointer(correctedObj);\n            if (pointerObj === null) {\n                pointerObj = addPointer(correctedObj);\n            }\n\n            const totalLastX = pointerObj.lastPageX;\n            const totalLastY = pointerObj.lastPageY;\n\n            for (let i = 0; i < coalescedEventArr.length; i++) {\n                const eventItem = coalescedEventArr[i];\n\n                correctedObj.coalescedArr.push({\n                    pageX: eventItem.pageX,\n                    pageY: eventItem.pageY,\n                    clientX: eventItem.clientX,\n                    clientY: eventItem.clientY,\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\n                });\n\n                pointerObj.lastPageX = eventItem.pageX;\n                pointerObj.lastPageY = eventItem.pageY;\n            }\n\n            pointerObj.lastPageX = correctedObj.pageX;\n            pointerObj.lastPageY = correctedObj.pageY;\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n\n            return correctedObj;\n\n        }\n\n        /**\n         * creates a value for onPointer, from a pointer event handler\n         *\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\n         * @param custom - object for setting custom attributes\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\n         */\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\n\n            const bounds = targetElement.getBoundingClientRect();\n            const result: any = {\n                type: typeStr,\n                pointerId: correctedEvent.pointerId,\n                pointerType: correctedEvent.pointerType,\n                pageX: correctedEvent.pageX,\n                pageY: correctedEvent.pageY,\n                clientX: correctedEvent.clientX,\n                clientY: correctedEvent.clientY,\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\n                dX: correctedEvent.movementX,\n                dY: correctedEvent.movementY,\n                time: correctedEvent.timeStamp,\n                eventPreventDefault: correctedEvent.eventPreventDefault,\n                eventStopPropagation: correctedEvent.eventStopPropagation\n            };\n\n            if (typeStr === 'pointermove') {\n                result.coalescedArr = [];\n                if (correctedEvent.coalescedArr.length > 1) {\n                    let coalescedItem;\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\n                        coalescedItem = correctedEvent.coalescedArr[i];\n                        result.coalescedArr.push({\n                            pageX: coalescedItem.pageX,\n                            pageY: coalescedItem.pageY,\n                            clientX: coalescedItem.clientX,\n                            clientY: coalescedItem.clientY,\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\n                            dX: coalescedItem.movementX,\n                            dY: coalescedItem.movementY,\n                            time: coalescedItem.timeStamp\n                        });\n                    }\n                }\n            }\n\n            if (custom) {\n                const keyArr = Object.keys(custom);\n                for (let i = 0; i < keyArr.length; i++) {\n                    result[keyArr[i]] = custom[keyArr[i]];\n                }\n            }\n\n            return result;\n        }\n\n        /**\n         * creates a value for onPointer, from a fallback touch event handler\n         *\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\n         * @param touchListItem - element from changed touch list\n         * @param touchEvent - touch event\n         * @param custom - object for setting custom attributes\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\n         */\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\n            const bounds = targetElement.getBoundingClientRect();\n            const result: any = {\n                type: typeStr,\n                pointerId: touchListItem.identifier,\n                pointerType: 'touch',\n                pageX: touchListItem.pageX,\n                pageY: touchListItem.pageY,\n                clientX: touchListItem.clientX,\n                clientY: touchListItem.clientY,\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\n                time: touchEvent.timeStamp + timeStampOffset,\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\n            };\n\n            if (typeStr === 'pointermove') {\n                result.coalescedArr = [];\n            }\n\n            const keyArr = Object.keys(custom);\n            for (let i = 0; i < keyArr.length; i++) {\n                result[keyArr[i]] = custom[keyArr[i]];\n            }\n\n            return result;\n        }\n\n        function setupDocumentListeners() {\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\n        }\n\n        function destroyDocumentListeners() {\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\n        }\n\n        let isOverCounter = 0; // might be multiple pointers\n        function onPointerEnter() {\n            isOverCounter++;\n            if (onEnterLeaveCallback) {\n                onEnterLeaveCallback(true);\n            }\n        }\n\n        function onPointerLeave() {\n            isOverCounter--;\n            if (onEnterLeaveCallback) {\n                onEnterLeaveCallback(false);\n            }\n        }\n\n        function onPointermove(event) {\n            event = correctPointerEvent(event);\n\n            const tempLastPointerType = lastPointerType;\n            lastPointerType = event.pointerType;\n\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\n                didSkip = false;\n                return;\n            }\n\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\n                didSkip = true;\n                return;\n            }\n            didSkip = false;\n\n            const outEvent = createPointerOutEvent('pointermove', event);\n            onPointerCallback(outEvent);\n\n        }\n\n        function onPointerdown(event) {\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\n                //BB.throwOut('pointerdown ignored');\n                return;\n            }\n\n\n            //set up global listeners\n            if (dragObjArr.length === 0) {\n                setupDocumentListeners();\n            }\n            const dragObj = {\n                pointerId: event.pointerId,\n                pointerType: event.pointerType,\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n                buttons: event.buttons,\n                lastPageX: event.pageX,\n                lastPageY: event.pageY,\n                lastTimeStamp: event.timeStamp\n            };\n            dragObjArr.push(dragObj);\n            setTouchTimeout(dragObj);\n            dragPointerIdArr.push(event.pointerId);\n\n            const outEvent = createPointerOutEvent('pointerdown', event, {\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n                button: buttonsToStr[event.buttons],\n                pressure: event.pressure\n            });\n\n            onPointerCallback(outEvent);\n        }\n\n\n        function onGlobalPointerMove(event) {\n            //BB.throwOut('pointermove ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\n                return;\n            }\n\n            const dragObj = getDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            //if pointer changes button its pressing -> turn into pointerup\n            if (event.buttons !== dragObj.buttons) {\n                //pointer up\n\n                //remove listener\n                if (dragObjArr.length === 1) {\n                    destroyDocumentListeners();\n                }\n                removeDragObj(event.pointerId);\n\n                const outEvent = createPointerOutEvent('pointerup', event, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY\n                });\n                onPointerCallback(outEvent);\n                return;\n\n            }\n\n            setTouchTimeout(dragObj);\n\n            // ipad likes to do this\n            if (\n                event.pointerType === 'pen' &&\n                event.pageX === dragObj.lastPageX &&\n                event.pageY === dragObj.lastPageY &&\n                event.timeStamp === dragObj.lastTimeStamp\n            ) {\n                //ignore\n                return;\n            }\n\n            const outEvent = createPointerOutEvent('pointermove', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY,\n                button: buttonsToStr[event.buttons],\n                pressure: event.pressure\n            });\n\n            dragObj.lastPageX = event.pageX;\n            dragObj.lastPageY = event.pageY;\n            dragObj.lastTimeStamp = event.timeStamp;\n\n            onPointerCallback(outEvent);\n\n        }\n\n        function onGlobalPointerUp(event) {\n            //BB.throwOut('pointerup ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\n                return;\n            }\n\n            //remove listener\n            if (dragObjArr.length === 1) {\n                destroyDocumentListeners();\n            }\n            const dragObj = removeDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            const outEvent = createPointerOutEvent('pointerup', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY\n            });\n            onPointerCallback(outEvent);\n\n        }\n\n        function onGlobalPointerLeave(event) {\n            //BB.throwOut('pointerleave ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\n                return;\n            }\n\n            //remove listener\n            if (dragObjArr.length === 1) {\n                destroyDocumentListeners();\n            }\n            const dragObj = removeDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            const outEvent = createPointerOutEvent('pointerup', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY\n            });\n            onPointerCallback(outEvent);\n        }\n\n\n        /*\n        --- ipad pointer event glitch damage control ---\n\n        ipad pointer events are glitchy. doesn't always fire pointerup.\n        - when two fingers get really close to each other\n        - when finger moves out and back in bottom\n\n        This artificially fires a pointerup\n        */\n        function onTouchTimeout(dragObj) {\n\n            //create fake event\n            const fakeEvent = {\n                pointerId: dragObj.pointerId,\n                pointerType: dragObj.pointerType,\n                type: 'pointerup',\n                timeStamp: performance.now(),\n                pageX: 0,\n                pageY: 0,\n                clientX: 0,\n                clientY: 0,\n                preventDefault: function () {\n                },\n                stopPropagation: function () {\n                }\n            };\n\n            //call onGlobalPointerUp with it\n            onGlobalPointerUp(fakeEvent);\n        }\n\n        function setTouchTimeout(dragObj) {\n            if (dragObj.pointerType !== 'touch') {\n                return;\n            }\n            dragObj.touchTimeout = setTimeout(function () {\n                onTouchTimeout(dragObj);\n            }, 2500); // 2.5 seconds\n        }\n\n        function clearTouchTimeout(dragObj) {\n            if (!dragObj.touchTimeout) {\n                return;\n            }\n            clearTimeout(dragObj.touchTimeout);\n            dragObj.touchTimeout = null;\n        }\n\n\n        if (onEnterLeaveCallback) {\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\n        }\n        if (onPointerCallback) {\n            addEventListener(targetElement, 'pointermove', onPointermove);\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\n        }\n        if (onWheelCallback) {\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\n        }\n\n\n        let onTouchstart;\n        let onTouchmove;\n        let onTouchend;\n\n        // --- touch fallback ---\n        if (!(hasPointerEvents)) {\n\n            onTouchstart = function (event) {\n                ////console.log('onTouchstart', event, event.changedTouches.length);\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\n                    const touchObj = touchArr[i];\n\n                    //set up global listeners\n                    if (dragObjArr.length === 0) {\n                        addEventListener(document, 'touchmove', onTouchmove);\n                        addEventListener(document, 'touchend', onTouchend);\n                        addEventListener(document, 'touchcancel', onTouchend);\n                    }\n                    dragObjArr.push({\n                        pointerId: touchObj.identifier,\n                        downPageX: touchObj.pageX,\n                        downPageY: touchObj.pageY,\n                        buttons: 1,\n                        lastPageX: touchObj.pageX,\n                        lastPageY: touchObj.pageY,\n                    });\n                    dragPointerIdArr.push(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\n                        dX: 0,\n                        dY: 0,\n                        downPageX: touchObj.downPageX,\n                        downPageY: touchObj.downPageY,\n                        button: 'left',\n                        pressure: 1\n                    });\n                    onPointerCallback(outEvent);\n                }\n\n            }\n\n            onTouchmove = function (event) {\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length; i++) {\n                    const touchObj = touchArr[i];\n\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\n                        continue;\n                    }\n                    const dragObj = getDragObj(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\n                        dX: touchObj.pageX - dragObj.lastPageX,\n                        dY: touchObj.pageY - dragObj.lastPageY,\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                        button: 'left',\n                        isCoalesced: false,\n                        pressure: 1\n                    });\n                    dragObj.lastPageX = touchObj.pageX;\n                    dragObj.lastPageY = touchObj.pageY;\n                    onPointerCallback(outEvent);\n\n                }\n\n            }\n\n            onTouchend = function (event) {\n                if (event.type !== 'touchcancel') {\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n                }\n\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length; i++) {\n                    const touchObj = touchArr[i];\n\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\n                        continue;\n                    }\n\n                    //remove listener\n                    if (dragObjArr.length === 1) {\n                        removeEventListener(document, 'touchmove', onTouchmove);\n                        removeEventListener(document, 'touchend', onTouchend);\n                        removeEventListener(document, 'touchcancel', onTouchend);\n                    }\n                    const dragObj = removeDragObj(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\n                        dX: touchObj.pageX - dragObj.lastPageX,\n                        dY: touchObj.pageY - dragObj.lastPageY,\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                    });\n\n                    onPointerCallback(outEvent);\n                }\n\n            }\n\n            if (onPointerCallback) {\n                addEventListener(targetElement, 'touchstart', onTouchstart);\n            }\n\n        } else if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            onTouchmove = function(e) {\n                e.preventDefault();\n            }\n            addEventListener(targetElement, 'touchmove', onTouchmove);\n\n        }\n\n\n        // --- interface ---\n\n        this.isOver = function () {\n            return isOverCounter > 0;\n        };\n\n        this.destroy = function () {\n            if (isDestroyed) {\n                return;\n            }\n            isDestroyed = true;\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\n            removeEventListener(targetElement, 'pointermove', onPointermove);\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\n            if (dragObjArr.length > 0) {\n                destroyDocumentListeners();\n            }\n\n            if (!(hasPointerEvents)) {\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\n                if (dragObjArr.length > 0) {\n                    removeEventListener(document, 'touchmove', onTouchmove);\n                    removeEventListener(document, 'touchend', onTouchend);\n                    removeEventListener(document, 'touchcancel', onTouchend);\n                }\n            } else {\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\n            }\n        };\n\n    }\n})();","import {IBounds, IVector2D} from '../BB.types';\n\nexport function mix (a: number, b: number, f: number): number {\n    return a * (1 - f) + b * f;\n}\n\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\n\nexport function lenSquared (x: number, y: number): number {\n    // faster because no square-root\n    return x * x + y * y;\n}\n\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\n\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\n}\n\nexport function clamp (num: number, min: number, max: number): number {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num;\n}\n\nexport function rotate (x: number, y: number, deg: number): IVector2D {\n    const theta = deg * (Math.PI / 180);\n    const cs = Math.cos(theta);\n    const sn = Math.sin(theta);\n\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs\n    };\n}\n\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\n\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    const dX = Math.round(remainder.x);\n    const dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX,\n        dY,\n    };\n}\n\n/**\n * return closest even number\n * @param f\n */\nexport function roundEven(f: number) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f;\n        }\n        return f + 1;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 0) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * return closest uneven number\n * @param f\n */\nexport function roundUneven(f: number) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f + 1;\n        }\n        return f;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 1) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * update target so it includes bounds\n * @param target\n * @param bounds\n */\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\n    if (!bounds) {\n        return target;\n    }\n    if (!target) {\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\n    } else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\n\n/**\n * determine overlap of bounds with width&height\n */\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\n    let x1 = Math.max(0, bounds.x1);\n    let y1 = Math.max(0, bounds.y1);\n    let x2 = Math.min(width - 1, bounds.x2);\n    let y2 = Math.min(height - 1, bounds.y2);\n    if (x1 > x2 || y1 > y2) {\n        return null;\n    }\n    return { x1, y1, x2, y2 };\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\n\n\ntype ChainOutFunc = (event?) => void;\n\n/**\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\n * each element in the chain might hold back the events, swallow them, or transform them\n *\n * p = {\n *     chainArr: ChainElement[]\n * }\n *\n * chainIn(event): null - feed an event into the chain\n * setChainOut(func): void - func(event) <- called when passed through chain\n * ^ each ChainElement needs these methods too\n *\n * @param p\n * @constructor\n */\nexport const EventChain = function (p) {\n\n    const chainArr = p.chainArr;\n    let chainOut: ChainOutFunc = () => undefined;\n\n    function continueChain(i, event) {\n        for (; i < chainArr.length; i++) {\n            event = chainArr[i].chainIn(event);\n            if (event === null) {\n                return null;\n            }\n        }\n        chainOut(event);\n        return null;\n    }\n\n    for (let i = 0; i < chainArr.length; i++) {\n        (function (i) {\n            chainArr[i].setChainOut(function (event) {\n                continueChain(i + 1, event);\n            });\n        })(i);\n    }\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        return continueChain(0, event);\n    };\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Detects double taps.\n *\n * p = {\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\n * }\n *\n * chainIn\n * setChainOut\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\n * setAllowedButtonArr(string[]): void - which buttons are allowed\n *\n * @param p\n * @constructor\n */\nexport const DoubleTapper = function (p) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    const minSilenceBeforeDurationMs = 400;\n    const maxPressedDurationMs = 300;\n    const maxPressedDistancePx = 10;\n    const maxInbetweenDistancePx = 19;\n    const maxUpToUpDurationMs = 500;\n    const maxUntilSecondDownDurationMs = 300;\n    const minSilenceAfterMs = 250;\n\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\n    let allowedButtonArr = ['left'];\n\n    let sequenceArr = [];\n    const pointersDownIdArr = [];\n    let lastUpTime = 0;\n    let nowTime = 0;\n\n    let eventQueueArr = [];\n\n\n    function fail() {\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\n            return;\n        }\n        clearTimeout(timeoutObj.fail);\n        clearTimeout(timeoutObj.maxUntilSecondDown);\n        clearTimeout(timeoutObj.success);\n        timeoutObj.fail = null;\n        timeoutObj.maxUntilSecondDown = null;\n        timeoutObj.success = null;\n\n\n        for (let i = 0; i < eventQueueArr.length; i++) {\n            chainOut(eventQueueArr[i]);\n        }\n        eventQueueArr = [];\n\n        sequenceArr = [];\n    }\n\n    // double tap achieved\n    function success() {\n        timeoutObj.fail = null;\n        timeoutObj.success = null;\n        eventQueueArr = []; // events get swallowed\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\n        sequenceArr = [];\n        p.onDoubleTap({pageX: lastSequenceItem.pageX, pageY: lastSequenceItem.pageY});\n    }\n\n\n    const timeoutObj = {\n        fail: null,\n        maxUntilSecondDown: null,\n        success: null\n    };\n\n    //returns false if time already up. otherwise sets up timeout\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\n        const diff = timeMS - nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\n        return true;\n    }\n\n\n    /**\n     * @param event object - a pointer event from BB.PointerListener\n     */\n    function processEvent(event) {\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\n            //console.log('wrong input type -> fail');\n            fail();\n            return;\n        }\n\n        nowTime = performance.now();\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\n        if (event.type === 'pointerup') {\n            lastUpTime = event.time;\n        }\n\n        if (event.type === 'pointerdown') {\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\n                //console.log('more than one pointer down -> fail');\n                fail();\n                return;\n            }\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\n                //console.log('silence-after not achieved -> fail');\n                fail();\n                return;\n            }\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\n                //console.log('silence before not achieved -> fail');\n                fail();\n                return;\n            }\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                fail();\n                return;\n            }\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\n                //console.log('jumbled -> fail');\n                fail();\n                return;\n            }\n            if (lastSequenceItem) {\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\n                    //console.log('maxInbetweenDistancePx -> reset');\n                    fail();\n\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\n                        return;\n                    }\n                }\n            }\n            sequenceArr.push({\n                isDown: true,\n                time: nowTime,\n                position: [event.pageX, event.pageY],\n                pointerId: event.pointerId\n            });\n            //maxUntilSecondDown\n\n            if (sequenceArr.length > 1) {\n                clearTimeout(timeoutObj.maxUntilSecondDown);\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                fail();\n                return;\n            }\n\n\n            clearTimeout(timeoutObj.fail);\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                fail();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                console.log('another pointer mixing in -> fail');\n                fail();\n                return;\n            }*/\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\n                //console.log('maxPressedDistancePx -> fail');\n                fail();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointerup') {\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                fail();\n                return;\n            }\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\n                fail();\n                return;\n            }\n            clearTimeout(timeoutObj.fail);\n\n            if (sequenceArr.length < 3) {\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\n                    fail();\n                    return;\n                }\n\n                sequenceArr = [\n                    lastSequenceItem,\n                    {\n                        isUp: true,\n                        time: nowTime,\n                        position: [event.pageX, event.pageY]\n                    }\n                ];\n                return;\n            }\n\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\n                // double tap almost success\n                // only needs silence\n                sequenceArr.push({\n                    pageX: event.pageX,\n                    pageY: event.pageY\n                });\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\n                    fail();\n                }\n            } else { // time up -> fail\n                fail();\n            }\n\n        }\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        processEvent(event);\n\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\n            fail();\n            return event;\n        }\n        // events might become a double tap -> queue\n        eventQueueArr.push(event);\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n    this.setAllowedPointerTypeArr = function (arr) {\n        allowedPointerTypeArr = arr;\n    };\n\n    this.setAllowedButtonArr = function (arr) {\n        allowedButtonArr = arr;\n    };\n};\n\n\n/**\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\n *\n * p = {\n *      fingers: number - number of fingers\n *      onTap: function() - fires when tap occurs\n * }\n *\n * chainIn\n * setChainOut\n *\n * @param p\n * @constructor\n */\nexport const NFingerTapper = function (p) {\n\n    const fingers = p.fingers;\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    const minSilenceBeforeDurationMs = 50; //250;\n    const maxTapMs = 500;\n    const maxFirstLastFingerDownMs = 250;\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\n    const silenceAfterDurationMs = 250;\n\n\n    /*\n        fingerObj = {\n            pointerId: number,\n            downTime: number,\n            downPageX: number,\n            downPageY: number,\n            isUp: boolean\n        }\n     */\n    let fingerArr = [];\n    let firstDownTime;\n    let eventQueueArr = [];\n    let lastEventTime = 0;\n    const pointersDownIdArr = [];\n\n    function fail() {\n        if (eventQueueArr.length === 0) {\n            return;\n        }\n        clearTimeout(timeoutObj.firstLastDownTimeout);\n        clearTimeout(timeoutObj.tapTimeout);\n        for (let i = 0; i < eventQueueArr.length; i++) {\n            chainOut(eventQueueArr[i]);\n        }\n        eventQueueArr = [];\n        fingerArr = [];\n    }\n\n    function success() {\n        clearTimeout(timeoutObj.firstLastDownTimeout);\n        clearTimeout(timeoutObj.tapTimeout);\n        eventQueueArr = []; // events get swallowed\n        fingerArr = [];\n        p.onTap();\n    }\n\n    let nowTime;\n    const timeoutObj = {\n        firstLastDownTimeout: null,\n        tapTimeout: null\n    };\n\n    function setupTimeout(timeoutStr, timeMS) {\n        const diff = timeMS - nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\n        return true;\n    }\n\n    function processEvent(event) {\n\n        const tempLastEventTime = lastEventTime;\n        lastEventTime = event.time;\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (event.pointerType !== 'touch') {\n            if (fingerArr.length > 0) { // already in gesture -> fail\n                fail();\n            }\n            return;\n        }\n\n        nowTime = performance.now();\n\n        if (event.type === 'pointerdown') {\n            //console.log('down');\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\n                fail();\n                return;\n            }\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\n                //console.log(fingers + ': too many fingers down -> fail');\n                fail();\n                return;\n            }\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                fail();\n                return;\n            }\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\n                //console.log(fingers + ': not enough silence before -> fail');\n                fail();\n                return;\n            }\n\n            if (fingerArr.length === 0) {\n                firstDownTime = event.time;\n\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\n                    fail();\n                    return;\n                }\n\n            }\n            fingerArr.push({\n                pointerId: event.pointerId,\n                downTime: event.time,\n                downPageX: event.pageX,\n                downPageY: event.pageY\n            });\n            return;\n\n        }\n\n        if (event.type === 'pointermove') {\n\n            if (fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            let fingerObj = null;\n            for (let i = 0; i < fingerArr.length; i++) {\n                if (fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\n                fail();\n                return;\n            }\n\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                fail();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\n                fail();\n                return;\n            }\n\n        }\n\n        if (event.type === 'pointerup') {\n\n            if (fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            //console.log('up', event.pageX, event.pageY);\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\n                //console.log(fingers + ': not enough fingers -> fail');\n                fail();\n                return;\n            }\n\n            let fingerObj = null;\n            let i = 0;\n            for (; i < fingerArr.length; i++) {\n                if (fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) {\n                //do nothing\n                return;\n            }\n\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                fail();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                //console.log(fingerArr);\n                fail();\n                return;\n            }\n\n            fingerObj.isUp = true;\n\n            let allAreUp = true;\n            for (let i = 0; i < fingerArr.length; i++) {\n                if (!fingerArr[i].isUp) {\n                    allAreUp = false;\n                    break;\n                }\n            }\n            //console.log('fingerArr', fingerArr);\n\n            if (allAreUp) { // success\n                success();\n                return true;\n            }\n\n        }\n\n\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        const result = processEvent(event);\n\n        //console.log(fingerArr.length);\n\n        if (result === true) {\n            //tap success -> event gets swallowed\n            return null;\n        }\n        if (fingerArr.length === 0) {\n            return event;\n        } else {\n            eventQueueArr.push(event);\n        }\n\n        return null;\n\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\n * Further pointers are ignored, but their events get swallowed during the pinching.\n * pinching ends when ALL pointers are lifted.\n * Events passed through if no pinching.\n *\n * p = {\n *      onPinch: function({type: 'end'} | {\n *          type: 'move',\n *          relX: number,\n *          relY: number,\n *          downRelX: number,\n *          downRelY: number,\n *          angleDeg: number,\n *          scale: number\n *      }) - fires when pinching occurs\n * }\n *\n * chainIn\n * setChainOut\n *\n * @param p\n * @constructor\n */\nexport const PinchZoomer = function (p) {\n\n    const firstFingerMaxDistancePx = 10;\n    const untilSecondFingerDurationMs = 250;\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    const pointersDownIdArr = [];\n    /*\n    gestureObj = {\n        touchPointerArr: Array of {\n            pointerId: number,\n            relX: number,\n            relY: number,\n            downRelX: number, // only for first\n            downRelY: number\n        },\n        otherPointerIdArr: number[],\n        isInProgress: boolean\n    }\n    */\n    let gestureObj = null;\n    let eventQueueArr = [];\n\n\n    function end() {\n        gestureObj = null;\n        eventQueueArr = [];\n    }\n\n    function fail(doSwallow?) {\n        if (!gestureObj) { // no gesture happening -> ignore\n            return;\n        }\n\n        clearTimeout(timeoutObj.secondFingerTimeout);\n        if (!doSwallow) {\n            for (let i = 0; i < eventQueueArr.length; i++) {\n                chainOut(eventQueueArr[i]);\n            }\n        }\n        end();\n    }\n\n\n    let nowTime;\n    const timeoutObj = {\n        secondFingerTimeout: null\n    };\n\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\n        const diff = timeMS - nowTime;\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\n        return true;\n    }\n\n\n    function processEvent(event) {\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        //pass through scenarios\n        if (\n            !gestureObj && (\n                event.pointerType !== 'touch' || // wrong pointer type\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\n                pointersDownIdArr.length > 1 || // failed before\n                event.type === 'pointerup' // failed before\n            )\n        ) {\n            return;\n        }\n\n        nowTime = performance.now();\n\n\n        //pointer down\n        if (event.type === 'pointerdown') {\n\n            if (gestureObj) {\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\n\n                    gestureObj.touchPointerArr.push({\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY\n                    });\n\n                    if (gestureObj.isInProgress) {\n                        continuePinch(gestureObj, {\n                            type: 'down',\n                            index: gestureObj.touchPointerArr.length - 1\n                        });\n                    } else {\n                        clearTimeout(timeoutObj.secondFingerTimeout);\n                        gestureObj.isInProgress = true;\n                        beginPinch(gestureObj);\n                    }\n                    return;\n\n                } else { // non-touch finger down - as nth pointer\n\n                    if (gestureObj.isInProgress) {\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\n                    } else { // second pointer wrong type -> fail\n                        fail();\n                    }\n                    return;\n                }\n\n\n            } else {\n                // first finger down - can only be touch if no gestureObj\n                gestureObj = {\n                    touchPointerArr: [{\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                        downRelX: event.relX,\n                        downRelY: event.relY\n                    }],\n                    otherPointerIdArr: [],\n                    isInProgress: false\n                };\n                if (!setupTimeout('secondFingerTimeout', function () {\n                    fail();\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\n                    fail();\n                    return;\n                }\n                return;\n            }\n\n        }\n\n\n        //pointer move\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\n            //gesture object should always exist here\n\n            let touchPointerObj = null;\n            let i = 0;\n            for (; i < gestureObj.touchPointerArr.length; i++) {\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\n                    touchPointerObj = gestureObj.touchPointerArr[i];\n                    break;\n                }\n            }\n\n            //null should not be possible\n\n            touchPointerObj.relX = event.relX;\n            touchPointerObj.relY = event.relY;\n\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\n                    fail();\n                    return;\n                }\n\n            } else {\n                if (i < 2) { // only first two touches can affect pinching\n                    continuePinch(gestureObj, {\n                        type: 'move',\n                        index: i\n                    });\n                }\n            }\n\n            return;\n        }\n\n\n        //pointer up\n        if (event.type === 'pointerup') {\n            //gesture object should always exist here\n\n            if (event.pointerType === 'touch') {\n                let i = 0;\n                for (; i < gestureObj.touchPointerArr.length; i++) {\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\n                        gestureObj.touchPointerArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (gestureObj.touchPointerArr.length > 0) {\n                    continuePinch(gestureObj, {\n                        type: 'up',\n                        index: i\n                    });\n                }\n\n            } else { // non-touch\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\n                        gestureObj.otherPointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n\n            //all fingers lifted?\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\n                    end();\n                    endPinch();\n                } else { // lifted finger again before pinching started -> fail\n                    fail();\n                }\n                return;\n            }\n\n        }\n\n\n    }\n\n\n    // --- actual pinch transform logic ---\n\n    let pincherArr = [];\n\n    function beginPinch(gestureObj) {\n\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\n            const pointerObj = gestureObj.touchPointerArr[i];\n            pincherArr.push({\n                pointerId: pointerObj.pointerId,\n                relX: pointerObj.relX,\n                relY: pointerObj.relY,\n                downRelX: pointerObj.relX,\n                downRelY: pointerObj.relY\n            });\n        }\n\n        const event: any = {\n            type: 'move',\n            angleRad: 0,\n            scale: 1\n        };\n\n        if (pincherArr.length === 1) {\n            event.relX = pincherArr[0].downRelX;\n            event.relY = pincherArr[0].downRelY;\n        } else {\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\n        }\n        event.downRelX = event.relX;\n        event.downRelY = event.relY;\n\n        p.onPinch(event);\n\n    }\n\n    //actionObj = {type: 'down'|'move'|'up', index: number}\n    function continuePinch(gestureObj, actionObj) {\n\n        if (actionObj.index > 1) { // only first two pointers matter\n            return;\n        }\n\n        if (actionObj.type === 'move') {\n\n            let event;\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\n\n            if (pincherArr.length === 1) {\n\n                event = {\n                    type: 'move',\n                    downRelX: pincherArr[0].downRelX,\n                    downRelY: pincherArr[0].downRelY,\n                    relX: pincherArr[0].relX,\n                    relY: pincherArr[0].relY,\n                    angleRad: 0,\n                    scale: 1\n                };\n\n            } else {\n\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\n\n                const startAngle = pointsToAngleRad({\n                    x: pincherArr[0].downRelX,\n                    y: pincherArr[0].downRelY\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\n                const angle = pointsToAngleRad({\n                    x: pincherArr[0].relX,\n                    y: pincherArr[0].relY\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\n\n                event = {\n                    type: 'move',\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\n                    angleRad: angle - startAngle,\n                    scale: distance / startDist\n                };\n\n            }\n\n            p.onPinch(event);\n\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\n            endPinch();\n            beginPinch(gestureObj);\n        }\n\n    }\n\n    function endPinch() {\n        pincherArr = [];\n        p.onPinch({\n            type: 'end'\n        });\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        processEvent(event);\n        if (gestureObj) {\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\n                eventQueueArr.push(event);\n            }\n        } else {\n            return event;\n        }\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\n *\n * @constructor\n */\nexport const CoalescedExploder = function () {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        if (event.type === 'pointermove') {\n\n            if (event.coalescedArr.length > 0) {\n\n                let eventCopy = JSON.parse(JSON.stringify(event));\n                eventCopy.coalescedArr = [];\n                let coalescedItem;\n\n                for (let i = 0; i < event.coalescedArr.length; i++) {\n\n                    if (i > 0) {\n                        eventCopy = JSON.parse(JSON.stringify(event));\n                    }\n                    coalescedItem = event.coalescedArr[i];\n\n                    eventCopy.pageX = coalescedItem.pageX;\n                    eventCopy.pageY = coalescedItem.pageY;\n                    eventCopy.relX = coalescedItem.relX;\n                    eventCopy.relY = coalescedItem.relY;\n                    eventCopy.dX = coalescedItem.dX;\n                    eventCopy.dY = coalescedItem.dY;\n                    eventCopy.time = coalescedItem.time;\n                    if (i < event.coalescedArr.length - 1) {\n                        eventCopy.isCoalesced = true;\n                    }\n\n                    chainOut(eventCopy);\n                }\n\n            } else {\n                return event;\n            }\n        } else {\n            return event;\n        }\n\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\nexport const OnePointerLimiter = function (pointers?) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    let downPointerId = null;\n    const ignorePointerIdArr = [];\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        if (ignorePointerIdArr.includes(event.pointerId)) {\n            if (event.type === 'pointerup') {\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\n                    if (ignorePointerIdArr[i] === event.pointerId) {\n                        ignorePointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n            return null;\n        }\n\n        if (downPointerId === null) {\n            if (event.type === 'pointerdown') {\n                downPointerId = event.pointerId;\n            }\n            return event;\n\n        } else {\n            if (event.pointerId !== downPointerId) {\n                if (event.type === 'pointerdown') {\n                    ignorePointerIdArr.push(event.pointerId);\n                }\n                return null;\n            }\n            if (event.type === 'pointerup') {\n                downPointerId = null;\n            }\n            return event;\n        }\n\n        return null;\n\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n};\n\n\n/**\n * Not really and event chain element. but pretty similar.\n *\n * Processes draw input events. When shift held -> linetool\n * line events - what KlCanvasWorkspace passes onDraw(e)\n *\n * p = {\n *     onDraw: function(drawEvent)\n * }\n *\n * pass input in with process(drawEvent)\n *\n * modifies draw event to include such events:\n * {\n *     type: 'line',\n *     x0: null, // you have to fill that in\n *     y0: null, // you have to fill that in\n *     pressure0: null, // you have to fill that in\n *     x1: number,\n *     y1: number,\n *     pressure1: number\n * }\n *\n * @param p\n * @constructor\n */\nexport const LinetoolProcessor = function (p) {\n\n    let downEvent = null;\n    let eventQueue = [];\n    let direction = null;\n    const DIR_X = 0, DIR_Y = 1;\n\n    this.process = function (event) {\n        if (event.type === 'down') {\n            downEvent = event;\n            direction = null;\n\n            if (event.shiftIsPressed) {\n\n                p.onDraw({\n                    type: 'line',\n                    x0: null,\n                    y0: null,\n                    pressure0: null,\n                    x1: event.x,\n                    y1: event.y,\n                    pressure1: event.pressure\n                });\n\n                eventQueue.push(event);\n                return;\n            }\n\n        }\n\n        if (event.type === 'move') {\n\n            if (event.shiftIsPressed) {\n\n                if (direction === null) {\n                    const dX = Math.abs(event.x - downEvent.x);\n                    const dY = Math.abs(event.y - downEvent.y);\n\n                    if (dX > 5 || dY > 5) {\n                        direction = dX > dY ? DIR_X : DIR_Y;\n\n                        for (let i = 0; i < eventQueue.length; i++) {\n                            const e = eventQueue[i];\n                            if (direction === DIR_X) {\n                                e.y = downEvent.y;\n                            } else {\n                                e.x = downEvent.x;\n                            }\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\n                        }\n                        eventQueue = [];\n                    }\n                }\n\n                if (direction === null) {\n                    eventQueue.push(event);\n                    return;\n                }\n\n                if (direction === DIR_X) {\n                    event.y = downEvent.y;\n                } else {\n                    event.x = downEvent.x;\n                }\n\n            } else {\n                if (eventQueue.length > 0) {\n                    for (let i = 0; i < eventQueue.length; i++) {\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\n                    }\n                    eventQueue = [];\n                }\n            }\n\n        }\n\n        if (event.type === 'up') {\n            eventQueue = [];\n        }\n\n        p.onDraw(JSON.parse(JSON.stringify(event)));\n    };\n};\n\n\n/**\n * cleans up DrawEvents. More trustworthy events. EventChain element\n *\n * that events can only go line this: down -> n x move -> up\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\n * @constructor\n */\nexport const LineSanitizer = function () {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    let isDrawing = false;\n\n    // --- interface ---\n    this.chainIn = function (event) {\n\n        if (event.type === 'down') {\n            if (isDrawing) {\n                //console.log('line sanitizer - down, but already drawing');\n                chainOut({\n                    type: 'up',\n                    scale: event.scale,\n                    shiftIsPressed: event.shiftIsPressed,\n                    isCoalesced: false\n                });\n            } else {\n                isDrawing = true;\n            }\n        }\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\n            return null;\n        }\n\n        if (event.type === 'up' && isDrawing) {\n            isDrawing = false;\n        }\n\n        return event;\n    };\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n    this.getIsDrawing = function () {\n        return isDrawing;\n    };\n};\n\n\n/**\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\n * for onDraw events from KlCanvasWorkspace.\n *\n * p = {\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\n * }\n *\n * smoothing > 0: will fire DrawEvents in interval when no new move events\n *\n * type: 'line' Events are just passed through.\n *\n * @param p\n * @constructor\n */\nexport const LineSmoothing = function (p) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    let smoothing = clamp(p.smoothing, 0, 1);\n    let lastMixedInput;\n    let interval;\n    let timeout;\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        event = JSON.parse(JSON.stringify(event));\n        clearTimeout(timeout);\n        clearInterval(interval);\n\n        if (event.type === 'down') {\n            lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure\n            };\n        }\n\n        if (event.type === 'move') {\n\n            const inputX = event.x;\n            const inputY = event.y;\n            const inputPressure = event.pressure;\n\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\n            lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure\n            };\n\n            if (smoothing > 0) {\n                timeout = setTimeout(function () {\n                    interval = setInterval(function () {\n                        event = JSON.parse(JSON.stringify(event));\n\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\n                        lastMixedInput = {\n                            x: event.x,\n                            y: event.y,\n                            pressure: event.pressure\n                        };\n\n                        chainOut(event);\n                    }, 35);\n                }, 80);\n            }\n\n        }\n\n        return event;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n    this.setSmoothing = function (s) {\n        smoothing = clamp(s, 0, 1);\n    };\n};\n","import {IKeyString} from '../BB.types';\nimport {createCanvas} from './create-canvas';\n\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\n    const ctx = resultCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\n\n/**\n * Determine if should disable imageSmoothing for transformation.\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\n */\nexport function testShouldPixelate(\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\n    scaleX: number,\n    scaleY: number,\n): boolean {\n    if (\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\n        Math.abs(transform.angleDeg) % 90 !== 0\n    ) {\n        return false;\n    }\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    const width = whSwapped ? transform.height : transform.width;\n    const height = whSwapped ? transform.width : transform.height;\n    return (\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\n        ) &&\n        (\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\n        );\n}\n\n\n/**\n * @param destCtx - the canvas that will be drawn on\n * @param transformImage - image that will be drawn on canvas\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\n * @param pixelated\n */\nexport function drawTransformedImageWithBounds(\n    destCtx: CanvasRenderingContext2D,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\n    bounds?: {x: number, y: number, width: number, height: number},\n    pixelated?: boolean,\n): void {\n    if (!bounds) {\n        bounds = {\n            x: 0,\n            y: 0,\n            width: transformImage.width,\n            height: transformImage.height\n        };\n    }\n\n    destCtx.save();\n    if (pixelated) {\n        destCtx.imageSmoothingEnabled = false;\n    } else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = 'high';\n    }\n\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(\n        transformImage,\n        bounds.x, bounds.y, bounds.width, bounds.height,\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\n\n    destCtx.restore();\n}\n\n/**\n * all transformations are optional\n * center is the point around which will be scaled and rotated\n *\n * @param baseCanvas canvas - the canvas that will be drawn on\n * @param transformImage image|canvas - image that will be drawn on canvas\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\n */\nexport function drawTransformedImageOnCanvas(\n    baseCanvas: HTMLCanvasElement,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transformObj: {\n        center: {x: number, y: number},\n        scale: {x: number, y: number},\n        translate: {x: number, y: number},\n        angleDegree: number,\n    },\n): void {\n    transformObj = JSON.parse(JSON.stringify(transformObj));\n    if (!transformObj.center) {\n        transformObj.center = {\n            x: transformImage.width / 2,\n            y: transformImage.height / 2\n        }\n    }\n    if (!transformObj.scale) {\n        transformObj.scale = {\n            x: 1,\n            y: 1\n        };\n    }\n    if (!transformObj.angleDegree) {\n        transformObj.angleDegree = 0;\n    }\n    if (!transformObj.translate) {\n        transformObj.translate = {\n            x: 0,\n            y: 0\n        };\n    }\n\n    const ctx = baseCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.save();\n    if (\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\n    ) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n    } else {\n        ctx.imageSmoothingEnabled = false;\n    }\n\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n\n    ctx.restore();\n}\n\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\n    const canvas = createCanvas();\n    let ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(128, 128, 128)';\n        ctx.fillRect(0, 0, 1, 1);\n    } else if (size > 200) {\n        canvas.width = 401;\n        canvas.height = 401;\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(255, 255, 255)';\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = 'rgb(200, 200, 200)';\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\n\nexport const createCheckerDataUrl = (function () {\n    const cache: IKeyString = { // previously created dataUrls\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\n    };\n\n    return function (size: number, callback?: (s: string) => void) {\n        function create(size: number): string {\n            size = parseInt('' + size);\n            if (cache['' + size]) {\n                return cache['' + size];\n            }\n            const canvas = createCheckerCanvas(size);\n            const result = canvas.toDataURL('image/png');\n            cache['' + size] = result;\n            return result;\n        }\n\n        if (callback) { //async\n            setTimeout(function () {\n                callback(create(size));\n            }, 1);\n        } else { //sync\n            return create(size);\n        }\n    };\n})();\n\n/**\n * smooth resize image\n * @param canvas canvas - will be resized (modified)\n * @param w\n * @param h\n * @param tmp1 canvas - optional, provide to save resources\n * @param tmp2 canvas - optional, provide to save resources\n */\nexport function resizeCanvas(\n    canvas: HTMLCanvasElement,\n    w: number,\n    h: number,\n    tmp1?: HTMLCanvasElement,\n    tmp2?: HTMLCanvasElement,\n): void {\n\n    //determine base 2 exponents of old and new size\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\n        const result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH))\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    }\n\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\n        return;\n    }\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\n\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext('2d')!.save();\n        tmp2.getContext('2d')!.save();\n\n        let ew, eh;\n        let buffer1 = tmp1, buffer2 = tmp2;\n\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n\n        let bufferCtx = buffer2.getContext('2d')!;\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality  = 'high';\n        bufferCtx.globalCompositeOperation  = 'copy';\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n\n        let currentWidth = buffer2.width;\n        let currentHeight = buffer2.height;\n\n        //stepwise half the size\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\n            bufferCtx = buffer1.getContext('2d')!;\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality  = 'high';\n            bufferCtx.globalCompositeOperation  = 'copy';\n\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\n\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n\n            bufferCtx.drawImage(\n                buffer2,\n                0, 0,\n                currentWidth, currentHeight,\n                0, 0,\n                newWidth, newHeight\n            );\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n\n            //swap\n            const tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        const canvasCtx = canvas.getContext('2d')!;\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality  = 'high';\n        canvasCtx.drawImage(\n            buffer2,\n            0, 0,\n            currentWidth, currentHeight,\n            0, 0,\n            w, h\n        );\n        canvasCtx.restore();\n        tmp1.getContext('2d')!.restore();\n        tmp2.getContext('2d')!.restore();\n\n    } else if (w >= canvas.width && h >= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        const tmp1Ctx = tmp1.getContext('2d')!;\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality  = 'high';\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\n\n    } else {\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\n    }\n}\n\n/**\n * puts naive greyscale version of image into alpha channel.\n * only writes a, doesn't write rgb\n * @param canvas\n */\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\n    for (let i = 0; i < imdat.data.length; i += 4) {\n        if (imdat.data[i + 3] === 0) {\n            continue;\n        }\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\n}\n\n/**\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\n * or there is a hard to fix memory leak.\n * This function manually makes the canvas use as little memory as possible.\n */\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext('2d');\n    ctx && ctx.clearRect(0, 0, 1, 1);\n}","export const Matrix = (function () {\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n    // yes not optimized - but it's not used for physics simulations.\n\n    // const perfTotal = 0;\n\n    // point • matrix\n    function multiplyMatrixAndPoint(matrix, point) {\n        const result = [\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\n        ];\n        return result;\n    }\n\n    //matrixB • matrixA\n    function multiplyMatrices(matrixA, matrixB) {\n\n        // Slice the second matrix up into rows\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\n\n        // Multiply each row by matrixA\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\n\n        // Turn the result rows back into a single matrix\n        return [\n            result0[0], result0[1], result0[2], result0[3],\n            result1[0], result1[1], result1[2], result1[3],\n            result2[0], result2[1], result2[2], result2[3],\n            result3[0], result3[1], result3[2], result3[3]\n        ];\n    }\n\n    function createTranslationMatrix(x, y) {\n        return [\n            1, 0, 0, 0,\n            0, 1, 0, 0,\n            0, 0, 1, 0,\n            x, y, 0, 1\n        ];\n    }\n\n    function createRotationMatrix(angleRad) {\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\n        return [\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\n            0, 0, 1, 0,\n            0, 0, 0, 1\n        ];\n    }\n\n    function createScaleMatrix(f) {\n        return [\n            f, 0, 0, 0,\n            0, f, 0, 0,\n            0, 0, 1, 0,\n            0, 0, 0, 1\n        ];\n    }\n\n    return {\n        getIdentity: function () {\n            return [\n                1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            ];\n        },\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\n        multiplyMatrices: multiplyMatrices,\n        createTranslationMatrix: createTranslationMatrix,\n        createRotationMatrix: createRotationMatrix,\n        createScaleMatrix: createScaleMatrix\n    };\n})();","import {IVector2D} from '../BB.types';\n\nexport const Vec2 = {\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\n    },\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\n    },\n    nor: function (p: IVector2D): IVector2D {\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return {x: p.x / len, y: p.y / len};\n    },\n    len: function (p: IVector2D): number {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function (p1: IVector2D, p2: IVector2D): number {\n        return Vec2.len(Vec2.sub(p1, p2));\n    },\n    mul: function (p: IVector2D, s: number): IVector2D {\n        return {x: p.x * s, y: p.y * s};\n    },\n    angle: function (p1: IVector2D, p2: IVector2D): number {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function(a: IVector2D, b: IVector2D): number {\n        const aArr = [a.x, a.y];\n        const bArr = [b.x, b.y];\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\n    }\n};","import {Vec2} from './vec2';\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\nimport {IVector2D} from \"../bb.types\";\n\n/**\n * project p onto line\n * @param lineStart\n * @param lineEnd\n * @param p\n */\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\n    let x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n\n        return {\n            x: x,\n            y: y\n        };\n    }\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    const b = lineStart.y - (m * lineStart.x);\n\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n\n    return {\n        x: x,\n        y: y\n    };\n};\n\n\n\n/**\n * Operations on a line made up of points\n *\n * getAtDist(dist) - point when traveling *dist* along the line\n * getLength - gives you total length of line\n *\n * @param params object - {points: [{x:float, y:float}, ...]}\n * @constructor\n */\nexport const PointLine = function (params) {\n    const segmentArr = [];\n    const _this = this;\n\n    for (let i = 0; i < params.points.length; i++) {\n        (function (i) {\n            let length = undefined;\n            if (i < params.points.length - 1) {\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\n            }\n            segmentArr[i] = {\n                x: params.points[i].x,\n                y: params.points[i].y,\n                length: length\n            };\n        })(i);\n    }\n\n    /**\n     * @param dist number - distance in pixels, > 0\n     * @returns {{x: number, y: number}}\n     */\n    this.getAtDist = function (dist) {\n        let remainder = Math.min(_this.getLength(), dist);\n        let i = 0;\n\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\n            remainder -= segmentArr[i].length;\n        }\n\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\n\n        return {\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\n        };\n    };\n    this.getLength = function () {\n        let result = 0;\n        for (let i = 0; i < segmentArr.length - 1; i++) {\n            result += segmentArr[i].length;\n        }\n        return result;\n    };\n};\n\n/**\n * Each instance is one line made up of bezier interpolated segments.\n * You feed it points. It calculates control points on its own, and the resulting curve.\n *\n * @constructor\n */\nexport const BezierLine = function () {\n    const _this = this;\n    const pointArr = [];\n    let lastDot = 0;\n    let lastPoint;\n    let lastCallbackPoint;\n    let lastAngle;\n    let lastSpacing = null;\n\n    /**\n     * creates bezier curve from control points\n     *\n     * @param p1 - control point 1 {x: float, y: float}\n     * @param p2 - control point 2 {x: float, y: float}\n     * @param p3 - control point 3 {x: float, y: float}\n     * @param p4 - control point 4 {x: float, y: float}\n     * @param resolution - int\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\n     */\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\n        const curvePoints = [];\n        let t, result;\n        for (let i = 0; i <= resolution; i++) {\n            t = i / resolution;\n            result = {};\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\n            curvePoints[curvePoints.length] = result;\n        }\n        return curvePoints;\n    }\n\n    /**\n     *\n     * add now point to line\n     * line will go until the previous point\n     *\n     * @param x - coord of new point\n     * @param y - coord of new point\n     * @param spacing - space between each step\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\n     */\n    this.add = function (x, y, spacing, callback, controlsCallback) {\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\n            return;\n        }\n        lastPoint = {x: x, y: y};\n        pointArr[pointArr.length] = {\n            x: x,\n            y: y,\n            spacing: spacing\n        };\n\n        //calculate directions\n        if (pointArr.length === 1) {\n            lastSpacing = spacing;\n            return;\n        } else if (pointArr.length === 2) {\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\n            lastDot = spacing;\n            lastSpacing = spacing;\n            return;\n        } else {\n            const pointM1 = pointArr[pointArr.length - 1];\n            const pointM2 = pointArr[pointArr.length - 2];\n            const pointM3 = pointArr[pointArr.length - 3];\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\n                //when xy -3 == -1\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\n            }\n        }\n\n        //get bezier curve\n        const a = pointArr[pointArr.length - 3];\n        const b = pointArr[pointArr.length - 2];\n        const p1 = a;\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\n        const p4 = b;\n\n\n        let pointLine;\n        if (callback) {\n            let curvePoints;\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\n            pointLine = new PointLine({points: curvePoints});\n        } else {\n            pointLine = new PointLine({points: [p1, p4]});\n        }\n\n        //interate over curve with spacing and callback\n        const len = pointLine.getLength();\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\n        let d = lastDot;\n        for (; d <= len; d += tempSpacing) {\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\n            const point = pointLine.getAtDist(d);\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\n            if (callback) {\n                callback({\n                    x: point.x,\n                    y: point.y,\n                    t: d / len,\n                    angle: angle,\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\n                });\n            }\n            lastCallbackPoint = point;\n            lastAngle = angle;\n        }\n\n        if (callback) {\n            lastDot = d - len;\n        } else {\n            lastDot = 0;\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\n        }\n\n        lastSpacing = spacing;\n    };\n\n    this.addFinal = function(spacing, callback, controlsCallback) {\n        if (pointArr.length < 2) {\n            return;\n        }\n\n        const p1 = pointArr[pointArr.length - 2];\n        const p2 = pointArr[pointArr.length - 1];\n\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\n\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n    };\n\n};\n\n/**\n * from glfx.script by evanW:\n * from SplineInterpolator.cs in the Paint.NET source code\n *\n * points go 0 - 1. I think.\n *\n * @param points\n * @constructor\n */\nexport const SplineInterpolator = function (points) {\n    const n = points.length;\n    this.xa = [];\n    this.ya = [];\n    this.u = [];\n    this.y2 = [];\n    let i;\n\n    const first = points[0][0];\n    const last = points[points.length - 1][0];\n\n    points.sort(function (a, b) {\n        return a[0] - b[0];\n    });\n    for (i = 0; i < n; i++) {\n        this.xa.push(points[i][0]);\n        this.ya.push(points[i][1]);\n    }\n\n    this.u[0] = 0;\n    this.y2[0] = 0;\n\n    for (i = 1; i < n - 1; ++i) {\n        // This is the decomposition loop of the tridiagonal algorithm.\n        // y2 and u are used for temporary storage of the decomposed factors.\n        const wx = this.xa[i + 1] - this.xa[i - 1];\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n        const p = sig * this.y2[i - 1] + 2.0;\n\n        this.y2[i] = (sig - 1.0) / p;\n\n        const ddydx =\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n    }\n\n    this.y2[n - 1] = 0;\n\n    // This is the backsubstitution loop of the tridiagonal algorithm\n    for (i = n - 2; i >= 0; --i) {\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n\n    this.getFirstX = function () {\n        return first;\n    };\n    this.getLastX = function () {\n        return last;\n    };\n};\n\nSplineInterpolator.prototype.interpolate = function (x) {\n    const n = this.ya.length;\n    let klo = 0;\n    let khi = n - 1;\n\n    // We will find the right place in the table by means of\n    // bisection. This is optimal if sequential calls to this\n    // routine are at random values of x. If sequential calls\n    // are in order, and closely spaced, one would do better\n    // to store previous values of klo and khi.\n    while (khi - klo > 1) {\n        const k = (khi + klo) >> 1;\n\n        if (this.xa[k] > x) {\n            khi = k;\n        } else {\n            klo = k;\n        }\n    }\n\n    const h = this.xa[khi] - this.xa[klo];\n    const a = (this.xa[khi] - x) / h;\n    const b = (x - this.xa[klo]) / h;\n\n    // Cubic spline polynomial is now evaluated.\n    return a * this.ya[klo] + b * this.ya[khi] +\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n};\n\n/**\n * find x to y. simply by stepping through. suboptimal, so don't call often.\n * searches in x 0-1 range\n *\n * @param y\n * @param resolution\n */\nSplineInterpolator.prototype.findX = function (y, resolution) {\n    let x = null;\n    let dist = null;\n    for (let i = 0; i <= resolution; i++) {\n        const tempX = i / resolution;\n        const tempY = this.interpolate(tempX);\n        if (x === null) {\n            x = tempX;\n            dist = Math.abs(tempY - y);\n            continue;\n        }\n\n        const tempDist = Math.abs(tempY - y);\n\n        if (tempDist < dist) {\n            x = tempX;\n            dist = tempDist;\n        } else {\n            //distance increasing\n            break;\n        }\n    }\n    return x;\n};\n\n/**\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\n * returns [[0, startVal], ..., [1, endVal]]\n * @param startVal\n * @param endVal\n * @param stepSize\n * @returns {[]}\n */\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\n    function round(v, dec) {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    }\n\n    const resultArr = [];\n    for (let i = 0; i <= 1; i += stepSize) {\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\n    }\n    return resultArr;\n};","\n\n\n// based on js color conversion http://www.webtoolkit.info/\n\n\nexport class HSV {\n    h: number;\n    s: number;\n    v: number;\n    constructor(h: number, s: number, v: number) {\n        this.h = Math.max(0, Math.min(360, h));\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n        this.v = Math.max(0, Math.min(100, v));\n    }\n}\n\nexport class RGB {\n    r : number;\n    g: number;\n    b: number;\n    constructor(r: number, g: number, b: number) {\n        this.r = Math.max(0, Math.min(255, r));\n        this.g = Math.max(0, Math.min(255, g));\n        this.b = Math.max(0, Math.min(255, b));\n    }\n}\n\nexport class CMYK {\n    c: number;\n    m: number;\n    y: number;\n    k: number;\n    constructor(c: number, m: number, y: number, k: number) {\n        this.c = Math.max(0, Math.min(100, c));\n        this.m = Math.max(0, Math.min(100, m));\n        this.y = Math.max(0, Math.min(100, y));\n        this.k = Math.max(0, Math.min(100, k));\n    }\n}\n\nexport const ColorConverter = {\n\n    _RGBtoHSV: function (RGB: RGB): HSV {\n        const result = new HSV(0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        const minVal = Math.min(r, g, b);\n        const maxVal = Math.max(r, g, b);\n        const delta = maxVal - minVal;\n\n        result.v = maxVal;\n\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\n\n            if (r == maxVal) {\n                result.h = del_B - del_G;\n            } else if (g == maxVal) {\n                result.h = (1 / 3) + del_R - del_B;\n            } else if (b == maxVal) {\n                result.h = (2 / 3) + del_G - del_R;\n            }\n\n            if (result.h < 0) {\n                result.h += 1;\n            }\n            if (result.h > 1) {\n                result.h -= 1;\n            }\n        }\n\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n\n        return result;\n    },\n\n    _HSVtoRGB: function (HSV: HSV): RGB {\n        const result = new RGB(0, 0, 0);\n\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n\n        const h = (HSV.h / 360) % 1;\n        const s = HSV.s / 100;\n        const v = HSV.v / 100;\n\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2\n            }\n\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n\n        return result;\n    },\n\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\n        const result = new RGB(0, 0, 0);\n\n        const c = CMYK.c / 100;\n        const m = CMYK.m / 100;\n        const y = CMYK.y / 100;\n        const k = CMYK.k / 100;\n\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n\n        return result;\n    },\n\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\n        const result = new CMYK(0, 0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n\n        return result;\n    },\n\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\n        if (o instanceof RGB) {\n            return o;\n        }\n        if (o instanceof HSV) {\n            return this._HSVtoRGB(o);\n        }\n        if (o instanceof CMYK) {\n            return this._CMYKtoRGB(o);\n        }\n    },\n\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\n        if (o instanceof HSV) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoHSV(o);\n        }\n        if (o instanceof CMYK) {\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\n        }\n    },\n\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\n        if (o instanceof CMYK) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoCMYK(o);\n        }\n        if (o instanceof HSV) {\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\n        }\n    },\n    toHexString: function (o: RGB): string {\n        if (o instanceof RGB) {\n            let ha = (parseInt('' + o.r)).toString(16);\n            let hb = (parseInt('' + o.g)).toString(16);\n            let hc = (parseInt('' + o.b)).toString(16);\n            if (ha.length == 1)\n                ha = '0' + ha;\n            if (hb.length == 1)\n                hb = '0' + hb;\n            if (hc.length == 1)\n                hc = '0' + hc;\n            return ha + hb + hc;\n        }\n    },\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\n    },\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\n    },\n    hexToRGB: function(hexStr: string): RGB | null {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result ? new RGB(\n            parseInt(result[1], 16),\n            parseInt(result[2], 16),\n            parseInt(result[3], 16)\n        ) : null;\n    }\n\n};\n\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\n}","import {addEventListener} from '../input/event-listener';\nimport {css} from './base';\nimport {BB} from '../bb';\n\n\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\n    const div = document.createElement('div');\n    div.innerHTML = text;\n    target.appendChild(div);\n    return div;\n}\n\n/**\n * Is an input element focused.\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\n *\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\n */\nexport function isInputFocused(getAll: boolean = false): boolean {\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\n    if (getAll) {\n        return result;\n    } else {\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\n    }\n}\n\n/**\n * clears text selection in window\n */\nexport function clearSelection(): void {\n    if (window.getSelection) {\n        const sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) {\n                sel.empty();\n            } else if (sel.removeAllRanges) {\n                sel.removeAllRanges();\n            }\n        }\n    } else if ('selection' in document) {\n        (document as any).selection.empty();\n    }\n}\n\n/**\n * prevents being able to focus element.\n * warning: it creates a listener\n *\n * @param el - dom element\n */\nexport const makeUnfocusable = (function() {\n\n    function preventFocus(event: MouseEvent) {\n        event.preventDefault();\n        let didFocusRelated = false;\n        if (event.relatedTarget) {\n            try {\n                (event.relatedTarget as HTMLElement).focus();\n                didFocusRelated = true;\n            } catch(e) {\n                console.error('failed to focus');\n            }\n        }\n        if (!didFocusRelated) {\n            (event.currentTarget as HTMLElement).blur();\n        }\n    }\n\n    return function(el) {\n        el.setAttribute('tabindex', '-1');\n        addEventListener(el, 'focus', preventFocus);\n    };\n})();\n\n\nconst els: {\n    el: HTMLElement;\n    listeners: [string, any][];\n}[] = [];\n// window['els'] = els;\n\n/**\n *\n * Create DOM element - div by default\n * params = {\n * \t    parent: someOtherDiv,\n * \t    css: {\n * \t\t    width: \"500px\",\n * \t\t    backgroundColor: \"#fff\"\n * \t    },\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\n * \t    className: \"bla\",\n *      id: \"bla\"\n * }\n *\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\n *  to prevent a memory leak.\n *\n * @param params\n */\nexport function el(\n    params: {\n        parent?: HTMLElement,\n        css?: { [key: string]: string },\n        custom?: { [key: string]: any },\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\n        textContent?: string,\n        className?: string,\n        title?: string,\n        id?: string,\n        tagName?: string,\n        onClick?: (e: Event) => void,\n        onChange?: (e: Event) => void,\n    }\n): HTMLElement {\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\n    if (params.css) {\n        css(div, params.css);\n    }\n\n    if (params.content) {\n        if (typeof params.content === typeof 'aa') {\n            div.innerHTML = params.content as string;\n\n        } else if (Array.isArray(params.content)) {\n            BB.append(div, params.content);\n\n        } else {\n            div.appendChild(params.content as HTMLElement);\n\n        }\n    }\n    if (params.textContent) {\n        div.textContent = params.textContent;\n    }\n    if (params.className) {\n        div.className = params.className;\n    }\n    if (params.id) {\n        div.id = params.id;\n    }\n    if (params.parent) {\n        params.parent.appendChild(div);\n    }\n    if ('title' in params && params.title !== undefined) {\n        div.title = params.title;\n    }\n    const listeners = [];\n    if ('onClick' in params) {\n        addEventListener(div, 'click', params.onClick);\n        listeners.push(['click', params.onClick]);\n    }\n    if ('onChange' in params) {\n        addEventListener(div, 'change', params.onChange);\n        listeners.push(['change', params.onChange]);\n    }\n    if (listeners.length > 0) {\n        els.push({\n            el: div,\n            listeners: listeners,\n        })\n        /*div.style.backgroundColor = '#ff0';\n        div.style.border = '1px solid #ff0';*/\n    }\n    if ('custom' in params) {\n        const customKeyArr = Object.keys(params.custom);\n        for (let i = 0; i < customKeyArr.length; i++) {\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n        }\n    }\n    return div;\n}\n\n/**\n * removes event listeners for Elements created via el()\n * @param el\n */\nexport function destroyEl(el: HTMLElement) {\n    for (let i = 0; i < els.length; i++) {\n        const item = els[i];\n        if (item.el === el) {\n            item.listeners.forEach(item => {\n                el.removeEventListener(item[0], item[1]);\n            });\n            els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n","\nexport class BbLog {\n\n    private static listeners: any[] = [];\n\n    constructor() {\n    }\n\n    static subscribe(listener) {\n        if (BbLog.listeners.includes(listener)) {\n            return;\n        }\n        BbLog.listeners.push(listener);\n    }\n\n    static unsubscribe(listener) {\n        for (let i = 0; i < BbLog.listeners.length; i++) {\n            if (listener === BbLog.listeners[i]) {\n                BbLog.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    static emit (msg) {\n        BbLog.listeners.forEach(item => {\n            item(msg);\n        });\n    }\n}","/**\n * LocalStorage wrapper that does not throw exceptions.\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\n */\nexport class LocalStorage {\n\n    private static error;\n\n    static getItem (key: string): string {\n        let result = null;\n        try {\n            result = localStorage.getItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n        return result;\n    }\n\n    static setItem (key: string, value: string): void {\n        try {\n            localStorage.setItem(key, value);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static removeItem (key: string): void {\n        try {\n            localStorage.removeItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static getError (): any {\n        return this.error;\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5xzTI\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"b07cq\");","import {BB} from '../../../bb/bb';\n\n/**\n * Checkbox - with label\n */\nexport class Checkbox {\n\n    private element: HTMLElement;\n    private check: HTMLInputElement;\n\n    // --- public ---\n\n    constructor (params: {\n        init?: boolean; // default false\n        label: string;\n        callback: (boolean) => void;\n        allowTab?: boolean; // default false\n        title?: string;\n        doHighlight?: boolean; // default false\n        css?: any;\n    }) {\n        this.element = BB.el({\n            className: 'kl-checkbox'\n        });\n\n        const innerEl = BB.el({\n            parent: this.element,\n            tagName: 'label',\n            className: 'kl-checkbox__inner'\n        });\n\n        this.check = BB.el({\n            parent: innerEl,\n            tagName: 'input',\n            css: {\n                marginLeft: '0',\n                display: 'inline-block'\n            },\n            custom: {\n                type: 'checkbox'\n            }\n        }) as HTMLInputElement;\n        this.check.checked = params.init;\n        if (params.doHighlight && this.check.checked) {\n            BB.addClassName(this.element, 'kl-checkbox--highlight');\n        }\n        if (!params.allowTab) {\n            this.check.tabIndex = -1;\n        }\n\n        if (params.title) {\n            innerEl.title = params.title;\n        }\n\n        const label = document.createElement('div');\n        label.style.display = 'inline-block';\n        label.innerHTML = params.label;\n        (label as any).allowClick = true;\n        innerEl.appendChild(label);\n\n        this.check.onchange = () => {\n            if (params.doHighlight) {\n                if (this.check.checked) {\n                    BB.addClassName(this.element, 'kl-checkbox--highlight');\n                } else {\n                    BB.removeClassName(this.element, 'kl-checkbox--highlight');\n                }\n            }\n            params.callback(this.check.checked);\n            setTimeout(() => {\n                this.check.blur();\n            }, 0);\n        };\n        if (params.css) {\n            BB.css(this.element, params.css);\n        }\n    }\n\n    getValue(): boolean {\n        return this.check.checked;\n    }\n\n    getElement(): HTMLElement {\n        return this.element;\n    }\n\n    destroy() {\n        this.check.onchange = null;\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb.types';\n\nexport const input = function (params: {\n    type?: 'button' | 'checkbox' | 'number' | 'text'; // default text\n    min?: number;\n    max?: number;\n    callback: (val: string) => void;\n    init: string | number;\n    css?: IKeyString;\n}) {\n    const result = document.createElement('input');\n    if (params.type) {\n        try {\n            result.type = params.type;\n        } catch(e) {} // ie can't deal with number\n    } else {\n        result.type = 'text';\n    }\n    if (params.min !== undefined) {\n        result.min = '' + params.min;\n    }\n    if (params.max !== undefined) {\n        result.max = '' + params.max;\n    }\n    result.value = '' + params.init;\n    if (params.callback) {\n        result.onchange = function() {\n            params.callback(result.value);\n        };\n    }\n    if (params.css) {\n        BB.css(result, params.css);\n    }\n\n    return result;\n};","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb.types';\n\n/**\n * A select dropdown\n */\nexport class Select {\n\n    private selectEl: HTMLSelectElement;\n    private optionArr: ([string, string] | null)[]; // [value, label]\n    private changeListener: (event) => void;\n    private onChange: (val: string) => void;\n\n    \n    // --- public ---\n    constructor (p: {\n        isFocusable?: boolean; // default false\n        optionArr: ([string, string] | null)[], // [value, label]\n        initValue?: string; // default null\n        onChange: (val: string) => void;\n        css?: IKeyString;\n        title?: string;\n    }) {\n        this.selectEl = BB.el({\n            tagName: 'select',\n            title: p.title,\n            css: {\n                cursor: 'pointer',\n                fontSize: '15px',\n                padding: '3px',\n                background: '#fff', // makes safari pay attention to font-size\n                //webkitAppearance: 'none'\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\n            }\n        }) as HTMLSelectElement;\n        if (p.css) {\n            BB.css(this.selectEl, p.css);\n        }\n\n        const isFocusable = p.isFocusable;\n        if (!isFocusable) {\n            this.selectEl.tabIndex = -1;\n        }\n        this.optionArr = p.optionArr;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if (this.optionArr[i] === null) {\n                continue;\n            }\n            const option = document.createElement('option');\n            option.value = this.optionArr[i][0];\n            option.textContent = this.optionArr[i][1];\n            this.selectEl.append(option);\n        }\n        this.onChange = p.onChange;\n        this.changeListener = (e) => {\n            if (!isFocusable) {\n                this.selectEl.blur();\n            }\n            this.onChange(this.selectEl.value);\n        };\n        this.selectEl.addEventListener('change', this.changeListener);\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\n    }\n\n    setValue (val) {\n        this.selectEl.value = val;\n    }\n\n    getValue () {\n        return this.selectEl.value;\n    }\n\n    setDeltaValue (delta) {\n        let index = 0;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\n                index = i;\n                break;\n            }\n        }\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\n        this.selectEl.value = this.optionArr[index][0];\n        this.onChange(this.selectEl.value);\n    }\n\n    getElement () {\n        return this.selectEl;\n    }\n\n    destroy = () => {\n        this.selectEl.removeEventListener('change', this.changeListener);\n    }\n    \n}\n","import {BB} from '../../../bb/bb';\n\n\n/**\n * Toggle button with an image\n *\n * p = {\n *     initValue: boolean,\n *     title: string,\n *     isRadio: boolean, // if true, can't click when active\n *     onChange: function(boolean)\n * }\n *\n * @param p\n * @constructor\n */\nexport const ImageToggle = function(p) {\n    let isActive = !!p.initValue;\n    const div = BB.el({\n        className: 'image-toggle',\n        title: p.title,\n        css: {\n            backgroundImage: \"url('\" + p.image + \"')\"\n        },\n        onClick: function(e) {\n            e.preventDefault();\n            if (p.isRadio && isActive) {\n                return;\n            }\n            isActive = !isActive;\n            update();\n            p.onChange(isActive);\n        },\n    });\n\n    function update() {\n        if (isActive) {\n            BB.addClassName(div, 'image-toggle-active');\n        } else {\n            BB.removeClassName(div, 'image-toggle-active');\n        }\n    }\n\n    update();\n\n    // --- interface ---\n    this.setValue = function(b) {\n        isActive = !!b;\n        update();\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return isActive;\n    };\n    this.destroy = () => {\n        BB.destroyEl(div);\n    };\n\n};","import {BB} from '../../../bb/bb';\nimport {ImageToggle} from './image-toggle';\n\n/**\n * Radio input group. each one has an image\n *\n * p = {\n *     optionArr: {\n *         id: string,\n *         title: string,\n *         image: string,\n *     }[],\n *     initId: string,\n *     sizePx: number,\n *     onChange: function(id: string): void\n * }\n *\n * @param p\n */\nexport const ImageRadioList = function(p) {\n\n    const div = BB.el({\n        className: 'image-radio-wrapper',\n        css: {\n            display: 'flex'\n        }\n    });\n\n    let activeIndex;\n    const optionArr = [];\n\n    function select(index, id) {\n        activeIndex = index;\n        for (let i = 0; i < optionArr.length; i++) {\n            optionArr[i].setValue(i === activeIndex);\n        }\n        p.onChange(id);\n    }\n\n    function createOption(index, o) {\n        if (o.id === p.initId) {\n            activeIndex = index;\n        }\n        const radioEl = new ImageToggle({\n            image: o.image,\n            title: o.title,\n            initValue: o.id === p.initId,\n            isRadio: true,\n            onChange: function() {\n                select(index, o.id);\n            }\n        });\n        div.appendChild(radioEl.getElement());\n\n        return radioEl;\n\n    }\n\n    for (let i = 0; i < p.optionArr.length; i++) {\n        optionArr.push(createOption(i, p.optionArr[i]));\n    }\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return p.optionArr[activeIndex].id;\n    };\n    this.destroy = () => {\n        optionArr.forEach(item => {\n            item.destroy();\n        })\n    };\n};","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\nimport {LANG} from '../../../language/language';\n\n\n/**\n * small toggle button with a pen icon - representing toggling pressure sensitivity\n * @param isChecked - boolean - initial value\n * @param changeCallback - function(isChecked boolean) - called on change\n * @returns {HTMLElement} - the toggle button\n */\nexport const penPressureToggle = function(isChecked, changeCallback) {\n\n    const toggleDiv = BB.el({\n        css: {\n            cssFloat: 'right',\n            borderRadius: '3px',\n            width: '18px',\n            height: '18px',\n            backgroundImage: 'url(\"' + iconImg + '\")',\n            backgroundSize: 'contain',\n            backgroundRepeat: 'no-repeat',\n            cursor: 'pointer',\n            boxSizing: 'border-box',\n            colorScheme: 'only light',\n        }\n    });\n\n    if (!BB.hasPointerEvents) {\n        toggleDiv.style.display = 'none';\n    }\n\n    function redraw() {\n        if (isChecked) {\n            BB.css(toggleDiv, {\n                backgroundColor: '#fff',\n                opacity: '0.9',\n                border: '1px solid var(--active-highlight-color)'\n            });\n        } else {\n            BB.css(toggleDiv, {\n                backgroundColor: 'transparent',\n                opacity: '0.5',\n                border: '1px solid #666'\n            });\n        }\n    }\n\n    toggleDiv.title = LANG('brush-toggle-pressure');\n    toggleDiv.onclick = function() {\n        isChecked = !isChecked;\n        redraw();\n        changeCallback(isChecked);\n    };\n\n    redraw();\n    changeCallback(isChecked);\n\n    return toggleDiv;\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"ciaRT\");","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport {IKlSliderConfig} from '../../kl.types';\nimport {languageStrings} from '../../../language/language';\n\n\n\n/**\n * big slider, e.g. used for brush size\n *\n * p = {\n *      label: 'Size',\n *      width: 500,\n *      height: 20,\n *      theme: 'compact-light',\n *      min: 0,\n *      max: 100,\n *      initValue: 10,\n *      resolution: 600, // if you want spline.find to use a different resolution\n *      curve: 'quadratic' | [...], // optional. array is BB.SplineInterpolator points. 0-1\n *      formatFunc: function(value) { // optional\n *          return Math.round(value);\n *      },\n *      onChange: function(value) {},\n *      isChangeOnFinal: true,\n *      eventResMs: 123,\n *      isEnabled?: boolean, // default = true\n * }\n *\n * Values can be spline interpolated\n * On change callback can be debounced\n *\n * @param p - obj\n * @constructor\n */\nexport const KlSlider = function (p) {\n    const _this = this;\n    let isEnabled = p.isEnabled !== false;\n    let useSpline = !!p.curve;\n    let splineInterpolator;\n\n    if (!p.label || !p.onChange) {\n        throw 'PcSlider missing params';\n    }\n    if (p.min != 0 && p.max != 0 && p.initValue != 0) {\n        if (!p.min || !p.max || !p.initValue) {\n            throw 'PcSlider broken params';\n        }\n    }\n    if (p.min >= p.max) {\n        throw 'PcSlider broken params';\n    }\n\n    const elementWidth = p.width;\n    const elementHeight = p.height;\n    const resolution = p.resolution ? p.resolution : elementWidth;\n    let min = p.min;\n    let max = p.max;\n    const onChange = p.onChange;\n    const isChangeOnFinal = !!p.isChangeOnFinal;\n    const formatFunc = p.formatFunc;\n    const eventResMs = p.eventResMs;\n\n    if (useSpline) {\n        const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : p.curve;\n        splineInterpolator = new BB.SplineInterpolator(curveArr);\n    }\n\n    function toLinearValue(value) {\n        if (useSpline) {\n            return splineInterpolator.findX(value, Math.floor(resolution * 1.5));\n        }\n        return (value - min) / (max - min);\n    }\n\n    function toValue(pLinearValue) {\n        let result = min + pLinearValue * (max - min);\n        if (useSpline) {\n            result = splineInterpolator.interpolate(pLinearValue);\n        }\n        return result;\n    }\n\n    const div = BB.el({\n        className: 'sliderWrapper',\n        css: {\n            overflow: 'hidden',\n            position: 'relative',\n            width: elementWidth + 'px',\n            height: elementHeight + 'px',\n            userSelect: 'none'\n        }\n    });\n    const labelCaption = p.label;\n    const label = document.createElement('div');\n    const control = document.createElement('div');\n    const controlInner = document.createElement('div');\n    let linearValue = toLinearValue(p.initValue); //0 - 1\n\n    div.appendChild(control);\n    div.appendChild(label);\n    control.appendChild(controlInner);\n    control.className = 'sliderInner';\n\n\n    div.oncontextmenu = function () {\n        return false;\n    };\n    //control.style.backgroundColor = \"#aaa\";\n    label.innerHTML = labelCaption;\n\n    control.style.position = 'absolute';\n    control.style.left = '0';\n    control.style.top = '0';\n    control.style.width = (linearValue * elementWidth) + 'px';\n    control.style.height = elementHeight + 'px';\n\n    const labelFontSize = elementHeight - 14;\n    BB.css(label, {\n        position: 'absolute',\n        left: '7px',\n        top: (elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\n        lineHeight: labelFontSize + 'px',\n        fontSize: labelFontSize + 'px',\n        pointerEvents: 'none'\n    });\n\n    function updateEnable (): void {\n        if (isEnabled) {\n            BB.css(div, {\n                opacity: null,\n                pointerEvents: null,\n            });\n        } else {\n            BB.css(div, {\n                opacity: '0.5',\n                pointerEvents: 'none',\n            });\n        }\n    }\n    updateEnable();\n\n    function getOutsideVal() {\n        let result = min + linearValue * (max - min);\n        if (useSpline) {\n            result = splineInterpolator.interpolate(linearValue);\n        }\n        return result;\n    }\n\n    function updateLabel() {\n        let outVal = toValue(linearValue);\n        outVal = formatFunc ? formatFunc(outVal) : parseInt(outVal);\n        outVal = outVal.toLocaleString(languageStrings.getCode());\n        label.innerHTML = labelCaption + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + outVal + '</span>';\n        control.style.width = (linearValue * elementWidth) + 'px';\n    }\n\n    let lastCallbackTime = 0;\n    function emit(isFinal) {\n        if (!isFinal && isChangeOnFinal) {\n            return;\n        }\n        if (eventResMs && !isFinal) {\n            const now = performance.now();\n            if (now - lastCallbackTime >= eventResMs) {\n                lastCallbackTime = now;\n                onChange(getOutsideVal());\n            }\n        } else {\n            onChange(getOutsideVal());\n        }\n    }\n\n    let virtualVal;\n    function onPointer(event) {\n        event.eventPreventDefault();\n\n        if (!isEnabled) {\n            return;\n        }\n\n        if (event.type === 'pointerdown') {\n            div.className = 'sliderWrapper sliderWrapperActive';\n\n            if (event.button === 'left') {\n                linearValue = event.relX / elementWidth;\n                linearValue = Math.max(0, Math.min(1, linearValue));\n                updateLabel();\n                emit(false);\n            }\n            virtualVal = linearValue;\n        }\n\n        if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\n\n            let deltaX = event.dX;\n            const deltaY = Math.abs(event.pageY - event.downPageY);\n            const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n            deltaX *= factor;\n            deltaX /= elementWidth;\n\n            virtualVal += deltaX;\n            linearValue = Math.max(0, Math.min(1, virtualVal));\n\n            updateLabel();\n            emit(false);\n        }\n\n        if (event.type === 'pointerup') {\n            div.className = 'sliderWrapper';\n            emit(true);\n        }\n\n    }\n\n    let pointerListener;\n    const pointerListenerTimeout = setTimeout(() => {\n        pointerListener = new BB.PointerListener({\n            target: div,\n            maxPointers: 1,\n            fixScribble: true,\n            onPointer: onPointer,\n            onWheel: function(event) {\n                if (useSpline) {\n                    linearValue += -event.deltaY * (splineInterpolator.getLastX() - splineInterpolator.getFirstX()) / 40;\n                    linearValue = Math.max(splineInterpolator.getFirstX(), Math.min(splineInterpolator.getLastX(), linearValue));\n                } else {\n                    linearValue += -event.deltaY / 40;\n                    linearValue = Math.max(0, Math.min(1, linearValue));\n                }\n                updateLabel();\n                onChange(getOutsideVal());\n            }\n        });\n        updateLabel();\n    }, 1);\n\n\n    // --- interface ---\n    this.increaseValue = function (f) {\n        linearValue = Math.min(1, linearValue + Math.abs(f));\n        updateLabel();\n        onChange(getOutsideVal());\n    };\n    this.decreaseValue = function (f) {\n        linearValue = Math.max(0, linearValue - Math.abs(f));\n        updateLabel();\n        onChange(getOutsideVal());\n    };\n    this.setValue = function(v) {\n        linearValue = toLinearValue(v);\n        updateLabel();\n    };\n    this.getValue = function () {\n        return getOutsideVal();\n    };\n    this.update = function(config: IKlSliderConfig): void {\n        min = config.min;\n        max = config.max;\n        useSpline = !!config.curve;\n        if (useSpline) {\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : config.curve;\n            splineInterpolator = new BB.SplineInterpolator(curveArr);\n        } else {\n            splineInterpolator = null;\n        }\n        _this.setIsEnabled(!config.isDisabled);\n    };\n    this.setIsEnabled = function (e: boolean): void {\n        isEnabled = !!e;\n        updateEnable();\n    };\n\n    this.destroy = function() {\n        clearTimeout(pointerListenerTimeout);\n        if (pointerListener) {\n            pointerListener.destroy();\n        }\n    };\n\n    this.getElement = function() {\n        return div;\n    }\n\n};","\n\n/**\n * to make sliders more finegrained.\n * @param deltaY number - how far pointer moved away vertically since down\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\n */\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) {\n        result *= 2;\n    }\n    return 1 / result;\n};\n","import {BB} from '../../../bb/bb';\r\nimport {input} from '../base-components/input';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\r\n * @constructor\r\n */\r\nexport const HexColorDialog = function (p) {\r\n\r\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n    const div = BB.el({});\r\n\r\n    const previewEl = BB.el({\r\n        css: {\r\n            width: '20px',\r\n            height: '20px',\r\n            marginBottom: '10px',\r\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(previewEl);\r\n\r\n\r\n    // --- Hex ---\r\n    const hexRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        }\r\n    });\r\n    const hexLabel = BB.el({\r\n        content: LANG('mci-hex'),\r\n        css: {\r\n            width: '60px'\r\n        }\r\n    });\r\n    const hexInput = input({\r\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n        css: {\r\n            width: '80px'\r\n        },\r\n        callback: function() {\r\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n            if (rgbObj === null) {\r\n                rgbObj = lastValidRgb;\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            } else {\r\n                lastValidRgb = rgbObj;\r\n            }\r\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n            for (let i = 0; i < rgbArr.length; i++) {\r\n                rgbArr[i].update();\r\n            }\r\n        }\r\n    });\r\n    const copyButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n        title: LANG('mci-copy'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            hexInput.select();\r\n            document.execCommand('copy');\r\n        }\r\n    });\r\n    hexRowEl.appendChild(hexLabel);\r\n    hexRowEl.appendChild(hexInput);\r\n    hexRowEl.appendChild(copyButton);\r\n    div.appendChild(hexRowEl);\r\n    setTimeout(function () {\r\n        hexInput.focus();\r\n        hexInput.select();\r\n    }, 0);\r\n\r\n\r\n    // --- R G B ---\r\n    function createRgbInputRow(labelStr, attributeStr) {\r\n        const result: any = {};\r\n\r\n        const rowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n        const labelEl = BB.el({\r\n            content: labelStr,\r\n            css: {\r\n                width: '60px'\r\n            }\r\n        });\r\n\r\n        const inputEl = input({\r\n            init: lastValidRgb[attributeStr],\r\n            min: 0,\r\n            max: 255,\r\n            type: 'number',\r\n            css: {\r\n                width: '80px'\r\n            },\r\n            callback: function() {\r\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                    result.update();\r\n                    return;\r\n                }\r\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                lastValidRgb[attributeStr] = inputEl.value;\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            }\r\n        });\r\n\r\n        rowEl.appendChild(labelEl);\r\n        rowEl.appendChild(inputEl);\r\n        div.appendChild(rowEl);\r\n\r\n\r\n        result.update = function() {\r\n            inputEl.value = lastValidRgb[attributeStr];\r\n        };\r\n        result.destroy = () => {\r\n            inputEl.onchange = null;\r\n        };\r\n        return result;\r\n    }\r\n    const rgbArr = [];\r\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n    popup({\r\n        target: p.klRootEl,\r\n        message: `<b>${LANG('manual-color-input')}</b>`,\r\n        div: div,\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (resultStr) {\r\n            BB.destroyEl(copyButton);\r\n            rgbArr.forEach(item => item.destroy());\r\n            rgbArr.splice(0, rgbArr.length);\r\n\r\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n        }\r\n    });\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"kmB01\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n// @ts-ignore\r\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n *\r\n * p = {\r\n *     width: number,\r\n *     height: number, // hue slider and output height\r\n *     svHeight: number,\r\n *     startValue: rgb, // 0-255\r\n *     onPick: function(rgb)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const KlColorSlider = function (p) {\r\n\r\n    const _this = this;\r\n    let pickCallback = function(result?) {};\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    div.className = 'colorSlider';\r\n    const outputDiv = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    const width = p.width;\r\n    let svHeight = p.svHeight;\r\n    const height = p.height;\r\n    const emitColor = p.onPick;\r\n\r\n    let primaryColorRGB = {\r\n        r: parseInt(p.startValue.r, 10),\r\n        g: parseInt(p.startValue.g, 10),\r\n        b: parseInt(p.startValue.b, 10)\r\n    };\r\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\r\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\r\n\r\n    const svWrapper = BB.el({});\r\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\r\n    const hueStop = (svSvg as any).getElementById('hue-stop');\r\n    BB.setAttributes(hueStop, {\r\n        'stop-color': '#f0f'\r\n    });\r\n    BB.css(svSvg, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px'\r\n    });\r\n    svWrapper.appendChild(svSvg);\r\n\r\n    const divH = document.createElement('div');\r\n    BB.css(divH, {\r\n        position: 'relative',\r\n        height: height + 'px'\r\n    });\r\n    const divPreview = document.createElement('div');\r\n    const controlH = document.createElement('div');\r\n\r\n    const enabled = true;\r\n\r\n    function updatePrimaryHSV(hsv) {\r\n        if (hsv.s === 0) {\r\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    function createHueBg(targetEl) {\r\n        const im = new Image();\r\n        BB.css(im, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            display: 'none',\r\n            pointerEvents: 'none'\r\n        });\r\n        const cv = BB.canvas(width, height);\r\n        const ctx = cv.getContext('2d');\r\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            let ha = (parseInt('' + col.r)).toString(16);\r\n            let hb = (parseInt('' + col.g)).toString(16);\r\n            let hc = (parseInt('' + col.b)).toString(16);\r\n            if (ha.length === 1)\r\n                ha = '0' + ha;\r\n            if (hb.length === 1)\r\n                hb = '0' + hb;\r\n            if (hc.length === 1)\r\n                hc = '0' + hc;\r\n            gradH.addColorStop(i, '#' + ha + hb + hc);\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        targetEl.appendChild(im);\r\n        im.alt = 'hue';\r\n        im.src = cv.toDataURL('image/png');\r\n        im.style.display = 'block';\r\n    }\r\n\r\n\r\n    function updateSVCanvas() {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\r\n        });\r\n    }\r\n\r\n    function updateSVPointer() {\r\n\r\n        const left = primaryColorHSV.s / 100 * width - 7;\r\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n    }\r\n\r\n    function setColPreview() {\r\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\r\n            BB.css(pickerButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n        } else{\r\n            BB.css(pickerButton, {\r\n                filter: ''\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: ''\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    updateSVCanvas();\r\n    div.style.width = width + 'px';\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    const SVContainer = document.createElement('div');\r\n    BB.css(SVContainer, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px',\r\n        overflow: 'hidden',\r\n        display: 'block',\r\n        position: 'relative',\r\n        cursor: 'crosshair',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n    });\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '12px',\r\n        height: '12px',\r\n        borderRadius: '6px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\r\n    });\r\n\r\n    SVContainer.appendChild(svWrapper);\r\n    SVContainer.appendChild(pointerSV);\r\n    updateSVPointer();\r\n    div.appendChild(SVContainer);\r\n    div.appendChild(divH);\r\n    outputDiv.appendChild(divPreview);\r\n    BB.css(divPreview, {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        width: (height * 2.5) + 'px',\r\n        height: height + 'px',\r\n        //position: \"relative\",\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        colorScheme: 'only light',\r\n    });\r\n\r\n    BB.css(divH, {\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        cursor: 'ew-resize',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        marginTop: '1px',\r\n        marginBottom: '1px'\r\n    });\r\n\r\n    //divH.className = \"svSlider\";\r\n    BB.css(controlH, {\r\n        width: '1px',\r\n        height: height + 'px',\r\n        background: '#000',\r\n        borderLeft: '1px solid #fff',\r\n        position: 'absolute',\r\n        top: '0',\r\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\r\n    });\r\n\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n    let svPointerListener;\r\n    let hPointerListener;\r\n\r\n\r\n    const pickerButton = BB.el({\r\n        title: LANG('eyedropper') + ' [Alt]',\r\n        className: 'color-picker-preview-button',\r\n        css: {\r\n            width: '30px',\r\n            height: '30px',\r\n            backgroundImage: 'url(' + eyedropperImg + ')',\r\n            backgroundRepeat:  'no-repeat',\r\n            backgroundSize: '70%',\r\n            backgroundPosition: 'center'\r\n        }\r\n    });\r\n    let isPicking = false;\r\n\r\n\r\n    pickerButton.onclick = function () {\r\n        if (isPicking === false) {\r\n            BB.removeClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            BB.addClassName(pickerButton, 'color-picker-preview-button-active');\r\n            isPicking = true;\r\n            pickCallback(true);\r\n        } else {\r\n            pickCallback(false);\r\n            _this.pickingDone();\r\n        }\r\n    };\r\n    const pickerButtonPointerListener = new BB.PointerListener({\r\n        target: pickerButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isPicking) {\r\n                return;\r\n            }\r\n            if (isOver) {\r\n                BB.addClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            } else {\r\n                BB.removeClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            }\r\n        }\r\n    });\r\n    divPreview.appendChild(pickerButton);\r\n\r\n\r\n    const hexButton = BB.el({\r\n        content: '#',\r\n        className: 'color-picker-preview-button',\r\n        title: LANG('manual-color-input'),\r\n        css: {\r\n            height: '100%',\r\n            width: height + 'px',\r\n            lineHeight: height + 'px',\r\n            fontSize: (height * 0.65) + 'px'\r\n        },\r\n        onClick: function() {\r\n            HexColorDialog({\r\n                klRootEl: p.klRootEl,\r\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\r\n                onClose: function(rgbObj) {\r\n                    if (!rgbObj) {\r\n                        return;\r\n                    }\r\n                    _this.setColor(rgbObj);\r\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n                }\r\n            });\r\n        }\r\n    });\r\n    const hexButtonPointerListener = new BB.PointerListener({\r\n        target: hexButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isOver) {\r\n                BB.addClassName(hexButton, 'color-picker-preview-button-hover');\r\n            } else {\r\n                BB.removeClassName(hexButton, 'color-picker-preview-button-hover');\r\n            }\r\n        }\r\n    });\r\n    divPreview.appendChild(hexButton);\r\n\r\n    setColPreview();\r\n\r\n\r\n    setTimeout(function() {\r\n        createHueBg(divH);\r\n        divH.appendChild(controlH);\r\n        svPointerListener = new BB.PointerListener({\r\n            target: svWrapper,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\r\n                        zIndex: '1'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / width * 100;\r\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\r\n\r\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n\r\n                        updateSVPointer();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.s = primaryColorHSV.s;\r\n                        virtualHSV.v = primaryColorHSV.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\r\n\r\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    updateSVPointer();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\r\n                        zIndex: '0'\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n        hPointerListener = new BB.PointerListener({\r\n            target: divH,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(divH, {\r\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / width * 359.99;\r\n\r\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                        updateSVCanvas();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.h = primaryColorHSV.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                    updateSVCanvas();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(divH, {\r\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }, 1);\r\n\r\n\r\n    // --- second color ---\r\n\r\n    const secondaryColorBtn = BB.el({\r\n        parent: outputDiv,\r\n        title: LANG('secondary-color') + ' [X]',\r\n        css: {\r\n            cursor: 'pointer',\r\n            marginLeft: '5px',\r\n            width: '22px',\r\n            height: '22px',\r\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\r\n            colorScheme: 'only light',\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            swapColors();\r\n        }\r\n    });\r\n    function updateSecondaryColor() {\r\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\r\n    }\r\n    function swapColors() {\r\n        // swap hsv\r\n        let tmp: any = secondaryColorHSV;\r\n        secondaryColorHSV = primaryColorHSV;\r\n        updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = secondaryColorRGB;\r\n        secondaryColorRGB = primaryColorRGB;\r\n        primaryColorRGB = tmp;\r\n\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n        updateSecondaryColor();\r\n\r\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n    }\r\n    updateSecondaryColor();\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setColor = function (c) {\r\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\r\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n    };\r\n\r\n    this.getColor = function () {\r\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\r\n    };\r\n\r\n    this.getSecondaryRGB = function() {\r\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\r\n    };\r\n\r\n    this.setPickCallback = function (func) {\r\n        pickCallback = func;\r\n    };\r\n\r\n    this.pickingDone = function () {\r\n        if (!isPicking) {\r\n            return;\r\n        }\r\n        isPicking = false;\r\n        BB.removeClassName(pickerButton, 'color-picker-preview-button-active');\r\n    };\r\n\r\n    this.enable = function (e) {\r\n        if (e) {\r\n            div.style.pointerEvents = '';\r\n            div.style.opacity = '1';\r\n            outputDiv.style.pointerEvents = '';\r\n            outputDiv.style.opacity = '1';\r\n        } else {\r\n            div.style.pointerEvents = 'none';\r\n            div.style.opacity = '0.5';\r\n            outputDiv.style.pointerEvents = 'none';\r\n            outputDiv.style.opacity = '0.5';\r\n        }\r\n    };\r\n\r\n    this.setHeight = function (h) {\r\n        h = parseInt('' +(h - height * 2 - 3), 10);\r\n        if (h === svHeight) {\r\n            return;\r\n        }\r\n        svHeight = h;\r\n        BB.css(svSvg, {\r\n            width: width + 'px',\r\n            height: svHeight + 'px'\r\n        });\r\n        SVContainer.style.height = svHeight + 'px';\r\n        updateSVPointer();\r\n    };\r\n\r\n    this.swapColors = function() {\r\n        swapColors();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.getOutputElement = function() {\r\n        return outputDiv;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"wC0GY\");","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\n\n\n/**\n * a small color slider\n *\n * params {\n * \t width: 200,\n * \t heightSV: 200,\n * \t heightH: 10,\n * \t color: {r,g,b}\n * \t callback: function(c){}\n * }\n *\n * @param params\n * @constructor\n */\nexport const KlSmallColorSlider = function (params) {\n    const div = document.createElement('div');\n    div.oncontextmenu = function(e) {\n        e.preventDefault();\n    };\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\n    BB.css(div, {\n        width: params.width + 'px',\n        position: 'relative',\n        overflow: 'hidden',\n        userSelect: 'none'\n    });\n\n    const canvasSV = BB.canvas(10, 10);\n    canvasSV.style.width = params.width + 'px';\n    canvasSV.style.height = params.heightSV + 'px';\n    canvasSV.style.cursor = 'crosshair';\n\n    function updateSV() {\n        const ctx = canvasSV.getContext('2d');\n        for (let i = 0; i < canvasSV.height; i += 1) {\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\n\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\n            ctx.fillStyle = gradient1;\n            ctx.fillRect(0, i, canvasSV.width, 1);\n        }\n    }\n\n    updateSV();\n\n    const canvasH = BB.canvas(params.width, params.heightH);\n    canvasH.style.cursor = 'ew-resize';\n    (function () {\n        const ctx = canvasH.getContext('2d');\n\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\n        for (let i = 0; i < 1; i += 0.01) {\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\n        }\n        ctx.fillStyle = gradH;\n        ctx.fillRect(0, 0, params.width, params.heightH);\n\n    })();\n    BB.css(canvasSV, {\n        width: params.width + 'px',\n        height: params.heightSV + 'px',\n        overflow: 'hidden',\n        position: 'relative'\n    });\n    canvasSV.style.cssFloat = 'left';\n    canvasH.style.cssFloat = 'left';\n\n    div.appendChild(canvasSV);\n    div.appendChild(canvasH);\n\n    const pointerSV = document.createElement('div');\n    BB.css(pointerSV, {\n        width: '8px',\n        height: '8px',\n        borderRadius: '8px',\n        position: 'absolute',\n        pointerEvents: 'none',\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\n    });\n    div.appendChild(pointerSV);\n\n    const pointerH = document.createElement('div');\n    BB.css(pointerH, {\n        width: '0',\n        height: params.heightH + 'px',\n        borderLeft: '1px solid #fff',\n        borderRight: '1px solid #000',\n        position: 'absolute',\n        top: params.heightSV + 'px',\n        pointerEvents: 'none'\n    });\n    div.appendChild(pointerH);\n\n\n    function updateSVPointer() {\n        const left = color.s / 100 * params.width - 4;\n        const top = (1 - color.v / 100) * params.heightSV - 4;\n        BB.css(pointerSV, {\n            left: left + 'px',\n            top: top + 'px'\n        });\n        /*if (top < params.heightSV/3) {\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\n    } else {\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\n    }*/\n    }\n\n    function updateHPointer() {\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\n    }\n\n    updateSVPointer();\n    updateHPointer();\n\n    const virtualHSV = {\n        h: 0,\n        s: 0,\n        v: 0\n    };\n\n    let svPointerId = null;\n    const svPointerListener = new BB.PointerListener({\n        target: canvasSV,\n        maxPointers: 1,\n        fixScribble: true,\n        onPointer: function(event) {\n\n            if (event.type === 'pointerdown') {\n                svPointerId = event.pointerId;\n                if (event.button === 'left') {\n\n                    virtualHSV.s = event.relX / params.width * 100;\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\n\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\n\n                    updateSVPointer();\n                    params.callback(BB.ColorConverter.toRGB(color));\n                } else {\n                    virtualHSV.s = color.s;\n                    virtualHSV.v = color.v;\n                }\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\n\n                let factor = 1;\n                if (event.button === 'right') {\n                    factor = 0.5;\n                }\n\n                virtualHSV.s += event.dX / params.width * 100 * factor;\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\n\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\n                updateSVPointer();\n                params.callback(BB.ColorConverter.toRGB(color));\n\n            }\n            if (event.type === 'pointerup') {\n                svPointerId = null;\n            }\n\n        }\n    });\n\n    let hPointerId = null;\n    const hPointerListener = new BB.PointerListener({\n        target: canvasH,\n        maxPointers: 1,\n        fixScribble: true,\n        onPointer: function(event) {\n\n            if (event.type === 'pointerdown') {\n                hPointerId = event.pointerId;\n                if (event.button === 'left') {\n\n                    virtualHSV.h = event.relX / params.width * 359.99;\n\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\n                    updateSV();\n                    updateHPointer();\n                    params.callback(BB.ColorConverter.toRGB(color));\n                } else {\n                    virtualHSV.h = color.h;\n                }\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\n\n                const deltaY = Math.abs(event.pageY - event.downPageY);\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\n\n                if (event.button === 'right') {\n                    virtualHSV.h = virtualHSV.h % 359.99;\n                    if (virtualHSV.h < 0) {\n                        virtualHSV.h += 359.99;\n                    }\n                }\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\n                updateSV();\n                updateHPointer();\n                params.callback(BB.ColorConverter.toRGB(color));\n\n            }\n            if (event.type === 'pointerup') {\n                hPointerId = null;\n            }\n        }\n    });\n\n\n    const cleardiv = document.createElement('div');\n    cleardiv.style.clear = 'both';\n    div.appendChild(cleardiv);\n\n    // --- interface ---\n    this.setColor = function (c) {\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\n        updateSV();\n        updateSVPointer();\n        updateHPointer();\n    };\n    this.getColor = function () {\n        return BB.ColorConverter.toRGB(color);\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.destroy = function() {\n        svPointerListener.destroy();\n        hPointerListener.destroy();\n    };\n    this.end = function() {\n        svPointerId = null;\n        hPointerId = null;\n    };\n\n};","import {BB} from '../../../bb/bb';\n\n\n/**\n * a slider that looks like this\n * ------O----\n *\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\n *\n * @param param\n * @constructor\n */\nexport const PointSlider = function(param) {\n\n    const div = document.createElement('div');\n    div.style.position = 'relative';\n    const sliderLine = BB.el({});\n    const sliderPoint = BB.el({\n        css: {\n            colorScheme: 'only light',\n        }\n    });\n    div.appendChild(sliderLine);\n    div.appendChild(sliderPoint);\n    let sliderPos;\n    let isDragging = false;\n\n    //sliderLine\n    {\n        BB.css(sliderLine, {\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\n            height: '2px',\n            background: '#aaa',\n            width: param.width + 'px'\n        });\n    }\n    //sliderPoint\n    const touchAreaEl = BB.el({ // expand clickable area\n        parent: sliderPoint,\n        css: {\n            // background: 'rgba(255,0,0,0.4)',\n            margin: '-7px 0 0 -7px',\n            width: 'calc(100% + 14px)',\n            height: 'calc(100% + 7px)',\n        }\n    });\n\n    function redrawPoint() {\n        sliderPoint.style.left = sliderPos + 'px';\n        if (isDragging) {\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\n        } else {\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\n        }\n    }\n    function getValue() {\n        return sliderPos /  (param.width - param.pointSize);\n    }\n\n    let pointerListener;\n    {\n        let isFirst;\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\n        BB.css(sliderPoint, {\n            position: 'absolute',\n            top: '0px',\n            backgroundColor: '#eaeaea',\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\n            width: param.pointSize + 'px',\n            height: param.pointSize + 'px',\n            borderRadius: param.pointSize + 'px',\n            cursor: 'ew-resize',\n            transition: 'box-shadow 0.2s ease-in-out'\n        });\n        redrawPoint();\n        let imaginaryPos;\n        pointerListener = new BB.PointerListener({\n            target: sliderPoint,\n            fixScribble: true,\n            onPointer: function(event) {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    isFirst = true;\n                    isDragging = true;\n                    imaginaryPos = sliderPos;\n                    redrawPoint();\n                    event.eventStopPropagation();\n                } else if (event.type === 'pointermove' && event.button === 'left') {\n                    event.eventStopPropagation();\n                    imaginaryPos = imaginaryPos + event.dX;\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\n                    redrawPoint();\n                    param.callback(getValue(), isFirst, false);\n                    isFirst = false;\n                }\n                if (event.type === 'pointerup') {\n                    event.eventStopPropagation();\n                    isDragging = false;\n                    redrawPoint();\n                    param.callback(getValue(), false, true);\n                }\n            }\n        })\n    }\n\n    // --- interface ---\n    this.getEl = function() {\n        return div;\n    };\n    this.setActive = function(isActive) {\n        if (isActive) {\n            sliderPoint.style.backgroundColor = '#fff';\n        } else {\n            sliderPoint.style.backgroundColor = '#eaeaea';\n        }\n    };\n    this.destroy = function() {\n        pointerListener.destroy();\n    };\n};","import {BB} from '../../../bb/bb';\n\n/**\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\n * Can't deal with 0.5 alpha.\n * Rectangular buttons.\n *\n * p = {\n *     colorArr: rgba[], // duplicates are removed\n *     onChange: func(rgbaObj),\n *     label: string,\n *     initialIndex: int// optional, index before duplicates were removed\n * }\n *\n * @param p\n * @constructor\n */\nexport const ColorOptions = function(p) {\n    const div = BB.el({\n        content: p.label ? p.label : '',\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            colorScheme: 'only light',\n        }\n    });\n\n    let selectedIndex = 0;\n    const colorArr = [];\n    const buttonArr = [];\n    const buttonSize = 22;\n    const checkerUrl = BB.createCheckerDataUrl(5);\n\n    // build colorArr while removing duplicates\n    for (let i = 0; i < p.colorArr.length; i++) {\n        const item = p.colorArr[i];\n        let found = false;\n        for (let e = 0; e < colorArr.length; e++) {\n            const sItem = colorArr[e];\n            if (sItem === null || item === null) {\n                continue;\n            }\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\n                found = true;\n                break;\n            }\n        }\n        if (found) {\n            continue;\n        }\n        colorArr.push(item);\n        if ('initialIndex' in p && p.initialIndex === i) {\n            selectedIndex = colorArr.length - 1;\n        }\n    }\n\n    for (let i = 0; i < colorArr.length; i++) {\n        (function(i) {\n\n            const colorButton = BB.el({\n                content: colorArr[i] ? '' : 'X',\n                css: {\n                    width: buttonSize + 'px',\n                    height: buttonSize + 'px',\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\n                    marginLeft: '7px',\n                    boxShadow: '0 0 0 1px #aaa',\n                    cursor: 'pointer',\n                    userSelect: 'none',\n                    textAlign: 'center',\n                    lineHeight: (buttonSize + 1) + 'px',\n                    color: '#aaa'\n                }\n            });\n            if (colorArr[i] && colorArr[i].a === 0) {\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\n            }\n\n            colorButton.onclick = function(e) {\n                e.preventDefault();\n                selectedIndex = i;\n                update();\n                p.onChange(colorArr[i]);\n            };\n\n            (colorButton as any).setIsSelected = function(b) {\n                if (b) {\n                    BB.css(colorButton, {\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\n                        pointerEvents: 'none'\n                    });\n                } else {\n                    BB.css(colorButton, {\n                        boxShadow: '0 0 0 1px #aaa',\n                        pointerEvents: ''\n                    });\n                }\n            };\n\n\n            div.appendChild(colorButton);\n            buttonArr.push(colorButton);\n        })(i);\n    }\n\n\n    function update() {\n        for (let i = 0; i < buttonArr.length; i++) {\n            buttonArr[i].setIsSelected(i === selectedIndex);\n        }\n    }\n    update();\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n    this.destroy = () => {\n        buttonArr.forEach(item => {\n            item.onclick = null;\n        });\n        buttonArr.splice(0, buttonArr.length);\n    };\n};","import {BB} from '../../../bb/bb';\n\n/**\n * selectable options\n * p = {\n *     optionArr: {\n *          id: string,\n *          label: string | HTMLElement\n *     }[],\n *     initialId?: string,\n *     onChange: function(id string): void,\n *     changeOnInit?: boolean, // trigger change on creation\n * }\n *\n * @param p\n * @constructor\n */\nexport const Options = function(p) {\n    const div = BB.el({});\n\n    const wrapperEl = BB.el({\n        parent: div,\n        className: 'kl-option-wrapper',\n        css: {\n            display: 'flex'\n        }\n    });\n\n    const optionArr: {\n        id: string;\n        el: HTMLElement;\n    }[] = [];\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\n\n    function createOption(o) {\n        const optionObj = {\n            id: o.id,\n            el: null,\n        };\n\n        const classArr = ['kl-option'];\n        if (p.isSmall) {\n            classArr.push('kl-option--small');\n        }\n        if (typeof o.label !== 'string') {\n            classArr.push('kl-option--custom-el');\n            BB.css(o.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n\n        optionObj.el = BB.el({\n            parent: wrapperEl,\n            content: o.label,\n            className: classArr.join(' '),\n            onClick: function() {\n                if (selectedId !== optionObj.id) {\n                    selectedId = optionObj.id;\n                    update();\n                    p.onChange(selectedId);\n                }\n            }\n        });\n\n        if (o.title) {\n            optionObj.el.title = o.title;\n        }\n\n        optionArr.push(optionObj);\n    }\n\n    function update() {\n        for (let i = 0; i < optionArr.length; i++) {\n            if (optionArr[i].id === selectedId) {\n                BB.addClassName(optionArr[i].el, 'kl-option-selected');\n            } else {\n                BB.removeClassName(optionArr[i].el, 'kl-option-selected');\n            }\n        }\n    }\n\n    for (let i = 0; i < p.optionArr.length; i++) {\n        createOption(p.optionArr[i]);\n    }\n\n    update();\n\n    if (p.changeOnInit) {\n        setTimeout(function() {\n            p.onChange(selectedId);\n        }, 0);\n    }\n\n    function getIndex() {\n        for (let i = 0; i < optionArr.length; i++) {\n            if (optionArr[i].id === selectedId) {\n                return i;\n            }\n        }\n    }\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return selectedId;\n    }\n    this.next = function() {\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\n        update();\n        p.onChange(selectedId);\n    };\n    this.previous = function() {\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\n        update();\n        p.onChange(selectedId);\n    };\n    this.destroy = () => {\n        optionArr.forEach(item => {\n            BB.destroyEl(item.el);\n        });\n        optionArr.splice(0, optionArr.length);\n    };\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private container: HTMLDivElement;\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState() {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init() {\r\n        this.el = BB.el({\r\n            className: \"top-overlay\",\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay-inner',\r\n        }) as HTMLDivElement\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px'\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.appendChild(this.innerInnerEl);\r\n        this.innerEl.appendChild(this.angleIm);\r\n        this.el.appendChild(this.innerEl);\r\n        this.container.appendChild(this.el);\r\n        this.el.style.display = \"none\";\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (el: HTMLDivElement) {\r\n        this.container = el;\r\n        this.init();\r\n    }\r\n\r\n    setWide(b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState(state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\r\n        this.el.style.opacity = \"1\";\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = \"0\";\r\n            this.el.style.animationName = \"consoleOut\";\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = \"none\";\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = \"flex\";\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"fmKxO\");","import {BB} from '../../../bb/bb';\nimport {popup} from './popup';\n\nexport function exportDialog(parent, image) {\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\n        text, holding, aniTimeout, halfBoxSize;\n    boxSize = 22 * 2;\n    halfBoxSize = 22;\n    aboutCloseFunc = function () {\n    };\n    closed = false;\n    aniToggle = false;\n    aboutDiv = document.createElement(\"div\");\n    BB.css(aboutDiv, {\n        width: (7 * boxSize) + \"px\"\n    });\n\n    imageContainer = document.createElement(\"div\");\n    coverImage = new Image();\n    coverImage.src = image.src;\n\n    imageContainer.appendChild(coverImage);\n    imageContainer.appendChild(image);\n\n    BB.css(imageContainer, {\n        width: (6 * boxSize) + \"px\",\n        height: (4 * boxSize) + \"px\",\n        marginTop: (boxSize / 2 - 1) + \"px\",\n        marginLeft: (boxSize / 2 - 1) + \"px\",\n        position: \"relative\",\n        overflow: \"hidden\",\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\n        border: \"1px solid rgba(255, 255, 255, 1)\",\n        transition: \"box-shadow 0.7s linear\"\n    });\n    BB.css(image, {\n        position: \"absolute\",\n        left: '0',\n        top: '0',\n        width: (6 * boxSize) + \"px\",\n        height: (4 * boxSize) + \"px\",\n        opacity: '0'\n    });\n    coverSize = {\n        width: (6 * boxSize),\n        height: (6 * boxSize / image.width) * image.height\n    };\n    if (coverSize.height < (4 * boxSize)) {\n        coverSize.height = (4 * boxSize);\n        coverSize.width = (coverSize.height / image.height) * image.width;\n    }\n    BB.css(coverImage, {\n        position: \"absolute\",\n        top: (2 * boxSize) + \"px\",\n        left: (3 * boxSize) + \"px\",\n        width: coverSize.width + \"px\",\n        height: coverSize.height + \"px\",\n        marginLeft: (-coverSize.width / 2) + \"px\",\n        marginTop: (-coverSize.height / 2) + \"px\"\n    });\n\n    function animation() {\n        if (closed) {\n            return;\n        }\n        aniToggle = !aniToggle;\n        if (aniToggle) {\n            BB.css(imageContainer, {\n                border: \"1px solid rgba(0, 0, 0, 1)\"\n            });\n        } else {\n            BB.css(imageContainer, {\n                border: \"1px solid rgba(200, 200, 200, 1)\"\n            });\n        }\n        setTimeout(animation, 510);\n    }\n\n    animation();\n\n    text = document.createElement(\"div\");\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\n    text.ontouchstart = function () {\n        return false;\n    };\n    BB.css(text, {\n        fontSize: (boxSize / 2.5) + \"px\",\n        color: \"#666\",\n        padding: \"10px\",\n        textAlign: \"center\"\n    });\n\n    aboutDiv.appendChild(imageContainer);\n    aboutDiv.appendChild(text);\n\n    holding = false;\n    image.ontouchstart = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\n        });\n        holding = true;\n        aniTimeout = setTimeout(function () {\n            holding = false;\n            BB.css(imageContainer, {\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n            });\n        }, 1500);\n    };\n    image.ontouchmove = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n        });\n        holding = false;\n        clearTimeout(aniTimeout);\n    };\n    image.ontouchend = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n        });\n        holding = false;\n        clearTimeout(aniTimeout);\n    };\n\n    popup({\n        target: parent,\n        message: \"<b>Save Image</b>\",\n        div: aboutDiv,\n        buttons: [\"Close\"],\n        callback: function (result) {\n            closed = true;\n        }\n    });\n}","import {BB} from '../../../bb/bb';\n\n/**\n * element that lets you crop an image and copy it via right click\n *\n * param = {\n *     width: number,\n *     height: number,\n *     canvas: image | canvas,\n *     isNotCopy: boolean,\n *     onChange: function(width, height)\n * }\n *\n * @param param object\n * @constructor\n */\nexport function CropCopy(param) {\n    const div = document.createElement('div');\n    BB.css(div, {\n        position: 'relative',\n        height: param.height + 'px',\n        width: param.width + 'px',\n        overflow: 'hidden',\n        colorScheme: 'only light',\n    });\n    div.style.position = 'relative';\n\n    let crop;\n    function resetCrop() {\n        crop = {\n            x: 0,\n            y: 0,\n            width: param.canvas.width,\n            height: param.canvas.height\n        };\n    }\n    resetCrop();\n\n\n    function updateCroppedCanvas() {\n        croppedCanvas.width = Math.round(crop.width);\n        croppedCanvas.height = Math.round(crop.height);\n        let ctx = croppedCanvas.getContext('2d');\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\n        if (croppedImage) {\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\n        }\n\n        if (param.onChange) {\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\n        }\n    }\n    function updateSelectionRect() {\n        BB.css(selectionRect, {\n            left: (thumbX + crop.x * scaleW) + 'px',\n            top: (thumbY + crop.y * scaleH) + 'px',\n            width: (crop.width * scaleW) + 'px',\n            height: (crop.height * scaleH) + 'px'\n        });\n        if (param.onChange) {\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\n        }\n    }\n    function isInsideSelectionRect(p) {\n        let rect = {\n            x: Math.round(thumbX + crop.x * scaleW),\n            y: Math.round(thumbY + crop.y * scaleH),\n            width: Math.round(crop.width * scaleW),\n            height: Math.round(crop.height * scaleH)\n        };\n        return rect.x <= p.x && p.x <= rect.x + rect.width &&\n            rect.y <= p.y && p.y <= rect.y + rect.height;\n    }\n\n    const croppedCanvas = BB.canvas();\n    let eventTarget = croppedCanvas;\n    let croppedImage = null;\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\n        croppedImage = new Image();\n        eventTarget = croppedImage;\n    }\n    BB.css(eventTarget, {\n        height: param.height + 'px',\n        width: param.width + 'px'\n    });\n    div.appendChild(eventTarget);\n    updateCroppedCanvas();\n\n    const padding = 20;\n    const previewWrapper = BB.el({\n        css: {\n            width: param.width + 'px',\n            height: param.height + 'px',\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none'\n        }\n    });\n    div.appendChild(previewWrapper);\n    BB.createCheckerDataUrl(4, function(v) {\n        previewWrapper.style.backgroundImage = 'url('+v+')';\n    });\n\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\n    thumbCanvas.style.imageRendering = 'pixelated';\n    const scaleW = thumbCanvas.width / param.canvas.width;\n    const scaleH = thumbCanvas.height / param.canvas.height;\n    const thumbCtx = thumbCanvas.getContext('2d');\n    thumbCtx.imageSmoothingEnabled = false;\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\n    previewWrapper.appendChild(thumbCanvas);\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\n    BB.css(thumbCanvas, {\n        position: 'absolute',\n        left: thumbX + \"px\",\n        top: thumbY + \"px\"\n    });\n\n    const selectionRect = BB.el({\n        css: {\n            position: 'absolute',\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\n        }\n    });\n    previewWrapper.appendChild(selectionRect);\n    updateSelectionRect();\n\n\n    function toOriginalSpace(p) {\n        return {\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\n        };\n    }\n    //gen crop from thumb-space points\n    function genCrop(p1, p2) {\n        let topLeftP = {\n            x: Math.min(p1.x, p2.x),\n            y: Math.min(p1.y, p2.y)\n        };\n        let bottomRightP = {\n            x: Math.max(p1.x, p2.x),\n            y: Math.max(p1.y, p2.y)\n        };\n        let origTopLeftP = toOriginalSpace(topLeftP);\n        let origBottomRightP = toOriginalSpace(bottomRightP);\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\n        return {\n            x: origTopLeftP.x,\n            y: origTopLeftP.y,\n            width: origBottomRightP.x - origTopLeftP.x,\n            height: origBottomRightP.y - origTopLeftP.y\n        };\n    }\n\n    function isReset() {\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\n    }\n\n    let startP;\n    let startCrop = null;\n    let isDragging = false;\n    let didMove = false;\n    let updateCropTimeout;\n    const pointerListener = new BB.PointerListener({\n        target: eventTarget,\n        fixScribble: true,\n        onPointer: function(event) {\n            let fullPos;\n            if (event.type === 'pointerdown' && event.button === 'left') {\n                event.eventPreventDefault();\n                isDragging = true;\n                startP = {\n                    x: event.relX,\n                    y: event.relY\n                };\n                if (!isReset() && isInsideSelectionRect(startP)) {\n                    startCrop = {\n                        x: crop.x,\n                        y: crop.y,\n                        width: crop.width,\n                        height: crop.height\n                    };\n                } else {\n                    crop = genCrop(startP, startP);\n                }\n            } else if (event.type === 'pointermove' && event.button === 'left') {\n                event.eventPreventDefault();\n                didMove = true;\n                if (startCrop) {\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\n                } else {\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\n                }\n                updateSelectionRect();\n            } else if (event.type === 'pointerup' && startP) {\n                event.eventPreventDefault();\n                isDragging = false;\n                startCrop = null;\n                startP = null;\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\n                    resetCrop();\n                    updateSelectionRect();\n                }\n                didMove = false;\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\n            }\n        }\n    });\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, e, comboStr) {\n            if (isDragging) {\n                return;\n            }\n            let doUpdate = false;\n\n            let stepSize = Math.max(1, 1 / scaleW);\n            let shiftIsPressed = keyListener.isPressed('shift');\n\n            if (keyStr === 'left') {\n                if (shiftIsPressed) {\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\n                } else {\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'right') {\n                if (shiftIsPressed) {\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\n                } else {\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'up') {\n                if (shiftIsPressed) {\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\n                } else {\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'down') {\n                if (shiftIsPressed) {\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\n                } else {\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\n                }\n                doUpdate = true;\n            }\n\n            if (doUpdate) {\n                e.preventDefault();\n                updateSelectionRect();\n                clearTimeout(updateCropTimeout);\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\n            }\n        }\n    });\n\n    this.getEl = function() {\n        return div;\n    };\n    this.reset = function() {\n        resetCrop();\n        updateCroppedCanvas();\n        updateSelectionRect();\n    };\n    this.destroy = function() {\n        eventTarget.style.removeProperty('width');\n        eventTarget.style.removeProperty('height');\n        keyListener.destroy();\n        pointerListener.destroy();\n    };\n    this.isReset = function() {\n        return isReset();\n    };\n    this.getRect = function() {\n        return JSON.parse(JSON.stringify(crop));\n    };\n    this.getCroppedImage = function() {\n        return croppedCanvas;\n    };\n}\n","import { BB } from '../../../bb/bb';\r\nimport { popup } from './popup';\r\nimport { CropCopy } from '../components/crop-copy';\r\nimport { LANG } from '../../../language/language';\r\n\r\n/// <reference path=\"./types.d.ts\" />\r\n\r\n/**\r\n *\r\n * @param parent\r\n * @param fullCanvas\r\n * @param cropCallback\r\n * @param output - BB.Output\r\n * @param showCrop - boolean - show crop button\r\n */\r\nexport function clipboardDialog(parent, bbox, fullCanvas, cropCallback, output, showCrop) {\r\n    const div = document.createElement(\"div\");\r\n    const isSmall = bbox.width < 550 || bbox.height < 550;\r\n\r\n    let topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop'),\r\n        css: {\r\n            textAlign: 'center'\r\n        }\r\n    });\r\n    div.appendChild(topWrapper);\r\n\r\n\r\n    let cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n    function toClipboard() {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function () {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob\r\n                    } as any) // todo check is possible?\r\n                ]);\r\n                setTimeout(function () {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closefunc();\r\n            }\r\n        }\r\n    });\r\n\r\n    let closefunc;\r\n    function blur() {\r\n        closefunc();\r\n    }\r\n    BB.addEventListener(window, \"blur\", blur);\r\n    popup({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: \"500px\"\r\n        },\r\n        buttons: showCrop ? [LANG('cropcopy-btn-copy'), LANG('cropcopy-btn-crop'), 'Cancel'] : [LANG('cropcopy-btn-copy'), 'Cancel'],\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                let rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\r\n                });\r\n            }\r\n            BB.removeEventListener(window, \"blur\", blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\nimport {popup} from '../modals/popup';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {Options} from '../base-components/options';\r\nimport {Select} from '../base-components/select';\r\nimport {PointSlider} from '../base-components/point-slider';\r\n// @ts-ignore\r\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\r\n// @ts-ignore\r\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\r\n// @ts-ignore\r\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\n// @ts-ignore\r\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\r\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\r\nimport {IMixMode} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {translateBlending} from '../../canvas/translate-blending';\r\n\r\n\r\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\r\n    let klCanvas: KlCanvas = p_canvas;\r\n    let layerElArr = [];\r\n    let layerHeight = 35;\r\n    let layerSpacing = 0;\r\n    let width = 250;\r\n    let oldHistoryState;\r\n    let updatefunc = p_func;\r\n    let uiState = 'right'; // 'left | 'right'\r\n\r\n\r\n    let largeThumbDiv = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            position: \"absolute\",\r\n            right: \"280px\",\r\n            top: \"500px\",\r\n            background: \"#aaa\",\r\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\r\n            pointerEvents: \"none\",\r\n            padding: '0',\r\n            border: \"1px solid #aaa\",\r\n            transition: \"opacity 0.3s ease-out\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    BB.createCheckerDataUrl(4, function(url) {\r\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\r\n    });\r\n    let largeThumbCanvas = BB.canvas(200, 200);\r\n    largeThumbCanvas.style.display = \"block\";\r\n    largeThumbDiv.appendChild(largeThumbCanvas);\r\n    let largeThumbTimeout, largeThumbInTimeout;\r\n    let largeThumbInDocument = false;\r\n\r\n\r\n    let klCanvasLayerArr = klCanvas.getLayers();\r\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\r\n    let div = document.createElement(\"div\");\r\n    div.style.marginRight = \"10px\";\r\n    div.style.marginBottom = \"10px\";\r\n    div.style.marginLeft = \"10px\";\r\n    div.style.marginTop = \"10px\";\r\n    div.style.cursor = \"default\";\r\n\r\n    let listdiv = document.createElement(\"div\");\r\n    BB.css(listdiv, {\r\n        width: width + \"px\",\r\n        position: \"relative\"\r\n\r\n    });\r\n\r\n\r\n    function renameLayer(layer) {\r\n        let div = document.createElement('div');\r\n\r\n        let label = BB.el({\r\n            content: LANG('layers-rename-name') + ':',\r\n            css: {\r\n                marginRight: '5px'\r\n            }\r\n        });\r\n\r\n        const row = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        let input = document.createElement('input');\r\n        input.value = klCanvas.getLayer(layer).name;\r\n        input.setAttribute('data-ignore-focus', 'true');\r\n        const clearBtn = BB.el({\r\n            tagName: 'Button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n            title: LANG('layers-rename-clear'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: () => {\r\n                input.value = '';\r\n                input.focus();\r\n            }\r\n        });\r\n        const suggestions = [\r\n            LANG('layers-rename-sketch'),\r\n            LANG('layers-rename-colors'),\r\n            LANG('layers-rename-lines'),\r\n            LANG('background'),\r\n            LANG('layers-rename-foreground'),\r\n        ];\r\n        const suggestionBtns = [];\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginTop: '5px',\r\n                marginLeft: '-5px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        suggestions.forEach(item => {\r\n            const btn = BB.el({\r\n                parent: row2,\r\n                tagName: 'Button',\r\n                content: item,\r\n                onClick: () => {\r\n                    input.value = btn.textContent;\r\n                },\r\n                css: {\r\n                    margin: '5px 0 0 5px',\r\n                }\r\n            });\r\n            suggestionBtns.push(btn);\r\n        });\r\n\r\n        div.appendChild(label);\r\n        label.append(row, row2);\r\n        row.append(input, clearBtn);\r\n\r\n        setTimeout(function() {\r\n            input.focus();\r\n            input.select();\r\n        }, 10);\r\n\r\n        popup({\r\n            target: p_rootDiv,\r\n            message: `<b>${LANG('layers-rename-title')}</b>`,\r\n            div: div,\r\n            buttons: [LANG('layers-rename'), 'Cancel'],\r\n            primaries: [LANG('layers-rename')],\r\n            callback: function (val) {\r\n                BB.destroyEl(clearBtn);\r\n                suggestionBtns.forEach(item => {\r\n                    BB.destroyEl(item);\r\n                });\r\n                suggestionBtns.splice(0, suggestionBtns.length);\r\n                if (val === LANG('layers-rename')) {\r\n                    if (input.value === klCanvas.getLayer(layer).name) {\r\n                        return;\r\n                    }\r\n                    klCanvas.renameLayer(layer, input.value);\r\n                    createLayerList();\r\n                    klHistory.pause(true);\r\n                    updatefunc(layer);\r\n                    klHistory.pause(false);\r\n                }\r\n            },\r\n            clickOnEnter: LANG('layers-rename')\r\n        });\r\n    }\r\n\r\n\r\n    let layerListEl = BB.el({});\r\n\r\n    (div as any).disableButtons = function(){}; //probably remove\r\n    (div as any).enableButtons = function(){}; //probably remove\r\n    let addnewBtn = document.createElement(\"button\");\r\n    let duplicateBtn = document.createElement(\"button\");\r\n    let mergeBtn = document.createElement(\"button\");\r\n    let removeBtn = document.createElement(\"button\");\r\n    let renameBtn = document.createElement(\"button\");\r\n\r\n    function createButtons() {\r\n        let div = document.createElement(\"div\");\r\n        function async() {\r\n            BB.makeUnfocusable(addnewBtn);\r\n            BB.makeUnfocusable(duplicateBtn);\r\n            BB.makeUnfocusable(mergeBtn);\r\n            BB.makeUnfocusable(removeBtn);\r\n            BB.makeUnfocusable(renameBtn);\r\n\r\n            addnewBtn.style.cssFloat = 'left';\r\n            duplicateBtn.style.cssFloat = 'left';\r\n            mergeBtn.style.cssFloat = 'left';\r\n            removeBtn.style.cssFloat = 'left';\r\n            renameBtn.style.cssFloat = 'left';\r\n\r\n            addnewBtn.title = LANG('layers-new');\r\n            duplicateBtn.title = LANG('layers-duplicate');\r\n            removeBtn.title = LANG('layers-remove');\r\n            mergeBtn.title = LANG('layers-merge');\r\n            renameBtn.title = LANG('layers-rename-title');\r\n\r\n            addnewBtn.style.paddingLeft = \"5px\";\r\n            addnewBtn.style.paddingRight = \"3px\";\r\n\r\n            removeBtn.style.paddingLeft = \"5px\";\r\n            removeBtn.style.paddingRight = \"3px\";\r\n\r\n            duplicateBtn.style.paddingLeft = \"5px\";\r\n            duplicateBtn.style.paddingRight = \"3px\";\r\n\r\n            mergeBtn.style.paddingLeft = \"5px\";\r\n            mergeBtn.style.paddingRight = \"3px\";\r\n\r\n            renameBtn.style.height = \"30px\";\r\n            renameBtn.style.lineHeight = \"20px\";\r\n\r\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n            addnewBtn.style.marginRight = \"5px\";\r\n            removeBtn.style.marginRight = \"5px\";\r\n            duplicateBtn.style.marginRight = \"5px\";\r\n            mergeBtn.style.marginRight = \"5px\";\r\n            div.appendChild(addnewBtn);\r\n            div.appendChild(removeBtn);\r\n            div.appendChild(duplicateBtn);\r\n            div.appendChild(mergeBtn);\r\n            div.appendChild(renameBtn);\r\n            div.appendChild(BB.el({\r\n                css: {\r\n                    clear: 'both'\r\n                }\r\n            }));\r\n\r\n            let clearboth = document.createElement(\"div\");\r\n            clearboth.style.clear = \"both\";\r\n            clearboth.style.height = \"10px\";\r\n            div.appendChild(clearboth);\r\n\r\n\r\n            addnewBtn.onclick = function () {\r\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex = selectedSpotIndex + 1;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            duplicateBtn.onclick = function () {\r\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex++;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            removeBtn.onclick = function () {\r\n                if (layerElArr.length <= 1) {\r\n                    return;\r\n                }\r\n\r\n                klCanvas.removeLayer(selectedSpotIndex);\r\n                if (selectedSpotIndex > 0) {\r\n                    selectedSpotIndex--;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n                if (klCanvasLayerArr.length === 1) {\r\n                    removeBtn.disabled = true;\r\n                }\r\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                    addnewBtn.disabled = false;\r\n                    duplicateBtn.disabled = false;\r\n                }\r\n            };\r\n            mergeBtn.onclick = function () {\r\n                if (selectedSpotIndex <= 0) {\r\n                    return;\r\n                }\r\n\r\n                function mergeDialog(p) {\r\n                    let div = document.createElement(\"div\");\r\n                    div.innerHTML = LANG('layers-merge-description');\r\n\r\n                    let options = new Options({\r\n                        optionArr: [\r\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n                            {id: 'source-in', label: 'source-in'},\r\n                            {id: 'source-out', label: 'source-out'},\r\n                            {id: 'source-atop', label: 'source-atop'},\r\n                            {id: 'destination-in', label: 'destination-in'},\r\n                            {id: 'destination-out', label: 'destination-out'},\r\n                            {id: 'destination-atop', label: 'destination-atop'},\r\n                            {id: 'xor', label: 'xor'}\r\n                        ],\r\n                        initId: p.mixModeStr,\r\n                        onChange: function(id) {\r\n                            update();\r\n                        },\r\n                        isSmall: true\r\n                    });\r\n                    options.getElement().style.marginTop = '5px';\r\n                    div.appendChild(options.getElement());\r\n\r\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n                    preview.title = LANG('preview');\r\n                    let spacer = document.createElement(\"div\");\r\n                    spacer.innerHTML = \"<br/>\";\r\n                    spacer.style.clear = \"both\";\r\n                    div.appendChild(spacer);\r\n                    div.appendChild(preview);\r\n                    BB.css(preview, {\r\n                        display: \"block\",\r\n                        marginLeft: \"auto\",\r\n                        marginRight: \"auto\",\r\n                        colorScheme: 'only light',\r\n                    });\r\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\r\n                    BB.createCheckerDataUrl(4, function(url) {\r\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\r\n                    });\r\n\r\n                    let alphaCanvas = BB.copyCanvas(preview);\r\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n                    function update() {\r\n                        let ctx = preview.getContext(\"2d\");\r\n                        ctx.save();\r\n                        ctx.clearRect(0, 0, preview.width, preview.height);\r\n                        if (preview.width > p.topCanvas.width) {\r\n                            ctx.imageSmoothingEnabled = false;\r\n                        }\r\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n                        if (options.getValue() === 'as-alpha') {\r\n                            ctx.globalCompositeOperation = 'destination-in';\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n                        } else {\r\n                            ctx.globalCompositeOperation = options.getValue();\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n                        }\r\n                        ctx.restore();\r\n                    }\r\n\r\n                    update();\r\n\r\n\r\n                    let keyListener = new BB.KeyListener({\r\n                        onDown: function(keyStr) {\r\n                            if (keyStr === 'right') {\r\n                                options.next();\r\n                            }\r\n                            if (keyStr === 'left') {\r\n                                options.previous();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    popup({\r\n                        target: p_rootDiv,\r\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n                        div: div,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (val) {\r\n                            keyListener.destroy();\r\n                            options.destroy();\r\n                            if (val === \"Ok\") {\r\n                                p.callback(options.getValue());\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                mergeDialog({\r\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\r\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\r\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\r\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\r\n                    callback: function (mode) {\r\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\r\n                        klCanvasLayerArr = klCanvas.getLayers();\r\n                        selectedSpotIndex--;\r\n                        if (klCanvasLayerArr.length === 1) {\r\n                            removeBtn.disabled = true;\r\n                        }\r\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                            addnewBtn.disabled = false;\r\n                            duplicateBtn.disabled = false;\r\n                        }\r\n                        createLayerList();\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                });\r\n            };\r\n\r\n            renameBtn.onclick = function () {\r\n                renameLayer(selectedSpotIndex);\r\n            };\r\n        }\r\n        setTimeout(async, 1);\r\n        return div;\r\n    }\r\n    div.appendChild(createButtons());\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    {\r\n        modeWrapper = BB.el({\r\n            content: LANG('layers-blending') + '&nbsp;',\r\n            css: {\r\n                fontSize: '15px'\r\n            }\r\n        });\r\n\r\n        modeSelect = new Select({\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            onChange: function(val) {\r\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\r\n                (div as any).update(selectedSpotIndex);\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        modeWrapper.appendChild(modeSelect.getElement());\r\n        div.appendChild(modeWrapper);\r\n\r\n    }\r\n\r\n\r\n    function createLayerList() {\r\n        oldHistoryState = klHistory.getState();\r\n        function createLayerEntry(index) {\r\n            let layerName = klCanvas.getLayer(index).name;\r\n            let opacity = klCanvasLayerArr[index].opacity;\r\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\r\n\r\n            let layer = document.createElement(\"div\");\r\n            layer.className = \"layerBox\";\r\n            layerElArr[index] = layer;\r\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                width: \"250px\",\r\n                height: \"34px\",\r\n                backgroundColor: \"rgb( 220, 220, 220)\",\r\n                border: \"1px solid #aaa\",\r\n                position: \"absolute\",\r\n                left: \"0 px\",\r\n                top: (layer as any).posY + \"px\",\r\n                transition: \"all 0.1s linear\",\r\n                borderRadius: \"5px\",\r\n                boxSizing: 'border-box'\r\n            });\r\n            let innerLayer = document.createElement(\"div\");\r\n            BB.css(innerLayer, {\r\n                position: \"relative\"\r\n            });\r\n\r\n            let container1 = document.createElement(\"div\");\r\n            BB.css(container1, {\r\n                width: \"250px\",\r\n                height: \"34px\"\r\n            });\r\n            let container2 = document.createElement(\"div\");\r\n            layer.appendChild(innerLayer);\r\n            innerLayer.appendChild(container1);\r\n            innerLayer.appendChild(container2);\r\n\r\n            (layer as any).spot = index;\r\n\r\n            //thumb\r\n            {\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                let thc = thumb.getContext(\"2d\");\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css((layer as any).thumb, {\r\n                    position: \"absolute\",\r\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\r\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\r\n                    colorScheme: 'only light',\r\n                });\r\n                BB.createCheckerDataUrl(4, function(url) {\r\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                (layer as any).label = document.createElement(\"div\");\r\n                (layer as any).lname = layerName;\r\n                (layer as any).label.append((layer as any).lname);\r\n\r\n                BB.css((layer as any).label, {\r\n                    position: \"absolute\",\r\n                    left: (1 + 32 + 5) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    width: \"170px\",\r\n                    height: \"20px\",\r\n                    overflow: \"hidden\",\r\n                    color: \"#666\",\r\n                    whiteSpace: 'nowrap'\r\n                });\r\n\r\n                (layer as any).label.ondblclick = function() {\r\n                    renameLayer((layer as any).spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                (layer as any).opacityLabel = document.createElement(\"div\");\r\n                (layer as any).opacity = opacity;\r\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\r\n\r\n                BB.css((layer as any).opacityLabel, {\r\n                    position: \"absolute\",\r\n                    left: (250 - 1 - 5 - 50) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    textAlign: \"right\",\r\n                    width: \"50px\",\r\n                    color: \"#666\",\r\n                    transition: \"color 0.2s ease-in-out\"\r\n                });\r\n            }\r\n\r\n            let oldOpacity;\r\n            let opacitySlider = new PointSlider({\r\n                init: (layer as any).opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: function(sliderValue, isFirst, isLast) {\r\n                    if (isFirst) {\r\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\r\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                }\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px'\r\n            });\r\n            (layer as any).opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    largeThumbCanvas.width = thumbDimensions.width;\r\n                    largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                let ctx = largeThumbCanvas.getContext(\"2d\");\r\n                ctx.save();\r\n                if (largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(largeThumbDiv, {\r\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\r\n                    opacity: '0'\r\n                });\r\n                if (largeThumbInDocument === false) {\r\n                    p_rootDiv.appendChild(largeThumbDiv);\r\n                    largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(largeThumbInTimeout);\r\n                largeThumbInTimeout = setTimeout(function () {\r\n                    BB.css(largeThumbDiv, {\r\n                        opacity: '1'\r\n                    });\r\n                }, 20);\r\n                clearTimeout(largeThumbTimeout);\r\n            });\r\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\r\n                clearTimeout(largeThumbInTimeout);\r\n                BB.css(largeThumbDiv, {\r\n                    opacity: '0'\r\n                });\r\n                clearTimeout(largeThumbTimeout);\r\n                largeThumbTimeout = setTimeout(function () {\r\n                    if (!largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    p_rootDiv.removeChild(largeThumbDiv);\r\n                    largeThumbInDocument = false;\r\n                }, 300);\r\n            });\r\n\r\n            container1.appendChild((layer as any).thumb);\r\n            container1.appendChild((layer as any).label);\r\n            container1.appendChild((layer as any).opacityLabel);\r\n            container1.appendChild(opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            function dragEventHandler(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: \"box-shadow 0.3s ease-in-out\"\r\n                    });\r\n                    //dragContainer.appendChild(layer);\r\n                    layer.style.zIndex = '1';\r\n                    lastpos = (layer as any).spot;\r\n                    freshSelection = false;\r\n                    if (!(layer as any).isSelected) {\r\n                        freshSelection = true;\r\n                        (div as any).activateLayer((layer as any).spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\r\n                        });\r\n                    }\r\n                    (layer as any).posY += event.dY;\r\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    layer.style.top = corrected + \"px\";\r\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: \"all 0.1s linear\"\r\n                    });\r\n                    setTimeout(function () {\r\n                        BB.css(layer, {\r\n                            boxShadow: \"\"\r\n                        });\r\n                    }, 20);\r\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    //regularContainer.appendChild(layer);\r\n                    layer.style.zIndex = \"\";\r\n                    let newSpot = posToSpot((layer as any).posY);\r\n                    let oldSpot = (layer as any).spot;\r\n                    move((layer as any).spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        updatefunc(selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            }\r\n\r\n            (layer as any).pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                maxPointers: 1,\r\n                onPointer: dragEventHandler\r\n            });\r\n\r\n            layerListEl.appendChild(layer);\r\n        }\r\n        layerElArr = [];\r\n        while (layerListEl.firstChild) {\r\n            let child = layerListEl.firstChild;\r\n            (child as any).pointerListener.destroy();\r\n            (child as any).opacitySlider.destroy();\r\n            layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        (div as any).activateLayer(selectedSpotIndex);\r\n        updateHeight();\r\n    }\r\n\r\n\r\n    listdiv.appendChild(layerListEl);\r\n    div.appendChild(listdiv);\r\n\r\n\r\n    function posToSpot(p) {\r\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\r\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    let lastpos = 0;\r\n\r\n    //update css position of all layers that are not being dragged, while dragging\r\n    function updateLayersVerticalPosition(id, newspot) {\r\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            if (layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = layerElArr[i].spot;\r\n            if (layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n        }\r\n        lastpos = newspot;\r\n    }\r\n\r\n    function move(oldSpotIndex, newSpotIndex) {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            (function (i) {\r\n                let posy = layerElArr[i].spot; // <- here\r\n                if (layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (layerElArr[i].spot > oldSpotIndex)\r\n                        posy--;\r\n                    if (posy >= newSpotIndex)\r\n                        posy++;\r\n                }\r\n                layerElArr[i].spot = posy;\r\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n            }(i));\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        selectedSpotIndex = newSpotIndex;\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    }\r\n\r\n\r\n    //updating the thumbs in interval\r\n    //don't update when: manager not visible || layer didn't change || is drawing\r\n    let updateThumbsInterval = setInterval(function() {\r\n        if (div.style.display !== \"block\") {\r\n            return;\r\n        }\r\n\r\n        let historyState = klHistory.getState();\r\n        if (historyState === oldHistoryState) {\r\n            return;\r\n        }\r\n        oldHistoryState = historyState;\r\n\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\r\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\r\n                ctx.save();\r\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n    }, 1);\r\n\r\n    function updateHeight() {\r\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    (div as any).update = function (activeLayerSpotIndex) {\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\r\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n            addnewBtn.disabled = true;\r\n            duplicateBtn.disabled = true;\r\n        } else {\r\n            addnewBtn.disabled = false;\r\n            duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(function() {\r\n            createLayerList();\r\n        }, 1);\r\n    };\r\n    (div as any).getSelected = function () {\r\n        return selectedSpotIndex;\r\n    };\r\n    (div as any).activateLayer = function (spotIndex) {\r\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\r\n        }\r\n        selectedSpotIndex = spotIndex;\r\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot) {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\r\n                layerElArr[i].label.style.color = \"#000\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\r\n                layerElArr[i].opacitySlider.setActive(true);\r\n                layerElArr[i].isSelected = true;\r\n            } else {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\r\n                layerElArr[i].label.style.color = \"#666\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\r\n                layerElArr[i].opacitySlider.setActive(false);\r\n                layerElArr[i].isSelected = false;\r\n            }\r\n        }\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    };\r\n    (div as any).setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeThumbDiv, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeThumbDiv, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n    createLayerList();\r\n\r\n    return div;\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"93PHH\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"96Xkq\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hKRw5\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7jAPh\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"l0ZHH\");","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\r\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\n\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: IMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    },\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            }\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [].concat(params.projectObj.layers);\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: IMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                let item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"reset\",\r\n            params: [p] // dont screw with p\r\n        });\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        let origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            let tmp1Ctx = tmp1.getContext('2d');\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                let layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                let layerContext = layerCanvas.getContext('2d');\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            let layerCanvas = this.layerCanvasArr[i];\r\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\r\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"addLayer\",\r\n            params: [selected - 1]\r\n        });\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"duplicateLayer\",\r\n            params: [i]\r\n        });\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return this.layerCanvasArr[i].getContext(\"2d\");\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"removeLayer\",\r\n            params: [i]\r\n        });\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"renameLayer\",\r\n            params: [i, name]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerOpacity\",\r\n            params: [i, o]\r\n        });\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: [\"canvas\"],\r\n                action: \"moveLayer\",\r\n                params: [i, d]\r\n            });\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            let temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"mergeLayers\",\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\r\n        });\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0)\r\n            return;\r\n        let temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        let ctx = temp.getContext(\"2d\");\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        let temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        let tempCtx = temp.getContext(\"2d\");\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.appendChild(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.appendChild(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerFill\",\r\n            params: [layerIndex, colorObj, compositeOperation]\r\n        });\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB, // fill color\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: 'current' | 'all' | 'above',\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = srcCanvas.getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (opacity === 1) {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = rgb.r;\r\n                    targetData[i * 4 + 1] = rgb.g;\r\n                    targetData[i * 4 + 2] = rgb.b;\r\n                    targetData[i * 4 + 3] = 255;\r\n                }\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                    targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                    targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                    targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, targetImageData]\r\n        });\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawShape\",\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        });\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"text\",\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        });\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, imageData],\r\n        });\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"clearLayer\",\r\n            params: [layerIndex]\r\n        });\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: item.getContext(\"2d\"),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        id: number;\r\n    } {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        let ctx = this.pickCanvas.getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        let imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"setMixMode\",\r\n            params: [layerIndex, '' + mixModeStr],\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\n/**\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\n * So, my own implementation. can handle tolerance, grow, opacity.\n * Needs to be optimized.\n */\n\n/**\n * Set values in data within rect to 254, unless they're 255\n *\n * @param data Uint8Array\n * @param width int\n * @param x0 int\n * @param y0 int\n * @param x1 int >x0\n * @param y1 int >y0\n */\nfunction fillRect(data, width, x0, y0, x1, y1) {\n    for (let x = x0; x <= x1; x++) {\n        for (let y = y0; y <= y1; y++) {\n            if (data[y * width + x] === 255) {\n                continue;\n            }\n            data[y * width + x] = 254;\n        }\n    }\n}\n\nlet mx, my;\n\n/**\n * Get index i moved by dX, dY. in array with dimensions width height.\n * Returns null if outside bounds.\n *\n * @param width int\n * @param height int\n * @param i int\n * @param dX int\n * @param dY int\n * @returns {null|*}\n */\nfunction moveIndex(width, height, i, dX, dY) {\n    mx = i % width + dX;\n    my = Math.floor(i / width) + dY;\n\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\n        return null;\n    }\n\n    return my * width + mx;\n}\n\n/**\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\n * returns false if already filled, or i is null\n *\n * @param srcArr Uint8Array rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param initRgba rgba\n * @param tolerance int 0 - 255\n * @param i int - srcArr index\n * @returns {boolean}\n */\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\n    if (i === null || targetArr[i] === 255) {\n        return false;\n    }\n\n    if (\n        srcArr[i * 4] === initRgba[0] &&\n        srcArr[i * 4 + 1] === initRgba[1] &&\n        srcArr[i * 4 + 2] === initRgba[2] &&\n        srcArr[i * 4 + 3] === initRgba[3]\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    if (\n        tolerance > 0 &&\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    return false;\n}\n\n\n/**\n *\n * @param srcArr Uint8Array rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param px int\n * @param py int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\n\n    let initRgba = [\n        srcArr[(py * width + px) * 4],\n        srcArr[(py * width + px) * 4 + 1],\n        srcArr[(py * width + px) * 4 + 2],\n        srcArr[(py * width + px) * 4 + 3]\n    ];\n\n    if (isContiguous) {\n        let q = [];\n        q.push(py * width + px);\n        targetArr[py * width + px] = 255;\n\n        let i, e;\n        while (q.length) {\n            i = q.pop();\n\n            // queue up unfilled neighbors\n            e = moveIndex(width, height, i, -1, 0); // left\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 1, 0); // right\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 0, -1); // up\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 0, 1); // bottom\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n        }\n    } else {\n        for (let i = 0; i < width * height; i++) {\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\n        }\n    }\n\n\n    // grow\n    if (grow === 0) {\n        return;\n    }\n\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // the rectangle has the value 254, or else it mess it all up.\n    // after it's all done, replaces it with 255\n    let x0, x1, y0, y1;\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            if (targetArr[y * width + x] !== 255) {\n                continue;\n            }\n\n            // bounds of rectangle\n            x0 = x;\n            x1 = x;\n            y0 = y;\n            y1 = y;\n\n            l = targetArr[(y) * width + x - 1] !== 255;\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\n            t = targetArr[(y - 1) * width + x] !== 255;\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\n            r = targetArr[(y) * width + x + 1] !== 255;\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\n            b = targetArr[(y + 1) * width + x] !== 255;\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\n\n            if (l) { // left\n                x0 = x - grow;\n            }\n            if (l && tl && t) { // top left\n                x0 = x - grow;\n                y0 = y - grow;\n            }\n            if (t) { // top\n                y0 = Math.min(y0, y - grow);\n            }\n            if (t && tr && r) { // top right\n                y0 = Math.min(y0, y - grow);\n                x1 = x + grow;\n            }\n            if (r) { // right\n                x1 = Math.max(x1, x + 1 * grow);\n            }\n            if (r && br && b) { // bottom right\n                x1 = Math.max(x1, x + 1 * grow);\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n            if (b) { // bottom\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n            if (b && bl && l) { // bottom left\n                x0 = Math.min(x0, x - 1 * grow);\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\n                continue;\n            }\n\n            fillRect(\n                targetArr,\n                width,\n                Math.max(0, x0),\n                Math.max(0, y0),\n                Math.min(width - 1, x1),\n                Math.min(height - 1, y1)\n            );\n        }\n    }\n    for (let i = 0; i < width * height; i++) {\n        if (targetArr[i] === 254) {\n            targetArr[i] = 255;\n        }\n    }\n\n}\n\n\n/**\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\n *\n * returns {\n *     data: Uint8Array\n * }\n *\n * @param rgbaArr Uint8Array rgba\n * @param width int\n * @param height int\n * @param x int\n * @param y int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n * @returns {{data: Uint8Array}}\n */\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\n    x = Math.round(x);\n    y = Math.round(y);\n\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\n\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\n\n    return {\n        data: resultArr\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IShapeToolObject} from '../kl.types';\n\n\n/**\n * Input processor for shape tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n *\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\n * @constructor\n */\nexport function ShapeTool(p) {\n\n    let downX, downY, downAngleRad;\n\n    this.onDown = function(x, y, angleRad) {\n        downX = x;\n        downY = y;\n        downAngleRad = angleRad;\n    };\n\n    this.onMove = function(x, y) {\n        p.onShape(false, downX, downY, x, y, downAngleRad);\n    };\n\n    this.onUp = function(x, y) {\n        p.onShape(true, downX, downY, x, y, downAngleRad);\n    };\n}\n\n/**\n * Draw a shape (rectangle, ellipse, line)\n *\n * @param ctx\n * @param shapeObj\n */\nexport function drawShape(\n    ctx: CanvasRenderingContext2D,\n    shapeObj: IShapeToolObject,\n) {\n\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\n        const lineWidth = Math.round(shapeObj.lineWidth);\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\n\n        // --- prep canvas ---\n        ctx.save();\n        if (shapeObj.opacity) {\n            ctx.globalAlpha = shapeObj.opacity;\n        }\n        if (shapeObj.isEraser) {\n            ctx.globalCompositeOperation = 'destination-out';\n        }\n        ctx.rotate(-shapeObj.angleRad);\n        if (shapeObj.fillRgb) {\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(shapeObj.fillRgb);\n        } else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(shapeObj.strokeRgb);\n            ctx.lineWidth = lineWidth;\n        }\n\n        let x1 = shapeObj.x1;\n        let y1 = shapeObj.y1;\n        let x2 = shapeObj.x2;\n        let y2 = shapeObj.y2;\n\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n            x2 = rotated.x;\n            y2 = rotated.y;\n\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                    x2 = x1;\n                } else { // left or right\n                    y2 = y1;\n                }\n            }\n        }\n\n        let x = x1;\n        let y = y1;\n        let dX = x2 - x1;\n        let dY = y2 - y1;\n\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\n\n            let rx = r1.x;\n            let ry = r1.y;\n            let rdX = r2.x - r1.x;\n            let rdY = r2.y - r1.y;\n\n            if (Math.abs(rdX) < Math.abs(rdY)) {\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            } else {\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            }\n            r2.x = rx + rdX;\n            r2.y = ry + rdY;\n\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\n\n            x1 = r1.x;\n            y1 = r1.y;\n            x2 = r2.x;\n            y2 = r2.y;\n\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n\n        let p1;\n        let p2;\n        if (shapeObj.type === 'line') { // --- line ---\n\n            // rounded\n            const x1r = Math.round(x1);\n            const y1r = Math.round(y1);\n            const x2r = Math.round(x2);\n            const y2r = Math.round(y2);\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (lineWidth % 2 === 0) {\n\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r,\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r,\n                    };\n\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f,\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f,\n                    };\n\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1,\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2,\n                    };\n                }\n\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f,\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f,\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n\n        } else if (shapeObj.type === 'rect') { // --- rect ---\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) {\n                        x1 += 1;\n                    }\n                    if (y1 % 1 === 0) {\n                        y1 += 1;\n                    }\n                    if (x2 % 1 === 0) {\n                        x2 += 1;\n                    }\n                    if (y2 % 1 === 0) {\n                        y2 += 1;\n                    }\n\n                    p1 = {\n                        x: x1 < x2 ? x1f : x2f,\n                        y: y1 < y2 ? y1f : y2f,\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n\n                } else {\n                    if (lineWidth % 2 === 0) {\n                        p1 = {\n                            x: x1f,\n                            y: y1f,\n                        };\n                        p2 = {\n                            x: x2f,\n                            y: y2f,\n                        };\n                    } else {\n                        p1 = {\n                            x: x1f + 0.5,\n                            y: y1f + 0.5,\n                        };\n                        p2 = {\n                            x: x2f + 0.5,\n                            y: y2f + 0.5,\n                        };\n                    }\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1,\n                };\n                p2 = {\n                    x: x2,\n                    y: y2,\n                };\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            p2.x = p2.x - p1.x;\n            p2.y = p2.y - p1.y;\n\n            if (shapeObj.fillRgb) {\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\n            } else {\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\n            }\n\n        } else {  // --- circle ---\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n\n            ctx.beginPath();\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) {\n                ctx.fill();\n            } else {\n                ctx.stroke();\n            }\n        }\n\n\n        ctx.restore();\n\n    } else {\n        throw new Error('unknown shape');\n    }\n}","import {BB} from '../../bb/bb';\nimport {IRect} from '../../bb/bb.types';\n\nexport interface IRenderTextParam {\n    textStr: string; // text to be drawn. can contain newlines\n    x: number;\n    y: number;\n    size: number;\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\n    align: 'left' | 'center' | 'right'; // default 'left'\n    isBold: boolean; // default false\n    isItalic: boolean; // default false\n    angleRad: number; // default 0 - rotates around x y\n    lineHeight?: number; // pixels\n    color: string;\n    isDebug?: boolean;\n}\n\n\n/**\n * Draw text on a canvas.\n *\n * @param canvas\n * @param p\n * @returns - bounds. coords relative to p.x p.y\n */\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\n\n    // always at least a space. so bounds aren't just a dot\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\n\n    // --- create el ---\n    // create an actual dom element. figure out where exactly each letter is positioned.\n    // that way multiline is feasible. canvas can't do multiline or text-align\n    let outer = BB.el({\n        css: {\n            position: 'fixed',\n            left: '0',\n            top: '0',\n            width: '100000px',\n            fontSize: p.size + 'px',\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\n        }\n    });\n    let div = BB.el({\n        parent: outer,\n        css: {\n            display: 'inline-block',\n            textAlign: p.align ? p.align : 'left',\n            fontFamily: p.font ? p.font : 'sans-serif',\n            fontSize: p.size + 'px',\n            fontWeight: p.isBold ? 'bold' : 'normal',\n            fontStyle: p.isItalic ? 'italic' : 'normal',\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\n\n\n            opacity: '0',\n            pointerEvents: 'none'\n        }\n    });\n    let spanStr = '';\n    let replaceObj = {\n        \"\\n\": '<br>',\n        \" \": '&nbsp;',\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\n    };\n    for (let i = 0; i < textStr.length; i++) {\n        if (textStr[i] === \"\\n\") {\n            div.appendChild(BB.el({\n                tagName: 'span',\n                textContent: spanStr,\n                css: {\n                    whiteSpace: 'pre'\n                }\n            }));\n            spanStr = '';\n            div.appendChild(BB.el({\n                tagName: 'br'\n            }));\n            continue;\n        }\n        spanStr += textStr[i].replace(\"\\t\", '    ');\n    }\n    div.appendChild(BB.el({\n        tagName: 'span',\n        textContent: spanStr,\n        css: {\n            whiteSpace: 'pre'\n        }\n    }));\n    document.body.appendChild(outer);\n\n\n    // --- determine bounds ---\n    let bounds = {\n        x0: 99999999,\n        y0: 99999999,\n        x1: 0,\n        y1: 0\n    }\n    for (let i = 0; i < div.children.length; i++) {\n        let el = div.children[i] as HTMLElement;\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\n    }\n\n    // --- draw ---\n    let ctx = canvas.getContext('2d');\n    ctx.save();\n\n    let font = [];\n    if (p.isItalic) {\n        font.push('italic');\n    }\n    if (p.isBold) {\n        font.push('bold');\n    }\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\n    ctx.font = font.join(' ');\n    ctx.fillStyle = p.color ? p.color : '#000';\n\n    let x = p.x;\n    let y = p.y;\n    if (p.align === 'right') {\n        x += -bounds.x1 + bounds.x0;\n    }\n    if (p.align === 'center') {\n        x += (-bounds.x1 + bounds.x0) / 2;\n    }\n    ctx.translate(p.x, p.y);\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\n    ctx.translate(-p.x, -p.y);\n    ctx.translate(x, y);\n\n    // fill\n    for (let i = 0; i < div.children.length; i++) {\n        let el = div.children[i] as HTMLElement;\n\n        //ctx.fillText(el.innerText, 0, 0);\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\n    }\n\n    if (p.isDebug) {\n        ctx.lineWidth = 1;\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\n        ctx.restore();\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\n    } else {\n        ctx.restore();\n    }\n\n    document.body.removeChild(outer);\n\n    return {\n        x: x - p.x,\n        y: y - p.y -p.size * 0.85,\n        width: bounds.x1 - bounds.x0,\n        height: bounds.y1 - bounds.y0\n    };\n}","import {BB} from '../../bb/bb';\nimport {IKlProject} from '../kl.types';\n\nexport function drawProject(project: IKlProject, factor) {\n    let resultCanvas = BB.canvas(\n        Math.max(1, Math.round(project.width * factor)),\n        Math.max(1, Math.round(project.height * factor))\n    );\n    let ctx = resultCanvas.getContext(\"2d\");\n    ctx.save();\n    if (factor > 1) {\n        ctx.imageSmoothingEnabled = false;\n    }\n    for (let i = 0; i < project.layers.length; i++) {\n        if (project.layers[i].opacity === 0) {\n            continue;\n        }\n        ctx.globalAlpha = project.layers[i].opacity;\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\n    }\n    ctx.restore();\n    return resultCanvas;\n}","import {IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {TTranslationCode} from '../../../languages/languages';\n\nexport function translateBlending(blendMode?: IMixMode): string {\n    if (!blendMode) {\n        return LANG('layers-blend-normal');\n    }\n\n    const codes: {\n        [key: string]: TTranslationCode\n    } = {\n        'source-over': 'layers-blend-normal',\n        'darken': 'layers-blend-darken',\n        'multiply': 'layers-blend-multiply',\n        'color-burn': 'layers-blend-color-burn',\n        'lighten': 'layers-blend-lighten',\n        'screen': 'layers-blend-screen',\n        'color-dodge': 'layers-blend-color-dodge',\n        'overlay': 'layers-blend-overlay',\n        'soft-light': 'layers-blend-soft-light',\n        'hard-light': 'layers-blend-hard-light',\n        'difference': 'layers-blend-difference',\n        'exclusion': 'layers-blend-exclusion',\n        'hue': 'layers-blend-hue',\n        'saturation': 'layers-blend-saturation',\n        'color': 'layers-blend-color',\n        'luminosity': 'layers-blend-luminosity',\n    };\n\n    if (!(blendMode in codes)) {\n        throw new Error('unknown blend mode');\n    }\n    return LANG(codes[blendMode]);\n}","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl.types';\n\n/**\n * Overlay for KlCanvasWorkspace.\n * - brush circle\n * - eyedropper circle\n * - compass needle (rotation hud)\n */\nexport class WorkspaceSvgOverlay {\n    private rootElement: SVGElement;\n    private brushCircleOuter: SVGElement;\n    private brushCircleInner: SVGElement;\n    private pickerPreviewBorder: SVGElement;\n    private pickerPreviewCol: SVGElement;\n    private readonly compassSize: number;\n    private compass: SVGElement;\n    private compassInner: SVGElement;\n    private compassBaseCircle: SVGElement;\n    private compassLineCircle: SVGElement;\n    private compassUpperTriangle: SVGElement;\n    private compassLowerTriangle: SVGElement;\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            width: number;\n            height: number;\n        }\n    ) {\n        this.rootElement = BB.createSvg({\n            elementType: 'svg',\n            width: '' + p.width,\n            height: '' + p.height,\n        });\n        BB.css(this.rootElement, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none',\n            userSelect: 'none'\n        });\n\n        //brush circles\n        this.brushCircleOuter = BB.createSvg({\n            elementType: 'circle',\n            r: '10',\n            stroke: 'rgba(0,0,0,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.brushCircleInner = BB.createSvg({\n            elementType: 'circle',\n            r: '9',\n            stroke: 'rgba(255,255,255,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\n\n        //color picker preview circle\n        this.pickerPreviewBorder = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '22',\n            fill: 'none',\n        });\n        this.pickerPreviewBorder.style.opacity = '0';\n        this.pickerPreviewCol = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '20',\n            fill: 'none',\n        });\n        this.pickerPreviewCol.style.opacity = '0';\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\n\n\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = BB.createSvg({\n            elementType: 'g',\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\n        });\n        BB.css(this.compass, {\n            transition: 'opacity 0.25s ease-in-out',\n            opacity: '0',\n        });\n        this.compassInner = BB.createSvg({\n            elementType: 'g',\n            transform: 'rotate(45)',\n        });\n        this.compassBaseCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'rgba(0,0,0,0.9)',\n            stroke: 'none',\n            cx: '0',\n            cy: '0',\n            r: '' + this.compassSize,\n        });\n        this.compassLineCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'none',\n            stroke: 'rgba(255,255,255,0.75)',\n            'stroke-width': '1',\n            cx: '0',\n            cy: '0',\n            r: '' + (this.compassSize * 0.9),\n        });\n        this.compassUpperTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#f00',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\n        });\n        this.compassLowerTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#fff',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\n        });\n\n        this.compassInner.append(\n            this.compassBaseCircle,\n            this.compassLineCircle,\n            this.compassUpperTriangle,\n            this.compassLowerTriangle\n        );\n        this.compass.append(this.compassInner);\n        this.rootElement.append(this.compass);\n    }\n\n    getElement (): SVGElement {\n        return this.rootElement;\n    }\n\n    setSize (width: number, height: number): void {\n        this.rootElement.setAttribute('width', '' + width);\n        this.rootElement.setAttribute('height', '' + height);\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\n    }\n\n    updateCursor (p: {\n        x?: number;\n        y?: number;\n        radius?: number;\n        isVisible?: boolean;\n    }): void {\n        if ('x' in p) {\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\n        }\n        if ('y' in p) {\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\n        }\n        if ('radius' in p) {\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\n        }\n        if ('isVisible' in p) {\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateColorPreview (p: {\n        x?: number;\n        y?: number;\n        color?: IRGB;\n        isVisible?: boolean;\n    }): void {\n        if ('x' in p) {\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\n        }\n        if ('y' in p) {\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\n        }\n        if ('color' in p) {\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\n        }\n        if ('isVisible' in p) {\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateCompass (p: {\n        angleDeg?: number;\n        isVisible?: boolean;\n    }): void {\n        if ('angleDeg' in p) {\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\n        }\n        if ('isVisible' in p) {\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, ITransform} from '../kl.types';\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\nimport {klHistory} from '../history/kl-history';\n// @ts-ignore\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\n// @ts-ignore\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\n// @ts-ignore\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\n// @ts-ignore\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {KeyListener} from '../../bb/input/key-listener';\n\nexport interface IViewChangeEvent {\n    changed: ('scale' | 'angle')[];\n    angle: number;\n    scale: number;\n}\n\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'text'; // | 'transform' | 'select'\n\nconst MIN_SCALE = 1 / 16;\nconst MAX_SCALE = 64;\nenum TMode {\n    Draw,\n    Hand,\n    HandGrabbing,\n    Pick,\n    Zoom,\n    Rotate,\n    Rotating,\n    Fill,\n    Text,\n    Shape,\n}\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\n\n/**\n * Work area that displays the KlCanvas.\n * - pan, zoom, rotate (also via multi-touch)\n * - input modes: drawing, hand, pick, fill, text // transform, select\n * - drawing input events\n * - view change events\n * - eyedropper input events (pick)\n * - draws cursor, eyedropper overlay\n *\n * subscribes to klCanvas changes\n * listens to kl history for changes\n * and you can manually trigger redraw\n */\nexport class KlCanvasWorkspace {\n\n    private rootEl: HTMLElement;\n    private klCanvas: KlCanvas;\n    private renderTargetCanvas: HTMLCanvasElement;\n    private renderTargetCtx: CanvasRenderingContext2D;\n    private renderWidth: number;\n    private renderHeight: number;\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\n    private compositeCtx: CanvasRenderingContext2D;\n    private doResizeCanvas: boolean;\n    private oldTransformObj: ITransform;\n    private targetTransformObj: ITransform; // animation target\n    private highResTransformObj: ITransform; // animated, internal high res\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\n    private cursorPos: IVector2D;\n    private usesCssCursor: boolean;\n    private bgVisible: boolean;\n    private transformIsDirty: boolean;\n    private doAnimateTranslate: boolean;\n    private svgOverlay: WorkspaceSvgOverlay;\n    private emptyCanvas: HTMLCanvasElement;\n    private keyListener: KeyListener;\n    private currentMode: TMode;\n    private globalMode: TMode;\n    private renderTime: number; // for debugging - average ms per render()\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\n    private pointer: IVector2D | null; // position of cursor\n    private isDrawing: boolean;\n    private inputProcessorObj: any; // todo type\n    private currentInputProcessor: any; // todo type\n    private angleIsExtraSticky: boolean;\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\n    private pointerListener: any; // todo type - BB.PointerListener\n    private brushRadius: number;\n    private animationFrameRequested: boolean;\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\n    private lastRenderTime: number; // ms from performance.now()\n    private hideBrushCursorTimeout: number;\n    private onViewChange: (e:  IViewChangeEvent) => void;\n\n    private getRenderedTransform (): ITransform {\n        // rounded x & y so canvas is less blurry.\n        const result = this.renderedTransformObj;\n        result.x = this.highResTransformObj.x;\n        result.y = this.highResTransformObj.y;\n        result.scale = this.highResTransformObj.scale;\n        result.angle = this.highResTransformObj.angle;\n\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\n            result.x = Math.round(result.x);\n            result.y = Math.round(result.y);\n        }\n\n        return result;\n    }\n\n    private updateChangeListener (): void {\n        this.klCanvas.addChangeListener(() => {\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n    }\n\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\n        if (modeInt === this.currentMode && !doForce) {\n            return;\n        }\n        const oldMode = this.currentMode;\n        this.currentMode = modeInt;\n        this.lastRenderedState = -1;\n        if (this.currentMode === TMode.Draw) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Hand) {\n            this.rootEl.style.cursor = 'grab';\n        } else if (this.currentMode === TMode.HandGrabbing) {\n            this.rootEl.style.cursor = 'grabbing';\n        } else if (this.currentMode === TMode.Pick) {\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\n        } else if (this.currentMode === TMode.Zoom) {\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\n        } else if (this.currentMode === TMode.Rotate) {\n            this.rootEl.style.cursor = \"grab\";\n        } else if (this.currentMode === TMode.Rotating) {\n            this.rootEl.style.cursor = \"grabbing\";\n        } else if (this.currentMode === TMode.Fill) {\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Text) {\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Shape) {\n            this.rootEl.style.cursor = 'crosshair';\n        }\n\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\n            if (!oldIsHand && currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n            }\n            if (oldIsHand && !currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n            }\n        }\n\n        if (this.currentMode !== TMode.Pick) {\n            this.svgOverlay.updateColorPreview({isVisible: false});\n        }\n    }\n\n    /**\n     * returns false if no change of zoom\n     * @param stepNum\n     * @param centerX\n     * @param centerY\n     * @private\n     */\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\n        const step = Math.log2(this.targetTransformObj.scale);\n\n        let newStep = step / Math.abs(stepNum);\n        newStep += stepNum > 0 ? 1 : -1;\n        newStep = Math.round(newStep);\n        newStep *= Math.abs(stepNum);\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\n\n        //has zoomed?\n        if (newScale === this.targetTransformObj.scale) {\n            return false;\n        }\n\n\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\n        this.targetTransformObj.scale = newScale;\n\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\n\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.transformIsDirty = true;\n\n        return true;\n    }\n\n    /**\n     * mixes two transform objects. modifies A\n     * @param transformA\n     * @param transformB\n     * @param blendFactor 0 -> A, 1 -> B\n     * @private\n     */\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\n        if (transformA.angle === transformB.angle) {\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n            return;\n        }\n\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        // --- determine centerPosA, centerPosB ---\n        const centerPosA = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformA);\n        const centerPosB = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformB);\n\n        // --- centerPosMixed ---\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\n\n        // --- scale and angle ---\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n\n        // --- x and y ---\n        const mixedPos = this.canvasToWorkspaceCoord({\n            x: -w / 2,\n            y: -h / 2\n        }, transformA);\n        transformA.x = mixedPos.x;\n        transformA.y = mixedPos.y;\n    }\n\n    private render (): void {\n        if (this.doResizeCanvas) {\n            this.doResizeCanvas = false;\n            this.renderTargetCanvas.width = this.renderWidth;\n            this.renderTargetCanvas.height = this.renderHeight;\n        }\n        this.renderContext(this.renderTargetCtx);\n    }\n\n    /**\n     * is the gray background that surrounds canvas visible?\n     * @private\n     */\n    private testBgVisible (): boolean {\n        //bring workspace points (corners of workspace) into canvas coordinate system\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\n\n        const workspacePointArr = [\n            [0, 0], // top left\n            [this.renderWidth, 0], // top right\n            [this.renderWidth, this.renderHeight], // bottom right\n            [0, this.renderHeight], // bottom left\n        ];\n\n        const art = this.getRenderedTransform();\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        //transform points, then test if outside of canvas\n        for (let i = 0; i < workspacePointArr.length; i++) {\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n            if (\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\n            ){\n                //if not inside -> bg visible\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private renderContext (ctx: CanvasRenderingContext2D): void {\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        const art = this.getRenderedTransform();\n\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\n            ctx.imageSmoothingEnabled = false;\n        } else {\n            ctx.imageSmoothingEnabled = true;\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\n        }\n        //ctx.imageSmoothingEnabled = false;\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\n\n\n\n        ctx.save();\n        {\n            if (this.bgVisible) {\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\n            } else {\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\n            }\n\n\n\n            if (this.bgVisible) {\n                ctx.save();\n\n                ctx.translate(art.x, art.y);\n                ctx.scale(art.scale, art.scale);\n                ctx.rotate(art.angle);\n\n                ctx.imageSmoothingEnabled = false;\n\n                //outline\n                const borderSize = 1;\n                ctx.globalAlpha = 0.2;\n                ctx.drawImage(\n                    this.emptyCanvas,\n                    -borderSize / art.scale,\n                    -borderSize / art.scale,\n                    w + borderSize * 2 / art.scale,\n                    h + borderSize * 2 / art.scale\n                );\n                ctx.globalAlpha = 1;\n\n                //erase\n                ctx.globalCompositeOperation = 'destination-out';\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\n\n                ctx.restore();\n            }\n\n            /*const region = new Path2D();\n            region.rect(80, 10, 20, 130);\n            ctx.clip(region);*/\n\n            ctx.translate(art.x, art.y);\n            ctx.scale(art.scale, art.scale);\n            ctx.rotate(art.angle);\n\n            const layerArr = this.klCanvas.getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                if (layerArr[i].opacity > 0) {\n                    ctx.globalAlpha = layerArr[i].opacity;\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\n\n                    if (layerArr[i].canvas.compositeObj) {\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\n                        } else {\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\n                        }\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\n                    } else {\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\n                    }\n                }\n            }\n            ctx.globalAlpha = 1;\n\n\n\n        }\n        ctx.restore();\n\n        // rotation hud\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\n            this.svgOverlay.updateCompass({\n                isVisible: true,\n                angleDeg: art.angle / Math.PI * 180\n            });\n        } else {\n            this.svgOverlay.updateCompass({\n                isVisible: false\n            });\n        }\n    }\n\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\n        const art = this.getRenderedTransform();\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        let coords = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\n\n        let coords = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\n        let angleDeg = angleRad * 180 / Math.PI;\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\n\n        if (dist <= maxDistDeg) {\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n        }\n\n        return angleDeg / 180 * Math.PI;\n    }\n\n    /**\n     * angle always in range [-PI, PI]\n     * @param angleRad\n     * @private\n     */\n    private minimizeAngleRad (angleRad: number): number {\n        angleRad = angleRad % (2 * Math.PI);\n        if (angleRad > Math.PI) {\n            angleRad -= 2 * Math.PI;\n        } else if (angleRad < -Math.PI) {\n            angleRad += 2 * Math.PI;\n        }\n        return angleRad;\n    }\n\n    private resetInputProcessor (): void {\n        this.currentInputProcessor = null;\n        this.updateCursor(this.globalMode);\n        this.reqFrame(true);\n    }\n\n    private reqFrame (doRedrawCanvas?: boolean): void {\n        this.animationFrameRequested = true;\n        if (doRedrawCanvas) {\n            this.lastRenderedState = -1;\n        }\n    }\n\n    private updateLoop (): void {\n        window.requestAnimationFrame(() => this.updateLoop());\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState;\n\n        //handle variable framerate\n        const nowTime = performance.now();\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\n        this.lastRenderTime = nowTime;\n\n        if (this.animationFrameRequested || doRender) {\n            this.animationFrameRequested = false;\n            this.checkChange(elapsedFrames);\n        }\n    }\n\n    private checkChange (elapsedFrames: number): void {\n\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState ||\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\n            this.highResTransformObj.y !== this.targetTransformObj.y;\n\n        //update transform\n        if (\n            !this.doAnimateTranslate &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else if (\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            this. doAnimateTranslate = false;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else {\n            this.reqFrame(); //probably needs another frame\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\n            this.bgVisible = true; // spare yourself the calculation\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        }\n\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\n            this.svgOverlay.updateCursor({\n                x: this.pointer.x,\n                y: this.pointer.y,\n                isVisible: true\n            });\n        } else {\n            this.svgOverlay.updateCursor({isVisible: false});\n        }\n\n\n        if (doRender) {\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\n            this.lastRenderedState = newState;\n            const start = performance.now();\n            this.render();\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\n        }\n        //setTimeout(this.checkChange, 100);\n\n\n\n        if (doRender) {\n\n            //console.log('rendertime ms: ', this.renderTime);\n        }\n\n    }\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            klCanvas: any; // todo\n            width: number;\n            height: number;\n            onDraw: (val) => void; // todo\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\n            onFill: (canvasX: number, canvasY: number) => void;\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onViewChange: (e:  IViewChangeEvent) => void;\n            onUndo: () => void;\n            onRedo: () => void;\n        }\n    ) {\n        const _this = this;\n        this.rootEl = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                cursor: 'crosshair',\n                userSelect: 'none',\n                colorScheme: 'only light',\n            }\n        });\n        this.klCanvas = p.klCanvas;\n        this.onViewChange = p.onViewChange;\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\n        this.renderWidth = p.width;\n        this.renderHeight = p.height;\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\n        this.doResizeCanvas = false;\n        this.oldTransformObj = null;\n        this.targetTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.highResTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.renderedTransformObj = {\n            x: null,\n            y: null,\n            scale: null,\n            angle: null\n        };\n        this.cursorPos = {\n            x: 0,\n            y: 0\n        };\n        this.usesCssCursor = false;\n        this.bgVisible = true;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n\n        this.svgOverlay = new WorkspaceSvgOverlay({\n            width: p.width,\n            height: p.height\n        });\n\n        BB.css(this.renderTargetCanvas, {\n            userSelect: 'none',\n            pointerEvents: 'none',\n        });\n        BB.createCheckerDataUrl(8, (url) => {\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\n        });\n        this.rootEl.appendChild(this.renderTargetCanvas);\n        this.rootEl.appendChild(this.svgOverlay.getElement());\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.emptyCanvas = BB.canvas(1, 1);\n        {\n            const ctx = this.emptyCanvas.getContext('2d');\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n                if (isRepeat) {\n                    return;\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n\n                } else {\n\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if (['r', 'shift+r'].includes(comboStr)) {\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ('z' === comboStr) {\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                }\n\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\n                }\n            }\n        });\n\n        this.updateChangeListener();\n\n        this.currentMode = TMode.Draw;\n        this.globalMode = TMode.Draw;\n\n        this.renderTime = 0;\n\n        this.lastDrawEvent = null;\n\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\n            onDraw: (event) => {\n                const getMatrix = () => {\n                    const art = this.getRenderedTransform();\n                    let matrix = BB.Matrix.getIdentity();\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n                    return matrix;\n                };\n\n                if (event.type === 'line' && !this.lastDrawEvent) {\n                    const matrix = getMatrix();\n                    let coords = [event.x1, event.y1, 0, 1];\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    this.lastDrawEvent = {\n                        x: coords[0],\n                        y: coords[1],\n                        pressure: event.pressure1\n                    };\n                    return;\n                }\n\n                if ('x' in event || 'x0' in event) {\n\n                    const matrix = getMatrix();\n\n                    if ('x' in event) { //down or move\n                        let coords = [event.x, event.y, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x = coords[0];\n                        event.y = coords[1];\n                    }\n                    if ('x0' in event) { //line\n                        event.x0 = this.lastDrawEvent.x;\n                        event.y0 = this.lastDrawEvent.y;\n                        event.pressure0 = this.lastDrawEvent.pressure;\n                        let coords = [event.x1, event.y1, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x1 = coords[0];\n                        event.y1 = coords[1];\n\n                        this.lastDrawEvent = {\n                            x: event.x1,\n                            y: event.y1,\n                            pressure: event.pressure1,\n                        };\n                    }\n                }\n\n\n                if (['down', 'move'].includes(event.type)) {\n                    this.lastDrawEvent = event;\n                }\n                p.onDraw(event);\n            }\n        });\n\n        this.pointer = null;\n        this.isDrawing = false;\n\n\n        this.inputProcessorObj = {\n            draw: {\n                onPointer: (val) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Draw);\n\n                    const comboStr = this.keyListener.getComboStr();\n\n                    const event: any = {\n                        scale: this.highResTransformObj.scale\n                    };\n                    event.shiftIsPressed = comboStr === 'shift';\n                    event.pressure = val.pressure;\n                    event.isCoalesced = !!val.isCoalesced;\n\n                    if (val.type === 'pointerdown') {\n\n                        this.isDrawing = true;\n                        event.type = 'down';\n\n                    } else if (val.button) {\n                        event.type = 'move';\n\n                    } else if (val.type === 'pointerup') {\n\n                        this.isDrawing = false;\n                        event.type = 'up';\n\n                        this.linetoolProcessor.process(event);\n                        this.resetInputProcessor();\n                        return;\n                    } else {\n                        return;\n                    }\n\n                    event.x = val.relX;\n                    event.y = val.relY;\n\n                    this.linetoolProcessor.process(event);\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            fill: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Fill);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            text: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Text);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            shape: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Shape);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            hand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button)) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            spaceHand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button)) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'space') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            zoom: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Zoom);\n\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale\n                        });\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'z') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Zoom);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            picker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup'\n                        });\n\n                        if (event.type === 'pointerup') {\n                            this.resetInputProcessor();\n                        }\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            altPicker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup'\n                        });\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'alt') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            rotate: {\n                onPointer: (event) => {\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\n\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n                        //rotation done around center\n                        const centerObj = {\n                            x: this.renderWidth / 2,\n                            y: this.renderHeight / 2\n                        };\n\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\n                        let dAngleRad = angleRad - startAngleRad;\n\n                        //apply angle\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\n                        this.targetTransformObj.angle += dAngleRad;\n\n                        if (this.keyListener.isPressed('shift')) {\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n                        }\n\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\n\n                        //rotate transform.xy\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\n\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n\n                        this.transformIsDirty = true;\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['angle'],\n                            scale: this.targetTransformObj.scale,\n                            angle: this.targetTransformObj.angle\n                        });\n\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    const comboStr = this.keyListener.getComboStr();\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                }\n            }\n        };\n        this.currentInputProcessor = null;\n\n\n        this.angleIsExtraSticky = false;\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\n            onPinch: (event) => {\n\n                if (event.type === 'move') {\n\n                    if (!this.oldTransformObj) {\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\n                    }\n\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\n\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\n\n                    this.targetTransformObj.scale *= event.scale;\n                    this.targetTransformObj.angle += event.angleRad;\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\n                        this.snapAngleRad(\n                            this.targetTransformObj.angle,\n                            90,\n                            this.angleIsExtraSticky ? 12 : 4\n                        )\n                    );\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\n                        this.angleIsExtraSticky = false;\n                    }\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n\n                    //calc translation\n                    {\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\n\n\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                    }\n\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n\n                    //if (event.scale !== 1) {\n                    this.onViewChange({\n                        changed: ['scale', 'angle'],\n                        scale: this.targetTransformObj.scale,\n                        angle: this.targetTransformObj.angle\n                    });\n                    //}\n                    this.reqFrame();\n                    this.transformIsDirty = true;\n                    this.lastRenderedState = -1;\n\n\n                } else if (event.type === 'end') {\n                    this.oldTransformObj = null;\n                }\n\n\n            }\n        });\n\n        const onDoubleTap = () => {\n            let oldTransform = JSON.parse(JSON.stringify(this.targetTransformObj));\n            _this.fitView();\n            //_this.resetView(true);\n            this.lastRenderedState = -1;\n            this.reqFrame();\n\n            if (\n                oldTransform.scale !== this.targetTransformObj.scale ||\n                oldTransform.angle !== this.targetTransformObj.angle\n            ) {\n                this.onViewChange({\n                    changed: ['scale', 'angle'],\n                    angle: this.targetTransformObj.angle,\n                    scale: this.targetTransformObj.scale\n                });\n            }\n        }\n\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\n\n\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\n            fingers: 2,\n            onTap: () => {\n                p.onUndo();\n            }\n        });\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\n            fingers: 3,\n            onTap: () => {\n                p.onRedo();\n            }\n        });\n\n\n        this.pointerEventChain = new BB.EventChain.EventChain({\n            chainArr: [\n                this.twoFingerTap,\n                this.threeFingerTap,\n                this.mainDoubleTapper,\n                this.middleDoubleTapper,\n                this.pinchZoomer,\n                new BB.EventChain.OnePointerLimiter(),\n                new BB.EventChain.CoalescedExploder()\n            ]\n        });\n        this.pointerEventChain.setChainOut((event) => {\n\n            this.cursorPos.x = event.relX;\n            this.cursorPos.y = event.relY;\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\n                this.pointer = null;\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                if (!this.pointer) {\n                    this.pointer = { x: 0, y: 0 };\n                }\n                this.pointer.x = event.relX;\n                this.pointer.y = event.relY;\n            }\n\n            if (this.currentInputProcessor) {\n                this.currentInputProcessor.onPointer(event);\n\n            } else {\n\n                let comboStr = this.keyListener.getComboStr();\n\n                if (this.globalMode === TMode.Draw) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Draw);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Hand) {\n\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n\n                } else if (this.globalMode === TMode.Pick) {\n\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n\n                } else if (this.globalMode === TMode.Fill) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Fill);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Text) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.text;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Text);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Shape) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Shape);\n                        this.reqFrame();\n                    }\n\n                }\n\n\n            }\n\n        });\n\n        //prevent ctrl scroll -> zooming page\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\n            event.preventDefault();\n        });\n\n\n        setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\n                        try {\n                            e.eventPreventDefault();\n                        } catch (e) {}\n                    }\n                    /*if (e.type === 'pointermove') {\n                        BB.throwOut(JSON.stringify(e));\n                    }*/\n\n                    this.pointerEventChain.chainIn(e)\n                },\n                onWheel: (wheelEvent) => {\n\n                    if (this.isDrawing) {\n                        return;\n                    }\n\n                    this.reqFrame();\n                    let didZoom = this.internalZoomByStep(\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\n                        wheelEvent.relX,\n                        wheelEvent.relY\n                    );\n                    if (didZoom) {\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale\n                        });\n                    }\n\n                    //updateCursor(TMode.Draw, true);\n                    this.lastRenderedState = -1;\n\n\n                },\n                onEnterLeave: (isOver) => {\n                    if (!isOver) {\n                        if (!this.isDrawing) {\n                            this.pointer = null;\n                            this.lastRenderedState = -1;\n                        }\n                    }\n                },\n                maxPointers: 4\n            });\n        }, 1);\n\n        this.brushRadius = 1;\n\n        this.animationFrameRequested = false;\n\n\n\n\n        //setup rendering\n        this.lastRenderedState = -2;\n        this.lastRenderTime = performance.now();\n\n        window.requestAnimationFrame(() => this.updateLoop());\n\n        this.resetView();\n    }\n\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setCanvas (klC: KlCanvas): void {\n        this.klCanvas = klC;\n        this.lastDrawEvent = null;\n        this.resetView();\n\n        this.updateChangeListener();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    /**\n     * set size of workspace area in pixels\n     * @param width\n     * @param height\n     */\n    setSize (width: number, height: number): void {\n        const oldWidth = this.renderWidth;\n        const oldHeight = this.renderHeight;\n\n        if (width === oldWidth && height === oldHeight) {\n            return;\n        }\n\n        this.doResizeCanvas = true;\n        this.renderWidth = width;\n        this.renderHeight = height;\n\n        this.svgOverlay.setSize(width, height);\n\n        this.targetTransformObj.x += (width - oldWidth) / 2;\n        this.targetTransformObj.y += (height - oldHeight) / 2;\n\n        this.highResTransformObj.x = this.targetTransformObj.x;\n        this.highResTransformObj.y = this.targetTransformObj.y;\n\n        this.bgVisible = this.testBgVisible();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setMode (modeStr: TModeStr): void {\n        //only sets the base mode\n        if (modeStr === 'draw') {\n            this.globalMode = TMode.Draw;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'fill') {\n            this.globalMode = TMode.Fill;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'text') {\n            this.globalMode = TMode.Text;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'shape') {\n            this.globalMode = TMode.Shape;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'hand') {\n            this.globalMode = TMode.Hand;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n        }\n        if (modeStr === 'pick') {\n            this.globalMode = TMode.Pick;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n    }\n\n    setEnabled (b: boolean): void {\n        // todo\n    }\n\n    setCursorSize (diameter: number): void {\n        this.brushRadius = diameter / 2;\n\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n\n        if (this.pointer === null) {\n            clearTimeout(this.hideBrushCursorTimeout);\n\n            this.svgOverlay.updateCursor({\n                x: this.renderWidth / 2,\n                y: this.renderHeight / 2,\n                isVisible: true\n            });\n\n            // @ts-ignore\n            this.hideBrushCursorTimeout = setTimeout(() => {\n                if (this.pointer !== null) {\n                    return;\n                }\n                this.svgOverlay.updateCursor({isVisible: false});\n            }, 500);\n        }\n    }\n\n    zoomByStep (stepNum: number): void {\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\n            return;\n        }\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale'],\n            angle: this.targetTransformObj.angle,\n            scale: this.targetTransformObj.scale\n        });\n    }\n\n    resetView (doAnimate?: boolean): void {\n        this.targetTransformObj.scale = 1;\n        this.targetTransformObj.angle = 0;\n\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\n\n        if (!doAnimate) {\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n        } else {\n            this.doAnimateTranslate = true;\n            this.transformIsDirty = true;\n        }\n\n        this.bgVisible = this.testBgVisible();\n        this.reqFrame();\n\n        if (doAnimate) {\n            this.onViewChange({\n                changed: ['scale', 'angle'],\n                scale: this.targetTransformObj.scale,\n                angle: this.targetTransformObj.angle\n            });\n        }\n    }\n\n    fitView (): void {\n        //fit into view. center. keep angle. margin of 10px\n\n        //calc width and height of bounds\n        const canvasPointsArr = [\n            [0, 0], // top left\n            [this.klCanvas.getWidth(), 0], // top right\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\n            [0, this.klCanvas.getHeight()], // bottom left\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\n        ];\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle));\n\n        //rotate points\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n            canvasPointsArr[i][0] = coords[0];\n            canvasPointsArr[i][1] = coords[1];\n        }\n\n        const boundsObj = {\n            x0: null,\n            y0: null,\n            x1: null,\n            y1: null\n        };\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\n                boundsObj.x0 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\n                boundsObj.y0 = canvasPointsArr[i][1];\n            }\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\n                boundsObj.x1 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\n                boundsObj.y1 = canvasPointsArr[i][1];\n            }\n        }\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\n\n        //fit bounds\n        const padding = 40;\n        const { width: fitWidth } = BB.fitInto(\n            boundsWidth,\n            boundsHeight, \n            this.renderWidth - padding, \n            this.renderHeight - padding, \n            1\n        );\n\n        //determine scale\n        const factor = fitWidth / boundsWidth;\n\n        //center\n        this.targetTransformObj.x = (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor;\n        this.targetTransformObj.y = (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor;\n\n        this.targetTransformObj.scale = factor;\n        this.doAnimateTranslate = true;\n        this.transformIsDirty = true;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale', 'angle'],\n            scale: this.targetTransformObj.scale,\n            angle: this.targetTransformObj.angle\n        });\n    }\n\n    setAngle (angleDeg: number, isRelative?: boolean): void {\n        //rotation done around center\n        const centerObj = {\n            x: this.renderWidth / 2,\n            y: this.renderHeight / 2\n        };\n\n        const oldAngleRad = this.targetTransformObj.angle;\n        const angleRad = angleDeg / 180 * Math.PI;\n\n        if (isRelative) {\n            this.targetTransformObj.angle += angleRad;\n        } else {\n            this.targetTransformObj.angle = angleRad;\n        }\n\n        this.targetTransformObj.angle = this.minimizeAngleRad(\n            this.snapAngleRad(\n                this.targetTransformObj.angle,\n                90,\n                4\n            )\n        );\n\n        //rotate transform.xy\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n        this.transformIsDirty = true;\n        this.reqFrame(true);\n    }\n\n    /**\n     * translate canvas by viewport pixels\n     * @param tx\n     * @param ty\n     */\n    translateView (tx: number, ty: number): void {\n        const scale = 40;\n\n        this.targetTransformObj.x += tx * scale;\n        this.targetTransformObj.y += ty * scale;\n\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.reqFrame(true);\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    getScale (): number {\n        return this.targetTransformObj.scale;\n    }\n\n    getAngleDeg (): number {\n        return this.targetTransformObj.angle * 180 / Math.PI;\n    }\n\n    getMaxScale (): number {\n        return MAX_SCALE;\n    }\n\n    getMinScale (): number {\n        return MIN_SCALE;\n    }\n\n    requestFrame (): void {\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\n        if (x === null) {\n            this.lastDrawEvent = null;\n            return;\n        }\n\n        if (!this.lastDrawEvent) {\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\n        }\n        this.lastDrawEvent.x = x;\n        this.lastDrawEvent.y = y;\n        this.lastDrawEvent.pressure = pressure;\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"avIaz\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"WOcXY\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"9OHR3\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1HTsX\");","import {BB} from '../../bb/bb';\nimport {IKlBasicLayer} from '../kl.types';\n\n/**\n * preview of image with layers. can do mix modes and opacity.\n * creates a canvas.\n *\n * p = {\n *     width: 123,\n *     height: 123,\n *     layers: [// can be changed after the fact\n *         {\n *             image: Canvas,\n *             opacity: 1,\n *             mixModeStr: 'source-over'\n *         }\n *     ]\n * }\n *\n * @param p\n * @constructor\n */\nexport function KlCanvasPreview(\n    p: {\n        width: number;\n        height: number;\n        layers: IKlBasicLayer[];\n    }\n) {\n    const scale = p.width / p.layers[0].image.width;\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\n\n    let canvas = BB.canvas(width, height);\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\n    let ctx = canvas.getContext('2d');\n\n    BB.css(canvas, {\n        width: '100%',\n        height: '100%',\n        imageRendering: scale > 1 ? 'pixelated' : null,\n    });\n\n    function render() {\n        ctx.save();\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        for (let i = 0; i < p.layers.length; i++) {\n            ctx.globalAlpha = p.layers[i].opacity;\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\n            if (canvas.width > p.layers[i].image.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\n        }\n        ctx.restore();\n    }\n\n    setTimeout(render, 0);\n\n    // --- interface ---\n    this.getElement = function() {\n        return canvas;\n    };\n\n    this.render = function() {\n        render();\n    };\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {IVector2D} from '../../../bb/bb.types';\n\nexport interface ITransform {\n    x: number; // center of transform region. image space\n    y: number;\n    width: number; // size of transform region. image space\n    height: number;\n    angleDeg: number; // angle of transform region. degrees\n}\n\n\n/**\n * snap entire transform to pixel grid. changes transform\n *\n * for x y:\n * If a dimension has an even size, it be an integer.\n * If it's uneven, it's sits exactly half way between two pixels.\n *\n * @param transform\n */\nfunction snapToPixel(transform: ITransform): void {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\n        return;\n    }\n\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0° is original orientation.\n    // At 90° and 270° width and height become swapped due to different orientation.\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\n}\n\nfunction copyTransform(transform: ITransform): ITransform {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg,\n    };\n}\n\n/**\n * image space to transform space\n * - origin of transform space is at center of transform bounds.\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\n * - up is where transform points up\n * - x goes right\n * - y goes down\n * @param x\n * @param y\n * @param transform\n */\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\n    let px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: px, y: py},\n        -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n\n    return {\n        x: px,\n        y: py,\n    };\n}\n\n/**\n * transform space to image space\n * @param x\n * @param y\n * @param transform\n */\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: x, y: y},\n        transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y,\n    };\n}\n\n\n\n/**\n * Free Transform UI\n * rotate, scale, translate\n *\n * - if rotation is multiple of 90° it will snap to pixels, to be more useful for pixel art\n * - when rotation goes from non-multiple of 90° to a multiple, it will snap position and width height to pixels\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\n *      - this is what complicates things\n * - if transform region small, corner grips move out of the way\n *\n * iX iY, iP.x, iP.y - i indicates image space\n * tX tY, tP.x, tP.y - t indicates transform space\n *\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\n * Probably can't be extended for distort. Needs a different approach.\n *\n * --- DOM structure ---\n * rootEl {\n * \ttransEl [\n * \t\tboundsEl\n * \t\tedges[]\n * \t\tcorners[] - round grips in the corner of transform region\n * \t\tangleGrip\n * \t]\n * }\n *\n */\nexport class FreeTransform {\n\n    // --- private ---\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\n    private isConstrained: boolean;\n    private ratio: number; // aspect ratio of transform\n    private readonly scale: number;\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        corners: [{x: 0, y: 0}], // in transform space\n    };\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\n    private snappingEnabled: boolean;\n    private readonly snapX: number[];\n    private readonly snapY: number[];\n    private readonly callback: (transform: ITransform) => void;\n\n\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n    private readonly gripSize = 14;\n    private readonly edgeSize = 10;\n\n    private readonly rootEl: HTMLElement; // sits at origin of image\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\n    private readonly corners: {\n        i: number; // index in corners array\n        el: HTMLElement; // draggable corner circle in DOM\n        x: number; // unscaled position (transform space)\n        y: number;\n        virtualPos: IVector2D; // unscaled temporary position (image space)\n        updateDOM: () => void; // update styling in DOM\n        pointerListener: any;\n    }[] = [];\n    private keyListener: KeyListener;\n    private boundsPointerListener: any; // BB.PointerListener\n    private anglePointerListener: any; // BB.PointerListener\n    private readonly edges: { // derive position from corners\n        el: HTMLElement;\n        updateDOM: () => void;\n        pointerListener: any;\n    }[] = [];\n    private readonly angleGrip: {\n        el: HTMLElement,\n        x: number; // transform space\n        y: number;\n        snap: boolean,\n        updateDOM: () => void,\n    };\n\n    private updateScaled(): void {\n        this.scaled.x = this.transform.x * this.scale;\n        this.scaled.y = this.transform.y * this.scale;\n        this.scaled.width = this.transform.width * this.scale;\n        this.scaled.height = this.transform.height * this.scale;\n        this.scaled.corners = this.corners.map((item) => {\n            return {x: item.x * this.scale, y: item.y * this.scale};\n        });\n    }\n\n    /**\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\n     * both in image space\n     *\n     * @param iX - image space\n     * @param iY - image space\n     * @private\n     */\n    private snapCorner (iX: number, iY: number): IVector2D {\n        if (!this.snappingEnabled) {\n            return {x: iX, y: iY};\n        }\n        let dist: number;\n        const snap: {\n            x: number;\n            y: number;\n            dist: {\n                x: number;\n                y: number;\n            }\n        } = {\n            x: null,\n            y: null,\n            dist: {\n                x: null,\n                y: null,\n            }\n        };\n        for (let e = 0; e < this.snapX.length; e++) {\n            dist = Math.abs(iX - this.snapX[e]);\n            if (dist < this.minSnapDist / this.scale) {\n                if (snap.x === null || dist < snap.dist.x) {\n                    snap.x = this.snapX[e];\n                    snap.dist.x = dist;\n                }\n            }\n        }\n        for (let e = 0; e < this.snapY.length; e++) {\n            dist = Math.abs(iY - this.snapY[e]);\n            if (dist < this.minSnapDist / this.scale) {\n                if (snap.y === null || dist < snap.dist.y) {\n                    snap.y = this.snapY[e];\n                    snap.dist.y = dist;\n                }\n            }\n        }\n\n        if (snap.x === null && snap.y === null) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        return {\n            x: snap.x ?? iX,\n            y: snap.y ?? iY,\n        };\n    }\n\n    /**\n     * If constrained return nearest corner pos that fits aspect ratio\n     *\n     * @param cornerIndex\n     * @param iX\n     * @param iY\n     * @private\n     */\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\n        if (!this.isConstrained) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\n        return BB.projectPointOnLine(\n            {x: this.transform.x, y: this.transform.y},\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\n            {x: iX, y: iY}\n        );\n    }\n\n    /**\n     * Update corners according to width height.\n     * Not their DOM.\n     */\n    private updateCornerPositions (): void {\n        this.corners[0].x = (-this.transform.width / 2); // top left\n        this.corners[0].y = (-this.transform.height / 2);\n\n        this.corners[1].x = (this.transform.width / 2); // top right\n        this.corners[1].y = (-this.transform.height / 2);\n\n        this.corners[2].x = (this.transform.width / 2); // bottom right\n        this.corners[2].y = (this.transform.height / 2);\n\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\n        this.corners[3].y = (this.transform.height / 2);\n    }\n\n    /**\n     * If constrained and dragging an edge, restore aspect ratio\n     * Updates corner positions.\n     *\n     * @param widthChanged\n     * @param heightChanged\n     * @private\n     */\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\n        if (!this.isConstrained) {\n            return;\n        }\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\n        if (heightChanged && !widthChanged) {\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n            let newWidth = this.ratio * newHeight;\n            if (angle90) {\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\n            }\n            if (this.corners[1].x - this.corners[0].x < 0) {\n                newWidth *= -1;\n            }\n            this.corners[0].x = -newWidth / 2;\n            this.corners[3].x = -newWidth / 2;\n            this.corners[1].x = newWidth / 2;\n            this.corners[2].x = newWidth / 2;\n        }\n        if (!heightChanged && widthChanged) {\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\n            let newHeight = newWidth / this.ratio;\n            if (angle90) {\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\n            }\n            if (this.corners[3].y - this.corners[0].y < 0) {\n                newHeight *= -1;\n            }\n            this.corners[0].y = -newHeight / 2;\n            this.corners[1].y = -newHeight / 2;\n            this.corners[2].y = newHeight / 2;\n            this.corners[3].y = newHeight / 2;\n        }\n    }\n\n\n    /**\n     * update transform based on corners\n     * @private\n     */\n    private updateTransformViaCorners (): void {\n\n        // calc transform center in image space\n        const rot = BB.rotateAround(\n            {x: 0, y: 0},\n            {\n                x: (this.corners[0].x + this.corners[1].x) / 2,\n                y: (this.corners[0].y + this.corners[3].y) / 2,\n            },\n            this.transform.angleDeg\n        );\n        this.transform.x = rot.x + this.transform.x;\n        this.transform.y = rot.y + this.transform.y;\n\n        // update size\n        this.transform.width = this.corners[1].x - this.corners[0].x;\n        this.transform.height = this.corners[3].y - this.corners[0].y;\n\n        // new center means corners changed their position\n        this.updateCornerPositions();\n\n        this.updateDOM();\n    }\n\n    /**\n     * updates DOM according to transform\n     * @param skipCallback\n     */\n    private updateDOM (skipCallback?: boolean) {\n        this.updateScaled();\n\n        BB.css(this.transEl, {\n            left: this.scaled.x + \"px\",\n            top: this.scaled.y + \"px\",\n            transformOrigin: \"0 0\",\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\n        });\n\n        BB.css(this.boundsEl, {\n            width: Math.abs(this.scaled.width) + \"px\",\n            height: Math.abs(this.scaled.height) + \"px\",\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\n        });\n\n        this.corners[0].updateDOM();\n        this.corners[1].updateDOM();\n        this.corners[2].updateDOM();\n        this.corners[3].updateDOM();\n\n        this.edges[0].updateDOM();\n        this.edges[1].updateDOM();\n        this.edges[2].updateDOM();\n        this.edges[3].updateDOM();\n\n\n        this.angleGrip.x = 0;\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\n        this.angleGrip.updateDOM();\n        if (!skipCallback) {\n            if (this.callback) { // why should updateDOM trigger the callback?\n                this.callback(copyTransform(this.transform));\n            }\n        }\n    }\n\n\n\n    // --- public ---\n    constructor (\n        params: {\n            x: number; // center of transform region. image space\n            y: number;\n            width: number; // size of transform region. image space\n            height: number;\n            angleDeg: number; // angle of transform region. degrees\n\n            isConstrained: boolean; // proportions constrained\n            snapX: number[]; // where snapping along X axis. image space\n            snapY: number[]; // where snapping along X axis. image space\n            scale: number; // ratio of screen-space / image-space\n            callback: (transform: ITransform) => void;\n        }\n    ) {\n        this.transform = { // coordinates and dimensions of transformation\n            x: params.x,\n            y: params.y,\n            width: params.width,\n            height: params.height,\n            angleDeg: params.angleDeg,\n        };\n\n        this.isConstrained = !!params.isConstrained;\n\n        this.snapX = params.snapX;\n        this.snapY = params.snapY;\n        this.callback = params.callback;\n        this.scale = params.scale;\n        this.snappingEnabled = true;\n        this.ratio = this.transform.width / this.transform.height;\n\n        this.rootEl = BB.el({\n            className: 'kl-free-transform',\n            css: {\n                userSelect: 'none',\n            }\n        });\n        this.transEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n            }\n        });\n\n        this.boundsEl = BB.el({\n            css: {\n                position: 'absolute',\n                cursor: 'move',\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\n            }\n        });\n\n        const pointerRemainder = {\n            x: 0,\n            y: 0,\n        };\n        function resetRemainder() {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        }\n        this.keyListener = new BB.KeyListener({});\n\n        let boundsStartP = {\n            x: 0,\n            y: 0,\n        }\n        this.boundsPointerListener = new BB.PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointerdown') {\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\n                }\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\n\n\n                    let dist;\n                    let snap: any = {};\n                    if (this.snappingEnabled) {\n                        let i;\n                        for (i = 0; i < this.snapX.length; i++) {\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\n                            if (dist < this.minSnapDist / this.scale) {\n                                if (!snap.x || dist < snap.distX) {\n                                    snap.x = this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for (i = 0; i < this.snapY.length; i++) {\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\n                            if (dist < this.minSnapDist / this.scale) {\n                                if (!snap.y || dist < snap.distY) {\n                                    snap.y = this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n\n                        let iP;\n                        for (i = 0; i < 4; i++) {\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\n                            let j;\n                            for (j = 0; j < this.snapX.length; j++) {\n                                dist = Math.abs(iP.x - this.snapX[j]);\n                                if (dist < this.minSnapDist / this.scale) {\n                                    if (!snap.x || dist < snap.distX) {\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for (j = 0; j < this.snapY.length; j++) {\n                                dist = Math.abs(iP.y - this.snapY[j]);\n                                if (dist < this.minSnapDist / this.scale) {\n                                    if (!snap.y || dist < snap.distY) {\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        let projected = BB.projectPointOnLine(\n                            {x: 0, y: boundsStartP.y},\n                            {x: 10, y: boundsStartP.y},\n                            {x: this.transform.x, y: this.transform.y});\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        snap = {};\n                        snap.x = projected.x;\n                        snap.y = projected.y;\n                        snap.distX = dist;\n                        snap.distY = dist;\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: 0},\n                            {x: boundsStartP.x, y: 10},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n                    }\n                    if (snap.x != undefined) {\n                        this.transform.x = snap.x;\n                    }\n                    if (snap.y != undefined) {\n                        this.transform.y = snap.y;\n                    }\n\n                    // snap to pixels\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                        snapToPixel(this.transform);\n                        this.updateCornerPositions();\n                    }\n\n                    this.updateDOM();\n                }\n            }\n        })\n\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = this.corners[i] = {\n                    i: i,\n                    el: BB.el({\n                        css: {\n                            width: this.gripSize + 'px',\n                            height: this.gripSize + 'px',\n                            background: '#fff',\n                            /*background: [\n                                '#ff0000',\n                                '#00ff00',\n                                '#0000ff',\n                                '#ff00ff',\n                            ][i],*/\n                            borderRadius: this.gripSize + 'px',\n                            position: 'absolute',\n                            boxShadow: 'inset 0 0 0 2px #000'\n                        }\n                    }),\n                    x: 0,\n                    y: 0,\n                    virtualPos: {\n                        x: 0,\n                        y: 0,\n                    },\n                    updateDOM: null,\n                    pointerListener: null,\n                };\n                g.updateDOM = () => {\n\n                    // grip position\n                    // if gets small, offset grips, so easier to handle\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\n                        return item;\n                    });\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\n\n                    BB.css(g.el, {\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\n                    });\n\n\n                    // cursor\n                    let angle = BB.pointsToAngleDeg(\n                        {\n                            x: this.transform.x,\n                            y: this.transform.y,\n                        },\n                        toImageSpace(g.x, g.y, this.transform),\n                    ) + 135; // offset so nw is 0\n                    while (angle < 0) {\n                        angle += 360;\n                    }\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\n                    BB.css(g.el, {\n                        cursor: this.cornerCursors[index] + '-resize',\n                    });\n                };\n\n                g.pointerListener = new BB.PointerListener({\n                    target: this.corners[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\n\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\n\n                            let iP = {\n                                x: this.corners[i].virtualPos.x,\n                                y: this.corners[i].virtualPos.y,\n                            };\n                            iP = this.constrainCorner(i, iP.x, iP.y);\n                            if (!this.isConstrained) {\n                                iP = this.snapCorner(iP.x, iP.y);\n                            }\n\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                                iP.x = Math.round(iP.x);\n                                iP.y = Math.round(iP.y);\n                            }\n\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\n\n                            const dX = tP.x - this.corners[i].x;\n                            const dY = tP.y - this.corners[i].y;\n                            this.corners[i].x = tP.x;\n                            this.corners[i].y = tP.y;\n\n                            let indexes = [];\n                            if (i === 0) { // top left\n                                indexes = [3, 1, 2];\n                            } else if (i === 1) { // top right\n                                indexes = [2, 0, 3];\n                            } else if (i === 2) { // bottom right\n                                indexes = [1, 3, 0];\n                            } else if (i === 3) { // bottom left\n                                indexes = [0, 2, 1];\n                            }\n\n                            this.corners[indexes[0]].x = this.corners[i].x;\n                            this.corners[indexes[1]].y = this.corners[i].y;\n                            if (this.keyListener.isPressed('shift')) {\n                                this.corners[indexes[2]].x -= dX;\n                                this.corners[indexes[2]].y -= dY;\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    }\n                });\n\n            })(i);\n        }\n\n        this.updateCornerPositions();\n        this.updateScaled();\n\n        let isInverted: boolean;\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                this.edges[i] = {\n                    el: BB.el({\n                        css: {\n                            width: this.edgeSize + 'px',\n                            height: this.edgeSize + 'px',\n                            /*background: [\n                                '#ff000044',\n                                '#00ff0044',\n                                '#0000ff44',\n                                '#ff00ff44',\n                            ][i],*/\n                            position: 'absolute',\n                        },\n                    }),\n                    updateDOM: null,\n                    pointerListener: null,\n                };\n                const g = this.edges[i];\n                g.updateDOM = () => {\n                    if (i === 0) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 1) {\n                        BB.css(g.el, {\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    } else if (i === 2) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 3) {\n                        BB.css(g.el, {\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    }\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\n                    while (angleOffset < 0)\n                        angleOffset += 8;\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\n\n                };\n\n                const isVertical = [0, 2].includes(i);\n                g.pointerListener = new BB.PointerListener({\n                    target: this.edges[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            if (isVertical) { // top bottom\n                                isInverted = this.corners[0].y >= this.corners[3].y;\n                            } else { // left right\n                                isInverted = this.corners[0].x >= this.corners[1].x;\n                            }\n                            resetRemainder();\n                        }\n                        if (event.type === 'pointermove' && event.button === 'left') {\n                            const tfD = BB.rotateAround({x: 0, y: 0},\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\n                                -this.transform.angleDeg);\n                            let ti = {\n                                dX: tfD.x,\n                                dY: tfD.y,\n                            };\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\n                            }\n\n                            let indexes = [];\n                            if (i === 0) { // top\n                                indexes = [2, 3, 0, 1];\n                            } else if (i === 1) { // right\n                                indexes = [0, 3, 1, 2];\n                            } else if (i === 2) { // bottom\n                                indexes = [0, 1, 2, 3];\n                            } else if (i === 3) { // left\n                                indexes = [1, 2, 0, 3];\n                            }\n\n                            let dimension = isVertical ? 'y' : 'x';\n                            let d = isVertical ? ti.dY : ti.dX;\n\n                            if (isInverted) {\n                                this.corners[indexes[0]][dimension] += d;\n                                this.corners[indexes[1]][dimension] += d;\n                            } else {\n                                this.corners[indexes[2]][dimension] += d;\n                                this.corners[indexes[3]][dimension] += d;\n                            }\n                            if (this.keyListener.isPressed('shift')) {\n                                if (isInverted) {\n                                    this.corners[indexes[2]][dimension] -= d;\n                                    this.corners[indexes[3]][dimension] -= d;\n                                } else {\n                                    this.corners[indexes[0]][dimension] -= d;\n                                    this.corners[indexes[1]][dimension] -= d;\n                                }\n                            }\n\n                            if (isVertical) { // top bottom\n                                this.restoreRatio(false, true);\n                            } else { // left right\n                                this.restoreRatio(true, false);\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    }\n                });\n\n            })(i);\n        }\n\n        this.angleGrip = {\n            el: BB.el({\n                css: {\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\n                    width: this.gripSize + 'px',\n                    height: this.gripSize + 'px',\n                    background: '#0ff',\n                    borderRadius: this.gripSize + 'px',\n                    position: 'absolute',\n                    boxShadow: 'inset 0 0 0 2px #000',\n                },\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: () => {\n                BB.css(this.angleGrip.el, {\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\n                });\n            },\n        };\n        BB.el({\n            parent: this.angleGrip.el,\n            css: {\n                width: '2px',\n                height: '13px',\n                left: (this.gripSize / 2 - 1) + 'px',\n                top: this.gripSize + 'px',\n                background: '#0ff',\n                position: 'absolute'\n            }\n        });\n\n        this.anglePointerListener = new BB.PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n\n                    const bounds = this.rootEl.getBoundingClientRect();\n                    const offset = {\n                        x: bounds.left - this.rootEl.scrollLeft,\n                        y: bounds.top - this.rootEl.scrollTop,\n                    };\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\n\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\n                    this.transform.angleDeg = a;\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        this.transform.angleDeg = snapDeg;\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\n                        this.transform.angleDeg = snapDeg;\n                    }\n                    this.updateDOM();\n\n                }\n                if (event.type === 'pointerup') {\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                        snapToPixel(this.transform);\n                        this.updateCornerPositions();\n                        this.updateDOM();\n                    }\n                }\n            }\n        });\n\n        snapToPixel(this.transform);\n        this.updateDOM(true);\n        BB.append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el,\n        ]);\n\n\n    }\n\n\n\n    getTransform (): ITransform {\n        return copyTransform(this.transform);\n    }\n\n    setConstrained (b: boolean): void {\n        this.isConstrained = !!b;\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\n        }\n    }\n\n    setSnapping (s: boolean): void {\n        this.snappingEnabled = !!s;\n    }\n\n    setPos (p: IVector2D): void {\n        this.transform.x = p.x;\n        this.transform.y = p.y;\n        this.updateDOM(true);\n    }\n\n    move (dX: number, dY: number): void {\n        this.transform.x += dX;\n        this.transform.y += dY;\n        this.updateDOM(false);\n    }\n\n    setSize (w: number, h: number): void {\n        this.transform.width = w;\n        this.transform.height = h;\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n            snapToPixel(this.transform);\n        }\n        this.updateCornerPositions();\n        this.updateDOM(false);\n    }\n\n    setAngleDeg (a: number): void {\n        this.transform.angleDeg = a;\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n            snapToPixel(this.transform);\n            this.updateCornerPositions();\n        }\n        this.updateDOM(true);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getRatio (): number {\n        return this.ratio;\n    }\n\n    destroy (): void {\n        this.keyListener.destroy();\n        this.boundsPointerListener.destroy();\n        this.corners[0].pointerListener.destroy();\n        this.corners[1].pointerListener.destroy();\n        this.corners[2].pointerListener.destroy();\n        this.corners[3].pointerListener.destroy();\n        this.edges[0].pointerListener.destroy();\n        this.edges[1].pointerListener.destroy();\n        this.edges[2].pointerListener.destroy();\n        this.edges[3].pointerListener.destroy();\n        this.anglePointerListener.destroy();\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"9KeA5\");","import {BB} from '../../../bb/bb';\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\nimport {FreeTransform} from './free-transform';\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\n\n/**\n * a basic canvas where you can transform one layer(move around, rotate, scale)\n *\n * @param params\n * @returns {HTMLDivElement}\n * @constructor\n */\nexport function FreeTransformCanvas(params: {\n    elementWidth: number;\n    elementHeight: number;\n    imageWidth: number;\n    imageHeight: number;\n    layers: IKlBasicLayer[];\n    transformIndex: number;\n}) {\n    /*\n    div\n        innerWrapper\n            klCanvasPreview\n            transform.div\n    */\n\n    let previewFit = BB.fitInto(\n        params.imageWidth,\n        params.imageHeight,\n        params.elementWidth - 20,\n        params.elementHeight - 60,\n        1\n    );\n    let scale = previewFit.width / params.imageWidth;\n\n    let div = BB.el({\n        css: {\n            width: params.elementWidth + \"px\",\n            height: params.elementHeight + \"px\",\n            backgroundColor: \"#9e9e9e\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            userSelect: \"none\",\n            position: \"relative\",\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        }\n    });\n    div.oncontextmenu = function () {\n        return false;\n    };\n\n    let innerWrapper = BB.el({\n        css: {\n            position: 'relative',\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n            width: previewFit.width + 'px',\n            height: previewFit.height + 'px'\n        }\n    });\n    div.appendChild(innerWrapper);\n\n    let previewLayerArr = params.layers.map(item => {\n        return {\n            image: item.image,\n            mixModeStr: item.mixModeStr,\n            opacity: item.opacity,\n        }\n    });\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\n        scale > 1 ? params.imageWidth : previewFit.width,\n        scale > 1 ? params.imageHeight : previewFit.height,\n    );\n    let klCanvasPreview = new KlCanvasPreview({\n        width: previewFit.width,\n        height: previewFit.height,\n        layers: previewLayerArr\n    });\n    innerWrapper.appendChild(klCanvasPreview.getElement());\n\n    let freeTransform;\n    let initTransform;\n    function updatePreview() {\n        if (!freeTransform) {\n            return;\n        }\n\n        let transform = freeTransform.getTransform();\n        if (scale < 1) {\n            transform.x *= scale;\n            transform.y *= scale;\n            transform.width *= scale;\n            transform.height *= scale;\n        }\n\n        let destCanvas = previewLayerArr[params.transformIndex].image;\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\n        ctx.save();\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\n        BB.drawTransformedImageWithBounds(\n            ctx,\n            params.layers[params.transformIndex].image,\n            transform,\n            null,\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n        );\n        ctx.restore();\n        klCanvasPreview.render();\n    }\n\n    {\n        let transformSize = {\n            width: params.layers[params.transformIndex].image.width * scale,\n            height: params.layers[params.transformIndex].image.height * scale\n        };\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\n            transformSize = BB.fitInto(\n                params.layers[params.transformIndex].image.width,\n                params.layers[params.transformIndex].image.height,\n                previewFit.width,\n                previewFit.height,\n                1\n            );\n        }\n        initTransform = {\n            x: params.imageWidth / 2,\n            y: params.imageHeight / 2,\n            width: params.layers[params.transformIndex].image.width,\n            height: params.layers[params.transformIndex].image.height,\n        };\n        freeTransform = new FreeTransform({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: 0,\n            isConstrained: true,\n            snapX: [0, params.imageWidth],\n            snapY: [0, params.imageHeight],\n            scale: scale,\n            callback: (transform) => {\n                updatePreview();\n            },\n        });\n    }\n    BB.css(freeTransform.getElement(), {\n        position: 'absolute',\n        left: '0',\n        top: '0'\n    });\n    innerWrapper.appendChild(freeTransform.getElement());\n    setTimeout(updatePreview, 0);\n\n\n    // --- interface ---\n\n    this.move = function(dX, dY) {\n        freeTransform.move(dX, dY);\n    };\n    this.reset = function() {\n        let w = params.layers[params.transformIndex].image.width;\n        let h = params.layers[params.transformIndex].image.height;\n\n        freeTransform.setSize(w, h);\n        freeTransform.setPos({x: w / 2, y: h / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    this.setTransformFit = function() {\n\n        let fit = BB.fitInto(\n            params.layers[params.transformIndex].image.width,\n            params.layers[params.transformIndex].image.height,\n            params.imageWidth,\n            params.imageHeight,\n            1\n        );\n\n        freeTransform.setSize(fit.width, fit.height);\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    this.setTransformCenter = function() {\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    //gives you the transformation in the original scale\n    this.getTransformation = function () {\n        if (!freeTransform) {\n            return false;\n        }\n        return freeTransform.getTransform();\n    };\n    this.getIsPixelated = () => {\n        const transform = freeTransform.getTransform();\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.destroy = function() {\n        freeTransform.destroy();\n    };\n}","import {BB} from '../../../bb/bb';\n\n/*\n\tCropper params\n\t{\n\t\tx: int, //pos in relation zum bild\n\t\ty: int,\n\t\tw: int,\n\t\th: int,\n\t\tscale: float, //zoom\n\t\tcallback: function //wenn sich was ändert\n\t}\n\tthe div that you append this to must be relative\n*/\nexport function Cropper (params) {\n    let x = params.x,\n        y = params.y,\n        width = params.width,\n        height = params.height,\n        scale = params.scale,\n        callback = params.callback,\n        maxW = params.maxW,\n        maxH = params.maxH;\n    let div = document.createElement(\"div\");\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n\n    let keyListener = new BB.KeyListener({});\n\n    BB.css(div, {\n        position: \"absolute\",\n        left: (x * scale) + \"px\",\n        top: (y * scale) + \"px\"\n    });\n\n    let outline = document.createElement(\"div\");\n    BB.css(outline, {\n        position: \"absolute\",\n        border: \"1px dashed #fff\",\n        cursor: \"move\"\n    });\n    (outline as any).update = function () {\n        BB.css(outline, {\n            left: (grips[0].x * scale - 1) + \"px\",\n            top: (grips[0].y * scale - 1) + \"px\",\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\n        });\n    };\n    let pointerRemainder = { // needs to be reset after dragging complete\n        x: 0,\n        y: 0,\n    };\n    let outlinePointerListener = new BB.PointerListener({\n        target: outline,\n        onPointer: function(event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n\n                grips[0].x += dX;\n                grips[0].y += dY;\n                grips[1].x += dX;\n                grips[1].y += dY;\n                grips[2].x += dX;\n                grips[2].y += dY;\n                grips[3].x += dX;\n                grips[3].y += dY;\n\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n    let thirdsHorizontal = document.createElement(\"div\");\n    BB.css(thirdsHorizontal, {\n        position: \"absolute\",\n        borderTop: \"1px solid #0ff\",\n        borderBottom: \"1px solid #0ff\"\n    });\n    (thirdsHorizontal as any).update = function () {\n        BB.css(thirdsHorizontal, {\n            left: (grips[0].x * scale) + \"px\",\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\n\n        });\n    };\n    let thirdsVertical = document.createElement(\"div\");\n    BB.css(thirdsVertical, {\n        position: \"absolute\",\n        borderLeft: \"1px solid #0ff\",\n        borderRight: \"1px solid #0ff\"\n    });\n    (thirdsVertical as any).update = function () {\n        BB.css(thirdsVertical, {\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\n            top: (grips[0].y * scale) + \"px\",\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\n\n        });\n    };\n\n    const gripSize = 40;\n    const gripOverlay = 10;\n\n    let grips: {\n        x: number; // int\n        y: number;\n    }[] = [ // aka corner coordinates\n        {x: 0, y: 0}, // top left\n        {x: width, y: 0}, // top right\n        {x: width, y: height}, // bottom right\n        {x: 0, y: height}, //bottom left\n    ];\n\n    function transformTop(dY) {\n        grips[0].y += dY;\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\n        grips[1].y = grips[0].y;\n    }\n    function transformRight(dX) {\n        grips[1].x += dX;\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\n        grips[2].x = grips[1].x;\n    }\n    function transformBottom(dY) {\n        grips[2].y += dY;\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\n        grips[3].y = grips[2].y;\n    }\n    function transformLeft(dX) {\n        grips[0].x += dX;\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\n        grips[3].x = grips[0].x;\n    }\n\n    function commit() {\n        pointerRemainder.x = 0;\n        pointerRemainder.y = 0;\n        callback(getTransform());\n    }\n\n\n\n\n    let edges = [];\n    for (let i = 0; i < 4; i++) {\n        (function (i) {\n            edges[i] = document.createElement(\"div\");\n            let g = edges[i];\n            g.style.width = gripSize + \"px\";\n            g.style.height = gripSize + \"px\";\n            //g.style.background = \"#0f0\";\n            g.style.position = \"absolute\";\n            g.update = function () {\n                if (i === 0) { //top\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\n                    g.style.height = (gripSize * 2) + \"px\";\n                } else if (i === 1) { //right\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\n                    g.style.width = (gripSize * 2) + \"px\";\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\n                } else if (i === 2) { //bottom\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\n                    g.style.height = (gripSize * 2) + \"px\";\n                } else if (i === 3) { //left\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\n                    g.style.width = (gripSize * 2) + \"px\";\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\n                }\n                let angleOffset = i * 2 + 1;\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\n\n            };\n        })(i);\n    }\n\n    let darken = [];\n    for (let i = 0; i < 4; i++) {\n        (function (i) {\n            darken[i] = document.createElement(\"div\");\n            let g = darken[i];\n            g.style.position = \"absolute\";\n            g.style.background = \"#000\";\n            g.style.opacity = \"0.5\";\n            g.update = function () {\n                if (i === 0) {\n                    g.style.left = (grips[0].x * scale) + \"px\";\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\n                    g.style.height = \"8000px\";\n                } else if (i === 1) {\n                    g.style.left = (grips[1].x * scale) + \"px\";\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\n                    g.style.width = \"8000px\";\n                    g.style.height = 16000 + \"px\";\n                } else if (i === 2) {\n                    g.style.left = (grips[3].x * scale) + \"px\";\n                    g.style.top = (grips[3].y * scale) + \"px\";\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\n                    g.style.height = \"8000px\";\n                } else if (i === 3) {\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\n                    g.style.width = \"8000px\";\n                    g.style.height = 16000 + \"px\";\n                }\n\n            };\n        })(i);\n    }\n\n    let edge0PointerListener = new BB.PointerListener({\n        target: edges[0],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge1PointerListener = new BB.PointerListener({\n        target: edges[1],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge2PointerListener = new BB.PointerListener({\n        target: edges[2],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge3PointerListener = new BB.PointerListener({\n        target: edges[3],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n\n    let cornerElArr = [];\n    (function() {\n        for (let i = 0; i < 4; i++) {\n            (function (i) {\n                cornerElArr[i] = document.createElement(\"div\");\n                let g = cornerElArr[i];\n                BB.css(g, {\n                    //background: '#f00',\n                    width: (gripSize * 2) + 'px',\n                    height: (gripSize * 2) + 'px',\n                    position: 'absolute'\n                });\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\n                g.update = function () {\n                    if (i === 0) { //top left\n                        BB.css(g, {\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\n                        });\n                    } else if (i === 1) { //top right\n                        BB.css(g, {\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\n                        });\n                    } else if (i === 2) { //bottom right\n                        BB.css(g, {\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\n                        });\n                    } else if (i === 3) { //bottom left\n                        BB.css(g, {\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\n                        });\n                    }\n                };\n            })(i);\n        }\n    })();\n    //top left\n    let corner0PointerListener = new BB.PointerListener({\n        target: cornerElArr[0],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //top right\n    let corner1PointerListener = new BB.PointerListener({\n        target: cornerElArr[1],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //bottom right\n    let corner2PointerListener = new BB.PointerListener({\n        target: cornerElArr[2],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //bottom left\n    let corner3PointerListener = new BB.PointerListener({\n        target: cornerElArr[3],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n\n\n\n    function getTransform() {\n        grips[1].x -= grips[0].x;\n        grips[1].y -= grips[0].y;\n        grips[2].x -= grips[0].x;\n        grips[2].y -= grips[0].y;\n        grips[3].x -= grips[0].x;\n        grips[3].y -= grips[0].y;\n        x += grips[0].x;\n        y += grips[0].y;\n        grips[0].x = 0;\n        grips[0].y = 0;\n        return {\n            x: x,\n            y: y,\n            width: grips[1].x,\n            height: grips[2].y\n        };\n    }\n\n\n    div.append(\n        darken[1],\n        darken[0],\n        darken[2],\n        darken[3],\n        thirdsHorizontal,\n        thirdsVertical,\n        outline,\n\n        edges[1],\n        edges[0],\n        edges[2],\n        edges[3],\n\n        cornerElArr[0],\n        cornerElArr[1],\n        cornerElArr[2],\n        cornerElArr[3],\n    );\n\n\n    function update() {\n\n        edges[0].update();\n        edges[1].update();\n        edges[2].update();\n        edges[3].update();\n        cornerElArr[0].update();\n        cornerElArr[1].update();\n        cornerElArr[2].update();\n        cornerElArr[3].update();\n        darken[0].update();\n        darken[1].update();\n        darken[2].update();\n        darken[3].update();\n        (outline as any).update();\n        (thirdsHorizontal as any).update();\n        (thirdsVertical as any).update();\n    }\n\n    update();\n\n\n    // --- interface ---\n\n    this.getTransform = getTransform;\n\n    this.setTransform = function (p) {\n        x = p.x;\n        y = p.y;\n        width = p.width;\n        height = p.height;\n\n        BB.css(div, {\n            left: (x * scale) + \"px\",\n            top: (y * scale) + \"px\"\n        });\n\n        grips[0].x = 0;\n        grips[0].y = 0;\n        grips[1].x = width;\n        grips[1].y = 0;\n        grips[2].x = width;\n        grips[2].y = height;\n        grips[3].x = 0;\n        grips[3].y = height;\n\n        update();\n        commit();\n    };\n\n    this.setScale = function (s) {\n        scale = s;\n        BB.css(div, {\n            left: (x * scale) + \"px\",\n            top: (y * scale) + \"px\"\n        });\n        update();\n    };\n\n    this.showThirds = function (b) {\n        if (b) {\n            thirdsHorizontal.style.display = \"block\";\n            thirdsVertical.style.display = \"block\";\n        } else {\n            thirdsHorizontal.style.display = \"none\";\n            thirdsVertical.style.display = \"none\";\n        }\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.destroy = function() {\n        keyListener.destroy();\n        outlinePointerListener.destroy();\n        corner0PointerListener.destroy();\n        corner1PointerListener.destroy();\n        corner2PointerListener.destroy();\n        corner3PointerListener.destroy();\n        edge0PointerListener.destroy();\n        edge1PointerListener.destroy();\n        edge2PointerListener.destroy();\n        edge3PointerListener.destroy();\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {klHistory} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\n\n/**\n * Previews currently active layer\n * thumbnail (hover shows bigger preview), layername, opacity\n *\n * internally listens to kl history. updates when there's a change.\n * but you need to update it when the active layer changed. (different canvas object)\n *\n * update visibility for performance\n *\n * p = {\n *     onClick: function() // when clicking on layer name\n *     klRootEl: klRootEl,\n * }\n *\n * @param p\n * @constructor\n */\nexport function LayerPreview(p) {\n\n    // internally redraws with in an interval. checks history is something changed\n    // this update will be animated\n    // it will not be animated if the resolution changed\n    // also redraws when you call updateLayer - not animated\n\n    // syncs via updateLayer, and internally updates layer opacity via a hack\n\n    let div = BB.el({});\n    let layerObj;\n    let isVisible = true;\n    const height = 40;\n    const canvasSize = height - 10;\n    const largeCanvasSize = 300;\n    let lastDrawnState = -2;\n    let lastDrawnSize = {\n        width: 0,\n        height: 0\n    };\n    let animationCanvas = BB.canvas(); // to help animate the transition\n    let animationCanvasCtx = animationCanvas.getContext('2d');\n    const animationLength = 30;\n    let animationCount = 0; // >0 means it's animating\n    let largeCanvasIsVisible = false;\n    let largeCanvasAnimationTimeout;\n    const largeCanvasAnimationDurationMs = 300;\n    let uiState = 'right'; // 'left' | 'right'\n\n\n    // --- setup dom ---\n    let contentWrapperEl = BB.el({\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            height: height + 'px',\n            color: '#666',\n        }\n    });\n    let canvasWrapperEl = BB.el({\n        css: {\n            //background: '#f00',\n            minWidth: height + 'px',\n            height: height + 'px',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center'\n        }\n    });\n    let canvas = BB.canvas(canvasSize, canvasSize);\n    let canvasCtx = canvas.getContext('2d');\n    canvas.title = LANG('layers-active-layer');\n    BB.css(canvas, {\n        boxShadow: '0 0 0 1px #9e9e9e',\n        colorScheme: 'only light',\n    });\n    let nameWrapper = BB.el({\n        css: {\n            //background: '#ff0',\n            flexGrow: '1',\n            paddingLeft: '10px',\n            fontSize: '13px',\n            overflow: 'hidden',\n            position: 'relative'\n        }\n    });\n    let nameLabelEl = BB.el({\n        content: '',\n        css: {\n            cssFloat: 'left',\n            whiteSpace: 'nowrap'\n        }\n    });\n    let nameFadeEl = BB.el({\n        css: {\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\n            position: 'absolute',\n            right: \"0\",\n            top: \"0\",\n            width: \"50px\",\n            height: '100%'\n        }\n    });\n    let clickableEl = BB.el({\n        css: {\n            //background: 'rgba(0,255,0,0.6)',\n            position: 'absolute',\n            left: \"10px\",\n            top: \"0\",\n            width: \"90px\",\n            height: '100%'\n        }\n    });\n    if (p.onClick) {\n        BB.addEventListener(clickableEl,'click', function() {\n            p.onClick();\n        });\n        BB.addEventListener(canvas,'click', function() {\n            p.onClick();\n        });\n    }\n    let opacityEl = BB.el({\n        content: LANG('opacity') + '<br>100%',\n        css: {\n            minWidth: '60px',\n            fontSize: '12px',\n            textAlign: 'center',\n            background: '#dddddd',\n            color: '#555'\n        }\n    });\n\n    const largeCanvasWrapper = BB.el({\n        onClick: BB.handleClick,\n        css: {\n            pointerEvents: 'none',\n            background: '#fff',\n            position: 'absolute',\n            right: '280px',\n            top: '10px',\n            border: '1px solid #aaa',\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\n            userSelect: 'none',\n            display: 'block',\n            webkitTouchCallout: 'none',\n            colorScheme: 'only light',\n        }\n    });\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\n    largeCanvasWrapper.append(largeCanvas);\n    let largeCanvasCtx = largeCanvas.getContext('2d');\n    BB.css(largeCanvas, {\n        display: 'block',\n    });\n\n    div.appendChild(contentWrapperEl);\n    contentWrapperEl.appendChild(canvasWrapperEl);\n    canvasWrapperEl.appendChild(canvas);\n    contentWrapperEl.appendChild(nameWrapper);\n    nameWrapper.appendChild(nameLabelEl);\n    nameWrapper.appendChild(nameFadeEl);\n    nameWrapper.appendChild(clickableEl);\n    contentWrapperEl.appendChild(opacityEl);\n\n\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\n\n\n\n    // --- update logic ---\n\n    function animate() {\n        if (animationCount === 0) {\n            return;\n        }\n\n        animationCount--;\n\n        canvasCtx.save();\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\n        canvasCtx.drawImage(animationCanvas, 0, 0);\n        canvasCtx.restore();\n\n        if (animationCount > 0) {\n            requestAnimationFrame(animate);\n        }\n    }\n\n    function draw(isInstant) {\n\n        if (!isVisible) {\n            return;\n        }\n\n        nameLabelEl.textContent = layerObj.name;\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\n\n        let layerCanvas = layerObj.context.canvas;\n\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\n            canvas.width = Math.round(canvasDimensions.width);\n            canvas.height = Math.round(canvasDimensions.height);\n\n            isInstant = true;\n        }\n\n        animationCanvas.width = canvas.width;\n        animationCanvas.height = canvas.height;\n\n        animationCanvasCtx.save();\n        animationCanvasCtx.imageSmoothingEnabled = false;\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\n        animationCanvasCtx.restore();\n\n        if (isInstant) {\n            animationCount = 0;\n            canvasCtx.save();\n            canvasCtx.drawImage(animationCanvas, 0, 0);\n            canvasCtx.restore();\n\n        } else {\n            animationCount = animationLength;\n            animate();\n\n        }\n\n        drawLargeCanvas();\n\n        lastDrawnState = klHistory.getState();\n        lastDrawnSize.width = layerCanvas.width;\n        lastDrawnSize.height = layerCanvas.height;\n    }\n\n    function update() {\n        draw(true);\n    }\n\n    setInterval(function() {\n\n        if (!layerObj) {\n            return;\n        }\n\n        let currentState = klHistory.getState();\n        if (currentState === lastDrawnState) {\n            return;\n        }\n\n        //update opacity w hack\n        layerObj.opacity = layerObj.context.canvas.opacity;\n\n        draw(false);\n\n    }, 2000);\n\n\n    //is always instant\n    function drawLargeCanvas() {\n\n        if (!largeCanvasIsVisible || !layerObj) {\n            return;\n        }\n\n        let layerCanvas = layerObj.context.canvas;\n\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\n        largeCanvas.width = Math.round(canvasDimensions.width);\n        largeCanvas.height = Math.round(canvasDimensions.height);\n        largeCanvasCtx.save();\n        if (largeCanvas.width > layerCanvas.width) {\n            largeCanvasCtx.imageSmoothingEnabled = false;\n        } else {\n            largeCanvasCtx.imageSmoothingEnabled = true;\n            largeCanvasCtx.imageSmoothingQuality = 'high';\n        }\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\n        largeCanvasCtx.restore();\n\n        const bounds = div.getBoundingClientRect();\n        BB.css(largeCanvasWrapper, {\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\n        });\n\n    }\n\n    function removeLargeCanvas() {\n        try {\n            p.klRootEl.removeChild(largeCanvasWrapper);\n        } catch(e) {\n\n        }\n    }\n\n    function showLargeCanvas(b) {\n        if (largeCanvasIsVisible === b) {\n            return;\n        }\n\n        clearTimeout(largeCanvasAnimationTimeout);\n        largeCanvasIsVisible = b;\n\n        if (b) {\n            largeCanvasAnimationTimeout = setTimeout(function() {\n                drawLargeCanvas();\n                largeCanvasWrapper.style.opacity = '0';\n                p.klRootEl.appendChild(largeCanvasWrapper);\n                setTimeout(function() {\n                    largeCanvasWrapper.style.opacity = '1';\n                }, 20);\n            }, 250);\n\n        } else {\n            largeCanvasWrapper.style.opacity = '0';\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\n        }\n\n    }\n\n    let pointerListener = new BB.PointerListener({\n        target: canvas,\n        onEnterLeave: function(b) {\n            showLargeCanvas(b);\n        }\n    });\n\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(b) {\n        if (isVisible === b) {\n            return;\n        }\n        isVisible = b;\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\n        div.style.marginBottom = isVisible ? '' : '10px';\n\n        let currentState = klHistory.getState();\n        if (b && lastDrawnState !== currentState) {\n            update();\n        }\n    };\n\n    //when the layer might have changed\n    this.setLayer = function(klCanvasLayerObj) {\n        layerObj = klCanvasLayerObj;\n        update();\n    };\n\n    this.setUiState = function(stateStr) {\n        uiState = '' + stateStr;\n\n        if (uiState === 'left') {\n            BB.css(largeCanvasWrapper, {\n                left: '280px',\n                right: ''\n            });\n        } else {\n            BB.css(largeCanvasWrapper, {\n                left: '',\n                right: '280px'\n            });\n        }\n    };\n\n}","import {BB} from '../../../bb/bb';\n\n/**\n * fits image into a size\n * params: {\n *    image: image,\n *    width: int,\n *    height: int\n * }\n *\n * methods:\n * getDiv()\n *\n * @param params\n * @constructor\n */\nexport function FittedImage(params) {\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\n    let w = parseInt('' + fit.width);\n    let h = parseInt('' + fit.height);\n\n    let canvas = BB.canvas(w, h);\n\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\n    BB.css(canvas, {\n        display: \"block\",\n        boxShadow: \"0 0 0 1px #aaa\"\n    });\n\n    this.getElement = function() {\n        return canvas;\n    };\n}","import { BB } from '../../../bb/bb';\r\nimport { FreeTransformCanvas } from '../components/free-transform-canvas';\r\nimport { popup } from './popup';\r\nimport { KlCanvas } from '../../canvas/kl-canvas';\r\nimport { BBox, IKlBasicLayer } from '../../kl.types';\r\nimport { LANG } from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog(\r\n    params: {\r\n        target: HTMLElement;\r\n        bbox: BBox;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: { x: number, y: number, width: number, height: number, angleDeg: number },\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    let div = document.createElement(\"div\");\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        let noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px'\r\n            }\r\n        });\r\n        div.appendChild(noteEl);\r\n    }\r\n    let isSmall = params.bbox.width < 550;\r\n\r\n    let buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.reset();\r\n        }\r\n    });\r\n    let fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformFit();\r\n        }\r\n    });\r\n    let centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformCenter();\r\n        }\r\n    });\r\n    buttonRowEl.appendChild(originalSizeBtn);\r\n    buttonRowEl.appendChild(fitSizeBtn);\r\n    buttonRowEl.appendChild(centerBtn);\r\n    div.appendChild(buttonRowEl);\r\n\r\n\r\n\r\n    let layers: IKlBasicLayer[] = [];\r\n    {\r\n        let klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over'\r\n    });\r\n\r\n\r\n    let freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.appendChild(freeTransformCanvas.getElement());\r\n\r\n    function move(x, y) {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    popup({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? null : {\r\n            width: '500px'\r\n        },\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        clickOnEnter: 'Ok',\r\n        callback: function (buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n *\r\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\r\n * @constructor\r\n */\r\nexport function KlImageDropper(p) {\r\n\r\n    //set up DOM\r\n    let rootEl = BB.el({\r\n        content: 'Drop to import',\r\n        css: {\r\n            paddingTop: '100px',\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'rgba(50, 50, 50, 0.7)',\r\n            color: '#fff',\r\n            textShadow: '2px 2px #000',\r\n            textAlign: 'center',\r\n            fontSize: '25px'\r\n        }\r\n    });\r\n    let wrapperEl = BB.el({\r\n        css: {\r\n            'marginTop': '50px',\r\n            'display': 'flex',\r\n            'justifyContent': 'center'\r\n        }\r\n    });\r\n    let optionStyle = {\r\n        width: '200px',\r\n        padding: '50px',\r\n        margin: '10px',\r\n        //opacity: 0.5,\r\n        borderRadius: '20px',\r\n        border: '1px dashed #fff',\r\n        background: '#00aefe',\r\n        fontWeight: 'bold'\r\n    };\r\n    let optionLayerEl = BB.el({\r\n        content: 'As Layer',\r\n        css: optionStyle\r\n    });\r\n    let optionImageEl = BB.el({\r\n        content: 'As New Image',\r\n        css: optionStyle\r\n    });\r\n\r\n    rootEl.appendChild(wrapperEl);\r\n    wrapperEl.appendChild(optionLayerEl);\r\n    wrapperEl.appendChild(optionImageEl);\r\n\r\n\r\n    let rootCounter = 0;\r\n    let optionLayerCounter = 0;\r\n    let optionImageCounter = 0;\r\n\r\n    function destroy() {\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        try {\r\n            p.target.removeChild(rootEl);\r\n        } catch (e) { }\r\n    }\r\n\r\n    function testAcceptType(event) {\r\n        try {\r\n            return !event.dataTransfer.types.includes('text/plain');\r\n        } catch(e) {\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateOptions() {\r\n        let boxShadow = '0 0 20px 4px #fff';\r\n        if (optionLayerCounter > 0) {\r\n            optionLayerEl.style.boxShadow = boxShadow;\r\n            optionImageEl.style.boxShadow = '';\r\n        } else if (optionImageCounter > 0) {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = boxShadow;\r\n        } else {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\r\n        optionLayerCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\r\n        optionLayerCounter--;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragenter', function() {\r\n        optionImageCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragleave', function() {\r\n        optionImageCounter--;\r\n        updateOptions();\r\n    });\r\n\r\n\r\n    function rootDragOver(event) {\r\n        if (!testAcceptType(event)) {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n    }\r\n    function rootDragEnter(event) {\r\n        if (!p.enabledTest() || !testAcceptType(event)) {\r\n            return;\r\n        }\r\n        if (rootCounter === 0) {\r\n            p.target.appendChild(rootEl);\r\n        }\r\n        rootCounter++;\r\n\r\n    }\r\n    function rootDragLeave(event) {\r\n        if (!testAcceptType(event) || rootCounter === 0) {\r\n            return;\r\n        }\r\n        rootCounter = Math.max(0, rootCounter - 1);\r\n        if (rootCounter === 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n\r\n    }\r\n    function rootDrop(event) {\r\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\r\n            destroy();\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        let optionStr = 'default';\r\n        if (optionLayerCounter > 0) {\r\n            optionStr = 'layer';\r\n        } else if (optionImageCounter > 0) {\r\n            optionStr = 'image';\r\n        }\r\n\r\n        p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n        if (rootCounter > 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        updateOptions();\r\n    }\r\n\r\n    BB.addEventListener(window,'dragover', rootDragOver, false);\r\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\r\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\r\n    BB.addEventListener(window,'drop', rootDrop, false);\r\n\r\n    // if something goes wrong and you're stuck with overlay\r\n    BB.addEventListener(rootEl, 'pointerdown', function() {\r\n        destroy();\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (rootCounter > 0 && keyStr === 'esc') {\r\n                destroy();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\nimport {LANG} from '../../../language/language';\n\n/**\n * Compressed HUD toolspace. When you hold ctrl+alt.\n * small color picker, brush settings\n *\n * @param p\n * @constructor\n */\nexport function OverlayToolspace(\n    p: {\n        brushSettingService: BrushSettingService; // to sync with outside\n        enabledTest: () => boolean; // calls to see if it's allowed to show\n    }\n) {\n\n    const sizeObj = {\n        width: 150,\n        svHeight: 90,\n        hHeight: 20,\n        sliderHeight: 25\n    };\n\n    let isVisible = false;\n    const div = BB.el({\n        css: {\n            position: 'absolute',\n            left: '500px',\n            top: '500px',\n            background: 'rgb(221, 221, 221)',\n            display: 'none',\n            border: '1px solid #fff',\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\n            colorScheme: 'only light',\n        }\n    });\n    const queuedObj = {\n        color: null,\n        size: null,\n        opacity: null\n    };\n\n\n    // --- inputs ---\n\n    //color selection\n    const colorSlider = new KlSmallColorSlider({\n        width: sizeObj.width,\n        heightSV: sizeObj.svHeight,\n        heightH: sizeObj.hHeight,\n        color: p.brushSettingService.getColor(),\n        callback: function (rgbObj) {\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n        }\n    });\n    const selectedColorEl = BB.el({\n        css: {\n            width: sizeObj.width + 'px',\n            height: sizeObj.hHeight + 'px',\n            pointerEvents: 'none'\n        }\n    });\n    {\n        const initialColor = p.brushSettingService.getColor();\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\n    }\n\n    div.appendChild(selectedColorEl);\n    div.appendChild(colorSlider.getElement());\n\n\n    function updateColor(rgbObj) {\n        colorSlider.setColor(rgbObj);\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n    }\n\n\n\n\n\n    //brushsize slider\n\n    const sizeSlider = new KlSlider({\n        label: LANG('brush-size'),\n        width: sizeObj.width,\n        height: sizeObj.sliderHeight,\n        min: 0,\n        max: 500,\n        initValue: 50,\n        resolution: 225,\n        eventResMs: 1000 / 30,\n        onChange: function(v) {\n            p.brushSettingService.setSize(v);\n        },\n        formatFunc: function(v) {\n            if (v * 2 < 10) {\n                return Math.round(v * 2 * 10) / 10;\n            }\n            return Math.round(v * 2);\n        }\n    });\n    BB.css(sizeSlider.getElement(), {\n        marginTop: '2px'\n    });\n    div.appendChild(sizeSlider.getElement());\n\n    const opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: sizeObj.width,\n        height: sizeObj.sliderHeight,\n        min: 0,\n        max: 1,\n        initValue: 1,\n        resolution: 225,\n        eventResMs: 1000 / 30,\n        onChange: function(v) {\n            p.brushSettingService.setOpacity(v);\n        },\n        formatFunc: function(v) {\n            return Math.round(v * 100);\n        }\n    });\n    BB.css(opacitySlider.getElement(), {\n        margin: '2px 0'\n    });\n    div.appendChild(opacitySlider.getElement());\n\n\n\n    // --- general setup ---\n\n    const subscriptionFunc = function(event) {\n        if (event.type === 'color') {\n            if (!isVisible) {\n                queuedObj.color = event.value;\n            } else {\n                updateColor(event.value);\n            }\n        }\n        if (event.type === 'size') {\n            if (!isVisible) {\n                queuedObj.size = event.value;\n            } else {\n                sizeSlider.setValue(event.value);\n            }\n        }\n        if (event.type === 'opacity') {\n            if (!isVisible) {\n                queuedObj.opacity = event.value;\n            } else {\n                opacitySlider.setValue(event.value);\n            }\n        }\n        if (event.type === 'sliderConfig') {\n            sizeSlider.update(event.value.sizeSlider);\n            opacitySlider.update(event.value.opacitySlider);\n        }\n    };\n    p.brushSettingService.subscribe(subscriptionFunc);\n    {\n        const sliderConfig = p.brushSettingService.getSliderConfig();\n        sizeSlider.update(sliderConfig.sizeSlider);\n        opacitySlider.update(sliderConfig.opacitySlider);\n        sizeSlider.setValue(p.brushSettingService.getSize());\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\n    }\n\n    function updateUI() {\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible && mousePos) {\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\n        }\n    }\n\n    let mousePos = null;\n    BB.addEventListener(document, 'pointermove', function(event) {\n        mousePos = {\n            x: event.pageX,\n            y: event.pageY,\n        };\n    });\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, event, comboStr, isRepeat) {\n            if (isRepeat) {\n                return;\n            }\n            if (isVisible) {\n                isVisible = false;\n                updateUI();\n                return;\n            }\n\n            if (!p.enabledTest() || !mousePos) {\n                return;\n            }\n\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\n                event.preventDefault();\n                isVisible = true;\n\n                if (queuedObj.color !== null) {\n                    updateColor(queuedObj.color);\n                    queuedObj.color = null;\n                }\n                if (queuedObj.size !== null) {\n                    sizeSlider.setValue(queuedObj.size);\n                    queuedObj.size = null;\n                }\n                if (queuedObj.opacity !== null) {\n                    opacitySlider.setValue(queuedObj.opacity);\n                    queuedObj.opacity = null;\n                }\n\n                updateUI();\n            }\n\n        },\n        onUp: function(keyStr, event, oldComboStr) {\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\n                isVisible = false;\n                colorSlider.end();\n                updateUI();\n            }\n        },\n        onBlur: function() {\n            if (isVisible) {\n                isVisible = false;\n                colorSlider.end();\n                updateUI();\n            }\n        }\n    });\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n}","import { BB } from '../../../bb/bb';\n// @ts-ignore\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\n// @ts-ignore\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\n// @ts-ignore\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\n// @ts-ignore\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\n// @ts-ignore\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\nimport { LANG } from '../../../language/language';\n\n\n/**\n * Topmost row of buttons in toolspace (with the app logo)\n *\n * p = { // button click callbacks\n *      logoImg: img,\n *     onLogo: function(),\n *     onNew: function(),\n *     onImport: function(),\n *     onSave: function(),\n *     onShare: function(),\n *     onHelp: function()\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceTopRow(p) {\n    let div = document.createElement('div');\n    BB.css(div, {\n        height: '36px',\n        //background: '#f00',\n        display: 'flex',\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\n    });\n\n    function createButton(p) {\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n        let result = BB.el({\n            className: 'toolspace-row-button nohighlight',\n            title: p.title,\n            onClick: p.onClick,\n            css: {\n                padding: p.contain ? padding + 'px 0' : ''\n            }\n        });\n        let im = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + p.image + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: p.contain ? 'contain' : '',\n                //filter: 'grayscale(1)',\n                height: '100%'\n            }\n        });\n        im.style.pointerEvents = 'none';\n        result.appendChild(im);\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n            target: result,\n            onEnterLeave: function (isOver) {\n                if (isOver) {\n                    BB.addClassName(result, 'toolspace-row-button-hover');\n                } else {\n                    BB.removeClassName(result, 'toolspace-row-button-hover');\n                }\n            }\n        });\n        return result;\n    }\n    let logoButton = null;\n    if (typeof p.onLogo === 'function') {\n        logoButton = createButton({\n            onClick: p.onLogo,\n            title: LANG('home'),\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\n            contain: true\n        });\n        logoButton.style.width = '45px';\n        logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\n    }\n\n    let newButton = createButton({\n        onClick: p.onNew,\n        title: LANG('file-new'),\n        image: newImageImg,\n        extraPadding: 1,\n        contain: true\n    });\n    let importButton = createButton({\n        onClick: p.onImport,\n        title: LANG('file-import'),\n        image: importImg,\n        extraPadding: 1,\n        contain: true\n    });\n    let saveButton = createButton({\n        onClick: p.onSave,\n        title: LANG('file-save'),\n        image: exportImg,\n        extraPadding: 1,\n        contain: true\n    });\n\n\n\n    let shareButton = null;\n    if (BB.canShareFiles() && p.onShare) {\n        shareButton = createButton({\n            onClick: p.onShare,\n            title: LANG('file-share'),\n            image: shareImg,\n            contain: true\n        });\n    }\n    let helpButton = null;\n    if (p.onHelp) {\n        helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true\n        });\n\n    }\n\n    if (logoButton) {\n        div.appendChild(logoButton);\n    }\n    div.appendChild(newButton);\n    div.appendChild(importButton);\n    div.appendChild(saveButton);\n    if (shareButton) {\n        div.appendChild(shareButton);\n    }\n    if (helpButton) {\n        div.appendChild(helpButton);\n    }\n\n\n    // --- interface ---\n    this.getElement = function () {\n        return div;\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8Plcz\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"43S3A\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"bGPtg\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hofH5\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"kfijQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"jjlWQ\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n *\r\n * p = {\r\n *     onChange: func(activeStr)\r\n * }\r\n *\r\n * activeStr = 'draw' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolDropdown(p) {\r\n\r\n    let optionArr = ['draw', 'fill', 'text', 'shape'];\r\n    let imArr = [\r\n        toolPaintImg,\r\n        toolFillImg,\r\n        toolTextImg,\r\n        toolShapeImg\r\n    ];\r\n    let titleArr = [\r\n        `${LANG('tool-brush')} [B]`,\r\n        `${LANG('tool-paint-bucket')} [G]`,\r\n        `${LANG('tool-text')} [T]`,\r\n        `${LANG('tool-shape')} [U]`,\r\n    ];\r\n    let currentActiveIndex = 0;\r\n    let isActive = true;\r\n    let isOpen = false;\r\n\r\n    //preload images\r\n    setTimeout(function() {\r\n        for (let i = 1; i < imArr.length; i++) {\r\n            let im = new Image();\r\n            im.src = imArr[i];\r\n        }\r\n    }, 100);\r\n\r\n    let smallMargin = '6px 0';\r\n    let div = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            flexGrow: '1'\r\n        }\r\n    });\r\n\r\n    let openTimeout;\r\n    let isDragging = false;\r\n    let startX, startY;\r\n    let pointerListener;\r\n    if (BB.hasPointerEvents) {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    if (isOpen) {\r\n                        return;\r\n                    }\r\n\r\n                    openTimeout = setTimeout(function() {\r\n                        showDropdown();\r\n                    }, 400);\r\n                    isDragging = true;\r\n                    startX = event.pageX;\r\n                    startY = event.pageY;\r\n\r\n                } else if (event.type === 'pointermove') {\r\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                        clearTimeout(openTimeout);\r\n                        showDropdown();\r\n                    }\r\n\r\n                } else if (event.type === 'pointerup') {\r\n                    clearTimeout(openTimeout);\r\n                    if (isOpen && isDragging) {\r\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\r\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\r\n                            if (target === dropdownBtnArr[i].wrapper) {\r\n                                closeDropdown();\r\n                                isActive = true;\r\n                                currentActiveIndex = i;\r\n                                updateButton();\r\n                                p.onChange(optionArr[currentActiveIndex]);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    isDragging = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    let activeButton = BB.el({\r\n        parent: div,\r\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n        title: titleArr[currentActiveIndex],\r\n        onClick: function(e) {\r\n            if (isActive && !isOpen) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n                return;\r\n            }\r\n\r\n            isActive = true;\r\n            p.onChange(optionArr[currentActiveIndex]);\r\n            if (isOpen) {\r\n                closeDropdown();\r\n            }\r\n        },\r\n        css: {\r\n            padding: '10px 0',\r\n            pointerEvents: 'auto',\r\n            height: '100%',\r\n            boxSizing: 'border-box'\r\n        }\r\n    });\r\n\r\n    let activeButtonIm = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: 'contain',\r\n            width: 'calc(100% - 7px)',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            opacity: '0.75',\r\n        }\r\n    });\r\n\r\n    let arrowButton = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            position: 'absolute',\r\n            right: '1px',\r\n            bottom: '1px',\r\n            width: '18px',\r\n            height: '18px',\r\n            //background: '#aaa',\r\n            //borderRadius: '2px',\r\n            cursor: 'pointer',\r\n\r\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: '60%'\r\n        },\r\n        title: 'More Tools',\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            showDropdown();\r\n        }\r\n    });\r\n\r\n\r\n    let overlay = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            //background: 'rgba(255,0,0,0.5)',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0'\r\n        }\r\n    });\r\n    let overlayPointerListener = new BB.PointerListener({\r\n        target: overlay,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointerdown') {\r\n                e.eventPreventDefault();\r\n                closeDropdown();\r\n            }\r\n        }\r\n    });\r\n\r\n    let dropdownWrapper = BB.el({\r\n        className: 'tool-dropdown-wrapper',\r\n        css: {\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: (100 * (optionArr.length - 1)) + '%',\r\n            top: '100%',\r\n            left: '0',\r\n            zIndex: '1',\r\n            boxSizing: 'border-box',\r\n            cursor: 'pointer',\r\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n            borderBottomLeftRadius: '5px',\r\n            borderBottomRightRadius: '5px',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n\r\n    let dropdownBtnArr = [];\r\n\r\n    function createDropdownButton(p) {\r\n        let result = {};\r\n\r\n        let wrapper = BB.el({\r\n            parent: dropdownWrapper,\r\n            className: 'tool-dropdown-button',\r\n            title: p.title,\r\n            css: {\r\n                padding: '10px 0',\r\n                height: (100 / (optionArr.length - 1)) + '%',\r\n                boxSizing: 'border-box'\r\n            },\r\n            onClick: function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                p.onClick(p.index, p.id);\r\n            }\r\n        });\r\n        (result as any).wrapper = wrapper;\r\n        let im = BB.el({\r\n            parent: wrapper,\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75'\r\n            }\r\n        });\r\n\r\n        // --- interface ---\r\n        (result as any).show = function(b) {\r\n            wrapper.style.display = b ? 'block' : 'none';\r\n        };\r\n\r\n        (result as any).setIsSmall = function(b) {\r\n            wrapper.style.padding = b ? smallMargin : '10px 0';\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function onClickDropdownBtn(index, id) {\r\n        closeDropdown();\r\n\r\n        isActive = true;\r\n        currentActiveIndex = index;\r\n\r\n        updateButton();\r\n\r\n        p.onChange(optionArr[currentActiveIndex]);\r\n    }\r\n\r\n    for (let i = 0; i < optionArr.length; i++) {\r\n        dropdownBtnArr.push(createDropdownButton({\r\n            index: i,\r\n            id: optionArr[i],\r\n            image: imArr[i],\r\n            title: titleArr[i],\r\n            onClick: onClickDropdownBtn\r\n        }));\r\n    }\r\n\r\n    function showDropdown() {\r\n        dialogCounter.increase(0.5);\r\n        isOpen = true;\r\n\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\r\n        }\r\n\r\n        arrowButton.style.display = 'none';\r\n        div.style.zIndex = '1';\r\n        p.klRootEl.appendChild(overlay);\r\n        div.appendChild(dropdownWrapper);\r\n    }\r\n\r\n    function closeDropdown() {\r\n        dialogCounter.decrease(0.5);\r\n        isOpen = false;\r\n        arrowButton.style.removeProperty('display');\r\n        div.style.removeProperty('z-index');\r\n        p.klRootEl.removeChild(overlay);\r\n\r\n        div.removeChild(dropdownWrapper);\r\n    }\r\n\r\n    function updateButton() {\r\n        activeButton.title = titleArr[currentActiveIndex];\r\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\r\n    }\r\n    updateButton();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setIsSmall = function(b) {\r\n        activeButton.style.padding = b ? smallMargin : '10px 0';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            arrowButton.style.width = '14px';\r\n            arrowButton.style.height = '14px';\r\n        } else {\r\n            arrowButton.style.width = '18px';\r\n            arrowButton.style.height = '18px';\r\n        }\r\n    };\r\n\r\n    this.setActive = function(activeStr) {\r\n        if (optionArr.includes(activeStr)) {\r\n            isActive = true;\r\n            for (let i = 0; i < optionArr.length; i++) {\r\n                if (optionArr[i] === activeStr) {\r\n                    currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            BB.addClassName(activeButton, 'toolspace-row-button-activated');\r\n            updateButton();\r\n        } else {\r\n            isActive = false;\r\n            BB.removeClassName(activeButton, 'toolspace-row-button-activated');\r\n        }\r\n    };\r\n\r\n    this.getActive = function() {\r\n        return optionArr[currentActiveIndex];\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"4DSYE\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1H3Hd\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"18NiM\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8cnwX\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7EOgw\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\n// @ts-ignore\r\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n *\r\n * p = {\r\n *     onActivate: function(activeStr), // clicking on tool button - activating it\r\n *     onZoomIn: function(),\r\n *     onZoomOut: function(),\r\n *     onUndo: function(),\r\n *     onRedo: function(),\r\n * }\r\n *\r\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceToolRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '54px',\r\n        //height: '36px',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n    function setActive(activeStr, doEmit?) {\r\n        if (currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        currentActiveStr = activeStr;\r\n\r\n        toolDropdown.setActive(currentActiveStr);\r\n        if (currentActiveStr === 'hand') {\r\n            BB.addClassName(handButton, 'toolspace-row-button-activated');\r\n        } else {\r\n            BB.removeClassName(handButton, 'toolspace-row-button-activated');\r\n        }\r\n\r\n        if (doEmit) {\r\n            p.onActivate(currentActiveStr);\r\n        }\r\n    }\r\n\r\n    function createButton(p) {\r\n\r\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            //title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? '10px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%',\r\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none',\r\n                opacity: p.doLighten ? '0.75' : '1'\r\n            }\r\n        });\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(result, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(result, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).setIsSmall = function(b) {\r\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n        }\r\n        return result;\r\n    }\r\n\r\n\r\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\r\n\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n        let svg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '67px', // can't think of a way doing with percentage\r\n            height: '54px',\r\n            viewBox: '0 0 100 100',\r\n            preserveAspectRatio: 'none'\r\n        });\r\n        BB.css(svg, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n\r\n        let blurRadius = 10;\r\n        let blurOffsetX = 2;\r\n        let blurOffsetY = 2;\r\n\r\n        let defs = BB.createSvg( { // inset shadow via svg\r\n            elementType: 'defs',\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'filter',\r\n                    id: 'innershadow',\r\n                    x0: '-50%',\r\n                    y0: '-50%',\r\n                    width: '200%',\r\n                    height: '200%',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'SourceAlpha',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceAlpha',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceGraphic',\r\n                            operator: 'over',\r\n                            result: 'firstfilter'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'firstfilter',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur2'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'over'\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        });\r\n\r\n\r\n        let svgTriangleLeft = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M0,0 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleLeft.onclick = function() {\r\n            p.onLeft();\r\n            BB.removeClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        let svgTriangleRight = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M100,100 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleRight.onclick = function() {\r\n            p.onRight();\r\n            BB.removeClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: svgTriangleLeft,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n                } else {\r\n                    BB.removeClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: svgTriangleRight,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n                } else {\r\n                    BB.removeClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n        svg.appendChild(defs);\r\n        svg.appendChild(svgTriangleLeft);\r\n        svg.appendChild(svgTriangleRight);\r\n        result.appendChild(svg);\r\n\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(leftIm);\r\n\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(rightIm);\r\n\r\n\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(svgTriangleLeft, 'toolspace-row-button-disabled');\r\n                BB.removeClassName(leftIm, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(svgTriangleLeft, 'toolspace-row-button-disabled');\r\n                BB.addClassName(leftIm, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(svgTriangleRight, 'toolspace-row-button-disabled');\r\n                BB.removeClassName(rightIm, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(svgTriangleRight, 'toolspace-row-button-disabled');\r\n                BB.addClassName(rightIm, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function createTriangleButtonViaClipPath(p) {\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n\r\n        let leftButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onLeft,\r\n            css: {\r\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        leftButton.appendChild(leftIm);\r\n\r\n\r\n\r\n        let rightButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onRight,\r\n            css: {\r\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        rightButton.appendChild(rightIm);\r\n\r\n\r\n\r\n        result.appendChild(leftButton);\r\n        result.appendChild(rightButton);\r\n\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: leftButton,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(leftButton, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(leftButton, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: rightButton,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(rightButton, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(rightButton, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(leftButton, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(leftButton, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(rightButton, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(rightButton, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        return result;\r\n    }\r\n\r\n    /*let brushButton = createButton({\r\n        onClick: function() {\r\n            setActive('draw', true);\r\n        },\r\n        image: 'app/img/ui/paint.png',\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    BB.addClassName(brushButton, 'toolspace-row-button-activated');\r\n    div.appendChild(brushButton);*/\r\n\r\n    let toolDropdown = new ToolDropdown({\r\n        klRootEl: p.klRootEl,\r\n        onChange: function(activeStr) {\r\n            setActive(activeStr, true);\r\n        }\r\n    });\r\n    div.appendChild(toolDropdown.getElement());\r\n\r\n    let handButton = createButton({\r\n        onClick: function() {\r\n            setActive('hand', true);\r\n        },\r\n        image: toolHandImg,\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    handButton.title = LANG('tool-hand');\r\n    div.appendChild(handButton);\r\n\r\n    let zoomInNOutButton = createTriangleButton({\r\n        onLeft: p.onZoomIn,\r\n        onRight: p.onZoomOut,\r\n        leftImage: toolZoomInImg,\r\n        rightImage: toolZoomOutImg,\r\n    });\r\n    zoomInNOutButton.title = LANG('tool-zoom');\r\n    div.appendChild(zoomInNOutButton);\r\n\r\n    let zoomInButton = createButton({\r\n        onClick: p.onZoomIn,\r\n        image: toolZoomInImg,\r\n        contain: true\r\n    });\r\n    zoomInButton.title = LANG('zoom-in');\r\n    div.appendChild(zoomInButton);\r\n\r\n    let zoomOutButton = createButton({\r\n        onClick: p.onZoomOut,\r\n        image: toolZoomOutImg,\r\n        contain: true\r\n    });\r\n    zoomOutButton.title = LANG('zoom-out');\r\n    div.appendChild(zoomOutButton);\r\n\r\n    let undoNRedoButton = createTriangleButton({\r\n        onLeft: p.onUndo,\r\n        onRight: p.onRedo,\r\n        leftImage: toolUndoImg,\r\n        rightImage: null,\r\n    });\r\n    undoNRedoButton.title = LANG('tool-undo-redo');\r\n    (undoNRedoButton as any).setIsEnabledLeft(false);\r\n    (undoNRedoButton as any).setIsEnabledRight(false);\r\n    div.appendChild(undoNRedoButton);\r\n\r\n    let undoButton = createButton({\r\n        onClick: p.onUndo,\r\n        image: toolUndoImg,\r\n        contain: true\r\n    });\r\n    undoButton.title = LANG('undo');\r\n    BB.addClassName(undoButton, 'toolspace-row-button-disabled');\r\n    div.appendChild(undoButton);\r\n\r\n    let redoButton = createButton({\r\n        onClick: p.onRedo,\r\n        image: toolUndoImg,\r\n        contain: true,\r\n        doMirror: true\r\n    });\r\n    redoButton.title = LANG('redo');\r\n    BB.addClassName(redoButton, 'toolspace-row-button-disabled');\r\n    div.appendChild(redoButton);\r\n\r\n    zoomInButton.style.display = 'none';\r\n    zoomOutButton.style.display = 'none';\r\n    undoButton.style.display = 'none';\r\n    redoButton.style.display = 'none';\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsSmall = function(b) {\r\n        BB.css(div, {\r\n            height: b ? '36px' : '54px'\r\n        });\r\n\r\n        toolDropdown.setIsSmall(b);\r\n        (handButton as any).setIsSmall(b);\r\n        (zoomInButton as any).setIsSmall(b);\r\n        (zoomOutButton as any).setIsSmall(b);\r\n        (undoButton as any).setIsSmall(b);\r\n        (redoButton as any).setIsSmall(b);\r\n\r\n        if (b) {\r\n            zoomInNOutButton.style.display = 'none';\r\n            undoNRedoButton.style.display = 'none';\r\n            zoomInButton.style.display = 'block';\r\n            zoomOutButton.style.display = 'block';\r\n            undoButton.style.display = 'block';\r\n            redoButton.style.display = 'block';\r\n        } else {\r\n            zoomInNOutButton.style.display = 'block';\r\n            undoNRedoButton.style.display = 'block';\r\n            zoomInButton.style.display = 'none';\r\n            zoomOutButton.style.display = 'none';\r\n            undoButton.style.display = 'none';\r\n            redoButton.style.display = 'none';\r\n        }\r\n\r\n    };\r\n\r\n    this.setEnableZoomIn = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(zoomInButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(zoomInButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableZoomOut = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(zoomOutButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(zoomOutButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (zoomInNOutButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setEnableUndo = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(undoButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(undoButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (undoNRedoButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableRedo = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(redoButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(redoButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (undoNRedoButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setActive = function(activeStr) {\r\n        setActive(activeStr);\r\n    };\r\n    this.getActive = function() {\r\n        return currentActiveStr;\r\n    };\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"iY1ZE\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5RV8h\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1WcRu\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hfADS\");","import {BB} from '../../../bb/bb';\nimport {Select} from '../base-components/select';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui to select stabilizer level. 4 options. returned as 0-3\n *\n * p = {\n *     smoothing: number, // initial level 0-3\n *     onSelect: function(level number) // 0-3, when level changes\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceStabilizerRow(p) {\n\n    let div = BB.el({\n        tagName: 'label',\n        content: LANG('stabilizer') + '&nbsp;',\n        title: LANG('stabilizer-title'),\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            fontSize: '13px',\n            color: 'rgba(0,0,0,0.6)'\n        }\n    });\n\n    let strengthSelect = new Select({\n        optionArr: [\n            ['0', '0'],\n            ['1', '1'],\n            ['2', '2'],\n            ['3', '3'],\n            ['4', '4'],\n            ['5', '5']\n        ],\n        initValue: p.smoothing,\n        onChange: function(val) {\n            p.onSelect(parseInt(val));\n        }\n    });\n    div.appendChild(strengthSelect.getElement());\n\n    let pointerListener = new BB.PointerListener({\n        target: div,\n        onWheel: function(e) {\n            strengthSelect.setDeltaValue(e.deltaY);\n        }\n    });\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\n\n/**\n * row of tabs. uses css class .tabrow-tab\n *\n * p = {\n *     initialId: string, // e.g. 'draw'\n *     useAccent: boolean,\n *     tabArr: [\n *         {\n *             id: string, // e.g. 'draw',\n *             label: string, // optional\n *             image: string, // optional background image\n *             title: string, // optional\n *             isVisible: boolean, // optional - default is true\n *             onOpen: function(),\n *             onClose: function(),\n *             css: {...},\n *         }\n *     ]\n * }\n *\n * @param p\n * @constructor\n */\nexport function TabRow(p) {\n    let _this = this;\n    let height = 35;\n    let div = BB.el({\n        className: 'tabrow',\n        css: {\n            height: height + 'px'\n        }\n    });\n\n    let tabArr = []; //creates its own internal arr\n    let openedTabObj = null;\n\n    const roundSize = 10;\n    const roundRight = BB.el({\n        css: {\n            width: roundSize + 'px',\n            height: roundSize + 'px',\n            backgroundImage: `url('${invertedBorderImg}')`,\n            backgroundSize: 'cover',\n            position: 'absolute',\n            right: -roundSize + 'px',\n            bottom: '0',\n            pointerEvents: 'none',\n        }\n    });\n    const roundLeft = BB.el({\n        css: {\n            width: roundSize + 'px',\n            height: roundSize + 'px',\n            backgroundImage: `url('${invertedBorderImg}')`,\n            backgroundSize: 'cover',\n            position: 'absolute',\n            left: -roundSize + 'px',\n            bottom: '0',\n            transform: 'scale(-1,1)',\n            pointerEvents: 'none',\n        }\n    });\n\n    function createTab(pTabObj, initialId, useAccent) {\n        let result: any = {\n            id: pTabObj.id,\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\n            onOpen: pTabObj.onOpen,\n            onClose: pTabObj.onClose,\n            update: function(openedTabObj) {\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\n            }\n        };\n        let tabDiv = BB.el({\n            content: 'label' in pTabObj ? pTabObj.label : '',\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\n            css: {\n                lineHeight: height + 'px',\n                display: result.isVisible ? 'block' : 'none',\n                zIndex: '0',\n            },\n            onClick: function() {\n                if (openedTabObj === result) {\n                    return;\n                }\n                _this.open(result.id);\n            }\n        });\n        result.div = tabDiv;\n        if ('image' in pTabObj) {\n            BB.css(tabDiv, {\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\n                backgroundSize: (height - 7) + 'px'\n            });\n        }\n        if ('css' in pTabObj) {\n            BB.css(tabDiv, pTabObj.css);\n        }\n        div.appendChild(tabDiv);\n\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n            target: tabDiv,\n            onEnterLeave: function(isOver) {\n                if (isOver) {\n                    BB.addClassName(tabDiv, 'tabrow-tab-hover');\n                } else {\n                    BB.removeClassName(tabDiv, 'tabrow-tab-hover');\n                }\n            }\n        });\n\n        if (initialId === result.id) {\n            result.onOpen();\n            result.div.appendChild(roundRight);\n            result.div.appendChild(roundLeft);\n        } else {\n            result.onClose();\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < p.tabArr.length; i++) {\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\n    }\n\n    for (let i = 0; i < tabArr.length; i++) {\n        if (tabArr[i].id === p.initialId) {\n            openedTabObj = tabArr[i];\n        }\n    }\n    if (openedTabObj === null) {\n        throw 'invalid initialId';\n    }\n\n    function update() {\n        for (let i = 0; i < tabArr.length; i++) {\n            tabArr[i].update(openedTabObj);\n        }\n    }\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n    this.open = function(tabId) {\n        for (let i = 0; i < tabArr.length; i++) {\n            if (tabArr[i].id === tabId) {\n                if (openedTabObj === tabArr[i]) { // already open\n                    return;\n                }\n                openedTabObj.onClose();\n                openedTabObj = tabArr[i];\n                openedTabObj.onOpen();\n                openedTabObj.div.appendChild(roundRight);\n                openedTabObj.div.appendChild(roundLeft);\n                update();\n                return;\n            }\n        }\n        throw 'TabRow.open - invalid tabId';\n    };\n\n    this.getOpenedTabId = function() {\n        return '' + openedTabObj.id;\n    };\n\n    this.setIsVisible = function(tabId, isVisible) {\n        for (let i = 0; i < tabArr.length; i++) {\n            if (tabArr[i].id === tabId) {\n                tabArr[i].isVisible = !!isVisible;\n                update();\n                return;\n            }\n        }\n        throw 'TabRow.setIsVisible - invalid tabId';\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"dPZrf\");","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui, when hand tool tab is open.\n *\n * p = {\n *     scale: number, // initial value\n *     angleDeg: number, // initial value\n *     onReset: function(),\n *     onFit: function(),\n *     onAngleChange: function(angleDeg number, isRelative number)\n * }\n *\n * @param p\n * @constructor\n */\nexport function HandUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n    let scale = p.scale;\n    let angleDeg = p.angleDeg;\n\n    let row1 = BB.el({\n        css: {\n            marginBottom: '10px',\n            display: 'flex'\n        }\n    });\n    let row2 = BB.el({\n        css: {\n            display: 'flex',\n            marginBottom: '10px',\n        }\n    });\n    let row3 = BB.el({\n        css: {\n            display: 'flex'\n        }\n    });\n    div.append(row1, row2, row3);\n\n\n    let scaleEl = BB.el({\n        css: {\n            width: '55px',\n            userSelect: 'none'\n        }\n    });\n    row1.appendChild(scaleEl);\n\n    let angleIm = new Image();\n    angleIm.src = angleImg;\n    BB.css(angleIm, {\n        verticalAlign: 'bottom',\n        width: '20px',\n        height: '20px',\n        marginRight: '5px',\n        borderRadius: '10px',\n        background: 'rgba(0,0,0,0.2)',\n        userSelect: 'none'\n    });\n    row1.appendChild(angleIm);\n\n    let angleEl = BB.el({\n        css: {\n            userSelect: 'none'\n        }\n    });\n    row1.appendChild(angleEl);\n\n\n    function update() {\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\n        angleEl.innerHTML =  Math.round(angleDeg) + '°';\n\n\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\n        if (angleDeg % 90 === 0) {\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\n        } else {\n            angleIm.style.boxShadow = '';\n        }\n    }\n    update();\n\n\n    let resetButton = BB.el({\n        tagName: 'button',\n        content: LANG('hand-reset'),\n        onClick: p.onReset\n    });\n    BB.makeUnfocusable(resetButton);\n\n    let fitButton = BB.el({\n        tagName: 'button',\n        content: LANG('hand-fit'),\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: p.onFit\n    });\n    BB.makeUnfocusable(fitButton);\n    row2.append(resetButton, fitButton);\n\n    let leftRotateButton = BB.el({\n        tagName: 'button',\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\n        onClick: function() {\n            p.onAngleChange(-15, true);\n        }\n    });\n    BB.makeUnfocusable(leftRotateButton);\n\n    let resetAngleButton = BB.el({\n        tagName: 'button',\n        content: '0°',\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: function() {\n            p.onAngleChange(0);\n        }\n    });\n    BB.makeUnfocusable(resetAngleButton);\n\n    let rightRotateButton = BB.el({\n        tagName: 'button',\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: function() {\n            p.onAngleChange(15, true);\n        }\n    });\n    BB.makeUnfocusable(rightRotateButton);\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            update();\n        }\n    };\n    this.update = function(pScale, pAngleDeg) {\n        scale = pScale;\n        angleDeg = pAngleDeg;\n        if (isVisible) {\n            update();\n        }\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"clLlI\");","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {Select} from '../base-components/select';\nimport {Checkbox} from '../base-components/checkbox';\nimport {LANG} from '../../../language/language';\n\n/**\n * Paint Bucket tab contents (color slider, opacity slider, etc)\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function FillUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: 250,\n        height: 30,\n        min: 0,\n        max: 1,\n        initValue: 1,\n        onChange: function (val) {\n        },\n        formatFunc: function(v) {\n            return Math.round(v * 100);\n        }\n    });\n    div.appendChild(opacitySlider.getElement());\n\n    let toleranceSlider = new KlSlider({\n        label: LANG('bucket-tolerance'),\n        width: 250,\n        height: 30,\n        min: 0,\n        max: 255,\n        initValue: 255 / 100 * 20,\n        onChange: function (val) {\n        },\n        formatFunc: function(v) {\n            return Math.round(v / 255 * 100);\n        }\n    });\n    BB.css(toleranceSlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(toleranceSlider.getElement());\n\n    let selectRow = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            marginTop: '10px'\n        }\n    });\n\n    let modeWrapper;\n    let modeSelect;\n    modeWrapper = BB.el({\n        content: LANG('bucket-sample') + '&nbsp;',\n        title: LANG('bucket-sample-title'),\n        css: {\n            fontSize: '15px'\n        }\n    });\n    modeSelect = new Select({\n        optionArr: [\n            ['all', LANG('bucket-sample-all')],\n            ['current', LANG('bucket-sample-active')],\n            ['above', LANG('bucket-sample-above')]\n        ],\n        initValue: 'all',\n        onChange: function(val) {}\n    });\n    let modePointerListener = new BB.PointerListener({\n        target: modeSelect.getElement(),\n        onWheel: function(e) {\n            modeSelect.setDeltaValue(e.deltaY);\n        }\n    });\n    modeWrapper.appendChild(modeSelect.getElement());\n    selectRow.appendChild(modeWrapper);\n\n    let growWrapper;\n    let growSelect;\n    growWrapper = BB.el({\n        content: LANG('bucket-grow') + '&nbsp;',\n        title: LANG('bucket-grow-title'),\n        css: {\n            fontSize: '15px',\n            marginLeft: '10px'\n        }\n    });\n    growSelect = new Select({\n        optionArr: [\n            ['0', '0'],\n            ['1', '1'],\n            ['2', '2'],\n            ['3', '3'],\n            ['4', '4'],\n            ['5', '5'],\n            ['6', '6'],\n            ['7', '7'],\n        ],\n        initValue: '0',\n        onChange: function(val) {}\n    });\n    let growPointerListener = new BB.PointerListener({\n        target: growSelect.getElement(),\n        onWheel: function(e) {\n            growSelect.setDeltaValue(e.deltaY);\n        }\n    });\n    growWrapper.appendChild(growSelect.getElement());\n    selectRow.appendChild(growWrapper);\n\n\n    let isContiguous = true;\n    let contiguousToggle = new Checkbox({\n        init: true,\n        label: LANG('bucket-contiguous'),\n        title: LANG('bucket-contiguous-title'),\n        callback: function (b) {\n            isContiguous = b;\n        },\n        css: {\n            marginTop: '10px',\n            paddingRight: '5px',\n            display: 'inline-block',\n        }\n    });\n    div.appendChild(contiguousToggle.getElement());\n\n\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n        }\n    };\n\n    this.getTolerance = function() {\n        return toleranceSlider.getValue();\n    };\n\n    this.getOpacity = function() {\n        return opacitySlider.getValue();\n    };\n\n    /**\n     * returns string 'current' | 'all' | 'above'\n     */\n    this.getSample = function() {\n        return modeSelect.getValue();\n    };\n\n    this.getGrow = function() {\n        return parseInt(growSelect.getValue(), 10);\n    }\n\n    this.getContiguous = function() {\n        return isContiguous;\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\n\n/**\n * Text Tool tab contents (color slider)\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function TextUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let hint = BB.el({\n        parent: div,\n        content: LANG('text-instruction'),\n    });\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n            //update();\n        }\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {Options} from '../base-components/options';\nimport {Checkbox} from '../base-components/checkbox';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {LANG} from '../../../language/language';\n\n/**\n * Shape Tool tab contents\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function ShapeUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let previewSize = 35;\n    let previewPadding = 8;\n    let shape; // 'rect'|'ellipse'|'line'\n    let mode; // 'stroke'|'fill'\n\n\n    let rectStrokeSvgRect = BB.createSvg({\n        elementType: 'rect',\n        x: '' + previewPadding,\n        width: '' + (previewSize - previewPadding * 2)\n    });\n    let rectStrokeSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\n    BB.css(rectStrokeSvg, {\n        display: 'block'\n    });\n\n    let rectFilledSvgRect = BB.createSvg({\n        elementType: 'rect',\n        x: '' + previewPadding,\n        width: '' + (previewSize - previewPadding * 2)\n    });\n    let rectFilledSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    rectFilledSvg.appendChild(rectFilledSvgRect);\n    BB.css(rectFilledSvg, {\n        display: 'block'\n    });\n\n\n    let ellipseStrokeSvgEllipse = BB.createSvg({\n        elementType: 'ellipse',\n        cx: '' + (previewSize / 2),\n        cy: '' + (previewSize / 2),\n        rx: '' + (previewSize / 2 - previewPadding)\n    });\n    let ellipseStrokeSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize,\n    });\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\n    BB.css(ellipseStrokeSvg, {\n        display: 'block'\n    });\n\n    let ellipseFilledSvgEllipse = BB.createSvg({\n        elementType: 'ellipse',\n        cx: '' + (previewSize / 2),\n        cy: '' + (previewSize / 2),\n        rx: '' + (previewSize / 2 - previewPadding)\n    });\n    let ellipseFilledSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize,\n    });\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\n    BB.css(ellipseFilledSvg, {\n        display: 'block'\n    });\n\n\n    let lineSvgLine = BB.createSvg({\n        elementType: 'line',\n        x1: '' + previewPadding,\n        x2: '' + (previewSize - previewPadding)\n    });\n    let lineSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    lineSvg.appendChild(lineSvgLine);\n    BB.css(lineSvg, {\n        display: 'block'\n    });\n\n    function updatePreviews() {\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\n\n        let squish = 1.35;\n\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\n\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\n\n        BB.css(\n            lineSvgLine,\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\n        );\n\n        if ((fixedToggle as any).getValue()) {\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n        } else {\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n        }\n\n        if ((snapToggle as any).getValue()) {\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\n        } else {\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\n        }\n    }\n\n    let row1 = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'start'\n        }\n    });\n\n    let shapeOptions = new Options({\n        optionArr: [\n            {\n                id: 'rect-stroke',\n                label: rectStrokeSvg,\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\n            },\n            {\n                id: 'ellipse-stroke',\n                label: ellipseStrokeSvg,\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\n            },\n            {\n                id: 'line',\n                label: lineSvg,\n                title: LANG('shape-line'),\n            },\n            {\n                id: 'rect-fill',\n                label: rectFilledSvg,\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\n            },\n            {\n                id: 'ellipse-fill',\n                label: ellipseFilledSvg,\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\n            },\n        ],\n        initId: 'rect',\n        onChange: function(id) {\n            let split = id.split('-');\n            shape = split[0];\n            mode = split[1];\n\n            BB.css(fixedToggle.getElement(), {\n                display: shape === 'line' ? 'none' : null\n            });\n            BB.css(snapToggle.getElement(), {\n                display: shape === 'line' ? null : 'none'\n            });\n            BB.css(lineWidthSlider.getElement(), {\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\n            });\n        },\n        changeOnInit: true\n    });\n    shapeOptions.getElement().style.width = '120px';\n    row1.appendChild(shapeOptions.getElement());\n\n    let eraserToggle = new Checkbox({\n        init: false,\n        label: LANG('eraser'),\n        callback: function(b) {\n            updatePreviews();\n        }\n    });\n    row1.appendChild(eraserToggle.getElement());\n\n    let lineWidthSlider = new KlSlider({\n        label: LANG('shape-line-width'),\n        width: 250,\n        height: 30,\n        min: 1,\n        max: 200,\n        initValue: 4,\n        curve: 'quadratic',\n        onChange: function (val) {\n            updatePreviews();\n        },\n        formatFunc: function (v) {\n            return Math.round(v);\n        }\n    });\n    BB.css(lineWidthSlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(lineWidthSlider.getElement());\n\n    let opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: 250,\n        height: 30,\n        min: 0,\n        max: 1,\n        initValue: 1,\n        onChange: function (val) {\n        },\n        formatFunc: function (v) {\n            return Math.round(v * 100);\n        }\n    });\n    BB.css(opacitySlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(opacitySlider.getElement());\n\n    let row2 = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            marginTop: '10px'\n        }\n    });\n\n    let outwardsToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-outwards'),\n        callback: function(b) {},\n        css: {\n            width: '50%',\n            marginRight: '10px',\n        }\n    });\n    row2.appendChild(outwardsToggle.getElement());\n\n    let fixedToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-fixed'),\n        callback: function(b) {\n            updatePreviews();\n        },\n        css: {\n            flexGrow: '1',\n        }\n    });\n    row2.appendChild(fixedToggle.getElement());\n\n    let snapToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-snap'),\n        title: LANG('shape-snap-title'),\n        callback: function(b) {\n            updatePreviews();\n        },\n        css: {\n            flexGrow: '1',\n        }\n    });\n    row2.appendChild(snapToggle.getElement());\n\n\n\n    updatePreviews();\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n            //update();\n        }\n    };\n\n    this.getShape = function() {\n        return shape;\n    };\n\n    this.getMode = function() {\n        return mode;\n    };\n\n    this.getIsEraser = function() {\n        return (eraserToggle as any).getValue();\n    };\n\n    this.getOpacity = function() {\n        return opacitySlider.getValue();\n    };\n\n    this.getLineWidth = function() {\n        return lineWidthSlider.getValue();\n    };\n\n    this.getIsOutwards = function() {\n        return (outwardsToggle as any).getValue();\n    };\n\n    this.getIsFixed = function() {\n        return (fixedToggle as any).getValue();\n    };\n\n    this.getIsSnap = function() {\n        return (snapToggle as any).getValue();\n    };\n\n}","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * P = {\r\n *     currentColor: RGB, // current color\r\n *     secondaryColor: RGB,\r\n *     maxCanvasSize: number,\r\n *     canvasWidth: number, // current canvas size\r\n *     canvasHeight: number, // current canvas size\r\n *     workspaceWidth: number,\r\n *     workspaceHeight: number,\r\n *     onConfirm: function(width number, height number, color RGBA),\r\n *     onCancel: function()\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function newImageDialog(p) {\r\n\r\n    let currentColor = p.currentColor;\r\n    let secondaryColor = p.secondaryColor;\r\n    let maxCanvasSize = p.maxCanvasSize;\r\n    let canvasWidth = p.canvasWidth;\r\n    let canvasHeight = p.canvasHeight;\r\n    let workspaceWidth = p.workspaceWidth;\r\n    let workspaceHeight = p.workspaceHeight;\r\n    let onConfirm = p.onConfirm;\r\n    let onCancel = p.onCancel;\r\n\r\n\r\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\r\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\r\n    }\r\n\r\n    let newImDiv = document.createElement(\"div\");\r\n    let widthWrapper = document.createElement(\"div\");\r\n    let heightWrapper = document.createElement(\"div\");\r\n    let widthInput = document.createElement(\"input\");\r\n    let widthUnit = document.createElement(\"div\");\r\n    let heightInput = document.createElement(\"input\");\r\n    let heightUnit = document.createElement(\"div\");\r\n    widthWrapper.style.position = \"relative\";\r\n    widthWrapper.style.width = \"145px\";\r\n    widthWrapper.style.height = \"35px\";\r\n    widthWrapper.style.lineHeight = \"30px\";\r\n    heightWrapper.style.width = \"145px\";\r\n    heightWrapper.style.height = \"35px\";\r\n    heightWrapper.style.lineHeight = \"30px\";\r\n\r\n    widthUnit.innerText = LANG('new-px');\r\n    widthUnit.style.color = '#888';\r\n    widthUnit.style.fontSize = \"12px\";\r\n    widthUnit.style.marginLeft = \"5px\";\r\n    widthUnit.style.cssFloat = \"right\";\r\n\r\n    heightUnit.innerText = LANG('new-px');\r\n    heightUnit.style.color = '#888';\r\n    heightUnit.style.fontSize = \"12px\";\r\n    heightUnit.style.marginLeft = \"5px\";\r\n    heightUnit.style.cssFloat = \"right\";\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = maxCanvasSize;\r\n    widthInput.style.cssFloat = \"right\";\r\n    widthInput.style.width = \"70px\";\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = maxCanvasSize;\r\n    heightInput.style.cssFloat = \"right\";\r\n    heightInput.style.width = \"70px\";\r\n    widthInput.value = canvasWidth;\r\n    heightInput.value = canvasHeight;\r\n    widthInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    widthWrapper.appendChild(widthUnit);\r\n    widthWrapper.appendChild(widthInput);\r\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\r\n    heightWrapper.appendChild(heightUnit);\r\n    heightWrapper.appendChild(heightInput);\r\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\r\n    let ratioWrapper = document.createElement(\"div\");\r\n    ratioWrapper.style.marginTop = '5px';\r\n    ratioWrapper.style.color = '#888';\r\n\r\n    let templateWrapper = document.createElement(\"div\");\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    let presetFitBtn = document.createElement(\"button\");\r\n    templateWrapper.style.marginBottom = \"10px\";\r\n    let presetCurrentBtn = document.createElement(\"button\");\r\n    let presetSquareBtn = document.createElement(\"button\");\r\n    let presetLandscapeBtn = document.createElement(\"button\");\r\n    let presetPortraitBtn = document.createElement(\"button\");\r\n    let presetOversizeBtn = document.createElement(\"button\");\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = \"5px\";\r\n    presetFitBtn.style.marginRight = \"5px\";\r\n    presetOversizeBtn.style.marginRight = \"5px\";\r\n    presetLandscapeBtn.style.marginTop = \"5px\";\r\n    presetLandscapeBtn.style.marginRight = \"5px\";\r\n    presetPortraitBtn.style.marginTop = \"5px\";\r\n    presetPortraitBtn.style.marginRight = \"5px\";\r\n\r\n    templateWrapper.appendChild(presetCurrentBtn);\r\n    templateWrapper.appendChild(presetFitBtn);\r\n    templateWrapper.appendChild(presetOversizeBtn);\r\n    templateWrapper.appendChild(presetSquareBtn);\r\n    templateWrapper.appendChild(presetLandscapeBtn);\r\n    templateWrapper.appendChild(presetPortraitBtn);\r\n\r\n    let templatePadding = 50;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = canvasWidth;\r\n        heightInput.value = canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth;\r\n        heightInput.value = workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth + 500;\r\n        heightInput.value = workspaceHeight + 500;\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    let select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' √2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:√2']\r\n        ],\r\n        onChange: function(val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                let split = val.split(' ');\r\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        }\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.appendChild(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    let colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0}\r\n    ];\r\n    colorOptionsArr.push({\r\n        r: currentColor.r,\r\n        g: currentColor.g,\r\n        b: currentColor.b,\r\n        a: 1\r\n    });\r\n    colorOptionsArr.push({\r\n        r: secondaryColor.r,\r\n        g: secondaryColor.g,\r\n        b: secondaryColor.b,\r\n        a: 1\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        onChange: function(rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\r\n        }\r\n    });\r\n\r\n    let previewWrapper = document.createElement(\"div\");\r\n    BB.css(previewWrapper, {\r\n        boxSizing: 'border-box',\r\n        width: '340px',\r\n        height: '140px',\r\n        display: 'table',\r\n        backgroundColor: '#9e9e9e',\r\n        padding: '10px',\r\n        marginTop: '10px',\r\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n        marginLeft: '-20px',\r\n        colorScheme: 'only light',\r\n    });\r\n    let preview = document.createElement(\"div\");\r\n    BB.css(preview, {\r\n        width: 200 + \"px\",\r\n        height: 100 + \"px\",\r\n        backgroundColor: \"#fff\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        color: \"#aaa\",\r\n        fontSize: \"16px\",\r\n        fontWeight: \"bold\",\r\n        textAlign: \"center\",\r\n        verticalAlign: \"center\",\r\n        display: \"table\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\r\n    });\r\n    let previewcell = document.createElement(\"div\");\r\n    previewcell.style.display = \"table-cell\";\r\n    previewcell.style.verticalAlign = \"middle\";\r\n    previewcell.appendChild(preview);\r\n    previewWrapper.appendChild(previewcell);\r\n    let cell = BB.appendTextDiv(preview, \"\");\r\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\r\n    cell.style.display = \"table-cell\";\r\n    cell.style.verticalAlign = \"middle\";\r\n    let prevW = parseInt(widthInput.value);\r\n    let prevH = parseInt(heightInput.value);\r\n\r\n    function updateRatio() {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function HCF(u, v) {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V))\r\n                    return V;\r\n                if (!(V %= U))\r\n                    return U;\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize)\r\n                w = maxCanvasSize;\r\n            else if (h > maxCanvasSize)\r\n                h = maxCanvasSize;\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        let commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        let reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        prevW = w;\r\n        prevH = h;\r\n        let realw = w;\r\n        let T = HCF(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + \"px\";\r\n        preview.style.height = h + \"px\";\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n    }\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.appendChild(templateWrapper);\r\n    let secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end'\r\n        }\r\n    });\r\n    let secondRowLeft = BB.el({\r\n        parent: secondRow\r\n    });\r\n    secondRowLeft.appendChild(widthWrapper);\r\n    secondRowLeft.appendChild(heightWrapper);\r\n    secondRowLeft.appendChild(ratioWrapper);\r\n    secondRow.appendChild(colorOptions.getElement());\r\n\r\n    newImDiv.appendChild(previewWrapper);\r\n\r\n    popup({\r\n        target: p.klRootEl,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n\r\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\r\n        },\r\n        clickOnEnter: 'Ok'\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\nimport {LANG} from \"../../../language/language\";\n\n/**\n * button that allows to collapse toolspace (for mobile)\n *\n * p = {\n *     onChange: function()\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceCollapser(p) {\n    let isOpen = true;\n    let directionStr = 'right'; // 'left' | 'right'\n\n    function update() {\n        if (directionStr === 'left') {\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\n        } else {\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\n        }\n    }\n\n    let div = BB.el({\n        css: {\n            width: '36px',\n            height: '36px',\n            background: 'rgba(100, 100, 100, 0.9)',\n            color: '#fff',\n            position: 'absolute',\n            top: '0',\n            textAlign: 'center',\n            lineHeight: '36px',\n            cursor: 'pointer',\n            userSelect: 'none',\n            padding: '6px',\n            boxSizing: 'border-box'\n        },\n        title: LANG('toggle-show-tools'),\n        onClick: function(e) {\n            e.preventDefault();\n            isOpen = !isOpen;\n            update();\n            p.onChange();\n        }\n    });\n\n    let icon = BB.el({\n        parent: div,\n        css: {\n            backgroundImage: `url(${collapseImg})`,\n            width: '100%',\n            height: '100%',\n            backgroundSize: 'contain',\n            backgroundRepeat: 'no-repeat',\n            backgroundPosition: 'center',\n            userSelect: 'none'\n        }\n    });\n    div.oncontextmenu = function () {\n        return false;\n    };\n\n    // --- interface ---\n    this.isOpen = function() {\n        return isOpen;\n    };\n\n    /**\n     *\n     * @param dirStr\n     */\n    this.setDirection = function(dirStr) {\n        directionStr = dirStr;\n        update();\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"l3vCz\");","import { BB } from '../../../bb/bb';\r\nimport { renderText } from '../../image-operations/render-text';\r\nimport { ColorOptions } from '../base-components/color-options';\r\nimport { Select } from '../base-components/select';\r\nimport { ImageRadioList } from '../base-components/image-radio-list';\r\nimport { ImageToggle } from '../base-components/image-toggle';\r\nimport { KlSlider } from '../base-components/kl-slider';\r\nimport { popup } from './popup';\r\n// @ts-ignore\r\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\r\n// @ts-ignore\r\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\r\n// @ts-ignore\r\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\r\n// @ts-ignore\r\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\r\n// @ts-ignore\r\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\nimport { BBox, IRGB } from '../../kl.types';\r\nimport { KlCanvas } from '../../canvas/kl-canvas';\r\nimport { LANG } from '../../../language/language';\r\n\r\n/**\r\n * Text Tool dialog\r\n *\r\n * confirmP = {\r\n *     x: number,\r\n *     y: number,\r\n *     textStr: string,\r\n *     align: 'left' | 'center' | 'right',\r\n *     isItalic: boolean,\r\n *     isBold: boolean,\r\n *     color: rgb,\r\n *     size: number, // px\r\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\r\n *     opacity: number, // 0 - 1\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function textToolDialog(\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: 'left' | 'center' | 'right'; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n        opacity: number; // 0 - 1; default 1\r\n        onConfirm: (confirmP) => void;\r\n        klRootEl: HTMLElement;\r\n        bbox: BBox;\r\n    }\r\n) {\r\n\r\n    let div = BB.el({});\r\n\r\n    let isSmallWidth = p.bbox.width < 550;\r\n    let isSmallHeight = p.bbox.height < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    let width = isSmallWidth ? 340 : 540;\r\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    let layerArr = p.klCanvas.getLayersFast();\r\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    let textCtx = textCanvas.getContext('2d');\r\n    let targetCanvas = BB.canvas(width, height);\r\n    let targetCtx = targetCanvas.getContext('2d');\r\n    let layersCanvas = BB.canvas(width, height);\r\n    let layersCtx = layersCanvas.getContext('2d');\r\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    let previewCtx = previewCanvas.getContext('2d');\r\n    BB.css(previewCanvas, {\r\n        display: 'block'\r\n    });\r\n    let previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            colorScheme: 'only light',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: function () {\r\n            textInput.focus();\r\n        }\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(previewCanvas);\r\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\r\n    let emptyCanvas = BB.canvas(1, 1);\r\n    {\r\n        let ctx = emptyCanvas.getContext('2d');\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updatePreview() {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        let colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        let bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        let padding = 100;\r\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            let borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = 0.2;\r\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (var i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    function move(x, y) {\r\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    let previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        pointers: 1,\r\n        onPointer: function (e) {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: function (e) {\r\n            changeZoomFac(-e.deltaY);\r\n        }\r\n    });\r\n\r\n    const wheelPrevent = (event) => {\r\n        event.preventDefault();\r\n    }\r\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n\r\n\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n    let row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px'\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px'\r\n        }\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    let selectedRgbaObj = { r: 0, g: 0, b: 0, a: 1 };\r\n    let colorOptionsArr = [\r\n        { r: 0, g: 0, b: 0, a: 1 },\r\n        { r: 255, g: 255, b: 255, a: 1 }\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: function (rgbaObj) {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        }\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.appendChild(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n    function changeZoomFac(d) {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n    function canZoom(d) {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    let zoomWrapper = BB.el({\r\n        parent: row1,\r\n        css: {\r\n\r\n        }\r\n    })\r\n\r\n    let zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: function () {\r\n            changeZoomFac(1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold'\r\n        }\r\n    }) as HTMLButtonElement;\r\n    let zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: function () {\r\n            changeZoomFac(-1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px'\r\n        }\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    let sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size\r\n        },\r\n        css: {\r\n            width: '60px'\r\n        },\r\n        onChange: function () {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        }\r\n    }) as HTMLInputElement;\r\n    let sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: function (e) {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let fontSelect;\r\n    let fontPointerListener;\r\n    {\r\n        modeWrapper = BB.el({\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px'\r\n            }\r\n        });\r\n        fontSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['sans-serif', 'Sans-serif'],\r\n                ['serif', 'Serif'],\r\n                ['monospace', 'Monospace'],\r\n                ['cursive', 'Cursive'],\r\n                ['fantasy', 'Fantasy'],\r\n            ],\r\n            initValue: p.font,\r\n            onChange: function (val) {\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        modeWrapper.appendChild(fontSelect.getElement());\r\n        row2.appendChild(modeWrapper);\r\n\r\n        fontPointerListener = new BB.PointerListener({\r\n            target: fontSelect.getElement(),\r\n            onWheel: function (e) {\r\n                fontSelect.setDeltaValue(e.deltaY);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    let alignRadioList = new ImageRadioList({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n            }\r\n        ],\r\n        initId: p.align,\r\n        onChange: function (id) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(alignRadioList.getElement());\r\n\r\n    let italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: function (b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(italicToggle.getElement());\r\n\r\n    let boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: function (b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(boldToggle.getElement());\r\n\r\n\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function (v) {\r\n            updatePreview();\r\n        },\r\n        formatFunc: function (v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    row3.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    let textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'nowrap',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px'\r\n        },\r\n        onChange: function () {\r\n            updatePreview();\r\n        }\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(function () {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    let closefunc;\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr) {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll() {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    popup({\r\n        target: p.klRootEl,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px'\r\n        },\r\n        callback: function (val) {\r\n            let result = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: sizeInput.value,\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue()\r\n            };\r\n\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        },\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"cZo4h\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"11saA\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hcB4I\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"gPzoD\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"kKe79\");","import { BB } from '../../../bb/bb';\r\nimport { CropCopy } from '../components/crop-copy';\r\nimport { Checkbox } from '../base-components/checkbox';\r\nimport { popup } from './popup';\r\nimport { LANG } from '../../../language/language';\r\n\r\n/**\r\n *\r\n * p = {\r\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\r\n *     maxSize: number,\r\n *     target: htmlElement,\r\n *     callback: func(\r\n *         {\r\n *             type: 'as-image',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'as-image-psd',\r\n *             image: convertedPsd,\r\n *             cropObj: {x: number, y: number, width: number, height: number}\r\n *         } | {\r\n *             type: 'as-layer',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'cancel',\r\n *         }\r\n *     )\r\n * }\r\n *\r\n * @param p {}\r\n */\r\nexport function showImportImageDialog(p) {\r\n    const div = BB.el({});\r\n\r\n    const isSmall = p.bbox.width < 550 || p.bbox.height < 550;\r\n    const style = isSmall ? {} : { width: '500px' };\r\n    let resolutionEl;\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: function (width, height) {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        }\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n\r\n    resolutionEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        }\r\n    });\r\n    function updateResolution(w: number, h: number) {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span> ⟶ ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings(psdWarningArr) {\r\n        let contentArr = [];\r\n        let warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join(\"\\n\"));\r\n    }\r\n\r\n    let flattenCheckbox;\r\n    if (p.image.type === 'psd') {\r\n        const noteStyle = {\r\n            background: 'rgba(255,255,0,0.5)',\r\n            padding: '10px',\r\n            marginTop: '5px',\r\n            marginBottom: '5px',\r\n            border: '1px solid #e7d321',\r\n            borderRadius: '5px'\r\n        };\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: function (b) {\r\n                    doFlatten = b;\r\n                }\r\n            });\r\n            div.appendChild(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    content: LANG('import-psd-limited-support'),\r\n                    css: noteStyle\r\n                });\r\n                noteEl.appendChild(BB.el({\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    onClick: function () {\r\n                        showWarnings(p.image.warningArr);\r\n                    }\r\n                }));\r\n                div.appendChild(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                content: LANG('import-psd-unsupported'),\r\n                css: noteStyle\r\n            });\r\n            div.appendChild(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback(result) {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        cropCopy.destroy();\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: croppedImage\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    p.image.layers = null;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel'\r\n            });\r\n        }\r\n    }\r\n    popup({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: div,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\r\n        callback: callback,\r\n        autoFocus: 'As Image'\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\nimport {Psd} from 'ag-psd/dist/psd';\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\n\nlet kl2PsdMap;\nlet psd2KlMap;\n\nfunction init() {\n    if (kl2PsdMap) {\n        return;\n    }\n\n    kl2PsdMap = {\n        'source-over': 'normal',\n\n        'darken': 'darken',\n        'multiply': 'multiply',\n        'color-burn': 'color burn',\n\n        'lighten': 'lighten',\n        'screen': 'screen',\n        'color-dodge': 'color dodge',\n\n        'overlay': 'overlay',\n        'soft-light': 'soft light',\n        'hard-light': 'hard light',\n\n        'difference': 'difference',\n        'exclusion': 'exclusion',\n\n        'hue': 'hue',\n        'saturation': 'saturation',\n        'color': 'color',\n        'luminosity': 'luminosity',\n    };\n\n    psd2KlMap = {};\n    let keys = Object.keys(kl2PsdMap);\n    for (let i = 0; i < keys.length; i++) {\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\n    }\n}\n\nexport function blendPsdToKl(str: string): IMixMode {\n    init();\n    return psd2KlMap[str];\n}\n\nexport function blendKlToPsd(str: string): string {\n    init();\n    return kl2PsdMap[str];\n}\n\n\n/**\n * Converts ag-psd object into something that KlCanvas can represent\n * @param psdObj\n */\nexport function readPsd(psdObj: Psd): IKlPsd {\n    let result: IKlPsd = {\n        type: 'psd',\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height\n    };\n\n    function addWarning(warningStr) {\n        if (!result.warningArr) {\n            result.warningArr = [];\n        }\n        if (result.warningArr.includes(warningStr)) {\n            return;\n        }\n        result.warningArr.push(warningStr);\n    }\n\n    function getMixModeStr(blendMode): IMixMode {\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\n        if (!mixModeStr) {\n            addWarning('blend-mode');\n            mixModeStr = 'source-over';\n        }\n        return mixModeStr;\n    }\n\n    if (psdObj.bitsPerChannel !== 8) {\n        addWarning('bits-per-channel');\n    }\n\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n\n    // count resulting layers\n    let maxLayers = MAX_LAYERS;\n    let layerCount = 0;\n    function countWithinGroup(groupObj) {\n        let result = 0;\n        if (groupObj.blendMode) {\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== 'source-over') {\n                return 1;\n            }\n        }\n        for (let i = 0; i < groupObj.children.length; i++) {\n            let item = groupObj.children[i];\n            if (item.clipping || item.adjustment) {\n                continue;\n            }\n\n            if (item.children) {\n                addWarning('group');\n                result += countWithinGroup(item);\n            } else {\n                result++;\n            }\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n\n    result.layers = [];\n\n    function prepareMask(maskCanvas, defaultColor) {\n        const groupMaskCtx = maskCanvas.getContext('2d');\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = imData.data[i];\n            }\n        } else {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = 255 - imData.data[i];\n            }\n        }\n        groupMaskCtx.putImageData(imData, 0, 0);\n    }\n\n    function convertGroup(psdGroupObj): {\n        name: string;\n        mixModeStr: IMixMode;\n        opacity: number;\n        image: HTMLCanvasElement;\n    }[] {\n\n        let resultArr: {\n            name: string;\n            mixModeStr: IMixMode;\n            opacity: number;\n            image: HTMLCanvasElement;\n        }[] = [];\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\n        let groupCanvas;\n        let groupCtx;\n        if (groupMixModeStr !== 'source-over') {\n            groupCanvas = createCanvas(result.width, result.height);\n            groupCtx = groupCanvas.getContext('2d');\n        }\n\n\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning('mask');\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\n        }\n\n\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\n            let item = psdGroupObj.children[i];\n            if (item.clipping) {\n                continue;\n            }\n            if (item.adjustment) {\n                addWarning('adjustment');\n                continue;\n            }\n\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\n            if (hasClipping) {\n                addWarning('clipping');\n            }\n\n            if (item.children) {\n                let innerArr = convertGroup(item);\n\n                for (let e = 0; e < innerArr.length; e++) {\n                    let innerItem = innerArr[e];\n                    let innerCtx = innerItem.image.getContext('2d');\n\n                    // clipping\n                    if (hasClipping) {\n                        let clippingCanvas = createCanvas(result.width, result.height);\n                        let clippingCtx = clippingCanvas.getContext('2d');\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\n\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\n                            let clippingItem = psdGroupObj.children[f];\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                                continue;\n                            }\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                            clippingCtx.globalAlpha = clippingItem.opacity;\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\n                        }\n\n                        innerCtx.globalCompositeOperation = 'source-atop';\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\n                    }\n\n\n\n                    // group mask\n                    if (psdGroupObj.mask) {\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                    }\n\n                    if (groupCanvas) {\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                        groupCtx.globalAlpha = innerItem.opacity;\n                        groupCtx.drawImage(innerItem.image, 0, 0);\n\n                    } else {\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\n                        resultArr.push(innerItem);\n                    }\n                }\n\n                continue;\n            }\n\n            let canvas = createCanvas(result.width, result.height);\n            let ctx = canvas.getContext('2d');\n            if (item.canvas) { // if a layer is empty it has no canvas\n                ctx.drawImage(item.canvas, item.left, item.top);\n            }\n\n            // effects\n            if (item.effects) {\n                addWarning('layer-effect');\n            }\n\n            // mask\n            if (item.mask) {\n                addWarning('mask');\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\n\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n            }\n\n            // clipping\n            if (hasClipping) {\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\n                let clippingCtx = clippingCanvas.getContext('2d');\n                clippingCtx.drawImage(item.canvas, 0, 0);\n\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\n                    let clippingItem = psdGroupObj.children[e];\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                        continue;\n                    }\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                    clippingCtx.globalAlpha = clippingItem.opacity;\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\n                }\n\n                ctx.globalCompositeOperation = 'source-atop';\n                ctx.drawImage(clippingCanvas, item.left, item.top);\n            }\n\n            // group mask\n            if (psdGroupObj.mask) {\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n            }\n\n            if (groupCanvas) {\n                if (groupOpacity > 0) {\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                    groupCtx.drawImage(canvas, 0, 0);\n                }\n\n            } else {\n                resultArr.push({\n                    name: item.name,\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\n                    mixModeStr: getMixModeStr(item.blendMode),\n                    image: canvas,\n                });\n            }\n        }\n\n        if (groupCanvas) {\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas,\n                }\n            ];\n        }\n\n        return resultArr;\n    }\n\n    result.layers = convertGroup({\n        name: 'root',\n        opacity: 1,\n        blendMode: 'normal',\n        children: psdObj.children\n    });\n\n    return result;\n}\n\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\n    // only share references to Canvas elements\n    const result: IKlProject = {\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: [],\n    };\n    if (klPsd.layers) {\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\n            return {\n                name: item.name,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                image: item.image,\n            };\n        }));\n    } else {\n        // flattened\n        result.layers.push({\n            name: LANG('background'),\n            opacity: 1,\n            mixModeStr: 'source-over',\n            image: klPsd.canvas,\n        });\n    }\n    return result;\n}","//browser storage indexedDB\n\n\nimport {IKlStorageProject} from '../kl.types';\n\nconst indexedDbIsSupported = !!window.indexedDB;\nlet dbNameStr = 'Klecks';\nconst storageNameStr = 'ProjectStore';\n\nexport function setDbName(name: string) {\n    dbNameStr = '' + name;\n}\n\n/**\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\n * with index 'id'\n *\n * @param actionFunction function(storeObj) - what you want to execute during transaction\n * @param successCallback function() - on succesful transaction\n * @param errorCallback function(errorStr) - on error\n */\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\n\n    let hasFinished = false;\n\n    function onSuccess() {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        successCallback();\n    }\n\n    function onError(errorStr) {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        errorCallback(errorStr);\n    }\n\n    if (!indexedDbIsSupported) {\n        setTimeout(function () {\n            onError('no indexed db available');\n        }, 0);\n        return;\n    }\n    let requestObj;\n\n    try {\n        requestObj = window.indexedDB.open(dbNameStr, 1);\n    } catch (e) {\n        onError(e.message);\n        return;\n    }\n\n    requestObj.onupgradeneeded = function (e) {\n        try {\n            let db = requestObj.result;\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\n            store.createIndex('id', 'id', {unique: true});\n        } catch (e) {\n            onError(e.message);\n        }\n    };\n    requestObj.onerror = function (e) {\n        onError('indexedDB.open failed, ' + requestObj.error);\n    };\n    requestObj.onsuccess = function (e) {\n        let databaseObj;\n        let transactionObj;\n        let storeObj;\n\n        try {\n            databaseObj = requestObj.result;\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\n                //someone maybe messed with the db, or creation failed earlier\n                //it's broken -> destroy\n                window.indexedDB.deleteDatabase(dbNameStr);\n                onError('object store ' + storageNameStr + ' missing. destroying db');\n                return;\n            }\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\n            storeObj = transactionObj.objectStore(storageNameStr);\n            storeObj.index('id');\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n\n        databaseObj.onerror = function (e) {\n            onError('database error, ' + databaseObj.error);\n        };\n\n        try {\n            actionFunction(storeObj);\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n\n        transactionObj.oncomplete = function () {\n            onSuccess();\n            databaseObj.close();\n        };\n        transactionObj.onerror = function () {\n            onError('transaction error, ' + transactionObj.error);\n        };\n    };\n}\n\n/**\n * getKlProjectObj {\n *     width: int,\n *     height: int,\n *     layers: {\n *        name: string,\n *        opacity: float (0 - 1),\n *        mixModeStr: string,\n *        image: image object                <--------- image already loaded!\n *     }[]\n * }\n *\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\n * @param errorCallback - function(errorStr) - called when error during query\n */\nexport function getKlProjectObj(successCallback, errorCallback) {\n    if (indexedDbIsSupported) {\n        let query;\n        execIndexedDBTransaction(function (storeObj) {\n            query = storeObj.get(1);\n        }, function () {\n            successCallback(query.result);\n        }, function (errorStr) {\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\n        });\n    } else {\n        successCallback(null);\n    }\n}\n\n/**\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\n *\n * KlProjectObj {\n *     width: int,\n *     height: int,\n *     layers: {\n *        name: string,\n *        opacity: float (0 - 1),\n *        mixModeStr: string,\n *        blob: blob object                 <--------- blob!\n *     }[]\n * }\n *\n * @param storageProject IKlStorageProject - project to be stored\n * @param successCallback function() - on successful transaction\n * @param errorCallback function(errorStr) - on error\n */\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.put(storageProject);\n    }, function () {\n        successCallback();\n    }, function (errorStr) {\n        errorCallback(errorStr);\n    });\n\n}\n\n/**\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\n *\n * @param successCallback function() - on successful transaction\n * @param errorCallback function(error) - on error\n */\nexport function clear(successCallback, errorCallback) {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.delete(1);\n    }, function () {\n        successCallback();\n    }, function (error) {\n        errorCallback(error);\n    });\n\n}\n","import {IFilter} from '../kl.types';\n// @ts-ignore\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\n// @ts-ignore\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\n// @ts-ignore\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\n// @ts-ignore\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\n// @ts-ignore\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\n// @ts-ignore\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\n// @ts-ignore\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\n// @ts-ignore\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\n// @ts-ignore\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\n// @ts-ignore\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\n// @ts-ignore\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\n// @ts-ignore\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\n// @ts-ignore\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\n// @ts-ignore\nimport aImg from 'url:~/src/app/img/ui/';\nimport {LANG, languageStrings} from '../../language/language';\n\n\nexport const filterLibStatus = {\n    isLoaded: false,\n};\nexport const filterLib: {\n    [key:string]: IFilter;\n} = {\n    glBrightnessContrast: {\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\n        name: '',\n        buttonLabel: '',\n        webgl: true,\n        updateContext: true,\n        icon: glBrightnessContrastImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    cropExtend: {\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\n        name: '',\n        buttonLabel: '',\n        icon: cropExtendImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    glCurves: {\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\n        name: '',\n        buttonLabel: '',\n        icon: glCurvesImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    flip: {\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\n        name: '',\n        buttonLabel: '',\n        icon: flipImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glHueSaturation: {\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\n        name: '',\n        buttonLabel: '',\n        icon: glHueSaturationImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    invert: {\n        lang: {name: 'filter-invert', button: 'filter-invert'},\n        name: '',\n        icon: invertImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glPerspective: {\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\n        name: '',\n        buttonLabel: '',\n        icon: glPerspectiveImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    resize: {\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\n        name: '',\n        buttonLabel: '',\n        icon: resizeImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    rotate: {\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\n        name: '',\n        buttonLabel: '',\n        icon: rotateImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    glTiltShift: {\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\n        name: '',\n        buttonLabel: '',\n        icon: glTiltShiftImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    toAlpha: {\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\n        name: '',\n        buttonLabel: '',\n        icon: toAlphaImg,\n        webgl: true,\n        updateContext: false,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    transform: {\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\n        name: '',\n        buttonLabel: '',\n        icon: transformImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: false,\n        ieFails: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glBlur: {\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\n        name: '',\n        buttonLabel: '',\n        icon: glBlurImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glUnsharpMask: {\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\n        name: '',\n        buttonLabel: '',\n        icon: glUnsharpMaskImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    }\n};\n\nfunction updateNames() {\n    const keys = Object.keys(filterLib);\n    keys.forEach(item => {\n        filterLib[item].name = LANG(filterLib[item].lang.name);\n        filterLib[item].buttonLabel = LANG(filterLib[item].lang.button);\n    });\n}\nupdateNames();\n\nlanguageStrings.subscribe(() => {\n    updateNames();\n});","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1Oflz\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"dGQ4d\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8rV5I\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"iPOLX\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"2WSEP\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5bY62\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"eyn8D\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8KV42\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"bXtKb\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"fGBUx\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8Rt9n\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1nMkR\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5voce\");","import {PenBrush} from './pen-brush';\nimport {BlendBrush} from './blend-brush';\nimport {SketchyBrush} from './sketchy-brush';\nimport {PixelBrush} from './pixel-brush';\nimport {EraserBrush} from './eraser-brush';\nimport {SmudgeBrush} from './smudge-brush';\nimport {ChemyBrush} from './chemy-brush';\n\nexport const brushes = {\n    PenBrush,\n    BlendBrush,\n    SketchyBrush,\n    PixelBrush,\n    ChemyBrush,\n    SmudgeBrush,\n    EraserBrush,\n}","import {BB} from '../../bb/bb';\nimport {alphaImArr} from './brushes-common';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\n\nexport function PenBrush() {\n\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\n    let settingColorStr;\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\n    let settingLockLayerAlpha = false;\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\n    let settingAlphaId = ALPHA_CIRCLE;\n\n    let lineToolLastDot;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n\n    let isDrawing = false;\n    let alphaOpacityArr = [1, 0.9, 1, 1];\n\n    //mipmapping\n    let alphaCanvas128 = BB.canvas(128, 128);\n    let alphaCanvas64 = BB.canvas(64, 64);\n    let alphaCanvas32 = BB.canvas(32, 32);\n\n    let bezierLine = null;\n\n    let twoPI = Math.PI * 2;\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\n    let inputArr: {x: number, y: number, pressure: number}[];\n\n    // pressure: 0-1\n    function calcOpacity(pressure: number) {\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\n    }\n\n    function updateAlphaCanvas() {\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\n            return;\n        }\n\n        let instructionArr = [\n            [alphaCanvas128, 128],\n            [alphaCanvas64, 64],\n            [alphaCanvas32, 32]\n        ];\n\n        let ctx;\n\n        for (let i = 0; i < instructionArr.length; i++) {\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\n\n            ctx.save();\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.globalCompositeOperation = \"destination-in\";\n            ctx.imageSmoothingQuality = 'high';\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.restore();\n        }\n    }\n\n    /**\n     *\n     *\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     * @param angle\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\n     */\n    function drawDot(x, y, size, opacity, angle?, before?) {\n        if (size <= 0) {\n            return;\n        }\n\n        if (settingLockLayerAlpha) {\n            context.globalCompositeOperation = \"source-atop\";\n        }\n\n        if (!before || before[3] !== opacity) {\n            context.globalAlpha = opacity;\n        }\n\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\n            context.fillStyle = settingColorStr;\n        }\n\n        if (settingAlphaId === ALPHA_CIRCLE) {\n            context.beginPath();\n            context.arc(x, y, size, 0, twoPI);\n            context.closePath();\n            context.fill();\n            hasDrawnDot = true;\n\n        } else if (settingAlphaId === ALPHA_SQUARE) {\n            if (angle !== undefined) {\n                context.save();\n                context.translate(x, y);\n                context.rotate(angle / 180 * Math.PI);\n                context.fillRect(-size, -size, size * 2, size * 2);\n                context.restore();\n                hasDrawnDot = true;\n            }\n\n        } else { // other brush alphas\n            context.save();\n            context.translate(x, y);\n            let targetMipmap = alphaCanvas128;\n            if (size <= 32 && size > 16) {\n                targetMipmap = alphaCanvas64;\n            } else if (size <= 16) {\n                targetMipmap = alphaCanvas32;\n            }\n            context.scale(size, size);\n            if (settingAlphaId === ALPHA_CHALK) {\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\n            }\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\n\n            context.restore();\n            hasDrawnDot = true;\n        }\n    }\n\n    function continueLine(x, y, size, pressure) {\n        if (bezierLine === null) {\n            bezierLine = new BB.BezierLine();\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\n        }\n\n        let drawArr = []; //draw instructions. will be all drawn at once\n\n        function dotCallback(val) {\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\n            let localOpacity = calcOpacity(localPressure);\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        }\n\n        let localSpacing = size * settingSpacing;\n        if (x === null) {\n            bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        context.save();\n        let before;\n        for (let i = 0; i < drawArr.length; i++) {\n            let item = drawArr[i];\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\n            before = item;\n        }\n        context.restore();\n    }\n\n    //------------------ interface ---------------------------------------------------\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"PenBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [settingHasOpacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setAlpha\",\n            params: [settingAlphaId]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n\n        p = BB.clamp(p, 0, 1);\n        let localOpacity = calcOpacity(p);\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\n\n        hasDrawnDot = false;\n\n        isDrawing = true;\n        context.save();\n        drawDot(x, y, localSize, localOpacity);\n        context.restore();\n\n        lineToolLastDot = localSize * settingSpacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2.pressure = p;\n\n        inputArr = [{\n            x,\n            y,\n            pressure: p,\n        }];\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n\n    this.goLine = function (x, y, p) {\n        if (!isDrawing) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        let pressure = BB.clamp(p, 0, 1);\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n\n        context.save();\n        continueLine(x, y, localSize, lastInput.pressure);\n\n        /*context.fillStyle = 'red';\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\n\n        context.restore();\n\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput2.pressure = lastInput.pressure;\n        lastInput.pressure = pressure;\n\n        inputArr.push({\n            x,\n            y,\n            pressure: p,\n        });\n    };\n\n    this.endLine = function (x, y) {\n\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n        context.save();\n        continueLine(null, null, localSize, lastInput.pressure);\n        context.restore();\n\n        isDrawing = false;\n\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\n            // find max pressure input, use that one\n            let maxInput = inputArr[0];\n            inputArr.forEach(item => {\n                if (item.pressure > maxInput.pressure) {\n                    maxInput = item;\n                }\n            })\n\n            context.save();\n            let p = BB.clamp(maxInput.pressure, 0, 1);\n            let localOpacity = calcOpacity(p);\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\n            context.restore();\n        }\n\n        bezierLine = null;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: [x, y]\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n\n        hasDrawnDot = false;\n        inputArr = [];\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        context.save();\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\n        }\n        context.restore();\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"PenBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [settingHasOpacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setAlpha\",\n            params: [settingAlphaId]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n    //SET\n    this.setAlpha = function (a) {\n        if (settingAlphaId === a) {\n            return;\n        }\n        settingAlphaId = a;\n        updateAlphaCanvas();\n    };\n    this.setColor = function (c) {\n        if (settingColor === c) {\n            return;\n        }\n        settingColor = {r: c.r, g: c.g, b: c.b};\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\n        updateAlphaCanvas();\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        settingSize = s;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.setSpacing = function (s) {\n        settingSpacing = s;\n    };\n    this.sizePressure = function (b) {\n        settingHasSizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        settingHasOpacityPressure = b;\n    };\n    this.setLockAlpha = function (b) {\n        settingLockLayerAlpha = b;\n    };\n    //GET\n    this.getSpacing = function () {\n        return settingSpacing;\n    };\n    this.getSize = function () {\n        return settingSize;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.getLockAlpha = function (b) {\n        return settingLockLayerAlpha;\n    };\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\n\nexport const alphaImArr = []; //used by default brush\nalphaImArr[1] = genBrushAlpha01(128);\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\nimport {noise} from '../../../bb/math/perlin';\nimport {IVector2D} from '../../../bb/bb.types';\n\n// chalk\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\n\n    const scaleFac = w / 500;\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = canvas.getContext('2d');\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            let i = (y * w + x) * 4;\n\n            // base noise\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\n\n            // fade out in circular shape\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\n            let falloff = BB.clamp(\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\n                0,\n                1);\n            noisePattern = noisePattern * falloff;\n\n            // make the middle darker\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\n            noisePattern = noisePattern * falloff2;\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n// https://www.shadertoy.com/view/3tdSDj\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\n    let ba = BB.Vec2.sub(b, a);\n    let pa = BB.Vec2.sub(p, a);\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\n}\n\n// calligraphy\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\n\n    const pDist = 1 / 4;\n    let centerSize = 2 / 3;\n    let transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\n    const p2 = {x: w - (w * pDist), y: pDist * w};\n\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    let ctx = canvas.getContext('2d');\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            let col = udSegment({x: x, y: y}, p1, p2);\n\n            col = BB.clamp(\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\n                0,\n                255\n            );\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = col;\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}","/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nconst myModule = {} as any;\n\n\nfunction Grad(x, y, z) {\n    this.x = x; this.y = y; this.z = z;\n}\n\nGrad.prototype.dot2 = function(x, y) {\n    return this.x*x + this.y*y;\n};\n/*\nGrad.prototype.dot3 = function(x, y, z) {\n    return this.x*x + this.y*y + this.z*z;\n};*/\n\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\n\nlet p = [151,160,137,91,90,15,\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\n// To remove the need for index wrapping, double the permutation table length\nlet perm = new Array(512);\nlet gradP = new Array(512);\n\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\nmyModule.seed = function(seed) {\n    if (seed > 0 && seed < 1) {\n        // Scale the seed out\n        seed *= 65536;\n    }\n\n    seed = Math.floor(seed);\n    if (seed < 256) {\n        seed |= seed << 8;\n    }\n\n    for (let i = 0; i < 256; i++) {\n        let v;\n        if (i & 1) {\n            v = p[i] ^ (seed & 255);\n        } else {\n            v = p[i] ^ ((seed>>8) & 255);\n        }\n\n        perm[i] = perm[i + 256] = v;\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\n    }\n};\n\nmyModule.seed(0);\n\n/*\nfor (let i=0; i<256; i++) {\n  perm[i] = perm[i + 256] = p[i];\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nlet F2 = 0.5*(Math.sqrt(3)-1);\nlet G2 = (3-Math.sqrt(3))/6;\n\n/*let F3 = 1/3;\nlet G3 = 1/6;*/\n\n// 2D simplex noise\nmyModule.simplex2 = function(xin, yin) {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin)*F2; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let t = (i+j)*G2;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n        i1=1; j1=0;\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        i1=0; j1=1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n    let y1 = y0 - j1 + G2;\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n    let y2 = y0 - 1 + 2 * G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    let gi0 = gradP[i+perm[j]];\n    let gi1 = gradP[i+i1+perm[j+j1]];\n    let gi2 = gradP[i+1+perm[j+1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0*x0-y0*y0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1*x1-y1*y1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2*x2-y2*y2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\n/*\n// 3D simplex noise\nmyModule.simplex3 = function(xin, yin, zin) {\n    let n0, n1, n2, n3; // Noise contributions from the four corners\n\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let k = Math.floor(zin+s);\n\n    let t = (i+j+k)*G3;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    let z0 = zin-k+t;\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // Determine which simplex we are in.\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n    if (x0 >= y0) {\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\n    } else {\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\n    }\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n    // c = 1/6.\n    let x1 = x0 - i1 + G3; // Offsets for second corner\n    let y1 = y0 - j1 + G3;\n    let z1 = z0 - k1 + G3;\n\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n    let y2 = y0 - j2 + 2 * G3;\n    let z2 = z0 - k2 + 2 * G3;\n\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n    let y3 = y0 - 1 + 3 * G3;\n    let z3 = z0 - 1 + 3 * G3;\n\n    // Work out the hashed gradient indices of the four simplex corners\n    i &= 255;\n    j &= 255;\n    k &= 255;\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\n\n    // Calculate the contribution from the four corners\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n    }\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n    }\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\n    if (t3<0) {\n        n3 = 0;\n    } else {\n        t3 *= t3;\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 32 * (n0 + n1 + n2 + n3);\n\n};\n*/\n// ##### Perlin noise stuff\n/*\nfunction fade(t) {\n    return t*t*t*(t*(t*6-15)+10);\n}\n\nfunction lerp(a, b, t) {\n    return (1-t)*a + t*b;\n}\n\n// 2D Perlin Noise\nmyModule.perlin2 = function(x, y) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y);\n    // Get relative xy coordinates of point within that cell\n    x = x - X; y = y - Y;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255;\n\n    // Calculate noise contributions from each of the four corners\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\n\n    // Compute the fade curve value for x\n    let u = fade(x);\n\n    // Interpolate the four results\n    return lerp(\n        lerp(n00, n10, u),\n        lerp(n01, n11, u),\n        fade(y));\n};*/\n/*\n// 3D Perlin Noise\nmyModule.perlin3 = function(x, y, z) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\n    // Get relative xyz coordinates of point within that cell\n    x = x - X; y = y - Y; z = z - Z;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255; Z = Z & 255;\n\n    // Calculate noise contributions from each of the eight corners\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\n\n    // Compute the fade curve value for x, y, z\n    let u = fade(x);\n    let v = fade(y);\n    let w = fade(z);\n\n    // Interpolate\n    return lerp(\n        lerp(\n            lerp(n000, n100, u),\n            lerp(n001, n101, u), w),\n        lerp(\n            lerp(n010, n110, u),\n            lerp(n011, n111, u), w),\n        v);\n};*/\n\nexport const noise = myModule;","import {BB} from '../../bb/bb';\nimport {IRGB, IRGBA} from '../kl.types';\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\n\nconst cellSize = 256;\n\ninterface IDrawBufferItem {\n    x: number;\n    y: number;\n    size: number;\n    opacity: number;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    r: number;\n    g: number;\n    b: number;\n}\n\n// faster than using BB.clamp somehow (in chrome)\nfunction clamp(num, min, max) {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num\n}\n\nexport class BlendBrush {\n\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\n\n    private context: CanvasRenderingContext2D;\n    private color: IRGB;\n    private size: number = 29; // radius - 0.5 - 99999\n    private opacity: number = 0.6; // 0-1\n    private blending: number = 0.65; // 0-1\n\n    private settingLockLayerAlpha: boolean = false;\n    private settingSizePressure: boolean = true;\n    private settingOpacityPressure: boolean = false;\n\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\n    private blendMix: number = 0.45; // todo docs\n    private mixr: number; // todo docs\n    private mixg: number; // todo docs\n    private mixb: number; // todo docs\n    private localColOld: IRGBA; // todo docs\n\n    private isDrawing: boolean = false;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private bezierLine: any; // todo type\n\n    private history: KlHistoryInterface | null;\n    private historyEntry: IHistoryEntry;\n    private redrawBounds: IBounds;\n    private cells: (ImageData | null)[];\n    private drawBuffer: IDrawBufferItem[];\n\n    private updateRedrawBounds (bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    private getCellsWidth(): number {\n        return Math.ceil(this.context.canvas.width / cellSize);\n    }\n\n    /**\n     * draw changed cells (changed by brushstroke) onto context\n     * @private\n     */\n    private drawChangedCells(): void {\n        const cells = this.cells.map(item => null);\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\n        touchedCells.forEach((isTouched, index) => {\n            if (isTouched) {\n                cells[index] = this.cells[index];\n            }\n        });\n        this.drawCells(cells);\n        this.redrawBounds = null;\n    }\n\n    private getTouchedCells(bounds: IBounds): boolean[] {\n        const touchedCells = this.cells.map(item => false);\n        const cellsW = this.getCellsWidth();\n        bounds = {\n            x1: Math.floor(bounds.x1 / cellSize),\n            y1: Math.floor(bounds.y1 / cellSize),\n            x2: Math.floor(bounds.x2 / cellSize),\n            y2: Math.floor(bounds.y2 / cellSize),\n        };\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\n                touchedCells[e * cellsW + i] = true;\n            }\n        }\n        return touchedCells;\n    }\n\n    /**\n     * Slice up bounds accordings to cells\n     * @param bounds\n     * @private\n     */\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\n        const cellsW = this.getCellsWidth();\n        const result: {index: number; bounds: IBounds}[] = [];\n        const touchedCells = this.getTouchedCells(bounds);\n\n        touchedCells.forEach((cell, i) => {\n            if (!cell) {\n                return;\n            }\n\n            const cellOffsetX = (i % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\n            const cellWidth = this.cells[i].width;\n            const cellHeight = this.cells[i].height;\n\n            const inCellBounds = {\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\n            }\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\n                return;\n            }\n            result.push({\n                index: i,\n                bounds: inCellBounds,\n            });\n        });\n\n        return result;\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    private copyFromCanvas(bounds: IBounds) {\n        if (!bounds) {\n            return;\n        }\n\n        const touchedCells = this.getTouchedCells(bounds);\n        const cellsW = this.getCellsWidth();\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.cells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = tmpCanvas.getContext('2d');\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\n\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\n        });\n    }\n\n    private getAverage (x, y, size): IRGBA {\n\n        size = Math.max(0.5, size * 0.75);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0,\n            };\n        }\n\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\n\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\n        slicedBounds.forEach(slice => {\n            const width = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n            const bounds = slice.bounds;\n\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\n                    alpha = data[e2 + 3];\n                    ar += data[e2] * alpha;\n                    ag += data[e2 + 1] * alpha;\n                    ab += data[e2 + 2] * alpha;\n                    aa += alpha;\n                }\n            }\n        });\n\n        if (aa !== 0) {\n            ar /= aa;\n            ag /= aa;\n            ab /= aa;\n            aa = Math.min(1, aa);\n        }\n        return {\n            r: ar,\n            g: ag,\n            b: ab,\n            a: aa\n        };\n    }\n\n    private prepDot (x: number, y: number, size: number): IBounds {\n        size = Math.max(0.5, size);\n        let x1 = Math.max(0, Math.floor(x - size));\n        let y1 = Math.max(0, Math.floor(y - size));\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return null;\n        }\n        return { x1, y1, x2, y2 };\n    }\n\n    private drawDot (params: IDrawBufferItem): void {\n        // array with random numbers. faster than Math.random()\n        let randI = 0;\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n        const randArr = [];\n        for (let i = 0; i < randLen; i++) {\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n        }\n\n        // thin lines take more than just 1 sample\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\n        const samples = sampleArr[Math.floor(params.size * 2)];\n        const samplesSquared: number = samples ? samples * samples : 0;\n        const sampleOffsets = [];\n        if (samples) {\n            let i = 0;\n            for (let n = 0; n < samples; n++) {\n                for (let m = 0; m < samples; m++, i += 2) {\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\n                }\n            }\n        }\n\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\n        // to optimize calculations\n        const invSharpness = 1 - sharpness;\n        const sharpnessSubtrahend = sharpness / invSharpness;\n        const sizeSquared = params.size * params.size;\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n\n\n        const slicedBounds = this.sliceBounds({\n            x1: params.x1,\n            y1: params.y1,\n            x2: params.x2,\n            y2: params.y2,\n        });\n\n        const cellsW = this.getCellsWidth();\n        slicedBounds.forEach(slice => {\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\n            const cellWidth = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n\n            // i - y index within cell\n            // e - x index within cell\n\n            // e2 - index in image data\n\n            // ri - y index within image relative to dot-center\n            // re - x index within image relative to dot-center\n\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\n                for (\n                    let e = slice.bounds.x1,\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\n                        re = e + cellOffsetX - params.x;\n                    e <= slice.bounds.x2;\n                    e++,\n                        e2 += 4,\n                        re++\n                ) {\n                    // O = over -> brush-dot\n                    // U = under -> image\n\n                    let alphaO = 0;\n                    if (samplesSquared) {\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\n                            if (dist >= sizeSquared) {\n                                continue;\n                            }\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                        }\n                        if (!alphaO) {\n                            continue;\n                        }\n                        alphaO /= samplesSquared;\n                    } else {\n                        // technically needs + 0.5 offset, but not noticeable with large brush\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\n                        if (dist >= sizeSquared) {\n                            continue;\n                        }\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                    }\n\n                    const invAlphaO = 1 - alphaO;\n                    const alphaU =data[e2 + 3] / 255;\n\n                    if (this.settingLockLayerAlpha) {\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\n                        if (alphaU) {\n                            data[e2] = Math.floor(underR + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                        }\n                    } else {\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\n\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                        if (newAlpha) {\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\n                        }\n                    }\n                    randI = (randI + 1) % randLen;\n\n                }\n            }\n\n        });\n    }\n\n    private calcSpacing (size: number): number {\n        return BB.mix(\n            (size * 2) / 2, // until size 5.3\n            (size * 2) / 9, // at size 24\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\n        );\n    }\n\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n\n        this.drawBuffer = [];\n\n        let localPressure;\n        let localOpacity;\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\n\n        let bdist = this.calcSpacing(localSize);\n\n        let avgX = x;\n        let avgY = y;\n        if (x === null) {\n            avgX = this.lastInput.x;\n            avgY = this.lastInput.y;\n        }\n\n        let localColNew;\n\n        if (this.blending === 0) {\n            this.mixr = this.color.r;\n            this.mixg = this.color.g;\n            this.mixb = this.color.b;\n        } else {\n            let average;\n            if (isCoalesced) {\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\n            } else {\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\n                this.copyFromCanvas(bounds);\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n            }\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\n\n            if (average.a > 0 && this.blendCol.a === 0) {\n                this.blendCol.r = average.r;\n                this.blendCol.g = average.g;\n                this.blendCol.b = average.b;\n                this.blendCol.a = average.a;\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n\n            } else {\n                if (average.a === 0) {\n                    average.r = this.color.r;\n                    average.g = this.color.g;\n                    average.b = this.color.b;\n                    average.a = 1 - this.blending;\n                }\n\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            }\n\n        }\n\n\n        const bezierCallback = (val) => {\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\n                return;\n            }\n            let factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n            if (this.blending != 0) {\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\n            }\n            if (this.blending === 1 && this.localColOld.a === 0) {\n                this.mixr = localColNew.r;\n                this.mixg = localColNew.g;\n                this.mixb = localColNew.b;\n            }\n            const bounds = this.prepDot(val.x, val.y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: val.x,\n                    y: val.y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        };\n\n        if (x === null) {\n            this.bezierLine.addFinal(bdist, bezierCallback);\n        } else {\n            this.bezierLine.add(x, y, bdist, bezierCallback);\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.localColOld = localColNew;\n    }\n\n\n\n\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.size;\n    }\n\n    setSize (s: number): void {\n        this.size = s;\n    }\n\n    getOpacity (): number {\n        return this.opacity;\n    }\n\n    setOpacity (o: number): void {\n        this.opacity = o;\n    }\n\n    getBlending (): number {\n        return this.blending;\n    }\n\n    setBlending (b: number) {\n        this.blending = b;\n    }\n\n    setColor (c: IRGB): void {\n        this.color = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setSizePressure (b: boolean): void {\n        this.settingSizePressure = !!b;\n    }\n\n    setOpacityPressure (b: boolean): void {\n        this.settingOpacityPressure = !!b;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setIsTesting (b: boolean): void {\n        this.isTesting = !!b;\n    }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: [\"brush\", \"BlendBrush\"],\n            actions: []\n        };\n\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\n\n        this.isDrawing = true;\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        if (this.blending === 0) {\n            this.mixr = this.color.r;\n            this.mixg = this.color.g;\n            this.mixb = this.color.b;\n        } else {\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\n\n            let average = this.getAverage(\n                x,\n                y,\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\n            );\n            if (average.a === 0) {\n                this.blendCol = {\n                    r: this.color.r,\n                    g: this.color.g,\n                    b: this.color.b,\n                    a: 1 - this.blending,\n                };\n            } else {\n                this.blendCol = {\n                    r: average.r,\n                    g: average.g,\n                    b: average.b,\n                    a: average.a,\n                };\n            }\n\n            this.mixr = this.blendCol.r;\n            this.mixg = this.blendCol.g;\n            this.mixb = this.blendCol.b;\n        }\n\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\n\n        this.redrawBounds = null;\n        this.drawBuffer = [];\n\n        if (this.blending < 1 || this.blendCol.a > 0) {\n            const bounds = this.prepDot(x, y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: x,\n                    y: y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, function () {\n        });\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        if (this.redrawBounds && !this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n        if (!this.isDrawing) {\n            return;\n        }\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n\n        if (this.redrawBounds && !this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    endLine (): void {\n        if (this.bezierLine) {\n            this.continueLine(null, null, this.lastInput.pressure, false);\n        }\n\n        this.isDrawing = false;\n        this.bezierLine = null;\n\n        if (this.redrawBounds) {\n            this.drawChangedCells();\n        }\n\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\n            this.historyEntry.actions.push({\n                action: \"drawCells\",\n                params: [this.cells],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = null;\n        }\n        this.cells = null;\n    }\n\n    /**\n     * draw cells onto context\n     * @param cells\n     */\n    drawCells (cells: (ImageData | null)[]): void {\n        const cellsW = this.getCellsWidth();\n        cells.forEach((imageData, index) => {\n            if (!imageData) {\n                return;\n            }\n            const cellOffsetX = (index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n        });\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.isDrawing || x1 === undefined) {\n            return;\n        }\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\n        this.redrawBounds = null;\n        this.drawBuffer = [];\n\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\n\n        if (average.a === 0) {\n            this.blendCol = {\n                r: this.color.r,\n                g: this.color.g,\n                b: this.color.b,\n                a: 1 - this.blending,\n            };\n        } else {\n            this.blendCol = {\n                r: average.r,\n                g: average.g,\n                b: average.b,\n                a: average.a,\n            };\n        }\n\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\n\n\n        const p = 1;\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        const bdist = this.calcSpacing(localSize);\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\n            if (bounds) {\n                this.copyFromCanvas(bounds);\n                this.drawBuffer.push({\n                    x: x1 + eX * loopDist,\n                    y: y1 + eY * loopDist,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        }\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        if (this.history && this.cells.find(item => !!item)) {\n            this.drawCells(this.cells);\n            this.historyEntry = {\n                tool: [\"brush\", \"BlendBrush\"],\n                actions: [{\n                    action: \"drawCells\",\n                    params: [this.cells],\n                }],\n            };\n            this.history.push(this.historyEntry);\n            this.historyEntry = null;\n        }\n        this.cells = null;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nconst sampleCanvas = BB.canvas(32, 32);\nconst sampleCtx = sampleCanvas.getContext('2d');\n\nexport function SketchyBrush() {\n    let context;\n    let settingColor;\n\n    let settingSize = 1, settingOpacity = 0.2;\n    let settingBlending = 0.5;\n    let settingScale = 1;\n\n    let lastX, lastY;\n    let isDrawing = false;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n    let sketchySeed = 0;\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSeed = function (s) {\n        sketchySeed = parseInt(s);\n    };\n    this.getSeed = function () {\n        return parseInt('' + sketchySeed);\n    };\n\n    function rand() {\n        sketchySeed++;\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\n    }\n\n    let points = [];\n    let count = 0;\n    let mixmode = [\n        function (c1, c2) {\n            return c1;\n        },\n        function (c1, c2) {\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        },\n        function (c1, c2) {\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        }\n    ];\n\n    this.getSize = function () {\n        return settingSize / 2;\n    };\n    this.setColor = function (c) {\n        settingColor = c;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.getBlending = function () {\n        return settingBlending;\n    };\n    this.setBlending = function (b) {\n        settingBlending = b;\n    };\n    this.setSize = function (s) {\n        settingSize = s * 2;\n    };\n    this.getScale = function () {\n        return settingScale;\n    };\n    this.setScale = function (s) {\n        settingScale = s;\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.startLine = function (x, y, pressure, shift) {\n        if (shift && lastInput.x) {\n            let lx = lastInput.x, ly = lastInput.y;\n            isDrawing = true;\n            //this.goLine(x,y,pressure);\n            this.endLine();\n        } else {\n            isDrawing = true;\n            lastX = x;\n            lastY = y;\n            lastInput.x = x;\n            lastInput.y = y;\n            historyEntry = {\n                tool: [\"brush\", \"SketchyBrush\"],\n                actions: []\n            };\n            historyEntry.actions.push({\n                action: \"setScale\",\n                params: [settingScale]\n            });\n            historyEntry.actions.push({\n                action: \"setSize\",\n                params: [settingSize / 2]\n            });\n            historyEntry.actions.push({\n                action: \"setOpacity\",\n                params: [settingOpacity]\n            });\n            historyEntry.actions.push({\n                action: \"setColor\",\n                params: [settingColor]\n            });\n            historyEntry.actions.push({\n                action: \"setBlending\",\n                params: [settingBlending]\n            });\n            historyEntry.actions.push({\n                action: \"startLine\",\n                params: [x, y, pressure]\n            });\n        }\n\n    };\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\n            return;\n        }\n\n        let e, b, a, g;\n        let x = parseInt(p_x);\n        let y = parseInt(p_y);\n        points.push([x, y]);\n\n        let mixr = settingColor.r;\n        let mixg = settingColor.g;\n        let mixb = settingColor.b;\n\n        if (preMixedColor !== null) {\n            mixr = preMixedColor.r;\n            mixg = preMixedColor.g;\n            mixb = preMixedColor.b;\n        } else {\n            if (settingBlending !== 0) {\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\n                    mixr = 0;\n                    mixg = 0;\n                    mixb = 0;\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\n                    mixw -= mixx;\n                    mixh -= mixy;\n\n                    if (mixw > 0 && mixh > 0) {\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\n                        let countmix = 0;\n                        for (let i = 0; i < imdat.data.length; i += 4) {\n                            mixr += imdat.data[i + 0];\n                            mixg += imdat.data[i + 1];\n                            mixb += imdat.data[i + 2];\n                            countmix++;\n                        }\n                        mixr /= countmix;\n                        mixg /= countmix;\n                        mixb /= countmix;\n                    }\n\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\n                }\n            }\n        }\n\n        context.save();\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.lineWidth = settingSize;\n\n        context.beginPath();\n        context.moveTo(lastX, lastY);\n        context.lineTo(x, y);\n\n        for (e = 0; e < points.length; e++) {\n            b = points[e][0] - points[count][0];\n            a = points[e][1] - points[count][1];\n            g = b * b + a * a;\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\n            }\n        }\n\n        context.stroke();\n        context.restore();\n\n\n        count++;\n        lastX = x;\n        lastY = y;\n        lastInput.x = x;\n        lastInput.y = y;\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\n        });\n    };\n    this.endLine = function () {\n        isDrawing = false;\n        count = 0;\n        points = [];\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n\n        context.save();\n        context.lineWidth = settingSize;\n\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\n            mixr = 0;\n            mixg = 0;\n            mixb = 0;\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\n            mixw -= mixx;\n            mixh -= mixy;\n            if (mixw > 0 && mixh > 0) {\n                let w = Math.min(sampleCanvas.width, mixw);\n                let h = Math.min(sampleCanvas.height, mixh);\n                sampleCtx.save();\n                sampleCtx.globalCompositeOperation = 'copy';\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\n                sampleCtx.restore();\n\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\n                let countmix = 0;\n                for (let i = 0; i < imdat.data.length; i += 4) {\n                    mixr += imdat.data[i + 0];\n                    mixg += imdat.data[i + 1];\n                    mixb += imdat.data[i + 2];\n                    countmix++;\n                }\n                mixr /= countmix;\n                mixg /= countmix;\n                mixb /= countmix;\n            }\n        }\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.beginPath();\n        context.moveTo(x1, y1);\n        context.lineTo(x2, y2);\n        context.stroke();\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.restore();\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SketchyBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"setScale\",\n            params: [settingScale]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize / 2]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setBlending\",\n            params: [settingBlending]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nexport function PixelBrush() {\n\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\n    let settingColorStr;\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\n    let settingLockLayerAlpha = false;\n    let settingIsEraser = false;\n    let settingUseDither = true;\n\n    let lineToolLastDot;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n\n    let isDrawing = false;\n    let bezierLine = null;\n    let twoPI = Math.PI * 2;\n\n\n    let ditherCanvas = BB.canvas(4, 4);\n    let ditherCtx = ditherCanvas.getContext('2d');\n    let ditherPattern;\n    let ditherArr = [\n        [3, 2],\n        [1, 0],\n        [3, 0],\n        [1, 2],\n        [2, 1],\n        [0, 3],\n        [0, 1],\n        [2, 3],\n\n        [2, 0],\n        [0, 2],\n        [0, 0],\n        [2, 2],\n        [1, 1],\n        [3, 3],\n        [3, 1],\n        [1, 3]\n    ];\n\n    function updateDither() {\n        ditherCtx.clearRect(0, 0, 4, 4);\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\n        }\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\n    }\n\n\n    /**\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\n     * @param p1\n     * @param p2\n     * @param p3\n     * @param p4\n     * @param maxAngleRad\n     */\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\n        let d = BB.Vec2.nor({\n            x: p4.x - p1.x,\n            y: p4.y - p1.y\n        });\n        let d2 = BB.Vec2.nor({\n            x: p2.x - p1.x,\n            y: p2.y - p1.y\n        });\n        let d3 = BB.Vec2.nor({\n            x: p4.x - p3.x,\n            y: p4.y - p3.y\n        });\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\n    }\n\n    //bresenheim line drawing\n    function plotLine(x0, y0, x1, y1, skipFirst) {\n        context.save();\n\n        if (settingIsEraser) {\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            } else {\n                context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\n\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n\n        let dX = Math.abs(x1 - x0);\n        let sX = x0 < x1 ? 1 : -1;\n        let dY = -Math.abs(y1 - y0);\n        let sY = y0 < y1 ? 1 : -1;\n        let err = dX + dY;\n        while (true) {\n            if (skipFirst) {\n                skipFirst = false;\n            } else {\n                context.fillRect(x0, y0, 1, 1);\n            }\n            if (x0 === x1 && y0 === y1) {\n                break;\n            }\n            let e2 = 2 * err;\n            if (e2 >= dY) {\n                err += dY;\n                x0 += sX;\n            }\n            if (e2 <= dX) {\n                err += dX;\n                y0 += sY;\n            }\n        }\n\n        context.restore();\n    }\n\n    function plotCubicBezierLine(p1, p2, p3, p4) {\n\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n\n        p1.x = Math.floor(p1.x);\n        p1.y = Math.floor(p1.y);\n        p4.x = Math.floor(p4.x);\n        p4.y = Math.floor(p4.y);\n\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\n        if (!isOverThreshold || dist < 7) {\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\n            return;\n        }\n\n        let n = Math.max(2, Math.round(dist / 4));\n        let pointArr = [];\n        for (let i = 0; i <= n; i++) {\n            let t = i / n;\n            let a = Math.pow(1 - t, 3);\n            let b = 3 * t * Math.pow(1 - t, 2);\n            let c = 3 * Math.pow(t, 2) * (1 - t);\n            let d = Math.pow(t, 3);\n            pointArr.push({\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\n            });\n        }\n\n        for (let i = 0; i < n; i++) {\n            plotLine(\n                Math.round(pointArr[i].x),\n                Math.round(pointArr[i].y),\n                Math.round(pointArr[i + 1].x),\n                Math.round(pointArr[i + 1].y),\n                true\n            );\n        }\n    }\n\n    function drawDot(x, y, size, opacity, angle?) {\n        context.save();\n        if (settingIsEraser) {\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            } else {\n                context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n        context.globalAlpha = settingUseDither ? 1 : opacity;\n        context.fillRect(\n            Math.round(x + -size),\n            Math.round(y + -size),\n            Math.round(size * 2),\n            Math.round(size * 2)\n        );\n        context.restore();\n    }\n\n\n    function continueLine(x, y, size, pressure) {\n        if (bezierLine === null) {\n            bezierLine = new BB.BezierLine();\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\n            });\n        }\n\n        context.save();\n\n        function dotCallback(val) {\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\n        }\n\n        function controlCallback(controlObj) {\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n        }\n\n        if (Math.round(settingSize * 2) === 1) {\n            if (x === null) {\n                bezierLine.addFinal(4, null, controlCallback);\n            } else {\n                bezierLine.add(x, y, 4, null, controlCallback);\n            }\n\n        } else {\n            let localSpacing = size * settingSpacing;\n\n            if (x === null) {\n                bezierLine.addFinal(localSpacing, dotCallback);\n            } else {\n                bezierLine.add(x, y, localSpacing, dotCallback);\n            }\n        }\n\n        context.restore();\n    }\n\n    //------------------ interface ---------------------------------------------------\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"PixelBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n        historyEntry.actions.push({\n            action: \"setIsEraser\",\n            params: [settingIsEraser]\n        });\n        historyEntry.actions.push({\n            action: \"setUseDither\",\n            params: [settingUseDither]\n        });\n\n        if (settingUseDither) {\n            updateDither();\n        }\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\n\n        isDrawing = true;\n        drawDot(x, y, localSize, localOpacity);\n        lineToolLastDot = localSize * settingSpacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2 = BB.copyObj(lastInput);\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n\n    this.goLine = function (x, y, p) {\n        if (!isDrawing) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        //debug\n        //drawDot(x, y, 1, 0.5);\n\n        let pressure = BB.clamp(p, 0, 1);\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n\n        continueLine(x, y, localSize, lastInput.pressure);\n\n        lastInput2 = BB.copyObj(lastInput);\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = pressure;\n    };\n\n    this.endLine = function (x, y) {\n\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n        continueLine(null, null, localSize, lastInput.pressure);\n\n        //debug\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\n        //drawDot(x, y, 10, 0.1);\n\n        isDrawing = false;\n\n        bezierLine = null;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: [x, y]\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        if (settingUseDither) {\n            updateDither();\n        }\n\n        if (Math.round(settingSize * 2) === 1) {\n            plotLine(x1, y1, x2, y2, true);\n        } else {\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n            let eX = (x2 - x1) / mouseDist;\n            let eY = (y2 - y1) / mouseDist;\n            let loopDist;\n            let bdist = settingSize * settingSpacing;\n            lineToolLastDot = settingSize * settingSpacing;\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\n            }\n        }\n\n        let historyEntry = {\n            tool: [\"brush\", \"PixelBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n        historyEntry.actions.push({\n            action: \"setIsEraser\",\n            params: [settingIsEraser]\n        });\n        historyEntry.actions.push({\n            action: \"setUseDither\",\n            params: [settingUseDither]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n    //SET\n    this.setColor = function (c) {\n        if (settingColor === c) {\n            return;\n        }\n        settingColor = c;\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        settingSize = s;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.setSpacing = function (s) {\n        settingSpacing = s;\n    };\n    this.sizePressure = function (b) {\n        settingHasSizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        settingHasOpacityPressure = b;\n    };\n    this.setLockAlpha = function (b) {\n        settingLockLayerAlpha = b;\n    };\n    this.setIsEraser = function (b) {\n        settingIsEraser = !!b;\n    };\n    this.setUseDither = function (b) {\n        settingUseDither = !!b;\n    };\n    //GET\n    this.getSpacing = function () {\n        return settingSpacing;\n    };\n    this.getSize = function () {\n        return settingSize;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.getLockAlpha = function () {\n        return settingLockLayerAlpha;\n    };\n    this.getIsEraser = function () {\n        return settingIsEraser;\n    };\n    this.getUseDither = function () {\n        return settingUseDither;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nexport function EraserBrush() {\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let size = 30, spacing = 0.4, opacity = 1;\n    let sizePressure = true, opacityPressure = false;\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n    let started = false;\n\n    let bezierLine;\n    let isBaseLayer = false;\n    let isTransparentBG = false;\n\n    function drawDot(x, y, size, opacity) {\n\n        context.save();\n        if (isBaseLayer) {\n            if (isTransparentBG) {\n                context.globalCompositeOperation = \"destination-out\";\n            } else {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        } else {\n            context.globalCompositeOperation = \"destination-out\";\n        }\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\n        let sharpness = Math.pow(opacity, 2);\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n        let oFac = Math.max(0, Math.min(1, opacity));\n        let localOpacity = 2 * oFac - oFac * oFac;\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\n        context.fillStyle = radgrad;\n        context.translate(x - size, y - size);\n        context.fillRect(0, 0, size * 2, size * 2);\n        context.restore();\n    }\n\n    function continueLine(x, y, p) {\n        p = Math.max(0, Math.min(1, p));\n        let localPressure;\n        let localOpacity;\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\n\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\n\n        function bezierCallback(val) {\n            let factor = val.t;\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\n\n            drawDot(val.x, val.y, localSize, localOpacity);\n        }\n\n        if (x === null) {\n            bezierLine.addFinal(bdist, bezierCallback);\n        } else {\n            bezierLine.add(x, y, bdist, bezierCallback);\n        }\n    }\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"EraserBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [opacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [sizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [size]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [opacity]\n        });\n        historyEntry.actions.push({\n            action: \"setTransparentBG\",\n            params: [isTransparentBG]\n        });\n\n        isBaseLayer = 0 === context.canvas.index;\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\n\n        started = true;\n        if (localSize > 1) {\n            drawDot(x, y, localSize, localOpacity);\n        }\n        lastDot = localSize * spacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2 = BB.copyObj(lastInput);\n\n        bezierLine = new BB.BezierLine();\n        bezierLine.add(x, y, 0, function () {\n        });\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n    this.goLine = function (x, y, p) {\n        if (!started) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        continueLine(x, y, lastInput.pressure);\n\n        lastInput2 = BB.copyObj(lastInput);\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n    };\n    this.endLine = function () {\n\n        if (bezierLine) {\n            continueLine(null, null, lastInput.pressure);\n        }\n\n        started = false;\n        bezierLine = undefined;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n\n        isBaseLayer = 0 === context.canvas.index;\n\n        lastInput.x = x2;\n        lastInput.y = y2;\n\n        if (started || x1 === undefined) {\n            return;\n        }\n\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\n        lastDot = 0;\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"EraserBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [opacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [sizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [size]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [opacity]\n        });\n        historyEntry.actions.push({\n            action: \"setTransparentBG\",\n            params: [isTransparentBG]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return started;\n    };\n    //SET\n    /*this.setAlpha = function(a) {\n        lastInput = {};\n        alpha = a;\n        updateAlphaCanvas();\n    };*/\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        size = s;\n    };\n    this.setOpacity = function (o) {\n        opacity = o;\n    };\n    this.sizePressure = function (b) {\n        sizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        opacityPressure = b;\n    };\n    this.setTransparentBG = function (b) {\n        isTransparentBG = b == true;\n    };\n    //GET\n    this.getSize = function () {\n        return size;\n    };\n    this.getOpacity = function () {\n        return opacity;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB} from '../kl.types';\n\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\n\nconst CELL_SIZE = 256;\n\ninterface ISmudgeParams {\n    aP: IVector2D;\n    bP: IVector2D;\n    size: {\n        w: number;\n        h: number;\n    };\n    brush: {\n        center: IVector2D,\n        size: number;\n        opacity: number;\n        alphaLock: boolean;\n    };\n}\n\n\n/**\n * determine bounds of smudge\n * @param imWidth\n * @param imHeight\n * @param aP\n * @param bP\n * @param size\n */\nfunction prepSmudge(\n    imWidth: number,\n    imHeight: number,\n    aP: IVector2D, // top left of source, integers\n    bP: IVector2D, // top left of dest, integers\n    size: {w: number; h: number}, // size of both rectangles, integers\n): {\n    aP: IVector2D,\n    bP: IVector2D,\n    size: {w: number; h: number},\n} {\n\n    if (aP.x === bP.x && aP.y === bP.y) {\n        return null;\n    }\n\n    aP = BB.copyObj(aP);\n    bP = BB.copyObj(bP);\n    size = BB.copyObj(size);\n\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        let top = 0;\n        let right = 0;\n        let bottom = 0;\n        let left = 0;\n\n        if (aP.x < 0) {\n            left = -aP.x;\n        }\n        if (aP.y < 0) {\n            top = -aP.y;\n        }\n        if (bP.x < 0) {\n            left = Math.max(left, -bP.x);\n        }\n        if (bP.y < 0) {\n            top = Math.max(top, -bP.y);\n        }\n        if (aP.x + size.w > imWidth) {\n            right = aP.x + size.w - imWidth;\n        }\n        if (aP.y + size.h > imHeight) {\n            bottom = aP.y + size.h - imHeight;\n        }\n        if (bP.x + size.w > imWidth) {\n            right = Math.max(right, bP.x + size.w - imWidth);\n        }\n        if (bP.y + size.h > imHeight) {\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        }\n\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) {\n            return null;\n        }\n    }\n\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y,\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y,\n        },\n        size: {\n            w: size.w,\n            h: size.h,\n        }\n    };\n}\n\n// faster than using BB.clamp somehow (in chrome)\nfunction clamp(num, min, max) {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num\n}\n\n/**\n * Pixel operations that do the smudging via ImageData\n * @param imageData\n * @param p\n */\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\n\n    p = BB.copyObj(p);\n\n    const cSize = p.brush.size;\n    const cX = p.brush.center.x;\n    const cY = p.brush.center.y;\n\n    /*if (statCount % 1000 === 0) {\n        console.log(statAcc / 1000);\n        statAcc = 0;\n    }\n    let start = performance.now();*/\n\n\n    // determine offset\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\n    const offset = (bIndex - aIndex) * 4;\n\n    // array with random numbers. faster than Math.random()\n    let randI = 0;\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    const randArr = [];\n    for (let i = 0; i < randLen; i++) {\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    }\n\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n\n    const pixel = (ai, bi, ix, iy) => {\n\n        const dist = BB.dist(cX, cY, ix, iy);\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n\n        if (fac === 1) {\n            return;\n        }\n\n        if (!imageData.data[ai + 3]) {\n\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\n            imageData.data[bi] = imageData.data[ai + 0];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            let fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\n            } else {\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\n            }\n\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\n\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) {\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\n        }\n\n    };\n\n    const bx1 = p.bP.x * 4;\n    const bx2 = bx1 + (p.size.w - 1) * 4;\n\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) {\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else if (p.aP.y > p.bP.y) {\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else {\n        if (p.aP.x < p.bP.x) {\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        } else {\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        }\n    }\n\n    //statCount++;\n    //statAcc += performance.now() - start;\n}\n\nexport class SmudgeBrush {\n\n    private context: CanvasRenderingContext2D;\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IHistoryEntry;\n\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\n    private settingSize: number = 35;\n    private settingSpacing: number = 0.20446882736951905;\n    private settingOpacity: number = 0.8;\n    private settingColorStr: string;\n    private settingHasSizePressure: boolean = false;\n    private settingHasOpacityPressure: boolean = false;\n    private settingLockLayerAlpha: boolean = false;\n\n    private lineToolLastDot: number;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastDot: IVector2D;\n\n    private isDrawing: boolean = false;\n\n    private bezierLine: any = null; // todo type BezierLine\n\n    private redrawBounds: IBounds;\n    private completeRedrawBounds: IBounds;\n\n    private copyImageData: ImageData;\n\n    private drawBuffer: ISmudgeParams[] = [];\n\n    private copiedCells: boolean[];\n\n    updateRedrawBounds(bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\n        this.completeRedrawBounds = BB.updateBounds(\n            this.completeRedrawBounds,\n            { x1, y1, x2, y2 }\n        );\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    copyFromCanvas(): void {\n\n        const touchedCells = this.copiedCells.map(item => false);\n\n        const bounds: IBounds[] = [];\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\n\n        if (!this.redrawBounds) {\n            return;\n        }\n        bounds.push({\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\n        });\n        bounds.forEach(item => {\n            for (let i = item.x1; i <= item.x2; i++) {\n                for (let e = item.y1; e <= item.y2; e++) {\n                    touchedCells[e * cellsW + i] = true;\n                }\n            }\n        });\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.copiedCells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            this.copiedCells[i] = true;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = tmpCanvas.getContext('2d');\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\n\n            const data = tmpCtx.getImageData(0, 0, w, h);\n\n            for (let i = 0; i < h; i++) {\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\n                    this.copyImageData.data[e3] = data.data[e2];\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n                }\n            }\n        });\n    }\n\n\n    /**\n     * fill drawBuffer with params about to be drawn\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     */\n    prepDot (x: number, y: number, size: number, opacity: number): void {\n        if (!this.lastDot) {\n            this.lastDot = {\n                x: x,\n                y: y,\n            };\n            return;\n        }\n\n        size = Math.round(size);\n\n\n        const w = Math.round(size * 2);\n        const h = Math.round(size * 2);\n\n        const bounds = prepSmudge(\n            this.copyImageData.width,\n            this.copyImageData.height,\n            {\n                x: Math.round(this.lastDot.x - size),\n                y: Math.round(this.lastDot.y - size),\n            },\n            {\n                x: Math.round(x - size),\n                y: Math.round(y - size),\n            },\n            {\n                w,\n                h,\n            },\n        );\n\n        if (bounds) {\n            const params: ISmudgeParams = {\n                aP: bounds.aP,\n                bP: bounds.bP,\n                size: bounds.size,\n                brush: {\n                    center: { x, y },\n                    size,\n                    opacity,\n                    alphaLock: this.settingLockLayerAlpha,\n                }\n            };\n            this.updateRedrawBounds({\n                x1: params.bP.x,\n                y1: params.bP.y,\n                x2: params.bP.x + params.brush.size * 2,\n                y2: params.bP.y + params.brush.size * 2,\n            });\n            this.drawBuffer.push(params);\n        }\n\n        this.lastDot = {\n            x: x,\n            y: y,\n        };\n    }\n\n    continueLine (x: number, y: number, size: number, pressure: number): void {\n        this.drawBuffer = [];\n\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\n        }\n\n        const drawArr = []; //draw instructions. will be all drawn at once\n\n        const dotCallback = (val): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing / 3;\n        if (x === null) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        let before;\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.prepDot(item[0], item[1], item[2], item[3]);\n            before = item;\n        }\n\n        this.copyFromCanvas();\n\n        for (let i = 0; i < this.drawBuffer.length; i++) {\n            smudge(this.copyImageData, this.drawBuffer[i]);\n        }\n    }\n\n\n\n    // ---- public ----\n\n    constructor () { }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.lastDot = null;\n        this.isDrawing = true;\n\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\n\n        this.prepDot(x, y, localSize, localOpacity);\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.completeRedrawBounds = null;\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        this.redrawBounds = null;\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine (): void {\n        this.redrawBounds = null;\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.isDrawing = false;\n        this.bezierLine = null;\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        if (this.historyEntry && this.completeRedrawBounds) {\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\n            if (!(\n                this.completeRedrawBounds.x1 === 0 &&\n                this.completeRedrawBounds.y1 === 0 &&\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\n            )) {\n\n                // temp canvas to prevent main canvas from getting slowed down in chrome\n                const tmpCanvas = BB.canvas(\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n                );\n                const tmpCtx = tmpCanvas.getContext('2d');\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\n            }\n            this.historyEntry.actions.push({\n                action: \"drawImage\",\n                params: [\n                    historyIm,\n                    this.completeRedrawBounds.x1,\n                    this.completeRedrawBounds.y1,\n                ],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.copyImageData = null;\n    }\n\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\n        if (im instanceof ImageData) {\n            this.context.putImageData(im, x, y);\n        } else {\n            this.context.clearRect(x, y, im.width, im.height);\n            this.context.drawImage(im, x, y);\n        }\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        return;\n        /*\n        // todo\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n        // todo\n        history.add(historyEntry);*/\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setColor (c: IRGB): void {\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\n            return;\n        }\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = !!b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = !!b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl.types';\nimport {IBounds} from '../../bb/bb.types';\nimport {KlHistoryInterface} from '../history/kl-history';\n\ntype TChemyMode = 'fill' | 'stroke';\n\nexport class ChemyBrush {\n\n    private context: CanvasRenderingContext2D;\n    private settingColor: IRGB;\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\n    private settingOpacity: number = 1; // 0-1\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingMode: TChemyMode = 'fill';\n    private settingDistort: number = 0; // 0 - 1\n    private settingXSymmetry: boolean = false;\n    private settingYSymmetry: boolean = false;\n    private settingGradient: boolean = false;\n\n    private isDrawing: boolean = false;\n\n    private history: KlHistoryInterface;\n\n    private copyCanvas: HTMLCanvasElement;\n    private path: {x: number, y: number}[];\n    private minY: number;\n    private maxY: number;\n    private completeRedrawBounds: IBounds;\n\n    updateCompleteRedrawBounds (x, y): void {\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\n        if (this.settingXSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: -x + this.copyCanvas.width,\n                    y1: y,\n                    x2: -x + this.copyCanvas.width,\n                    y2: y,\n                }\n                );\n        }\n        if (this.settingYSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: x,\n                    y1: -y + this.copyCanvas.height,\n                    x2: x,\n                    y2: -y + this.copyCanvas.height,\n                }\n            );\n        }\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\n\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\n    }\n\n    private drawShape (): void {\n        this.context.save();\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.context.drawImage(this.copyCanvas, 0, 0);\n\n        let color = {...this.settingColor};\n        if (this.settingIsEraser) {\n            color.r = 255;\n            color.g = 255;\n            color.b = 255;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = \"source-atop\";\n            } else {\n                this.context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n\n        if (this.path) {\n\n            // path\n            const path = new Path2D();\n            this.path.forEach((item, index) => {\n                if (index === 0) {\n                    path.moveTo(item.x, item.y);\n                } else {\n                    path.lineTo(item.x, item.y);\n                }\n            });\n\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\n                r: color.r,\n                g: color.g,\n                b: color.b,\n                a: this.settingOpacity,\n            });\n            if (this.settingGradient) {\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                const gradient = this.context.createLinearGradient(\n                    0, startAtTop ? this.minY : this.maxY,\n                    0, startAtTop ? this.maxY : this.minY,\n                );\n                gradient.addColorStop(\n                    0,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: this.settingOpacity,\n                    })\n                );\n                gradient.addColorStop(\n                    1,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: 0,\n                    })\n                );\n                style = gradient;\n            }\n\n            // setup params\n            if (this.settingMode === 'fill') {\n                this.context.fillStyle = style;\n\n            } else {\n                this.context.lineWidth = this.settingSize * 2;\n                this.context.lineJoin = 'bevel';\n                this.context.strokeStyle = style;\n            }\n\n            // draw\n            const draw = () => {\n                if (this.settingMode === 'fill') {\n                    this.context.fill(path);\n                } else {\n                    this.context.stroke(path);\n                }\n            };\n\n            draw();\n            if (this.settingXSymmetry) {\n                this.context.save();\n                this.context.translate(this.context.canvas.width / 2, 0);\n                this.context.scale(-1, 1);\n                this.context.translate(-this.context.canvas.width / 2, 0);\n                draw();\n                this.context.restore();\n            }\n            if (this.settingYSymmetry) {\n                this.context.save();\n                this.context.translate(0, this.context.canvas.height / 2);\n                this.context.scale(1, -1);\n                this.context.translate(0, -this.context.canvas.height / 2);\n                draw();\n                this.context.restore();\n                if (this.settingXSymmetry) {\n                    this.context.save();\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\n                    this.context.scale(-1, -1);\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\n                    draw();\n                    this.context.restore();\n                }\n            }\n        }\n\n        this.context.restore();\n    }\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setColor (c: IRGB): void {\n        this.settingColor = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setMode (mode: TChemyMode): void {\n        this.settingMode = mode;\n    }\n\n    getMode (): TChemyMode {\n        return this.settingMode;\n    }\n\n    setDistort (distort: number): void {\n        this.settingDistort = BB.clamp(distort, 0, 1);\n    }\n\n    getDistort (): number {\n        return this.settingDistort;\n    }\n\n    setXSymmetry (b: boolean): void {\n        this.settingXSymmetry = !!b;\n    }\n\n    getXSymmetry (): boolean {\n        return this.settingXSymmetry;\n    }\n\n    setYSymmetry (b: boolean): void {\n        this.settingYSymmetry = !!b;\n    }\n\n    getYSymmetry (): boolean {\n        return this.settingYSymmetry;\n    }\n\n    setGradient (b: boolean): void {\n        this.settingGradient = !!b;\n    }\n\n    getGradient (): boolean {\n        return this.settingGradient;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getIsEraser (): boolean {\n        return this.settingIsEraser;\n    }\n\n    setIsEraser (b: boolean): void {\n        this.settingIsEraser = !!b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    startLine (x: number, y: number): void {\n        this.isDrawing = true;\n        this.path = [{x, y}];\n        this.minY = y;\n        this.maxY = y;\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\n        this.completeRedrawBounds = null;\n        this.updateCompleteRedrawBounds(x, y);\n    }\n\n    goLine (x: number, y: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        let pos = { x, y };\n        if (this.settingDistort > 0) {\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n        }\n\n        this.minY = Math.min(this.minY, pos.y);\n        this.maxY = Math.max(this.maxY, pos.y);\n        this.path.push(pos);\n        this.updateCompleteRedrawBounds(x, y);\n        this.drawShape();\n    }\n\n    endLine (): void {\n        this.isDrawing = false;\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\n        if (this.path.length > 1 && this.completeRedrawBounds) {\n            const historyCanvas = BB.canvas(\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n            );\n            const historyCtx = historyCanvas.getContext('2d');\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n            this.history.push({\n                tool: [\"brush\", \"ChemyBrush\"],\n                actions: [\n                    {\n                        action: \"drawImage\",\n                        params: [\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\n                            this.completeRedrawBounds.x1,\n                            this.completeRedrawBounds.y1,\n                        ],\n                    }\n                ]\n            });\n        }\n        this.path = null;\n        this.copyCanvas = null;\n    }\n\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\n        this.context.save();\n        this.context.clearRect(x, y, im.width, im.height);\n        this.context.drawImage(im, x, y);\n        this.context.restore();\n    }\n\n    drawLineSegment (x1, y1, x2, y2): void {\n        // might make sense for stroke\n    }\n}\n","import {penBrushUi} from './pen-brush-ui';\nimport {blendBrushUi} from './blend-brush-ui';\nimport {sketchyBrushUi} from './sketchy-brush-ui';\nimport {pixelBrushUi} from './pixel-brush-ui';\nimport {eraserBrushUi} from './eraser-brush-ui';\nimport {smudgeBrushUi} from './smudge-brush-ui';\nimport {chemyBrushUi} from './chemy-brush-ui';\nimport {IBrushUi} from '../kl.types';\n\n/**\n * UI for brushes.\n * Each brush ui carries the brush with it.\n * So if you want to draw, you do it through the UI. should be changed sometime.\n */\n\nexport const brushesUI: {\n    [key: string]: IBrushUi;\n} = {\n    penBrush: penBrushUi,\n    blendBrush: blendBrushUi,\n    sketchyBrush: sketchyBrushUi,\n    pixelBrush: pixelBrushUi,\n    chemyBrush: chemyBrushUi,\n    smudgeBrush: smudgeBrushUi,\n    eraserBrush: eraserBrushUi,\n};\n","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const penBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pen'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    let alphaNames = [\n        LANG('brush-pen-circle'),\n        LANG('brush-pen-chalk'),\n        LANG('brush-pen-calligraphy'),\n        LANG('brush-pen-square'),\n    ];\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pen');\n        alphaNames = [\n            LANG('brush-pen-circle'),\n            LANG('brush-pen-chalk'),\n            LANG('brush-pen-calligraphy'),\n            LANG('brush-pen-square'),\n        ];\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.PenBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let alphas = [];\n        let currentAlpha = 0;\n        for (let i = 0; i < 4; i++) {\n            (function (i) {\n                let alpha = BB.el({\n                    title: alphaNames[i],\n                    onClick: () => {\n                        alphaClick(i);\n                    }\n                });\n                let canvas = BB.canvas(70, 70);\n                let ctx = canvas.getContext('2d');\n                if (i === 0 || i === 3) {\n                    if (i === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else {\n                        ctx.fillRect(5, 5, 60, 60);\n                    }\n                } else if (i === 1) {\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\n                } else if (i === 2) {\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\n                }\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\n\n                alphas.push(alpha);\n            }(i));\n        }\n\n        function updateAlphas() {\n            for (let i = 0; i < alphas.length; i++) {\n                if (i === currentAlpha) {\n                    alphas[i].className = 'brush-alpha-selected';\n                } else {\n                    alphas[i].className = 'brush-alpha';\n                }\n            }\n        }\n\n        updateAlphas();\n\n        function alphaClick(id) {\n            currentAlpha = id;\n            brush.setAlpha(id);\n            updateAlphas();\n        }\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('brush-lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('brush-lock-alpha-title'),\n            css: {\n                cssFloat: 'right',\n                textAlign: 'right',\n            }\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                curve: brushInterface.opacitySlider.curve,\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let alphaWrapper = document.createElement(\"div\");\n            for (let i = 0; i < alphas.length; i++) {\n                alphaWrapper.appendChild(alphas[i]);\n            }\n            alphaWrapper.style.marginTop = \"10px\";\n            div.appendChild(alphaWrapper);\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8Cez6\");","import {BB} from '../../bb/bb';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const blendBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-blend'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-blend');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.BlendBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: 58 / 2,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    return Math.round(v);\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n            let blendingSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: brush.getBlending() * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setBlending(val / 100);\n                }\n            });\n            blendingSlider.getElement().style.marginTop = \"10px\";\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.setSizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.setOpacityPressure(b);\n            });\n\n            let lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('brush-lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('brush-lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                    display: 'inline-block',\n                }\n            });\n\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                }),\n                blendingSlider.getElement(),\n                lockAlphaToggle.getElement()\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, isCoalesced);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"bRhqj\");","import {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const sketchyBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-sketchy'),\n        sizeSlider: {\n            min: 0.5,\n            max: 10\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-sketchy');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.SketchyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setSize(val);\n                    p.onSizeChange(brush.getSize());\n                },\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n            let blendSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: brush.getBlending() * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setBlending(val / 100);\n                }\n            });\n            let scaleSlider = new KlSlider({\n                label: LANG('brush-sketchy-scale'),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                initValue: brush.getScale(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setScale(val);\n                }\n            });\n            opacitySlider.getElement().style.marginTop = \"10px\";\n            blendSlider.getElement().style.marginTop = \"10px\";\n            scaleSlider.getElement().style.marginTop = \"10px\";\n            div.appendChild(sizeSlider.getElement());\n            div.appendChild(opacitySlider.getElement());\n            div.appendChild(blendSlider.getElement());\n            div.appendChild(scaleSlider.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function (x, y, pressure) {\n            brush.goLine(x, y, pressure, null);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getSeed = function () {\n            return parseInt(brush.getSeed());\n        };\n        this.setSeed = function (s) {\n            brush.setSeed(parseInt(s));\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"c33WP\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const pixelBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pixel'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pixel');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.PixelBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('brush-lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('brush-lock-alpha-title'),\n            css: {\n                marginRight: '10px',\n            }\n        });\n\n        let eraserToggle = new Checkbox({\n            init: brush.getIsEraser(),\n            label: LANG('eraser'),\n            callback: function (b) {\n                brush.setIsEraser(b);\n            },\n            css: {\n                marginRight: '10px',\n            }\n        });\n\n        let ditherToggle = new Checkbox({\n            init: brush.getUseDither(),\n            label: LANG('brush-pixel-dither'),\n            callback: function (b) {\n                brush.setUseDither(b);\n            }\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    val = Math.round(val * 2) / 2;\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    return Math.round(v);\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                curve: brushInterface.opacitySlider.curve,\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                opacitySlider.getElement()\n            );\n\n            let toggleRow = BB.el({\n                parent: div,\n                css: {\n                    display: 'flex',\n                    marginTop: '10px'\n                }\n            });\n\n            toggleRow.appendChild(lockAlphaToggle.getElement());\n            toggleRow.appendChild(eraserToggle.getElement());\n            toggleRow.appendChild(ditherToggle.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"4ahev\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\nimport {Checkbox} from '../ui/base-components/checkbox';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const eraserBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('eraser') + ' [E]',\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.EraserBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n        let isTransparentBg = false;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: 30,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: 1,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let transparencyToggle = new Checkbox({\n                init: false,\n                label: LANG('brush-eraser-transparent-bg'),\n                callback: function (b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: \"10px\",\n                }\n            });\n            div.appendChild(transparencyToggle.getElement());\n        }\n\n        init();\n\n        function drawDot(x, y) {\n            brush.drawDot(x, y);\n        }\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            //brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.getIsTransparentBg = function () {\n            return isTransparentBg;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        }\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hgAG9\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const smudgeBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-smudge'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-smudge');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.SmudgeBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('brush-lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('brush-lock-alpha-title'),\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                curve: brushInterface.opacitySlider.curve,\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let bottomRow = BB.el({\n                parent: div,\n                css: {\n                    marginTop: '10px',\n                }\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7jlxa\");","import {BB} from '../../bb/bb';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\nimport {IBrushUi} from '../kl.types';\nimport {Options} from '../ui/base-components/options';\nimport {BoxToggle} from '../ui/base-components/box-toggle';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const chemyBrushUi = (function () {\n    const brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-chemy'),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\n            isDisabled: true,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-chemy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new brushes.ChemyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                isEnabled: brush.getMode() === 'stroke',\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(brush.getSize());\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    return v < 5 ? (Math.round(v * 10) / 10) : Math.round(v);\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            BB.css(opacitySlider.getElement(), {\n                marginTop: '10px',\n            });\n\n            let eraserToggle = new Checkbox({\n                init: brush.getIsEraser(),\n                label: LANG('eraser'),\n                callback: function (b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: '10px',\n                    marginLeft: '10px',\n                }\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('brush-lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('brush-lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                }\n            });\n\n            const toggleRow = BB.el({\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                }\n            });\n\n            const iconSize = 35;\n            const padding = 8;\n            const actualIconSize = iconSize - padding * 2;\n            const halfSize = actualIconSize / 2;\n\n            const modeOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'fill',\n                        label: BB.createSvg({\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: '#000',\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-fill'),\n                    },\n                    {\n                        id: 'stroke',\n                        label: BB.createSvg({\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: 'none',\n                                    stroke: '#000',\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-stroke'),\n                    }\n                ],\n                initId: brush.getMode(),\n                onChange: (id: string): void => {\n                    brush.setMode(id as 'stroke' | 'fill');\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n                    sizeSlider.setValue(brush.getSize());\n                    p.onSizeChange(brush.getSize());\n                    p.onConfigChange();\n                }\n            });\n\n            const mirrorXToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-mirror-x'),\n                init: brush.getXSymmetry(),\n                onChange: (b) => {\n                    brush.setXSymmetry(b);\n                },\n            });\n\n            const mirrorYToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-mirror-y'),\n                init: brush.getYSymmetry(),\n                onChange: (b) => {\n                    brush.setYSymmetry(b);\n                },\n            });\n\n            const gradientToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'defs',\n                            childrenArr: [\n                                {\n                                    elementType: 'linearGradient',\n                                    id: 'gradient',\n                                    x1: '0',\n                                    y1: '0',\n                                    x2: '0',\n                                    y2: '1',\n                                    childrenArr: [\n                                        {\n                                            elementType: 'stop',\n                                            offset: '0%',\n                                            'stop-color': 'rgba(0,0,0,0)',\n                                        },\n                                        {\n                                            elementType: 'stop',\n                                            offset: '100%',\n                                            'stop-color': 'rgba(0,0,0,1)',\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            elementType: 'rect',\n                            fill: \"url('#gradient')\",\n                            x: '' + padding,\n                            y: '' + padding,\n                            width: '' + actualIconSize,\n                            height: '' + actualIconSize,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-gradient'),\n                init: brush.getGradient(),\n                onChange: (b) => {\n                    brush.setGradient(b);\n                },\n            });\n\n            BB.css(mirrorXToggle.getElement(), {\n                marginLeft: '10px',\n            });\n            {\n                const margin = {\n                    marginLeft: '4px',\n                };\n                BB.css(mirrorYToggle.getElement(), margin);\n                BB.css(gradientToggle.getElement(), margin);\n            }\n\n            toggleRow.append(\n                modeOptions.getElement(),\n                mirrorXToggle.getElement(),\n                mirrorYToggle.getElement(),\n                gradientToggle.getElement(),\n            );\n\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                toggleRow,\n                BB.el({\n                    content: [\n                        lockAlphaToggle.getElement(),\n                        eraserToggle.getElement(),\n                    ],\n                    css: {\n                        display: 'flex',\n                    }\n                })\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"58hyx\");","import {BB} from '../../../bb/bb';\n\nexport class BoxToggle {\n    el: HTMLElement;\n    value: boolean;\n\n    update (): void {\n        if (this.value) {\n            BB.addClassName(this.el, 'kl-box-toggle--active');\n        } else {\n            BB.removeClassName(this.el, 'kl-box-toggle--active');\n        }\n    }\n\n    // --- public ---\n    constructor (\n        p: {\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n            init?: boolean;\n            onChange: (b: boolean) => void;\n        }\n    ) {\n        this.value = !!p.init;\n        this.el = BB.el({\n            content: p.label,\n            title: p.title,\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\n            onClick: () => {\n                this.value = !this.value;\n                this.update();\n                p.onChange(this.value);\n            },\n            css: {\n                cursor: 'pointer',\n            }\n        });\n        if (typeof p.label !== 'string') {\n            BB.css(p.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n        this.update();\n    }\n\n    getValue (): boolean {\n        return this.value;\n    }\n\n    setValue (b: boolean): void {\n        this.value = !!b;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.el;\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.el);\n    }\n}","import { BB } from '../../../bb/bb';\r\nimport { Popup } from './popup';\r\nimport { LANG } from '../../../language/language';\r\n\r\nexport function showIframePopup(url, isEmbed, klRootEl, bbox) {\r\n    if (!isEmbed && ((bbox.height || window.innerHeight) < 500 || (bbox.width || window.innerWidth) < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    let iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%'\r\n        }\r\n    }) as HTMLIFrameElement;\r\n    let titleEl = BB.el({});\r\n\r\n    let linkEl;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function () {\r\n                popup.close();\r\n            }\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = function () {\r\n            BB.setAttributes(linkEl, {\r\n                href: '' + iframe.contentWindow.location,\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    let popup = new Popup({\r\n        target: klRootEl,\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                BB.destroyEl(linkEl);\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\n\nexport class RadioList {\n\n    el: HTMLDivElement;\n    inputs: HTMLInputElement[] = [];\n\n    constructor({name, init, items, ignoreFocus}: {\n        name: string;\n        init?: string;\n        items: {\n            label: string;\n            value: string;\n        }[],\n        ignoreFocus?: boolean; // default false\n    }) {\n        this.el = BB.el({\n            className: 'kl-radio'\n        }) as HTMLDivElement;\n\n        items.forEach(item => {\n            let label = BB.el({\n                tagName: 'label'\n            });\n            let input = BB.el({\n                tagName: 'input',\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: 'radio',\n                }\n            }) as HTMLInputElement;\n            if (ignoreFocus) {\n                input.setAttribute('data-ignore-focus', 'true');\n            }\n            if (init === item.value) {\n                input.checked = true;\n            }\n            label.append(item.label);\n            this.el.append(label);\n            this.inputs.push(input);\n        });\n    }\n\n\n    getValue(): string {\n        for (let i = 0; i < this.inputs.length; i++) {\n            if (this.inputs[i].checked) {\n                return this.inputs[i].value;\n            }\n        }\n        return null;\n    }\n\n    getElement() {\n        return this.el;\n    }\n\n}","import { BB } from '../../../bb/bb';\r\n\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\nimport { BBox, IKlProject } from '../../kl.types';\r\nimport { showIframePopup } from '../modals/show-iframe-popup';\r\nimport { SaveReminder } from './save-reminder';\r\nimport { IProjectStoreListener, ProjectStore } from '../../storage/project-store';\r\nimport { KL } from '../../kl';\r\nimport { LANG } from '../../../language/language';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private infoEl: HTMLDivElement;\r\n    private ageEl: HTMLDivElement;\r\n    private storeEl: HTMLButtonElement;\r\n    private clearEl: HTMLButtonElement;\r\n    private storeListener: IProjectStoreListener;\r\n\r\n    private timestamp: number | undefined;\r\n\r\n    private updateAge() {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons() {\r\n        if (this.timestamp) {\r\n            this.storeEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = false;\r\n        } else {\r\n            this.storeEl.textContent = LANG('file-storage-store');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        if (this.timestamp) {\r\n            BB.css(thumbnail, {\r\n                display: 'block',\r\n                maxWidth: 'calc(100% - 2px)',\r\n                maxHeight: 'calc(100% - 2px)',\r\n                margin: '0 auto',\r\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\r\n                boxShadow: '0 0 0 1px #aaa',\r\n                pointerEvents: 'none',\r\n            });\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store() {\r\n        const p = this.getProject();\r\n        if (p) {\r\n            this.storeEl.textContent = LANG('file-storage-storing');\r\n            this.storeEl.disabled = true;\r\n            this.clearEl.disabled = true;\r\n            await new Promise((resolve) => {\r\n                setTimeout(() => resolve(null), 20);\r\n            });\r\n            try {\r\n                await this.projectStore.store(p);\r\n                this.saveReminder.reset();\r\n            } catch (e) {\r\n                this.resetButtons();\r\n                KL.popup({\r\n                    target: this.saveReminder.getEl(),\r\n                    type: 'error',\r\n                    message: [\r\n                        `${LANG('file-storage-failed-1')}<ul>`,\r\n                        `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                        `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                        `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                        `</ul>`,\r\n                    ].join(''),\r\n                    buttons: ['Ok'],\r\n                });\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    private async clear() {\r\n        this.storeEl.disabled = true;\r\n        this.clearEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.saveReminder.getEl(),\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor(\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject | null,\r\n        private saveReminder: SaveReminder,\r\n        private options?: { hideClearButton?: boolean },\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            }\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            title: LANG('file-storage-about'),\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '19px',\r\n                height: '19px',\r\n                borderRadius: '100%',\r\n                textAlign: 'center',\r\n                lineHeight: '19px',\r\n                fontWeight: 'bold',\r\n                boxShadow: 'inset 0 0 0 1px #000',\r\n            },\r\n            onClick: () => {\r\n                showIframePopup('./help/#help-browser-storage', false, saveReminder.getEl(), saveReminder.getBBox());\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: \"🔴 \" + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            css: {\r\n                gridArea: 'preview',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                boxShadow: 'inset 0 0 0 1px #aaa',\r\n                background: '#cdcdcd',\r\n                color: '#545454',\r\n                colorScheme: 'only light',\r\n                minHeight: '67px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                bottom: '0',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.storeEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.storeEl.tabIndex = -1;\r\n        this.clearEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearEl.style.display = 'none';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement() {\r\n        return this.element;\r\n    }\r\n\r\n    show() {\r\n        // todo\r\n    }\r\n\r\n    hide() {\r\n        // todo\r\n    }\r\n\r\n    destroy() {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeEl);\r\n        BB.destroyEl(this.clearEl);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\nimport {ProjectConverter} from './project-converter';\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\nimport {LocalStorage} from '../../bb/base/local-storage';\n\n\nexport interface IProjectStoreListener {\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\n}\n\nfunction makeAsync(func): Promise<any> {\n    return new Promise((resolve, reject) => {\n        func(resolve, reject);\n    });\n}\n\n/**\n * simplified interface for storing projects into browser storage\n */\nexport class ProjectStore {\n\n    private listeners: IProjectStoreListener[] = [];\n    private accessHasFailed: boolean = false;\n\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\n        await new Promise((resolve, reject) => {\n            storeKlProjectObj(project, resolve, reject);\n        });\n    }\n\n    async lowLevelRead (): Promise<IKlStorageProject> {\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\n    }\n\n    async lowLevelClear (): Promise<any> {\n        await makeAsync(clear);\n    }\n\n\n\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\n        this.listeners.forEach(item => {\n            item.onUpdate(timestamp, thumbnail);\n        });\n    }\n\n    private updateTimestamp() {\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\n    }\n\n    // --- public ---\n\n    constructor () {\n        window.addEventListener('storage', (e) => {\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\n                return;\n            }\n            try {\n                ( async () => {\n                    const readResult = await this.read();\n                    if (readResult) {\n                        this.emit(readResult.timestamp, readResult.thumbnail);\n                    } else {\n                        this.emit();\n                    }\n                })();\n            } catch (e) {\n                if (e.message.indexOf('db-error') === 0) {\n                    this.accessHasFailed = true;\n                }\n            }\n\n        });\n    }\n\n    async read(): Promise<{\n        project: IKlProject,\n        timestamp: number,\n        thumbnail: HTMLImageElement | HTMLCanvasElement\n    } | null> {\n        let storageProject;\n        try {\n            storageProject = await this.lowLevelRead();\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        if (!storageProject) {\n            return null;\n        }\n        let result;\n        try {\n            result = await ProjectConverter.readStorageProject(storageProject);\n        } catch (e) {\n            throw new Error('format-error: ' + e);\n        }\n        return result;\n    }\n\n    async store(project: IKlProject): Promise<void> {\n        try {\n            const storageProject = ProjectConverter.createStorageProject(project);\n            await this.lowLevelStore(storageProject);\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        {\n            // immediately test if it can be read\n            const storageProject = await this.lowLevelRead();\n            let readResult = null;\n            try {\n                readResult = await ProjectConverter.readStorageProject(storageProject);\n            } catch (e) {\n                await this.lowLevelClear();\n                this.updateTimestamp();\n                setTimeout(() => this.emit(), 0);\n                throw new Error('format-error: ' + e);\n            }\n            this.updateTimestamp();\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\n        }\n    }\n\n    async clear(): Promise<void> {\n        await this.lowLevelClear();\n        this.updateTimestamp();\n        setTimeout(() => this.emit(), 0);\n    }\n\n    subscribe(listener: IProjectStoreListener) {\n        if (this.listeners.includes(listener)) {\n            return;\n        }\n        this.listeners.push(listener);\n    }\n\n    unsubscribe(listener: IProjectStoreListener) {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (listener === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    isBroken() {\n        return this.accessHasFailed;\n    }\n\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\nimport {BB} from '../../bb/bb';\nimport {drawProject} from '../canvas/draw-project';\nimport {base64ToBlob} from './base-64-to-blob';\n\n\nconst thumbSize = 240;\n\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const im = new Image();\n        try {\n            im.src = BB.imageBlobToUrl(blob);\n        } catch (e) {\n            reject('imageBlobToUrl, ' + e.message);\n            return;\n        }\n        im.onload = () => {\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        }\n        im.onabort = function () {\n            reject('layer image failed loading');\n        };\n        im.onerror = function () {\n            reject('layer image failed loading');\n        };\n    });\n}\n\n/**\n * for:\n * - preparing project to be stored in ProjectStore\n * - reading a project that came out of the ProjectStore\n */\nexport class ProjectConverter {\n\n    private static createThumbnail(project): HTMLCanvasElement {\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\n        const factor = size.width / project.width;\n        return drawProject(project, factor);\n    }\n\n    static createStorageProject(project: IKlProject): IKlStorageProject {\n        return {\n            id: 1,\n            timestamp: new Date().getTime(),\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\n            width: project.width,\n            height: project.height,\n            layers: project.layers.map(item => {\n                let blob;\n                if (item.image instanceof HTMLCanvasElement) {\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\n                } else {\n                    // todo image\n                    throw new Error('Not implemented');\n                }\n                return {\n                    name: item.name,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                    blob,\n                }\n            }),\n        };\n    }\n\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\n        project: IKlProject,\n        timestamp: number,\n        thumbnail: HTMLImageElement | HTMLCanvasElement\n    }> {\n        if (\n            !storageProject.width || !storageProject.height ||\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\n            storageProject.width < 1 || storageProject.height < 1\n        ) {\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\n        }\n        const project: IKlProject = {\n            width: storageProject.width,\n            height: storageProject.height,\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\n                .map((image, i) => {\n                    return {\n                        name: storageProject.layers[i].name,\n                        opacity: storageProject.layers[i].opacity,\n                        mixModeStr: storageProject.layers[i].mixModeStr,\n                        image,\n                    };\n                }),\n        };\n\n        let thumbnail;\n        if (storageProject.thumbnail) {\n            thumbnail = await loadImage(storageProject.thumbnail);\n        } else {\n            thumbnail = ProjectConverter.createThumbnail(project);\n        }\n\n        return {\n            project: project,\n            timestamp: storageProject.timestamp,\n            thumbnail: thumbnail,\n        };\n    }\n\n}","\nexport function base64ToBlob(base64Str: string): Blob {\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n    let binStr = atob(parts[3]);\n    let buf = new ArrayBuffer(binStr.length);\n    let view = new Uint8Array(buf);\n    for (let i = 0; i < view.length; i++) {\n        view[i] = binStr.charCodeAt(i);\n    }\n    return new Blob([view], {'type': parts[1]});\n}","import { BB } from '../../../bb/bb';\nimport { KL } from '../../kl';\n// @ts-ignore\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\n// @ts-ignore\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\n// @ts-ignore\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\n// @ts-ignore\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\n// @ts-ignore\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\nimport { BrowserStorageUi } from '../components/browser-storage-ui';\nimport { IKlProject } from '../../kl.types';\nimport { SaveReminder } from '../components/save-reminder';\nimport { ProjectStore } from '../../storage/project-store';\nimport { LANG } from '../../../language/language';\n\nexport type exportType = 'png' | 'layers' | 'psd';\n\nexport class FileTab {\n\n  private readonly div: HTMLDivElement;\n  private importButton: HTMLInputElement;\n  private fileBrowserStorage: BrowserStorageUi;\n\n  constructor(\n    klRootEl,\n    projectStore: ProjectStore | null | undefined,\n    getProject: () => IKlProject,\n    private exportType,\n    onExportTypeChange,\n    onFileSelect,\n    onSaveImageToComputer,\n    onNewImage,\n    onShareImage,\n    onUpload,\n    onCopyToClipboard,\n    saveReminder: SaveReminder,\n  ) {\n    const _this = this;\n    this.div = document.createElement(\"div\");\n\n    const asyncCreation = () => {\n      let filemenu = document.createElement(\"div\");\n      let newButton = document.createElement(\"button\");\n      let saveButton = document.createElement(\"button\");\n      let shareButton = document.createElement(\"button\");\n      let uploadImgurButton = document.createElement(\"button\");\n      let clipboardButton = document.createElement(\"button\");\n\n      newButton.style.cssFloat = 'left';\n      BB.css(saveButton, {\n        cssFloat: 'left',\n        clear: 'both',\n      });\n      BB.css(clipboardButton, {\n        cssFloat: 'left',\n        clear: 'both',\n      });\n\n      newButton.tabIndex = -1;\n      saveButton.tabIndex = -1;\n      shareButton.tabIndex = -1;\n      uploadImgurButton.tabIndex = -1;\n      clipboardButton.tabIndex = -1;\n\n      newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\n      saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\n      shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\n      uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\n      clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\n      clipboardButton.title = LANG('file-copy-title');\n      newButton.className = \"gridButton\";\n      saveButton.className = \"gridButton\";\n      shareButton.className = \"gridButton\";\n      uploadImgurButton.className = \"gridButton\";\n      clipboardButton.className = \"gridButton\";\n\n\n      this.importButton = document.createElement(\"input\");\n      this.importButton.tabIndex = -1;\n      this.importButton.type = \"file\";\n      this.importButton.multiple = true;\n      this.importButton.accept = \"image\";\n      (this.importButton as any).size = \"71\";\n      this.importButton.textContent = \"Import\";\n      let importWrapper: any = this.importButton;\n\n      function createImportButton() {\n        importWrapper = document.createElement(\"div\");\n        importWrapper.className = \"gridButton\";\n        importWrapper.style.position = \"relative\";\n        importWrapper.style.cursor = \"pointer\";\n        importWrapper.style.cssFloat = \"left\";\n\n        let innerMask = document.createElement(\"div\");\n        innerMask.style.width = \"120px\";\n        innerMask.style.height = \"28px\";\n        innerMask.style.overflow = \"hidden\";\n        innerMask.style.cursor = \"pointer\";\n        innerMask.style.position = \"relative\";\n\n        importWrapper.appendChild(innerMask);\n        innerMask.appendChild(_this.importButton);\n\n        let importFakeButton = document.createElement(\"button\");\n        importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\n        importFakeButton.tabIndex = -1;\n\n        BB.css(importFakeButton, {\n          width: \"120px\",\n          display: \"box\",\n          position: \"absolute\",\n          left: '0',\n          top: '0',\n          cursor: \"pointer\"\n        });\n        BB.css(_this.importButton, {\n          display: 'none'\n        });\n        importWrapper.appendChild(importFakeButton);\n\n        importFakeButton.onclick = function () {\n          _this.importButton.click();\n        }\n      }\n\n      createImportButton();\n\n      this.importButton.onchange = function (e) {\n        onFileSelect(_this.importButton.files, 'default');\n        _this.importButton.value = \"\";\n\n      };\n\n\n      // --- export filetype dropdown ---\n      let exportTypeWrapper;\n      let exportTypeSelect;\n      {\n        exportTypeWrapper = BB.el({\n          css: {\n            fontSize: '15px',\n            marginLeft: '10px',\n            marginTop: '10px',\n            cssFloat: 'left',\n            width: 'calc(50% - 15px)',\n            height: '30px'\n          }\n        });\n        exportTypeSelect = new KL.Select({\n          optionArr: [\n            ['png', LANG('file-save-png')],\n            ['psd', LANG('file-save-psd')],\n            ['layers', LANG('file-save-layers')],\n          ],\n          initValue: exportType,\n          onChange: function (val) {\n            exportType = val;\n            onExportTypeChange(exportType);\n            onSaveImageToComputer();\n          }\n        });\n        BB.css(exportTypeSelect.getElement(), {\n          width: '120px',\n          height: '30px'\n        });\n        exportTypeWrapper.appendChild(exportTypeSelect.getElement());\n\n      }\n\n\n\n      newButton.onclick = onNewImage;\n      saveButton.onclick = function () {\n        onSaveImageToComputer();\n      };\n      shareButton.onclick = function () {\n        shareButton.disabled = true;\n        if (typeof onShareImage === 'function') {\n          onShareImage(() => {\n            shareButton.disabled = false;\n          });\n        }\n      };\n      uploadImgurButton.onclick = function () {\n        onUpload();\n      };\n\n      clipboardButton.onclick = function () {\n        clipboardButton.blur();\n        onCopyToClipboard();\n      };\n\n      let saveNote = document.createElement(\"div\");\n      saveNote.textContent = \"⚠️ \" + LANG('file-no-autosave');\n      BB.css(saveNote, {\n        textAlign: \"center\",\n        marginTop: \"10px\",\n        background: \"rgb(243, 243, 161)\",\n        padding: \"5px 0px\",\n        color: 'rgba(0,0,0,0.65)',\n        fontSize: '15px',\n      });\n\n      function createSpacer() {\n        let el = document.createElement(\"div\");\n        let clearer = document.createElement(\"div\");\n        let line = document.createElement(\"div\");\n        el.appendChild(clearer);\n        el.appendChild(line);\n        BB.css(clearer, {\n          clear: 'both'\n        });\n        BB.css(line, {\n          marginLeft: \"10px\",\n          marginRight: \"10px\",\n          marginTop: \"10px\",\n          borderBottom: \"1px solid rgba(0,0,0,0.2)\",\n          clear: 'both'\n        });\n        return el;\n      }\n\n      if (projectStore) {\n        _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder);\n        BB.css(_this.fileBrowserStorage.getElement(), {\n          //background: 'red',\n          margin: '10px',\n        });\n      }\n\n\n      //actual structure\n      BB.append(filemenu, [\n        saveNote,\n        newButton,\n        importWrapper,\n        BB.el({ css: { clear: 'both' } }),\n\n        saveButton,\n        exportTypeWrapper,\n        BB.el({ css: { clear: 'both' } }),\n\n        clipboardButton,\n        typeof onShareImage === 'function' && BB.canShareFiles() ? shareButton : null,\n        BB.el({ css: { clear: 'both' } }),\n\n        createSpacer(),\n        _this.fileBrowserStorage ? _this.fileBrowserStorage.getElement() : null,\n        _this.fileBrowserStorage ? createSpacer() : null,\n        uploadImgurButton,\n      ]);\n\n      this.div.appendChild(filemenu);\n    };\n\n    setTimeout(asyncCreation, 1);\n  }\n\n  refresh() {\n  }\n\n  getElement() {\n    return this.div;\n  }\n\n  setIsVisible(isVisible: boolean) {\n    if (isVisible) {\n      this.refresh();\n    }\n  }\n\n  triggerImport() {\n    this.importButton.click();\n  }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"aisua\");","import { BB } from '../../../bb/bb';\r\nimport { KL } from '../../kl';\r\nimport { klHistory } from '../../history/kl-history';\r\nimport { IKeyString } from '../../../bb/bb.types';\r\nimport { StatusOverlay } from '../components/status-overlay';\r\nimport { KlCanvasWorkspace } from '../../canvas-ui/kl-canvas-workspace';\r\nimport { KlCanvas } from '../../canvas/kl-canvas';\r\nimport { LANG } from '../../../language/language';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor(\r\n        private klApp,\r\n        private klColorSlider,\r\n        private layerManager,\r\n        private setCurrentLayer,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi,\r\n        private getCurrentColor,\r\n        private getKlMaxCanvasSize,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.div = document.createElement(\"div\");\r\n    }\r\n\r\n    private init() {\r\n        const _this = this;\r\n        let hasWebGl = BB.hasWebGl();\r\n        let filters = KL.filterLib;\r\n        let buttons = [];\r\n\r\n        BB.BbLog.emit({\r\n            type: 'init-filters',\r\n        });\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        function createButton(filterKey, filterArr) {\r\n            let button = document.createElement(\"button\");\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = \"gridButton\";\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n            button.onclick = function () {\r\n\r\n                function finishedDialog(result, filterDialog) {\r\n                    if (result == \"Cancel\") {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterArr[filterKey].name;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                }\r\n\r\n                if (!('apply' in filterArr[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                function applyFilter(input) {\r\n                    let filterResult = filterArr[filterKey].apply({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input\r\n                    });\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    if (filterArr[filterKey].updateContext === true) {\r\n                        _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\r\n                    }\r\n                    if (filterArr[filterKey].updatePos === true) {\r\n                        _this.klCanvasWorkspace.resetView();\r\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    _this.layerManager.update();\r\n                }\r\n\r\n                if (filterArr[filterKey].isInstant) {\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    _this.statusOverlay.out('\"' + filterArr[filterKey].name + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\r\n                    let filterDialog = filterArr[filterKey].getDialog({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        maxWidth: _this.getKlMaxCanvasSize(),\r\n                        maxHeight: _this.getKlMaxCanvasSize(),\r\n                        bbox: _this.klApp.getBBox(),\r\n                        currentColorRgb: { r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b },\r\n                        secondaryColorRgb: { r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b }\r\n                    });\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closefunc;\r\n                    filterDialog.errorCallback = function (e) {\r\n                        setTimeout(function () {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closefunc();\r\n                    };\r\n\r\n\r\n                    let style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px'\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: _this.klApp.getEl(),\r\n                        message: \"<b>\" + filterArr[filterKey].name + \"</b>\",\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (result) {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closefunc: function (func) {\r\n                            closefunc = func;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        }\r\n\r\n        function createDisabledButton(filterKey, filterArr) {\r\n            if (!filterArr[filterKey].webgl && !filterArr[filterKey].ieFails) {\r\n                return;\r\n            }\r\n            if (filterArr[filterKey].ieFails && navigator.appName !== 'Microsoft Internet Explorer') {\r\n                return;\r\n            }\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let button = document.createElement(\"button\");\r\n            let im = '<img style=\"opacity: 0.5\" src=\"img/' + filterArr[filterKey].icon + '\" />';\r\n            let name = filterArr[filterKey].name;\r\n            if (name.length > 11) {\r\n                name = \"<span style='font-size: 12px'>\" + buttonLabel + \"</span>\";\r\n            }\r\n            button.innerHTML = im + name;\r\n            button.className = \"gridButton\";\r\n            button.disabled = true;\r\n            return button;\r\n        }\r\n\r\n        function addGroup(groupArr, filterArr, targetEl) {\r\n            for (let filterKey in filterArr) {\r\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\r\n                    continue;\r\n                }\r\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\r\n                    continue;\r\n                }\r\n                if ((filterArr[filterKey].webgl && hasWebGl)\r\n                    || (filterArr[filterKey].neededWithWebGL)\r\n                    || (!filterArr[filterKey].webgl && !hasWebGl)\r\n                    && !(filterArr[filterKey].ieFails && navigator.appName == 'Microsoft Internet Explorer')) {\r\n\r\n                    targetEl.appendChild(createButton(filterKey, filterArr));\r\n\r\n                } else {\r\n                    targetEl.appendChild(createDisabledButton(filterKey, filterArr));\r\n                    filterArr[filterKey] = undefined;\r\n                }\r\n            }\r\n        }\r\n\r\n        let groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'glPerspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform'\r\n        ];\r\n        let groupB = [];\r\n        for (let filterKey in filters) {\r\n            if (filters.hasOwnProperty[filterKey] || groupA.includes(filterKey)) {\r\n                continue;\r\n            }\r\n            groupB.push(filterKey);\r\n        }\r\n\r\n        addGroup(groupA, filters, _this.div);\r\n        let hrEl = document.createElement(\"div\");\r\n        hrEl.className = \"gridHr\";\r\n        _this.div.appendChild(hrEl);\r\n        addGroup(groupB, filters, _this.div);\r\n\r\n\r\n        if (!hasWebGl) {\r\n            let webglnote = BB.appendTextDiv(_this.div, \"Some actions are disabled because WebGL isn't working.\");\r\n            webglnote.style.margin = \"10px\";\r\n            BB.css(webglnote, {\r\n                fontSize: \"11px\",\r\n                color: \"#555\",\r\n                background: \"#ffe\",\r\n                padding: \"10px\",\r\n                borderRadius: \"10px\",\r\n                textAlign: \"center\"\r\n            });\r\n        }\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    show() {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.div.style.display = 'block';\r\n    }\r\n\r\n    hide() {\r\n        this.div.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\r\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\r\n\r\n    let w = window.open();\r\n    let label = w.document.createElement(\"div\");\r\n    let gif = w.document.createElement(\"img\");\r\n    gif.src = loadingImg;\r\n    label.appendChild(gif);\r\n    BB.css(gif, {\r\n        filter: \"invert(1)\"\r\n    });\r\n    w.document.body.style.backgroundColor = \"#121211\";\r\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\r\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\r\n    let labelText = w.document.createElement(\"div\");\r\n    labelText.style.marginTop = \"10px\";\r\n    label.appendChild(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.appendChild(label);\r\n    BB.css(label, {\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        marginTop: \"100px\",\r\n        fontFamily: \"Arial, sans-serif\",\r\n        fontSize: \"20px\",\r\n        textAlign: \"center\",\r\n        transition: \"opacity 0.3s ease-in-out\",\r\n        opacity: '0',\r\n        color: \"#ccc\"\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    let data = (await response.json()).data;\r\n\r\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\r\n    /* if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    } */\r\n\r\n    let inputTitle = document.createElement(\"input\");\r\n    inputTitle.type = \"text\";\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    let inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    let labelTitle = document.createElement(\"div\");\r\n    labelTitle.textContent = LANG('upload-name') + \":\";\r\n    let labelDescription = BB.el({\r\n        content: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        }\r\n    });\r\n\r\n    let tos = document.createElement(\"div\");\r\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    let outDiv = document.createElement(\"div\");\r\n    let infoHint = document.createElement(\"div\");\r\n    infoHint.className = \"info-hint\";\r\n    infoHint.textContent = LANG('upload-link-notice');\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: \"upload\",\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), \"Cancel\"],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\r\n                try {\r\n                    if (!imgurKey) {\r\n                        throw new Error('imgur key missing');\r\n                    }\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"ok\",\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/<b>delete</b>/${result.deletehash}</a><br><br>`,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"error\",\r\n                        message: LANG('upload-failed') + \": \" + e.message,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8mdF2\");","import {BB} from '../../bb/bb';\n\nlet agPsdLazy;\nexport async function loadAgPsd() {\n    if (!agPsdLazy) {\n        agPsdLazy = await import('ag-psd');\n        BB.BbLog.emit({\n            type: 'loaded-agpsd',\n        });\n    }\n    return agPsdLazy;\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"6YuND\"))).then(() => parcelRequire('2m2jt'));","import { KL } from '../../kl';\r\nimport { BB } from '../../../bb/bb';\r\nimport { KlHistoryInterface } from '../../history/kl-history';\r\nimport { LANG } from '../../../language/language';\r\nimport { BrowserStorageUi } from './browser-storage-ui';\r\nimport { ProjectStore } from '../../storage/project-store';\r\nimport { IKlProject, BBox } from '../../kl.types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup(): void {\r\n        if (!this.projectStore || !this.getProject || !this.getProject()) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el({});\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                }\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            }\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            }\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            {\r\n                hideClearButton: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: this.getEl(),\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closefunc: (f) => {\r\n                this.closeFunc = f;\r\n            }\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor(\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject | null) | null, // needed if showReminder\r\n        public getEl: () => HTMLElement,\r\n        public getBBox: () => BBox,\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init(): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload(e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            let actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\r\n            } else {\r\n                BB.setEventListener(window, 'onbeforeunload', null);\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener(\"visibilitychange\", () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    let actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + ' · ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset(): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        BB.setEventListener(window, 'onbeforeunload', null);\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import { BB } from '../../bb/bb';\nimport { KL } from '../kl';\nimport { saveAs } from 'file-saver';\nimport { KlCanvas } from '../canvas/kl-canvas';\n\nexport class SaveToComputer {\n\n    constructor(\n        private customSave,\n        private saveReminder,\n        private klRootEl,\n        private getExportType,\n        private getKlCanvas: () => KlCanvas,\n        private filenameBase: string,\n    ) { }\n\n    save(format?: 'psd' | 'layers' | 'png') {\n        const _this = this;\n\n        _this.saveReminder.reset();\n\n\n        function saveImage(canvas, filename, mimeType) {\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n            //assume base64 encoding\n            let binStr = atob(parts[3]);\n            //convert to binary in ArrayBuffer\n            let buf = new ArrayBuffer(binStr.length);\n            let view = new Uint8Array(buf);\n            for (let i = 0; i < view.length; i++) {\n                view[i] = binStr.charCodeAt(i);\n            }\n            let blob = new Blob([view], { 'type': parts[1] });\n            if (typeof _this.customSave === 'function') {\n                _this.customSave(blob, filename);\n            } else {\n                saveAs(blob, filename);\n            }\n        }\n\n        if (!format) {\n            format = _this.getExportType();\n        }\n\n        if (format === 'png') {\n            let extension = 'png';\n            let mimeType = 'image/png';\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\n\n            /*fullCanvas.toBlob(function(blob) {\n                if (blob === null) {\n                    throw 'save image error, blob is null';\n                }\n                saveAs(blob, filename);\n            }, mimetype);*/\n\n            //using old code, because saving somehow doesn't work for ipad before ios 13\n            //and it doesn't even throw an exception\n            try {\n                saveImage(fullCanvas, filename, mimeType);\n            } catch (error) { //fallback for old browsers\n                let im = new Image();\n                im.width = _this.getKlCanvas().getWidth();\n                im.height = _this.getKlCanvas().getHeight();\n                im.src = fullCanvas.toDataURL(mimeType);\n                KL.exportDialog(_this.klRootEl, im);\n            }\n        } else if (format === 'layers') {\n            let extension = 'png';\n            let mimeType = 'image/png';\n            let fileBase = BB.getDate() + this.filenameBase;\n            let layerArr = _this.getKlCanvas().getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                let item = layerArr[i];\n                let fnameArr = [\n                    fileBase,\n                    '_',\n                    ('' + (i + 1)).padStart(2, '0'),\n                    '_',\n                    item.name,\n                    '.',\n                    extension\n                ];\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\n            }\n        } else if (format === 'psd') {\n\n            let layerArr = _this.getKlCanvas().getLayersFast();\n\n            let psdConfig = {\n                width: _this.getKlCanvas().getWidth(),\n                height: _this.getKlCanvas().getHeight(),\n                children: [],\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\n            };\n            for (let i = 0; i < layerArr.length; i++) {\n                let item = layerArr[i];\n                psdConfig.children.push({\n                    name: item.name,\n                    opacity: item.opacity,\n                    canvas: item.canvas,\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                    left: 0,\n                    top: 0\n                });\n            }\n\n            KL.loadAgPsd().then((agPsdLazy) => {\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\n                if (typeof _this.customSave === 'function') {\n                    _this.customSave(blob, BB.getDate() + this.filenameBase + '.psd');\n                } else {\n                    saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\n                }\n            }).catch(() => {\n                alert('Error: failed to load PSD library');\n            });\n\n        }\n\n    }\n\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\nimport {IFilterApply, IInitState} from '../kl.types';\nimport {KlCanvas} from '../canvas/kl-canvas';\n\nexport class UndoRedoCatchup {\n\n    private doIgnore = false;\n\n    /**\n     * Prevent multiple undo / redo getting triggered at once.\n     * Might be confusing if main thread is choking.\n     */\n    private ignoreTest (): boolean {\n        if (this.doIgnore) {\n            return false;\n        }\n        this.doIgnore = true;\n        setTimeout(() => {\n            this.doIgnore = false;\n        }, 0);\n        return true;\n    }\n\n    // ---- public ----\n\n    constructor (\n        private brushUiObj,\n        private layerPreview,\n        private layerManager,\n        private handUi,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private getInitState: () => IInitState,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx,\n        private setCurrentLayerCtx,\n        private getCurrentBrush,\n    ) { }\n\n    undo (): boolean {\n        if (!this.ignoreTest()) {\n            return false;\n        }\n\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\n            return false;\n        }\n        const actions: IHistoryEntry[] = klHistory.undo();\n        klHistory.pause(true);\n        const initState: IInitState = this.getInitState();\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\n        this.getKlCanvas().copy(initState.canvas);\n        let layerIndex = initState.focus;\n        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n        const brushes: any = {};\n        for (let b in KL.brushes) {\n            if (KL.brushes.hasOwnProperty(b)) {\n                brushes[b] = new KL.brushes[b]();\n                brushes[b].setContext(this.getCurrentLayerCtx());\n            }\n        }\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\n        for (let i = 0; i < actions.length; i++) {\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    const b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: this.getCurrentLayerCtx(),\n                        canvas: this.getKlCanvas(),\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(this.getCurrentLayerCtx());\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = this.getKlCanvas().addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\n                }\n            })(i);\n        }\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\n            this.klCanvasWorkspace.resetView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        this.layerManager.update(layerIndex);\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(layerIndex));\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent(null);\n\n        klHistory.pause(false);\n        return true;\n    }\n\n    redo (): boolean {\n        if (!this.ignoreTest()) {\n            return false;\n        }\n\n        if (!klHistory.canRedo()) {\n            return false;\n        }\n        const actions = klHistory.redo();\n        klHistory.pause(true);\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\n        let layerIndex;\n        const brushes: any = {};\n        for (let b in KL.brushes) {\n            if (KL.brushes.hasOwnProperty(b)) {\n                brushes[b] = new KL.brushes[b]();\n                brushes[b].setContext(this.getCurrentLayerCtx());\n            }\n        }\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\n        for (let i = 0; i < actions.length; i++) {\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    const b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: this.getCurrentLayerCtx(),\n                        canvas: this.getKlCanvas(),\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(this.getCurrentLayerCtx());\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = this.getKlCanvas().addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\n                }\n            })(i);\n        }\n\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\n            this.klCanvasWorkspace.resetView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        const currentLayerIndex = this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);\n        this.layerManager.update(currentLayerIndex);\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(currentLayerIndex));\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent(null);\n        klHistory.pause(false);\n\n        return true;\n    }\n\n    catchup (logParam: IHistoryBroadcast | null): void {\n        // const start = performance.now();\n        //play catch up (the version that is a few steps behind)\n        if (logParam && logParam.bufferUpdate) {\n            const initState: IInitState = this.getInitState();\n\n            const brushes = initState.brushes;\n            const actions = [logParam.bufferUpdate];\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\n            const canvas = initState.canvas;\n            let layerIndex = initState.focus;\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    let b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = canvas[actions[i].action].apply(canvas, p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(localCurrentLayerCtx);\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: localCurrentLayerCtx,\n                        canvas: canvas,\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    localCurrentLayerCtx = canvas.getLayerContext(actions[i].params[0]);\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(localCurrentLayerCtx);\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = canvas.addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(localCurrentLayerCtx);\n                            }\n                        }\n                    }\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\n                }\n            })(0);\n            initState.focus = layerIndex;\n        }\n        // console.log('catchup', performance.now() - start);\n    }\n\n\n}","import {IRGB, ISliderConfig} from '../kl.types';\n\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\n    { type: 'opacity'; value: number } |\n    { type: 'size'; value: number } |\n    { type: 'sliderConfig'; value: ISliderConfig };\n\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\n\n/**\n * Central place to update brush settings, and to subscribe to changes.\n */\nexport class BrushSettingService {\n\n    private static instance: BrushSettingService;\n    subscriberArr: TBrushSettingSubscriber[] = [];\n\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (this.subscriberArr[i] === skipSubscriber) {\n                continue;\n            }\n            this.subscriberArr[i](obj);\n        }\n    }\n\n    // --- public ---\n\n    constructor (\n        private onSetColor: (rgb: IRGB) => void,\n        private onSetSize: (size: number) => void,\n        private onSetOpacity: (opacity: number) => void,\n        private onGetColor: () => IRGB,\n        private onGetSize: () => number,\n        private onGetOpacity: () => number,\n        private onGetSliderConfig: () => ISliderConfig,\n    ) {\n        if (BrushSettingService.instance) {\n            throw new Error('BrushSettingService already instantiated');\n        }\n        BrushSettingService.instance = this;\n    }\n\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'color',\n                value: color\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'size',\n                value: size\n            },\n            skipSubscriber\n        );\n    }\n\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'opacity',\n                value: opacity\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\n        this.emit(\n            {\n                type: 'sliderConfig',\n                value: sliderConfig\n            },\n            skipSubscriber\n        );\n    }\n\n    /**\n     * set current brush color\n     * @param color\n     * @param skipSubscriber\n     */\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetColor(color);\n        this.emitColor(color, skipSubscriber);\n    }\n\n    /**\n     * set current brush size\n     * @param size\n     * @param skipSubscriber\n     */\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetSize(size);\n        // why not emitting?\n    }\n\n    /**\n     * set current opacity\n     * @param opacity\n     * @param skipSubscriber\n     */\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetOpacity(opacity);\n        // why not emitting?\n    }\n\n    /**\n     * get current brush color\n     */\n    getColor (): IRGB {\n        return this.onGetColor();\n    }\n\n    getSize (): number {\n        return this.onGetSize();\n    }\n\n    getOpacity (): number {\n        return this.onGetOpacity();\n    }\n\n    getSliderConfig (): ISliderConfig {\n        return this.onGetSliderConfig();\n    }\n\n    /**\n     * subscribe to changes\n     * @param func\n     */\n    subscribe (func: TBrushSettingSubscriber): void {\n        if (this.subscriberArr.includes(func)) {\n            return;\n        }\n        this.subscriberArr.push(func);\n    }\n\n    unsubscribe (func: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (func === this.subscriberArr[i]) {\n                this.subscriberArr.splice(i, 1);\n                i--;\n            }\n        }\n    }\n}\n\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {Popup} from '../modals/popup';\r\n// @ts-ignore\r\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n        klRootEl?: HTMLElement,\r\n    ) {\r\n\r\n\r\n\r\n\r\n        // ---- language ----\r\n        const language = languageStrings.getLanguage();\r\n\r\n        this.el = BB.el({\r\n            content: `\r\n${LANG('settings-language')}: ${language.name} (${language.code})\r\n            `,\r\n            css: {\r\n                margin: '10px',\r\n            }\r\n        });\r\n\r\n        const preferredLanguageRow = BB.el({\r\n            content: LANG('settings-preferred-language') + ':<br>',\r\n            css: {\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto')] as [string, string]\r\n        ].concat(\r\n            languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`];\r\n            })\r\n        );\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        const languageHint = BB.el({\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n\r\n        preferredLanguageRow.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n        this.el.append(preferredLanguageRow);\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '20px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            }\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses() {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new Popup({\r\n                            target: klRootEl,\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    }\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                }\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   }\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> © 2022<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> © 2022<br>`\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"dijyJ\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"c4VmC\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"et4zb\"))).then(() => parcelRequire('jNQF2'));","import { BB } from '../../../bb/bb';\r\n// @ts-ignore\r\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport { IKeyString } from '../../../bb/bb.types';\r\nimport { LANG } from '../../../language/language';\r\nimport { dialogCounter } from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private toolspace: HTMLElement;\r\n    private upBtn: HTMLElement;\r\n    private downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update(): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor(p: { toolspace: HTMLElement, uiState: 'left' | 'right' }) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace.parentNode,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            }\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace.parentNode,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            }\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            }\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState(uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n    }\r\n}","/**\n * Topmost row of buttons in toolspace\n *\n * p = { // button click callbacks\n *     onSubmit: function(),\n *     onLeftRight: function(),\n *     onHelp: function()\n * }\n *\n * @param p\n * @constructor\n */\nimport {BB} from \"../bb/bb\";\n// @ts-ignore\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\n// @ts-ignore\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\nimport {LANG} from '../language/language';\n\nexport class ToolspaceTopRow {\n    el: HTMLDivElement;\n\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void}) {\n        let div = document.createElement('div');\n        this.el = div;\n        BB.css(div, {\n            height: '36px',\n            //background: '#f00',\n            display: 'flex',\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\n        });\n\n        function createButton(p) {\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            let result = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\n                }\n            });\n            if (p.content) {\n                result.appendChild(p.content);\n            } else {\n                let im = BB.el({\n                    css: {\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\n                        backgroundRepeat: 'no-repeat',\n                        backgroundPosition: 'center',\n                        backgroundSize: p.contain ? 'contain' : '',\n                        //filter: 'grayscale(1)',\n                        height: '100%'\n                    }\n                });\n                im.style.pointerEvents = 'none';\n                result.appendChild(im);\n            }\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: result,\n                onEnterLeave: function(isOver) {\n                    if (isOver) {\n                        BB.addClassName(result, 'toolspace-row-button-hover');\n                    } else {\n                        BB.removeClassName(result, 'toolspace-row-button-hover');\n                    }\n                }\n            });\n            return result;\n        }\n\n        let submitButton = createButton({\n            onClick: p.onSubmit,\n            title: LANG('submit-title'),\n            content: BB.el({\n                content: LANG('submit'),\n                className: 'toolspace-row-button__submit',\n                css: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    width: '100%',\n                    height: '100%'\n                }\n            }),\n            contain: true\n        });\n        submitButton.style.width = '45px';\n\n        let helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true\n        });\n\n        let leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: LANG('switch-ui-left-right'),\n            image: uiSwapImg,\n            contain: true\n        });\n\n        div.appendChild(submitButton);\n        div.appendChild(leftRightButton);\n        div.appendChild(helpButton);\n    }\n\n    getElement() {\n        return this.el;\n    }\n}\n","import {filterLib, filterLibStatus} from './filters';\nimport {glBrightnessContrast} from './gl-brightness-contrast';\nimport {cropExtend} from './crop-extend';\nimport {glCurves} from './gl-curves';\nimport {flip} from './flip';\nimport {glHueSaturation} from './gl-hue-saturation';\nimport {invert} from './invert';\nimport {glPerspective} from './gl-perspective';\nimport {resize} from './resize';\nimport {rotate} from './rotate';\nimport {glTiltShift} from './gl-tilt-shift';\nimport {transform} from './transform';\nimport {glBlur} from './gl-blur';\nimport {glUnsharpMask} from './gl-unsharp-mask';\nimport {toAlpha} from './to-alpha';\n\nlet embed: boolean;\nfunction importFilter(libObj, moduleObj): void {\n    if (moduleObj.getDialog) {\n        libObj.getDialog = moduleObj.getDialog;\n    }\n    libObj.apply = moduleObj.apply;\n}\n\n\nexport function importFilters(isEmbed?: boolean) {\n    if (filterLibStatus.isLoaded) {\n        return;\n    }\n    embed = isEmbed\n\n    importFilter(filterLib.glBrightnessContrast, glBrightnessContrast);\n    importFilter(filterLib.cropExtend, cropExtend);\n    importFilter(filterLib.glCurves, glCurves);\n    importFilter(filterLib.flip, flip);\n    importFilter(filterLib.glHueSaturation, glHueSaturation);\n    importFilter(filterLib.invert, invert);\n    importFilter(filterLib.glPerspective, glPerspective);\n    importFilter(filterLib.resize, resize);\n    importFilter(filterLib.rotate, rotate);\n    importFilter(filterLib.glTiltShift, glTiltShift);\n    importFilter(filterLib.transform, transform);\n    importFilter(filterLib.glBlur, glBlur);\n    importFilter(filterLib.glUnsharpMask, glUnsharpMask);\n    importFilter(filterLib.toAlpha, toAlpha);\n\n    filterLibStatus.isLoaded = true;\n}","import {BB} from '../../bb/bb';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glBrightnessContrast = {\n    getDialog(params: IFilterGetDialogParam) {\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n\n        let context = params.context; //2d context of canvas\n        let canvas = params.canvas; //the klCanvas and dom element\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n\n        function finishInit() {\n\n            let brightness = 0, contrast = 0;\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let brightnessSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-brightness'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: (brightness + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brightness = val / 50 - 1;\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                }\n            });\n            let contrastSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-contrast'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: (contrast + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    contrast = val / 50 - 1;\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                }\n            });\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(brightnessSlider.getElement());\n            div.appendChild(contrastSlider.getElement());\n\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                brightnessSlider.destroy();\n                contrastSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    brightness: brightness,\n                    contrast: contrast\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let brightness = params.input.brightness;\n        let contrast = params.input.contrast;\n        let history = params.history;\n        if (!context || brightness === null || contrast === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glBrightnessContrast\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n\n        return true;\n    }\n}","\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\n\nlet fxCanvas = null\ntry {\n    fxCanvas = fx.canvas();\n} catch (e) {\n}\n\nexport function getSharedFx() {\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\n        try {\n            fxCanvas = fx.canvas();\n        } catch (e) {\n        }\n    }\n    return fxCanvas;\n}","/*\n * glfx.script\n * http://evanw.github.com/glfx.js/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n *\n * modifications by bitbof\n */\nexport const fx = (function() {\nlet exports: any = {};\n\n// src/OES_texture_float_linear-polyfill.script\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\n(function() {\n  // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\n  // three pixels are 0. Linear filtering is only supported if a sample taken\n  // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\n  function supportsOESTextureFloatLinear(gl) {\n    // Need floating point textures in the first place\n    if (!gl.getExtension('OES_texture_float')) {\n      return false;\n    }\n\n    // Create a render target\n    let framebuffer = gl.createFramebuffer();\n    let byteTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, byteTexture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\n\n    // Create a simple floating-point texture with value of 0.5 in the center\n    let rgba = [\n      2, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0\n    ];\n    let floatTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\n\n    // Create the test shader\n    let program = gl.createProgram();\n    let vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(vertexShader, '\\\n      attribute vec2 vertex;\\\n      void main() {\\\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\n      }\\\n    ');\n    gl.shaderSource(fragmentShader, '\\\n      uniform sampler2D texture;\\\n      void main() {\\\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\n      }\\\n    ');\n    gl.compileShader(vertexShader);\n    gl.compileShader(fragmentShader);\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n\n    // Create a buffer containing a single point\n    let buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\n    gl.enableVertexAttribArray(0);\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n\n    // Render the point and read back the rendered pixel\n    let pixel = new Uint8Array(4);\n    gl.useProgram(program);\n    gl.viewport(0, 0, 1, 1);\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n    gl.drawArrays(gl.POINTS, 0, 1);\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\n\n    // The center sample will only have a value of 0.5 if linear filtering works\n    return pixel[0] === 127 || pixel[0] === 128;\n  }\n\n  // The constructor for the returned extension object\n  function OESTextureFloatLinear() {\n  }\n\n  // Cache the extension so it's specific to each context like extensions should be\n  function getOESTextureFloatLinear(gl) {\n    if (gl.$OES_texture_float_linear$ === void 0) {\n      Object.defineProperty(gl, '$OES_texture_float_linear$', {\n        enumerable: false,\n        configurable: false,\n        writable: false,\n        value: new OESTextureFloatLinear()\n      });\n    }\n    return gl.$OES_texture_float_linear$;\n  }\n\n  // This replaces the real getExtension()\n  function getExtension(name) {\n    return name === 'OES_texture_float_linear'\n      ? getOESTextureFloatLinear(this)\n      : oldGetExtension.call(this, name);\n  }\n\n  // This replaces the real getSupportedExtensions()\n  function getSupportedExtensions() {\n    let extensions = oldGetSupportedExtensions.call(this);\n    if (extensions.indexOf('OES_texture_float_linear') === -1) {\n      extensions.push('OES_texture_float_linear');\n    }\n    return extensions;\n  }\n\n  // Get a WebGL context\n  try {\n    let gl = document.createElement('canvas').getContext('experimental-webgl');\n  } catch (e) {\n  }\n\n  // Don't install the polyfill if the browser already supports it or doesn't have WebGL\n  if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\n    return;\n  }\n\n  // Install the polyfill if linear filtering works with floating-point textures\n  let oldGetExtension;\n  let oldGetSupportedExtensions;\n  if (supportsOESTextureFloatLinear(gl)) {\n    oldGetExtension = WebGLRenderingContext.prototype.getExtension;\n    oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\n    WebGLRenderingContext.prototype.getExtension = getExtension;\n    WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\n  }\n}());\n\n// src/core\\canvas.script\nvar gl;\n\nfunction clamp(lo, value, hi) {\n    return Math.max(lo, Math.min(value, hi));\n}\n\nfunction wrapTexture(texture) {\n    return {\n        _: texture,\n        loadContentsOf: function(element) {\n            // Make sure that we're using the correct global WebGL context\n            gl = this._.gl;\n            this._.loadContentsOf(element);\n        },\n        destroy: function() {\n            // Make sure that we're using the correct global WebGL context\n            gl = this._.gl;\n            this._.destroy();\n        }\n    };\n}\n\nfunction texture(element) {\n    return wrapTexture(Texture.fromElement(element));\n}\n\nfunction initialize(width, height) {\n    let type = gl.UNSIGNED_BYTE;\n\n    // Go for floating point buffer textures if we can, it'll make the bokeh\n    // filter look a lot better. Note that on Windows, ANGLE does not let you\n    // render to a floating-point texture when linear filtering is enabled.\n    // See http://crbug.com/172278 for more information.\n    if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\n        let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\n        try {\n            // Only use gl.FLOAT if we can render to it\n            testTexture.drawTo(function() { type = gl.FLOAT; });\n        } catch (e) {\n        }\n        testTexture.destroy();\n    }\n\n    if (this._.texture) this._.texture.destroy();\n    if (this._.spareTexture) this._.spareTexture.destroy();\n    this.width = width;\n    this.height = height;\n    this._.texture = new Texture(width, height, gl.RGBA, type);\n    this._.spareTexture = new Texture(width, height, gl.RGBA, type);\n    this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\n    this._.flippedShader = this._.flippedShader || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\n        }\\\n    ', 'flippedShader');\n    this._.isInitialized = true;\n}\n\n/*\n   Draw a texture to the canvas, with an optional width and height to scale to.\n   If no width and height are given then the original texture width and height\n   are used.\n*/\nfunction draw(texture, width, height) {\n    if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\n        initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n    }\n\n    texture._.use();\n    this._.texture.drawTo(function() {\n        Shader.getDefaultShader().drawRect();\n    });\n\n    return this;\n}\n\nfunction update() {\n    this._.texture.use();\n    this._.flippedShader.drawRect();\n    return this;\n}\n\nfunction simpleShader(shader, uniforms, textureIn, textureOut) {\n    (textureIn || this._.texture).use();\n    this._.spareTexture.drawTo(function() {\n        shader.uniforms(uniforms).drawRect();\n    });\n    this._.spareTexture.swapWith(textureOut || this._.texture);\n}\n\nfunction replace(node) {\n    node.parentNode.insertBefore(this, node);\n    node.parentNode.removeChild(node);\n    return this;\n}\n\nfunction contents() {\n    let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\n    this._.texture.use();\n    texture.drawTo(function() {\n        Shader.getDefaultShader().drawRect();\n    });\n    return wrapTexture(texture);\n}\n\n/*\n   Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\n   Length of the array will be width * height * 4.\n*/\nfunction getPixelArray() {\n    let w = this._.texture.width;\n    let h = this._.texture.height;\n    let array = new Uint8Array(w * h * 4);\n    this._.texture.drawTo(function() {\n        gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\n    });\n    return array;\n}\n\nfunction wrap(func) {\n    return function() {\n        // Make sure that we're using the correct global WebGL context\n        gl = this._.gl;\n\n        // Now that the context has been switched, we can call the wrapped function\n        return func.apply(this, arguments);\n    };\n}\n\nexports.canvas = function() {\n    let canvas: any = document.createElement('canvas');\n    try {\n        gl = canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\n    } catch (e) {\n        gl = null;\n    }\n    if (!gl) {\n        throw 'This browser does not support WebGL';\n    }\n    canvas._ = {\n        gl: gl,\n        isInitialized: false,\n        texture: null,\n        spareTexture: null,\n        flippedShader: null\n    };\n\n    // Core methods\n    canvas.texture = wrap(texture);\n    canvas.draw = wrap(draw);\n    canvas.update = wrap(update);\n    canvas.replace = wrap(replace);\n    canvas.contents = wrap(contents);\n    canvas.getPixelArray = wrap(getPixelArray);\n\n    // Filter methods\n    canvas.brightnessContrast = wrap(brightnessContrast);\n    canvas.hexagonalPixelate = wrap(hexagonalPixelate);\n    canvas.hueSaturation = wrap(hueSaturation);\n    canvas.colorHalftone = wrap(colorHalftone);\n    canvas.triangleBlur = wrap(triangleBlur);\n    canvas.unsharpMask = wrap(unsharpMask);\n    canvas.perspective = wrap(perspective);\n    canvas.matrixWarp = wrap(matrixWarp);\n    canvas.bulgePinch = wrap(bulgePinch);\n    canvas.tiltShift = wrap(tiltShift);\n    canvas.dotScreen = wrap(dotScreen);\n    canvas.edgeWork = wrap(edgeWork);\n    canvas.lensBlur = wrap(lensBlur);\n    canvas.zoomBlur = wrap(zoomBlur);\n    canvas.noise = wrap(noise);\n    canvas.denoise = wrap(denoise);\n    canvas.curves = wrap(curves);\n    canvas.swirl = wrap(swirl);\n    canvas.ink = wrap(ink);\n    canvas.vignette = wrap(vignette);\n    canvas.vibrance = wrap(vibrance);\n    canvas.sepia = wrap(sepia);\n    canvas.invert = wrap(invert);\n    canvas.toAlpha = wrap(toAlpha);\n\n    return canvas;\n};\nexports.splineInterpolate = splineInterpolate;\n\n// src/core\\matrix.script\n// from javax.media.jai.PerspectiveTransform\n\nfunction getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\n    let dx1 = x1 - x2;\n    let dy1 = y1 - y2;\n    let dx2 = x3 - x2;\n    let dy2 = y3 - y2;\n    let dx3 = x0 - x1 + x2 - x3;\n    let dy3 = y0 - y1 + y2 - y3;\n    let det = dx1*dy2 - dx2*dy1;\n    let a = (dx3*dy2 - dx2*dy3) / det;\n    let b = (dx1*dy3 - dx3*dy1) / det;\n    return [\n        x1 - x0 + a*x1, y1 - y0 + a*y1, a,\n        x3 - x0 + b*x3, y3 - y0 + b*y3, b,\n        x0, y0, 1\n    ];\n}\n\nfunction getInverse(m) {\n    let a = m[0], b = m[1], c = m[2];\n    let d = m[3], e = m[4], f = m[5];\n    let g = m[6], h = m[7], i = m[8];\n    let det = a*e*i - a*f*h - b*d*i + b*f*g + c*d*h - c*e*g;\n    return [\n        (e*i - f*h) / det, (c*h - b*i) / det, (b*f - c*e) / det,\n        (f*g - d*i) / det, (a*i - c*g) / det, (c*d - a*f) / det,\n        (d*h - e*g) / det, (b*g - a*h) / det, (a*e - b*d) / det\n    ];\n}\n\nfunction multiply(a, b) {\n    return [\n        a[0]*b[0] + a[1]*b[3] + a[2]*b[6],\n        a[0]*b[1] + a[1]*b[4] + a[2]*b[7],\n        a[0]*b[2] + a[1]*b[5] + a[2]*b[8],\n        a[3]*b[0] + a[4]*b[3] + a[5]*b[6],\n        a[3]*b[1] + a[4]*b[4] + a[5]*b[7],\n        a[3]*b[2] + a[4]*b[5] + a[5]*b[8],\n        a[6]*b[0] + a[7]*b[3] + a[8]*b[6],\n        a[6]*b[1] + a[7]*b[4] + a[8]*b[7],\n        a[6]*b[2] + a[7]*b[5] + a[8]*b[8]\n    ];\n}\n\n// src/core\\shader.script\nvar Shader = (function() {\n    function isArray(obj) {\n        return Object.prototype.toString.call(obj) == '[object Array]';\n    }\n\n    function isNumber(obj) {\n        return Object.prototype.toString.call(obj) == '[object Number]';\n    }\n\n    function compileSource(type, source, nameStr) {\n        let shader = gl.createShader(type);\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\n        }\n        return shader;\n    }\n\n    let defaultVertexSource = '\\\n    attribute vec2 vertex;\\\n    attribute vec2 _texCoord;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        texCoord = _texCoord;\\\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\n    }';\n\n    let defaultFragmentSource = '\\\n    uniform sampler2D texture;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        gl_FragColor = texture2D(texture, texCoord);\\\n    }';\n\n    // added test 2020-04-27 bitbof\n    let floatPrecision = null;\n    function testPrecisionSupport(precisionType) {\n        let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\n        return format !== null && format.precision !== 0;\n    }\n\n    function Shader(vertexSource?, fragmentSource?, nameStr?) {\n        this.vertexAttribute = null;\n        this.texCoordAttribute = null;\n        this.program = gl.createProgram();\n        vertexSource = vertexSource || defaultVertexSource;\n        fragmentSource = fragmentSource || defaultFragmentSource;\n        if (floatPrecision === null) {\n            floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\n        }\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\n        gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\n        gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\n        gl.linkProgram(this.program);\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\n        }\n    }\n\n    Shader.prototype.destroy = function() {\n        gl.deleteProgram(this.program);\n        this.program = null;\n    };\n\n    Shader.prototype.uniforms = function(uniforms) {\n        gl.useProgram(this.program);\n        for (var name in uniforms) {\n            if (!uniforms.hasOwnProperty(name)) continue;\n            let location = gl.getUniformLocation(this.program, name);\n            if (location === null) continue; // will be null if the uniform isn't used in the shader\n            let value = uniforms[name];\n            if (isArray(value)) {\n                switch (value.length) {\n                    case 1: gl.uniform1fv(location, new Float32Array(value)); break;\n                    case 2: gl.uniform2fv(location, new Float32Array(value)); break;\n                    case 3: gl.uniform3fv(location, new Float32Array(value)); break;\n                    case 4: gl.uniform4fv(location, new Float32Array(value)); break;\n                    case 9: gl.uniformMatrix3fv(location, false, new Float32Array(value)); break;\n                    case 16: gl.uniformMatrix4fv(location, false, new Float32Array(value)); break;\n                    default: throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\n                }\n            } else if (isNumber(value)) {\n                gl.uniform1f(location, value);\n            } else {\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\n            }\n        }\n        // allow chaining\n        return this;\n    };\n\n    // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\n    // even though floating point numbers represent the integers 0 through 7 exactly\n    Shader.prototype.textures = function(textures) {\n        gl.useProgram(this.program);\n        for (var name in textures) {\n            if (!textures.hasOwnProperty(name)) continue;\n            gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\n        }\n        // allow chaining\n        return this;\n    };\n\n    Shader.prototype.drawRect = function(left, top, right, bottom) {\n        let undefined;\n        let viewport = gl.getParameter(gl.VIEWPORT);\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n        if (gl.vertexBuffer == null) {\n            gl.vertexBuffer = gl.createBuffer();\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ left, top, left, bottom, right, top, right, bottom ]), gl.STATIC_DRAW);\n        if (gl.texCoordBuffer == null) {\n            gl.texCoordBuffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ 0, 0, 0, 1, 1, 0, 1, 1 ]), gl.STATIC_DRAW);\n        }\n        if (this.vertexAttribute == null) {\n            this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\n            gl.enableVertexAttribArray(this.vertexAttribute);\n        }\n        if (this.texCoordAttribute == null) {\n            this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\n            gl.enableVertexAttribArray(this.texCoordAttribute);\n        }\n        gl.useProgram(this.program);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    };\n\n    Shader.getDefaultShader = function() {\n        gl.defaultShader = gl.defaultShader || new Shader();\n        return gl.defaultShader;\n    };\n\n    return Shader;\n})();\n\n// src/core\\spline.script\n// from SplineInterpolator.cs in the Paint.NET source code\n\nfunction SplineInterpolator(points) {\n    let n = points.length;\n    this.xa = [];\n    this.ya = [];\n    this.u = [];\n    this.y2 = [];\n\n    points.sort(function(a, b) {\n        return a[0] - b[0];\n    });\n    for (var i = 0; i < n; i++) {\n        this.xa.push(points[i][0]);\n        this.ya.push(points[i][1]);\n    }\n\n    this.u[0] = 0;\n    this.y2[0] = 0;\n\n    for (var i = 1; i < n - 1; ++i) {\n        // This is the decomposition loop of the tridiagonal algorithm. \n        // y2 and u are used for temporary storage of the decomposed factors.\n        let wx = this.xa[i + 1] - this.xa[i - 1];\n        let sig = (this.xa[i] - this.xa[i - 1]) / wx;\n        let p = sig * this.y2[i - 1] + 2.0;\n\n        this.y2[i] = (sig - 1.0) / p;\n\n        let ddydx = \n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) - \n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n    }\n\n    this.y2[n - 1] = 0;\n\n    // This is the backsubstitution loop of the tridiagonal algorithm\n    for (var i = n - 2; i >= 0; --i) {\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n}\n\nSplineInterpolator.prototype.interpolate = function(x) {\n    let n = this.ya.length;\n    let klo = 0;\n    let khi = n - 1;\n\n    // We will find the right place in the table by means of\n    // bisection. This is optimal if sequential calls to this\n    // routine are at random values of x. If sequential calls\n    // are in order, and closely spaced, one would do better\n    // to store previous values of klo and khi.\n    while (khi - klo > 1) {\n        let k = (khi + klo) >> 1;\n\n        if (this.xa[k] > x) {\n            khi = k; \n        } else {\n            klo = k;\n        }\n    }\n\n    let h = this.xa[khi] - this.xa[klo];\n    let a = (this.xa[khi] - x) / h;\n    let b = (x - this.xa[klo]) / h;\n\n    // Cubic spline polynomial is now evaluated.\n    return a * this.ya[klo] + b * this.ya[khi] + \n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n};\n\n// src/core\\texture.script\nvar Texture = (function() {\n    Texture.fromElement = function(element) {\n        let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\n        texture.loadContentsOf(element);\n        return texture;\n    };\n\n    function Texture(width, height, format, type) {\n        this.gl = gl;\n        this.id = gl.createTexture();\n        this.width = width;\n        this.height = height;\n        this.format = format;\n        this.type = type;\n\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n    }\n\n    Texture.prototype.loadContentsOf = function(element) {\n        this.width = element.width || element.videoWidth;\n        this.height = element.height || element.videoHeight;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\n    };\n\n    Texture.prototype.initFromBytes = function(width, height, data) {\n        this.width = width;\n        this.height = height;\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\n    };\n\n    Texture.prototype.destroy = function() {\n        gl.deleteTexture(this.id);\n        this.id = null;\n    };\n\n    Texture.prototype.use = function(unit) {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n    };\n\n    Texture.prototype.unuse = function(unit) {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    };\n\n    Texture.prototype.ensureFormat = function(width, height, format, type) {\n        // allow passing an existing texture instead of individual arguments\n        if (arguments.length == 1) {\n            let texture = arguments[0];\n            width = texture.width;\n            height = texture.height;\n            format = texture.format;\n            type = texture.type;\n        }\n\n        // change the format only if required\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n    };\n\n    Texture.prototype.drawTo = function(callback) {\n        // start rendering to this texture\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            throw new Error('incomplete framebuffer');\n        }\n        gl.viewport(0, 0, this.width, this.height);\n\n        // do the drawing\n        callback();\n\n        // stop rendering to this texture\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    };\n\n    let canvas = null;\n\n    function getCanvas(texture) {\n        if (canvas == null) canvas = document.createElement('canvas');\n        canvas.width = texture.width;\n        canvas.height = texture.height;\n        let c = canvas.getContext('2d');\n        c.clearRect(0, 0, canvas.width, canvas.height);\n        return c;\n    }\n\n    Texture.prototype.fillUsingCanvas = function(callback) {\n        callback(getCanvas(this));\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\n        return this;\n    };\n\n    Texture.prototype.toImage = function(image) {\n        this.use();\n        Shader.getDefaultShader().drawRect();\n        let size = this.width * this.height * 4;\n        let pixels = new Uint8Array(size);\n        let c = getCanvas(this);\n        let data = c.createImageData(this.width, this.height);\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n        for (var i = 0; i < size; i++) {\n            data.data[i] = pixels[i];\n        }\n        c.putImageData(data, 0, 0);\n        image.src = canvas.toDataURL();\n    };\n\n    Texture.prototype.swapWith = function(other) {\n        let temp;\n        temp = other.id; other.id = this.id; this.id = temp;\n        temp = other.width; other.width = this.width; this.width = temp;\n        temp = other.height; other.height = this.height; this.height = temp;\n        temp = other.format; other.format = this.format; this.format = temp;\n    };\n\n    return Texture;\n})();\n\n// src/filters\\common.script\nfunction warpShader(uniforms, warp) {\n    return new Shader(null, uniforms + '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        vec2 coord = texCoord * texSize;\\\n        ' + warp + '\\\n        gl_FragColor = texture2D(texture, coord / texSize);\\\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\n        if (coord != clampedCoord) {\\\n            /* fade to transparent if we are outside the image */\\\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\n        }\\\n    }', 'warp');\n}\n\n// returns a random number between 0 and 1\nvar randomShaderFunc = '\\\n    float random(vec3 scale, float seed) {\\\n        /* use the fragment position for a different seed per-pixel */\\\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\n    }\\\n';\n\n// src/filters\\adjust\\brightnesscontrast.script\n/**\n * @filter           Brightness / Contrast\n * @description      Provides additive brightness and multiplicative contrast control.\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nfunction brightnessContrast(brightness, contrast) {\n    gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float brightness;\\\n        uniform float contrast;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.rgb += brightness;\\\n            if (contrast > 0.0) {\\\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\n            } else {\\\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\n            }\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'brightnessContrast');\n\n    simpleShader.call(this, gl.brightnessContrast, {\n        brightness: clamp(-1, brightness, 1),\n        contrast: clamp(-1, contrast, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\curves.script\nfunction splineInterpolate(points) {\n    let interpolator = new SplineInterpolator(points);\n    let array = [];\n    for (var i = 0; i < 256; i++) {\n        array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\n    }\n    return array;\n}\n\n/**\n * @filter      Curves\n * @description A powerful mapping tool that transforms the colors in the image\n *              by an arbitrary function. The function is interpolated between\n *              a set of 2D points using splines. The curves filter can take\n *              either one or three arguments which will apply the mapping to\n *              either luminance or RGB values, respectively.\n * @param red   A list of points that define the function for the red channel.\n *              Each point is a list of two values: the value before the mapping\n *              and the value after the mapping, both in the range 0 to 1. For\n *              example, [[0,1], [1,0]] would invert the red channel while\n *              [[0,0], [1,1]] would leave the red channel unchanged. If green\n *              and blue are omitted then this argument also applies to the\n *              green and blue channels.\n * @param green (optional) A list of points that define the function for the green\n *              channel (just like for red).\n * @param blue  (optional) A list of points that define the function for the blue\n *              channel (just like for red).\n */\nfunction curves(red, green, blue) {\n    // Create the ramp texture\n    red = splineInterpolate(red);\n    if (arguments.length == 1) {\n        green = blue = red;\n    } else {\n        green = splineInterpolate(green);\n        blue = splineInterpolate(blue);\n    }\n    let array = [];\n    for (var i = 0; i < 256; i++) {\n        array.splice(array.length, 0, red[i], green[i], blue[i], 255);\n    }\n    this._.extraTexture.initFromBytes(256, 1, array);\n    this._.extraTexture.use(1);\n\n    gl.curves = gl.curves || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform sampler2D map;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.r = texture2D(map, vec2(color.r)).r;\\\n            color.g = texture2D(map, vec2(color.g)).g;\\\n            color.b = texture2D(map, vec2(color.b)).b;\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'curves');\n\n    gl.curves.textures({\n        map: 1\n    });\n    simpleShader.call(this, gl.curves, {});\n\n    return this;\n}\n\n// src/filters\\adjust\\denoise.script\n/**\n * @filter         Denoise\n * @description    Smooths over grainy noise in dark images using an 9x9 box filter\n *                 weighted by color intensity, similar to a bilateral filter.\n * @param exponent The exponent of the color intensity difference, should be greater\n *                 than zero. A value of zero just gives an 9x9 box blur and high values\n *                 give the original image, but ideal values are usually around 10-20.\n */\nfunction denoise(exponent) {\n    // Do a 9x9 bilateral box filter\n    gl.denoise = gl.denoise || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float exponent;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 center = texture2D(texture, texCoord);\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\n                    weight = pow(weight, exponent);\\\n                    color += sample * weight;\\\n                    total += weight;\\\n                }\\\n            }\\\n            gl_FragColor = color / total;\\\n        }\\\n    ', 'denoise');\n\n    // Perform two iterations for stronger results\n    for (var i = 0; i < 2; i++) {\n        simpleShader.call(this, gl.denoise, {\n            exponent: Math.max(0, exponent),\n            texSize: [this.width, this.height]\n        });\n    }\n\n    return this;\n}\n\n// src/filters\\adjust\\huesaturation.script\n/**\n * @filter           Hue / Saturation\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\n *                   can be imagined as a cube where the axes are the red, green, and blue color\n *                   values. Hue changing works by rotating the color vector around the grayscale\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\n *                   Saturation is implemented by scaling all color channel values either toward\n *                   or away from the average color channel value.\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\n *                   and 1 is 180 degree rotation in the positive direction)\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nfunction hueSaturation(hue, saturation) {\n    gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float hue;\\\n        uniform float saturation;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\n            float angle = hue * 3.14159265;\\\n            float s = sin(angle), c = cos(angle);\\\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\n            float len = length(color.rgb);\\\n            color.rgb = vec3(\\\n                dot(color.rgb, weights.xyz),\\\n                dot(color.rgb, weights.zxy),\\\n                dot(color.rgb, weights.yzx)\\\n            );\\\n            \\\n            /* saturation adjustment */\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            if (saturation > 0.0) {\\\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\n            } else {\\\n                color.rgb += (average - color.rgb) * (-saturation);\\\n            }\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'hueSaturation');\n\n    simpleShader.call(this, gl.hueSaturation, {\n        hue: clamp(-1, hue, 1),\n        saturation: clamp(-1, saturation, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\noise.script\n/**\n * @filter         Noise\n * @description    Adds black and white noise to the image.\n * @param amount   0 to 1 (0 for no effect, 1 for maximum noise)\n */\nfunction noise(amount) {\n    gl.noise = gl.noise || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        float rand(vec2 co) {\\\n            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\\\n        }\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            float diff = (rand(texCoord) - 0.5) * amount;\\\n            color.r += diff;\\\n            color.g += diff;\\\n            color.b += diff;\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'noise');\n\n    simpleShader.call(this, gl.noise, {\n        amount: clamp(0, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\sepia.script\n/**\n * @filter         Sepia\n * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\n * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\n */\nfunction sepia(amount) {\n    gl.sepia = gl.sepia || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float r = color.r;\\\n            float g = color.g;\\\n            float b = color.b;\\\n            \\\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'sepia');\n\n    simpleShader.call(this, gl.sepia, {\n        amount: clamp(0, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\unsharpmask.script\n/**\n * @filter         Unsharp Mask\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\n *                 is implemented by scaling pixels away from the average of their neighbors.\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\n */\nfunction unsharpMask(radius, strength) {\n    gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\n        uniform sampler2D blurredTexture;\\\n        uniform sampler2D originalTexture;\\\n        uniform float strength;\\\n        uniform float threshold;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\n            vec4 original = texture2D(originalTexture, texCoord);\\\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\n        }\\\n    ', 'unsharpMask');\n\n    // Store a copy of the current texture in the second texture unit\n    this._.extraTexture.ensureFormat(this._.texture);\n    this._.texture.use();\n    this._.extraTexture.drawTo(function() {\n        Shader.getDefaultShader().drawRect();\n    });\n\n    // Blur the current texture, then use the stored texture to detect edges\n    this._.extraTexture.use(1);\n    this.triangleBlur(radius);\n    gl.unsharpMask.textures({\n        originalTexture: 1\n    });\n    simpleShader.call(this, gl.unsharpMask, {\n        strength: strength\n    });\n    this._.extraTexture.unuse(1);\n\n    return this;\n}\n\n// src/filters\\adjust\\vibrance.script\n/**\n * @filter       Vibrance\n * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\n * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\n */\nfunction vibrance(amount) {\n    gl.vibrance = gl.vibrance || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            float mx = max(color.r, max(color.g, color.b));\\\n            float amt = (mx - average) * (-amount * 3.0);\\\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'vibrance');\n\n    simpleShader.call(this, gl.vibrance, {\n        amount: clamp(-1, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\vignette.script\n/**\n * @filter         Vignette\n * @description    Adds a simulated lens edge darkening effect.\n * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\n * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\n */\nfunction vignette(size, amount) {\n    gl.vignette = gl.vignette || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float size;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'vignette');\n\n    simpleShader.call(this, gl.vignette, {\n        size: clamp(0, size, 1),\n        amount: clamp(0, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\lensblur.script\n/**\n * @filter           Lens Blur\n * @description      Imitates a camera capturing the image out of focus by using a blur that generates\n *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\n *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\n *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\n *                   can be separated into three rhombi, each of which is just a skewed box blur.\n *                   This filter makes use of the floating point texture WebGL extension to implement\n *                   the brightness parameter, so there will be severe visual artifacts if brightness\n *                   is non-zero and the floating point texture extension is not available. The\n *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\n *                   brightness parameter that fakes what would otherwise come from a HDR source.\n * @param radius     the radius of the hexagonal disk convolved with the image\n * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\n * @param angle      the rotation of the bokeh in radians\n */\nfunction lensBlur(radius, brightness, angle) {\n    // All averaging is done on values raised to a power to make more obvious bokeh\n    // (we will raise the average to the inverse power at the end to compensate).\n    // Without this the image looks almost like a normal blurred image. This hack is\n    // obviously not realistic, but to accurately simulate this we would need a high\n    // dynamic range source photograph which we don't have.\n    gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float power;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color = pow(color, vec4(power));\\\n            gl_FragColor = vec4(color);\\\n        }\\\n    ', 'lensBlurPrePass');\n\n    let common = '\\\n        uniform sampler2D texture0;\\\n        uniform sampler2D texture1;\\\n        uniform vec2 delta0;\\\n        uniform vec2 delta1;\\\n        uniform float power;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        vec4 sample(vec2 delta) {\\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\n            \\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            for (float t = 0.0; t <= 30.0; t++) {\\\n                float percent = (t + offset) / 30.0;\\\n                color += texture2D(texture0, texCoord + delta * percent);\\\n                total += 1.0;\\\n            }\\\n            return color / total;\\\n        }\\\n    ';\n\n    gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\n        void main() {\\\n            gl_FragColor = sample(delta0);\\\n        }\\\n    ', 'lensBlur0');\n    gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\n        void main() {\\\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\n        }\\\n    ', 'lensBlur1');\n    gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\n        void main() {\\\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\n            gl_FragColor = pow(color, vec4(power));\\\n        }\\\n    ', 'lensBlur2').textures({ texture1: 1 });\n\n    // Generate\n    let dir = [];\n    for (var i = 0; i < 3; i++) {\n        let a = angle + i * Math.PI * 2 / 3;\n        dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\n    }\n    let power = Math.pow(10, clamp(-1, brightness, 1));\n\n    // Remap the texture values, which will help make the bokeh effect\n    simpleShader.call(this, gl.lensBlurPrePass, {\n        power: power\n    });\n\n    // Blur two rhombi in parallel into extraTexture\n    this._.extraTexture.ensureFormat(this._.texture);\n    simpleShader.call(this, gl.lensBlur0, {\n        delta0: dir[0]\n    }, this._.texture, this._.extraTexture);\n    simpleShader.call(this, gl.lensBlur1, {\n        delta0: dir[1],\n        delta1: dir[2]\n    }, this._.extraTexture, this._.extraTexture);\n\n    // Blur the last rhombus and combine with extraTexture\n    simpleShader.call(this, gl.lensBlur0, {\n        delta0: dir[1]\n    });\n    this._.extraTexture.use(1);\n    simpleShader.call(this, gl.lensBlur2, {\n        power: 1 / power,\n        delta0: dir[2]\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\tiltshift.script\n/**\n * @filter               Tilt Shift\n * @description          Simulates the shallow depth of field normally encountered in close-up\n *                       photography, which makes the scene seem much smaller than it actually\n *                       is. This filter assumes the scene is relatively planar, in which case\n *                       the part of the scene that is completely in focus can be described by\n *                       a line (the intersection of the focal plane and the scene). An example\n *                       of a planar scene might be looking at a road from above at a downward\n *                       angle. The image is then blurred with a blur radius that starts at zero\n *                       on the line and increases further from the line.\n * @param startX         The x coordinate of the start of the line segment.\n * @param startY         The y coordinate of the start of the line segment.\n * @param endX           The x coordinate of the end of the line segment.\n * @param endY           The y coordinate of the end of the line segment.\n * @param blurRadius     The maximum radius of the pyramid blur.\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\n */\nfunction tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\n    gl.tiltShift = gl.tiltShift || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float blurRadius;\\\n        uniform float gradientRadius;\\\n        uniform vec2 start;\\\n        uniform vec2 end;\\\n        uniform vec2 delta;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'tiltShift');\n\n    let dx = endX - startX;\n    let dy = endY - startY;\n    let d = Math.sqrt(dx * dx + dy * dy);\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [dx / d, dy / d],\n        texSize: [this.width, this.height]\n    });\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [-dy / d, dx / d],\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\triangleblur.script\n/**\n * @filter       Triangle Blur\n * @description  This is the most basic blur filter, which convolves the image with a\n *               pyramid filter. The pyramid filter is separable and is applied as two\n *               perpendicular triangle filters.\n * @param radius The radius of the pyramid convolved with the image.\n */\nfunction triangleBlur(radius) {\n    gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'triangleBlur');\n\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [radius / this.width, 0]\n    });\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [0, radius / this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\zoomblur.script\n/**\n * @filter         Zoom Blur\n * @description    Blurs the image away from a certain point, which looks like radial motion blur.\n * @param centerX  The x coordinate of the blur origin.\n * @param centerY  The y coordinate of the blur origin.\n * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\n *                 where 0 doesn't change the image and 1 creates a highly blurred image.\n */\nfunction zoomBlur(centerX, centerY, strength) {\n    gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            vec2 toCenter = center - texCoord * texSize;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = 0.0; t <= 40.0; t++) {\\\n                float percent = (t + offset) / 40.0;\\\n                float weight = 4.0 * (percent - percent * percent);\\\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'zoomBlur');\n\n    simpleShader.call(this, gl.zoomBlur, {\n        center: [centerX, centerY],\n        strength: strength,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\colorhalftone.script\n/**\n * @filter        Color Halftone\n * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\n *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\n *                and black.\n * @param centerX The x coordinate of the pattern origin.\n * @param centerY The y coordinate of the pattern origin.\n * @param angle   The rotation of the pattern in radians.\n * @param size    The diameter of a dot in pixels.\n */\nfunction colorHalftone(centerX, centerY, angle, size) {\n    gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float angle;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        \\\n        float pattern(float angle) {\\\n            float s = sin(angle), c = cos(angle);\\\n            vec2 tex = texCoord * texSize - center;\\\n            vec2 point = vec2(\\\n                c * tex.x - s * tex.y,\\\n                s * tex.x + c * tex.y\\\n            ) * scale;\\\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\n        }\\\n        \\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            vec3 cmy = 1.0 - color.rgb;\\\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\n            cmy = (cmy - k) / (1.0 - k);\\\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\n        }\\\n    ', 'colorHalftone');\n\n    simpleShader.call(this, gl.colorHalftone, {\n        center: [centerX, centerY],\n        angle: angle,\n        scale: Math.PI / size,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\dotscreen.script\n/**\n * @filter        Dot Screen\n * @description   Simulates a black and white halftone rendering of the image by multiplying\n *                pixel values with a rotated 2D sine wave pattern.\n * @param centerX The x coordinate of the pattern origin.\n * @param centerY The y coordinate of the pattern origin.\n * @param angle   The rotation of the pattern in radians.\n * @param size    The diameter of a dot in pixels.\n */\nfunction dotScreen(centerX, centerY, angle, size) {\n    gl.dotScreen = gl.dotScreen || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float angle;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        \\\n        float pattern() {\\\n            float s = sin(angle), c = cos(angle);\\\n            vec2 tex = texCoord * texSize - center;\\\n            vec2 point = vec2(\\\n                c * tex.x - s * tex.y,\\\n                s * tex.x + c * tex.y\\\n            ) * scale;\\\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\n        }\\\n        \\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\n        }\\\n    ', 'dotScreen');\n\n    simpleShader.call(this, gl.dotScreen, {\n        center: [centerX, centerY],\n        angle: angle,\n        scale: Math.PI / size,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\edgework.script\n/**\n * @filter       Edge Work\n * @description  Picks out different frequencies in the image by subtracting two\n *               copies of the image blurred with different radii.\n * @param radius The radius of the effect in pixels.\n */\nfunction edgeWork(radius) {\n    gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec2 color = vec2(0.0);\\\n            vec2 total = vec2(0.0);\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\n                color.x += average * weight;\\\n                total.x += weight;\\\n                if (abs(t) < 15.0) {\\\n                    weight = weight * 2.0 - 1.0;\\\n                    color.y += average * weight;\\\n                    total.y += weight;\\\n                }\\\n            }\\\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\n        }\\\n    ', 'edgeWork1');\n    gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec2 color = vec2(0.0);\\\n            vec2 total = vec2(0.0);\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\n                color.x += sample.x * weight;\\\n                total.x += weight;\\\n                if (abs(t) < 15.0) {\\\n                    weight = weight * 2.0 - 1.0;\\\n                    color.y += sample.y * weight;\\\n                    total.y += weight;\\\n                }\\\n            }\\\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\n            gl_FragColor = vec4(c, c, c, 1.0);\\\n        }\\\n    ', 'edgeWork2');\n\n    simpleShader.call(this, gl.edgeWork1, {\n        delta: [radius / this.width, 0]\n    });\n    simpleShader.call(this, gl.edgeWork2, {\n        delta: [0, radius / this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\hexagonalpixelate.script\n/**\n * @filter        Hexagonal Pixelate\n * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\n *                are nearest-neighbor sampled from the centers of the tiles.\n * @param centerX The x coordinate of the pattern center.\n * @param centerY The y coordinate of the pattern center.\n * @param scale   The width of an individual tile, in pixels.\n */\nfunction hexagonalPixelate(centerX, centerY, scale) {\n    gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec2 tex = (texCoord * texSize - center) / scale;\\\n            tex.y /= 0.866025404;\\\n            tex.x -= tex.y * 0.5;\\\n            \\\n            vec2 a;\\\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\n            \\\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\n            \\\n            float alen = length(TEX - A);\\\n            float blen = length(TEX - B);\\\n            float clen = length(TEX - C);\\\n            \\\n            vec2 choice;\\\n            if (alen < blen) {\\\n                if (alen < clen) choice = a;\\\n                else choice = c;\\\n            } else {\\\n                if (blen < clen) choice = b;\\\n                else choice = c;\\\n            }\\\n            \\\n            choice.x += choice.y * 0.5;\\\n            choice.y *= 0.866025404;\\\n            choice *= scale / texSize;\\\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\n        }\\\n    ', 'hexagonalPixelate');\n\n    simpleShader.call(this, gl.hexagonalPixelate, {\n        center: [centerX, centerY],\n        scale: scale,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\ink.script\n/**\n * @filter         Ink\n * @description    Simulates outlining the image in ink by darkening edges stronger than a\n *                 certain threshold. The edge detection value is the difference of two\n *                 copies of the image, each blurred using a blur of a different radius.\n * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\n *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\n *                 of black edges. Negative strength values will create white ink edges\n *                 instead of black ones.\n */\nfunction ink(strength) {\n    gl.ink = gl.ink || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float bigTotal = 0.0;\\\n            float smallTotal = 0.0;\\\n            vec3 bigAverage = vec3(0.0);\\\n            vec3 smallAverage = vec3(0.0);\\\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\n                    bigAverage += sample;\\\n                    bigTotal += 1.0;\\\n                    if (abs(x) + abs(y) < 2.0) {\\\n                        smallAverage += sample;\\\n                        smallTotal += 1.0;\\\n                    }\\\n                }\\\n            }\\\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\n        }\\\n    ', 'ink');\n\n    simpleShader.call(this, gl.ink, {\n        strength: strength * strength * strength * strength * strength,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\warp\\bulgepinch.script\n/**\n * @filter         Bulge / Pinch\n * @description    Bulges or pinches the image in a circle.\n * @param centerX  The x coordinate of the center of the circle of effect.\n * @param centerY  The y coordinate of the center of the circle of effect.\n * @param radius   The radius of the circle of effect.\n * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\n */\nfunction bulgePinch(centerX, centerY, radius, strength) {\n    gl.bulgePinch = gl.bulgePinch || warpShader('\\\n        uniform float radius;\\\n        uniform float strength;\\\n        uniform vec2 center;\\\n    ', '\\\n        coord -= center;\\\n        float distance = length(coord);\\\n        if (distance < radius) {\\\n            float percent = distance / radius;\\\n            if (strength > 0.0) {\\\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\n            } else {\\\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\n            }\\\n        }\\\n        coord += center;\\\n    ');\n\n    simpleShader.call(this, gl.bulgePinch, {\n        radius: radius,\n        strength: clamp(-1, strength, 1),\n        center: [centerX, centerY],\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\warp\\matrixwarp.script\n/**\n * @filter                Matrix Warp\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\n *                        3x3 matrix, where x and y are in units of pixels.\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\n * @param inverse         A boolean value that, when true, applies the inverse transformation\n *                        instead. (optional, defaults to false)\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\n *                        instead of screen-space coordinates. Texture-space coordinates range\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\n *                        to use for simple operations like flipping and rotating.\n */\nfunction matrixWarp(matrix, inverse, useTextureSpace) {\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\n        uniform mat3 matrix;\\\n        uniform bool useTextureSpace;\\\n    ', '\\\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\n        vec3 warp = matrix * vec3(coord, 1.0);\\\n        coord = warp.xy / warp.z;\\\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\n    ');\n\n    // Flatten all members of matrix into one big list\n    matrix = Array.prototype.concat.apply([], matrix);\n\n    // Extract a 3x3 matrix out of the arguments\n    if (matrix.length == 4) {\n        matrix = [\n            matrix[0], matrix[1], 0,\n            matrix[2], matrix[3], 0,\n            0, 0, 1\n        ];\n    } else if (matrix.length != 9) {\n        throw 'can only warp with 2x2 or 3x3 matrix';\n    }\n\n    simpleShader.call(this, gl.matrixWarp, {\n        matrix: inverse ? getInverse(matrix) : matrix,\n        texSize: [this.width, this.height],\n        useTextureSpace: useTextureSpace | 0\n    });\n\n    return this;\n}\n\n// src/filters\\warp\\perspective.script\n/**\n * @filter       Perspective\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\n * @param before The x and y coordinates of four points before the transform in a flat list. This\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\n *               (cx, cy), and (dx, dy).\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\n *               like the other argument.\n */\nfunction perspective(before, after) {\n    let a = getSquareToQuad.apply(null, after);\n    let b = getSquareToQuad.apply(null, before);\n    let c = multiply(getInverse(a), b);\n    return this.matrixWarp(c);\n}\n\n// src/filters\\warp\\swirl.script\n/**\n * @filter        Swirl\n * @description   Warps a circular region of the image in a swirl.\n * @param centerX The x coordinate of the center of the circular region.\n * @param centerY The y coordinate of the center of the circular region.\n * @param radius  The radius of the circular region.\n * @param angle   The angle in radians that the pixels in the center of\n *                the circular region will be rotated by.\n */\nfunction swirl(centerX, centerY, radius, angle) {\n    gl.swirl = gl.swirl || warpShader('\\\n        uniform float radius;\\\n        uniform float angle;\\\n        uniform vec2 center;\\\n    ', '\\\n        coord -= center;\\\n        float distance = length(coord);\\\n        if (distance < radius) {\\\n            float percent = (radius - distance) / radius;\\\n            float theta = percent * percent * angle;\\\n            float s = sin(theta);\\\n            float c = cos(theta);\\\n            coord = vec2(\\\n                coord.x * c - coord.y * s,\\\n                coord.x * s + coord.y * c\\\n            );\\\n        }\\\n        coord += center;\\\n    ');\n\n    simpleShader.call(this, gl.swirl, {\n        radius: radius,\n        center: [centerX, centerY],\n        angle: angle,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n/**\n * @filter        Invert\n * @description   Inverts color of each pixel\n */\nfunction invert() {\n    gl.invert = gl.invert || new Shader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);\\\n    }\\\n', 'invert');\n\n    simpleShader.call(this, gl.invert, {\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n/**\n * @filter        To Alpha\n * @description   Generates alpha channel from luminance (r+g+b)\n * @param isInverted    boolean - invert luminance\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\n */\nfunction toAlpha(isInverted, replaceRGBA) {\n    gl.toAlpha = gl.toAlpha || new Shader(null, '\\\n    uniform bool isInverted;\\\n    uniform vec4 replace;\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\n        if (isInverted) alpha = 1.0 - alpha;\\\n        alpha = min(color.a, alpha);\\\n        if (replace.a > 0.0) color = replace;\\\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\n    }\\\n', 'toAlpha');\n\n    simpleShader.call(this, gl.toAlpha, {\n        isInverted: isInverted ? 1 : 0,\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0,0,0,0],\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n\nreturn exports;\n})();\n","import {BB} from '../../bb/bb';\nimport {input} from '../ui/base-components/input';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {Cropper} from '../ui/components/cropper';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const cropExtend = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        const canvas = params.canvas;\n        if (!canvas)\n            return false;\n        const tempCanvas = BB.canvas();\n        {\n            let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 560, 400, 1);\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n            let previewFactor = w / canvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = 'block';\n            tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n\n        const div = document.createElement(\"div\");\n        const result: any = {\n            element: div\n        };\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\n        let left = 0, right = 0, top = 0, bottom = 0;\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        let scale;\n\n\n\n        // --- input elements ---\n\n        const lrWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'}\n        });\n        const tbWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'}\n        });\n        div.appendChild(lrWrapper);\n        div.appendChild(tbWrapper);\n\n        const leftInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                leftChanged = true;\n                updateInput();\n            }\n        });\n        const rightInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px'},\n            callback: function(v) {\n                rightChanged = true;\n                updateInput();\n            }\n        });\n        const topInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                topChanged = true;\n                updateInput();\n            }\n        });\n        const bottomInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px'},\n            callback: function(v) {\n                bottomChanged = true;\n                updateInput();\n            }\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            width: '60px'\n        };\n        lrWrapper.append(\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\n            leftInput,\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\n            rightInput\n        );\n        tbWrapper.append(\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\n            topInput,\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\n            bottomInput\n        );\n\n        function updateInput() {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            let newWidth = canvas.getWidth() + left + right;\n            let newHeight = canvas.getHeight() + top + bottom;\n\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -canvas.getWidth() - right + 1;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -canvas.getWidth() - left + 1;\n                    rightInput.value = '' + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -canvas.getWidth() - right + maxWidth;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -canvas.getWidth() - left + maxWidth;\n                    rightInput.value = '' + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -canvas.getHeight() - bottom + 1;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -canvas.getHeight() - top + 1;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -canvas.getHeight() - bottom + maxHeight;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -canvas.getHeight() - top + maxHeight;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight\n            });\n\n\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        }\n\n        let useRuleOfThirds = true;\n        let ruleOThirdsCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-crop-rule-thirds'),\n            allowTab: true,\n            callback: function(b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            }\n        });\n        div.appendChild(BB.el({\n            css: {\n                clear: 'both'\n            }\n        }));\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 0},\n            {r: 255, g: 255, b: 255, a: 1},\n            {r: 0, g: 0, b: 0, a: 1}\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n\n        const colorOptions = new ColorOptions({\n            label: LANG('filter-crop-fill'),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                updateBg(rgbaObj);\n            }\n        });\n\n\n        const flexRow = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between'\n            }\n        });\n        div.appendChild(flexRow);\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\n        flexRow.appendChild(colorOptions.getElement());\n\n\n        // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update(transform) {\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\n\n            tempCanvas.style.width = canvas.getWidth() * scale + \"px\";\n            tempCanvas.style.height = canvas.getHeight() * scale + \"px\";\n\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\n\n            left = parseInt('' + -transform.x);\n            top = parseInt('' + -transform.y);\n            right = parseInt('' + (transform.x + transform.width - canvas.getWidth()));\n            bottom = parseInt('' + (transform.y + transform.height - canvas.getHeight()));\n            leftInput.value = '' + left;\n            topInput.value = '' + top;\n            rightInput.value = '' + right;\n            bottomInput.value = '' + bottom;\n\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                previewWrapper.style.background = \"url(\" + url + \")\";\n                if (selectedRgbaObj.a !== 0) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                }\n            });\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\n\n            cropper.setScale(scale);\n        }\n\n        const previewWrapper = BB.el({\n            css: {\n                width: \"340px\",\n                marginTop: '10px',\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                position: \"relative\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                userSelect: 'none',\n                colorScheme: 'only light',\n                touchAction: 'none',\n            }\n        });\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        const bgColorOverlay = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0'\n            }\n        });\n        previewWrapper.appendChild(bgColorOverlay);\n\n        const offsetWrapper = document.createElement(\"div\");\n        offsetWrapper.style.position = \"absolute\";\n        offsetWrapper.style.left = \"0px\";\n        offsetWrapper.style.top = \"0px\";\n        previewWrapper.appendChild(offsetWrapper);\n\n\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\n        canvasWrapper.appendChild(tempCanvas);\n        //tempCanvas.style.width = w + \"px\";\n        //tempCanvas.style.height = h + \"px\";\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\n        tempCanvas.style.position = \"absolute\";\n        tempCanvas.style.left = \"0px\";\n        tempCanvas.style.top = \"0px\";\n\n        div.appendChild(previewWrapper);\n        const cropper = new Cropper({\n            x: 0,\n            y: 0,\n            width: canvas.getWidth(),\n            height: canvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight\n        });\n        update(cropper.getTransform());\n        offsetWrapper.appendChild(cropper.getElement());\n\n        function updateBg(rgbaObj) {\n\n            let borderColor;\n            if (rgbaObj.a === 0) {\n                borderColor = 'rgba(0,0,0,0.5)';\n                bgColorOverlay.style.background = '';\n                tempCanvas.style.background = '';\n            } else {\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\n\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                });\n            }\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\n        }\n\n        result.destroy = () => {\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        const canvas = params.canvas;\n        const history = params.history;\n        if (!canvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\n            return false;\n        }\n        history.pause(true);\n        canvas.resizeCanvas(params.input);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"cropExtend\"],\n            action: \"apply\",\n            params: [{\n                input: JSON.parse(JSON.stringify(params.input))\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {Options} from '../ui/base-components/options';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glCurves = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div,\n        };\n        let klCanvasPreview;\n\n        function finishInit() {\n\n            let previewFactor = w / context.canvas.width;\n            let brightness = 0, contrast = 0;\n\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\n\n            let curves = {\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n            };\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            function update() {\n                try {\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n                    if (klCanvasPreview) {\n                        klCanvasPreview.render();\n                    }\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }\n\n            let modeButtons;\n\n            function CurvesInput(p) {\n                let div = document.createElement(\"div\");\n                div.oncontextmenu = function () {\n                    return false;\n                };\n                div.style.position = \"relative\";\n                div.style.marginBottom = \"10px\";\n                let mode = \"All\";\n                let curves = p.curves;\n                modeButtons = new Options( {\n                    optionArr: [\n                        {\n                            id: 'All',\n                            label: LANG('filter-curves-all')\n                        },\n                        {\n                            id: 'Red',\n                            label: LANG('red')\n                        },\n                        {\n                            id: 'Green',\n                            label: LANG('green')\n                        },\n                        {\n                            id: 'Blue',\n                            label: LANG('blue')\n                        },\n                    ],\n                    initialId: 'All',\n                    onChange: function(id) {\n                        mode = id;\n                        if (mode === \"All\") {\n                            curves = {\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                            };\n                        }\n                        let curve = curves.r;\n                        if (mode === \"Green\") {\n                            curve = curves.g;\n                        }\n                        if (mode === \"Blue\") {\n                            curve = curves.b;\n                        }\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\n\n                        update();\n                    }\n                });\n                div.appendChild(modeButtons.getElement());\n\n                let curveArea = document.createElement(\"div\");\n                BB.css(curveArea, {\n                    position: 'relative',\n                    marginTop: '10px',\n                    colorScheme: 'only light',\n                })\n                div.appendChild(curveArea);\n\n                let areaw = 300, areah = 100;\n                let canvas = BB.canvas(areaw, areah);\n                BB.css(canvas, {\n                    background: \"#c6c6c6\",\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\n                });\n                let ctx = canvas.getContext(\"2d\");\n                curveArea.appendChild(canvas);\n\n                let points = {\n                    r: [],\n                    g: [],\n                    b: []\n                };\n\n                function fit(v) {\n                    return Math.max(0, Math.min(1, v));\n                }\n\n                function createPoint(x, y, callback, lock?) {\n                    let gripSize = 14;\n                    let internalY = y, internalX = x;\n                    let point = document.createElement(\"div\");\n                    BB.css(point, {\n                        position: \"absolute\",\n                        left: (x - gripSize / 2) + \"px\",\n                        top: (y - gripSize / 2) + \"px\",\n                        width: gripSize + \"px\",\n                        height: gripSize + \"px\",\n                        background: \"#fff\",\n                        cursor: \"move\",\n                        borderRadius: gripSize + \"px\",\n                        boxShadow: \"inset 0 0 0 2px #000\",\n                        userSelect: 'none',\n                        touchAction: 'none',\n                    });\n\n                    function update() {\n                        BB.css(point, {\n                            left: (x - gripSize / 2) + \"px\",\n                            top: (y - gripSize / 2) + \"px\"\n                        });\n                    }\n\n                    (point as any).pointerListener = new BB.PointerListener({\n                        target: point,\n                        maxPointers: 1,\n                        onPointer: function(event) {\n                            event.eventPreventDefault();\n                            if (event.type === 'pointerdown') {\n                                internalX = x;\n                                internalY = y;\n                            }\n                            if (event.button === 'left' && event.type === 'pointermove') {\n                                if (!lock) {\n                                    internalX += event.dX;\n                                }\n                                x = Math.max(0, Math.min(areaw, internalX));\n                                internalY += event.dY;\n                                y = Math.max(0, Math.min(areah, internalY));\n                                update();\n                                callback({\n                                    x: x,\n                                    y: y\n                                });\n                            }\n                        }\n                    });\n\n                    curveArea.appendChild(point);\n\n                    (point as any).setPos = function (newX, newY) {\n                        x = newX;\n                        y = newY;\n                        internalY = y;\n                        internalX = x;\n                        BB.css(point, {\n                            left: (x - gripSize / 2) + \"px\",\n                            top: (y - gripSize / 2) + \"px\"\n                        });\n                    };\n\n                    return point;\n                }\n\n                function updateControl(i, x, y) {\n                    if (mode === \"All\") {\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Red\") {\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Green\") {\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Blue\") {\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                }\n\n                let p0 = createPoint(0, areah, function (val) {\n                    updateControl(0, val.x, val.y);\n                    update();\n                }, true);\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\n                    updateControl(1, val.x, val.y);\n                    update();\n                });\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\n                    updateControl(2, val.x, val.y);\n                    update();\n                });\n                let p3 = createPoint(areaw, 0, function (val) {\n                    updateControl(3, val.x, val.y);\n                    update();\n                }, true);\n\n\n                function update() {\n                    canvas.width = canvas.width;\n                    ctx = canvas.getContext(\"2d\");\n\n                    let outCurves = {\n                        r: [],\n                        g: [],\n                        b: []\n                    };\n                    for (let i = 0; i < curves.r.length; i++) {\n                        outCurves.r.push(curves.r[i]);\n                        outCurves.g.push(curves.g[i]);\n                        outCurves.b.push(curves.b[i]);\n                    }\n\n                    function drawCurve(curve) {\n                        ctx.beginPath();\n                        let spline = new BB.SplineInterpolator(curve);\n                        for (let i = 0; i < 100; i++) {\n                            let y = spline.interpolate(i / 100);\n                            y = Math.max(0, Math.min(1, y));\n\n                            if (i === 0) {\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\n                            } else {\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\n                            }\n                        }\n                        ctx.stroke();\n                    }\n\n                    ctx.save();\n                    if (mode === \"All\") {\n                        ctx.strokeStyle = \"black\";\n                        drawCurve(outCurves.r);\n                    } else {\n                        ctx.globalAlpha = 0.5;\n                        ctx.strokeStyle = \"red\";\n                        drawCurve(outCurves.r);\n                        ctx.strokeStyle = \"green\";\n                        drawCurve(outCurves.g);\n                        ctx.strokeStyle = \"blue\";\n                        drawCurve(outCurves.b);\n                    }\n                    ctx.restore();\n                    p.callback(outCurves);\n                }\n\n                update();\n\n\n                this.getDiv = function () {\n                    return div;\n                };\n                this.destroy = function() {\n                    (p0 as any).pointerListener.destroy();\n                    (p1 as any).pointerListener.destroy();\n                    (p2 as any).pointerListener.destroy();\n                    (p3 as any).pointerListener.destroy();\n                };\n            }\n\n            let input = new CurvesInput({\n                curves: curves,\n                callback: function (val) {\n                    curves = val;\n                    update();\n                }\n            });\n\n\n            div.appendChild(input.getDiv());\n\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            result.destroy = () => {\n                input.destroy();\n                texture.destroy();\n                modeButtons.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    curves: curves\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let curves = params.input.curves;\n        let history = params.history;\n        if (!context || curves === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glCurves\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n\n        return true;\n    }\n\n\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\n// @ts-ignore\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const flip = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let isHorizontal = true;\n        let isVertical = false;\n        let doFlipCanvas = true;\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\n\n\n        let horizontalCheckbox = new Checkbox({\n            init: isHorizontal,\n            label: LANG('filter-flip-horizontal') + ' ⟷',\n            allowTab: true,\n            callback: function(v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px'\n            }\n        });\n        let verticalCheckbox = new Checkbox({\n            init: isVertical,\n            label: LANG('filter-flip-vertical') + ' ↕',\n            allowTab: true,\n            callback: function(v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px'\n            }\n        });\n        div.appendChild(horizontalCheckbox.getElement());\n        div.appendChild(verticalCheckbox.getElement());\n\n\n\n\n\n        let fcOption = document.createElement(\"div\");\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\n            return false;\n        });\n        fcOption.textContent = LANG('filter-flip-image');\n        fcOption.style.width = \"150px\";\n        fcOption.style.height = \"30px\";\n        fcOption.style.paddingTop = \"10px\";\n        fcOption.style.textAlign = \"center\";\n        fcOption.style.cssFloat = \"left\";\n        fcOption.style.paddingBottom = \"0px\";\n        fcOption.style.borderTopLeftRadius = \"10px\";\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n        fcOption.style.backgroundSize = '8%';\n        fcOption.style.backgroundColor = \"#9e9e9e\";\n\n        let flOption = document.createElement(\"div\");\n        BB.setEventListener(flOption, 'onpointerdown', function () {\n            return false;\n        });\n        flOption.textContent = LANG('filter-flip-layer');\n        flOption.style.width = \"150px\";\n        flOption.style.height = \"30px\";\n        flOption.style.paddingTop = \"10px\";\n        flOption.style.textAlign = \"center\";\n        flOption.style.cssFloat = \"left\";\n        flOption.style.paddingBottom = \"0px\";\n        flOption.style.borderTopRightRadius = \"10px\";\n        flOption.style.cursor = \"pointer\";\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        flOption.style.backgroundSize = '8%';\n\n        BB.setEventListener(fcOption, 'onpointerover', function () {\n            if (doFlipCanvas === false)\n                fcOption.style.backgroundColor = \"#ccc\";\n        });\n        BB.setEventListener(fcOption, 'onpointerout', function () {\n            if (doFlipCanvas === false)\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        });\n        BB.setEventListener(flOption, 'onpointerover', function () {\n            if (doFlipCanvas === true)\n                flOption.style.backgroundColor = \"#ccc\";\n        });\n        BB.setEventListener(flOption, 'onpointerout', function () {\n            if (doFlipCanvas === true)\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        });\n\n        fcOption.onclick = function () {\n            doFlipCanvas = true;\n\n            flOption.style.background = \"\";\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n            flOption.style.boxShadow = \"\";\n            flOption.style.cursor = \"pointer\";\n\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n            fcOption.style.backgroundSize = '8%';\n            fcOption.style.backgroundColor = \"#9e9e9e\";\n            fcOption.style.cursor = \"default\";\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n\n            updatePreview();\n        };\n        flOption.onclick = function () {\n            doFlipCanvas = false;\n\n            fcOption.style.background = \"\";\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n            fcOption.style.boxShadow = \"\";\n            fcOption.style.cursor = \"pointer\";\n\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n            flOption.style.backgroundSize = '8%';\n            flOption.style.backgroundColor = \"#9e9e9e\";\n            flOption.style.cursor = \"default\";\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n\n            updatePreview();\n        };\n\n        let optionWrapper = document.createElement(\"div\");\n        optionWrapper.appendChild(fcOption);\n        optionWrapper.appendChild(flOption);\n        div.appendChild(optionWrapper);\n\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        });\n\n        let previewLayer: IKlBasicLayer = {\n            image: BB.canvas(Math.round(w), Math.round(h)),\n            opacity: 1,\n            mixModeStr: 'source-over' as IMixMode,\n        };\n        let klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [previewLayer]\n        });\n\n        let previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px'\n            }\n        });\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n        previewWrapper.appendChild(previewInnerWrapper);\n\n        function updatePreview() {\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n\n            for (let i = 0; i < layers.length; i++) {\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        }\n        setTimeout(updatePreview, 0);\n\n\n        div.appendChild(previewWrapper);\n        result.destroy = () => {\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let canvas = params.canvas;\n        let history = params.history;\n        let horizontal = params.input.horizontal;\n        let vertical = params.input.vertical;\n        let flipCanvas = params.input.flipCanvas;\n        if (!context || !canvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        canvas.flip(horizontal, vertical, flipCanvas ? null : canvas.getLayerIndex(context.canvas));\n        history.pause(false);\n\n        history.push({\n            tool: [\"filter\", \"flip\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    },\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7UudW\");","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glHueSaturation = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let hue = 0, Saturation = 0;\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let hueSlider = new KlSlider({\n                label: LANG('filter-hue-sat-hue'),\n                width: 300,\n                height: 30,\n                min: -100,\n                max: 100,\n                initValue: hue * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    hue = val / 100;\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n                    klCanvasPreview.render();\n                }\n            });\n            let saturationSlider = new KlSlider({\n                label: LANG('filter-hue-sat-saturation'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: (Saturation + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    Saturation = val / 50 - 1;\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n                    klCanvasPreview.render();\n                }\n            });\n            hueSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(hueSlider.getElement());\n            div.appendChild(saturationSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                hueSlider.destroy();\n                saturationSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    hue: hue,\n                    Saturation: Saturation\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let hue = params.input.hue;\n        let history = params.history;\n        let Saturation = params.input.Saturation;\n        if (!context || hue === null || Saturation === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glHueSaturation\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply} from '../kl.types';\n\nexport const invert = {\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false;\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).invert().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"invert\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import { BB } from '../../bb/bb';\r\nimport { KlCanvasPreview } from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport { getSharedFx } from './shared-gl-fx';\r\nimport { IFilterApply, IFilterGetDialogParam, IKlBasicLayer } from '../kl.types';\r\nimport { LANG } from '../../language/language';\r\n\r\nexport const glPerspective = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = params.bbox.width < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch (e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y, callback?) {\r\n                let nobSize = 14;\r\n                let div = document.createElement(\"div\");\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + \"px\",\r\n                    height: nobSize + \"px\",\r\n                    backgroundColor: \"#fff\",\r\n                    boxShadow: \"inset 0 0 0 2px #000\",\r\n                    borderRadius: nobSize + \"px\",\r\n                    position: \"absolute\",\r\n                    cursor: \"move\",\r\n                    left: ((div as any).x - nobSize / 2) + \"px\",\r\n                    top: ((div as any).y - nobSize / 2) + \"px\",\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter() {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n            let beforeOption = document.createElement(\"div\");\r\n            BB.setEventListener(beforeOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            beforeOption.textContent = LANG('filter-perspective-before');\r\n            beforeOption.style.width = \"150px\";\r\n            beforeOption.style.height = \"30px\";\r\n            beforeOption.style.marginLeft = isSmall ? '0' : \"100px\";\r\n            beforeOption.style.paddingTop = \"10px\";\r\n            beforeOption.style.textAlign = \"center\";\r\n            beforeOption.style.cssFloat = \"left\";\r\n            beforeOption.style.paddingBottom = \"0px\";\r\n            beforeOption.style.borderTopLeftRadius = \"10px\";\r\n            beforeOption.style.cursor = \"pointer\";\r\n            beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            beforeOption.style.backgroundSize = '8%';\r\n\r\n            let afterOption = document.createElement(\"div\");\r\n            BB.setEventListener(afterOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            afterOption.textContent = LANG('filter-perspective-after');\r\n            afterOption.style.width = \"150px\";\r\n            afterOption.style.height = \"30px\";\r\n            afterOption.style.paddingTop = \"10px\";\r\n            afterOption.style.textAlign = \"center\";\r\n            afterOption.style.cssFloat = \"left\";\r\n            afterOption.style.paddingBottom = \"0px\";\r\n            afterOption.style.borderTopRightRadius = \"10px\";\r\n            afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n            afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            afterOption.style.backgroundSize = '8%';\r\n            afterOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n\r\n            BB.setEventListener(beforeOption, 'onpointerover', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(beforeOption, 'onpointerout', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerover', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerout', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n\r\n            beforeOption.onclick = function () {\r\n\r\n                beforeOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                beforeOption.style.backgroundSize = '8%';\r\n                beforeOption.style.backgroundColor = \"#9e9e9e\";\r\n                beforeOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                beforeOption.style.cursor = \"default\";\r\n\r\n                afterOption.style.background = \"\";\r\n                afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                afterOption.style.boxShadow = \"\";\r\n                afterOption.style.cursor = \"pointer\";\r\n\r\n                aa.style.display = \"none\";\r\n                ab.style.display = \"none\";\r\n                ac.style.display = \"none\";\r\n                ad.style.display = \"none\";\r\n\r\n                ba.style.display = \"block\";\r\n                bb.style.display = \"block\";\r\n                bc.style.display = \"block\";\r\n                bd.style.display = \"block\";\r\n                ba.copy(aa);\r\n                bb.copy(ab);\r\n                bc.copy(ac);\r\n                bd.copy(ad);\r\n                before = true;\r\n                update();\r\n            };\r\n            afterOption.onclick = function () {\r\n                before = false;\r\n\r\n                afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                afterOption.style.backgroundSize = '8%';\r\n                afterOption.style.backgroundColor = \"#9e9e9e\";\r\n                afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                afterOption.style.cursor = \"default\";\r\n\r\n                beforeOption.style.background = \"\";\r\n                beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                beforeOption.style.boxShadow = \"\";\r\n                beforeOption.style.cursor = \"pointer\";\r\n\r\n                ba.style.display = \"none\";\r\n                bb.style.display = \"none\";\r\n                bc.style.display = \"none\";\r\n                bd.style.display = \"none\";\r\n\r\n                aa.style.display = \"block\";\r\n                ab.style.display = \"block\";\r\n                ac.style.display = \"block\";\r\n                ad.style.display = \"block\";\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            };\r\n\r\n            let optionWrapper = document.createElement(\"div\");\r\n            optionWrapper.appendChild(beforeOption);\r\n            optionWrapper.appendChild(afterOption);\r\n            div.appendChild(optionWrapper);\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(aa);\r\n            previewInnerWrapper.appendChild(ab);\r\n            previewInnerWrapper.appendChild(ac);\r\n            previewInnerWrapper.appendChild(ad);\r\n\r\n            ba.style.display = \"none\";\r\n            bb.style.display = \"none\";\r\n            bc.style.display = \"none\";\r\n            bd.style.display = \"none\";\r\n            previewInnerWrapper.appendChild(ba);\r\n            previewInnerWrapper.appendChild(bb);\r\n            previewInnerWrapper.appendChild(bc);\r\n            previewInnerWrapper.appendChild(bd);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ]\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let before = params.input.before;\r\n        let after = params.input.after;\r\n        if (!context || !before || !after || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        let w = context.canvas.width;\r\n        let h = context.canvas.height;\r\n        glCanvas.draw(texture).perspective(before, after).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glPerspective\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {Select} from '../ui/base-components/select';\n// @ts-ignore\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const resize = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        //BB.centerWithin\n        let canvas = params.canvas;\n        if (!canvas)\n            return false;\n\n        let fit = BB.fitInto( canvas.getWidth(), canvas.getHeight(), 280, 200,1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / canvas.getWidth();\n        let tempCanvas = canvas.getCompleteCanvas(1);\n\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let newWidth = canvas.getWidth(), newHeight = canvas.getHeight();\n\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\n\n\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n\n        let widthWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            }\n        });\n        let heightWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            }\n        });\n        let widthInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxWidth,\n                value: '' + canvas.getWidth(),\n            }\n        }) as HTMLInputElement;\n        let heightInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxHeight,\n                value: '' + canvas.getHeight(),\n            }\n        }) as HTMLInputElement;\n        widthInput.onclick = function () {\n            (this as any).focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function () {\n            (this as any).focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function () {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function () {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append(LANG('width') + \": \", widthInput);\n        heightWrapper.append(LANG('height') + \": \", heightInput);\n        let inputWrapper = BB.el({\n            css: {\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\n                backgroundSize: '50px 52px',\n            }\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        div.appendChild(inputWrapper);\n\n        //contrain checkbox\n        let heightChanged = false, widthChanged = false;\n        let ratio = canvas.getWidth() / canvas.getHeight();\n\n        function updateConstrain() {\n            if (isConstrained) {\n                widthInput.value = '' + canvas.getWidth();\n                heightInput.value = '' + canvas.getHeight();\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\n                inputWrapper.style.backgroundSize = '50px 52px';\n                update();\n            } else {\n                inputWrapper.style.background = \"\";\n            }\n        }\n\n        let isConstrained = true;\n        let constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function(b) {\n                isConstrained = b;\n                updateConstrain();\n            }\n        });\n        div.appendChild(BB.el({\n            css: {\n                clear: 'both'\n            }\n        }));\n\n\n        let algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')]\n            ],\n            title: LANG('scaling-algorithm'),\n            initValue: 'smooth',\n            onChange: function() {\n                update();\n            },\n        });\n\n        let secondRowElement = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between'\n            }\n        });\n        secondRowElement.appendChild(constrainCheckbox.getElement());\n        secondRowElement.appendChild(algorithmSelect.getElement());\n\n        let previewCanvas = BB.canvas(w, h);\n        previewCanvas.style.imageRendering = 'pixelated';\n\n\n        let previewCtx = previewCanvas.getContext('2d');\n\n\n        function draw() {\n            if (algorithmSelect.getValue() === 'smooth') {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\n\n                previewCanvas.width = canvas.getWidth();\n                previewCanvas.height = canvas.getHeight();\n\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = 'high';\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n\n            } else {\n                previewCanvas.style.imageRendering = 'pixelated';\n\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n\n        }\n\n        function update() {\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) {\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\n                }\n                if (widthChanged) {\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\n                }\n\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\n                    widthInput.value = '' + parseInt('' + fit.width);\n                    heightInput.value = '' + parseInt('' + fit.height);\n                }\n            }\n\n            if (parseInt(widthInput.value) > maxWidth) {\n                widthInput.value = '' + maxWidth;\n            }\n            if (parseInt(heightInput.value) > maxHeight) {\n                heightInput.value = '' + maxHeight;\n            }\n\n            heightChanged = false;\n            widthChanged = false;\n\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\n            previewFactor = previewW / newWidth;\n\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\n\n            draw();\n\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\n            canvasWrapper.style.left = offset.x + \"px\";\n            canvasWrapper.style.top = offset.y + \"px\";\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\n        }\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            display: \"table\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            position: \"relative\",\n            userSelect: 'none',\n            colorScheme: 'only light',\n        });\n\n\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\n        canvasWrapper.appendChild(previewCanvas);\n        canvasWrapper.style.width = w + \"px\";\n        canvasWrapper.style.height = h + \"px\";\n        canvasWrapper.style.position = \"absolute\";\n        canvasWrapper.style.overflow = \"hidden\";\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\n        canvasWrapper.style.overflow = \"hidden\";\n        BB.createCheckerDataUrl(8, function (url) {\n            previewWrapper.style.background = \"url(\" + url + \")\";\n        });\n\n        div.appendChild(previewWrapper);\n        update();\n\n        result.destroy = () => {\n            constrainCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue()\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let canvas = params.canvas;\n        let history = params.history;\n        let width = params.input.width;\n        let height = params.input.height;\n        let algorithm = params.input.algorithm;\n        if (!canvas || !history) {\n            return false;\n        }\n        history.pause(true);\n        canvas.resize(width, height, algorithm);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"resize\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7Suhe\");","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const rotate = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let canvas = params.canvas;\n        if (!canvas)\n            return false;\n\n        let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / canvas.getWidth();\n        let tempCanvas = BB.canvas(w, h);\n        tempCanvas.style.display = 'block';\n        tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let deg = 0;\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\n\n        let first = true;\n\n        function update() {\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                let fit = BB.fitInto(h, w, 280, 200, 1);\n                let scale = parseInt('' + fit.height) / w;\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n            }\n        }\n\n        let btnPlus = document.createElement(\"button\");\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'>⟳</span> 90°\";\n        let btnMinus = document.createElement(\"button\");\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'>⟲</span> 90°\";\n        btnMinus.style.marginRight = '5px';\n\n\n        btnPlus.onclick = function () {\n            deg += 90;\n            update();\n        };\n        btnMinus.onclick = function () {\n            deg -= 90;\n            update();\n        };\n\n        div.appendChild(btnMinus);\n        div.appendChild(btnPlus);\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            display: \"table\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            colorScheme: 'only light',\n        });\n\n        let previewcell = document.createElement(\"div\");\n        previewcell.style.display = \"table-cell\";\n        previewcell.style.verticalAlign = \"middle\";\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\n        canvasWrapper.appendChild(tempCanvas);\n        previewWrapper.appendChild(previewcell);\n        canvasWrapper.style.width = w + \"px\";\n        canvasWrapper.style.height = h + \"px\";\n        canvasWrapper.style.marginLeft = \"auto\";\n        canvasWrapper.style.marginRight = \"auto\";\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\n        canvasWrapper.style.overflow = \"hidden\";\n        BB.createCheckerDataUrl(4, function (url) {\n            canvasWrapper.style.background = \"url(\" + url + \")\";\n        });\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\n\n        div.appendChild(previewWrapper);\n        update();\n\n        result.getInput = function () {\n            return {\n                deg: deg\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let canvas = params.canvas;\n        let history = params.history;\n        let deg = params.input.deg;\n        if (!canvas || !history)\n            return false;\n        history.pause(true);\n        canvas.rotate(deg);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"rotate\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glTiltShift = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n        let displayPreviewFactor = displayW / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        let pointerListenerArr = [];\n\n        function finishInit() {\n            let blur = 20, gradient = 200;\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n            let fa, fb; // focus line\n            function update() {\n                try {\n                    glCanvas.draw(texture).tiltShift(\n                        fa.x / displayPreviewFactor * previewFactor,\n                        fa.y / displayPreviewFactor * previewFactor,\n                        fb.x / displayPreviewFactor * previewFactor,\n                        fb.y / displayPreviewFactor * previewFactor,\n                        blur * previewFactor,\n                        gradient * previewFactor\n                    ).update();\n                    klCanvasPreview.render();\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }\n\n            function nob(x, y) {\n                let nobSize = 14;\n                let div = BB.el({\n                    css: {\n                        width: nobSize + \"px\",\n                        height: nobSize + \"px\",\n                        backgroundColor: '#fff',\n                        boxShadow: \"inset 0 0 0 2px #000\",\n                        borderRadius: nobSize + \"px\",\n                        position: \"absolute\",\n                        cursor: 'move',\n                        left: (x - nobSize / 2) + \"px\",\n                        top: (y - nobSize / 2) + \"px\",\n                        userSelect: 'none',\n                        touchAction: 'none',\n                    }\n                });\n                (div as any).x = x;\n                (div as any).y = y;\n                let pointerListener = new BB.PointerListener({\n                    target: div,\n                    maxPointers: 1,\n                    onPointer: function(event) {\n                        event.eventPreventDefault();\n                        if (event.button === 'left' && event.type === 'pointermove') {\n                            (div as any).x += event.dX;\n                            (div as any).y += event.dY;\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\n                            update();\n                        }\n                    }\n                });\n                pointerListenerArr.push(pointerListener);\n                return div;\n            }\n\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\n\n            let blurSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-blur'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                initValue: blur,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    blur = val;\n                    update();\n                }\n            });\n            blurSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(blurSlider.getElement());\n            let gradientSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-gradient'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 1000,\n                initValue: gradient,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    gradient = val;\n                    update();\n                }\n            });\n            div.appendChild(gradientSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            previewWrapper.oncontextmenu = function () {\n                return false;\n            };\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            previewInnerWrapper.appendChild(fa);\n            previewInnerWrapper.appendChild(fb);\n\n\n            div.appendChild(previewWrapper);\n            update();\n            result.destroy = () => {\n                for (let i = 0; i < pointerListenerArr.length; i++) {\n                    pointerListenerArr[i].destroy();\n                }\n                blurSlider.destroy();\n                gradientSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\n                    blur: blur,\n                    gradient: gradient\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let a = params.input.a;\n        let b = params.input.b;\n        let blur = params.input.blur;\n        let gradient = params.input.gradient;\n        if (!context || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glTiltShift\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\ninterface IFilterTransformInput {\r\n    bounds: {x: number, y: number, width: number, height: number};\r\n    transform: ITransform;\r\n    isPixelated: boolean;\r\n}\r\n\r\nexport const transform = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let i;\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = params.bbox.width < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        let boundsObj: {\r\n            x: number;\r\n            y: number;\r\n            width: number;\r\n            height: number;\r\n        } = { x: 0, y: 0, width: 0, height: 0 };\r\n        {\r\n            let tempBounds: any = {\r\n                x1: null,\r\n                y1: null,\r\n                x2: null,\r\n                y2: null\r\n            };\r\n            let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n            if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n                tempBounds.x1 = 0;\r\n                tempBounds.y1 = 0;\r\n                tempBounds.x2 = context.canvas.width - 1;\r\n                tempBounds.y2 = context.canvas.height - 1;\r\n            } else {\r\n                for (i = 3; i < imdat.data.length; i += 4) {\r\n                    if (imdat.data[i] > 0 ) {\r\n                        let x = ((i - 3) / 4) %  context.canvas.width;\r\n                        let y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                        if (tempBounds.x1 > x || tempBounds.x1 === null) {\r\n                            tempBounds.x1 = x;\r\n                        }\r\n                        if (tempBounds.y1 === null) {\r\n                            tempBounds.y1 = y;\r\n                        }\r\n                        if (tempBounds.x2 < x || tempBounds.x2 === null) {\r\n                            tempBounds.x2 = x;\r\n                        }\r\n                        if (tempBounds.y2 < y || tempBounds.y2 === null) {\r\n                            tempBounds.y2 = y;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (tempBounds.x1 === null || tempBounds.y1 === null) {\r\n                alert(LANG('filter-transform-empty'));\r\n                return false;\r\n            }\r\n            boundsObj.x = tempBounds.x1;\r\n            boundsObj.y = tempBounds.y1;\r\n            boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\r\n            boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\r\n        }\r\n\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        let keyListener = new BB.KeyListener({\r\n            onDown: function(keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        let leftWrapper = document.createElement(\"div\");\r\n        let rightWrapper = document.createElement(\"div\");\r\n        let rotWrapper = document.createElement(\"div\");\r\n        let inputY = document.createElement(\"input\");\r\n        let inputX = document.createElement(\"input\");\r\n        let inputR = document.createElement(\"input\");\r\n        leftWrapper.style.width = \"100px\";\r\n        leftWrapper.style.height = \"30px\";\r\n        rightWrapper.style.width = \"100px\";\r\n        rightWrapper.style.height = \"30px\";\r\n        rightWrapper.style.display = \"inline-block\";\r\n        leftWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.width = \"150px\";\r\n        rotWrapper.style.height = \"30px\";\r\n        inputY.type = \"number\";\r\n        inputX.type = \"number\";\r\n        inputR.type = \"number\";\r\n        inputX.style.width = 70 + \"px\";\r\n        inputY.style.width = 70 + \"px\";\r\n        inputR.style.width = 70 + \"px\";\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append(\"X: \", inputX);\r\n        rightWrapper.append(\"Y: \", inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            }\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90°',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90°',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block'\r\n            }\r\n        });\r\n        let isSnapping = false;\r\n        let snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            }\r\n        });\r\n        const checkboxWrapper = BB.el({});\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px'\r\n            }\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n            }\r\n        });\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function() {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        BB.css(previewWrapper, {\r\n            width: isSmall ? '340px' : '540px',\r\n            marginLeft: \"-20px\",\r\n            height: isSmall ? '260px' : '300px',\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    let ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr\r\n                });\r\n            }\r\n        }\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview(doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            let transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            let ctx = transformLayerCanvas.getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n        previewInnerWrapper.appendChild(freeTransform.getElement());\r\n\r\n        function onInputsChanged() {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n        };\r\n        result.getInput = function () {\r\n            const transform = freeTransform.getTransform();\r\n            let input = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            } as IFilterTransformInput;\r\n            result.destroy();\r\n            return JSON.parse(JSON.stringify(input));\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input: IFilterTransformInput = params.input;\r\n\r\n        let copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"transform\"],\r\n            action: \"apply\",\r\n            params: [{input}],\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glBlur = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let canvas = params.canvas;\n        let context = params.context;\n        if (!canvas || !context) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n\n        function finishInit() {\n            let radius = 10;\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 1,\n                max: 200,\n                initValue: radius,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                    klCanvasPreview.render();\n                }\n            });\n            div.appendChild(radiusSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                texture.destroy();\n                radiusSlider.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    radius: radius\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let radius = params.input.radius;\n        if (!context || !radius || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).triangleBlur(radius).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glBlur\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glUnsharpMask = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let radius = 2, strength = 5.1 / 10;\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                initValue: 2,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]]\n            });\n            let strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 50,\n                initValue: 5.1,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    strength = val / 10;\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]]\n            });\n            radiusSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(radiusSlider.getElement());\n            div.appendChild(strengthSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                radiusSlider.destroy();\n                strengthSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    radius: radius,\n                    strength: strength\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let radius = params.input.radius;\n        let strength = params.input.strength;\n        if (!context || radius === null || strength === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glUnsharpMask\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {Options} from '../ui/base-components/options';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const toAlpha = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let radius = 2, strength = 5.1 / 10;\n            div.appendChild(BB.el({\n                content: LANG('filter-to-alpha-description'),\n                css: {\n                    marginBottom: '5px'\n                }\n            }));\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            function updatePreview() {\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n                klCanvasPreview.render();\n            }\n\n            // source\n            let sourceId = 'inverted-luminance';\n            let sourceOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'inverted-luminance',\n                        label: LANG('filter-to-alpha-inverted-lum')\n                    },\n                    {\n                        id: 'luminance',\n                        label: LANG('filter-to-alpha-lum')\n                    }\n                ],\n                initialId: sourceId,\n                onChange: function(id) {\n                    sourceId = id;\n                    updatePreview();\n                }\n            });\n            div.appendChild(sourceOptions.getElement());\n\n            // color\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n            let colorOptionsArr = [\n                null,\n                {r: 0, g: 0, b: 0, a: 1},\n                {r: 255, g: 255, b: 255, a: 1}\n            ];\n            colorOptionsArr.push({\n                r: params.currentColorRgb.r,\n                g: params.currentColorRgb.g,\n                b: params.currentColorRgb.b,\n                a: 1,\n            });\n            colorOptionsArr.push({\n                r: params.secondaryColorRgb.r,\n                g: params.secondaryColorRgb.g,\n                b: params.secondaryColorRgb.b,\n                a: 1,\n            });\n\n            let colorOptions = new ColorOptions({\n                label: LANG('filter-to-alpha-replace'),\n                colorArr: colorOptionsArr,\n                initialIndex: 1,\n                onChange: function(rgbaObj) {\n                    selectedRgbaObj = rgbaObj;\n                    updatePreview();\n                }\n            });\n            colorOptions.getElement().style.marginTop = '10px';\n            div.appendChild(colorOptions.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            setTimeout(function() { //ie has a problem otherwise...\n                try {\n                    updatePreview();\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }, 1);\n\n            result.destroy = () => {\n                texture.destroy();\n                sourceOptions.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    sourceId: sourceId,\n                    selectedRgbaObj: selectedRgbaObj\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let sourceId = params.input.sourceId;\n        let selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"toAlpha\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {KL} from '../kl';\nimport {KlCanvas} from '../canvas/kl-canvas';\n\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\n    let layerArr = klCanvas.getLayersFast();\n\n    let psdConfig = {\n        width: klCanvas.getWidth(),\n        height: klCanvas.getHeight(),\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n        children: []\n    };\n    for (let i = 0; i < layerArr.length; i++) {\n        // todo - can be optimized if layer mostly empty\n        let item = layerArr[i];\n        psdConfig.children.push({\n            name: item.name,\n            opacity: item.opacity,\n            canvas: item.canvas,\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n            left: 0,\n            top: 0\n        });\n    }\n\n    let agPsd = await import('ag-psd');\n    let buffer = agPsd.writePsdBuffer(psdConfig);\n    return new Blob([buffer], { type: 'application/octet-stream' });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"67TaG\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"55mKQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"jc8Ev\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"udYZ0\");"],"names":["$d2fa9a947070c225$export$a84540bc8b694b2d","p1","klApp","agPsd","onProjectReady","project","projectStore","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","embed","changeTitle","showReminder","saveAsPsd","isDrawing","getEl","container","document","body","getBBox","$3C7jC","KlApp","undefined","logoImg","onLogo","customSave","hideFile","isShare","helpPath","bottomBar","aboutEl","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","appendChild","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","projectStore1","$hrnUX","KL","ProjectStore","this","openProject","layers","read","then","readResult","p","setTimeout","out","catch","message","indexOf","initError","getPNG","getPSD","$4gaLD","asyncToGenerator","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","parcelRequire","_ctx","sent","shift","push","importImage","a","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t1","e1","Array","slice","call","arguments","n","createDocumentFragment","t","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","resetCanvas","param","klCanvas","reset","layerManager","update","setCurrentLayer","getLayer","klCanvasWorkspace","resetView","handUi","getScale","getAngleDeg","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","image","importAsImagePsd","convertedPsdObj","cropObj1","crop","targetCanvas","cropCanvas","cropObj","cropCanvas1","i","i1","item1","layerIndex","showImportAsLayerDialog","klRootEl","transformObj","isPixelated","pause","addLayer","getLayers","renameLayer","activeLayerIndex","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","target","type","buttons","showImportImageDialog","bbox","maxSize","res","importAsLayer","files","showWarningPsdFlattened","file","name","split","extension","toLowerCase","f1","maxResolution","size","doShowLoader","loaderIsOpen","result","closeLoader","f","FileReader","readerResult","loadAgPsd","agPsdLazy","replace","convertedPsd","PSD","skipLayerImageData","skipThumbnail","alert","match","URL","webkitURL","url","createObjectURL","im","Image","src","loadImage","hasUnsupportedFile","collapseThreshold","getElement","style","display","setDirection","uiState","toolspaceCollapser","isOpen","css","left","right","setSize","Math","max","uiWidth","toolWidth","uiHeight","setWide","statusOverlay","toolspace","borderLeft","borderRight","setUiState","updateCollapse","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","layerPreview","setLayer","newImageDialog","currentColor","klColorSlider","getSecondaryRGB","getWidth","canvasHeight","getHeight","workspaceWidth","workspaceHeight","onConfirm","color","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","fill","shape","setIsVisible","open","showCrop","clipboardDialog","inputObj","top","bottom","input","history","filterLib","cropExtend","apply","updateBottomBar","isVisible","toolspaceInner","scrollHeight","bottomBarWrapper","clientWidth","offsetWidth","innerWidth","clientHeight","offsetHeight","innerHeight","min","screen","$6l0gQ","LocalStorage","app","createElement","bbox1","exportType","KlCanvas","projectObj","setHistory","initState","layerFill","g","b","copy","focus","getLayerCount","brushes","destroy","RGB","currentBrushId","lastNonEraserBrushId","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","LineSanitizer","lineSanitizer","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","KlCanvasWorkspace","drawEventChain","chainIn","rgbObj","isDragDone","pickingDone","setMode","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getTolerance","getSample","getGrow","getContiguous","angleRad","dialogCounter","get","textToolDialog","font","colorRGBA","text","textStr","ColorConverter","toRgbaStr","typeStr","shapeTool","onDown","onMove","onUp","onViewChange","viewChangeObj","changed","includes","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","onUndo","canUndo","undoRedoCatchup","undo","canRedo","redo","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","keyListener","isPressed","fitView","preventDefault","sameKeys","prev","next","store","getProject","t0","success","stop","copyToClipboard","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","r","setActive","updateMainTabVisibility","brushTabRow","swapColors","KlImageDropper","onDrop","handleFileSelect","enabledTest","addEventListener","pasteEvent","clipboardData","items","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","onload","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","ui","padding","position","StatusOverlay","el","parent","oncontextmenu","onclick","handleClick","ToolspaceCollapser","overlayToolspace","OverlayToolspace","append","backgroundColor","toolspaceTopRow","$85H3x","ToolspaceTopRow","showIframePopup","wrap","abrupt","overlay","updateUi","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","saveToComputer","save","onShare","onHelp","$5ebUJ","marginBottom","ToolspaceToolRow","onZoomIn","onZoomOut","onRedo","setIsSmall","addListener","setEnableUndo","setEnableRedo","addClassName","KlColorSlider","onPick","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","tooltip","brushId","enable","onClose","keyArr","createTab","b2","HandUi","onFit","onAngleChange","isRelative","FillUi","colorSlider","TextUi","ShapeUi","ShapeTool","isDone","x2","y2","shapeObj","shapeUi","getShape","isOutwards","getIsOutwards","getIsEraser","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","getMode","fillRgb","setComposite","drawShape","ctx","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","flename","FileTab","imgurUpload","imgurKey","SettingsTab","$kafYx","onOpen","minWidth","id","$4IKdh","$l1AcR","$8vwUW","textUi","$TSTUW","$81LGj","$bZgtG","show","hide","$9YnQS","$kzmUj","settingsTab","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","content","resize","scrollY","scrollTo","_ref","swapUiLeftRight","_this","userSelect","_this1","ResizeObserver","windowResizeWatcher","e2","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","setDbName","$9BlwZ","indexedDb","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","$b60fce38973759d6$export$28b6f4d98dde9845","$b60fce38973759d6$export$1a1044741a812c67","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","concat","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","focusEl","tagName","select","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","overflow","minHeight","flexDirection","scrollContent","ignoreBackground","zIndex","$1bOI3","titleHeight","lineHeight","background","boxShadow","div","marginRight","boxClasses","join","flex","boxEl","clickOnEnterBtn","stopPropagation","click","autoFocus","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","label","$h7G7V","iconImg","custom","btn","clickOnEnter","closefunc","onscroll","clearInterval","updatePos","elW","popupEl","elH","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","titleEl","paddingLeft","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","$dd0d395ff14a3e11$export$f5386afdb763a67e","count","emit","listener","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","removeClassName","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","$h4olN","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$5cf2b5b76bc9d0c","classStr","classAttr","getAttribute","splitArr","$2bd9b7b9bc92046d$export$1789407f05ca7654","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","i2","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","code1","add","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","round","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","onTouchstart","onTouchmove","onTouchend","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","pointerObj","getPointer","lastPageX","lastPageY","addPointer","totalLastX","totalLastY","eventItem","createPointerOutEvent","correctedEvent","bounds","targetElement","getBoundingClientRect","relX","relY","dX","dY","time","coalescedItem","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","onPointerCallback","onPointerdown","dragObj","downPageX","downPageY","lastTimeStamp","setTouchTimeout","buttonsToStr","clearTouchTimeout","outEvent1","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelCleaner","wheelEvent","isDestroyed","timing","navigationStart","fixScribble","touchArr","changedTouches","touchObj","isOver","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainArr","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","$12950380ec51f25d$export$510622b8aed00381","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","tempLastEventTime","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","maxTapMs","fingerObj","fingerObj1","i3","allAreUp","i4","onTap","$12950380ec51f25d$export$d62358ac2d82abb3","gestureObj1","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","beginPinch","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","i6","i7","endPinch","touchPointerObj","i5","firstFingerMaxDistancePx","gestureObj","pincherArr","onPinch","actionObj","startDist","distance","startAngle","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","$12950380ec51f25d$export$71ff2f51bf1f4062","pointers","downPointerId","ignorePointerIdArr","$12950380ec51f25d$export$d429e21f52463d17","downEvent","eventQueue","direction","shiftIsPressed","onDraw","pressure0","pressure1","i8","$12950380ec51f25d$export$91dcf4209534d21f","$12950380ec51f25d$export$c57e2ed65bcf4d6a","lastMixedInput","interval","timeout","inputX","inputY","inputPressure","setInterval","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","size1","create","toDataURL","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","getLength","fac","$77ae015f37ebe4f1$export$5379d955c16d4d43","lastPoint","lastCallbackPoint","lastAngle","pointArr","lastDot","lastSpacing","spacing","controlsCallback","dir","pointM1","pointM2","pointM3","pointLine","curvePoints","p3","p4","resolution","getBezierPoints","tempSpacing","dAngle","addFinal","newP","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","findX","tempX","tempY","tempDist","$77ae015f37ebe4f1$export$4551d4af86c1eb08","startVal","endVal","stepSize","dec","resultArr","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","o","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","$cfe3aa45a75894cc$var$els","isArray","onChange","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","msg","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","element","innerEl","checked","doHighlight","allowTab","tabIndex","onchange","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","border","cssFloat","$1JVLJ","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","splineInterpolator","toLinearValue","useSpline","updateEnable","isEnabled","getOutsideVal","linearValue","updateLabel","pLinearValue","outVal","formatFunc","toLocaleString","languageStrings","getCode","labelCaption","control","elementWidth","isFinal","isChangeOnFinal","eventResMs","lastCallbackTime","virtualVal","deltaX","curve","elementHeight","curveArr","controlInner","labelFontSize","pointerListener","pointerListenerTimeout","increaseValue","decreaseValue","config","setIsEnabled","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$lwYTO","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","svHeight","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","filter","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","startValue","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$lnp03","backgroundPosition","isPicking","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","margin","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","initialId","changeOnInit","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$neyVU","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","rect","doUpdate","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$hkSYR","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","layerName","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","sliderValue","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","div1","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","div2","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$94kI0","$bcAoE","$635Wu","$NA9np","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","setMixMode","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcData","targetCtx","targetImageData","srcCanvas","srcImageData","srcCtx","srcIndex","targetData","imageData","canvasObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","$7069db2f5e23d00f$export$13d50f258a8034f","rgbaArr","Uint8Array","ArrayBuffer","px","py","q","tl","tr","br","bl","$7069db2f5e23d00f$var$floodFill","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","onShape","$01d7180c5d1d0fdf$export$71b514a25c47df50","isEraser","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$var$TMode","$d492af58f4721011$export$6eaf6f7c0cc177fc","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","_this2","getRenderedTransform","matrix2","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","onFill","onText","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","oldTransform","mainDoubleTapper","DoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","_this3","brushRadius","animationFrameRequested","lastRenderTime","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$18Tc8","$8n8Ho","$gU5bE","$dyPX7","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","renderContext","workspacePointArr","borderSize","layerArr","getLayersFast","compositeObj","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","doRender","elapsedFrames","checkChange","testBgVisible","mixTransformObj","start","render","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","canvasPointsArr","boundsObj","boundsWidth","boundsHeight","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","$0370167ee97a20d9$export$79a74567acf241b0","scaled","corners","minSnapDist","cornerCursors","gripSize","edgeSize","edges","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","pointerRemainder","isInverted","boundsStartP","boundsPointerListener","snap","iP","distX","distY","j","projected","dist1","updateCornerPositions","updateDOM","virtualPos","offsetArr","tinyOffset","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","updateScaled","angleOffset","tfD","ti","dimension","restoreRatio","angleGrip","$bpZoe","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","previewFit","imageWidth","imageHeight","innerWrapper","transformSize","setPos","setAngleDeg","setTransformFit","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","centerBtn","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$5a9IX","newButton","$aIuek","importButton","$iSExi","saveButton","$bJ468","shareButton","$1cU21","helpButton","$dLSOl","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$ljHFh","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","onActivate","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$kfbw6","$89wUh","zoomInButton","zoomOutButton","undoNRedoButton","$jVJD7","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","useAccent","openedTabObj","tabDiv","openedTabObj1","roundRight","roundLeft","tabArr","roundSize","$lpHLy","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","onReset","fitButton","leftRotateButton","$38LBW","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","eraserToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","maxCanvasSize","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","secondaryColor","canvasWidth","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$10vLG","dirStr","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","objectSpread","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","touchAction","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$hYo3Z","$iZEgo","$b6U2o","$28VIu","$9N32U","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","onupgradeneeded","createObjectStore","keyPath","createIndex","unique","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","contains","deleteDatabase","transaction","objectStore","e3","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","glBrightnessContrast","lang","buttonLabel","webgl","updateContext","$lwRqL","getDialog","inEmbed","$iZHb0","neededWithWebGL","glCurves","$d76q3","$gOquh","glHueSaturation","$9gBJM","invert","$kBjrm","glPerspective","$7YbO8","$99Hvm","glTiltShift","$df9fA","toAlpha","$2jUvB","$2TBzi","ieFails","glBlur","$cE8nO","glUnsharpMask","$kGBiW","$805be15a1e91c0ee$var$updateNames","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","$68QTJ","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry1","settingColor","settingColorStr","lineToolLastDot","inputArr","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","continueLine","bezierLine","lastInput","drawArr","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","localSpacing","settingSpacing","actions","maxInput","loopDist","mouseDist","eX","eY","bdist","historyEntry","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","getLockAlpha","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","$74D3O","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","noise","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","j1","gi0","gi1","gi2","t2","$dfc47a34ad9bc378$export$d3022aad56692482","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","isTesting","blending","settingSizePressure","settingOpacityPressure","blendCol","blendMix","redrawBounds","cells","getTouchedCells","isTouched","drawCells","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","underR1","underG1","underB1","newAlpha","drawBuffer","localColNew","calcSpacing","avgX","avgY","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","bezierCallback","updateRedrawBounds","totalCells","drawChangedCells","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","plotLine","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","controlCallback","controlObj","setIsEraser","setUseDither","getUseDither","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","createRadialGradient","oFac","opacity1","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aIndex","aP","bP","softnessPx","pixel","ai","bi","ix","iy","fac2","alphaLock","bx1","bx2","iy4","yStart","ix4","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","$78ad817c60f81b7c$export$c9f800961903deab","completeRedrawBounds","copiedCells","copyImageData","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingMode","settingDistort","settingXSymmetry","settingYSymmetry","settingGradient","buffer","path","Path2D","startAtTop","gradient","minY","maxY","lineJoin","distort","pos","historyCanvas","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","$cVFne","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$3uATk","updateAlphas","alphas","currentAlpha","spacingSpline","lockAlphaToggle","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$kWKVM","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$dT95N","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$fqvTS","ditherToggle","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$9OYoy","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$bSKev","$18456e8104a5a825$export$80819a93636ebb04","$7cAXf","actualIconSize","iconSize","modeOptions","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","storeEl","clearEl","hideClearButton","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","bind","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","$2wCWz","base64ToBlob","createThumbnail","HTMLCanvasElement","all","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","view","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$kmrRo","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","applyFilter","filterDialog1","currentColorRgb","secondaryColorRgb","filterDialog","getInput","finishedDialog","createDisabledButton","appName","addGroup","groupArr","filters","groupA","groupB","filterKey1","hrEl","webglnote","$6349b006a6604e1b$var$upload","description","_upload","gif","labelText","response","formData","$a5qtk","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","mimeType2","filename1","fileBase","fnameArr","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","g1","send","d1","a2","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","a1","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","FileSaver","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","b4","id1","b3","b8","p5","b5","p6","b6","id2","b7","currentLayerIndex","logParam","localCurrentLayerCtx","p7","p8","b9","p9","b10","id3","b11","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","onLeftRight","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7YsoP","$jewBv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","onSubmit","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$99EgS","$5deND","$4d8c6","$5Ta9b","$gMKRz","$7z464","$diAhN","$c1rJJ","$2elec","$gACTl","$dIv7c","$1NZ3i","$cJB4E","$gTwOE","$1e763c481ba6cf00$export$80884bc1ac80aa1d","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","brightnessContrast","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$0e6e34a2063e157d$var$fxCanvas","$TEtAx","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$5eb53faa48338ac6$export$68ae324f2f6c6252","gl1","lo","hi","wrapTexture","loadContentsOf","texture1","Texture1","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader1","use","getDefaultShader","drawRect","simpleShader","shader","uniforms","textureIn","textureOut","swapWith","node","contents","getPixelArray","array","readPixels","getSquareToQuad","dx1","dy1","dx2","dy2","dx3","dy3","det","getInverse","warpShader","warp","splineInterpolate","interpolator","curves","red","green","blue","initFromBytes","textures","denoise","exponent","texSize","hueSaturation","amount","sepia","unsharpMask","strength","ensureFormat","triangleBlur","originalTexture","unuse","vibrance","vignette","lensBlur","lensBlurPrePass","common","randomShaderFunc","lensBlur0","lensBlur1","lensBlur2","power","delta0","delta1","tiltShift","endX","endY","blurRadius","gradientRadius","zoomBlur","colorHalftone","dotScreen","edgeWork","edgeWork1","edgeWork2","hexagonalPixelate","ink","bulgePinch","matrixWarp","inverse","useTextureSpace","perspective","after","swirl","replaceRGBA","oldGetExtension","oldGetSupportedExtensions","OESTextureFloatLinear","getSupportedExtensions","framebuffer","createFramebuffer","byteTexture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","floatTexture","LINEAR","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","compileShader","attachShader","linkProgram","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","useProgram","viewport","drawArrays","POINTS","supportsOESTextureFloatLinear","WebGLRenderingContext","$OES_texture_float_linear$","extensions","isNumber","compileSource","testPrecisionSupport","Shader","defaultVertexSource","defaultFragmentSource","floatPrecision","source","nameStr","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","HIGH_FLOAT","MEDIUM_FLOAT","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","uniform1f","uniform1i","getParameter","VIEWPORT","vertexBuffer","STATIC_DRAW","texCoordBuffer","getAttribLocation","TRIANGLE_STRIP","defaultShader","Texture","getCanvas","videoWidth","videoHeight","deleteTexture","unit","activeTexture","TEXTURE0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","fillUsingCanvas","toImage","pixels","other","$21fb62da4f6e89f8$export$4630dcf80f8ceb88","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","offsetWrapper","selectedRgbaObj","fit1","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","bgColorOverlay","updateBg","flexRow","$e250f451a2faf8b3$export$2e9081b953703a77","canvas1","ctx1","curves1","modeButtons","p0","areah","areaw","update2","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","spline","getDiv","update1","$ae0fd60a73f3b8a4$export$8a83211c878a3f1f","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$8acL3","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","$b5e471d752989800$export$88005259b9a70e15","Saturation","hueSlider","saturationSlider","$d23471d9289cfec2$export$6897c284b6f9f4dc","$ed63f0c6c7ca7574$export$358acb0cd681f612","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeOption","afterOption","nobSize","$2405b4796fda9858$export$4380c87abf28fdf","previewW","previewH","algorithmSelect","canvasWrapper","inputWrapper","$3sYrR","constrainCheckbox","secondRowElement","$5b99ea702a5304d2$export$bb628a54ab399bc9","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$e3bfa9cf59911118$export$83a0900d4b9a8022","fa","fb","blurSlider","gradientSlider","$dc2850290325f029$export$51186ad6e864892a","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","tempBounds","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","$6f2c67b7999657bb$export$5a82a801f025d40a","radiusSlider","$f7bb3cad91091576$export$a959f91352b242e2","strengthSlider","$e96a6eb511826b00$export$be1ee5ea42904fdc","sourceId","sourceOptions","$40b8cea12adf584e$export$92433b641be3f7a","_klCanvasToPsdBlob"],"version":3,"file":"main-embed.1e2af3a2.js.map"}