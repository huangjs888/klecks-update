{"mappings":"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G,GAAG,GAAG,IAAI,IAAI,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,IAAI,EAAE,GAAG,GAAG,IAAI,GAAG,GAAG,GACzE,IAAK,EAAE,IAAI,IAAI,IAAI,IAAI,GAAG,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,GACzE,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,IACxE,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,IACxE,IAAI,IAAI,GAAI,GAAG,GAAG,GAAG,IAAK,EAAE,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAK,GAAG,GAAG,IAAI,IAAI,IACxE,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAK,EAAE,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IACxE,EAAE,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GACzE,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAK,EAAE,GAAG,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,EAC1E,IAAI,GAAG,GAAG,IAAK,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,IAAI,IAAI,IAAI,IAAI,GAAG,IACxE,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAK,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IACxE,GAAG,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAK,EAAE,IAAI,IACxE,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IA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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","src/app/script/app/kl-app.ts","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/popup.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/input/event-listener.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/base/base.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/math/math.ts","src/app/script/bb/input/event-chain.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","node_modules/@parcel/runtime-js/lib/runtime-16182675b608aed8.js","node_modules/@parcel/runtime-js/lib/runtime-5ead3de76c1474dc.js","src/app/script/klecks/ui/base-components/checkbox.ts","src/app/script/klecks/ui/base-components/input.ts","src/app/script/klecks/ui/base-components/select.ts","src/app/script/klecks/ui/base-components/image-toggle.ts","src/app/script/klecks/ui/base-components/image-radio-list.ts","src/app/script/klecks/ui/base-components/pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-d1740b30150a4f0c.js","src/app/script/klecks/ui/base-components/kl-slider.ts","src/app/script/klecks/ui/base-components/slider-falloff.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-7804f826c52703e7.js","src/app/script/klecks/ui/base-components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-b662234ad753bdc3.js","src/app/script/klecks/ui/base-components/kl-color-slider-small.ts","src/app/script/klecks/ui/base-components/point-slider.ts","src/app/script/klecks/ui/base-components/color-options.ts","src/app/script/klecks/ui/base-components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-31236e0fa2d81196.js","src/app/script/klecks/ui/modals/export-dialog-deprecated.ts","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/kl-layer-manager.ts","node_modules/@parcel/runtime-js/lib/runtime-707e2b642bb44f9c.js","node_modules/@parcel/runtime-js/lib/runtime-6a1b58b1b46e27b9.js","node_modules/@parcel/runtime-js/lib/runtime-e0c64a9c0e7d67b2.js","node_modules/@parcel/runtime-js/lib/runtime-6e8362a8c592487d.js","node_modules/@parcel/runtime-js/lib/runtime-dce03d0585fe4596.js","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-1a24b259c77eae1a.js","node_modules/@parcel/runtime-js/lib/runtime-675a0f887f8c23de.js","node_modules/@parcel/runtime-js/lib/runtime-f1f5555683161429.js","node_modules/@parcel/runtime-js/lib/runtime-38f95a056f1182e9.js","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-bb5572796f066d49.js","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/components/fitted-image.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-b09b862c21f90c10.js","node_modules/@parcel/runtime-js/lib/runtime-181303ffff669151.js","node_modules/@parcel/runtime-js/lib/runtime-009a672af02b8666.js","node_modules/@parcel/runtime-js/lib/runtime-10873d850a6d61d4.js","node_modules/@parcel/runtime-js/lib/runtime-349c390e7876fa2e.js","node_modules/@parcel/runtime-js/lib/runtime-76c875460c636e84.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-047df3bf7af37efc.js","node_modules/@parcel/runtime-js/lib/runtime-e0de48af5d3e9833.js","node_modules/@parcel/runtime-js/lib/runtime-4cf6bf9cc36913d0.js","node_modules/@parcel/runtime-js/lib/runtime-955195f39df4e4f9.js","node_modules/@parcel/runtime-js/lib/runtime-4f3eb36930b63cc6.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-4380d61b0af04700.js","node_modules/@parcel/runtime-js/lib/runtime-bd3009b658cd2ec7.js","node_modules/@parcel/runtime-js/lib/runtime-548d316a4648bff0.js","node_modules/@parcel/runtime-js/lib/runtime-b1e86dba974ce52c.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-09184558bdc657f6.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-733b04aa13f91c2c.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-1e11204013037f69.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-e4c8b829f3a1ea0a.js","node_modules/@parcel/runtime-js/lib/runtime-64c2d2e1bba90cfa.js","node_modules/@parcel/runtime-js/lib/runtime-36abd4314d242423.js","node_modules/@parcel/runtime-js/lib/runtime-de9c6d2dd30b7302.js","node_modules/@parcel/runtime-js/lib/runtime-2ee59197f679c1aa.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-f7bb022a955758e2.js","node_modules/@parcel/runtime-js/lib/runtime-96f94cf6799bd58b.js","node_modules/@parcel/runtime-js/lib/runtime-37694c99b297d781.js","node_modules/@parcel/runtime-js/lib/runtime-8e63318772c270d6.js","node_modules/@parcel/runtime-js/lib/runtime-3debf0851c1de166.js","node_modules/@parcel/runtime-js/lib/runtime-1e5ccfc9d317a4ac.js","node_modules/@parcel/runtime-js/lib/runtime-2b2bfde8fc6b3a2e.js","node_modules/@parcel/runtime-js/lib/runtime-91fa274fa3bb65cb.js","node_modules/@parcel/runtime-js/lib/runtime-8f602c3a9ac2052f.js","node_modules/@parcel/runtime-js/lib/runtime-69b705b117980b94.js","node_modules/@parcel/runtime-js/lib/runtime-59dd138054e8d31c.js","node_modules/@parcel/runtime-js/lib/runtime-67c50647b08308c7.js","node_modules/@parcel/runtime-js/lib/runtime-8f5a590e8c764392.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-5d3fa44bc8ead2b0.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-da6c563cd1c03805.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-ea0e192b8f082cae.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-bbe4e09277554262.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-acbaf7c85b905a30.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-57156d58bc4ec8b5.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-d2777968d0b19951.js","src/app/script/klecks/ui/base-components/box-toggle.ts","src/app/script/klecks/ui/modals/show-iframe-popup.ts","src/app/script/klecks/ui/base-components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-493c5c2b2925afc3.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-ebbec2c3d4cad04c.js","src/app/script/klecks/storage/ag-psd-wrapper.ts","node_modules/@parcel/runtime-js/lib/runtime-dc87be8b8fd0a83b.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","node_modules/file-saver/src/FileSaver.js","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-5a962f9b22e7e2e6.js","node_modules/@parcel/runtime-js/lib/runtime-86ae22abe373cec6.js","node_modules/@parcel/runtime-js/lib/runtime-15e7c4d4910efeba.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/embed/toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/gl-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/shared-gl-fx.ts","src/app/script-vendor/glfx.ts","src/app/script/klecks/filters/crop-extend.ts","src/app/script/klecks/filters/gl-curves.ts","src/app/script/klecks/filters/flip.ts","node_modules/@parcel/runtime-js/lib/runtime-836ed4dc47a4ff11.js","src/app/script/klecks/filters/gl-hue-saturation.ts","src/app/script/klecks/filters/invert.ts","src/app/script/klecks/filters/gl-perspective.ts","src/app/script/klecks/filters/resize.ts","node_modules/@parcel/runtime-js/lib/runtime-4eedc2bc1ab80afd.js","src/app/script/klecks/filters/rotate.ts","src/app/script/klecks/filters/gl-tilt-shift.ts","src/app/script/klecks/filters/transform.ts","src/app/script/klecks/filters/gl-blur.ts","src/app/script/klecks/filters/gl-unsharp-mask.ts","src/app/script/klecks/filters/to-alpha.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","node_modules/@parcel/runtime-js/lib/runtime-f1d94d330952b28b.js","node_modules/@parcel/runtime-js/lib/runtime-399b879a4e797bda.js","node_modules/@parcel/runtime-js/lib/runtime-d15e8bf6982fc2e4.js","node_modules/@parcel/runtime-js/lib/runtime-b21c6934e1ce53e4.js"],"sourcesContent":["import './polyfills';\r\nimport { KlApp } from './app/kl-app';\r\nimport { KL } from './klecks/kl';\r\nimport { IKlProject } from './klecks/kl.types';\r\nimport { ProjectStore } from './klecks/storage/project-store';\r\nimport { SaveReminder } from './klecks/ui/components/save-reminder';\r\nimport { klHistory } from './klecks/history/kl-history';\r\nimport { klPsdToKlProject, readPsd } from './klecks/storage/psd';\r\nimport { LANG } from './language/language';\r\n\r\nexport interface IEmbedParams {\r\n\tproject?: IKlProject;\r\n\tpsdBlob?: Blob;\r\n\tshowReminder?: boolean;\r\n\tchangeTitle?: boolean;\r\n\tcontainer?: HTMLElement;\r\n\tbottomBar?: HTMLElement;\r\n\taboutEl?: HTMLElement;\r\n\tisShare?: boolean;\r\n\thideFile?: boolean;\r\n\thelpPath?: string;\r\n\tlogoImg?: any; // app logo\r\n\tonLogo?: () => void;\r\n\tcustomSave: (blob: Blob, filename: string, onSuccess: () => void, onError: () => void) => void;\r\n\tembed?: {\r\n\t\turl: string;\r\n\t\tonSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n\t};\r\n}\r\n\r\nexport interface IReadPSD {\r\n\tblob: Blob;\r\n\tcallback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed(p: IEmbedParams) {\r\n\r\n\tlet isInitialized: boolean = false;\r\n\tlet klApp;\r\n\tconst psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n\tlet agPsd: any | 'error';\r\n\r\n\tlet loadingScreenEl = document.getElementById(\"loading-screen\");\r\n\tlet loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\r\n\tif (loadingScreenTextEl) {\r\n\t\tloadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n\t}\r\n\r\n\tfunction onProjectReady(project: IKlProject | null, projectStore: ProjectStore | null) {\r\n\t\ttry {\r\n\t\t\tif (isInitialized) {\r\n\t\t\t\tthrow new Error('Already called openProject');\r\n\t\t\t}\r\n\t\t\tisInitialized = true;\r\n\r\n\t\t\tconst saveReminder = new SaveReminder(\r\n\t\t\t\tklHistory,\r\n\t\t\t\tp.embed ? false : (p.changeTitle || false),\r\n\t\t\t\tp.embed ? false : (p.showReminder || false),\r\n\t\t\t\t() => klApp ? klApp.saveAsPsd() : null,\r\n\t\t\t\t() => klApp ? klApp.isDrawing() : false,\r\n\t\t\t\tp.embed ? null : projectStore,\r\n\t\t\t\tp.embed ? null : () => project,\r\n\t\t\t\t() => klApp ? klApp.getEl() : (p.container || document.body),\r\n\t\t\t\t() => klApp ? klApp.getBBox() : {},\r\n\t\t\t);\r\n\t\t\tklApp = new KlApp(\r\n\t\t\t\tproject,\r\n\t\t\t\t{\r\n\t\t\t\t\tsaveReminder,\r\n\t\t\t\t\tprojectStore: p.embed ? null : projectStore,\r\n\t\t\t\t\tembed: p.embed ? p.embed : undefined,\r\n\t\t\t\t\tlogoImg: p.logoImg,\r\n\t\t\t\t\tonLogo: p.onLogo,\r\n\t\t\t\t\tcustomSave: p.customSave,\r\n\t\t\t\t\thideFile: p.hideFile,\r\n\t\t\t\t\tisShare: p.isShare,\r\n\t\t\t\t\thelpPath: p.helpPath,\r\n\t\t\t\t\tbottomBar: p.bottomBar,\r\n\t\t\t\t\taboutEl: p.aboutEl,\r\n\t\t\t\t},\r\n\t\t\t\tp.container || document.body\r\n\t\t\t);\r\n\t\t\tsaveReminder.init();\r\n\r\n\t\t\tif (loadingScreenEl && loadingScreenEl.parentNode) {\r\n\t\t\t\tloadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n\t\t\t}\r\n\t\t\tloadingScreenEl = null;\r\n\t\t\tloadingScreenTextEl = null;\r\n\r\n\t\t\t(p.container || document.body).appendChild(klApp.getEl());\r\n\t\t} catch (e) {\r\n\t\t\tif (loadingScreenTextEl) {\r\n\t\t\t\tloadingScreenTextEl.textContent = ' ' + e;\r\n\t\t\t}\r\n\t\t\tif (loadingScreenEl) {\r\n\t\t\t\tloadingScreenEl.className += 'loading-screen-error';\r\n\t\t\t}\r\n\t\t\tconsole.error(e);\r\n\t\t}\r\n\t}\r\n\tlet projectStore = !p.embed ? new KL.ProjectStore() : null;\r\n\tif (p.project) {\r\n\t\tonProjectReady(p.project, projectStore);\r\n\t}\r\n\tthis.openProject = (project) => {\r\n\t\tif (!project && projectStore) {// Read Browser Storage\r\n\t\t\ttry {\r\n\t\t\t\tprojectStore.read().then((readResult) => {\r\n\t\t\t\t\tlet p: IKlProject | null = null;\r\n\t\t\t\t\tif (readResult && readResult.project) {\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tklApp.out(LANG('file-storage-restored'));\r\n\t\t\t\t\t\t}, 100);\r\n\t\t\t\t\t\tp = readResult.project;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonProjectReady(p, projectStore);\r\n\t\t\t\t}).catch((e) => {\r\n\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\tklApp && klApp.out(e);\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t\tonProjectReady(null, projectStore);\r\n\t\t\t\t})\r\n\t\t\t} catch (e) {\r\n\t\t\t\tlet message;\r\n\t\t\t\tif (e.message.indexOf('db-error') === 0) {\r\n\t\t\t\t\tmessage = 'Failed to access Browser Storage';\r\n\t\t\t\t} else if (e.message.indexOf('format-error') === 0) {\r\n\t\t\t\t\tmessage = 'Failed to restore from Browser Storage';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmessage = 'Failed to restore from Browser Storage';\r\n\t\t\t\t}\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tklApp && klApp.out(message);\r\n\t\t\t\t}, 100);\r\n\t\t\t\tonProjectReady(null, projectStore);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tonProjectReady(project, projectStore);\r\n\t\t}\r\n\t};\r\n\tthis.initError = (error: string) => {\r\n\t\tif (loadingScreenTextEl) {\r\n\t\t\tloadingScreenTextEl.textContent = ' ' + error;\r\n\t\t}\r\n\t\tif (loadingScreenEl) {\r\n\t\t\tloadingScreenEl.className += 'loading-screen-error';\r\n\t\t}\r\n\t};\r\n\tthis.getPNG = (): Blob => {\r\n\t\tif (!klApp) {\r\n\t\t\tthrow new Error('App not initialized');\r\n\t\t}\r\n\t\treturn klApp.getPNG();\r\n\t};\r\n\tthis.getPSD = async (): Promise<Blob> => {\r\n\t\tif (!klApp) {\r\n\t\t\tthrow new Error('App not initialized');\r\n\t\t}\r\n\t\treturn await klApp.getPSD();\r\n\t};\r\n\tthis.readPSDs = (psds: IReadPSD[]) => {\r\n\t\tif (psds.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst readItem = (item: IReadPSD) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst psd = agPsd.readPsd(item.blob);\r\n\t\t\t\tconst project = klPsdToKlProject(readPsd(psd));\r\n\t\t\t\titem.callback(project);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('failed to read psd', e);\r\n\t\t\t\titem.callback(null);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (!agPsd) {\r\n\t\t\tif (psdQueue.length === 0) {\r\n\t\t\t\t// load ag-psd\r\n\t\t\t\t(async () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tagPsd = await import('ag-psd');\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tagPsd = 'error';\r\n\t\t\t\t\t}\r\n\t\t\t\t\twhile (psdQueue.length) {\r\n\t\t\t\t\t\treadItem(psdQueue.shift());\r\n\t\t\t\t\t}\r\n\t\t\t\t})();\r\n\t\t\t}\r\n\t\t\tpsds.forEach(item => {\r\n\t\t\t\tpsdQueue.push(item);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tpsds.forEach(readItem);\r\n\t\t}\r\n\t};\r\n}","// import 'core-js';\nimport 'mdn-polyfills/Node.prototype.append';\nimport 'mdn-polyfills/Node.prototype.prepend';\nimport 'mdn-polyfills/String.prototype.padStart';\n\nif (!('scrollTo' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollTo', {\n        value: function (x, y) {\n            this.scrollLeft = x;\n            this.scrollTop = y;\n        }\n    });\n}\n\nif (!('scrollBy' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollBy', {\n        value: function (x, y) {\n            this.scrollLeft += x;\n            this.scrollTop += y;\n        }\n    });\n}\n\n// sometimes Android WebView has no localStorage\nif (!('localStorage' in window)) {\n    try {\n        window['localStorage'] = {\n            getItem: () => null,\n            setItem: () => {},\n            removeItem: () => {},\n        } as any;\n    } catch (e) {\n        // maybe it doesn't let me set this\n    }\n}","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","import { KL } from '../klecks/kl';\r\nimport { klHistory } from '../klecks/history/kl-history';\r\nimport { BB } from '../bb/bb';\r\nimport { showIframePopup } from '../klecks/ui/modals/show-iframe-popup';\r\n// @ts-ignore\r\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\r\n// @ts-ignore\r\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\r\n// @ts-ignore\r\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\r\n// @ts-ignore\r\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\r\n// @ts-ignore\r\nimport importImg from 'url:~/src/app/img/ui/import.svg';\r\nimport { exportType } from '../klecks/ui/tool-tabs/file-tab';\r\nimport { ToolspaceTopRow } from \"../embed/toolspace-top-row\";\r\nimport { IInitState, IKlProject, IKlPsd } from '../klecks/kl.types';\r\nimport { importFilters } from '../klecks/filters/filters-lazy';\r\nimport { base64ToBlob } from '../klecks/storage/base-64-to-blob';\r\nimport { klCanvasToPsdBlob } from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport { ProjectStore } from '../klecks/storage/project-store';\r\nimport { SaveReminder } from \"../klecks/ui/components/save-reminder\";\r\nimport { KlCanvasWorkspace } from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport { KlCanvas } from '../klecks/canvas/kl-canvas';\r\nimport { LANG } from '../language/language';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport tabEditImg from 'url:~/src/app/img/ui/tab-edit.svg';\r\n// @ts-ignore\r\nimport tabFileImg from 'url:~/src/app/img/ui/tab-file.svg';\r\n// @ts-ignore\r\nimport tabSettingsImg from 'url:~/src/app/img/ui/tab-settings.svg';\r\n// @ts-ignore\r\nimport tabLayersImg from 'url:~/src/app/img/ui/tab-layers.svg';\r\nimport { LocalStorage } from '../bb/base/local-storage';\r\n\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore | null;\r\n    logoImg?: any; // app logo\r\n    onLogo?: () => void;\r\n    customSave?: (blob: Blob, filename: string, onSuccess: () => void, onError: () => void) => void;\r\n    hideFile?: boolean;\r\n    isShare?: boolean;\r\n    helpPath?: string;\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: {\r\n        url: string;\r\n        onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    };\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport function KlApp(pProject: IKlProject | null, pOptions: IKlAppOptions, container?: HTMLElement) {\r\n    const getBBox = () => {\r\n        const width = container ? (container.clientWidth || container.offsetWidth) : window.innerWidth;\r\n        const height = container ? (container.clientHeight || container.offsetHeight) : window.innerHeight;\r\n        return {\r\n            width,\r\n            height\r\n        };\r\n    };\r\n    // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n    // but not larger than 4096 - a fairly arbitrary decision\r\n    let klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n    let collapseThreshold = 820;\r\n    let uiState: 'left' | 'right' = (pOptions.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as any;\r\n    const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n    const projectStore = pOptions.projectStore;\r\n    let klRootEl = document.createElement(\"div\");\r\n    klRootEl.className = 'g-root';\r\n    const bbox = getBBox();\r\n    let uiWidth: number = Math.max(0, bbox.width);\r\n    let uiHeight: number = Math.max(0, bbox.height);\r\n    const toolWidth = 270;\r\n    let exportType: exportType = 'png';\r\n    let klCanvas: KlCanvas = new KL.KlCanvas(\r\n        pProject ? {\r\n            projectObj: pProject\r\n        } : {\r\n            width: Math.max(10, Math.min(klMaxCanvasSize, bbox.width < collapseThreshold ? uiWidth : uiWidth - toolWidth)),\r\n            height: Math.max(10, Math.min(klMaxCanvasSize, uiHeight)),\r\n        }, pOptions.embed ? -1 : 0);\r\n    klCanvas.setHistory(klHistory);\r\n    let initState: IInitState | null = null;\r\n    let mainTabRow;\r\n\r\n    if (!pOptions.saveReminder) {\r\n        pOptions.saveReminder = { init: () => { }, reset: () => { } } as SaveReminder;\r\n    }\r\n\r\n    function translateSmoothing(s: number): number {\r\n        if (s == 1) {\r\n            return 1 - 0.5;\r\n        }\r\n        if (s == 2) {\r\n            return 1 - 0.16;\r\n        }\r\n        if (s == 3) {\r\n            return 1 - 0.035;\r\n        }\r\n        if (s == 4) {\r\n            return 1 - 0.0175;\r\n        }\r\n        if (s == 5) {\r\n            return 1 - 0.00875;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let isFirstImage = true;\r\n\r\n    if (pProject) {\r\n        pProject.layers.forEach(layer => {\r\n            layer.image = null;\r\n        });\r\n        pProject = null;\r\n    } else {\r\n        klHistory.pause(true);\r\n        klCanvas.addLayer();\r\n        klCanvas.layerFill(0, { r: 255, g: 255, b: 255 });\r\n        klHistory.pause(false);\r\n    }\r\n    try {\r\n        initState = {\r\n            canvas: new KL.KlCanvas({ copy: klCanvas }, pOptions.embed ? -1 : 0),\r\n            focus: klCanvas.getLayerCount() - 1,\r\n            brushes: {},\r\n        };\r\n    } catch (e) {\r\n        if (e.message === 'kl-create-canvas-error') {\r\n            klCanvas.destroy();\r\n        }\r\n        throw e;\r\n    }\r\n    for (let b in KL.brushes) {\r\n        if (KL.brushes.hasOwnProperty(b)) {\r\n            initState.brushes[b] = new KL.brushes[b]();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    let currentColor = new BB.RGB(0, 0, 0);\r\n    let currentBrush, currentBrushId;\r\n    let lastNonEraserBrushId = 0;\r\n    let currentLayerCtx = klCanvas.getLayerContext(klCanvas.getLayerCount() - 1);\r\n\r\n    function sizeWatcher(val) {\r\n        brushSettingService.emitSize(val);\r\n        if (klCanvasWorkspace) {\r\n            klCanvasWorkspace.setCursorSize(val * 2);\r\n        }\r\n    }\r\n\r\n    const brushSettingService = new KL.BrushSettingService(\r\n        (color) => {\r\n            klColorSlider.setColor(color);\r\n            currentBrush.setColor(color);\r\n            currentColor = BB.copyObj(color);\r\n        },\r\n        (size) => {\r\n            currentBrush.setSize(size);\r\n            klCanvasWorkspace.setCursorSize(size * 2);\r\n        },\r\n        (opacity) => {\r\n            currentBrush.setOpacity(opacity);\r\n        },\r\n        () => klColorSlider.getColor(),\r\n        () => brushUiObj[currentBrushId].getSize(),\r\n        () => brushUiObj[currentBrushId].getOpacity(),\r\n        () => {\r\n            return {\r\n                sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n            };\r\n        }\r\n    );\r\n\r\n    let lineSmoothing = new BB.EventChain.LineSmoothing({\r\n        smoothing: translateSmoothing(1),\r\n    });\r\n    let lineSanitizer = new BB.EventChain.LineSanitizer();\r\n\r\n    let drawEventChain = new BB.EventChain.EventChain({\r\n        chainArr: [\r\n            lineSanitizer,\r\n            lineSmoothing\r\n        ],\r\n    });\r\n\r\n    drawEventChain.setChainOut(function (event) {\r\n        if (event.type === 'down') {\r\n            toolspace.style.pointerEvents = 'none';\r\n            currentBrush.startLine(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'move') {\r\n            currentBrush.goLine(event.x, event.y, event.pressure, false, event.isCoalesced)\r\n            klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'up') {\r\n            toolspace.style.pointerEvents = '';\r\n            currentBrush.endLine();\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n        if (event.type === 'line') {\r\n            currentBrush.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n            klCanvasWorkspace.requestFrame();\r\n        }\r\n    });\r\n\r\n    let textToolSettings = {\r\n        size: 20,\r\n        align: 'left' as ('left' | 'center' | 'right'),\r\n        isBold: false,\r\n        isItalic: false,\r\n        font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n        opacity: 1\r\n    };\r\n\r\n    const klCanvasWorkspace: KlCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n        klCanvas: klCanvas,\r\n        width: Math.max(0, uiWidth - toolWidth),\r\n        height: uiHeight,\r\n        onDraw: drawEventChain.chainIn,\r\n        onPick: function (rgbObj, isDragDone) {\r\n            brushSettingService.setColor(rgbObj);\r\n            if (isDragDone) {\r\n                klColorSlider.pickingDone();\r\n                klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            }\r\n        },\r\n        onFill: function (canvasX, canvasY) {\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n            klCanvas.floodFill(layerIndex, canvasX, canvasY, klColorSlider.getColor(), fillUi.getOpacity(), fillUi.getTolerance(), fillUi.getSample(), fillUi.getGrow(), fillUi.getContiguous());\r\n            klCanvasWorkspace.requestFrame();\r\n        },\r\n        onText: function (canvasX, canvasY, angleRad) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n\r\n            KL.textToolDialog({\r\n                klRootEl: klRootEl,\r\n                bbox: getBBox(),\r\n                klCanvas: klCanvas,\r\n                layerIndex: klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                x: canvasX,\r\n                y: canvasY,\r\n                angleRad: angleRad,\r\n                color: klColorSlider.getColor(),\r\n                secondaryColor: klColorSlider.getSecondaryRGB(),\r\n                size: textToolSettings.size,\r\n                align: textToolSettings.align,\r\n                isBold: textToolSettings.isBold,\r\n                isItalic: textToolSettings.isItalic,\r\n                font: textToolSettings.font,\r\n                opacity: textToolSettings.opacity,\r\n                onConfirm: function (val) {\r\n\r\n                    let colorRGBA = val.color;\r\n                    colorRGBA.a = val.opacity;\r\n\r\n                    textToolSettings.size = val.size;\r\n                    textToolSettings.align = val.align;\r\n                    textToolSettings.isBold = val.isBold;\r\n                    textToolSettings.isItalic = val.isItalic;\r\n                    textToolSettings.font = val.font;\r\n                    textToolSettings.opacity = val.opacity;\r\n\r\n                    let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    klCanvas.text(layerIndex, {\r\n                        textStr: val.textStr,\r\n                        x: val.x,\r\n                        y: val.y,\r\n                        size: val.size,\r\n                        font: val.font,\r\n                        align: val.align,\r\n                        isBold: val.isBold,\r\n                        isItalic: val.isItalic,\r\n                        angleRad: angleRad,\r\n                        color: BB.ColorConverter.toRgbaStr(colorRGBA)\r\n                    });\r\n                    klCanvasWorkspace.requestFrame();\r\n                }\r\n            });\r\n\r\n        },\r\n        onShape: function (typeStr, canvasX, canvasY, angleRad) {\r\n            if (typeStr === 'down') {\r\n                shapeTool.onDown(canvasX, canvasY, angleRad);\r\n            }\r\n            if (typeStr === 'move') {\r\n                shapeTool.onMove(canvasX, canvasY);\r\n            }\r\n            if (typeStr === 'up') {\r\n                shapeTool.onUp(canvasX, canvasY);\r\n            }\r\n        },\r\n\r\n        onViewChange: function (viewChangeObj) {\r\n\r\n            if (viewChangeObj.changed.includes('scale')) {\r\n                statusOverlay.out({\r\n                    type: 'transform',\r\n                    scale: viewChangeObj.scale,\r\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\r\n                });\r\n            }\r\n\r\n            toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== klCanvasWorkspace.getMaxScale());\r\n            toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== klCanvasWorkspace.getMinScale());\r\n\r\n            handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n        },\r\n        onUndo: function () {\r\n            if (klHistory.canUndo()) {\r\n                if (undoRedoCatchup.undo()) {\r\n                    statusOverlay.out(LANG('undo'), true);\r\n                }\r\n            }\r\n        },\r\n        onRedo: function () {\r\n            if (klHistory.canRedo()) {\r\n                if (undoRedoCatchup.redo()) {\r\n                    statusOverlay.out(LANG('redo'), true);\r\n                }\r\n            }\r\n        },\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, event, comboStr) {\r\n            if (KL.dialogCounter.get() > 0) {\r\n                return;\r\n            }\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n\r\n            let isDrawing = lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n            if (isDrawing) {\r\n                return;\r\n            }\r\n\r\n            if (comboStr === 'plus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1 / 8 : 1 / 2);\r\n            }\r\n            if (comboStr === 'minus') {\r\n                klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1 / 8 : -1 / 2);\r\n            }\r\n            if (comboStr === 'home') {\r\n                klCanvasWorkspace.fitView();\r\n            }\r\n            if (comboStr === 'end') {\r\n                klCanvasWorkspace.resetView(true);\r\n            }\r\n            if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.undo();\r\n            }\r\n            if (\r\n                ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                (\r\n                    (\r\n                        BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                        BB.sameKeys('cmd+shift+z', comboStr)\r\n                    ) && keyStr === 'z'\r\n                )\r\n            ) {\r\n                event.preventDefault();\r\n                undoRedoCatchup.redo();\r\n            }\r\n            if (!pOptions.embed) {\r\n                if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    saveToComputer.save();\r\n                }\r\n                if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n\r\n                    (async () => {\r\n                        if (projectStore) {\r\n                            let success = true;\r\n                            try {\r\n                                await projectStore.store(klCanvas.getProject());\r\n                            } catch (e) {\r\n                                success = false;\r\n                                setTimeout(() => {\r\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                                }, 0);\r\n                                statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                            }\r\n                            if (success) {\r\n                                pOptions.saveReminder.reset();\r\n                                statusOverlay.out(LANG('file-storage-stored'), true);\r\n                            }\r\n\r\n                        }\r\n                    })();\r\n                }\r\n                if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    copyToClipboard(true);\r\n                }\r\n            }\r\n            if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                event.preventDefault();\r\n            }\r\n\r\n\r\n            if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.translateView(1, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.translateView(-1, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    klCanvasWorkspace.translateView(0, 1);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    klCanvasWorkspace.translateView(0, -1);\r\n                }\r\n            }\r\n\r\n\r\n            if (['r+left', 'r+right'].includes(comboStr)) {\r\n                if (keyStr === 'left') {\r\n                    klCanvasWorkspace.setAngle(-15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n                if (keyStr === 'right') {\r\n                    klCanvasWorkspace.setAngle(15, true);\r\n                    handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n                }\r\n            }\r\n            if (['r+up'].includes(comboStr)) {\r\n                klCanvasWorkspace.setAngle(0);\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n            }\r\n\r\n\r\n            if (comboStr === 'sqbr_open') {\r\n                currentBrush.decreaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'sqbr_close') {\r\n                currentBrush.increaseSize(0.03 / klCanvasWorkspace.getScale());\r\n            }\r\n            if (comboStr === 'enter') {\r\n                klCanvas.layerFill(klCanvas.getLayerIndex(currentLayerCtx.canvas), klColorSlider.getColor());\r\n                statusOverlay.out(LANG('filled'), true);\r\n            }\r\n            if (['delete', 'backspace'].includes(comboStr)) {\r\n                let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                if (layerIndex === 0 && !brushUiObj.eraserBrush.getIsTransparentBg()) {\r\n                    klCanvas.layerFill(layerIndex, { r: 255, g: 255, b: 255 }, 'source-in');\r\n                } else {\r\n                    klCanvas.clearLayer(layerIndex);\r\n                }\r\n                statusOverlay.out(LANG('cleared-layer'), true);\r\n            }\r\n            if (comboStr === 'e') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open('eraserBrush');\r\n            }\r\n            if (comboStr === 'b') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('draw');\r\n                toolspaceToolRow.setActive('draw');\r\n                mainTabRow.open('draw');\r\n                updateMainTabVisibility();\r\n                brushTabRow.open(lastNonEraserBrushId);\r\n            }\r\n            if (comboStr === 'g') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('fill');\r\n                toolspaceToolRow.setActive('fill');\r\n                mainTabRow.open('fill');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 't') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('text');\r\n                toolspaceToolRow.setActive('text');\r\n                mainTabRow.open('text');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'u') {\r\n                event.preventDefault();\r\n                klCanvasWorkspace.setMode('shape');\r\n                toolspaceToolRow.setActive('shape');\r\n                mainTabRow.open('shape');\r\n                updateMainTabVisibility();\r\n            }\r\n            if (comboStr === 'x') {\r\n                event.preventDefault();\r\n                klColorSlider.swapColors();\r\n            }\r\n\r\n\r\n        },\r\n        onUp: function (keyStr, event) {\r\n        }\r\n    });\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    function importFinishedLoading(\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ) {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"error\",\r\n                message: LANG('import-broken-file'),\r\n                buttons: [\"Ok\"],\r\n            });\r\n            return;\r\n        }\r\n\r\n        function getResizedDimensions(width, height) {\r\n            let w = parseInt(width);\r\n            let h = parseInt(height);\r\n            if (w > klMaxCanvasSize) {\r\n                h = klMaxCanvasSize / w * h;\r\n                w = klMaxCanvasSize;\r\n            }\r\n            if (h > klMaxCanvasSize) {\r\n                w = klMaxCanvasSize / h * w;\r\n                h = klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h\r\n            }\r\n        }\r\n\r\n        function importAsImage(canvas) {\r\n            let resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            let tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            let tempCanvasCtx = tempCanvas.getContext('2d');\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename\r\n            });\r\n\r\n            layerManager.update(0);\r\n            setCurrentLayer(klCanvas.getLayer(0));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        function importAsImagePsd(convertedPsdObj: IKlPsd, cropObj?) {\r\n\r\n            // crop\r\n            function crop(targetCanvas, cropCanvas, cropObj) {\r\n                cropCanvas.width = cropCanvas.width;\r\n                cropCanvas.getContext('2d').drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                targetCanvas.getContext('2d').drawImage(cropCanvas, 0, 0);\r\n            }\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width || cropObj.height !== convertedPsdObj.height)) {\r\n                let cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        let item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            let resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    let item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers\r\n                });\r\n            } else {\r\n                layerIndex = klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas\r\n                });\r\n            }\r\n            layerManager.update(layerIndex);\r\n            setCurrentLayer(klCanvas.getLayer(layerIndex));\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n            isFirstImage = false;\r\n        }\r\n\r\n        function importAsLayer(canvas) {\r\n            KL.showImportAsLayerDialog({\r\n                target: klRootEl,\r\n                bbox: getBBox(),\r\n                klCanvas: klCanvas,\r\n                importImage: canvas,\r\n                callback: function (transformObj, isPixelated: boolean) {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    klCanvas.addLayer();\r\n                    let layers = klCanvas.getLayers();\r\n                    let activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    let activeLayerContext = klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    setCurrentLayer(klCanvas.getLayer(activeLayerIndex));\r\n                    layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: [\"misc\"],\r\n                        action: \"importImage\",\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename]\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: klRootEl,\r\n                bbox: getBBox(),\r\n                maxSize: klMaxCanvasSize,\r\n                callback: function (res) {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function onPaste(e) {\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        function retrieveImageFromClipboardAsBlob(pasteEvent, callback) {\r\n            if (pasteEvent.clipboardData == false) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            }\r\n\r\n            let items = pasteEvent.clipboardData.items;\r\n\r\n            if (items == undefined) {\r\n                if (typeof (callback) == \"function\") {\r\n                    callback(undefined);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < items.length; i++) {\r\n                    if (items[i].type.indexOf(\"image\") == -1) {\r\n                        continue;\r\n                    }\r\n                    let blob = items[i].getAsFile();\r\n\r\n                    if (typeof (callback) == \"function\") {\r\n                        callback(blob);\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e, function (imageBlob) {\r\n                // If there's an image, display it in the canvas\r\n                if (imageBlob) {\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        URL.revokeObjectURL(img.src);\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    let URLObj = window.URL || window.webkitURL;\r\n                    img.src = URLObj.createObjectURL(imageBlob);\r\n                }\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString(function (pasteStr) {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    let img = new Image();\r\n                    img.onload = function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img\r\n                        }, null, 'default');\r\n                    };\r\n                    img.onerror = function (e) {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    let rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    brushSettingService.setColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    function handleFileSelect(files, optionStr) {\r\n\r\n        function showWarningPsdFlattened() {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                type: \"warning\",\r\n                message: LANG('import-psd-unsupported') + \"<br /><br />\",\r\n                buttons: [\"Ok\"],\r\n            });\r\n        }\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            let extension = file.name.split(\".\");\r\n            extension = extension[extension.length - 1].toLowerCase();\r\n            if (extension === \"psd\") {\r\n\r\n                (function (f) {\r\n                    let loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    let maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    let maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            type: \"error\",\r\n                            message: \"File too big. Unable to import.<br /><br />\",\r\n                            buttons: [\"Ok\"],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    let doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: function (result) {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closefunc: function (f) {\r\n                                closeLoader = f;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n\r\n                    let reader = new FileReader();\r\n                    reader.onload = function (readerResult) {\r\n\r\n                        KL.loadAgPsd().then(function (agPsdLazy) {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: klRootEl,\r\n                                        type: \"error\",\r\n                                        //message: \"Image exceeds maximum dimensions of \" + maxResolution + \" x \" + maxResolution + \" pixels. Unable to import.\"\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + \"<br /><br />\"\r\n                                            + LANG('import-psd-size') + \": \" + psd.width + \" x \" + psd.height + ' pixels'\r\n                                            + \"<br /><br />\"\r\n                                        ,\r\n                                        buttons: [\"Ok\"],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    let convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n\r\n                            } catch (e) {\r\n                                if (closeLoader) {\r\n                                    closeLoader();\r\n                                }\r\n                                KL.popup({\r\n                                    target: klRootEl,\r\n                                    type: \"error\",\r\n                                    message: \"Failed to load PSD.<br /><br />\",\r\n                                    buttons: [\"Ok\"],\r\n                                });\r\n                            }\r\n                        }).catch(() => {\r\n                            closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                (function (f) {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    let url = window.URL.createObjectURL(f);\r\n                    let im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, function () {\r\n                        importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n\r\n    if (!pOptions.embed) {\r\n        new KL.KlImageDropper({\r\n            target: klRootEl,\r\n            onDrop: function (files, optionStr) {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n                handleFileSelect(files, optionStr);\r\n            },\r\n            enabledTest: function () {\r\n                return KL.dialogCounter.get() === 0;\r\n            }\r\n        });\r\n\r\n        BB.addEventListener(window, 'paste', onPaste, false);\r\n    }\r\n\r\n    const brushUiObj: any = {};\r\n\r\n    // create brush UIs\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            let ui = new KL.brushesUI[b].Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: function (opacity) {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider\r\n                    });\r\n                }\r\n            });\r\n            brushUiObj[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        }\r\n    }\r\n\r\n\r\n    BB.css(klRootEl, {\r\n        position: 'absolute',\r\n        left: '0',\r\n        top: '0',\r\n        right: '0',\r\n        bottom: '0'\r\n    });\r\n\r\n    let statusOverlay = new KL.StatusOverlay(klRootEl);\r\n\r\n    const toolspace = BB.el({});\r\n    const toolspaceInner = BB.el({\r\n        parent: toolspace,\r\n    });\r\n    toolspace.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n    toolspace.onclick = BB.handleClick;\r\n\r\n\r\n    let toolspaceCollapser = new KL.ToolspaceCollapser({\r\n        onChange: function () {\r\n            updateCollapse();\r\n        }\r\n    });\r\n    function updateCollapse() {\r\n\r\n        //collapser\r\n        if (uiWidth < collapseThreshold) {\r\n            toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            toolspaceCollapser.setDirection(uiState);\r\n            if (toolspaceCollapser.isOpen()) {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '271px'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'block';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n                statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (uiState === 'left') {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                } else {\r\n                    BB.css(toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0'\r\n                    });\r\n                    BB.css(klCanvasWorkspace.getElement(), {\r\n                        left: '0'\r\n                    });\r\n                }\r\n                toolspace.style.display = 'none';\r\n                klCanvasWorkspace.setSize(Math.max(0, uiWidth), uiHeight);\r\n                statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            toolspaceCollapser.getElement().style.display = 'none';\r\n            if (uiState === 'left') {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '271px'\r\n                });\r\n            } else {\r\n                BB.css(klCanvasWorkspace.getElement(), {\r\n                    left: '0'\r\n                });\r\n            }\r\n            toolspace.style.display = 'block';\r\n            klCanvasWorkspace.setSize(Math.max(0, uiWidth - toolWidth), uiHeight);\r\n            statusOverlay.setWide(false);\r\n\r\n        }\r\n    }\r\n    updateCollapse();\r\n\r\n    function updateUi() {\r\n        if (uiState === 'left') {\r\n            BB.css(toolspace, {\r\n                left: '0',\r\n                right: '',\r\n                borderLeft: 'none',\r\n                borderRight: '1px solid rgb(135, 135, 135)'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '271px'\r\n            });\r\n        } else {\r\n            BB.css(toolspace, {\r\n                left: '',\r\n                right: '0',\r\n                borderLeft: '1px solid rgb(135, 135, 135)',\r\n                borderRight: 'none'\r\n            });\r\n            BB.css(klCanvasWorkspace.getElement(), {\r\n                left: '0'\r\n            });\r\n        }\r\n        statusOverlay.setUiState(uiState);\r\n        layerPreview.setUiState('' + uiState);\r\n        layerManager.setUiState('' + uiState);\r\n        updateCollapse();\r\n        toolspaceScroller.updateUiState(uiState);\r\n    }\r\n\r\n\r\n\r\n    let overlayToolspace;\r\n    setTimeout(function () {\r\n        overlayToolspace = new KL.OverlayToolspace({\r\n            enabledTest: function () {\r\n                return KL.dialogCounter.get() === 0 && !lineSanitizer.getIsDrawing();\r\n            },\r\n            brushSettingService,\r\n        });\r\n        klRootEl.appendChild(overlayToolspace.getElement());\r\n    }, 0);\r\n\r\n    BB.append(klRootEl, [klCanvasWorkspace.getElement(), toolspace, toolspaceCollapser.getElement()]);\r\n\r\n    BB.css(toolspace, {\r\n        position: \"absolute\",\r\n        right: '0',\r\n        top: '0',\r\n        bottom: '0',\r\n        width: (toolWidth - 1) + \"px\",\r\n\r\n        overflow: \"hidden\",\r\n        backgroundColor: \"#ddd\",\r\n        borderLeft: \"1px solid rgb(135, 135, 135)\",\r\n        userSelect: 'none',\r\n        touchAction: 'none'\r\n    });\r\n\r\n    let toolspaceTopRow;\r\n    if (pOptions.embed) {\r\n        toolspaceTopRow = new ToolspaceTopRow({\r\n            onHelp: () => {\r\n                showIframePopup(pOptions.embed.url + '/help.html', !!pOptions.embed, klRootEl, getBBox());\r\n            },\r\n            onSubmit: () => {\r\n                KL.popup({\r\n                    target: klRootEl,\r\n                    message: LANG('submit-prompt'),\r\n                    buttons: [LANG('submit'), 'Cancel'],\r\n                    callback: async (result) => {\r\n                        if (result !== LANG('submit')) {\r\n                            return;\r\n                        }\r\n\r\n                        let overlay = BB.el({\r\n                            parent: klRootEl,\r\n                            className: 'upload-overlay',\r\n                            content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                        });\r\n\r\n                        pOptions.embed.onSubmit(\r\n                            () => {\r\n                                pOptions.saveReminder.reset();\r\n                                klRootEl.removeChild(overlay);\r\n                            },\r\n                            () => {\r\n                                klRootEl.removeChild(overlay);\r\n                            });\r\n                    }\r\n                });\r\n            },\r\n            onLeftRight: () => {\r\n                uiState = uiState === 'left' ? 'right' : 'left';\r\n                updateUi();\r\n            },\r\n        });\r\n    } else {\r\n        toolspaceTopRow = new KL.ToolspaceTopRow({\r\n            logoImg: pOptions.logoImg,\r\n            onLogo: pOptions.onLogo,\r\n            onNew: function () {\r\n                showNewImageDialog();\r\n            },\r\n            onImport: function () {\r\n                fileTab && fileTab.triggerImport();\r\n            },\r\n            onSave: function () {\r\n                saveToComputer.save();\r\n            },\r\n            onShare: pOptions.isShare ? function () {\r\n                shareImage();\r\n            } : null,\r\n            onHelp: pOptions.helpPath ? function () {\r\n                showIframePopup(pOptions.helpPath + '/help.html', !!pOptions.embed, klRootEl, getBBox());\r\n            } : null,\r\n        });\r\n    }\r\n    BB.addClassName(toolspaceTopRow.getElement(), 'toolspace-row-shadow');\r\n    toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n    toolspaceInner.appendChild(toolspaceTopRow.getElement());\r\n\r\n    let toolspaceToolRow = new KL.ToolspaceToolRow({\r\n        klRootEl: klRootEl,\r\n        onActivate: function (activeStr) {\r\n            if (activeStr === 'draw') {\r\n                klCanvasWorkspace.setMode('draw');\r\n            } else if (activeStr === 'hand') {\r\n                klCanvasWorkspace.setMode('hand');\r\n            } else if (activeStr === 'fill') {\r\n                klCanvasWorkspace.setMode('fill');\r\n            } else if (activeStr === 'text') {\r\n                klCanvasWorkspace.setMode('text');\r\n            } else if (activeStr === 'shape') {\r\n                klCanvasWorkspace.setMode('shape');\r\n            } else {\r\n                throw new Error('unknown activeStr');\r\n            }\r\n            mainTabRow.open(activeStr);\r\n            updateMainTabVisibility();\r\n            klColorSlider.pickingDone();\r\n        },\r\n        onZoomIn: function () {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1 / 8 : 1 / 2);\r\n        },\r\n        onZoomOut: function () {\r\n            klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1 / 8 : -1 / 2);\r\n        },\r\n        onUndo: function () {\r\n            undoRedoCatchup.undo();\r\n        },\r\n        onRedo: function () {\r\n            undoRedoCatchup.redo();\r\n        }\r\n    });\r\n    toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    klHistory.addListener(function () {\r\n        toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n        toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n    });\r\n    BB.addClassName(toolspaceToolRow.getElement(), 'toolspace-row-shadow');\r\n    toolspaceInner.appendChild(toolspaceToolRow.getElement());\r\n\r\n    let klColorSlider;\r\n\r\n    function setCurrentBrush(brushId) {\r\n        if (brushId !== 'eraserBrush') {\r\n            lastNonEraserBrushId = brushId;\r\n        }\r\n\r\n        if (klColorSlider) {\r\n            if (brushId === 'eraserBrush') {\r\n                klColorSlider.enable(false);\r\n            } else {\r\n                klColorSlider.enable(true);\r\n            }\r\n        }\r\n\r\n        currentBrushId = brushId;\r\n        currentBrush = brushUiObj[brushId];\r\n        currentBrush.setColor(currentColor);\r\n        currentBrush.setContext(currentLayerCtx);\r\n        klCanvasWorkspace.setMode('draw');\r\n        toolspaceToolRow.setActive('draw');\r\n        updateMainTabVisibility();\r\n    }\r\n\r\n    function setCurrentLayer(layer) { //BrushContext(p_context) {\r\n        currentLayerCtx = layer.context;\r\n        currentBrush.setContext(layer.context);\r\n        layerPreview.setLayer(layer);\r\n    }\r\n\r\n    function setBrushColor(p_color) {\r\n        currentColor = p_color;\r\n        currentBrush.setColor(p_color);\r\n        brushSettingService.emitColor(p_color);\r\n        klColorSlider.pickingDone();\r\n    }\r\n\r\n    klColorSlider = new KL.KlColorSlider({\r\n        width: 250,\r\n        height: 30,\r\n        svHeight: 100,\r\n        startValue: new BB.RGB(0, 0, 0),\r\n        onPick: setBrushColor,\r\n        klRootEl: klRootEl\r\n    });\r\n    klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n    klColorSlider.setPickCallback(function (doPick) {\r\n\r\n        if (doPick) {\r\n            klCanvasWorkspace.setMode('pick');\r\n        } else {\r\n            klCanvasWorkspace.setMode(toolspaceToolRow.getActive());\r\n            updateMainTabVisibility();\r\n        }\r\n\r\n    });\r\n    let brushDiv = document.createElement(\"div\");\r\n    let colorDiv = document.createElement(\"div\");\r\n    BB.css(colorDiv, {\r\n        margin: '10px',\r\n        display: 'flex',\r\n        flexWrap: 'wrap',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'flex-end'\r\n    });\r\n    let toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n        smoothing: 1,\r\n        onSelect: function (v) {\r\n            lineSmoothing.setSmoothing(translateSmoothing(v));\r\n        }\r\n    });\r\n\r\n\r\n    brushDiv.appendChild(colorDiv);\r\n    BB.append(\r\n        colorDiv,\r\n        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n    );\r\n\r\n    let brushTabRow = new KL.TabRow({\r\n        initialId: 'penBrush',\r\n        useAccent: true,\r\n        tabArr: (function () {\r\n            let result = [];\r\n\r\n            function createTab(keyStr) {\r\n                return {\r\n                    id: keyStr,\r\n                    image: KL.brushesUI[keyStr].image,\r\n                    title: KL.brushesUI[keyStr].tooltip,\r\n                    onOpen: function () {\r\n                        brushUiObj[keyStr].getElement().style.display = 'block';\r\n                        setCurrentBrush(keyStr);\r\n                        klColorSlider.pickingDone();\r\n                        brushSettingService.emitSliderConfig({\r\n                            sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                            opacitySlider: KL.brushesUI[keyStr].opacitySlider\r\n                        });\r\n                        sizeWatcher(brushUiObj[keyStr].getSize());\r\n                        brushSettingService.emitOpacity(brushUiObj[keyStr].getOpacity());\r\n                    },\r\n                    onClose: function () {\r\n                        brushUiObj[keyStr].getElement().style.display = 'none';\r\n                    }\r\n                };\r\n            }\r\n\r\n            let keyArr = Object.keys(brushUiObj);\r\n            for (let i = 0; i < keyArr.length; i++) {\r\n                result.push(createTab(keyArr[i]));\r\n            }\r\n            return result;\r\n        })()\r\n    });\r\n    brushDiv.appendChild(brushTabRow.getElement());\r\n    for (let b in KL.brushesUI) {\r\n        if (KL.brushesUI.hasOwnProperty(b)) {\r\n            brushDiv.appendChild(brushUiObj[b].getElement());\r\n        }\r\n    }\r\n\r\n    const handUi = new KL.HandUi({\r\n        scale: 1,\r\n        angleDeg: 0,\r\n        onReset: function () {\r\n            klCanvasWorkspace.resetView(true);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onFit: function () {\r\n            klCanvasWorkspace.fitView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n        onAngleChange: function (angleDeg, isRelative) {\r\n            klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        },\r\n    });\r\n\r\n    let fillUi = new KL.FillUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let textUi = new KL.TextUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeUi = new KL.ShapeUi({\r\n        colorSlider: klColorSlider\r\n    });\r\n\r\n    let shapeTool = new KL.ShapeTool({\r\n        onShape: function (isDone, x1, y1, x2, y2, angleRad) {\r\n\r\n            let layerIndex = klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n            let shapeObj: any = {\r\n                type: shapeUi.getShape(),\r\n                x1: x1,\r\n                y1: y1,\r\n                x2: x2,\r\n                y2: y2,\r\n                angleRad: angleRad,\r\n                isOutwards: shapeUi.getIsOutwards(),\r\n                opacity: shapeUi.getOpacity(),\r\n                isEraser: shapeUi.getIsEraser()\r\n            };\r\n            if (shapeUi.getShape() === 'line') {\r\n                shapeObj.strokeRgb = klColorSlider.getColor();\r\n                shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n            } else {\r\n                shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                if (shapeUi.getMode() === 'stroke') {\r\n                    shapeObj.strokeRgb = klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                } else {\r\n                    shapeObj.fillRgb = klColorSlider.getColor();\r\n                }\r\n            }\r\n\r\n            if (isDone) {\r\n                klCanvas.setComposite(layerIndex, null);\r\n                klCanvas.drawShape(layerIndex, shapeObj);\r\n            } else {\r\n                klCanvas.setComposite(layerIndex, {\r\n                    draw: function (ctx) {\r\n                        KL.drawShape(ctx, shapeObj);\r\n                    }\r\n                });\r\n            }\r\n            klCanvasWorkspace.requestFrame();\r\n\r\n        }\r\n    });\r\n\r\n    const layerManager = KL.klLayerManager(klCanvas, function (val) {\r\n        setCurrentLayer(klCanvas.getLayer(val));\r\n        klHistory.push({\r\n            tool: [\"misc\"],\r\n            action: \"focusLayer\",\r\n            params: [val]\r\n        });\r\n    }, klRootEl) as any;\r\n    const layerPreview = new KL.LayerPreview({\r\n        klRootEl: klRootEl,\r\n        onClick: function () {\r\n            mainTabRow.open('layers');\r\n        }\r\n    });\r\n    layerPreview.setIsVisible(uiHeight >= 579);\r\n    layerPreview.setLayer(klCanvas.getLayer(klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n    const filterTab = new KL.FilterTab(\r\n        this,\r\n        klColorSlider,\r\n        layerManager,\r\n        setCurrentLayer,\r\n        klCanvasWorkspace,\r\n        handUi,\r\n        () => { //get current color\r\n            return currentColor;\r\n        },\r\n        () => { // get max canvas size\r\n            return klMaxCanvasSize;\r\n        },\r\n        () => { // get kl canvas\r\n            return klCanvas;\r\n        },\r\n        () => { // get current layer ctx\r\n            return currentLayerCtx;\r\n        },\r\n        !!pOptions.embed,\r\n        statusOverlay,\r\n    );\r\n\r\n    const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n        brushUiObj,\r\n        layerPreview,\r\n        layerManager,\r\n        handUi,\r\n        klCanvasWorkspace,\r\n        () => {\r\n            if (!initState) {\r\n                throw new Error('initState not initialized');\r\n            }\r\n            return initState;\r\n        },\r\n        () => klCanvas,\r\n        () => currentLayerCtx,\r\n        (clctx) => {\r\n            currentLayerCtx = clctx;\r\n        },\r\n        () => currentBrush,\r\n    );\r\n    klHistory.addListener((p) => {\r\n        undoRedoCatchup.catchup(p);\r\n    });\r\n\r\n    function showNewImageDialog() {\r\n        KL.newImageDialog({\r\n            klRootEl: klRootEl,\r\n            currentColor: currentColor,\r\n            secondaryColor: klColorSlider.getSecondaryRGB(),\r\n            maxCanvasSize: klMaxCanvasSize,\r\n            canvasWidth: klCanvas.getWidth(),\r\n            canvasHeight: klCanvas.getHeight(),\r\n            workspaceWidth: getBBox().width < collapseThreshold ? uiWidth : uiWidth - toolWidth,\r\n            workspaceHeight: uiHeight,\r\n            onConfirm: function (width, height, color) {\r\n                klCanvas.reset({\r\n                    width: width,\r\n                    height: height,\r\n                    color: color.a === 1 ? color : null\r\n                });\r\n\r\n                layerManager.update(0);\r\n                setCurrentLayer(klCanvas.getLayer(0));\r\n                klCanvasWorkspace.resetView();\r\n                handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n\r\n                isFirstImage = false;\r\n            },\r\n            onCancel: function () { }\r\n        });\r\n    }\r\n\r\n    function shareImage(callback?) {\r\n        BB.shareCanvas({\r\n            canvas: klCanvas.getCompleteCanvas(1),\r\n            fileName: BB.getDate() + filenameBase + '.png',\r\n            title: BB.getDate() + filenameBase + '.png',\r\n            callback: callback ? callback : function () { }\r\n        });\r\n    }\r\n\r\n    const saveToComputer = new KL.SaveToComputer(\r\n        typeof pOptions.customSave === 'function' ? (blob, flename) => {\r\n            KL.popup({\r\n                target: klRootEl,\r\n                message: LANG('submit-prompt'),\r\n                buttons: [LANG('submit'), 'Cancel'],\r\n                callback: async (result) => {\r\n                    if (result !== LANG('submit')) {\r\n                        return;\r\n                    }\r\n\r\n                    let overlay = BB.el({\r\n                        parent: klRootEl,\r\n                        className: 'upload-overlay',\r\n                        content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                    });\r\n                    pOptions.customSave(blob, flename,\r\n                        () => {\r\n                            pOptions.saveReminder.reset();\r\n                            klRootEl.removeChild(overlay);\r\n                        },\r\n                        () => {\r\n                            klRootEl.removeChild(overlay);\r\n                        });\r\n                }\r\n            });\r\n        } : null,\r\n        pOptions.saveReminder,\r\n        klRootEl,\r\n        () => exportType,\r\n        () => klCanvas,\r\n        filenameBase,\r\n    );\r\n\r\n    const fileTab = pOptions.embed ? null : new KL.FileTab(\r\n        klRootEl,\r\n        projectStore,\r\n        () => klCanvas.getProject(),\r\n        exportType,\r\n        (type) => {\r\n            exportType = type;\r\n        },\r\n        handleFileSelect,\r\n        () => {\r\n            saveToComputer.save();\r\n        },\r\n        showNewImageDialog,\r\n        pOptions.isShare ? shareImage : null,\r\n        () => { // on upload\r\n            KL.imgurUpload(klCanvas, klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null,);\r\n        },\r\n        copyToClipboard,\r\n        pOptions.saveReminder,\r\n    );\r\n\r\n    const settingsTab = new KL.SettingsTab(\r\n        () => {\r\n            uiState = uiState === 'left' ? 'right' : 'left';\r\n            updateUi();\r\n            if (!pOptions.embed) {\r\n                LocalStorage.setItem('uiState', uiState);\r\n            }\r\n        },\r\n        pOptions.aboutEl,\r\n        klRootEl,\r\n    );\r\n\r\n    mainTabRow = new KL.TabRow({\r\n        initialId: 'draw',\r\n        tabArr: [\r\n            {\r\n                id: 'draw',\r\n                title: LANG('tool-brush'),\r\n                image: toolPaintImg,\r\n                onOpen: function () {\r\n                    if (currentBrushId === 'eraserBrush') {\r\n                        klColorSlider.enable(false);\r\n                    }\r\n                    BB.append(\r\n                        colorDiv,\r\n                        [klColorSlider.getElement(), klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                    );\r\n                    brushDiv.style.display = 'block';\r\n                },\r\n                onClose: function () {\r\n                    brushDiv.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'hand',\r\n                title: LANG('tool-hand'),\r\n                image: toolHandImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    handUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    handUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'fill',\r\n                title: LANG('tool-paint-bucket'),\r\n                image: toolFillImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    klColorSlider.enable(true);\r\n                    fillUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    fillUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'text',\r\n                title: LANG('tool-text'),\r\n                image: toolTextImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    klColorSlider.enable(true);\r\n                    textUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    textUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'shape',\r\n                title: LANG('tool-shape'),\r\n                image: toolShapeImg,\r\n                isVisible: false,\r\n                onOpen: function () {\r\n                    klColorSlider.enable(true);\r\n                    shapeUi.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    shapeUi.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'layers',\r\n                title: LANG('tab-layers'),\r\n                image: tabLayersImg,\r\n                onOpen: function () {\r\n                    layerManager.update();\r\n                    layerManager.style.display = 'block';\r\n                },\r\n                onClose: function () {\r\n                    layerManager.style.display = 'none';\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            },\r\n            {\r\n                id: 'edit',\r\n                title: LANG('tab-edit'),\r\n                image: tabEditImg,\r\n                onOpen: function () {\r\n                    filterTab.show();\r\n                },\r\n                onClose: function () {\r\n                    filterTab.hide();\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                },\r\n            },\r\n            {\r\n                id: 'file',\r\n                title: LANG('tab-file'),\r\n                image: tabFileImg,\r\n                isVisible: !pOptions.hideFile && !!fileTab,\r\n                onOpen: function () {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'block';\r\n                    fileTab.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    if (!fileTab) {\r\n                        return;\r\n                    }\r\n                    fileTab.getElement().style.display = 'none';\r\n                    fileTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                },\r\n            },\r\n            {\r\n                id: 'settings',\r\n                title: LANG('tab-settings'),\r\n                image: tabSettingsImg,\r\n                onOpen: function () {\r\n                    settingsTab.getElement().style.display = 'block';\r\n                    // settingsTab.setIsVisible(true);\r\n                },\r\n                onClose: function () {\r\n                    settingsTab.getElement().style.display = 'none';\r\n                    // settingsTab.setIsVisible(false);\r\n                },\r\n                css: {\r\n                    minWidth: '45px',\r\n                }\r\n            }\r\n        ]\r\n    });\r\n    function updateMainTabVisibility() {\r\n        if (!mainTabRow) {\r\n            return;\r\n        }\r\n\r\n        let toolObj = {\r\n            'draw': {},\r\n            'hand': {},\r\n            'fill': {},\r\n            'text': {},\r\n            'shape': {}\r\n        };\r\n\r\n        let activeStr = toolspaceToolRow.getActive();\r\n        let oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n        let keysArr = Object.keys(toolObj);\r\n        for (let i = 0; i < keysArr.length; i++) {\r\n            if (activeStr === keysArr[i]) {\r\n                mainTabRow.setIsVisible(keysArr[i], true);\r\n            } else {\r\n                mainTabRow.setIsVisible(keysArr[i], false);\r\n                if (oldTabId === keysArr[i]) {\r\n                    mainTabRow.open(activeStr);\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function copyToClipboard(showCrop?) {\r\n        KL.clipboardDialog(klRootEl, getBBox(), klCanvas.getCompleteCanvas(1), function (inputObj) {\r\n            if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                return;\r\n            }\r\n            //do a crop\r\n            let p = {\r\n                context: currentLayerCtx,\r\n                canvas: klCanvas,\r\n                input: inputObj, //{left,right,top,bottom}\r\n                history: klHistory\r\n            };\r\n            KL.filterLib.cropExtend.apply(p);\r\n            layerManager.update();\r\n            klCanvasWorkspace.resetView();\r\n            handUi.update(klCanvasWorkspace.getScale(), klCanvasWorkspace.getAngleDeg());\r\n        }, statusOverlay, showCrop);\r\n    }\r\n\r\n    const bottomBarWrapper = BB.el({\r\n        css: {\r\n            width: \"270px\",\r\n            position: \"absolute\",\r\n            bottom: '0',\r\n            left: '0'\r\n        },\r\n    });\r\n    if (pOptions.bottomBar) {\r\n        bottomBarWrapper.append(pOptions.bottomBar);\r\n        const observer = new MutationObserver(() => updateBottomBar());\r\n        observer.observe(\r\n            toolspaceInner,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n    }\r\n    function updateBottomBar() {\r\n        if (!pOptions.bottomBar) {\r\n            return;\r\n        }\r\n        const bbox = getBBox();\r\n        const threshold = 617; //590\r\n        const isVisible = (\r\n            threshold < bbox.height &&\r\n            toolspaceInner.scrollHeight + 50 < bbox.height\r\n        );\r\n        bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n\r\n\r\n    BB.append(toolspaceInner, [\r\n        layerPreview.getElement(),\r\n        mainTabRow.getElement(),\r\n        brushDiv,\r\n        handUi.getElement(),\r\n        fillUi.getElement(),\r\n        textUi.getElement(),\r\n        shapeUi.getElement(),\r\n        layerManager,\r\n        filterTab.getElement(),\r\n        fileTab ? fileTab.getElement() : null,\r\n        settingsTab.getElement(),\r\n        BB.el({\r\n            css: {\r\n                height: '10px', // a bit of spacing at the bottom\r\n            }\r\n        }),\r\n        bottomBarWrapper ? bottomBarWrapper : null\r\n    ]);\r\n\r\n    const toolspaceScroller = new KL.ToolspaceScroller({\r\n        toolspace,\r\n        uiState,\r\n    });\r\n\r\n    // --- interface ---\r\n\r\n    this.getBBox = getBBox;\r\n\r\n    this.getEl = () => {\r\n        return klRootEl;\r\n    };\r\n\r\n    this.resize = (w, h) => {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (uiWidth === Math.max(0, w) && uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        uiWidth = Math.max(0, w);\r\n        uiHeight = Math.max(0, h);\r\n\r\n        updateCollapse();\r\n        updateBottomBar();\r\n\r\n        layerPreview.setIsVisible(uiHeight >= 579);\r\n        klColorSlider.setHeight(Math.max(163, Math.min(400, uiHeight - 505)));\r\n        toolspaceToolRow.setIsSmall(uiHeight < 540);\r\n    };\r\n\r\n    this.out = (msg) => {\r\n        statusOverlay.out(msg);\r\n    };\r\n\r\n    this.getPNG = function (): Blob {\r\n        return base64ToBlob(klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    };\r\n\r\n    this.getPSD = async function () {\r\n        return await klCanvasToPsdBlob(klCanvas);\r\n    };\r\n\r\n    this.getProject = () => klCanvas.getProject();\r\n\r\n    this.swapUiLeftRight = () => {\r\n        uiState = uiState === 'left' ? 'right' : 'left';\r\n        if (!pOptions.embed) {\r\n            LocalStorage.setItem('uiState', uiState);\r\n        }\r\n        updateUi();\r\n    };\r\n\r\n    this.saveAsPsd = () => {\r\n        saveToComputer.save('psd');\r\n    };\r\n\r\n    this.isDrawing = () => {\r\n        return lineSanitizer.getIsDrawing() || klCanvasWorkspace.getIsDrawing();\r\n    };\r\n\r\n    // --- end interface ---\r\n\r\n    this.resize(uiWidth, uiHeight);\r\n    updateUi();\r\n\r\n    {\r\n        BB.addEventListener(window, 'resize', () => {\r\n            const bbox = getBBox();\r\n            this.resize(bbox.width, bbox.height);\r\n        });\r\n        BB.addEventListener(window, 'orientationchange', () => {\r\n            const bbox = getBBox();\r\n            this.resize(bbox.width, bbox.height);\r\n        });\r\n\r\n        // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n        // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n        const windowResizeWatcher = BB.el({\r\n            parent: container || document.body,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n                zIndex: '-1',\r\n                userSelect: 'none',\r\n            }\r\n        });\r\n        try {\r\n            // Not all browsers support ResizeObserver. Not critical though.\r\n            const observer = new ResizeObserver(() => {\r\n                const bbox = getBBox();\r\n                this.resize(bbox.width, bbox.height);\r\n            });\r\n            observer.observe(windowResizeWatcher);\r\n        } catch (e) {\r\n            windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n        }\r\n\r\n        // prevent ctrl scroll -> zooming page\r\n        BB.addEventListener(this.getEl(), 'wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n        //maybe prevent zooming on safari mac os - I can't test it\r\n        const prevent = (e) => {\r\n            e.preventDefault();\r\n        }\r\n        window.addEventListener('gesturestart', prevent);\r\n        window.addEventListener('gesturechange', prevent);\r\n        window.addEventListener('gestureend', prevent);\r\n    }\r\n}","import {DecoyKlHistory, klHistory} from './history/kl-history';\nimport {Popup, popup} from './ui/modals/popup';\nimport {dialogCounter} from './ui/modals/modal-count';\nimport {Checkbox} from './ui/base-components/checkbox';\nimport {input} from './ui/base-components/input';\nimport {Select} from './ui/base-components/select';\nimport {ImageToggle} from './ui/base-components/image-toggle';\nimport {ImageRadioList} from './ui/base-components/image-radio-list';\nimport {penPressureToggle} from './ui/base-components/pen-pressure-toggle';\nimport {KlSlider} from './ui/base-components/kl-slider';\nimport {calcSliderFalloffFactor} from './ui/base-components/slider-falloff';\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\nimport {KlColorSlider} from './ui/base-components/kl-color-slider';\nimport {KlSmallColorSlider} from './ui/base-components/kl-color-slider-small';\nimport {PointSlider} from './ui/base-components/point-slider';\nimport {ColorOptions} from './ui/base-components/color-options';\nimport {Options} from './ui/base-components/options';\nimport {StatusOverlay} from './ui/components/status-overlay';\nimport {exportDialog} from './ui/modals/export-dialog-deprecated';\nimport {CropCopy} from './ui/components/crop-copy';\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\nimport {klLayerManager} from './ui/tool-tabs/kl-layer-manager';\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\nimport {FreeTransform} from './ui/components/free-transform';\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\nimport {Cropper} from './ui/components/cropper';\nimport {LayerPreview} from './ui/components/layer-preview';\nimport {FittedImage} from './ui/components/fitted-image';\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\nimport {ToolDropdown} from './ui/components/tool-dropdown';\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\nimport {TabRow} from './ui/components/tab-row';\nimport {HandUi} from './ui/tool-tabs/hand-ui';\nimport {FillUi} from './ui/tool-tabs/fill-ui';\nimport {TextUi} from './ui/tool-tabs/text-ui';\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\nimport {newImageDialog} from './ui/modals/new-image-dialog';\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\nimport {renderText} from './image-operations/render-text';\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\nimport {floodFillBits} from './image-operations/flood-fill';\nimport * as PSD from './storage/psd';\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\nimport {KlCanvas} from './canvas/kl-canvas';\nimport * as indexedDb from './storage/indexed-db';\nimport {filterLib, filterLibStatus} from './filters/filters';\nimport {brushes} from './brushes/brushes';\nimport {brushesUI} from './brushes-ui/brushes-ui';\nimport {showIframePopup} from './ui/modals/show-iframe-popup';\nimport {RadioList} from './ui/base-components/radio-list';\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\nimport {drawProject} from './canvas/draw-project';\nimport {ProjectStore} from './storage/project-store';\nimport {FileTab} from \"./ui/tool-tabs/file-tab\";\nimport {FilterTab} from \"./ui/tool-tabs/filter-tab\";\nimport {imgurUpload} from \"./ui/modals/imgur-upload\";\nimport {loadAgPsd} from \"./storage/ag-psd-wrapper\";\nimport {SaveReminder} from \"./ui/components/save-reminder\";\nimport {SaveToComputer} from \"./storage/save-to-computer\";\nimport {UndoRedoCatchup} from \"./history/undo-redo-catchup\";\nimport {setDbName} from './storage/indexed-db';\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\nimport {BoxToggle} from './ui/base-components/box-toggle';\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\n\n/**\n * paint tool functionality\n */\nexport const KL = {\n\n    // --- brushes ---\n    brushes,\n    brushesUI,\n    BrushSettingService,\n\n    // --- canvas ---\n    KlCanvas,\n    drawProject,\n\n    // --- canvas ui ---\n    WorkspaceSvgOverlay,\n    KlCanvasWorkspace,\n    KlCanvasPreview,\n\n    // --- filters ---\n    filterLibStatus,\n    filterLib,\n\n    // --- history ---\n    UndoRedoCatchup,\n\n    // --- image operations ---\n    renderText,\n    floodFillBits,\n    ShapeTool,\n    drawShape,\n\n    // --- storage ---\n    PSD,\n    setDbName,\n    indexedDb,\n    ProjectStore,\n    loadAgPsd,\n    SaveToComputer,\n\n    // --- ui - base components ---\n    calcSliderFalloffFactor,\n    Checkbox,\n    input,\n    Select,\n    ImageToggle,\n    ImageRadioList,\n    RadioList,\n    penPressureToggle,\n    KlSlider,\n    HexColorDialog,\n    KlColorSlider,\n    KlSmallColorSlider,\n    PointSlider,\n    ColorOptions,\n    Options,\n    BoxToggle,\n\n    // --- ui - components ---\n    StatusOverlay,\n    CropCopy,\n    FreeTransform,\n    FreeTransformCanvas,\n    Cropper,\n    LayerPreview,\n    FittedImage,\n    KlImageDropper,\n    OverlayToolspace,\n    ToolspaceTopRow,\n    ToolDropdown,\n    ToolspaceToolRow,\n    ToolspaceStabilizerRow,\n    TabRow,\n    ToolspaceCollapser,\n    BrowserStorageUi,\n    SaveReminder,\n    ToolspaceScroller,\n\n    // --- ui - modals ---\n    dialogCounter,\n    popup,\n    Popup,\n    exportDialog,\n    clipboardDialog,\n    showImportAsLayerDialog,\n    newImageDialog,\n    textToolDialog,\n    showImportImageDialog,\n    showIframePopup,\n    imgurUpload,\n\n    // --- ui - tool tabs ---\n    HandUi,\n    FillUi,\n    TextUi,\n    ShapeUi,\n    FileTab,\n    FilterTab,\n    SettingsTab,\n    klLayerManager,\n\n\n    klHistory,\n    DecoyKlHistory,\n};","\nexport interface IHistoryEntry {\n    tool: string[];\n    action?: string;\n    params?: any[];\n\n    actions?: {\n        action: string;\n        params: any[];\n    }[]\n}\n\nexport interface IHistoryBroadcast {\n    bufferUpdate: IHistoryEntry;\n}\n\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\n\nlet historyInstance: boolean = false;\n\nexport interface KlHistoryInterface {\n    pause (b: boolean): void;\n    addListener (l: IHistoryListener): void;\n    push (e: IHistoryEntry): void;\n    undo (): (IHistoryEntry | null)[];\n    redo (): (IHistoryEntry | null)[];\n    getAll (): (IHistoryEntry | null)[];\n    canRedo (): boolean;\n    canUndo (): boolean;\n    getState (): number;\n    getActionNumber (): number;\n}\n\nexport class DecoyKlHistory implements KlHistoryInterface {\n    pause (b: boolean): void {}\n    addListener (l: IHistoryListener): void {}\n    push (e: IHistoryEntry): void {}\n    undo (): (IHistoryEntry | null)[] { return []; }\n    redo (): (IHistoryEntry | null)[] { return []; }\n    getAll (): (IHistoryEntry | null)[] { return []; }\n    canRedo (): boolean { return false; }\n    canUndo (): boolean { return false; }\n    getState (): number { return 0; }\n    getActionNumber (): number { return 0; }\n}\n\nexport class KlHistory implements KlHistoryInterface {\n\n    private state: number; // on .push state increments by one\n    private dataArr: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\n    private listeners: IHistoryListener[];\n    private pauseStack: number; // how often paused without unpause\n    private readonly max: number = 20; // max number undo steps\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\n    \n    private broadcast (p: IHistoryBroadcast | null): void {\n        setTimeout(() => {\n            for (let i = 0; i < this.listeners.length; i++) {\n                this.listeners[i](p);\n            }\n            this.state++;\n        }, 1);\n    }\n    \n    // ---- public ----\n    \n    constructor () {\n        if (historyInstance) {\n            throw new Error('klHistory already instantiated');\n        }\n        historyInstance = true;\n        this.state = 0;\n        this.dataArr = [];\n        this.listeners = [];\n        this.pauseStack = 0;\n        this.maxState = -1;\n        this.actionNumber = -1;\n    }\n\n    /**\n     * you need pause because there are sometimes actions that would cause other\n     * undo steps\n     * for example a filter that does something crazy with two layers and then merges them\n     * you want that to be one undo step, and prevent merging from causing its undo step.\n     * so while that filter is doing its magic you should pause possible undo steps that\n     * that are caused by a part of its code(in this example: merging layers)\n     *\n     * @param b\n     */\n    pause (b: boolean): void {\n        if (b === false) {\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\n        } else {\n            this.pauseStack++;\n        }\n    }\n\n    addListener (l: IHistoryListener): void {\n        this.listeners.push(l);\n    }\n\n    push (e: IHistoryEntry): void {\n        if (this.pauseStack > 0) {\n            return;\n        }\n        while (this.actionNumber < this.dataArr.length - 1) {\n            this.dataArr.pop();\n        }\n\n        //taking care of actions that shouldn't cause a new undo step\n        const top = this.dataArr[this.dataArr.length - 1];\n        if (e.action === 'layerOpacity' && top && top.action === 'layerOpacity' && top.params[0] === e.params[0]) {\n            this.dataArr[this.dataArr.length - 1] = e;\n            this.state++; //still needs to increment because something changed\n            return;\n        }\n        if (e.action === 'focusLayer' && top && top.action === 'focusLayer') {\n            this.dataArr[this.dataArr.length - 1] = e;\n            this.state++;\n            return;\n        }\n\n\n        this.dataArr[this.dataArr.length] = e;\n        this.actionNumber = this.dataArr.length - 1;\n        const maxBefore = this.maxState;\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\n        if (maxBefore < this.maxState) {\n            this.broadcast({bufferUpdate: this.dataArr[this.maxState]});\n        } else {\n            this.broadcast(null);\n        }\n        if (this.maxState >= 0) {\n            this.dataArr[this.maxState] = null; //to free some memory...imported images take a lot of space\n        }\n    }\n\n    undo (): (IHistoryEntry | null)[] {\n        let result;\n        if (this.canUndo()) {\n            result = [];\n            for (let i = this.maxState + 1; i < this.actionNumber; i++) {\n                result.push(this.dataArr[i]);\n            }\n            this.actionNumber--;\n            this.broadcast(null);\n        }\n\n        return result;\n    }\n\n    redo (): (IHistoryEntry | null)[] {\n        const result = [];\n        if (this.canRedo()) {\n            this.actionNumber++;\n            result.push(this.dataArr[this.actionNumber]);\n            this.broadcast(null);\n        }\n        return result;\n    }\n\n    getAll (): (IHistoryEntry | null)[] {\n        return [].concat(this.dataArr);\n    }\n\n    canRedo (): boolean {\n        return this.actionNumber < this.dataArr.length - 1;\n    }\n\n    canUndo (): boolean {\n        return this.actionNumber > this.maxState;\n    }\n\n    getState (): number {\n        return this.state;\n    }\n\n    /**\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\n     */\n    getActionNumber (): number {\n        return (this.actionNumber + 1);\n    }\n    \n}\n\nexport const klHistory = new KlHistory();\n","import { dialogCounter } from './modal-count';\r\nimport { BB } from '../../../bb/bb';\r\n// @ts-ignore\r\nimport checkImg from 'url:~/src/app/img/ui/check.svg';\r\n// @ts-ignore\r\nimport cancelImg from 'url:~/src/app/img/ui/cancel.svg';\r\nimport { LANG } from '../../../language/language';\r\nimport { IKeyString } from '../../../bb/bb.types';\r\n\r\nwindow.onscroll = (e) => {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function popup(\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closefunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: p.target || document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        }\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        }\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        }\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content: p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : null,\r\n                    marginRight: '15px',\r\n                }\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : null,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            }\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            }\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        BB.addClassName(boxEl, 'poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        BB.addClassName(boxEl, 'popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        BB.addClassName(boxEl, 'popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        BB.addClassName(boxEl, 'popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(function () {\r\n                    clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        }\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event) => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    BB.addEventListener(rootEl, 'wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus = null;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = null;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        }\r\n    }) : null;\r\n    let clickOnEnterBtn;\r\n    const btnElArr = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    }\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [iconImg, label],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close(value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        {\r\n            /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n            const focusEl = BB.el({\r\n                parent: document.body,\r\n                tagName: 'input',\r\n                css: {\r\n                    opacity: '0',\r\n                    width: '0',\r\n                    height: '0',\r\n                }\r\n            }) as HTMLInputElement;\r\n            setTimeout(() => {\r\n                focusEl.select();\r\n                focusEl.focus();\r\n                focusEl.parentNode.removeChild(focusEl);\r\n            }, 10);\r\n        }\r\n        rootRootEl.parentNode.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        BB.removeEventListener(rootEl, 'wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => {\r\n            BB.destroyEl(item);\r\n        });\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closefunc) {\r\n        p.closefunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * popups that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n *\r\n * p = {\r\n *      title: DOM Element | string, // optional (todo allow string)\r\n *      icon: 'ok', // optional todo\r\n *      content: DOM Element, // optional\r\n *      buttonArr: [ // optional todo\r\n *          'Ok',\r\n *          'Cancel'\r\n *      ],\r\n *      autoFocus: string | false, //todo\r\n *      clickOnEnter: string, //todo\r\n *      onClose: function(result: string), // optional (todo result)\r\n *\r\n *      //size and position\r\n *      width: 500,\r\n *      isMaxHeight: boolean //todo, currently always true\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const Popup = function (p) {\r\n    dialogCounter.increase();\r\n    const parent = p.target || document.body;\r\n    const div = BB.el({\r\n        parent: parent,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0',\r\n            background: 'rgba(0, 0, 0, 0.45)',\r\n            overflow: 'auto',\r\n            animationName: 'consoleIn',\r\n            animationDuration: '0.3s',\r\n            animationTimingFunction: 'ease-out'\r\n        }\r\n    });\r\n    div.onclick = BB.handleClick;\r\n\r\n    let updateInterval;\r\n\r\n    function close() {\r\n        dialogCounter.decrease();\r\n        div.onclick = null;\r\n        parent.removeChild(div);\r\n        clearInterval(updateInterval);\r\n        window.removeEventListener('resize', updatePos);\r\n        keyListener.destroy();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        if (p.onClose) {\r\n            p.onClose();\r\n        }\r\n    }\r\n\r\n    //background element registering clicks\r\n    const bgEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            bottom: '0',\r\n            right: '0'\r\n        },\r\n        onClick: close\r\n    });\r\n\r\n    //the actual popup box\r\n    const popupEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'absolute',\r\n            width: (BB.isCssMinMaxSupported() ?\r\n                'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                (p.width ? p.width : 400) + 'px'),\r\n            height: 'calc(100% - 40px)',\r\n            background: '#eee',\r\n            borderRadius: '10px',\r\n            overflow: 'hidden',\r\n            boxShadow: 'rgba(0, 0, 0, 0.25) 0px 5px 60px'\r\n        }\r\n    });\r\n\r\n    //x and y position via script. flex not powerful enough imo\r\n    function updatePos() {\r\n        const width = p.target ? (p.target.clientWidth || p.target.offsetWidth) : window.innerWidth;\r\n        const height = p.target ? (p.target.clientHeight || p.target.offsetHeight) : window.innerHeight;\r\n        const elW = popupEl.offsetWidth;\r\n        const elH = popupEl.offsetHeight;\r\n        BB.css(popupEl, {\r\n            left: Math.max(0, (width - elW) / 2) + 'px',\r\n            top: Math.max(20, (height - elH) / 2 - (elH * 0.20)) + 'px'\r\n        });\r\n    }\r\n    //todo also update when popup changes size - resizeobserver and fallback\r\n    //updateInterval = setInterval(updatePos, 100);\r\n    updatePos();\r\n    window.addEventListener('resize', updatePos);\r\n\r\n    //title row in popup\r\n    const titleHeight = 40;\r\n    const titleEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: titleHeight + 'px',\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            paddingLeft: (titleHeight / 2) + 'px'\r\n        }\r\n    });\r\n    if (p.title) {\r\n        titleEl.appendChild(p.title);\r\n    }\r\n    const xButton = BB.el({\r\n        parent: titleEl,\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: close,\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n        custom: {\r\n            tabindex: '0',\r\n        }\r\n    });\r\n\r\n    const contentEl = BB.el({\r\n        parent: popupEl,\r\n        css: {\r\n            height: 'calc(100% - ' + titleHeight + 'px)'\r\n        }\r\n    });\r\n    if (p.content) {\r\n        contentEl.appendChild(p.content);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e) {\r\n            if (keyStr === 'esc') {\r\n                e.stopPropagation();\r\n                close();\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    // --- interface ---\r\n    this.close = function () {\r\n        close();\r\n    };\r\n};","\n// not the best\n\n/**\n * how many modals are open\n */\n\nexport class DialogCounter {\n    private listeners: ((v: number) => void)[] = [];\n    private count = 0;\n\n    private emit (): void {\n        this.listeners.forEach(item => {\n            item(this.count);\n        });\n    }\n\n    increase (v?: number): void {\n        if (v !== undefined) {\n            this.count += v;\n        } else {\n            this.count++;\n        }\n        this.emit();\n    }\n    decrease (v?: number): void {\n        if (v !== undefined) {\n            this.count -= v;\n        } else {\n            this.count--;\n        }\n        this.emit();\n    }\n    get (): number {\n        return this.count;\n    }\n    subscribe (listener: (v: number) => void): void {\n        this.listeners.push(listener);\n    }\n}\n\nexport const dialogCounter = new DialogCounter();\n","import * as BBEventListener from './input/event-listener';\nimport {\n    addClassName, append, centerWithin, copyObj, createSvg,\n    css, dateDayDifference, decToFraction,\n    fitInto, gcd, getDate,\n    handleClick, imageBlobToUrl,\n    insertAfter, loadImage,\n    reduce,\n    removeClassName, setAttributes, shareCanvas\n} from './base/base';\nimport {\n    canShareFiles,\n    eventUsesHighResTimeStamp,\n    getVisitor,\n    hasPointerEvents,\n    hasWebGl,\n    isCssMinMaxSupported,\n    mouseEventHasMovement\n} from './base/browser';\nimport {KeyListener, sameKeys} from './input/key-listener';\nimport {PointerListener} from './input/pointer-listener';\nimport * as EventChain from './input/event-chain';\nimport {\n    convertToAlphaChannelCanvas,\n    copyCanvas,\n    createCheckerCanvas, createCheckerDataUrl,\n    drawTransformedImageOnCanvas,\n    drawTransformedImageWithBounds, freeCanvas, resizeCanvas, testShouldPixelate\n} from './base/canvas';\nimport {Matrix} from './math/matrix';\nimport {Vec2} from './math/vec2';\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\nimport {appendTextDiv, clearSelection, destroyEl, el, isInputFocused, makeUnfocusable} from './base/ui';\nimport {\n    pointsToAngleDeg,\n    clamp,\n    dist,\n    mix,\n    pointsToAngleRad,\n    rotate,\n    rotateAround,\n    intDxy,\n    roundEven, roundUneven, distSquared, lenSquared, updateBounds, boundsInArea\n} from './math/math';\nimport {createCanvas} from './base/create-canvas';\nimport {BbLog} from './base/bb-log';\nimport {LocalStorage} from './base/local-storage';\n\nexport const BB = {\n\n    // ---- browser ----\n    eventUsesHighResTimeStamp,\n    mouseEventHasMovement,\n    hasPointerEvents,\n    hasWebGl,\n    getVisitor,\n    isCssMinMaxSupported,\n    canShareFiles,\n\n    // ---- base ----\n    insertAfter,\n    loadImage,\n    css,\n    setAttributes,\n    addClassName,\n    removeClassName,\n    append,\n    fitInto,\n    centerWithin,\n    getDate,\n    gcd,\n    reduce,\n    decToFraction,\n    imageBlobToUrl,\n    dateDayDifference,\n    copyObj,\n    shareCanvas,\n    handleClick,\n    createSvg,\n    BbLog,\n    LocalStorage,\n\n    // ---- math ----\n    mix,\n    dist,\n    distSquared,\n    lenSquared,\n    pointsToAngleRad,\n    pointsToAngleDeg,\n    clamp,\n    rotate,\n    rotateAround,\n    Matrix,\n    Vec2,\n    intDxy,\n    roundEven,\n    roundUneven,\n    updateBounds,\n    boundsInArea,\n\n    // ---- line ----\n    projectPointOnLine,\n    PointLine,\n    BezierLine,\n    SplineInterpolator,\n    quadraticSplineInput,\n\n    // ---- canvas ----\n    canvas: createCanvas,\n    copyCanvas,\n    testShouldPixelate,\n    drawTransformedImageWithBounds,\n    drawTransformedImageOnCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    resizeCanvas,\n    convertToAlphaChannelCanvas,\n    freeCanvas,\n\n    // ---- color ----\n    HSV,\n    RGB,\n    CMYK,\n    ColorConverter,\n    testIsWhiteBestContrast,\n\n    // ---- UI ----\n    appendTextDiv,\n    clearSelection,\n    makeUnfocusable,\n    el,\n    destroyEl,\n    isInputFocused: isInputFocused,\n\n\n    // ---- events / input ----\n\n    addEventListener: BBEventListener.addEventListener,\n    removeEventListener: BBEventListener.removeEventListener,\n    setEventListener: BBEventListener.setEventListener,\n\n    KeyListener,\n    PointerListener,\n    sameKeys,\n\n    EventChain,\n\n};\n","import {hasPointerEvents} from '../base/browser';\n\nconst listenerFuncObj = {}; // for debugging\n\nexport const setEventListener = function (DomEl, type, listener) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    DomEl[type] = listener;\n};\n\nexport const addEventListener = function (DomEl, type, listener, options?) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    /*if (!(type in listenerFuncObj)) {\n        listenerFuncObj[type] = [];\n    }\n    listenerFuncObj[type].push(listener);*/\n    DomEl.addEventListener(type, listener, options);\n};\n\nexport const removeEventListener = function (DomEl, type, listener, options?) {\n    if (!hasPointerEvents) {\n        type = type.replace('pointer', 'mouse');\n    }\n    /*if (type in listenerFuncObj) {\n        for (let i = 0; i < listenerFuncObj[type].length; i++) {\n            if (listenerFuncObj[type][i] === listener) {\n                listenerFuncObj[type].splice(i, 1);\n                i--;\n            }\n        }\n    }*/\n    DomEl.removeEventListener(type, listener, options);\n};","import {createCanvas} from './create-canvas';\n\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const eventUsesHighResTimeStamp = (function() {\n\n    let eventUsesHighResTimeStamp: boolean | null = null;\n    if (document.body) {\n        (function() {\n            const event = new Event('');\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\n        })();\n    } else {\n        window.addEventListener('DOMContentLoaded', function(event) {\n            eventUsesHighResTimeStamp = event.timeStamp < 1000 * 60 * 60;\n        });\n    }\n\n    return function(): boolean {\n        if (eventUsesHighResTimeStamp === null) {\n            throw 'eventUsesHighResTimeStamp not initialized';\n        }\n        return eventUsesHighResTimeStamp;\n    }\n})();\n\nexport const mouseEventHasMovement = (() => {\n\n    // no support: IE, Safari, Safari iOS\n    // supported but broken: Firefox\n\n    if (!('MouseEvent' in window)) {\n        return false;\n    }\n    let mouseEvent;\n    try {\n        mouseEvent = new MouseEvent('mousemove'); // browsers not supporting the constructor don't have it\n    } catch (e) {\n        return false;\n    }\n    if (!('movementX' in mouseEvent)) {\n        return false; // likely safari\n    }\n    return !isFirefox;\n})();\n\nexport const hasPointerEvents = !!window.PointerEvent;\n\nexport const hasWebGl = (function() {\n\n    const hasWebgl = (function() {\n        const canvas = createCanvas();\n        try {\n            canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\n            return true;\n        } catch (e) {\n            return false;\n        }\n    })();\n\n    return function() {\n        return hasWebgl;\n    }\n})();\n\nexport const getVisitor = (function () {\n    const visitor = {\n        chrome: false,\n        gl: false\n    };\n    //Chrome\n    if ((window as any).chrome && (window as any).chrome.app) {\n        visitor.chrome = true;\n    }\n    //WebGL\n    visitor.gl = hasWebGl();\n    return function () {\n        return JSON.parse(JSON.stringify(visitor));\n    }\n})();\n\nexport const isCssMinMaxSupported = (function() {\n    let result: boolean | null = null;\n\n    function test() {\n        const div = document.createElement('div');\n        div.style.position = 'absolute';\n        div.style.top = '0';\n        div.style.left = 'max(0px, 25px)';\n        document.body.appendChild(div);\n        setTimeout(function() {\n            result = div.offsetLeft === 25;\n            document.body.removeChild(div);\n        }, 25);\n    }\n\n    if (document.body) {\n        test();\n    } else {\n        window.addEventListener('DOMContentLoaded', function() {\n            test();\n        });\n    }\n\n    return function(): boolean {\n        if (result === null) {\n            throw new Error('isCssMinMaxSupported not initialized');\n        }\n        return result;\n    };\n})();\n\nexport const canShareFiles = function(): boolean {\n    return 'share' in navigator && 'canShare' in navigator;\n};","/*window['canvases'] = [];\n\nwindow['printCanvases'] = () => {\n    let total = 0;\n\n    console.log(window['canvases'].map(item => {\n        total += item.width * item.height;\n        return {w: item.width, h: item.height};\n    }));\n\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\n};*/\n\nexport function createCanvas(w?: number, h?: number): HTMLCanvasElement {\n    const result = document.createElement('canvas');\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}","import {IKeyString, ISize2D, ISVG, IVector2D} from '../BB.types';\n\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\n    if (referenceNode.parentNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    }\n}\n\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\n    let counter = 0;\n\n    function check() {\n        if (counter === 1000) {\n            alert(\"couldn't load\");\n            return;\n        }\n        if (im.complete) {\n            counter++;\n            callback();\n        } else {\n            setTimeout(check, 1);\n        }\n    }\n\n    check();\n}\n\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyString): void {\n    const keyArr = Object.keys(styleObj);\n    let keyStr: string;\n    const style = (el.style as unknown) as IKeyString;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        style[keyStr] = styleObj[keyStr];\n        style.alignContent = 'true';\n        if (keyStr === 'userSelect') {\n            style.webkitUserSelect = styleObj[keyStr]; // safari\n        }\n    }\n}\n\nexport function setAttributes (el: HTMLElement, attrObj: IKeyString): void {\n    const keyArr = Object.keys(attrObj);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        el.setAttribute(keyStr, attrObj[keyStr]);\n    }\n}\n\nexport function addClassName (el: HTMLElement | SVGElement, classStr: string): void {\n    const classAttr = el.getAttribute('class');\n    const splitArr = classAttr === null ? [] : classAttr.split(' ');\n    if (splitArr.includes(classStr)) {\n        return;\n    }\n    splitArr.push(classStr);\n    el.setAttribute('class', splitArr.join(' '));\n}\n\nexport function removeClassName (el: HTMLElement | SVGElement, classStr: string): void {\n    const classAttr = el.getAttribute('class');\n    const splitArr = classAttr === null ? [] : classAttr.split(' ');\n    if (!splitArr.includes(classStr)) {\n        return;\n    }\n    for (let i = 0; i < splitArr.length; i++) {\n        if (splitArr[i] === classStr) {\n            splitArr.splice(i, 1);\n            i--;\n        }\n    }\n    el.setAttribute('class', splitArr.join(' '));\n}\n\n/**\n * appendChild with an array\n * @param target\n * @param els\n */\nexport function append(target: HTMLElement, els: (HTMLElement | string | null)[]) {\n    const fragment = document.createDocumentFragment();\n    els.forEach(item => item ? fragment.append(item) : null);\n    target.append(fragment);\n}\n\n/**\n * a needs to fit into b\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n * @param min\n */\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\n    let width = aw * bw, height = ah * bw;\n    if (width > bw) {\n        height = bw / width * height;\n        width = bw;\n    }\n    if (height > bh) {\n        width = bh / height * width;\n        height = bh;\n    }\n    if (min) {\n        width = Math.max(min, width);\n        height = Math.max(min, height);\n    }\n    return {width, height};\n}\n\n/**\n * center b in a\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n */\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\n    return {\n        x: aw / 2 - bw / 2,\n        y: ah / 2 - bh / 2\n    };\n}\n\nexport function getDate (): string {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\n\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\n}\n\nexport function gcd (a: number, b: number): number {\n    return b ? gcd(b, a % b) : a;\n}\n\nexport function reduce (numerator: number, denominator: number): [number, number] {\n    const g = gcd(numerator, denominator);\n    return [numerator / g, denominator / g];\n}\n\nexport function decToFraction (decimalNumber: number): [number, number] {\n    const len = decimalNumber.toString().length - 2;\n    const denominator = Math.pow(10, len);\n    const numerator = decimalNumber * denominator;\n    return reduce(numerator, denominator);\n}\n\n/**\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\n * @param blobObj\n * @returns {string}\n */\nexport function imageBlobToUrl(blobObj: Blob): string {\n    if (!blobObj) {\n        throw new Error('blobObj is undefined or null');\n    }\n    if (window.Blob && blobObj instanceof Blob) {\n        return URL.createObjectURL(blobObj); // object url\n    } else if (blobObj.constructor.name === 'Object') {\n        const fauxBlob = (blobObj as unknown) as {type: string, encoding: string, data: string};\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\n    } else {\n        throw new Error('unknown blob format');\n    }\n}\n\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\n    dateA = new Date(dateA);\n    dateB = new Date(dateB);\n    dateA.setHours(0, 0, 0, 0);\n    dateB.setHours(0, 0, 0, 0);\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function copyObj (obj: any): any {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * triggers Web Share API - share feature on mobile devices\n * Only works if they support file sharing - e.g. Safari can't do this yet\n * only call if BB.canShareFiles() -> true\n *\n * p = {\n *     canvas: Canvas,\n *     fileName: string,\n *     title: string\n * }\n *\n * @param p\n */\nexport function shareCanvas (p: {canvas: HTMLCanvasElement, fileName:string, title: string, callback: () => void}): void {\n    const mimetype = 'image/png';\n    const err = () => alert('sharing not supported');\n    p.canvas.toBlob(function(blob) {\n        if (blob === null) {\n            err();\n            p.callback();\n            return;\n        }\n        try {\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\n            navigator.share({\n                title: p.title,\n                files: filesArray,\n            } as any)\n                .then(r => {\n\n                })\n                .catch(e => {\n                    err();\n            });\n        } catch(e) {\n            err();\n        }\n        p.callback();\n    }, mimetype);\n}\n\n/**\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\n * Give it your click event\n *\n * @param clickEvent\n * @returns {boolean}\n */\nexport function handleClick (clickEvent: MouseEvent): boolean {\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\n    if (!target) {\n        return false;\n    }\n    if (['A', 'LABEL', 'INPUT'].includes(target.tagName) || (target as any).allowClick) {\n        return true;\n    }\n    clickEvent.preventDefault();\n    return false;\n}\n\n\n/**\n * @param el {elementType: string, childrenArr: []el, ...svg attributes...}\n * @returns svg element tree\n */\nexport function createSvg (el: ISVG): SVGElement {\n    const result = document.createElementNS('http://www.w3.org/2000/svg', el.elementType);\n    const keyArr = Object.keys(el);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        if (keyStr === 'childrenArr') {\n            for (let e = 0; e < el.childrenArr.length; e++) {\n                result.appendChild(createSvg(el.childrenArr[e]));\n            }\n        } else if (keyStr !== 'elementType') {\n            result.setAttribute(keyStr, el[keyStr] as string);\n        }\n    }\n    return result;\n}","import {addEventListener, removeEventListener} from './event-listener';\n\n\nconst globalKey = (() => {\n\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\n        'space': [' ', 'Spacebar'], // Spacebar in IE\n        'alt': ['Alt', 'AltGraph'],\n        'shift': 'Shift',\n        'ctrl': 'Control',\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\n        'enter': 'Enter',\n        'esc': 'Escape',\n        'backspace': 'Backspace',\n        'delete': 'Delete',\n        'sqbr_open': '[',\n        'sqbr_close': ']',\n        'a': ['a', 'A'],\n        'b': ['b', 'B'],\n        'c': ['c', 'C'],\n        'e': ['e', 'E'],\n        'f': ['f', 'F'],\n        'g': ['g', 'G'],\n        'r': ['r', 'R'], // when holding shift\n        's': ['s', 'S'],\n        't': ['t', 'T'],\n        'u': ['u', 'U'],\n        'x': ['x', 'X'],\n        'y': ['y', 'Y'],\n        'z': ['z', 'Z'],\n        'plus': '+',\n        'minus': '-',\n        'left': 'ArrowLeft',\n        'right': 'ArrowRight',\n        'up': 'ArrowUp',\n        'down': 'ArrowDown',\n        'home': 'Home',\n        'end': 'End'\n    };\n    const keyToKeyStrArr = Object.keys(keyStrToKeyObj);\n    const isDownObj = {};\n    const keyToKeyStrObj = {}; // event.key to keyStr { ArrowLeft: 'left', ... }\n    let comboArr = [];\n    //a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    let codeIsDownObj = {}; // { KeyE: 'e', KeyF: null } - null not down, string, the associated keyStr\n    const listenerArr = [];\n\n    for (let i = 0; i < keyToKeyStrArr.length; i++) {\n        isDownObj[keyToKeyStrArr[i]] = false;\n\n        const code = keyStrToKeyObj[keyToKeyStrArr[i]];\n        if (typeof code === 'string') {\n            keyToKeyStrObj[keyStrToKeyObj[keyToKeyStrArr[i]]] = keyToKeyStrArr[i];\n        } else {\n            for (let e = 0; e < code.length; e++) {\n                keyToKeyStrObj[code[e]] = keyToKeyStrArr[i];\n            }\n        }\n    }\n\n    function emitDown(a, b, c, d?) {\n        listenerArr.forEach(item => {\n            if (!item[0]) {\n                return;\n            }\n            item[0](a, b, c, d);\n        });\n    }\n\n    function emitUp(a, b, c) {\n        listenerArr.forEach(item => {\n            if (!item[1]) {\n                return;\n            }\n            item[1](a, b, c);\n        });\n    }\n\n    function emitBlur() {\n        listenerArr.forEach(item => {\n            if (!item[2]) {\n                return;\n            }\n            item[2]();\n        });\n    }\n\n    function keyDown(e) {\n        const key = e.key;\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\n\n        if (key in keyToKeyStrObj) {\n            const keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join('+'), true);\n                return;\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n\n            //add to combo\n            comboArr.push(keyStr);\n\n            emitDown(keyStr, e, comboArr.join('+'));\n        }\n    }\n\n\n    function keyUp(e) {\n        const key = e.key;\n        const code = 'code' in e ? e.code : e.keyCode; // ie doesn't have code\n        const oldComboStr = comboArr.join('+');\n\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if ([\n            'Meta', 'MetaLeft', 'MetaRight',\n            'OSLeft', 'OSRight', // Firefox\n        ].includes(code)) {\n            blur(null);\n            return;\n        }\n\n        if (code in codeIsDownObj && codeIsDownObj[code] !== null) {\n            const keyStr = codeIsDownObj[code];\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = null;\n\n            //remove from combo\n            for (let i = 0; i < comboArr.length; i++) {\n                if (comboArr[i] == keyStr) {\n                    comboArr.splice(i, 1);\n                    i--;\n                }\n            }\n\n            emitUp(keyStr, e, oldComboStr);\n        }\n    }\n\n    function blur(event) {\n        const oldComboStr = comboArr.join('+');\n        comboArr = [];\n        codeIsDownObj = {};\n\n        const eventArr = [];\n        for (let i = 0; i < keyToKeyStrArr.length; i++) {\n            if (isDownObj[keyToKeyStrArr[i]]) {\n                isDownObj[keyToKeyStrArr[i]] = false;\n                eventArr.push(keyToKeyStrArr[i]);\n            }\n        }\n        for (let i = 0; i < eventArr.length; i++) {\n            emitUp(\n                eventArr[i],\n                {\n                    preventDefault: function () {},\n                    stopPropagation: function () {},\n                },\n                oldComboStr,\n            );\n        }\n        emitBlur();\n    }\n\n\n\n    return {\n        add: (keyListener) => {\n            if (listenerArr.includes(keyListener)) {\n                return;\n            }\n            const first = listenerArr.length === 0;\n            listenerArr.push(keyListener);\n\n            if (first) {\n                addEventListener(document, 'keydown', keyDown);\n                addEventListener(document, 'keyup', keyUp);\n                addEventListener(window, 'blur', blur);\n            }\n        },\n        remove: (keyListener) => {\n            if (!listenerArr.includes(keyListener)) {\n                return;\n            }\n            const last = listenerArr.length === 1;\n            for (let i = 0; i < listenerArr.length; i++) {\n                if (listenerArr[i] === keyListener) {\n                    listenerArr.splice(i, 1);\n                    break;\n                }\n            }\n            if (last) {\n                removeEventListener(document, 'keydown', keyDown);\n                removeEventListener(document, 'keyup', keyUp);\n                removeEventListener(window, 'blur', blur);\n            }\n        },\n        getIsDown: () => {\n            return isDownObj;\n        },\n        getCombo: () => {\n            return comboArr;\n        },\n    };\n})();\n\n\n\n/**\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\n *\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\n * comboStr - string joins currently pressed keyStr with a +\n *              e.g. 'ctrl+z'\n *\n */\nexport class KeyListener {\n\n    private readonly onDown;\n    private readonly onUp;\n    private readonly onBlur;\n    private readonly ref;\n\n    constructor (\n        p: {\n            onDown?: (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\n            onUp?: (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\n            onBlur?: () => void;\n        },\n    ) {\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [this.onDown, this.onUp, this.onBlur];\n        globalKey.add(this.ref);\n    }\n\n    isPressed (keyStr: string): boolean {\n        if (!(keyStr in globalKey.getIsDown())) {\n            throw 'key \"' + keyStr + '\" not found';\n        }\n        return globalKey.getIsDown()[keyStr];\n    }\n\n    getComboStr (): string {\n        return globalKey.getCombo().join('+');\n    }\n\n    comboOnlyContains (keyStrArr: string[]): boolean {\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    destroy (): void {\n        globalKey.remove(this.ref);\n    }\n}\n\nexport function sameKeys(comboAStr: string, comboBStr: string): boolean {\n    return comboAStr.split('+').sort().join('+')=== comboBStr.split('+').sort().join('+');\n}","import {addEventListener, removeEventListener} from './event-listener';\n\n\n/**\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\n * Normalizes regular scrolls.\n *\n * Why:\n * - trackpad scrolling is different from old school mouse scrolling\n * - but there is not way to learn from the browser if it's trackpad scrolling\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\n *      continue an arbitrary amount, at an arbitrary scale\n * - each browser does this differently. So you can't offer a coherent experience\n *\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\n *\n * @param callback - func({deltaY: number, pageX: number, pageY: number, clientX: number, clientY: number}\n * @constructor\n */\nimport {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\nimport {mix} from '../math/math';\n\nconst WheelCleaner = function (callback) {\n    const sequenceTimeoutMs = 200;\n\n    const knownUnitArr = [100];\n    let sequenceLength = 0;\n    let sequenceUnit = null;\n    let endSequenceTimeout;\n    let toEmitDelta = null;\n    let position = null;\n\n\n    function emit(delta) {\n        callback({\n            deltaY: Math.round(delta / sequenceUnit),\n            pageX: position.pageX,\n            pageY: position.pageY,\n            clientX: position.clientX,\n            clientY: position.clientY,\n        });\n    }\n\n    function endSequence() {\n        if (toEmitDelta !== null) {\n            emit(toEmitDelta);\n            toEmitDelta = null;\n        }\n        if (sequenceUnit !== null && !(knownUnitArr.includes(sequenceUnit))) {\n            knownUnitArr.push(sequenceUnit);\n        }\n        sequenceLength = 0;\n        sequenceUnit = null;\n    }\n\n    // --- interface ---\n    this.process = function (event) {\n\n        position = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            clientX: event.clientX,\n            clientY: event.clientY,\n        };\n\n        clearTimeout(endSequenceTimeout);\n        endSequenceTimeout = setTimeout(endSequence, sequenceTimeoutMs);\n\n        //prep delta\n        let delta = event.deltaY;\n        if ('deltaMode' in event && event.deltaMode === 1) {\n            delta *= 100 / 3;\n        }\n        const absDelta = Math.abs(delta);\n\n\n        if (sequenceLength > 0 && sequenceUnit === null) {\n            //previously determined dirty sequence\n            toEmitDelta = null;\n            return;\n        }\n\n        //sequence begins\n        if (sequenceLength === 0) {\n            sequenceLength++;\n            if (absDelta < 50) {\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\n                return;\n            }\n\n            sequenceUnit = absDelta;\n            if (knownUnitArr.includes(sequenceUnit)) {\n                //we know this unit - emit right away\n                emit(delta);\n            } else {\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n                toEmitDelta = delta;\n            }\n            return;\n        }\n\n        //sequence continues\n        if (absDelta === 0) {\n            //ignore zero scroll\n            return;\n        }\n        if (\n            absDelta === sequenceUnit ||\n            (absDelta / sequenceUnit) % 1 < 0.0001// a multiple\n        ) {\n            //fine\n        } else if ((sequenceUnit / absDelta) % 1 < 0.0001) {\n            //unit was actually a multiple - update it\n            sequenceUnit = absDelta;\n\n        } else if (absDelta !== sequenceUnit) {\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n            sequenceUnit = null;\n            toEmitDelta = null;\n            return;\n        }\n\n\n        if (toEmitDelta !== null) {\n            emit(toEmitDelta);\n            toEmitDelta = null;\n        }\n        emit(delta);\n    };\n};\n\n\n/**\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers\n * Has some workarounds for browser specific bugs. As browsers get better, this constructor should get smaller\n *\n * p = {\n *     target: DOM element,\n *     onPointer: func (pointerEvent), //optional\n *     onWheel: func (wheelEvent), //optional\n *     onEnterLeave: func (isOver: boolean), //optional\n *     maxPointers: int (1 - n), //default is 1\n *     fixScribble: boolean, // fix ipad scribble issue\n * }\n *\n * pointerEvent = {\n *     type: 'pointerdown'|'pointermove'|'pointerup',\n *     pointerId: long,\n *     pointerType: 'touch'|'mouse'|'pen',\n *     pageX: number,\n *     pageY: number,\n *     clientX: number,\n *     clientY: number,\n *     relX: number, //position relative to top left of target\n *     relY: number,\n *     dX: number, //movementX not supported by safari on iOS, so need my own\n *     dY: number,\n *     downPageX: number, //where was pointer when down-event occurred - set for down|move|up\n *     downPageY: number,\n *     coalescedArr: Array of {\n *         pageX: number,\n *         pageY: number,\n *         clientX: number,\n *         clientY: number,\n *         relX: number, //position relative to top left of target\n *         relY: number,\n *         dX: number,\n *         dY: number,\n *         time: number// same timescale as performance.now() - might be exact same number as in parent\n *     },\n *     time: number, // same timescale as performance.now()\n *     button: 'left'|'middle'|'right',\n *     pressure: number (0-1), // always 1 for touch and mouse\n *     eventPreventDefault: function(),\n *     eventStopPropagation: function(),\n * }\n *\n * wheelEvent = {\n *     deltaY: number, // increments of 1\n *     pageX: number,\n *     pageY: number,\n *     relX: number,\n *     relY: number,\n * }\n *\n * isOver(): boolean - if pointer over the target\n *\n * @param p\n */\nexport const PointerListener = (function () {\n\n    //keeping track of pointers for movement fallback\n    const pointerArr = [];\n\n    function addPointer(event) {\n        const pointerObj = {\n            pointerId: event.pointerId,\n            lastPageX: null,\n            lastPageY: null\n        };\n        pointerArr.push(pointerObj);\n\n        if (pointerArr.length > 15) {\n            pointerArr.shift();\n        }\n\n        return pointerObj;\n    }\n\n    function getPointer(event) {\n        for (let i = pointerArr.length - 1; i >= 0; i--) {\n            if (event.pointerId === pointerArr[i].pointerId) {\n                return pointerArr[i];\n            }\n        }\n        return null;\n    }\n\n\n    let pressureNormalizeAvgCount = 0;\n    let pressureNormalizeAvgPressure = null;\n    let pressureNormalizeIsComplete = false;\n    let pressureNormalizeFactor = 1;\n\n    return function (p) {\n        const targetElement = p.target;\n        const onPointerCallback = p.onPointer;\n        const onWheelCallback = p.onWheel;\n        const onEnterLeaveCallback = p.onEnterLeave;\n        const maxPointers = 'maxPointers' in p ? p.maxPointers : 1;\n        const buttonsToStr = { // translation\n            '1': 'left',\n            '2': 'right',\n            '4': 'middle'\n        };\n        const wheelCleaner = new WheelCleaner(function (wheelEvent) {\n            if (isDestroyed) {\n                return;\n            }\n            if (onWheelCallback) {\n                const bounds = targetElement.getBoundingClientRect();\n                wheelEvent.relX = wheelEvent.clientX - bounds.left + targetElement.scrollLeft;\n                wheelEvent.relY = wheelEvent.clientY - bounds.top + targetElement.scrollTop;\n                onWheelCallback(wheelEvent);\n            }\n        });\n        let isDestroyed = false;\n\n        const timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\n\n\n        //to circumvent a chrome input glitch\n        let lastPointerType = '';\n        let didSkip = false;\n\n\n        /*\n        pointers that are pressing a button\n        dragObj = {\n            pointerId: long,\n            pointerType: 'mouse'|'pen'|'touch',\n            downPageX: number, //where was pointer when down-event occurred\n            downPageY: number,\n            button: long,\n            lastPageX: number, //pageX in previous event - only for touch events, because they don't have movementX/Y\n            lastPageY: number,\n            lastTimeStamp: number\n        }\n         */\n        const dragObjArr = [];\n        const dragPointerIdArr = [];\n\n        function getDragObj(pointerId) {\n            for (let i = 0; i < dragObjArr.length; i++) {\n                if (pointerId === dragObjArr[i].pointerId) {\n                    return dragObjArr[i];\n                }\n            }\n            return null;\n        }\n\n        function removeDragObj(pointerId) {\n            let removedDragObj = null;\n            for (let i = 0; i < dragPointerIdArr.length; i++) {\n                if (dragPointerIdArr[i] === pointerId) {\n                    removedDragObj = dragObjArr[i];\n                    dragObjArr.splice(i, 1);\n                    dragPointerIdArr.splice(i, 1);\n                    i--;\n                }\n            }\n            return removedDragObj;\n        }\n\n\n        function normalizePressure(pressure, type?) {\n            if (pressure === 0 || pressure === 1) {\n                return pressure;\n            }\n\n            // was this there to prevent some glitch?\n            /*if (pressureNormalizeIsComplete && type === 'pointerdown' && pressure !== 1) {\n                pressure *= 0.004;\n            }*/\n\n            if (pressureNormalizeAvgCount < 60) {\n                if (pressureNormalizeAvgCount === 0) {\n                    pressureNormalizeAvgPressure = pressure;\n                } else {\n                    pressureNormalizeAvgPressure = mix(pressure, pressureNormalizeAvgPressure, 0.95);\n                }\n                pressureNormalizeAvgCount++;\n            } else if (!pressureNormalizeIsComplete) {\n                pressureNormalizeIsComplete = true;\n                //BB.throwOut('avg pressure decision!' + pressureNormalizeAvgPressure);\n                if (pressureNormalizeAvgPressure < 0.13) { // absurd pressure needed\n                    pressureNormalizeFactor = 2.3;\n                }\n            }\n\n\n            return Math.pow(pressure, 1 / pressureNormalizeFactor);\n        }\n\n\n        /**\n         *\n         * More trustworthy pointer attributes. that behave the same across browsers.\n         * returns a new object. this object also gets attached to the orig event. -> event.corrected\n         *\n         * @param event\n         * @returns {{pointerId: number, timeStamp: number, button, buttons, pointerType: (string|string|any), movementY: number, movementX: number, pressure, coalescedArr: [], pageY, pageX, clientX, clientY, eventPreventDefault: func, eventStopPropagation: func}\n         */\n        function correctPointerEvent(event) {\n            if (event.corrected) {\n                return event.corrected;\n            }\n\n            /*if (event.type === 'pointermove' && !window.hidePressureOut) {\n                if (event.type === 'pointermove') {\n                    BB.throwOut(event.pressure + ' ' + event.pointerType);\n                }\n            }*/\n\n            const correctedObj = {\n                pointerId: event.pointerId,\n                pointerType: event.pointerType,\n                pageX: event.pageX,\n                pageY: event.pageY,\n                clientX: event.clientX,\n                clientY: event.clientY,\n                movementX: event.movementX,\n                movementY: event.movementY,\n                timeStamp: event.timeStamp + timeStampOffset,\n                pressure: normalizePressure(event.pressure, event.type),\n                buttons: event.buttons,\n                button: event.button,\n                coalescedArr: [],\n                eventPreventDefault: function () {\n                    event.preventDefault();\n                },\n                eventStopPropagation: function () {\n                    event.stopPropagation();\n                }\n            };\n            event.corrected = correctedObj;\n\n            let customPressure = null;\n            if ('pointerId' in event) {\n                if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\n                    correctedObj.pressure = 1;\n                    customPressure = 1;\n                }\n            } else {\n                correctedObj.pointerId = 0;\n                correctedObj.pointerType = 'mouse';\n                correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\n                customPressure = correctedObj.pressure;\n            }\n\n            if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\n                correctedObj.buttons = 1; //todo wrong if no buttons actually pressed\n            }\n\n            let coalescedEventArr = [];\n            if ('getCoalescedEvents' in event) {\n                coalescedEventArr = event.getCoalescedEvents();\n            }\n\n            // chrome somehow movementX not same scale as pageX. todo: only chrome?\n            // so make my own\n\n            let pointerObj = getPointer(correctedObj);\n            if (pointerObj === null) {\n                pointerObj = addPointer(correctedObj);\n            }\n\n            const totalLastX = pointerObj.lastPageX;\n            const totalLastY = pointerObj.lastPageY;\n\n            for (let i = 0; i < coalescedEventArr.length; i++) {\n                const eventItem = coalescedEventArr[i];\n\n                correctedObj.coalescedArr.push({\n                    pageX: eventItem.pageX,\n                    pageY: eventItem.pageY,\n                    clientX: eventItem.clientX,\n                    clientY: eventItem.clientY,\n                    movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n                    movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n                    timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\n                    pressure: customPressure === null ? normalizePressure(eventItem.pressure) : customPressure\n                });\n\n                pointerObj.lastPageX = eventItem.pageX;\n                pointerObj.lastPageY = eventItem.pageY;\n            }\n\n            pointerObj.lastPageX = correctedObj.pageX;\n            pointerObj.lastPageY = correctedObj.pageY;\n            correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n            correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n\n            return correctedObj;\n\n        }\n\n        /**\n         * creates a value for onPointer, from a pointer event handler\n         *\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\n         * @param correctedEvent - corrected pointer event from correctPointerEvent()\n         * @param custom - object for setting custom attributes\n         * @returns {{pointerId: number, pointerType: *, dX: (*), relY: number, dY: (*), relX: number, type: *, event: *, pageY: *, pageX: *}}\n         */\n        function createPointerOutEvent(typeStr, correctedEvent, custom?) {\n\n            const bounds = targetElement.getBoundingClientRect();\n            const result: any = {\n                type: typeStr,\n                pointerId: correctedEvent.pointerId,\n                pointerType: correctedEvent.pointerType,\n                pageX: correctedEvent.pageX,\n                pageY: correctedEvent.pageY,\n                clientX: correctedEvent.clientX,\n                clientY: correctedEvent.clientY,\n                relX: correctedEvent.clientX - bounds.left + targetElement.scrollLeft,\n                relY: correctedEvent.clientY - bounds.top + targetElement.scrollTop,\n                dX: correctedEvent.movementX,\n                dY: correctedEvent.movementY,\n                time: correctedEvent.timeStamp,\n                eventPreventDefault: correctedEvent.eventPreventDefault,\n                eventStopPropagation: correctedEvent.eventStopPropagation\n            };\n\n            if (typeStr === 'pointermove') {\n                result.coalescedArr = [];\n                if (correctedEvent.coalescedArr.length > 1) {\n                    let coalescedItem;\n                    for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\n                        coalescedItem = correctedEvent.coalescedArr[i];\n                        result.coalescedArr.push({\n                            pageX: coalescedItem.pageX,\n                            pageY: coalescedItem.pageY,\n                            clientX: coalescedItem.clientX,\n                            clientY: coalescedItem.clientY,\n                            relX: coalescedItem.clientX - bounds.left + targetElement.scrollLeft,\n                            relY: coalescedItem.clientY - bounds.top + targetElement.scrollTop,\n                            dX: coalescedItem.movementX,\n                            dY: coalescedItem.movementY,\n                            time: coalescedItem.timeStamp\n                        });\n                    }\n                }\n            }\n\n            if (custom) {\n                const keyArr = Object.keys(custom);\n                for (let i = 0; i < keyArr.length; i++) {\n                    result[keyArr[i]] = custom[keyArr[i]];\n                }\n            }\n\n            return result;\n        }\n\n        /**\n         * creates a value for onPointer, from a fallback touch event handler\n         *\n         * @param typeStr string - 'pointerdown'|'pointermove'|'pointerup'\n         * @param touchListItem - element from changed touch list\n         * @param touchEvent - touch event\n         * @param custom - object for setting custom attributes\n         * @returns {{pointerId: number, pointerType: string, relY: number, relX: number, type: *, event: *, pageY: *, pageX: *}}\n         */\n        function createTouchOutEvent(typeStr, touchListItem, touchEvent, custom) {\n            const bounds = targetElement.getBoundingClientRect();\n            const result: any = {\n                type: typeStr,\n                pointerId: touchListItem.identifier,\n                pointerType: 'touch',\n                pageX: touchListItem.pageX,\n                pageY: touchListItem.pageY,\n                clientX: touchListItem.clientX,\n                clientY: touchListItem.clientY,\n                relX: touchListItem.pageX - bounds.left + targetElement.scrollLeft,\n                relY: touchListItem.pageY - bounds.top + targetElement.scrollTop,\n                time: touchEvent.timeStamp + timeStampOffset,\n                eventPreventDefault: function() { touchEvent.preventDefault(); },\n                eventStopPropagation: function() { touchEvent.stopPropagation(); }\n            };\n\n            if (typeStr === 'pointermove') {\n                result.coalescedArr = [];\n            }\n\n            const keyArr = Object.keys(custom);\n            for (let i = 0; i < keyArr.length; i++) {\n                result[keyArr[i]] = custom[keyArr[i]];\n            }\n\n            return result;\n        }\n\n        function setupDocumentListeners() {\n            addEventListener(document, 'pointermove', onGlobalPointerMove);\n            addEventListener(document, 'pointerup', onGlobalPointerUp);\n            addEventListener(document, 'pointerleave', onGlobalPointerLeave);\n        }\n\n        function destroyDocumentListeners() {\n            removeEventListener(document, 'pointermove', onGlobalPointerMove);\n            removeEventListener(document, 'pointerup', onGlobalPointerUp);\n            removeEventListener(document, 'pointerleave', onGlobalPointerLeave);\n        }\n\n        let isOverCounter = 0; // might be multiple pointers\n        function onPointerEnter() {\n            isOverCounter++;\n            if (onEnterLeaveCallback) {\n                onEnterLeaveCallback(true);\n            }\n        }\n\n        function onPointerLeave() {\n            isOverCounter--;\n            if (onEnterLeaveCallback) {\n                onEnterLeaveCallback(false);\n            }\n        }\n\n        function onPointermove(event) {\n            event = correctPointerEvent(event);\n\n            const tempLastPointerType = lastPointerType;\n            lastPointerType = event.pointerType;\n\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || event.pointerType === 'touch') {\n                didSkip = false;\n                return;\n            }\n\n            // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n            if (!didSkip && event.pointerType === 'mouse' && tempLastPointerType === 'pen') {\n                didSkip = true;\n                return;\n            }\n            didSkip = false;\n\n            const outEvent = createPointerOutEvent('pointermove', event);\n            onPointerCallback(outEvent);\n\n        }\n\n        function onPointerdown(event) {\n            //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' pointerdown');\n            if (dragPointerIdArr.includes(event.pointerId) || dragPointerIdArr.length === maxPointers || !([1, 2, 4].includes(event.buttons))) {\n                //BB.throwOut('pointerdown ignored');\n                return;\n            }\n\n\n            //set up global listeners\n            if (dragObjArr.length === 0) {\n                setupDocumentListeners();\n            }\n            const dragObj = {\n                pointerId: event.pointerId,\n                pointerType: event.pointerType,\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n                buttons: event.buttons,\n                lastPageX: event.pageX,\n                lastPageY: event.pageY,\n                lastTimeStamp: event.timeStamp\n            };\n            dragObjArr.push(dragObj);\n            setTouchTimeout(dragObj);\n            dragPointerIdArr.push(event.pointerId);\n\n            const outEvent = createPointerOutEvent('pointerdown', event, {\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n                button: buttonsToStr[event.buttons],\n                pressure: event.pressure\n            });\n\n            onPointerCallback(outEvent);\n        }\n\n\n        function onGlobalPointerMove(event) {\n            //BB.throwOut('pointermove ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\n                return;\n            }\n\n            const dragObj = getDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            //if pointer changes button its pressing -> turn into pointerup\n            if (event.buttons !== dragObj.buttons) {\n                //pointer up\n\n                //remove listener\n                if (dragObjArr.length === 1) {\n                    destroyDocumentListeners();\n                }\n                removeDragObj(event.pointerId);\n\n                const outEvent = createPointerOutEvent('pointerup', event, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY\n                });\n                onPointerCallback(outEvent);\n                return;\n\n            }\n\n            setTouchTimeout(dragObj);\n\n            // ipad likes to do this\n            if (\n                event.pointerType === 'pen' &&\n                event.pageX === dragObj.lastPageX &&\n                event.pageY === dragObj.lastPageY &&\n                event.timeStamp === dragObj.lastTimeStamp\n            ) {\n                //ignore\n                return;\n            }\n\n            const outEvent = createPointerOutEvent('pointermove', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY,\n                button: buttonsToStr[event.buttons],\n                pressure: event.pressure\n            });\n\n            dragObj.lastPageX = event.pageX;\n            dragObj.lastPageY = event.pageY;\n            dragObj.lastTimeStamp = event.timeStamp;\n\n            onPointerCallback(outEvent);\n\n        }\n\n        function onGlobalPointerUp(event) {\n            //BB.throwOut('pointerup ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n            if (!(dragPointerIdArr.includes(event.pointerId))) {\n                return;\n            }\n\n            //remove listener\n            if (dragObjArr.length === 1) {\n                destroyDocumentListeners();\n            }\n            const dragObj = removeDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            const outEvent = createPointerOutEvent('pointerup', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY\n            });\n            onPointerCallback(outEvent);\n\n        }\n\n        function onGlobalPointerLeave(event) {\n            //BB.throwOut('pointerleave ' + event.pointerId);\n            event = correctPointerEvent(event);\n            ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n            if (!(dragPointerIdArr.includes(event.pointerId))) { //} || event.target !== document) {\n                return;\n            }\n\n            //remove listener\n            if (dragObjArr.length === 1) {\n                destroyDocumentListeners();\n            }\n            const dragObj = removeDragObj(event.pointerId);\n            clearTouchTimeout(dragObj);\n\n            const outEvent = createPointerOutEvent('pointerup', event, {\n                downPageX: dragObj.downPageX,\n                downPageY: dragObj.downPageY\n            });\n            onPointerCallback(outEvent);\n        }\n\n\n        /*\n        --- ipad pointer event glitch damage control ---\n\n        ipad pointer events are glitchy. doesn't always fire pointerup.\n        - when two fingers get really close to each other\n        - when finger moves out and back in bottom\n\n        This artificially fires a pointerup\n        */\n        function onTouchTimeout(dragObj) {\n\n            //create fake event\n            const fakeEvent = {\n                pointerId: dragObj.pointerId,\n                pointerType: dragObj.pointerType,\n                type: 'pointerup',\n                timeStamp: performance.now(),\n                pageX: 0,\n                pageY: 0,\n                clientX: 0,\n                clientY: 0,\n                preventDefault: function () {\n                },\n                stopPropagation: function () {\n                }\n            };\n\n            //call onGlobalPointerUp with it\n            onGlobalPointerUp(fakeEvent);\n        }\n\n        function setTouchTimeout(dragObj) {\n            if (dragObj.pointerType !== 'touch') {\n                return;\n            }\n            dragObj.touchTimeout = setTimeout(function () {\n                onTouchTimeout(dragObj);\n            }, 2500); // 2.5 seconds\n        }\n\n        function clearTouchTimeout(dragObj) {\n            if (!dragObj.touchTimeout) {\n                return;\n            }\n            clearTimeout(dragObj.touchTimeout);\n            dragObj.touchTimeout = null;\n        }\n\n\n        if (onEnterLeaveCallback) {\n            addEventListener(targetElement, 'pointerenter', onPointerEnter);\n            addEventListener(targetElement, 'pointerleave', onPointerLeave);\n        }\n        if (onPointerCallback) {\n            addEventListener(targetElement, 'pointermove', onPointermove);\n            addEventListener(targetElement, 'pointerdown', onPointerdown);\n        }\n        if (onWheelCallback) {\n            addEventListener(targetElement, 'wheel', wheelCleaner.process);\n        }\n\n\n        let onTouchstart;\n        let onTouchmove;\n        let onTouchend;\n\n        // --- touch fallback ---\n        if (!(hasPointerEvents)) {\n\n            onTouchstart = function (event) {\n                ////console.log('onTouchstart', event, event.changedTouches.length);\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length && dragObjArr.length < maxPointers; i++) {\n                    const touchObj = touchArr[i];\n\n                    //set up global listeners\n                    if (dragObjArr.length === 0) {\n                        addEventListener(document, 'touchmove', onTouchmove);\n                        addEventListener(document, 'touchend', onTouchend);\n                        addEventListener(document, 'touchcancel', onTouchend);\n                    }\n                    dragObjArr.push({\n                        pointerId: touchObj.identifier,\n                        downPageX: touchObj.pageX,\n                        downPageY: touchObj.pageY,\n                        buttons: 1,\n                        lastPageX: touchObj.pageX,\n                        lastPageY: touchObj.pageY,\n                    });\n                    dragPointerIdArr.push(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointerdown', touchObj, event, {\n                        dX: 0,\n                        dY: 0,\n                        downPageX: touchObj.downPageX,\n                        downPageY: touchObj.downPageY,\n                        button: 'left',\n                        pressure: 1\n                    });\n                    onPointerCallback(outEvent);\n                }\n\n            }\n\n            onTouchmove = function (event) {\n                event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length; i++) {\n                    const touchObj = touchArr[i];\n\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\n                        continue;\n                    }\n                    const dragObj = getDragObj(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointermove', touchObj, event, {\n                        dX: touchObj.pageX - dragObj.lastPageX,\n                        dY: touchObj.pageY - dragObj.lastPageY,\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                        button: 'left',\n                        isCoalesced: false,\n                        pressure: 1\n                    });\n                    dragObj.lastPageX = touchObj.pageX;\n                    dragObj.lastPageY = touchObj.pageY;\n                    onPointerCallback(outEvent);\n\n                }\n\n            }\n\n            onTouchend = function (event) {\n                if (event.type !== 'touchcancel') {\n                    event.preventDefault(); // needs to stay, otherwise page scrolls on iOS12\n                }\n\n\n                const touchArr = event.changedTouches;\n                for (let i = 0; i < touchArr.length; i++) {\n                    const touchObj = touchArr[i];\n\n                    if (!(dragPointerIdArr.includes(touchObj.identifier))) {\n                        continue;\n                    }\n\n                    //remove listener\n                    if (dragObjArr.length === 1) {\n                        removeEventListener(document, 'touchmove', onTouchmove);\n                        removeEventListener(document, 'touchend', onTouchend);\n                        removeEventListener(document, 'touchcancel', onTouchend);\n                    }\n                    const dragObj = removeDragObj(touchObj.identifier);\n\n                    const outEvent = createTouchOutEvent('pointerup', touchObj, event, {\n                        dX: touchObj.pageX - dragObj.lastPageX,\n                        dY: touchObj.pageY - dragObj.lastPageY,\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                    });\n\n                    onPointerCallback(outEvent);\n                }\n\n            }\n\n            if (onPointerCallback) {\n                addEventListener(targetElement, 'touchstart', onTouchstart);\n            }\n\n        } else if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            onTouchmove = function(e) {\n                e.preventDefault();\n            }\n            addEventListener(targetElement, 'touchmove', onTouchmove);\n\n        }\n\n\n        // --- interface ---\n\n        this.isOver = function () {\n            return isOverCounter > 0;\n        };\n\n        this.destroy = function () {\n            if (isDestroyed) {\n                return;\n            }\n            isDestroyed = true;\n            removeEventListener(targetElement, 'pointerenter', onPointerEnter);\n            removeEventListener(targetElement, 'pointerleave', onPointerLeave);\n            removeEventListener(targetElement, 'pointermove', onPointermove);\n            removeEventListener(targetElement, 'pointerdown', onPointerdown);\n            removeEventListener(targetElement, 'wheel', wheelCleaner.process);\n            if (dragObjArr.length > 0) {\n                destroyDocumentListeners();\n            }\n\n            if (!(hasPointerEvents)) {\n                removeEventListener(targetElement, 'touchstart', onTouchstart);\n                if (dragObjArr.length > 0) {\n                    removeEventListener(document, 'touchmove', onTouchmove);\n                    removeEventListener(document, 'touchend', onTouchend);\n                    removeEventListener(document, 'touchcancel', onTouchend);\n                }\n            } else {\n                removeEventListener(targetElement, 'touchmove', onTouchmove);\n            }\n        };\n\n    }\n})();","import {IBounds, IVector2D} from '../BB.types';\n\nexport function mix (a: number, b: number, f: number): number {\n    return a * (1 - f) + b * f;\n}\n\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\n\nexport function lenSquared (x: number, y: number): number {\n    // faster because no square-root\n    return x * x + y * y;\n}\n\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\n\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\n}\n\nexport function clamp (num: number, min: number, max: number): number {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num;\n}\n\nexport function rotate (x: number, y: number, deg: number): IVector2D {\n    const theta = deg * (Math.PI / 180);\n    const cs = Math.cos(theta);\n    const sn = Math.sin(theta);\n\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs\n    };\n}\n\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\n\nexport function intDxy(remainder: IVector2D, fDx: number, fDy: number) {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    const dX = Math.round(remainder.x);\n    const dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX,\n        dY,\n    };\n}\n\n/**\n * return closest even number\n * @param f\n */\nexport function roundEven(f: number) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f;\n        }\n        return f + 1;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 0) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * return closest uneven number\n * @param f\n */\nexport function roundUneven(f: number) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f + 1;\n        }\n        return f;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 1) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * update target so it includes bounds\n * @param target\n * @param bounds\n */\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\n    if (!bounds) {\n        return target;\n    }\n    if (!target) {\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\n    } else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\n\n/**\n * determine overlap of bounds with width&height\n */\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\n    let x1 = Math.max(0, bounds.x1);\n    let y1 = Math.max(0, bounds.y1);\n    let x2 = Math.min(width - 1, bounds.x2);\n    let y2 = Math.min(height - 1, bounds.y2);\n    if (x1 > x2 || y1 > y2) {\n        return null;\n    }\n    return { x1, y1, x2, y2 };\n}","import {clamp, dist, mix, pointsToAngleRad} from '../math/math';\n\n\ntype ChainOutFunc = (event?) => void;\n\n/**\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\n * each element in the chain might hold back the events, swallow them, or transform them\n *\n * p = {\n *     chainArr: ChainElement[]\n * }\n *\n * chainIn(event): null - feed an event into the chain\n * setChainOut(func): void - func(event) <- called when passed through chain\n * ^ each ChainElement needs these methods too\n *\n * @param p\n * @constructor\n */\nexport const EventChain = function (p) {\n\n    const chainArr = p.chainArr;\n    let chainOut: ChainOutFunc = () => undefined;\n\n    function continueChain(i, event) {\n        for (; i < chainArr.length; i++) {\n            event = chainArr[i].chainIn(event);\n            if (event === null) {\n                return null;\n            }\n        }\n        chainOut(event);\n        return null;\n    }\n\n    for (let i = 0; i < chainArr.length; i++) {\n        (function (i) {\n            chainArr[i].setChainOut(function (event) {\n                continueChain(i + 1, event);\n            });\n        })(i);\n    }\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        return continueChain(0, event);\n    };\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Detects double taps.\n *\n * p = {\n *     onDoubleTap: function({pageX: number, pageY: number}) - fires when double tap occurs\n * }\n *\n * chainIn\n * setChainOut\n * setAllowedPointerTypeArr(string[]): void - which pointer types are allowed\n * setAllowedButtonArr(string[]): void - which buttons are allowed\n *\n * @param p\n * @constructor\n */\nexport const DoubleTapper = function (p) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    const minSilenceBeforeDurationMs = 400;\n    const maxPressedDurationMs = 300;\n    const maxPressedDistancePx = 10;\n    const maxInbetweenDistancePx = 19;\n    const maxUpToUpDurationMs = 500;\n    const maxUntilSecondDownDurationMs = 300;\n    const minSilenceAfterMs = 250;\n\n    let allowedPointerTypeArr = ['touch', 'mouse', 'pen'];\n    let allowedButtonArr = ['left'];\n\n    let sequenceArr = [];\n    const pointersDownIdArr = [];\n    let lastUpTime = 0;\n    let nowTime = 0;\n\n    let eventQueueArr = [];\n\n\n    function fail() {\n        if (sequenceArr.length === 0) { // no gesture started -> can be ignored\n            return;\n        }\n        clearTimeout(timeoutObj.fail);\n        clearTimeout(timeoutObj.maxUntilSecondDown);\n        clearTimeout(timeoutObj.success);\n        timeoutObj.fail = null;\n        timeoutObj.maxUntilSecondDown = null;\n        timeoutObj.success = null;\n\n\n        for (let i = 0; i < eventQueueArr.length; i++) {\n            chainOut(eventQueueArr[i]);\n        }\n        eventQueueArr = [];\n\n        sequenceArr = [];\n    }\n\n    // double tap achieved\n    function success() {\n        timeoutObj.fail = null;\n        timeoutObj.success = null;\n        eventQueueArr = []; // events get swallowed\n        const lastSequenceItem = sequenceArr[sequenceArr.length - 1];\n        sequenceArr = [];\n        p.onDoubleTap({pageX: lastSequenceItem.pageX, pageY: lastSequenceItem.pageY});\n    }\n\n\n    const timeoutObj = {\n        fail: null,\n        maxUntilSecondDown: null,\n        success: null\n    };\n\n    //returns false if time already up. otherwise sets up timeout\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\n        const diff = timeMS - nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\n        return true;\n    }\n\n\n    /**\n     * @param event object - a pointer event from BB.PointerListener\n     */\n    function processEvent(event) {\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (!allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\n            //console.log('wrong input type -> fail');\n            fail();\n            return;\n        }\n\n        nowTime = performance.now();\n        const lastSequenceItem = sequenceArr.length > 0 ? sequenceArr[sequenceArr.length - 1] : null;\n        if (event.type === 'pointerup') {\n            lastUpTime = event.time;\n        }\n\n        if (event.type === 'pointerdown') {\n            if (pointersDownIdArr.length > 1) { // more than one pointer down -> fail\n                //console.log('more than one pointer down -> fail');\n                fail();\n                return;\n            }\n            if (timeoutObj.success !== null) { // silence-after not achieved -> fail\n                //console.log('silence-after not achieved -> fail');\n                fail();\n                return;\n            }\n            if (sequenceArr.length === 0 && nowTime - lastUpTime < minSilenceBeforeDurationMs) { // silence before not achieved -> fail\n                //console.log('silence before not achieved -> fail');\n                fail();\n                return;\n            }\n            if (!allowedButtonArr.includes(event.button)) { // wrong button -> fail\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                fail();\n                return;\n            }\n            if (lastSequenceItem && lastSequenceItem.isDown || sequenceArr.length > 2) { // jumbled -> fail\n                //console.log('jumbled -> fail');\n                fail();\n                return;\n            }\n            if (lastSequenceItem) {\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                if (distance > maxInbetweenDistancePx) { //moved too much -> reset\n                    //console.log('maxInbetweenDistancePx -> reset');\n                    fail();\n\n                    if (nowTime - lastSequenceItem.time < minSilenceBeforeDurationMs) { //silence before not achieved -> fail\n                        return;\n                    }\n                }\n            }\n            sequenceArr.push({\n                isDown: true,\n                time: nowTime,\n                position: [event.pageX, event.pageY],\n                pointerId: event.pointerId\n            });\n            //maxUntilSecondDown\n\n            if (sequenceArr.length > 1) {\n                clearTimeout(timeoutObj.maxUntilSecondDown);\n            } else if (!setupTimeout('maxUntilSecondDown', fail, event.time + maxUntilSecondDownDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                fail();\n                return;\n            }\n\n\n            clearTimeout(timeoutObj.fail);\n            if (!setupTimeout('fail', fail, event.time + maxPressedDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                fail();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointermove' && lastSequenceItem.pointerId === event.pointerId) {\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                console.log('another pointer mixing in -> fail');\n                fail();\n                return;\n            }*/\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n            if (distance > maxPressedDistancePx) { //moved too much -> fail\n                //console.log('maxPressedDistancePx -> fail');\n                fail();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointerup') {\n            if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                fail();\n                return;\n            }\n            if (nowTime >= lastSequenceItem.time + maxPressedDurationMs) { //pressed too long -> fail\n                fail();\n                return;\n            }\n            clearTimeout(timeoutObj.fail);\n\n            if (sequenceArr.length < 3) {\n                if (!setupTimeout('fail', fail, event.time + maxUpToUpDurationMs)) {\n                    fail();\n                    return;\n                }\n\n                sequenceArr = [\n                    lastSequenceItem,\n                    {\n                        isUp: true,\n                        time: nowTime,\n                        position: [event.pageX, event.pageY]\n                    }\n                ];\n                return;\n            }\n\n            if (nowTime < sequenceArr[1].time + maxUpToUpDurationMs) {\n                // double tap almost success\n                // only needs silence\n                sequenceArr.push({\n                    pageX: event.pageX,\n                    pageY: event.pageY\n                });\n                if (!setupTimeout('success', success, event.time + minSilenceAfterMs)) {\n                    fail();\n                }\n            } else { // time up -> fail\n                fail();\n            }\n\n        }\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        processEvent(event);\n\n        if (sequenceArr.length === 0) { //existing events can not become a double tap\n            fail();\n            return event;\n        }\n        // events might become a double tap -> queue\n        eventQueueArr.push(event);\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n    this.setAllowedPointerTypeArr = function (arr) {\n        allowedPointerTypeArr = arr;\n    };\n\n    this.setAllowedButtonArr = function (arr) {\n        allowedButtonArr = arr;\n    };\n};\n\n\n/**\n * A ChainElement. Detects a single tap, done with N 'touch' pointers\n *\n * p = {\n *      fingers: number - number of fingers\n *      onTap: function() - fires when tap occurs\n * }\n *\n * chainIn\n * setChainOut\n *\n * @param p\n * @constructor\n */\nexport const NFingerTapper = function (p) {\n\n    const fingers = p.fingers;\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    const minSilenceBeforeDurationMs = 50; //250;\n    const maxTapMs = 500;\n    const maxFirstLastFingerDownMs = 250;\n    const maxPressedDistancePx = 12; //5 + fingers * 5;\n    const silenceAfterDurationMs = 250;\n\n\n    /*\n        fingerObj = {\n            pointerId: number,\n            downTime: number,\n            downPageX: number,\n            downPageY: number,\n            isUp: boolean\n        }\n     */\n    let fingerArr = [];\n    let firstDownTime;\n    let eventQueueArr = [];\n    let lastEventTime = 0;\n    const pointersDownIdArr = [];\n\n    function fail() {\n        if (eventQueueArr.length === 0) {\n            return;\n        }\n        clearTimeout(timeoutObj.firstLastDownTimeout);\n        clearTimeout(timeoutObj.tapTimeout);\n        for (let i = 0; i < eventQueueArr.length; i++) {\n            chainOut(eventQueueArr[i]);\n        }\n        eventQueueArr = [];\n        fingerArr = [];\n    }\n\n    function success() {\n        clearTimeout(timeoutObj.firstLastDownTimeout);\n        clearTimeout(timeoutObj.tapTimeout);\n        eventQueueArr = []; // events get swallowed\n        fingerArr = [];\n        p.onTap();\n    }\n\n    let nowTime;\n    const timeoutObj = {\n        firstLastDownTimeout: null,\n        tapTimeout: null\n    };\n\n    function setupTimeout(timeoutStr, timeMS) {\n        const diff = timeMS - nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(fail, diff);\n        return true;\n    }\n\n    function processEvent(event) {\n\n        const tempLastEventTime = lastEventTime;\n        lastEventTime = event.time;\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (event.pointerType !== 'touch') {\n            if (fingerArr.length > 0) { // already in gesture -> fail\n                fail();\n            }\n            return;\n        }\n\n        nowTime = performance.now();\n\n        if (event.type === 'pointerdown') {\n            //console.log('down');\n            if (fingerArr.length + 1 !== pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\n                fail();\n                return;\n            }\n            if (fingerArr.length === fingers) { // too many fingers down -> fail\n                //console.log(fingers + ': too many fingers down -> fail');\n                fail();\n                return;\n            }\n            if (fingerArr.length > 0 && event.time - maxFirstLastFingerDownMs > fingerArr[0].downTime) { // took too long to touch with all fingers -> fail\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                fail();\n                return;\n            }\n            if (fingerArr.length === 0 && event.time - minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\n                //console.log(fingers + ': not enough silence before -> fail');\n                fail();\n                return;\n            }\n\n            if (fingerArr.length === 0) {\n                firstDownTime = event.time;\n\n                if (!setupTimeout('firstLastDownTimeout', event.time + maxFirstLastFingerDownMs) || !setupTimeout('tapTimeout', event.time + maxTapMs)) { // timeouts already up -> fail\n                    fail();\n                    return;\n                }\n\n            }\n            fingerArr.push({\n                pointerId: event.pointerId,\n                downTime: event.time,\n                downPageX: event.pageX,\n                downPageY: event.pageY\n            });\n            return;\n\n        }\n\n        if (event.type === 'pointermove') {\n\n            if (fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            let fingerObj = null;\n            for (let i = 0; i < fingerArr.length; i++) {\n                if (fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\n                fail();\n                return;\n            }\n\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                fail();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\n                fail();\n                return;\n            }\n\n        }\n\n        if (event.type === 'pointerup') {\n\n            if (fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            //console.log('up', event.pageX, event.pageY);\n            if (fingerArr.length !== fingers) { // not enough fingers -> fail\n                //console.log(fingers + ': not enough fingers -> fail');\n                fail();\n                return;\n            }\n\n            let fingerObj = null;\n            let i = 0;\n            for (; i < fingerArr.length; i++) {\n                if (fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) {\n                //do nothing\n                return;\n            }\n\n            if (event.time - maxTapMs > firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                fail();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                //console.log(fingerArr);\n                fail();\n                return;\n            }\n\n            fingerObj.isUp = true;\n\n            let allAreUp = true;\n            for (let i = 0; i < fingerArr.length; i++) {\n                if (!fingerArr[i].isUp) {\n                    allAreUp = false;\n                    break;\n                }\n            }\n            //console.log('fingerArr', fingerArr);\n\n            if (allAreUp) { // success\n                success();\n                return true;\n            }\n\n        }\n\n\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        const result = processEvent(event);\n\n        //console.log(fingerArr.length);\n\n        if (result === true) {\n            //tap success -> event gets swallowed\n            return null;\n        }\n        if (fingerArr.length === 0) {\n            return event;\n        } else {\n            eventQueueArr.push(event);\n        }\n\n        return null;\n\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\n * Further pointers are ignored, but their events get swallowed during the pinching.\n * pinching ends when ALL pointers are lifted.\n * Events passed through if no pinching.\n *\n * p = {\n *      onPinch: function({type: 'end'} | {\n *          type: 'move',\n *          relX: number,\n *          relY: number,\n *          downRelX: number,\n *          downRelY: number,\n *          angleDeg: number,\n *          scale: number\n *      }) - fires when pinching occurs\n * }\n *\n * chainIn\n * setChainOut\n *\n * @param p\n * @constructor\n */\nexport const PinchZoomer = function (p) {\n\n    const firstFingerMaxDistancePx = 10;\n    const untilSecondFingerDurationMs = 250;\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    const pointersDownIdArr = [];\n    /*\n    gestureObj = {\n        touchPointerArr: Array of {\n            pointerId: number,\n            relX: number,\n            relY: number,\n            downRelX: number, // only for first\n            downRelY: number\n        },\n        otherPointerIdArr: number[],\n        isInProgress: boolean\n    }\n    */\n    let gestureObj = null;\n    let eventQueueArr = [];\n\n\n    function end() {\n        gestureObj = null;\n        eventQueueArr = [];\n    }\n\n    function fail(doSwallow?) {\n        if (!gestureObj) { // no gesture happening -> ignore\n            return;\n        }\n\n        clearTimeout(timeoutObj.secondFingerTimeout);\n        if (!doSwallow) {\n            for (let i = 0; i < eventQueueArr.length; i++) {\n                chainOut(eventQueueArr[i]);\n            }\n        }\n        end();\n    }\n\n\n    let nowTime;\n    const timeoutObj = {\n        secondFingerTimeout: null\n    };\n\n    function setupTimeout(timeoutStr, targetFunc, timeMS) {\n        const diff = timeMS - nowTime;\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\n        return true;\n    }\n\n\n    function processEvent(event) {\n\n        if (event.type === 'pointerdown') {\n            pointersDownIdArr.push(event.pointerId);\n\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < pointersDownIdArr.length; i++) {\n                if (pointersDownIdArr[i] === event.pointerId) {\n                    pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        //pass through scenarios\n        if (\n            !gestureObj && (\n                event.pointerType !== 'touch' || // wrong pointer type\n                (event.type === 'pointermove' && pointersDownIdArr.length > 0) || // failed before\n                pointersDownIdArr.length > 1 || // failed before\n                event.type === 'pointerup' // failed before\n            )\n        ) {\n            return;\n        }\n\n        nowTime = performance.now();\n\n\n        //pointer down\n        if (event.type === 'pointerdown') {\n\n            if (gestureObj) {\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\n\n                    gestureObj.touchPointerArr.push({\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY\n                    });\n\n                    if (gestureObj.isInProgress) {\n                        continuePinch(gestureObj, {\n                            type: 'down',\n                            index: gestureObj.touchPointerArr.length - 1\n                        });\n                    } else {\n                        clearTimeout(timeoutObj.secondFingerTimeout);\n                        gestureObj.isInProgress = true;\n                        beginPinch(gestureObj);\n                    }\n                    return;\n\n                } else { // non-touch finger down - as nth pointer\n\n                    if (gestureObj.isInProgress) {\n                        gestureObj.otherPointerIdArr.push(event.pointerId);\n                    } else { // second pointer wrong type -> fail\n                        fail();\n                    }\n                    return;\n                }\n\n\n            } else {\n                // first finger down - can only be touch if no gestureObj\n                gestureObj = {\n                    touchPointerArr: [{\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                        downRelX: event.relX,\n                        downRelY: event.relY\n                    }],\n                    otherPointerIdArr: [],\n                    isInProgress: false\n                };\n                if (!setupTimeout('secondFingerTimeout', function () {\n                    fail();\n                }, event.time + untilSecondFingerDurationMs)) { // time ran out -> fail\n                    fail();\n                    return;\n                }\n                return;\n            }\n\n        }\n\n\n        //pointer move\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\n            //gesture object should always exist here\n\n            let touchPointerObj = null;\n            let i = 0;\n            for (; i < gestureObj.touchPointerArr.length; i++) {\n                if (event.pointerId === gestureObj.touchPointerArr[i].pointerId) {\n                    touchPointerObj = gestureObj.touchPointerArr[i];\n                    break;\n                }\n            }\n\n            //null should not be possible\n\n            touchPointerObj.relX = event.relX;\n            touchPointerObj.relY = event.relY;\n\n            if (!gestureObj.isInProgress) { // only one finger down & pinching hasn't started\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\n                if (distance > firstFingerMaxDistancePx) { // moved too much -> fail\n                    fail();\n                    return;\n                }\n\n            } else {\n                if (i < 2) { // only first two touches can affect pinching\n                    continuePinch(gestureObj, {\n                        type: 'move',\n                        index: i\n                    });\n                }\n            }\n\n            return;\n        }\n\n\n        //pointer up\n        if (event.type === 'pointerup') {\n            //gesture object should always exist here\n\n            if (event.pointerType === 'touch') {\n                let i = 0;\n                for (; i < gestureObj.touchPointerArr.length; i++) {\n                    if (gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\n                        gestureObj.touchPointerArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (gestureObj.touchPointerArr.length > 0) {\n                    continuePinch(gestureObj, {\n                        type: 'up',\n                        index: i\n                    });\n                }\n\n            } else { // non-touch\n                for (let i = 0; i < gestureObj.otherPointerIdArr.length; i++) {\n                    if (gestureObj.otherPointerIdArr[i] === event.pointerId) {\n                        gestureObj.otherPointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n\n            //all fingers lifted?\n            if (gestureObj.touchPointerArr.length === 0 && gestureObj.otherPointerIdArr.length === 0) {\n                if (gestureObj.isInProgress) { // lifted last finger -> end of pinching\n                    end();\n                    endPinch();\n                } else { // lifted finger again before pinching started -> fail\n                    fail();\n                }\n                return;\n            }\n\n        }\n\n\n    }\n\n\n    // --- actual pinch transform logic ---\n\n    let pincherArr = [];\n\n    function beginPinch(gestureObj) {\n\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\n            const pointerObj = gestureObj.touchPointerArr[i];\n            pincherArr.push({\n                pointerId: pointerObj.pointerId,\n                relX: pointerObj.relX,\n                relY: pointerObj.relY,\n                downRelX: pointerObj.relX,\n                downRelY: pointerObj.relY\n            });\n        }\n\n        const event: any = {\n            type: 'move',\n            angleRad: 0,\n            scale: 1\n        };\n\n        if (pincherArr.length === 1) {\n            event.relX = pincherArr[0].downRelX;\n            event.relY = pincherArr[0].downRelY;\n        } else {\n            event.relX = 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX);\n            event.relY = 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY);\n        }\n        event.downRelX = event.relX;\n        event.downRelY = event.relY;\n\n        p.onPinch(event);\n\n    }\n\n    //actionObj = {type: 'down'|'move'|'up', index: number}\n    function continuePinch(gestureObj, actionObj) {\n\n        if (actionObj.index > 1) { // only first two pointers matter\n            return;\n        }\n\n        if (actionObj.type === 'move') {\n\n            let event;\n            pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\n            pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\n\n            if (pincherArr.length === 1) {\n\n                event = {\n                    type: 'move',\n                    downRelX: pincherArr[0].downRelX,\n                    downRelY: pincherArr[0].downRelY,\n                    relX: pincherArr[0].relX,\n                    relY: pincherArr[0].relY,\n                    angleRad: 0,\n                    scale: 1\n                };\n\n            } else {\n\n                const startDist = dist(pincherArr[0].downRelX, pincherArr[0].downRelY, pincherArr[1].downRelX, pincherArr[1].downRelY);\n                const distance = dist(pincherArr[0].relX, pincherArr[0].relY, pincherArr[1].relX, pincherArr[1].relY);\n\n                const startAngle = pointsToAngleRad({\n                    x: pincherArr[0].downRelX,\n                    y: pincherArr[0].downRelY\n                }, {x: pincherArr[1].downRelX, y: pincherArr[1].downRelY});\n                const angle = pointsToAngleRad({\n                    x: pincherArr[0].relX,\n                    y: pincherArr[0].relY\n                }, {x: pincherArr[1].relX, y: pincherArr[1].relY});\n\n                event = {\n                    type: 'move',\n                    downRelX: 0.5 * (pincherArr[0].downRelX + pincherArr[1].downRelX),\n                    downRelY: 0.5 * (pincherArr[0].downRelY + pincherArr[1].downRelY),\n                    relX: 0.5 * (pincherArr[0].relX + pincherArr[1].relX),\n                    relY: 0.5 * (pincherArr[0].relY + pincherArr[1].relY),\n                    angleRad: angle - startAngle,\n                    scale: distance / startDist\n                };\n\n            }\n\n            p.onPinch(event);\n\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\n            endPinch();\n            beginPinch(gestureObj);\n        }\n\n    }\n\n    function endPinch() {\n        pincherArr = [];\n        p.onPinch({\n            type: 'end'\n        });\n    }\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        processEvent(event);\n        if (gestureObj) {\n            if (!gestureObj.isInProgress) { // might still fail -> into queue\n                eventQueueArr.push(event);\n            }\n        } else {\n            return event;\n        }\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\n\n/**\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\n *\n * @constructor\n */\nexport const CoalescedExploder = function () {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        if (event.type === 'pointermove') {\n\n            if (event.coalescedArr.length > 0) {\n\n                let eventCopy = JSON.parse(JSON.stringify(event));\n                eventCopy.coalescedArr = [];\n                let coalescedItem;\n\n                for (let i = 0; i < event.coalescedArr.length; i++) {\n\n                    if (i > 0) {\n                        eventCopy = JSON.parse(JSON.stringify(event));\n                    }\n                    coalescedItem = event.coalescedArr[i];\n\n                    eventCopy.pageX = coalescedItem.pageX;\n                    eventCopy.pageY = coalescedItem.pageY;\n                    eventCopy.relX = coalescedItem.relX;\n                    eventCopy.relY = coalescedItem.relY;\n                    eventCopy.dX = coalescedItem.dX;\n                    eventCopy.dY = coalescedItem.dY;\n                    eventCopy.time = coalescedItem.time;\n                    if (i < event.coalescedArr.length - 1) {\n                        eventCopy.isCoalesced = true;\n                    }\n\n                    chainOut(eventCopy);\n                }\n\n            } else {\n                return event;\n            }\n        } else {\n            return event;\n        }\n\n        return null;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n};\n\nexport const OnePointerLimiter = function (pointers?) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    let downPointerId = null;\n    const ignorePointerIdArr = [];\n\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n\n        if (ignorePointerIdArr.includes(event.pointerId)) {\n            if (event.type === 'pointerup') {\n                for (let i = 0; i < ignorePointerIdArr.length; i++) {\n                    if (ignorePointerIdArr[i] === event.pointerId) {\n                        ignorePointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n            return null;\n        }\n\n        if (downPointerId === null) {\n            if (event.type === 'pointerdown') {\n                downPointerId = event.pointerId;\n            }\n            return event;\n\n        } else {\n            if (event.pointerId !== downPointerId) {\n                if (event.type === 'pointerdown') {\n                    ignorePointerIdArr.push(event.pointerId);\n                }\n                return null;\n            }\n            if (event.type === 'pointerup') {\n                downPointerId = null;\n            }\n            return event;\n        }\n\n        return null;\n\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n};\n\n\n/**\n * Not really and event chain element. but pretty similar.\n *\n * Processes draw input events. When shift held -> linetool\n * line events - what KlCanvasWorkspace passes onDraw(e)\n *\n * p = {\n *     onDraw: function(drawEvent)\n * }\n *\n * pass input in with process(drawEvent)\n *\n * modifies draw event to include such events:\n * {\n *     type: 'line',\n *     x0: null, // you have to fill that in\n *     y0: null, // you have to fill that in\n *     pressure0: null, // you have to fill that in\n *     x1: number,\n *     y1: number,\n *     pressure1: number\n * }\n *\n * @param p\n * @constructor\n */\nexport const LinetoolProcessor = function (p) {\n\n    let downEvent = null;\n    let eventQueue = [];\n    let direction = null;\n    const DIR_X = 0, DIR_Y = 1;\n\n    this.process = function (event) {\n        if (event.type === 'down') {\n            downEvent = event;\n            direction = null;\n\n            if (event.shiftIsPressed) {\n\n                p.onDraw({\n                    type: 'line',\n                    x0: null,\n                    y0: null,\n                    pressure0: null,\n                    x1: event.x,\n                    y1: event.y,\n                    pressure1: event.pressure\n                });\n\n                eventQueue.push(event);\n                return;\n            }\n\n        }\n\n        if (event.type === 'move') {\n\n            if (event.shiftIsPressed) {\n\n                if (direction === null) {\n                    const dX = Math.abs(event.x - downEvent.x);\n                    const dY = Math.abs(event.y - downEvent.y);\n\n                    if (dX > 5 || dY > 5) {\n                        direction = dX > dY ? DIR_X : DIR_Y;\n\n                        for (let i = 0; i < eventQueue.length; i++) {\n                            const e = eventQueue[i];\n                            if (direction === DIR_X) {\n                                e.y = downEvent.y;\n                            } else {\n                                e.x = downEvent.x;\n                            }\n                            p.onDraw(JSON.parse(JSON.stringify(e)));\n                        }\n                        eventQueue = [];\n                    }\n                }\n\n                if (direction === null) {\n                    eventQueue.push(event);\n                    return;\n                }\n\n                if (direction === DIR_X) {\n                    event.y = downEvent.y;\n                } else {\n                    event.x = downEvent.x;\n                }\n\n            } else {\n                if (eventQueue.length > 0) {\n                    for (let i = 0; i < eventQueue.length; i++) {\n                        p.onDraw(JSON.parse(JSON.stringify(eventQueue[i])));\n                    }\n                    eventQueue = [];\n                }\n            }\n\n        }\n\n        if (event.type === 'up') {\n            eventQueue = [];\n        }\n\n        p.onDraw(JSON.parse(JSON.stringify(event)));\n    };\n};\n\n\n/**\n * cleans up DrawEvents. More trustworthy events. EventChain element\n *\n * that events can only go line this: down -> n x move -> up\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\n * @constructor\n */\nexport const LineSanitizer = function () {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n\n    let isDrawing = false;\n\n    // --- interface ---\n    this.chainIn = function (event) {\n\n        if (event.type === 'down') {\n            if (isDrawing) {\n                //console.log('line sanitizer - down, but already drawing');\n                chainOut({\n                    type: 'up',\n                    scale: event.scale,\n                    shiftIsPressed: event.shiftIsPressed,\n                    isCoalesced: false\n                });\n            } else {\n                isDrawing = true;\n            }\n        }\n        if (!isDrawing && (event.type === 'move' || event.type === 'up')) {\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\n            return null;\n        }\n\n        if (event.type === 'up' && isDrawing) {\n            isDrawing = false;\n        }\n\n        return event;\n    };\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n    this.getIsDrawing = function () {\n        return isDrawing;\n    };\n};\n\n\n/**\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\n * for onDraw events from KlCanvasWorkspace.\n *\n * p = {\n *     smoothing: number, // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\n * }\n *\n * smoothing > 0: will fire DrawEvents in interval when no new move events\n *\n * type: 'line' Events are just passed through.\n *\n * @param p\n * @constructor\n */\nexport const LineSmoothing = function (p) {\n\n    let chainOut: ChainOutFunc = function () {\n    };\n    let smoothing = clamp(p.smoothing, 0, 1);\n    let lastMixedInput;\n    let interval;\n    let timeout;\n\n    // --- interface ---\n\n    this.chainIn = function (event) {\n        event = JSON.parse(JSON.stringify(event));\n        clearTimeout(timeout);\n        clearInterval(interval);\n\n        if (event.type === 'down') {\n            lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure\n            };\n        }\n\n        if (event.type === 'move') {\n\n            const inputX = event.x;\n            const inputY = event.y;\n            const inputPressure = event.pressure;\n\n            event.x = mix(event.x, lastMixedInput.x, smoothing);\n            event.y = mix(event.y, lastMixedInput.y, smoothing);\n            event.pressure = mix(event.pressure, lastMixedInput.pressure, smoothing);\n            lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure\n            };\n\n            if (smoothing > 0) {\n                timeout = setTimeout(function () {\n                    interval = setInterval(function () {\n                        event = JSON.parse(JSON.stringify(event));\n\n                        event.x = mix(inputX, lastMixedInput.x, smoothing);\n                        event.y = mix(inputY, lastMixedInput.y, smoothing);\n                        event.pressure = mix(inputPressure, lastMixedInput.pressure, smoothing);\n                        lastMixedInput = {\n                            x: event.x,\n                            y: event.y,\n                            pressure: event.pressure\n                        };\n\n                        chainOut(event);\n                    }, 35);\n                }, 80);\n            }\n\n        }\n\n        return event;\n    };\n\n    this.setChainOut = function (func) {\n        chainOut = func;\n    };\n\n    this.setSmoothing = function (s) {\n        smoothing = clamp(s, 0, 1);\n    };\n};\n","import {IKeyString} from '../BB.types';\nimport {createCanvas} from './create-canvas';\n\nexport function copyCanvas(canvas: HTMLCanvasElement): HTMLCanvasElement {\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\n    const ctx = resultCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\n\n/**\n * Determine if should disable imageSmoothing for transformation.\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\n */\nexport function testShouldPixelate(\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\n    scaleX: number,\n    scaleY: number,\n): boolean {\n    if (\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\n        Math.abs(transform.angleDeg) % 90 !== 0\n    ) {\n        return false;\n    }\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    const width = whSwapped ? transform.height : transform.width;\n    const height = whSwapped ? transform.width : transform.height;\n    return (\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\n        ) &&\n        (\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\n        );\n}\n\n\n/**\n * @param destCtx - the canvas that will be drawn on\n * @param transformImage - image that will be drawn on canvas\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\n * @param pixelated\n */\nexport function drawTransformedImageWithBounds(\n    destCtx: CanvasRenderingContext2D,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transform: {x: number, y: number, width:number, height: number, angleDeg: number},\n    bounds?: {x: number, y: number, width: number, height: number},\n    pixelated?: boolean,\n): void {\n    if (!bounds) {\n        bounds = {\n            x: 0,\n            y: 0,\n            width: transformImage.width,\n            height: transformImage.height\n        };\n    }\n\n    destCtx.save();\n    if (pixelated) {\n        destCtx.imageSmoothingEnabled = false;\n    } else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = 'high';\n    }\n\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(\n        transformImage,\n        bounds.x, bounds.y, bounds.width, bounds.height,\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\n\n    destCtx.restore();\n}\n\n/**\n * all transformations are optional\n * center is the point around which will be scaled and rotated\n *\n * @param baseCanvas canvas - the canvas that will be drawn on\n * @param transformImage image|canvas - image that will be drawn on canvas\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\n */\nexport function drawTransformedImageOnCanvas(\n    baseCanvas: HTMLCanvasElement,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transformObj: {\n        center: {x: number, y: number},\n        scale: {x: number, y: number},\n        translate: {x: number, y: number},\n        angleDegree: number,\n    },\n): void {\n    transformObj = JSON.parse(JSON.stringify(transformObj));\n    if (!transformObj.center) {\n        transformObj.center = {\n            x: transformImage.width / 2,\n            y: transformImage.height / 2\n        }\n    }\n    if (!transformObj.scale) {\n        transformObj.scale = {\n            x: 1,\n            y: 1\n        };\n    }\n    if (!transformObj.angleDegree) {\n        transformObj.angleDegree = 0;\n    }\n    if (!transformObj.translate) {\n        transformObj.translate = {\n            x: 0,\n            y: 0\n        };\n    }\n\n    const ctx = baseCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.save();\n    if (\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\n    ) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n    } else {\n        ctx.imageSmoothingEnabled = false;\n    }\n\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n\n    ctx.restore();\n}\n\nexport const createCheckerCanvas = function(size: number): HTMLCanvasElement {\n    const canvas = createCanvas();\n    let ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(128, 128, 128)';\n        ctx.fillRect(0, 0, 1, 1);\n    } else if (size > 200) {\n        canvas.width = 401;\n        canvas.height = 401;\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(255, 255, 255)';\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = 'rgb(200, 200, 200)';\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\n\nexport const createCheckerDataUrl = (function () {\n    const cache: IKeyString = { // previously created dataUrls\n        '8': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\n        '4': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC'\n    };\n\n    return function (size: number, callback?: (s: string) => void) {\n        function create(size: number): string {\n            size = parseInt('' + size);\n            if (cache['' + size]) {\n                return cache['' + size];\n            }\n            const canvas = createCheckerCanvas(size);\n            const result = canvas.toDataURL('image/png');\n            cache['' + size] = result;\n            return result;\n        }\n\n        if (callback) { //async\n            setTimeout(function () {\n                callback(create(size));\n            }, 1);\n        } else { //sync\n            return create(size);\n        }\n    };\n})();\n\n/**\n * smooth resize image\n * @param canvas canvas - will be resized (modified)\n * @param w\n * @param h\n * @param tmp1 canvas - optional, provide to save resources\n * @param tmp2 canvas - optional, provide to save resources\n */\nexport function resizeCanvas(\n    canvas: HTMLCanvasElement,\n    w: number,\n    h: number,\n    tmp1?: HTMLCanvasElement,\n    tmp2?: HTMLCanvasElement,\n): void {\n\n    //determine base 2 exponents of old and new size\n    function getBase2Obj(oldW: number, oldH: number, newW: number, newH: number) {\n        const result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH))\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    }\n\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\n        return;\n    }\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\n\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext('2d')!.save();\n        tmp2.getContext('2d')!.save();\n\n        let ew, eh;\n        let buffer1 = tmp1, buffer2 = tmp2;\n\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n\n        let bufferCtx = buffer2.getContext('2d')!;\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality  = 'high';\n        bufferCtx.globalCompositeOperation  = 'copy';\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n\n        let currentWidth = buffer2.width;\n        let currentHeight = buffer2.height;\n\n        //stepwise half the size\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\n            bufferCtx = buffer1.getContext('2d')!;\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality  = 'high';\n            bufferCtx.globalCompositeOperation  = 'copy';\n\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\n\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n\n            bufferCtx.drawImage(\n                buffer2,\n                0, 0,\n                currentWidth, currentHeight,\n                0, 0,\n                newWidth, newHeight\n            );\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n\n            //swap\n            const tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        const canvasCtx = canvas.getContext('2d')!;\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality  = 'high';\n        canvasCtx.drawImage(\n            buffer2,\n            0, 0,\n            currentWidth, currentHeight,\n            0, 0,\n            w, h\n        );\n        canvasCtx.restore();\n        tmp1.getContext('2d')!.restore();\n        tmp2.getContext('2d')!.restore();\n\n    } else if (w >= canvas.width && h >= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        const tmp1Ctx = tmp1.getContext('2d')!;\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality  = 'high';\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\n\n    } else {\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\n    }\n}\n\n/**\n * puts naive greyscale version of image into alpha channel.\n * only writes a, doesn't write rgb\n * @param canvas\n */\nexport function convertToAlphaChannelCanvas(canvas: HTMLCanvasElement): void {\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\n    for (let i = 0; i < imdat.data.length; i += 4) {\n        if (imdat.data[i + 3] === 0) {\n            continue;\n        }\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\n}\n\n/**\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\n * or there is a hard to fix memory leak.\n * This function manually makes the canvas use as little memory as possible.\n */\nexport function freeCanvas(canvas: HTMLCanvasElement): void {\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext('2d');\n    ctx && ctx.clearRect(0, 0, 1, 1);\n}","export const Matrix = (function () {\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n    // yes not optimized - but it's not used for physics simulations.\n\n    // const perfTotal = 0;\n\n    // point  matrix\n    function multiplyMatrixAndPoint(matrix, point) {\n        const result = [\n            (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\n            (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\n            (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\n            (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]) // w\n        ];\n        return result;\n    }\n\n    //matrixB  matrixA\n    function multiplyMatrices(matrixA, matrixB) {\n\n        // Slice the second matrix up into rows\n        const row0 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\n        const row1 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\n        const row2 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\n        const row3 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\n\n        // Multiply each row by matrixA\n        const result0 = multiplyMatrixAndPoint(matrixA, row0);\n        const result1 = multiplyMatrixAndPoint(matrixA, row1);\n        const result2 = multiplyMatrixAndPoint(matrixA, row2);\n        const result3 = multiplyMatrixAndPoint(matrixA, row3);\n\n        // Turn the result rows back into a single matrix\n        return [\n            result0[0], result0[1], result0[2], result0[3],\n            result1[0], result1[1], result1[2], result1[3],\n            result2[0], result2[1], result2[2], result2[3],\n            result3[0], result3[1], result3[2], result3[3]\n        ];\n    }\n\n    function createTranslationMatrix(x, y) {\n        return [\n            1, 0, 0, 0,\n            0, 1, 0, 0,\n            0, 0, 1, 0,\n            x, y, 0, 1\n        ];\n    }\n\n    function createRotationMatrix(angleRad) {\n        //let angleRad = angleDeg / 360 * 2 * Math.PI;\n        return [\n            Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\n            Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\n            0, 0, 1, 0,\n            0, 0, 0, 1\n        ];\n    }\n\n    function createScaleMatrix(f) {\n        return [\n            f, 0, 0, 0,\n            0, f, 0, 0,\n            0, 0, 1, 0,\n            0, 0, 0, 1\n        ];\n    }\n\n    return {\n        getIdentity: function () {\n            return [\n                1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            ];\n        },\n        multiplyMatrixAndPoint: multiplyMatrixAndPoint,\n        multiplyMatrices: multiplyMatrices,\n        createTranslationMatrix: createTranslationMatrix,\n        createRotationMatrix: createRotationMatrix,\n        createScaleMatrix: createScaleMatrix\n    };\n})();","import {IVector2D} from '../BB.types';\n\nexport const Vec2 = {\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\n    },\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\n    },\n    nor: function (p: IVector2D): IVector2D {\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return {x: p.x / len, y: p.y / len};\n    },\n    len: function (p: IVector2D): number {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function (p1: IVector2D, p2: IVector2D): number {\n        return Vec2.len(Vec2.sub(p1, p2));\n    },\n    mul: function (p: IVector2D, s: number): IVector2D {\n        return {x: p.x * s, y: p.y * s};\n    },\n    angle: function (p1: IVector2D, p2: IVector2D): number {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function(a: IVector2D, b: IVector2D): number {\n        const aArr = [a.x, a.y];\n        const bArr = [b.x, b.y];\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\n    }\n};","import {Vec2} from './vec2';\nimport {pointsToAngleDeg, clamp, dist, mix} from './math';\nimport {IVector2D} from \"../bb.types\";\n\n/**\n * project p onto line\n * @param lineStart\n * @param lineEnd\n * @param p\n */\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\n    let x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n\n        return {\n            x: x,\n            y: y\n        };\n    }\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    const b = lineStart.y - (m * lineStart.x);\n\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n\n    return {\n        x: x,\n        y: y\n    };\n};\n\n\n\n/**\n * Operations on a line made up of points\n *\n * getAtDist(dist) - point when traveling *dist* along the line\n * getLength - gives you total length of line\n *\n * @param params object - {points: [{x:float, y:float}, ...]}\n * @constructor\n */\nexport const PointLine = function (params) {\n    const segmentArr = [];\n    const _this = this;\n\n    for (let i = 0; i < params.points.length; i++) {\n        (function (i) {\n            let length = undefined;\n            if (i < params.points.length - 1) {\n                length = dist(params.points[i].x, params.points[i].y, params.points[i + 1].x, params.points[i + 1].y);\n            }\n            segmentArr[i] = {\n                x: params.points[i].x,\n                y: params.points[i].y,\n                length: length\n            };\n        })(i);\n    }\n\n    /**\n     * @param dist number - distance in pixels, > 0\n     * @returns {{x: number, y: number}}\n     */\n    this.getAtDist = function (dist) {\n        let remainder = Math.min(_this.getLength(), dist);\n        let i = 0;\n\n        for (; remainder > segmentArr[i].length && i < segmentArr.length - 2; i++) {\n            remainder -= segmentArr[i].length;\n        }\n\n        const fac = Math.min(1, Math.max(0, remainder / segmentArr[i].length));\n\n        return {\n            x: (segmentArr[i].x * (1 - fac) + segmentArr[i + 1].x * fac),\n            y: (segmentArr[i].y * (1 - fac) + segmentArr[i + 1].y * fac)\n        };\n    };\n    this.getLength = function () {\n        let result = 0;\n        for (let i = 0; i < segmentArr.length - 1; i++) {\n            result += segmentArr[i].length;\n        }\n        return result;\n    };\n};\n\n/**\n * Each instance is one line made up of bezier interpolated segments.\n * You feed it points. It calculates control points on its own, and the resulting curve.\n *\n * @constructor\n */\nexport const BezierLine = function () {\n    const _this = this;\n    const pointArr = [];\n    let lastDot = 0;\n    let lastPoint;\n    let lastCallbackPoint;\n    let lastAngle;\n    let lastSpacing = null;\n\n    /**\n     * creates bezier curve from control points\n     *\n     * @param p1 - control point 1 {x: float, y: float}\n     * @param p2 - control point 2 {x: float, y: float}\n     * @param p3 - control point 3 {x: float, y: float}\n     * @param p4 - control point 4 {x: float, y: float}\n     * @param resolution - int\n     * @returns {Array} - bezier curve made up of points {x: float, y: float}\n     */\n    function getBezierPoints(p1, p2, p3, p4, resolution) {\n        const curvePoints = [];\n        let t, result;\n        for (let i = 0; i <= resolution; i++) {\n            t = i / resolution;\n            result = {};\n            result.x = Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x;\n            result.y = Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y;\n            curvePoints[curvePoints.length] = result;\n        }\n        return curvePoints;\n    }\n\n    /**\n     *\n     * add now point to line\n     * line will go until the previous point\n     *\n     * @param x - coord of new point\n     * @param y - coord of new point\n     * @param spacing - space between each step\n     * @param callback - calls for each step - x, y, t - t is 0-1 how far along\n     * @param controlsCallback - calls that callback with the bezier control points p1, p2, p3, p4 - each {x: float, y: float}\n     */\n    this.add = function (x, y, spacing, callback, controlsCallback) {\n        if (lastPoint && x === lastPoint.x && y === lastPoint.y) {\n            return;\n        }\n        lastPoint = {x: x, y: y};\n        pointArr[pointArr.length] = {\n            x: x,\n            y: y,\n            spacing: spacing\n        };\n\n        //calculate directions\n        if (pointArr.length === 1) {\n            lastSpacing = spacing;\n            return;\n        } else if (pointArr.length === 2) {\n            pointArr[0].dir = Vec2.nor(Vec2.sub(pointArr[1], pointArr[0]));\n            lastDot = spacing;\n            lastSpacing = spacing;\n            return;\n        } else {\n            const pointM1 = pointArr[pointArr.length - 1];\n            const pointM2 = pointArr[pointArr.length - 2];\n            const pointM3 = pointArr[pointArr.length - 3];\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\n                //when xy -3 == -1\n                pointM2.dir = JSON.parse(JSON.stringify(pointM3.dir));\n            }\n        }\n\n        //get bezier curve\n        const a = pointArr[pointArr.length - 3];\n        const b = pointArr[pointArr.length - 2];\n        const p1 = a;\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\n        const p4 = b;\n\n\n        let pointLine;\n        if (callback) {\n            let curvePoints;\n            curvePoints = getBezierPoints(p1, p2, p3, p4, 20);\n            pointLine = new PointLine({points: curvePoints});\n        } else {\n            pointLine = new PointLine({points: [p1, p4]});\n        }\n\n        //interate over curve with spacing and callback\n        const len = pointLine.getLength();\n        let tempSpacing = mix(lastSpacing, spacing, clamp(lastDot / len, 0, 1));\n        let d = lastDot;\n        for (; d <= len; d += tempSpacing) {\n            tempSpacing = mix(lastSpacing, spacing, clamp(d / len, 0, 1));\n            const point = pointLine.getAtDist(d);\n            const angle = lastCallbackPoint ? pointsToAngleDeg(lastCallbackPoint, point) : undefined;\n            if (callback) {\n                callback({\n                    x: point.x,\n                    y: point.y,\n                    t: d / len,\n                    angle: angle,\n                    dAngle: lastCallbackPoint ? angle - lastAngle : 0\n                });\n            }\n            lastCallbackPoint = point;\n            lastAngle = angle;\n        }\n\n        if (callback) {\n            lastDot = d - len;\n        } else {\n            lastDot = 0;\n            controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\n        }\n\n        lastSpacing = spacing;\n    };\n\n    this.addFinal = function(spacing, callback, controlsCallback) {\n        if (pointArr.length < 2) {\n            return;\n        }\n\n        const p1 = pointArr[pointArr.length - 2];\n        const p2 = pointArr[pointArr.length - 1];\n\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\n\n        _this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n    };\n\n};\n\n/**\n * from glfx.script by evanW:\n * from SplineInterpolator.cs in the Paint.NET source code\n *\n * points go 0 - 1. I think.\n *\n * @param points\n * @constructor\n */\nexport const SplineInterpolator = function (points) {\n    const n = points.length;\n    this.xa = [];\n    this.ya = [];\n    this.u = [];\n    this.y2 = [];\n    let i;\n\n    const first = points[0][0];\n    const last = points[points.length - 1][0];\n\n    points.sort(function (a, b) {\n        return a[0] - b[0];\n    });\n    for (i = 0; i < n; i++) {\n        this.xa.push(points[i][0]);\n        this.ya.push(points[i][1]);\n    }\n\n    this.u[0] = 0;\n    this.y2[0] = 0;\n\n    for (i = 1; i < n - 1; ++i) {\n        // This is the decomposition loop of the tridiagonal algorithm.\n        // y2 and u are used for temporary storage of the decomposed factors.\n        const wx = this.xa[i + 1] - this.xa[i - 1];\n        const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n        const p = sig * this.y2[i - 1] + 2.0;\n\n        this.y2[i] = (sig - 1.0) / p;\n\n        const ddydx =\n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n    }\n\n    this.y2[n - 1] = 0;\n\n    // This is the backsubstitution loop of the tridiagonal algorithm\n    for (i = n - 2; i >= 0; --i) {\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n\n    this.getFirstX = function () {\n        return first;\n    };\n    this.getLastX = function () {\n        return last;\n    };\n};\n\nSplineInterpolator.prototype.interpolate = function (x) {\n    const n = this.ya.length;\n    let klo = 0;\n    let khi = n - 1;\n\n    // We will find the right place in the table by means of\n    // bisection. This is optimal if sequential calls to this\n    // routine are at random values of x. If sequential calls\n    // are in order, and closely spaced, one would do better\n    // to store previous values of klo and khi.\n    while (khi - klo > 1) {\n        const k = (khi + klo) >> 1;\n\n        if (this.xa[k] > x) {\n            khi = k;\n        } else {\n            klo = k;\n        }\n    }\n\n    const h = this.xa[khi] - this.xa[klo];\n    const a = (this.xa[khi] - x) / h;\n    const b = (x - this.xa[klo]) / h;\n\n    // Cubic spline polynomial is now evaluated.\n    return a * this.ya[klo] + b * this.ya[khi] +\n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n};\n\n/**\n * find x to y. simply by stepping through. suboptimal, so don't call often.\n * searches in x 0-1 range\n *\n * @param y\n * @param resolution\n */\nSplineInterpolator.prototype.findX = function (y, resolution) {\n    let x = null;\n    let dist = null;\n    for (let i = 0; i <= resolution; i++) {\n        const tempX = i / resolution;\n        const tempY = this.interpolate(tempX);\n        if (x === null) {\n            x = tempX;\n            dist = Math.abs(tempY - y);\n            continue;\n        }\n\n        const tempDist = Math.abs(tempY - y);\n\n        if (tempDist < dist) {\n            x = tempX;\n            dist = tempDist;\n        } else {\n            //distance increasing\n            break;\n        }\n    }\n    return x;\n};\n\n/**\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\n * returns [[0, startVal], ..., [1, endVal]]\n * @param startVal\n * @param endVal\n * @param stepSize\n * @returns {[]}\n */\nexport const quadraticSplineInput = function (startVal, endVal, stepSize) {\n    function round(v, dec) {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    }\n\n    const resultArr = [];\n    for (let i = 0; i <= 1; i += stepSize) {\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\n    }\n    return resultArr;\n};","\n\n\n// based on js color conversion http://www.webtoolkit.info/\n\n\nexport class HSV {\n    h: number;\n    s: number;\n    v: number;\n    constructor(h: number, s: number, v: number) {\n        this.h = Math.max(0, Math.min(360, h));\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n        this.v = Math.max(0, Math.min(100, v));\n    }\n}\n\nexport class RGB {\n    r : number;\n    g: number;\n    b: number;\n    constructor(r: number, g: number, b: number) {\n        this.r = Math.max(0, Math.min(255, r));\n        this.g = Math.max(0, Math.min(255, g));\n        this.b = Math.max(0, Math.min(255, b));\n    }\n}\n\nexport class CMYK {\n    c: number;\n    m: number;\n    y: number;\n    k: number;\n    constructor(c: number, m: number, y: number, k: number) {\n        this.c = Math.max(0, Math.min(100, c));\n        this.m = Math.max(0, Math.min(100, m));\n        this.y = Math.max(0, Math.min(100, y));\n        this.k = Math.max(0, Math.min(100, k));\n    }\n}\n\nexport const ColorConverter = {\n\n    _RGBtoHSV: function (RGB: RGB): HSV {\n        const result = new HSV(0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        const minVal = Math.min(r, g, b);\n        const maxVal = Math.max(r, g, b);\n        const delta = maxVal - minVal;\n\n        result.v = maxVal;\n\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\n\n            if (r == maxVal) {\n                result.h = del_B - del_G;\n            } else if (g == maxVal) {\n                result.h = (1 / 3) + del_R - del_B;\n            } else if (b == maxVal) {\n                result.h = (2 / 3) + del_G - del_R;\n            }\n\n            if (result.h < 0) {\n                result.h += 1;\n            }\n            if (result.h > 1) {\n                result.h -= 1;\n            }\n        }\n\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n\n        return result;\n    },\n\n    _HSVtoRGB: function (HSV: HSV): RGB {\n        const result = new RGB(0, 0, 0);\n\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n\n        const h = (HSV.h / 360) % 1;\n        const s = HSV.s / 100;\n        const v = HSV.v / 100;\n\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2\n            }\n\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n\n        return result;\n    },\n\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\n        const result = new RGB(0, 0, 0);\n\n        const c = CMYK.c / 100;\n        const m = CMYK.m / 100;\n        const y = CMYK.y / 100;\n        const k = CMYK.k / 100;\n\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n\n        return result;\n    },\n\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\n        const result = new CMYK(0, 0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n\n        return result;\n    },\n\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\n        if (o instanceof RGB) {\n            return o;\n        }\n        if (o instanceof HSV) {\n            return this._HSVtoRGB(o);\n        }\n        if (o instanceof CMYK) {\n            return this._CMYKtoRGB(o);\n        }\n    },\n\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\n        if (o instanceof HSV) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoHSV(o);\n        }\n        if (o instanceof CMYK) {\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\n        }\n    },\n\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\n        if (o instanceof CMYK) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoCMYK(o);\n        }\n        if (o instanceof HSV) {\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\n        }\n    },\n    toHexString: function (o: RGB): string {\n        if (o instanceof RGB) {\n            let ha = (parseInt('' + o.r)).toString(16);\n            let hb = (parseInt('' + o.g)).toString(16);\n            let hc = (parseInt('' + o.b)).toString(16);\n            if (ha.length == 1)\n                ha = '0' + ha;\n            if (hb.length == 1)\n                hb = '0' + hb;\n            if (hc.length == 1)\n                hc = '0' + hc;\n            return ha + hb + hc;\n        }\n    },\n    toRgbStr: function(rgbObj: {r: number, g: number, b: number}): string {\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\n    },\n    toRgbaStr: function(rgbaObj: {r: number, g: number, b: number, a: number}): string {\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\n    },\n    hexToRGB: function(hexStr: string): RGB | null {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result ? new RGB(\n            parseInt(result[1], 16),\n            parseInt(result[2], 16),\n            parseInt(result[3], 16)\n        ) : null;\n    }\n\n};\n\nexport function testIsWhiteBestContrast(rgbObj: {r: number, g: number, b: number}): boolean {\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\n}","import {addEventListener} from '../input/event-listener';\nimport {css} from './base';\nimport {BB} from '../bb';\n\n\nexport function appendTextDiv(target: HTMLElement, text: string): HTMLDivElement {\n    const div = document.createElement('div');\n    div.innerHTML = text;\n    target.appendChild(div);\n    return div;\n}\n\n/**\n * Is an input element focused.\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\n *\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\n */\nexport function isInputFocused(getAll: boolean = false): boolean {\n    let result = document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName);\n    if (getAll) {\n        return result;\n    } else {\n        return result && !document.activeElement.getAttribute('data-ignore-focus');\n    }\n}\n\n/**\n * clears text selection in window\n */\nexport function clearSelection(): void {\n    if (window.getSelection) {\n        const sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) {\n                sel.empty();\n            } else if (sel.removeAllRanges) {\n                sel.removeAllRanges();\n            }\n        }\n    } else if ('selection' in document) {\n        (document as any).selection.empty();\n    }\n}\n\n/**\n * prevents being able to focus element.\n * warning: it creates a listener\n *\n * @param el - dom element\n */\nexport const makeUnfocusable = (function() {\n\n    function preventFocus(event: MouseEvent) {\n        event.preventDefault();\n        let didFocusRelated = false;\n        if (event.relatedTarget) {\n            try {\n                (event.relatedTarget as HTMLElement).focus();\n                didFocusRelated = true;\n            } catch(e) {\n                console.error('failed to focus');\n            }\n        }\n        if (!didFocusRelated) {\n            (event.currentTarget as HTMLElement).blur();\n        }\n    }\n\n    return function(el) {\n        el.setAttribute('tabindex', '-1');\n        addEventListener(el, 'focus', preventFocus);\n    };\n})();\n\n\nconst els: {\n    el: HTMLElement;\n    listeners: [string, any][];\n}[] = [];\n// window['els'] = els;\n\n/**\n *\n * Create DOM element - div by default\n * params = {\n * \t    parent: someOtherDiv,\n * \t    css: {\n * \t\t    width: \"500px\",\n * \t\t    backgroundColor: \"#fff\"\n * \t    },\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\n * \t    className: \"bla\",\n *      id: \"bla\"\n * }\n *\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\n *  to prevent a memory leak.\n *\n * @param params\n */\nexport function el(\n    params: {\n        parent?: HTMLElement,\n        css?: { [key: string]: string },\n        custom?: { [key: string]: any },\n        content?: string | (HTMLElement | string | null)[] | HTMLElement | SVGElement,\n        textContent?: string,\n        className?: string,\n        title?: string,\n        id?: string,\n        tagName?: string,\n        onClick?: (e: Event) => void,\n        onChange?: (e: Event) => void,\n    }\n): HTMLElement {\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\n    if (params.css) {\n        css(div, params.css);\n    }\n\n    if (params.content) {\n        if (typeof params.content === typeof 'aa') {\n            div.innerHTML = params.content as string;\n\n        } else if (Array.isArray(params.content)) {\n            BB.append(div, params.content);\n\n        } else {\n            div.appendChild(params.content as HTMLElement);\n\n        }\n    }\n    if (params.textContent) {\n        div.textContent = params.textContent;\n    }\n    if (params.className) {\n        div.className = params.className;\n    }\n    if (params.id) {\n        div.id = params.id;\n    }\n    if (params.parent) {\n        params.parent.appendChild(div);\n    }\n    if ('title' in params && params.title !== undefined) {\n        div.title = params.title;\n    }\n    const listeners = [];\n    if ('onClick' in params) {\n        addEventListener(div, 'click', params.onClick);\n        listeners.push(['click', params.onClick]);\n    }\n    if ('onChange' in params) {\n        addEventListener(div, 'change', params.onChange);\n        listeners.push(['change', params.onChange]);\n    }\n    if (listeners.length > 0) {\n        els.push({\n            el: div,\n            listeners: listeners,\n        })\n        /*div.style.backgroundColor = '#ff0';\n        div.style.border = '1px solid #ff0';*/\n    }\n    if ('custom' in params) {\n        const customKeyArr = Object.keys(params.custom);\n        for (let i = 0; i < customKeyArr.length; i++) {\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n        }\n    }\n    return div;\n}\n\n/**\n * removes event listeners for Elements created via el()\n * @param el\n */\nexport function destroyEl(el: HTMLElement) {\n    for (let i = 0; i < els.length; i++) {\n        const item = els[i];\n        if (item.el === el) {\n            item.listeners.forEach(item => {\n                el.removeEventListener(item[0], item[1]);\n            });\n            els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n","\nexport class BbLog {\n\n    private static listeners: any[] = [];\n\n    constructor() {\n    }\n\n    static subscribe(listener) {\n        if (BbLog.listeners.includes(listener)) {\n            return;\n        }\n        BbLog.listeners.push(listener);\n    }\n\n    static unsubscribe(listener) {\n        for (let i = 0; i < BbLog.listeners.length; i++) {\n            if (listener === BbLog.listeners[i]) {\n                BbLog.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    static emit (msg) {\n        BbLog.listeners.forEach(item => {\n            item(msg);\n        });\n    }\n}","/**\n * LocalStorage wrapper that does not throw exceptions.\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\n */\nexport class LocalStorage {\n\n    private static error;\n\n    static getItem (key: string): string {\n        let result = null;\n        try {\n            result = localStorage.getItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n        return result;\n    }\n\n    static setItem (key: string, value: string): void {\n        try {\n            localStorage.setItem(key, value);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static removeItem (key: string): void {\n        try {\n            localStorage.removeItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static getError (): any {\n        return this.error;\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5xzTI\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"b07cq\");","import {BB} from '../../../bb/bb';\n\n/**\n * Checkbox - with label\n */\nexport class Checkbox {\n\n    private element: HTMLElement;\n    private check: HTMLInputElement;\n\n    // --- public ---\n\n    constructor (params: {\n        init?: boolean; // default false\n        label: string;\n        callback: (boolean) => void;\n        allowTab?: boolean; // default false\n        title?: string;\n        doHighlight?: boolean; // default false\n        css?: any;\n    }) {\n        this.element = BB.el({\n            className: 'kl-checkbox'\n        });\n\n        const innerEl = BB.el({\n            parent: this.element,\n            tagName: 'label',\n            className: 'kl-checkbox__inner'\n        });\n\n        this.check = BB.el({\n            parent: innerEl,\n            tagName: 'input',\n            css: {\n                marginLeft: '0',\n                display: 'inline-block'\n            },\n            custom: {\n                type: 'checkbox'\n            }\n        }) as HTMLInputElement;\n        this.check.checked = params.init;\n        if (params.doHighlight && this.check.checked) {\n            BB.addClassName(this.element, 'kl-checkbox--highlight');\n        }\n        if (!params.allowTab) {\n            this.check.tabIndex = -1;\n        }\n\n        if (params.title) {\n            innerEl.title = params.title;\n        }\n\n        const label = document.createElement('div');\n        label.style.display = 'inline-block';\n        label.innerHTML = params.label;\n        (label as any).allowClick = true;\n        innerEl.appendChild(label);\n\n        this.check.onchange = () => {\n            if (params.doHighlight) {\n                if (this.check.checked) {\n                    BB.addClassName(this.element, 'kl-checkbox--highlight');\n                } else {\n                    BB.removeClassName(this.element, 'kl-checkbox--highlight');\n                }\n            }\n            params.callback(this.check.checked);\n            setTimeout(() => {\n                this.check.blur();\n            }, 0);\n        };\n        if (params.css) {\n            BB.css(this.element, params.css);\n        }\n    }\n\n    getValue(): boolean {\n        return this.check.checked;\n    }\n\n    getElement(): HTMLElement {\n        return this.element;\n    }\n\n    destroy() {\n        this.check.onchange = null;\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb.types';\n\nexport const input = function (params: {\n    type?: 'button' | 'checkbox' | 'number' | 'text'; // default text\n    min?: number;\n    max?: number;\n    callback: (val: string) => void;\n    init: string | number;\n    css?: IKeyString;\n}) {\n    const result = document.createElement('input');\n    if (params.type) {\n        try {\n            result.type = params.type;\n        } catch(e) {} // ie can't deal with number\n    } else {\n        result.type = 'text';\n    }\n    if (params.min !== undefined) {\n        result.min = '' + params.min;\n    }\n    if (params.max !== undefined) {\n        result.max = '' + params.max;\n    }\n    result.value = '' + params.init;\n    if (params.callback) {\n        result.onchange = function() {\n            params.callback(result.value);\n        };\n    }\n    if (params.css) {\n        BB.css(result, params.css);\n    }\n\n    return result;\n};","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb.types';\n\n/**\n * A select dropdown\n */\nexport class Select {\n\n    private selectEl: HTMLSelectElement;\n    private optionArr: ([string, string] | null)[]; // [value, label]\n    private changeListener: (event) => void;\n    private onChange: (val: string) => void;\n\n    \n    // --- public ---\n    constructor (p: {\n        isFocusable?: boolean; // default false\n        optionArr: ([string, string] | null)[], // [value, label]\n        initValue?: string; // default null\n        onChange: (val: string) => void;\n        css?: IKeyString;\n        title?: string;\n    }) {\n        this.selectEl = BB.el({\n            tagName: 'select',\n            title: p.title,\n            css: {\n                cursor: 'pointer',\n                fontSize: '15px',\n                padding: '3px',\n                background: '#fff', // makes safari pay attention to font-size\n                //webkitAppearance: 'none'\n                colorScheme: 'only light', // chrome doesn't properly invert the text color\n            }\n        }) as HTMLSelectElement;\n        if (p.css) {\n            BB.css(this.selectEl, p.css);\n        }\n\n        const isFocusable = p.isFocusable;\n        if (!isFocusable) {\n            this.selectEl.tabIndex = -1;\n        }\n        this.optionArr = p.optionArr;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if (this.optionArr[i] === null) {\n                continue;\n            }\n            const option = document.createElement('option');\n            option.value = this.optionArr[i][0];\n            option.textContent = this.optionArr[i][1];\n            this.selectEl.append(option);\n        }\n        this.onChange = p.onChange;\n        this.changeListener = (e) => {\n            if (!isFocusable) {\n                this.selectEl.blur();\n            }\n            this.onChange(this.selectEl.value);\n        };\n        this.selectEl.addEventListener('change', this.changeListener);\n        this.selectEl.value = 'initValue' in p ? p.initValue : null;\n    }\n\n    setValue (val) {\n        this.selectEl.value = val;\n    }\n\n    getValue () {\n        return this.selectEl.value;\n    }\n\n    setDeltaValue (delta) {\n        let index = 0;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if ('' + this.optionArr[i][0] === this.selectEl.value) {\n                index = i;\n                break;\n            }\n        }\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\n        this.selectEl.value = this.optionArr[index][0];\n        this.onChange(this.selectEl.value);\n    }\n\n    getElement () {\n        return this.selectEl;\n    }\n\n    destroy = () => {\n        this.selectEl.removeEventListener('change', this.changeListener);\n    }\n    \n}\n","import {BB} from '../../../bb/bb';\n\n\n/**\n * Toggle button with an image\n *\n * p = {\n *     initValue: boolean,\n *     title: string,\n *     isRadio: boolean, // if true, can't click when active\n *     onChange: function(boolean)\n * }\n *\n * @param p\n * @constructor\n */\nexport const ImageToggle = function(p) {\n    let isActive = !!p.initValue;\n    const div = BB.el({\n        className: 'image-toggle',\n        title: p.title,\n        css: {\n            backgroundImage: \"url('\" + p.image + \"')\"\n        },\n        onClick: function(e) {\n            e.preventDefault();\n            if (p.isRadio && isActive) {\n                return;\n            }\n            isActive = !isActive;\n            update();\n            p.onChange(isActive);\n        },\n    });\n\n    function update() {\n        if (isActive) {\n            BB.addClassName(div, 'image-toggle-active');\n        } else {\n            BB.removeClassName(div, 'image-toggle-active');\n        }\n    }\n\n    update();\n\n    // --- interface ---\n    this.setValue = function(b) {\n        isActive = !!b;\n        update();\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return isActive;\n    };\n    this.destroy = () => {\n        BB.destroyEl(div);\n    };\n\n};","import {BB} from '../../../bb/bb';\nimport {ImageToggle} from './image-toggle';\n\n/**\n * Radio input group. each one has an image\n *\n * p = {\n *     optionArr: {\n *         id: string,\n *         title: string,\n *         image: string,\n *     }[],\n *     initId: string,\n *     sizePx: number,\n *     onChange: function(id: string): void\n * }\n *\n * @param p\n */\nexport const ImageRadioList = function(p) {\n\n    const div = BB.el({\n        className: 'image-radio-wrapper',\n        css: {\n            display: 'flex'\n        }\n    });\n\n    let activeIndex;\n    const optionArr = [];\n\n    function select(index, id) {\n        activeIndex = index;\n        for (let i = 0; i < optionArr.length; i++) {\n            optionArr[i].setValue(i === activeIndex);\n        }\n        p.onChange(id);\n    }\n\n    function createOption(index, o) {\n        if (o.id === p.initId) {\n            activeIndex = index;\n        }\n        const radioEl = new ImageToggle({\n            image: o.image,\n            title: o.title,\n            initValue: o.id === p.initId,\n            isRadio: true,\n            onChange: function() {\n                select(index, o.id);\n            }\n        });\n        div.appendChild(radioEl.getElement());\n\n        return radioEl;\n\n    }\n\n    for (let i = 0; i < p.optionArr.length; i++) {\n        optionArr.push(createOption(i, p.optionArr[i]));\n    }\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return p.optionArr[activeIndex].id;\n    };\n    this.destroy = () => {\n        optionArr.forEach(item => {\n            item.destroy();\n        })\n    };\n};","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport iconImg from 'url:~/src/app/img/ui/brush-pressure.svg';\nimport {LANG} from '../../../language/language';\n\n\n/**\n * small toggle button with a pen icon - representing toggling pressure sensitivity\n * @param isChecked - boolean - initial value\n * @param changeCallback - function(isChecked boolean) - called on change\n * @returns {HTMLElement} - the toggle button\n */\nexport const penPressureToggle = function(isChecked, changeCallback) {\n\n    const toggleDiv = BB.el({\n        css: {\n            cssFloat: 'right',\n            borderRadius: '3px',\n            width: '18px',\n            height: '18px',\n            backgroundImage: 'url(\"' + iconImg + '\")',\n            backgroundSize: 'contain',\n            backgroundRepeat: 'no-repeat',\n            cursor: 'pointer',\n            boxSizing: 'border-box',\n            colorScheme: 'only light',\n        }\n    });\n\n    if (!BB.hasPointerEvents) {\n        toggleDiv.style.display = 'none';\n    }\n\n    function redraw() {\n        if (isChecked) {\n            BB.css(toggleDiv, {\n                backgroundColor: '#fff',\n                opacity: '0.9',\n                border: '1px solid var(--active-highlight-color)'\n            });\n        } else {\n            BB.css(toggleDiv, {\n                backgroundColor: 'transparent',\n                opacity: '0.5',\n                border: '1px solid #666'\n            });\n        }\n    }\n\n    toggleDiv.title = LANG('brush-toggle-pressure');\n    toggleDiv.onclick = function() {\n        isChecked = !isChecked;\n        redraw();\n        changeCallback(isChecked);\n    };\n\n    redraw();\n    changeCallback(isChecked);\n\n    return toggleDiv;\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"ciaRT\");","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport {IKlSliderConfig} from '../../kl.types';\nimport {languageStrings} from '../../../language/language';\n\n\n\n/**\n * big slider, e.g. used for brush size\n *\n * p = {\n *      label: 'Size',\n *      width: 500,\n *      height: 20,\n *      theme: 'compact-light',\n *      min: 0,\n *      max: 100,\n *      initValue: 10,\n *      resolution: 600, // if you want spline.find to use a different resolution\n *      curve: 'quadratic' | [...], // optional. array is BB.SplineInterpolator points. 0-1\n *      formatFunc: function(value) { // optional\n *          return Math.round(value);\n *      },\n *      onChange: function(value) {},\n *      isChangeOnFinal: true,\n *      eventResMs: 123,\n *      isEnabled?: boolean, // default = true\n * }\n *\n * Values can be spline interpolated\n * On change callback can be debounced\n *\n * @param p - obj\n * @constructor\n */\nexport const KlSlider = function (p) {\n    const _this = this;\n    let isEnabled = p.isEnabled !== false;\n    let useSpline = !!p.curve;\n    let splineInterpolator;\n\n    if (!p.label || !p.onChange) {\n        throw 'PcSlider missing params';\n    }\n    if (p.min != 0 && p.max != 0 && p.initValue != 0) {\n        if (!p.min || !p.max || !p.initValue) {\n            throw 'PcSlider broken params';\n        }\n    }\n    if (p.min >= p.max) {\n        throw 'PcSlider broken params';\n    }\n\n    const elementWidth = p.width;\n    const elementHeight = p.height;\n    const resolution = p.resolution ? p.resolution : elementWidth;\n    let min = p.min;\n    let max = p.max;\n    const onChange = p.onChange;\n    const isChangeOnFinal = !!p.isChangeOnFinal;\n    const formatFunc = p.formatFunc;\n    const eventResMs = p.eventResMs;\n\n    if (useSpline) {\n        const curveArr = p.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : p.curve;\n        splineInterpolator = new BB.SplineInterpolator(curveArr);\n    }\n\n    function toLinearValue(value) {\n        if (useSpline) {\n            return splineInterpolator.findX(value, Math.floor(resolution * 1.5));\n        }\n        return (value - min) / (max - min);\n    }\n\n    function toValue(pLinearValue) {\n        let result = min + pLinearValue * (max - min);\n        if (useSpline) {\n            result = splineInterpolator.interpolate(pLinearValue);\n        }\n        return result;\n    }\n\n    const div = BB.el({\n        className: 'sliderWrapper',\n        css: {\n            overflow: 'hidden',\n            position: 'relative',\n            width: elementWidth + 'px',\n            height: elementHeight + 'px',\n            userSelect: 'none'\n        }\n    });\n    const labelCaption = p.label;\n    const label = document.createElement('div');\n    const control = document.createElement('div');\n    const controlInner = document.createElement('div');\n    let linearValue = toLinearValue(p.initValue); //0 - 1\n\n    div.appendChild(control);\n    div.appendChild(label);\n    control.appendChild(controlInner);\n    control.className = 'sliderInner';\n\n\n    div.oncontextmenu = function () {\n        return false;\n    };\n    //control.style.backgroundColor = \"#aaa\";\n    label.innerHTML = labelCaption;\n\n    control.style.position = 'absolute';\n    control.style.left = '0';\n    control.style.top = '0';\n    control.style.width = (linearValue * elementWidth) + 'px';\n    control.style.height = elementHeight + 'px';\n\n    const labelFontSize = elementHeight - 14;\n    BB.css(label, {\n        position: 'absolute',\n        left: '7px',\n        top: (elementHeight / 2 - labelFontSize / 2 + 1) + 'px',\n        lineHeight: labelFontSize + 'px',\n        fontSize: labelFontSize + 'px',\n        pointerEvents: 'none'\n    });\n\n    function updateEnable (): void {\n        if (isEnabled) {\n            BB.css(div, {\n                opacity: null,\n                pointerEvents: null,\n            });\n        } else {\n            BB.css(div, {\n                opacity: '0.5',\n                pointerEvents: 'none',\n            });\n        }\n    }\n    updateEnable();\n\n    function getOutsideVal() {\n        let result = min + linearValue * (max - min);\n        if (useSpline) {\n            result = splineInterpolator.interpolate(linearValue);\n        }\n        return result;\n    }\n\n    function updateLabel() {\n        let outVal = toValue(linearValue);\n        outVal = formatFunc ? formatFunc(outVal) : parseInt(outVal);\n        outVal = outVal.toLocaleString(languageStrings.getCode());\n        label.innerHTML = labelCaption + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + outVal + '</span>';\n        control.style.width = (linearValue * elementWidth) + 'px';\n    }\n\n    let lastCallbackTime = 0;\n    function emit(isFinal) {\n        if (!isFinal && isChangeOnFinal) {\n            return;\n        }\n        if (eventResMs && !isFinal) {\n            const now = performance.now();\n            if (now - lastCallbackTime >= eventResMs) {\n                lastCallbackTime = now;\n                onChange(getOutsideVal());\n            }\n        } else {\n            onChange(getOutsideVal());\n        }\n    }\n\n    let virtualVal;\n    function onPointer(event) {\n        event.eventPreventDefault();\n\n        if (!isEnabled) {\n            return;\n        }\n\n        if (event.type === 'pointerdown') {\n            div.className = 'sliderWrapper sliderWrapperActive';\n\n            if (event.button === 'left') {\n                linearValue = event.relX / elementWidth;\n                linearValue = Math.max(0, Math.min(1, linearValue));\n                updateLabel();\n                emit(false);\n            }\n            virtualVal = linearValue;\n        }\n\n        if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\n\n            let deltaX = event.dX;\n            const deltaY = Math.abs(event.pageY - event.downPageY);\n            const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n            deltaX *= factor;\n            deltaX /= elementWidth;\n\n            virtualVal += deltaX;\n            linearValue = Math.max(0, Math.min(1, virtualVal));\n\n            updateLabel();\n            emit(false);\n        }\n\n        if (event.type === 'pointerup') {\n            div.className = 'sliderWrapper';\n            emit(true);\n        }\n\n    }\n\n    let pointerListener;\n    const pointerListenerTimeout = setTimeout(() => {\n        pointerListener = new BB.PointerListener({\n            target: div,\n            maxPointers: 1,\n            fixScribble: true,\n            onPointer: onPointer,\n            onWheel: function(event) {\n                if (useSpline) {\n                    linearValue += -event.deltaY * (splineInterpolator.getLastX() - splineInterpolator.getFirstX()) / 40;\n                    linearValue = Math.max(splineInterpolator.getFirstX(), Math.min(splineInterpolator.getLastX(), linearValue));\n                } else {\n                    linearValue += -event.deltaY / 40;\n                    linearValue = Math.max(0, Math.min(1, linearValue));\n                }\n                updateLabel();\n                onChange(getOutsideVal());\n            }\n        });\n        updateLabel();\n    }, 1);\n\n\n    // --- interface ---\n    this.increaseValue = function (f) {\n        linearValue = Math.min(1, linearValue + Math.abs(f));\n        updateLabel();\n        onChange(getOutsideVal());\n    };\n    this.decreaseValue = function (f) {\n        linearValue = Math.max(0, linearValue - Math.abs(f));\n        updateLabel();\n        onChange(getOutsideVal());\n    };\n    this.setValue = function(v) {\n        linearValue = toLinearValue(v);\n        updateLabel();\n    };\n    this.getValue = function () {\n        return getOutsideVal();\n    };\n    this.update = function(config: IKlSliderConfig): void {\n        min = config.min;\n        max = config.max;\n        useSpline = !!config.curve;\n        if (useSpline) {\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(min, max, 0.1) : config.curve;\n            splineInterpolator = new BB.SplineInterpolator(curveArr);\n        } else {\n            splineInterpolator = null;\n        }\n        _this.setIsEnabled(!config.isDisabled);\n    };\n    this.setIsEnabled = function (e: boolean): void {\n        isEnabled = !!e;\n        updateEnable();\n    };\n\n    this.destroy = function() {\n        clearTimeout(pointerListenerTimeout);\n        if (pointerListener) {\n            pointerListener.destroy();\n        }\n    };\n\n    this.getElement = function() {\n        return div;\n    }\n\n};","\n\n/**\n * to make sliders more finegrained.\n * @param deltaY number - how far pointer moved away vertically since down\n * @returns {number} the factor 0-1. 0 -> infinite movement for change of 1. 1 -> 1px for change of 1\n */\nexport const calcSliderFalloffFactor = function(deltaY, isRightButton) {\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) {\n        result *= 2;\n    }\n    return 1 / result;\n};\n","import {BB} from '../../../bb/bb';\r\nimport {input} from '../base-components/input';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n// @ts-ignore\r\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n * @param p {color: rgbObj, onClose: function(rgbObj | null)}\r\n * @constructor\r\n */\r\nexport const HexColorDialog = function (p) {\r\n\r\n    let lastValidRgb = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n    const div = BB.el({});\r\n\r\n    const previewEl = BB.el({\r\n        css: {\r\n            width: '20px',\r\n            height: '20px',\r\n            marginBottom: '10px',\r\n            boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n            background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    div.appendChild(previewEl);\r\n\r\n\r\n    // --- Hex ---\r\n    const hexRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginBottom: '15px'\r\n        }\r\n    });\r\n    const hexLabel = BB.el({\r\n        content: LANG('mci-hex'),\r\n        css: {\r\n            width: '60px'\r\n        }\r\n    });\r\n    const hexInput = input({\r\n        init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n        css: {\r\n            width: '80px'\r\n        },\r\n        callback: function() {\r\n            let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n            if (rgbObj === null) {\r\n                rgbObj = lastValidRgb;\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            } else {\r\n                lastValidRgb = rgbObj;\r\n            }\r\n            previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n            for (let i = 0; i < rgbArr.length; i++) {\r\n                rgbArr[i].update();\r\n            }\r\n        }\r\n    });\r\n    const copyButton = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n        title: LANG('mci-copy'),\r\n        css: {\r\n            marginLeft: '10px'\r\n        },\r\n        onClick: function() {\r\n            hexInput.select();\r\n            document.execCommand('copy');\r\n        }\r\n    });\r\n    hexRowEl.appendChild(hexLabel);\r\n    hexRowEl.appendChild(hexInput);\r\n    hexRowEl.appendChild(copyButton);\r\n    div.appendChild(hexRowEl);\r\n    setTimeout(function () {\r\n        hexInput.focus();\r\n        hexInput.select();\r\n    }, 0);\r\n\r\n\r\n    // --- R G B ---\r\n    function createRgbInputRow(labelStr, attributeStr) {\r\n        const result: any = {};\r\n\r\n        const rowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n        const labelEl = BB.el({\r\n            content: labelStr,\r\n            css: {\r\n                width: '60px'\r\n            }\r\n        });\r\n\r\n        const inputEl = input({\r\n            init: lastValidRgb[attributeStr],\r\n            min: 0,\r\n            max: 255,\r\n            type: 'number',\r\n            css: {\r\n                width: '80px'\r\n            },\r\n            callback: function() {\r\n                if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                    result.update();\r\n                    return;\r\n                }\r\n                inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                lastValidRgb[attributeStr] = inputEl.value;\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n            }\r\n        });\r\n\r\n        rowEl.appendChild(labelEl);\r\n        rowEl.appendChild(inputEl);\r\n        div.appendChild(rowEl);\r\n\r\n\r\n        result.update = function() {\r\n            inputEl.value = lastValidRgb[attributeStr];\r\n        };\r\n        result.destroy = () => {\r\n            inputEl.onchange = null;\r\n        };\r\n        return result;\r\n    }\r\n    const rgbArr = [];\r\n    rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n    rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n    rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n    popup({\r\n        target: p.klRootEl,\r\n        message: `<b>${LANG('manual-color-input')}</b>`,\r\n        div: div,\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (resultStr) {\r\n            BB.destroyEl(copyButton);\r\n            rgbArr.forEach(item => item.destroy());\r\n            rgbArr.splice(0, rgbArr.length);\r\n\r\n            p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n        }\r\n    });\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"kmB01\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\n// @ts-ignore\r\nimport eyedropperImg from 'url:~/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n *\r\n * p = {\r\n *     width: number,\r\n *     height: number, // hue slider and output height\r\n *     svHeight: number,\r\n *     startValue: rgb, // 0-255\r\n *     onPick: function(rgb)\r\n * }\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport const KlColorSlider = function (p) {\r\n\r\n    const _this = this;\r\n    let pickCallback = function(result?) {};\r\n    const div = document.createElement('div');\r\n    div.style.position = 'relative';\r\n    div.className = 'colorSlider';\r\n    const outputDiv = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center'\r\n        }\r\n    });\r\n    const width = p.width;\r\n    let svHeight = p.svHeight;\r\n    const height = p.height;\r\n    const emitColor = p.onPick;\r\n\r\n    let primaryColorRGB = {\r\n        r: parseInt(p.startValue.r, 10),\r\n        g: parseInt(p.startValue.g, 10),\r\n        b: parseInt(p.startValue.b, 10)\r\n    };\r\n    let primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n    let secondaryColorRGB = {r: 255, g: 255, b: 255};\r\n    let secondaryColorHSV = BB.ColorConverter._RGBtoHSV(secondaryColorRGB); // BB.HSV\r\n\r\n    const svWrapper = BB.el({});\r\n    const svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"> <defs> <linearGradient id=\"value\" gradientTransform=\"rotate(90)\"> <stop offset=\"0\" stop-color=\"rgba(0,0,0,0)\"/> <stop offset=\"100%\" stop-color=\"rgba(0,0,0,1)\"/> </linearGradient> <linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"> <stop offset=\"0\" stop-color=\"#fff\"/> <stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/> </linearGradient> </defs> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/> <rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\"/></svg>', 'image/svg+xml').documentElement;\r\n    const hueStop = (svSvg as any).getElementById('hue-stop');\r\n    BB.setAttributes(hueStop, {\r\n        'stop-color': '#f0f'\r\n    });\r\n    BB.css(svSvg, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px'\r\n    });\r\n    svWrapper.appendChild(svSvg);\r\n\r\n    const divH = document.createElement('div');\r\n    BB.css(divH, {\r\n        position: 'relative',\r\n        height: height + 'px'\r\n    });\r\n    const divPreview = document.createElement('div');\r\n    const controlH = document.createElement('div');\r\n\r\n    const enabled = true;\r\n\r\n    function updatePrimaryHSV(hsv) {\r\n        if (hsv.s === 0) {\r\n            primaryColorHSV = new BB.HSV(primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    function createHueBg(targetEl) {\r\n        const im = new Image();\r\n        BB.css(im, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            display: 'none',\r\n            pointerEvents: 'none'\r\n        });\r\n        const cv = BB.canvas(width, height);\r\n        const ctx = cv.getContext('2d');\r\n        const gradH = ctx.createLinearGradient(0, 0, width, 0);\r\n        for (let i = 0; i < 1; i += 0.01) {\r\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n            let ha = (parseInt('' + col.r)).toString(16);\r\n            let hb = (parseInt('' + col.g)).toString(16);\r\n            let hc = (parseInt('' + col.b)).toString(16);\r\n            if (ha.length === 1)\r\n                ha = '0' + ha;\r\n            if (hb.length === 1)\r\n                hb = '0' + hb;\r\n            if (hc.length === 1)\r\n                hc = '0' + hc;\r\n            gradH.addColorStop(i, '#' + ha + hb + hc);\r\n        }\r\n        ctx.fillStyle = gradH;\r\n        ctx.fillRect(0, 0, width, height);\r\n\r\n        targetEl.appendChild(im);\r\n        im.alt = 'hue';\r\n        im.src = cv.toDataURL('image/png');\r\n        im.style.display = 'block';\r\n    }\r\n\r\n\r\n    function updateSVCanvas() {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb)\r\n        });\r\n    }\r\n\r\n    function updateSVPointer() {\r\n\r\n        const left = primaryColorHSV.s / 100 * width - 7;\r\n        const top = (1 - primaryColorHSV.v / 100) * svHeight - 6;\r\n        BB.css(pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px'\r\n        });\r\n    }\r\n\r\n    function setColPreview() {\r\n        divPreview.style.backgroundColor = 'rgb(' + primaryColorRGB.r + ',' + primaryColorRGB.g + ',' + primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(primaryColorRGB)) {\r\n            BB.css(pickerButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: 'invert(1)'\r\n            });\r\n        } else{\r\n            BB.css(pickerButton, {\r\n                filter: ''\r\n            });\r\n            BB.css(hexButton, {\r\n                filter: ''\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    updateSVCanvas();\r\n    div.style.width = width + 'px';\r\n    div.oncontextmenu = function () {\r\n        return false;\r\n    };\r\n\r\n    const SVContainer = document.createElement('div');\r\n    BB.css(SVContainer, {\r\n        width: width + 'px',\r\n        height: svHeight + 'px',\r\n        overflow: 'hidden',\r\n        display: 'block',\r\n        position: 'relative',\r\n        cursor: 'crosshair',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n    });\r\n\r\n    const pointerSV = document.createElement('div');\r\n    BB.css(pointerSV, {\r\n        width: '12px',\r\n        height: '12px',\r\n        borderRadius: '6px',\r\n        position: 'absolute',\r\n        pointerEvents: 'none',\r\n        boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff'\r\n    });\r\n\r\n    SVContainer.appendChild(svWrapper);\r\n    SVContainer.appendChild(pointerSV);\r\n    updateSVPointer();\r\n    div.appendChild(SVContainer);\r\n    div.appendChild(divH);\r\n    outputDiv.appendChild(divPreview);\r\n    BB.css(divPreview, {\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        width: (height * 2.5) + 'px',\r\n        height: height + 'px',\r\n        //position: \"relative\",\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        colorScheme: 'only light',\r\n    });\r\n\r\n    BB.css(divH, {\r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        width: width + 'px',\r\n        height: height + 'px',\r\n        cursor: 'ew-resize',\r\n        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px',\r\n        marginTop: '1px',\r\n        marginBottom: '1px'\r\n    });\r\n\r\n    //divH.className = \"svSlider\";\r\n    BB.css(controlH, {\r\n        width: '1px',\r\n        height: height + 'px',\r\n        background: '#000',\r\n        borderLeft: '1px solid #fff',\r\n        position: 'absolute',\r\n        top: '0',\r\n        left: parseInt('' + (primaryColorHSV.h / 360 * width - 1)) + 'px'\r\n    });\r\n\r\n\r\n    const virtualHSV = {\r\n        h: 0,\r\n        s: 0,\r\n        v: 0\r\n    };\r\n    let svPointerListener;\r\n    let hPointerListener;\r\n\r\n\r\n    const pickerButton = BB.el({\r\n        title: LANG('eyedropper') + ' [Alt]',\r\n        className: 'color-picker-preview-button',\r\n        css: {\r\n            width: '30px',\r\n            height: '30px',\r\n            backgroundImage: 'url(' + eyedropperImg + ')',\r\n            backgroundRepeat:  'no-repeat',\r\n            backgroundSize: '70%',\r\n            backgroundPosition: 'center'\r\n        }\r\n    });\r\n    let isPicking = false;\r\n\r\n\r\n    pickerButton.onclick = function () {\r\n        if (isPicking === false) {\r\n            BB.removeClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            BB.addClassName(pickerButton, 'color-picker-preview-button-active');\r\n            isPicking = true;\r\n            pickCallback(true);\r\n        } else {\r\n            pickCallback(false);\r\n            _this.pickingDone();\r\n        }\r\n    };\r\n    const pickerButtonPointerListener = new BB.PointerListener({\r\n        target: pickerButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isPicking) {\r\n                return;\r\n            }\r\n            if (isOver) {\r\n                BB.addClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            } else {\r\n                BB.removeClassName(pickerButton, 'color-picker-preview-button-hover');\r\n            }\r\n        }\r\n    });\r\n    divPreview.appendChild(pickerButton);\r\n\r\n\r\n    const hexButton = BB.el({\r\n        content: '#',\r\n        className: 'color-picker-preview-button',\r\n        title: LANG('manual-color-input'),\r\n        css: {\r\n            height: '100%',\r\n            width: height + 'px',\r\n            lineHeight: height + 'px',\r\n            fontSize: (height * 0.65) + 'px'\r\n        },\r\n        onClick: function() {\r\n            HexColorDialog({\r\n                klRootEl: p.klRootEl,\r\n                color: new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b),\r\n                onClose: function(rgbObj) {\r\n                    if (!rgbObj) {\r\n                        return;\r\n                    }\r\n                    _this.setColor(rgbObj);\r\n                    emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n                }\r\n            });\r\n        }\r\n    });\r\n    const hexButtonPointerListener = new BB.PointerListener({\r\n        target: hexButton,\r\n        onEnterLeave: function(isOver) {\r\n            if (isOver) {\r\n                BB.addClassName(hexButton, 'color-picker-preview-button-hover');\r\n            } else {\r\n                BB.removeClassName(hexButton, 'color-picker-preview-button-hover');\r\n            }\r\n        }\r\n    });\r\n    divPreview.appendChild(hexButton);\r\n\r\n    setColPreview();\r\n\r\n\r\n    setTimeout(function() {\r\n        createHueBg(divH);\r\n        divH.appendChild(controlH);\r\n        svPointerListener = new BB.PointerListener({\r\n            target: svWrapper,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0px 0px 0px 1px rgb(255,255,255)',\r\n                        zIndex: '1'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / width * 100;\r\n                        virtualHSV.v = 100 - event.relY / svHeight * 100;\r\n\r\n                        primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n\r\n                        updateSVPointer();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.s = primaryColorHSV.s;\r\n                        virtualHSV.v = primaryColorHSV.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / svHeight * 100 * factor;\r\n\r\n                    primaryColorHSV = new BB.HSV(primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    updateSVPointer();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(SVContainer, {\r\n                        boxShadow: '0 0 0 1px rgb(188, 188, 188)',\r\n                        zIndex: '0'\r\n                    });\r\n                }\r\n\r\n            }\r\n        });\r\n        hPointerListener = new BB.PointerListener({\r\n            target: divH,\r\n            maxPointers: 1,\r\n            fixScribble: true,\r\n            onPointer: function(event) {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    BB.css(divH, {\r\n                        boxShadow: '0px 0px 0px 1px rgba(255,255,255,1)'\r\n                    });\r\n\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / width * 359.99;\r\n\r\n                        primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                        primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                        controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                        updateSVCanvas();\r\n                        setColPreview();\r\n                        emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n                    } else {\r\n                        virtualHSV.h = primaryColorHSV.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    primaryColorHSV = new BB.HSV(virtualHSV.h, primaryColorHSV.s, primaryColorHSV.v);\r\n                    primaryColorRGB = BB.ColorConverter.toRGB(primaryColorHSV);\r\n                    controlH.style.left = (Math.round(primaryColorHSV.h / 359.99 * width) - 1) + 'px';\r\n                    updateSVCanvas();\r\n                    setColPreview();\r\n                    emitColor(BB.ColorConverter.toRGB(primaryColorHSV));\r\n\r\n                }\r\n\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(divH, {\r\n                        boxShadow: 'rgb(188, 188, 188) 0 0 0 1px'\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }, 1);\r\n\r\n\r\n    // --- second color ---\r\n\r\n    const secondaryColorBtn = BB.el({\r\n        parent: outputDiv,\r\n        title: LANG('secondary-color') + ' [X]',\r\n        css: {\r\n            cursor: 'pointer',\r\n            marginLeft: '5px',\r\n            width: '22px',\r\n            height: '22px',\r\n            boxShadow: 'rgb(188, 188, 188) 0px 0px 0px 1px',\r\n            colorScheme: 'only light',\r\n        },\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            swapColors();\r\n        }\r\n    });\r\n    function updateSecondaryColor() {\r\n        secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(secondaryColorRGB);\r\n    }\r\n    function swapColors() {\r\n        // swap hsv\r\n        let tmp: any = secondaryColorHSV;\r\n        secondaryColorHSV = primaryColorHSV;\r\n        updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = secondaryColorRGB;\r\n        secondaryColorRGB = primaryColorRGB;\r\n        primaryColorRGB = tmp;\r\n\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n        updateSecondaryColor();\r\n\r\n        emitColor(new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b));\r\n    }\r\n    updateSecondaryColor();\r\n\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setColor = function (c) {\r\n        primaryColorRGB = {r: parseInt(c.r, 10), g: parseInt(c.g, 10), b: parseInt(c.b, 10)};\r\n        updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        controlH.style.left = parseInt('' + (primaryColorHSV.h / 359 * width - 1)) + 'px';\r\n        updateSVCanvas();\r\n        updateSVPointer();\r\n        setColPreview();\r\n    };\r\n\r\n    this.getColor = function () {\r\n        return new BB.RGB(primaryColorRGB.r, primaryColorRGB.g, primaryColorRGB.b);\r\n    };\r\n\r\n    this.getSecondaryRGB = function() {\r\n        return new BB.RGB(secondaryColorRGB.r, secondaryColorRGB.g, secondaryColorRGB.b);\r\n    };\r\n\r\n    this.setPickCallback = function (func) {\r\n        pickCallback = func;\r\n    };\r\n\r\n    this.pickingDone = function () {\r\n        if (!isPicking) {\r\n            return;\r\n        }\r\n        isPicking = false;\r\n        BB.removeClassName(pickerButton, 'color-picker-preview-button-active');\r\n    };\r\n\r\n    this.enable = function (e) {\r\n        if (e) {\r\n            div.style.pointerEvents = '';\r\n            div.style.opacity = '1';\r\n            outputDiv.style.pointerEvents = '';\r\n            outputDiv.style.opacity = '1';\r\n        } else {\r\n            div.style.pointerEvents = 'none';\r\n            div.style.opacity = '0.5';\r\n            outputDiv.style.pointerEvents = 'none';\r\n            outputDiv.style.opacity = '0.5';\r\n        }\r\n    };\r\n\r\n    this.setHeight = function (h) {\r\n        h = parseInt('' +(h - height * 2 - 3), 10);\r\n        if (h === svHeight) {\r\n            return;\r\n        }\r\n        svHeight = h;\r\n        BB.css(svSvg, {\r\n            width: width + 'px',\r\n            height: svHeight + 'px'\r\n        });\r\n        SVContainer.style.height = svHeight + 'px';\r\n        updateSVPointer();\r\n    };\r\n\r\n    this.swapColors = function() {\r\n        swapColors();\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n\r\n    this.getOutputElement = function() {\r\n        return outputDiv;\r\n    }\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"wC0GY\");","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\n\n\n/**\n * a small color slider\n *\n * params {\n * \t width: 200,\n * \t heightSV: 200,\n * \t heightH: 10,\n * \t color: {r,g,b}\n * \t callback: function(c){}\n * }\n *\n * @param params\n * @constructor\n */\nexport const KlSmallColorSlider = function (params) {\n    const div = document.createElement('div');\n    div.oncontextmenu = function(e) {\n        e.preventDefault();\n    };\n    let color = BB.ColorConverter.toHSV(new BB.RGB(params.color.r, params.color.g, params.color.b));\n    BB.css(div, {\n        width: params.width + 'px',\n        position: 'relative',\n        overflow: 'hidden',\n        userSelect: 'none'\n    });\n\n    const canvasSV = BB.canvas(10, 10);\n    canvasSV.style.width = params.width + 'px';\n    canvasSV.style.height = params.heightSV + 'px';\n    canvasSV.style.cursor = 'crosshair';\n\n    function updateSV() {\n        const ctx = canvasSV.getContext('2d');\n        for (let i = 0; i < canvasSV.height; i += 1) {\n            const gradient1 = ctx.createLinearGradient(0, 0, canvasSV.width, 0);\n\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(color.h, 1, 100 - (i / canvasSV.height * 100.0)));\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(color.h, 100, 100 - (i / canvasSV.height * 100.0)));\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\n            ctx.fillStyle = gradient1;\n            ctx.fillRect(0, i, canvasSV.width, 1);\n        }\n    }\n\n    updateSV();\n\n    const canvasH = BB.canvas(params.width, params.heightH);\n    canvasH.style.cursor = 'ew-resize';\n    (function () {\n        const ctx = canvasH.getContext('2d');\n\n        const gradH = ctx.createLinearGradient(0, 0, params.width, 0);\n        for (let i = 0; i < 1; i += 0.01) {\n            const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n            gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\n        }\n        ctx.fillStyle = gradH;\n        ctx.fillRect(0, 0, params.width, params.heightH);\n\n    })();\n    BB.css(canvasSV, {\n        width: params.width + 'px',\n        height: params.heightSV + 'px',\n        overflow: 'hidden',\n        position: 'relative'\n    });\n    canvasSV.style.cssFloat = 'left';\n    canvasH.style.cssFloat = 'left';\n\n    div.appendChild(canvasSV);\n    div.appendChild(canvasH);\n\n    const pointerSV = document.createElement('div');\n    BB.css(pointerSV, {\n        width: '8px',\n        height: '8px',\n        borderRadius: '8px',\n        position: 'absolute',\n        pointerEvents: 'none',\n        boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff'\n    });\n    div.appendChild(pointerSV);\n\n    const pointerH = document.createElement('div');\n    BB.css(pointerH, {\n        width: '0',\n        height: params.heightH + 'px',\n        borderLeft: '1px solid #fff',\n        borderRight: '1px solid #000',\n        position: 'absolute',\n        top: params.heightSV + 'px',\n        pointerEvents: 'none'\n    });\n    div.appendChild(pointerH);\n\n\n    function updateSVPointer() {\n        const left = color.s / 100 * params.width - 4;\n        const top = (1 - color.v / 100) * params.heightSV - 4;\n        BB.css(pointerSV, {\n            left: left + 'px',\n            top: top + 'px'\n        });\n        /*if (top < params.heightSV/3) {\n        pointerSV.style.border = \"1px solid rgba(0,0,0,1)\";\n    } else {\n        pointerSV.style.border = \"1px solid rgba(255,255,255,1)\";\n    }*/\n    }\n\n    function updateHPointer() {\n        pointerH.style.left = (color.h / 359.999 * params.width - 1) + 'px';\n    }\n\n    updateSVPointer();\n    updateHPointer();\n\n    const virtualHSV = {\n        h: 0,\n        s: 0,\n        v: 0\n    };\n\n    let svPointerId = null;\n    const svPointerListener = new BB.PointerListener({\n        target: canvasSV,\n        maxPointers: 1,\n        fixScribble: true,\n        onPointer: function(event) {\n\n            if (event.type === 'pointerdown') {\n                svPointerId = event.pointerId;\n                if (event.button === 'left') {\n\n                    virtualHSV.s = event.relX / params.width * 100;\n                    virtualHSV.v = 100 - event.relY / params.heightSV * 100;\n\n                    color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\n\n                    updateSVPointer();\n                    params.callback(BB.ColorConverter.toRGB(color));\n                } else {\n                    virtualHSV.s = color.s;\n                    virtualHSV.v = color.v;\n                }\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && svPointerId === event.pointerId) {\n\n                let factor = 1;\n                if (event.button === 'right') {\n                    factor = 0.5;\n                }\n\n                virtualHSV.s += event.dX / params.width * 100 * factor;\n                virtualHSV.v -= event.dY / params.heightSV * 100 * factor;\n\n                color = new BB.HSV(color.h, virtualHSV.s, virtualHSV.v);\n                updateSVPointer();\n                params.callback(BB.ColorConverter.toRGB(color));\n\n            }\n            if (event.type === 'pointerup') {\n                svPointerId = null;\n            }\n\n        }\n    });\n\n    let hPointerId = null;\n    const hPointerListener = new BB.PointerListener({\n        target: canvasH,\n        maxPointers: 1,\n        fixScribble: true,\n        onPointer: function(event) {\n\n            if (event.type === 'pointerdown') {\n                hPointerId = event.pointerId;\n                if (event.button === 'left') {\n\n                    virtualHSV.h = event.relX / params.width * 359.99;\n\n                    color = new BB.HSV(virtualHSV.h, color.s, color.v);\n                    updateSV();\n                    updateHPointer();\n                    params.callback(BB.ColorConverter.toRGB(color));\n                } else {\n                    virtualHSV.h = color.h;\n                }\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button) && hPointerId === event.pointerId) {\n\n                const deltaY = Math.abs(event.pageY - event.downPageY);\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                virtualHSV.h += event.dX / params.width * 359.99 * factor;\n\n                if (event.button === 'right') {\n                    virtualHSV.h = virtualHSV.h % 359.99;\n                    if (virtualHSV.h < 0) {\n                        virtualHSV.h += 359.99;\n                    }\n                }\n                virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                color = new BB.HSV(virtualHSV.h, color.s, color.v);\n                updateSV();\n                updateHPointer();\n                params.callback(BB.ColorConverter.toRGB(color));\n\n            }\n            if (event.type === 'pointerup') {\n                hPointerId = null;\n            }\n        }\n    });\n\n\n    const cleardiv = document.createElement('div');\n    cleardiv.style.clear = 'both';\n    div.appendChild(cleardiv);\n\n    // --- interface ---\n    this.setColor = function (c) {\n        color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\n        updateSV();\n        updateSVPointer();\n        updateHPointer();\n    };\n    this.getColor = function () {\n        return BB.ColorConverter.toRGB(color);\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.destroy = function() {\n        svPointerListener.destroy();\n        hPointerListener.destroy();\n    };\n    this.end = function() {\n        svPointerId = null;\n        hPointerId = null;\n    };\n\n};","import {BB} from '../../../bb/bb';\n\n\n/**\n * a slider that looks like this\n * ------O----\n *\n * param: {init, width, pointSize, callback(value, isFirst, isLast)}\n *\n * @param param\n * @constructor\n */\nexport const PointSlider = function(param) {\n\n    const div = document.createElement('div');\n    div.style.position = 'relative';\n    const sliderLine = BB.el({});\n    const sliderPoint = BB.el({\n        css: {\n            colorScheme: 'only light',\n        }\n    });\n    div.appendChild(sliderLine);\n    div.appendChild(sliderPoint);\n    let sliderPos;\n    let isDragging = false;\n\n    //sliderLine\n    {\n        BB.css(sliderLine, {\n            marginTop: parseInt('' + (param.pointSize / 2 - 1)) + 'px',\n            height: '2px',\n            background: '#aaa',\n            width: param.width + 'px'\n        });\n    }\n    //sliderPoint\n    const touchAreaEl = BB.el({ // expand clickable area\n        parent: sliderPoint,\n        css: {\n            // background: 'rgba(255,0,0,0.4)',\n            margin: '-7px 0 0 -7px',\n            width: 'calc(100% + 14px)',\n            height: 'calc(100% + 7px)',\n        }\n    });\n\n    function redrawPoint() {\n        sliderPoint.style.left = sliderPos + 'px';\n        if (isDragging) {\n            sliderPoint.style.boxShadow = '0 0 6px rgba(0,0,0,1)';\n        } else {\n            sliderPoint.style.boxShadow = '0 0 3px rgba(0,0,0,0.8)';\n        }\n    }\n    function getValue() {\n        return sliderPos /  (param.width - param.pointSize);\n    }\n\n    let pointerListener;\n    {\n        let isFirst;\n        sliderPos = BB.clamp(param.init * (param.width - param.pointSize), 0, param.width - param.pointSize);\n        BB.css(sliderPoint, {\n            position: 'absolute',\n            top: '0px',\n            backgroundColor: '#eaeaea',\n            boxShadow: '0 0 3px rgba(0,0,0,0.8)',\n            width: param.pointSize + 'px',\n            height: param.pointSize + 'px',\n            borderRadius: param.pointSize + 'px',\n            cursor: 'ew-resize',\n            transition: 'box-shadow 0.2s ease-in-out'\n        });\n        redrawPoint();\n        let imaginaryPos;\n        pointerListener = new BB.PointerListener({\n            target: sliderPoint,\n            fixScribble: true,\n            onPointer: function(event) {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    isFirst = true;\n                    isDragging = true;\n                    imaginaryPos = sliderPos;\n                    redrawPoint();\n                    event.eventStopPropagation();\n                } else if (event.type === 'pointermove' && event.button === 'left') {\n                    event.eventStopPropagation();\n                    imaginaryPos = imaginaryPos + event.dX;\n                    sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, param.width - param.pointSize));\n                    redrawPoint();\n                    param.callback(getValue(), isFirst, false);\n                    isFirst = false;\n                }\n                if (event.type === 'pointerup') {\n                    event.eventStopPropagation();\n                    isDragging = false;\n                    redrawPoint();\n                    param.callback(getValue(), false, true);\n                }\n            }\n        })\n    }\n\n    // --- interface ---\n    this.getEl = function() {\n        return div;\n    };\n    this.setActive = function(isActive) {\n        if (isActive) {\n            sliderPoint.style.backgroundColor = '#fff';\n        } else {\n            sliderPoint.style.backgroundColor = '#eaeaea';\n        }\n    };\n    this.destroy = function() {\n        pointerListener.destroy();\n    };\n};","import {BB} from '../../../bb/bb';\n\n/**\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\n * Can't deal with 0.5 alpha.\n * Rectangular buttons.\n *\n * p = {\n *     colorArr: rgba[], // duplicates are removed\n *     onChange: func(rgbaObj),\n *     label: string,\n *     initialIndex: int// optional, index before duplicates were removed\n * }\n *\n * @param p\n * @constructor\n */\nexport const ColorOptions = function(p) {\n    const div = BB.el({\n        content: p.label ? p.label : '',\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            colorScheme: 'only light',\n        }\n    });\n\n    let selectedIndex = 0;\n    const colorArr = [];\n    const buttonArr = [];\n    const buttonSize = 22;\n    const checkerUrl = BB.createCheckerDataUrl(5);\n\n    // build colorArr while removing duplicates\n    for (let i = 0; i < p.colorArr.length; i++) {\n        const item = p.colorArr[i];\n        let found = false;\n        for (let e = 0; e < colorArr.length; e++) {\n            const sItem = colorArr[e];\n            if (sItem === null || item === null) {\n                continue;\n            }\n            if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\n                found = true;\n                break;\n            }\n        }\n        if (found) {\n            continue;\n        }\n        colorArr.push(item);\n        if ('initialIndex' in p && p.initialIndex === i) {\n            selectedIndex = colorArr.length - 1;\n        }\n    }\n\n    for (let i = 0; i < colorArr.length; i++) {\n        (function(i) {\n\n            const colorButton = BB.el({\n                content: colorArr[i] ? '' : 'X',\n                css: {\n                    width: buttonSize + 'px',\n                    height: buttonSize + 'px',\n                    backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\n                    marginLeft: '7px',\n                    boxShadow: '0 0 0 1px #aaa',\n                    cursor: 'pointer',\n                    userSelect: 'none',\n                    textAlign: 'center',\n                    lineHeight: (buttonSize + 1) + 'px',\n                    color: '#aaa'\n                }\n            });\n            if (colorArr[i] && colorArr[i].a === 0) {\n                colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\n            }\n\n            colorButton.onclick = function(e) {\n                e.preventDefault();\n                selectedIndex = i;\n                update();\n                p.onChange(colorArr[i]);\n            };\n\n            (colorButton as any).setIsSelected = function(b) {\n                if (b) {\n                    BB.css(colorButton, {\n                        boxShadow: '0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)',\n                        pointerEvents: 'none'\n                    });\n                } else {\n                    BB.css(colorButton, {\n                        boxShadow: '0 0 0 1px #aaa',\n                        pointerEvents: ''\n                    });\n                }\n            };\n\n\n            div.appendChild(colorButton);\n            buttonArr.push(colorButton);\n        })(i);\n    }\n\n\n    function update() {\n        for (let i = 0; i < buttonArr.length; i++) {\n            buttonArr[i].setIsSelected(i === selectedIndex);\n        }\n    }\n    update();\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n    this.destroy = () => {\n        buttonArr.forEach(item => {\n            item.onclick = null;\n        });\n        buttonArr.splice(0, buttonArr.length);\n    };\n};","import {BB} from '../../../bb/bb';\n\n/**\n * selectable options\n * p = {\n *     optionArr: {\n *          id: string,\n *          label: string | HTMLElement\n *     }[],\n *     initialId?: string,\n *     onChange: function(id string): void,\n *     changeOnInit?: boolean, // trigger change on creation\n * }\n *\n * @param p\n * @constructor\n */\nexport const Options = function(p) {\n    const div = BB.el({});\n\n    const wrapperEl = BB.el({\n        parent: div,\n        className: 'kl-option-wrapper',\n        css: {\n            display: 'flex'\n        }\n    });\n\n    const optionArr: {\n        id: string;\n        el: HTMLElement;\n    }[] = [];\n    let selectedId = 'initialId' in p ? p.initialId : p.optionArr[0].id;\n\n    function createOption(o) {\n        const optionObj = {\n            id: o.id,\n            el: null,\n        };\n\n        const classArr = ['kl-option'];\n        if (p.isSmall) {\n            classArr.push('kl-option--small');\n        }\n        if (typeof o.label !== 'string') {\n            classArr.push('kl-option--custom-el');\n            BB.css(o.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n\n        optionObj.el = BB.el({\n            parent: wrapperEl,\n            content: o.label,\n            className: classArr.join(' '),\n            onClick: function() {\n                if (selectedId !== optionObj.id) {\n                    selectedId = optionObj.id;\n                    update();\n                    p.onChange(selectedId);\n                }\n            }\n        });\n\n        if (o.title) {\n            optionObj.el.title = o.title;\n        }\n\n        optionArr.push(optionObj);\n    }\n\n    function update() {\n        for (let i = 0; i < optionArr.length; i++) {\n            if (optionArr[i].id === selectedId) {\n                BB.addClassName(optionArr[i].el, 'kl-option-selected');\n            } else {\n                BB.removeClassName(optionArr[i].el, 'kl-option-selected');\n            }\n        }\n    }\n\n    for (let i = 0; i < p.optionArr.length; i++) {\n        createOption(p.optionArr[i]);\n    }\n\n    update();\n\n    if (p.changeOnInit) {\n        setTimeout(function() {\n            p.onChange(selectedId);\n        }, 0);\n    }\n\n    function getIndex() {\n        for (let i = 0; i < optionArr.length; i++) {\n            if (optionArr[i].id === selectedId) {\n                return i;\n            }\n        }\n    }\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.getValue = function() {\n        return selectedId;\n    }\n    this.next = function() {\n        selectedId = optionArr[(getIndex() + 1) % optionArr.length].id;\n        update();\n        p.onChange(selectedId);\n    };\n    this.previous = function() {\n        selectedId = optionArr[(optionArr.length + getIndex() - 1) % optionArr.length].id;\n        update();\n        p.onChange(selectedId);\n    };\n    this.destroy = () => {\n        optionArr.forEach(item => {\n            BB.destroyEl(item.el);\n        });\n        optionArr.splice(0, optionArr.length);\n    };\n};","import {BB} from '../../../bb/bb';\r\n// @ts-ignore\r\nimport angleSvg from 'url:~/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private container: HTMLDivElement;\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState() {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init() {\r\n        this.el = BB.el({\r\n            className: \"top-overlay\",\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay-inner',\r\n        }) as HTMLDivElement\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px'\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.appendChild(this.innerInnerEl);\r\n        this.innerEl.appendChild(this.angleIm);\r\n        this.el.appendChild(this.innerEl);\r\n        this.container.appendChild(this.el);\r\n        this.el.style.display = \"none\";\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (el: HTMLDivElement) {\r\n        this.container = el;\r\n        this.init();\r\n    }\r\n\r\n    setWide(b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState(state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out(msg: string | {type: 'transform', angleDeg: number, scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'top-overlay-pulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : \"consoleIn\";\r\n        this.el.style.opacity = \"1\";\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = \"0\";\r\n            this.el.style.animationName = \"consoleOut\";\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = \"none\";\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = \"flex\";\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"fmKxO\");","import {BB} from '../../../bb/bb';\nimport {popup} from './popup';\n\nexport function exportDialog(parent, image) {\n    let boxSize, aboutCloseFunc, aboutDiv, closed, aniToggle, imageContainer, coverImage, coverSize,\n        text, holding, aniTimeout, halfBoxSize;\n    boxSize = 22 * 2;\n    halfBoxSize = 22;\n    aboutCloseFunc = function () {\n    };\n    closed = false;\n    aniToggle = false;\n    aboutDiv = document.createElement(\"div\");\n    BB.css(aboutDiv, {\n        width: (7 * boxSize) + \"px\"\n    });\n\n    imageContainer = document.createElement(\"div\");\n    coverImage = new Image();\n    coverImage.src = image.src;\n\n    imageContainer.appendChild(coverImage);\n    imageContainer.appendChild(image);\n\n    BB.css(imageContainer, {\n        width: (6 * boxSize) + \"px\",\n        height: (4 * boxSize) + \"px\",\n        marginTop: (boxSize / 2 - 1) + \"px\",\n        marginLeft: (boxSize / 2 - 1) + \"px\",\n        position: \"relative\",\n        overflow: \"hidden\",\n        boxShadow: \"0 0 10px 4px rgba(255,255,255, 0)\",\n        border: \"1px solid rgba(255, 255, 255, 1)\",\n        transition: \"box-shadow 0.7s linear\"\n    });\n    BB.css(image, {\n        position: \"absolute\",\n        left: '0',\n        top: '0',\n        width: (6 * boxSize) + \"px\",\n        height: (4 * boxSize) + \"px\",\n        opacity: '0'\n    });\n    coverSize = {\n        width: (6 * boxSize),\n        height: (6 * boxSize / image.width) * image.height\n    };\n    if (coverSize.height < (4 * boxSize)) {\n        coverSize.height = (4 * boxSize);\n        coverSize.width = (coverSize.height / image.height) * image.width;\n    }\n    BB.css(coverImage, {\n        position: \"absolute\",\n        top: (2 * boxSize) + \"px\",\n        left: (3 * boxSize) + \"px\",\n        width: coverSize.width + \"px\",\n        height: coverSize.height + \"px\",\n        marginLeft: (-coverSize.width / 2) + \"px\",\n        marginTop: (-coverSize.height / 2) + \"px\"\n    });\n\n    function animation() {\n        if (closed) {\n            return;\n        }\n        aniToggle = !aniToggle;\n        if (aniToggle) {\n            BB.css(imageContainer, {\n                border: \"1px solid rgba(0, 0, 0, 1)\"\n            });\n        } else {\n            BB.css(imageContainer, {\n                border: \"1px solid rgba(200, 200, 200, 1)\"\n            });\n        }\n        setTimeout(animation, 510);\n    }\n\n    animation();\n\n    text = document.createElement(\"div\");\n    text.innerHTML = \"Right-Click or Press-Hold on the image, then save.\";\n    text.ontouchstart = function () {\n        return false;\n    };\n    BB.css(text, {\n        fontSize: (boxSize / 2.5) + \"px\",\n        color: \"#666\",\n        padding: \"10px\",\n        textAlign: \"center\"\n    });\n\n    aboutDiv.appendChild(imageContainer);\n    aboutDiv.appendChild(text);\n\n    holding = false;\n    image.ontouchstart = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 8px rgba(0,255,255, 1)\"\n        });\n        holding = true;\n        aniTimeout = setTimeout(function () {\n            holding = false;\n            BB.css(imageContainer, {\n                boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n            });\n        }, 1500);\n    };\n    image.ontouchmove = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n        });\n        holding = false;\n        clearTimeout(aniTimeout);\n    };\n    image.ontouchend = function () {\n        BB.css(imageContainer, {\n            boxShadow: \"0 0 10px 4px rgba(0,255,255, 0)\"\n        });\n        holding = false;\n        clearTimeout(aniTimeout);\n    };\n\n    popup({\n        target: parent,\n        message: \"<b>Save Image</b>\",\n        div: aboutDiv,\n        buttons: [\"Close\"],\n        callback: function (result) {\n            closed = true;\n        }\n    });\n}","import {BB} from '../../../bb/bb';\n\n/**\n * element that lets you crop an image and copy it via right click\n *\n * param = {\n *     width: number,\n *     height: number,\n *     canvas: image | canvas,\n *     isNotCopy: boolean,\n *     onChange: function(width, height)\n * }\n *\n * @param param object\n * @constructor\n */\nexport function CropCopy(param) {\n    const div = document.createElement('div');\n    BB.css(div, {\n        position: 'relative',\n        height: param.height + 'px',\n        width: param.width + 'px',\n        overflow: 'hidden',\n        colorScheme: 'only light',\n    });\n    div.style.position = 'relative';\n\n    let crop;\n    function resetCrop() {\n        crop = {\n            x: 0,\n            y: 0,\n            width: param.canvas.width,\n            height: param.canvas.height\n        };\n    }\n    resetCrop();\n\n\n    function updateCroppedCanvas() {\n        croppedCanvas.width = Math.round(crop.width);\n        croppedCanvas.height = Math.round(crop.height);\n        let ctx = croppedCanvas.getContext('2d');\n        ctx.drawImage(param.canvas, Math.round(-crop.x), Math.round(-crop.y));\n        if (croppedImage) {\n            croppedImage.src = croppedCanvas.toDataURL('image/png');\n        }\n\n        if (param.onChange) {\n            param.onChange(croppedCanvas.width, croppedCanvas.height);\n        }\n    }\n    function updateSelectionRect() {\n        BB.css(selectionRect, {\n            left: (thumbX + crop.x * scaleW) + 'px',\n            top: (thumbY + crop.y * scaleH) + 'px',\n            width: (crop.width * scaleW) + 'px',\n            height: (crop.height * scaleH) + 'px'\n        });\n        if (param.onChange) {\n            param.onChange(Math.round(crop.width), Math.round(crop.height));\n        }\n    }\n    function isInsideSelectionRect(p) {\n        let rect = {\n            x: Math.round(thumbX + crop.x * scaleW),\n            y: Math.round(thumbY + crop.y * scaleH),\n            width: Math.round(crop.width * scaleW),\n            height: Math.round(crop.height * scaleH)\n        };\n        return rect.x <= p.x && p.x <= rect.x + rect.width &&\n            rect.y <= p.y && p.y <= rect.y + rect.height;\n    }\n\n    const croppedCanvas = BB.canvas();\n    let eventTarget = croppedCanvas;\n    let croppedImage = null;\n    if (!param.isNotCopy) { //navigator.appName === 'Microsoft Internet Explorer') { //i would prefer not using an image\n        croppedImage = new Image();\n        eventTarget = croppedImage;\n    }\n    BB.css(eventTarget, {\n        height: param.height + 'px',\n        width: param.width + 'px'\n    });\n    div.appendChild(eventTarget);\n    updateCroppedCanvas();\n\n    const padding = 20;\n    const previewWrapper = BB.el({\n        css: {\n            width: param.width + 'px',\n            height: param.height + 'px',\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none'\n        }\n    });\n    div.appendChild(previewWrapper);\n    BB.createCheckerDataUrl(4, function(v) {\n        previewWrapper.style.backgroundImage = 'url('+v+')';\n    });\n\n    const thumbSize = BB.fitInto(param.canvas.width, param.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\n    const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\n    thumbCanvas.style.imageRendering = 'pixelated';\n    const scaleW = thumbCanvas.width / param.canvas.width;\n    const scaleH = thumbCanvas.height / param.canvas.height;\n    const thumbCtx = thumbCanvas.getContext('2d');\n    thumbCtx.imageSmoothingEnabled = false;\n    thumbCtx.drawImage(param.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\n    previewWrapper.appendChild(thumbCanvas);\n    const thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\n    const thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\n    BB.css(thumbCanvas, {\n        position: 'absolute',\n        left: thumbX + \"px\",\n        top: thumbY + \"px\"\n    });\n\n    const selectionRect = BB.el({\n        css: {\n            position: 'absolute',\n            boxShadow: '0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000',\n        }\n    });\n    previewWrapper.appendChild(selectionRect);\n    updateSelectionRect();\n\n\n    function toOriginalSpace(p) {\n        return {\n            x: BB.clamp((p.x - thumbX) / scaleW, 0, param.canvas.width),\n            y: BB.clamp((p.y - thumbY) / scaleH, 0, param.canvas.height),\n        };\n    }\n    //gen crop from thumb-space points\n    function genCrop(p1, p2) {\n        let topLeftP = {\n            x: Math.min(p1.x, p2.x),\n            y: Math.min(p1.y, p2.y)\n        };\n        let bottomRightP = {\n            x: Math.max(p1.x, p2.x),\n            y: Math.max(p1.y, p2.y)\n        };\n        let origTopLeftP = toOriginalSpace(topLeftP);\n        let origBottomRightP = toOriginalSpace(bottomRightP);\n        origTopLeftP.x = Math.floor(origTopLeftP.x);\n        origTopLeftP.y = Math.floor(origTopLeftP.y);\n        origBottomRightP.x = Math.ceil(origBottomRightP.x);\n        origBottomRightP.y = Math.ceil(origBottomRightP.y);\n        return {\n            x: origTopLeftP.x,\n            y: origTopLeftP.y,\n            width: origBottomRightP.x - origTopLeftP.x,\n            height: origBottomRightP.y - origTopLeftP.y\n        };\n    }\n\n    function isReset() {\n        return crop.x === 0 && crop.y === 0 && crop.width === param.canvas.width && crop.height === param.canvas.height;\n    }\n\n    let startP;\n    let startCrop = null;\n    let isDragging = false;\n    let didMove = false;\n    let updateCropTimeout;\n    const pointerListener = new BB.PointerListener({\n        target: eventTarget,\n        fixScribble: true,\n        onPointer: function(event) {\n            let fullPos;\n            if (event.type === 'pointerdown' && event.button === 'left') {\n                event.eventPreventDefault();\n                isDragging = true;\n                startP = {\n                    x: event.relX,\n                    y: event.relY\n                };\n                if (!isReset() && isInsideSelectionRect(startP)) {\n                    startCrop = {\n                        x: crop.x,\n                        y: crop.y,\n                        width: crop.width,\n                        height: crop.height\n                    };\n                } else {\n                    crop = genCrop(startP, startP);\n                }\n            } else if (event.type === 'pointermove' && event.button === 'left') {\n                event.eventPreventDefault();\n                didMove = true;\n                if (startCrop) {\n                    crop.x = startCrop.x + Math.round((event.relX - startP.x) / scaleW);\n                    crop.y = startCrop.y + Math.round((event.relY - startP.y) / scaleH);\n                    crop.x = BB.clamp(crop.x, 0, param.canvas.width - crop.width);\n                    crop.y = BB.clamp(crop.y, 0, param.canvas.height - crop.height);\n                } else {\n                    crop = genCrop(startP, {x: event.relX, y: event.relY});\n                }\n                updateSelectionRect();\n            } else if (event.type === 'pointerup' && startP) {\n                event.eventPreventDefault();\n                isDragging = false;\n                startCrop = null;\n                startP = null;\n                if (crop.width === 0 || crop.height === 0 || !didMove) {\n                    resetCrop();\n                    updateSelectionRect();\n                }\n                didMove = false;\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 1);\n            }\n        }\n    });\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, e, comboStr) {\n            if (isDragging) {\n                return;\n            }\n            let doUpdate = false;\n\n            let stepSize = Math.max(1, 1 / scaleW);\n            let shiftIsPressed = keyListener.isPressed('shift');\n\n            if (keyStr === 'left') {\n                if (shiftIsPressed) {\n                    crop.width = BB.clamp(crop.width - stepSize, 1, param.canvas.width - crop.x);\n                } else {\n                    crop.x = BB.clamp(crop.x - stepSize, 0, param.canvas.width - crop.width);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'right') {\n                if (shiftIsPressed) {\n                    crop.width = BB.clamp(crop.width + stepSize, 1, param.canvas.width - crop.x);\n                } else {\n                    crop.x = BB.clamp(crop.x + stepSize, 0, param.canvas.width - crop.width);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'up') {\n                if (shiftIsPressed) {\n                    crop.height = BB.clamp(crop.height - stepSize, 1, param.canvas.height - crop.y);\n                } else {\n                    crop.y = BB.clamp(crop.y - stepSize, 0, param.canvas.height - crop.height);\n                }\n                doUpdate = true;\n            }\n            if (keyStr === 'down') {\n                if (shiftIsPressed) {\n                    crop.height = BB.clamp(crop.height + stepSize, 1, param.canvas.height - crop.y);\n                } else {\n                    crop.y = BB.clamp(crop.y + stepSize, 0, param.canvas.height - crop.height);\n                }\n                doUpdate = true;\n            }\n\n            if (doUpdate) {\n                e.preventDefault();\n                updateSelectionRect();\n                clearTimeout(updateCropTimeout);\n                updateCropTimeout = setTimeout(updateCroppedCanvas, 100);\n            }\n        }\n    });\n\n    this.getEl = function() {\n        return div;\n    };\n    this.reset = function() {\n        resetCrop();\n        updateCroppedCanvas();\n        updateSelectionRect();\n    };\n    this.destroy = function() {\n        eventTarget.style.removeProperty('width');\n        eventTarget.style.removeProperty('height');\n        keyListener.destroy();\n        pointerListener.destroy();\n    };\n    this.isReset = function() {\n        return isReset();\n    };\n    this.getRect = function() {\n        return JSON.parse(JSON.stringify(crop));\n    };\n    this.getCroppedImage = function() {\n        return croppedCanvas;\n    };\n}\n","import { BB } from '../../../bb/bb';\r\nimport { popup } from './popup';\r\nimport { CropCopy } from '../components/crop-copy';\r\nimport { LANG } from '../../../language/language';\r\n\r\n/// <reference path=\"./types.d.ts\" />\r\n\r\n/**\r\n *\r\n * @param parent\r\n * @param fullCanvas\r\n * @param cropCallback\r\n * @param output - BB.Output\r\n * @param showCrop - boolean - show crop button\r\n */\r\nexport function clipboardDialog(parent, bbox, fullCanvas, cropCallback, output, showCrop) {\r\n    const div = document.createElement(\"div\");\r\n    const isSmall = bbox.width < 550 || bbox.height < 550;\r\n\r\n    let topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop'),\r\n        css: {\r\n            textAlign: 'center'\r\n        }\r\n    });\r\n    div.appendChild(topWrapper);\r\n\r\n\r\n    let cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n    function toClipboard() {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function () {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob\r\n                    } as any) // todo check is possible?\r\n                ]);\r\n                setTimeout(function () {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closefunc();\r\n            }\r\n        }\r\n    });\r\n\r\n    let closefunc;\r\n    function blur() {\r\n        closefunc();\r\n    }\r\n    BB.addEventListener(window, \"blur\", blur);\r\n    popup({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: \"500px\"\r\n        },\r\n        buttons: showCrop ? [LANG('cropcopy-btn-copy'), LANG('cropcopy-btn-crop'), 'Cancel'] : [LANG('cropcopy-btn-copy'), 'Cancel'],\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                let rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\r\n                });\r\n            }\r\n            BB.removeEventListener(window, \"blur\", blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        }\r\n    });\r\n}","import {BB} from '../../../bb/bb';\r\nimport {popup} from '../modals/popup';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {Options} from '../base-components/options';\r\nimport {Select} from '../base-components/select';\r\nimport {PointSlider} from '../base-components/point-slider';\r\n// @ts-ignore\r\nimport addLayerImg from 'url:~/src/app/img/ui/add-layer.svg';\r\n// @ts-ignore\r\nimport duplicateLayerImg from 'url:~/src/app/img/ui/duplicate-layer.svg';\r\n// @ts-ignore\r\nimport mergeLayerImg from 'url:~/src/app/img/ui/merge-layers.svg';\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\n// @ts-ignore\r\nimport renameLayerImg from 'url:~/src/app/img/ui/rename-layer.svg';\r\nimport {KlCanvas, MAX_LAYERS} from '../../canvas/kl-canvas';\r\nimport {IMixMode} from '../../kl.types';\r\nimport {LANG} from '../../../language/language';\r\nimport {translateBlending} from '../../canvas/translate-blending';\r\n\r\n\r\nexport function klLayerManager(p_canvas: KlCanvas, p_func, p_rootDiv) {\r\n    let klCanvas: KlCanvas = p_canvas;\r\n    let layerElArr = [];\r\n    let layerHeight = 35;\r\n    let layerSpacing = 0;\r\n    let width = 250;\r\n    let oldHistoryState;\r\n    let updatefunc = p_func;\r\n    let uiState = 'right'; // 'left | 'right'\r\n\r\n\r\n    let largeThumbDiv = BB.el({\r\n        onClick: BB.handleClick,\r\n        css: {\r\n            position: \"absolute\",\r\n            right: \"280px\",\r\n            top: \"500px\",\r\n            background: \"#aaa\",\r\n            boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\r\n            pointerEvents: \"none\",\r\n            padding: '0',\r\n            border: \"1px solid #aaa\",\r\n            transition: \"opacity 0.3s ease-out\",\r\n            userSelect: 'none',\r\n            colorScheme: 'only light',\r\n        }\r\n    });\r\n    BB.createCheckerDataUrl(4, function(url) {\r\n        largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\r\n    });\r\n    let largeThumbCanvas = BB.canvas(200, 200);\r\n    largeThumbCanvas.style.display = \"block\";\r\n    largeThumbDiv.appendChild(largeThumbCanvas);\r\n    let largeThumbTimeout, largeThumbInTimeout;\r\n    let largeThumbInDocument = false;\r\n\r\n\r\n    let klCanvasLayerArr = klCanvas.getLayers();\r\n    let selectedSpotIndex = klCanvasLayerArr.length - 1;\r\n    let div = document.createElement(\"div\");\r\n    div.style.marginRight = \"10px\";\r\n    div.style.marginBottom = \"10px\";\r\n    div.style.marginLeft = \"10px\";\r\n    div.style.marginTop = \"10px\";\r\n    div.style.cursor = \"default\";\r\n\r\n    let listdiv = document.createElement(\"div\");\r\n    BB.css(listdiv, {\r\n        width: width + \"px\",\r\n        position: \"relative\"\r\n\r\n    });\r\n\r\n\r\n    function renameLayer(layer) {\r\n        let div = document.createElement('div');\r\n\r\n        let label = BB.el({\r\n            content: LANG('layers-rename-name') + ':',\r\n            css: {\r\n                marginRight: '5px'\r\n            }\r\n        });\r\n\r\n        const row = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            }\r\n        });\r\n        let input = document.createElement('input');\r\n        input.value = klCanvas.getLayer(layer).name;\r\n        input.setAttribute('data-ignore-focus', 'true');\r\n        const clearBtn = BB.el({\r\n            tagName: 'Button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n            title: LANG('layers-rename-clear'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: () => {\r\n                input.value = '';\r\n                input.focus();\r\n            }\r\n        });\r\n        const suggestions = [\r\n            LANG('layers-rename-sketch'),\r\n            LANG('layers-rename-colors'),\r\n            LANG('layers-rename-lines'),\r\n            LANG('background'),\r\n            LANG('layers-rename-foreground'),\r\n        ];\r\n        const suggestionBtns = [];\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginTop: '5px',\r\n                marginLeft: '-5px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        suggestions.forEach(item => {\r\n            const btn = BB.el({\r\n                parent: row2,\r\n                tagName: 'Button',\r\n                content: item,\r\n                onClick: () => {\r\n                    input.value = btn.textContent;\r\n                },\r\n                css: {\r\n                    margin: '5px 0 0 5px',\r\n                }\r\n            });\r\n            suggestionBtns.push(btn);\r\n        });\r\n\r\n        div.appendChild(label);\r\n        label.append(row, row2);\r\n        row.append(input, clearBtn);\r\n\r\n        setTimeout(function() {\r\n            input.focus();\r\n            input.select();\r\n        }, 10);\r\n\r\n        popup({\r\n            target: p_rootDiv,\r\n            message: `<b>${LANG('layers-rename-title')}</b>`,\r\n            div: div,\r\n            buttons: [LANG('layers-rename'), 'Cancel'],\r\n            primaries: [LANG('layers-rename')],\r\n            callback: function (val) {\r\n                BB.destroyEl(clearBtn);\r\n                suggestionBtns.forEach(item => {\r\n                    BB.destroyEl(item);\r\n                });\r\n                suggestionBtns.splice(0, suggestionBtns.length);\r\n                if (val === LANG('layers-rename')) {\r\n                    if (input.value === klCanvas.getLayer(layer).name) {\r\n                        return;\r\n                    }\r\n                    klCanvas.renameLayer(layer, input.value);\r\n                    createLayerList();\r\n                    klHistory.pause(true);\r\n                    updatefunc(layer);\r\n                    klHistory.pause(false);\r\n                }\r\n            },\r\n            clickOnEnter: LANG('layers-rename')\r\n        });\r\n    }\r\n\r\n\r\n    let layerListEl = BB.el({});\r\n\r\n    (div as any).disableButtons = function(){}; //probably remove\r\n    (div as any).enableButtons = function(){}; //probably remove\r\n    let addnewBtn = document.createElement(\"button\");\r\n    let duplicateBtn = document.createElement(\"button\");\r\n    let mergeBtn = document.createElement(\"button\");\r\n    let removeBtn = document.createElement(\"button\");\r\n    let renameBtn = document.createElement(\"button\");\r\n\r\n    function createButtons() {\r\n        let div = document.createElement(\"div\");\r\n        function async() {\r\n            BB.makeUnfocusable(addnewBtn);\r\n            BB.makeUnfocusable(duplicateBtn);\r\n            BB.makeUnfocusable(mergeBtn);\r\n            BB.makeUnfocusable(removeBtn);\r\n            BB.makeUnfocusable(renameBtn);\r\n\r\n            addnewBtn.style.cssFloat = 'left';\r\n            duplicateBtn.style.cssFloat = 'left';\r\n            mergeBtn.style.cssFloat = 'left';\r\n            removeBtn.style.cssFloat = 'left';\r\n            renameBtn.style.cssFloat = 'left';\r\n\r\n            addnewBtn.title = LANG('layers-new');\r\n            duplicateBtn.title = LANG('layers-duplicate');\r\n            removeBtn.title = LANG('layers-remove');\r\n            mergeBtn.title = LANG('layers-merge');\r\n            renameBtn.title = LANG('layers-rename-title');\r\n\r\n            addnewBtn.style.paddingLeft = \"5px\";\r\n            addnewBtn.style.paddingRight = \"3px\";\r\n\r\n            removeBtn.style.paddingLeft = \"5px\";\r\n            removeBtn.style.paddingRight = \"3px\";\r\n\r\n            duplicateBtn.style.paddingLeft = \"5px\";\r\n            duplicateBtn.style.paddingRight = \"3px\";\r\n\r\n            mergeBtn.style.paddingLeft = \"5px\";\r\n            mergeBtn.style.paddingRight = \"3px\";\r\n\r\n            renameBtn.style.height = \"30px\";\r\n            renameBtn.style.lineHeight = \"20px\";\r\n\r\n            addnewBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n            duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n            mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n            removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n            renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n            addnewBtn.style.marginRight = \"5px\";\r\n            removeBtn.style.marginRight = \"5px\";\r\n            duplicateBtn.style.marginRight = \"5px\";\r\n            mergeBtn.style.marginRight = \"5px\";\r\n            div.appendChild(addnewBtn);\r\n            div.appendChild(removeBtn);\r\n            div.appendChild(duplicateBtn);\r\n            div.appendChild(mergeBtn);\r\n            div.appendChild(renameBtn);\r\n            div.appendChild(BB.el({\r\n                css: {\r\n                    clear: 'both'\r\n                }\r\n            }));\r\n\r\n            let clearboth = document.createElement(\"div\");\r\n            clearboth.style.clear = \"both\";\r\n            clearboth.style.height = \"10px\";\r\n            div.appendChild(clearboth);\r\n\r\n\r\n            addnewBtn.onclick = function () {\r\n                if (klCanvas.addLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex = selectedSpotIndex + 1;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            duplicateBtn.onclick = function () {\r\n                if (klCanvas.duplicateLayer(selectedSpotIndex) === false) {\r\n                    return;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n                    addnewBtn.disabled = true;\r\n                    duplicateBtn.disabled = true;\r\n                }\r\n                removeBtn.disabled = false;\r\n                selectedSpotIndex++;\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n            };\r\n            removeBtn.onclick = function () {\r\n                if (layerElArr.length <= 1) {\r\n                    return;\r\n                }\r\n\r\n                klCanvas.removeLayer(selectedSpotIndex);\r\n                if (selectedSpotIndex > 0) {\r\n                    selectedSpotIndex--;\r\n                }\r\n                klCanvasLayerArr = klCanvas.getLayers();\r\n                createLayerList();\r\n                klHistory.pause(true);\r\n                updatefunc(selectedSpotIndex);\r\n                klHistory.pause(false);\r\n                if (klCanvasLayerArr.length === 1) {\r\n                    removeBtn.disabled = true;\r\n                }\r\n                if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                    addnewBtn.disabled = false;\r\n                    duplicateBtn.disabled = false;\r\n                }\r\n            };\r\n            mergeBtn.onclick = function () {\r\n                if (selectedSpotIndex <= 0) {\r\n                    return;\r\n                }\r\n\r\n                function mergeDialog(p) {\r\n                    let div = document.createElement(\"div\");\r\n                    div.innerHTML = LANG('layers-merge-description');\r\n\r\n                    let options = new Options({\r\n                        optionArr: [\r\n                            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n                            {id: 'source-in', label: 'source-in'},\r\n                            {id: 'source-out', label: 'source-out'},\r\n                            {id: 'source-atop', label: 'source-atop'},\r\n                            {id: 'destination-in', label: 'destination-in'},\r\n                            {id: 'destination-out', label: 'destination-out'},\r\n                            {id: 'destination-atop', label: 'destination-atop'},\r\n                            {id: 'xor', label: 'xor'}\r\n                        ],\r\n                        initId: p.mixModeStr,\r\n                        onChange: function(id) {\r\n                            update();\r\n                        },\r\n                        isSmall: true\r\n                    });\r\n                    options.getElement().style.marginTop = '5px';\r\n                    div.appendChild(options.getElement());\r\n\r\n                    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n                    let preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n                    preview.title = LANG('preview');\r\n                    let spacer = document.createElement(\"div\");\r\n                    spacer.innerHTML = \"<br/>\";\r\n                    spacer.style.clear = \"both\";\r\n                    div.appendChild(spacer);\r\n                    div.appendChild(preview);\r\n                    BB.css(preview, {\r\n                        display: \"block\",\r\n                        marginLeft: \"auto\",\r\n                        marginRight: \"auto\",\r\n                        colorScheme: 'only light',\r\n                    });\r\n                    preview.style.boxShadow = \"0 0 3px rgba(0,0,0,0.5)\";\r\n                    BB.createCheckerDataUrl(4, function(url) {\r\n                        preview.style.backgroundImage = \"url(\" + url + \")\";\r\n                    });\r\n\r\n                    let alphaCanvas = BB.copyCanvas(preview);\r\n                    alphaCanvas.getContext(\"2d\").drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n                    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n                    function update() {\r\n                        let ctx = preview.getContext(\"2d\");\r\n                        ctx.save();\r\n                        ctx.clearRect(0, 0, preview.width, preview.height);\r\n                        if (preview.width > p.topCanvas.width) {\r\n                            ctx.imageSmoothingEnabled = false;\r\n                        }\r\n                        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n                        if (options.getValue() === 'as-alpha') {\r\n                            ctx.globalCompositeOperation = 'destination-in';\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n                        } else {\r\n                            ctx.globalCompositeOperation = options.getValue();\r\n                            ctx.globalAlpha = p.topOpacity;\r\n                            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n                        }\r\n                        ctx.restore();\r\n                    }\r\n\r\n                    update();\r\n\r\n\r\n                    let keyListener = new BB.KeyListener({\r\n                        onDown: function(keyStr) {\r\n                            if (keyStr === 'right') {\r\n                                options.next();\r\n                            }\r\n                            if (keyStr === 'left') {\r\n                                options.previous();\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    popup({\r\n                        target: p_rootDiv,\r\n                        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n                        div: div,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (val) {\r\n                            keyListener.destroy();\r\n                            options.destroy();\r\n                            if (val === \"Ok\") {\r\n                                p.callback(options.getValue());\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                mergeDialog({\r\n                    topCanvas: klCanvasLayerArr[selectedSpotIndex].context.canvas,\r\n                    bottomCanvas: klCanvasLayerArr[selectedSpotIndex - 1].context.canvas,\r\n                    topOpacity: klCanvas.getLayer(selectedSpotIndex).opacity,\r\n                    mixModeStr: klCanvasLayerArr[selectedSpotIndex].mixModeStr,\r\n                    callback: function (mode) {\r\n                        klCanvas.mergeLayers(selectedSpotIndex, selectedSpotIndex - 1, mode);\r\n                        klCanvasLayerArr = klCanvas.getLayers();\r\n                        selectedSpotIndex--;\r\n                        if (klCanvasLayerArr.length === 1) {\r\n                            removeBtn.disabled = true;\r\n                        }\r\n                        if (klCanvasLayerArr.length < MAX_LAYERS) {\r\n                            addnewBtn.disabled = false;\r\n                            duplicateBtn.disabled = false;\r\n                        }\r\n                        createLayerList();\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                });\r\n            };\r\n\r\n            renameBtn.onclick = function () {\r\n                renameLayer(selectedSpotIndex);\r\n            };\r\n        }\r\n        setTimeout(async, 1);\r\n        return div;\r\n    }\r\n    div.appendChild(createButtons());\r\n\r\n    let modeWrapper;\r\n    let modeSelect;\r\n    {\r\n        modeWrapper = BB.el({\r\n            content: LANG('layers-blending') + '&nbsp;',\r\n            css: {\r\n                fontSize: '15px'\r\n            }\r\n        });\r\n\r\n        modeSelect = new Select({\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: IMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            onChange: function(val) {\r\n                klCanvas.setMixMode(selectedSpotIndex, val as IMixMode);\r\n                (div as any).update(selectedSpotIndex);\r\n            },\r\n            css: {\r\n                marginBottom: '10px'\r\n            }\r\n        });\r\n\r\n        modeWrapper.appendChild(modeSelect.getElement());\r\n        div.appendChild(modeWrapper);\r\n\r\n    }\r\n\r\n\r\n    function createLayerList() {\r\n        oldHistoryState = klHistory.getState();\r\n        function createLayerEntry(index) {\r\n            let layerName = klCanvas.getLayer(index).name;\r\n            let opacity = klCanvasLayerArr[index].opacity;\r\n            let layercanvas = klCanvasLayerArr[index].context.canvas;\r\n\r\n            let layer = document.createElement(\"div\");\r\n            layer.className = \"layerBox\";\r\n            layerElArr[index] = layer;\r\n            (layer as any).posY = ((klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                width: \"250px\",\r\n                height: \"34px\",\r\n                backgroundColor: \"rgb( 220, 220, 220)\",\r\n                border: \"1px solid #aaa\",\r\n                position: \"absolute\",\r\n                left: \"0 px\",\r\n                top: (layer as any).posY + \"px\",\r\n                transition: \"all 0.1s linear\",\r\n                borderRadius: \"5px\",\r\n                boxSizing: 'border-box'\r\n            });\r\n            let innerLayer = document.createElement(\"div\");\r\n            BB.css(innerLayer, {\r\n                position: \"relative\"\r\n            });\r\n\r\n            let container1 = document.createElement(\"div\");\r\n            BB.css(container1, {\r\n                width: \"250px\",\r\n                height: \"34px\"\r\n            });\r\n            let container2 = document.createElement(\"div\");\r\n            layer.appendChild(innerLayer);\r\n            innerLayer.appendChild(container1);\r\n            innerLayer.appendChild(container2);\r\n\r\n            (layer as any).spot = index;\r\n\r\n            //thumb\r\n            {\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                let thumb = (layer as any).thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                let thc = thumb.getContext(\"2d\");\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css((layer as any).thumb, {\r\n                    position: \"absolute\",\r\n                    left: ((32 - (layer as any).thumb.width) / 2) + \"px\",\r\n                    top: ((32 - (layer as any).thumb.height) / 2) + \"px\",\r\n                    colorScheme: 'only light',\r\n                });\r\n                BB.createCheckerDataUrl(4, function(url) {\r\n                    thumb.style.backgroundImage = \"url(\" + url + \")\";\r\n                });\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                (layer as any).label = document.createElement(\"div\");\r\n                (layer as any).lname = layerName;\r\n                (layer as any).label.append((layer as any).lname);\r\n\r\n                BB.css((layer as any).label, {\r\n                    position: \"absolute\",\r\n                    left: (1 + 32 + 5) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    width: \"170px\",\r\n                    height: \"20px\",\r\n                    overflow: \"hidden\",\r\n                    color: \"#666\",\r\n                    whiteSpace: 'nowrap'\r\n                });\r\n\r\n                (layer as any).label.ondblclick = function() {\r\n                    renameLayer((layer as any).spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                (layer as any).opacityLabel = document.createElement(\"div\");\r\n                (layer as any).opacity = opacity;\r\n                (layer as any).opacityLabel.append(parseInt('' + ((layer as any).opacity * 100)) + \"%\");\r\n\r\n                BB.css((layer as any).opacityLabel, {\r\n                    position: \"absolute\",\r\n                    left: (250 - 1 - 5 - 50) + \"px\",\r\n                    top: 1 + \"px\",\r\n                    fontSize: \"13px\",\r\n                    textAlign: \"right\",\r\n                    width: \"50px\",\r\n                    color: \"#666\",\r\n                    transition: \"color 0.2s ease-in-out\"\r\n                });\r\n            }\r\n\r\n            let oldOpacity;\r\n            let opacitySlider = new PointSlider({\r\n                init: (layer as any).opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: function(sliderValue, isFirst, isLast) {\r\n                    if (isFirst) {\r\n                        oldOpacity = klCanvas.getLayer((layer as any).spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    (layer as any).opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\r\n                    klCanvas.layerOpacity((layer as any).spot, sliderValue);\r\n                }\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px'\r\n            });\r\n            (layer as any).opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            BB.setEventListener((layer as any).thumb, 'onpointerover', function (e) {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                let thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (largeThumbCanvas.width !== thumbDimensions.width || largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    largeThumbCanvas.width = thumbDimensions.width;\r\n                    largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                let ctx = largeThumbCanvas.getContext(\"2d\");\r\n                ctx.save();\r\n                if (largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, largeThumbCanvas.width, largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(largeThumbDiv, {\r\n                    top: (e.clientY - largeThumbCanvas.height / 2) + \"px\",\r\n                    opacity: '0'\r\n                });\r\n                if (largeThumbInDocument === false) {\r\n                    p_rootDiv.appendChild(largeThumbDiv);\r\n                    largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(largeThumbInTimeout);\r\n                largeThumbInTimeout = setTimeout(function () {\r\n                    BB.css(largeThumbDiv, {\r\n                        opacity: '1'\r\n                    });\r\n                }, 20);\r\n                clearTimeout(largeThumbTimeout);\r\n            });\r\n            BB.setEventListener((layer as any).thumb, 'onpointerout', function () {\r\n                clearTimeout(largeThumbInTimeout);\r\n                BB.css(largeThumbDiv, {\r\n                    opacity: '0'\r\n                });\r\n                clearTimeout(largeThumbTimeout);\r\n                largeThumbTimeout = setTimeout(function () {\r\n                    if (!largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    p_rootDiv.removeChild(largeThumbDiv);\r\n                    largeThumbInDocument = false;\r\n                }, 300);\r\n            });\r\n\r\n            container1.appendChild((layer as any).thumb);\r\n            container1.appendChild((layer as any).label);\r\n            container1.appendChild((layer as any).opacityLabel);\r\n            container1.appendChild(opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            function dragEventHandler(event) {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: \"box-shadow 0.3s ease-in-out\"\r\n                    });\r\n                    //dragContainer.appendChild(layer);\r\n                    layer.style.zIndex = '1';\r\n                    lastpos = (layer as any).spot;\r\n                    freshSelection = false;\r\n                    if (!(layer as any).isSelected) {\r\n                        freshSelection = true;\r\n                        (div as any).activateLayer((layer as any).spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\r\n                        });\r\n                    }\r\n                    (layer as any).posY += event.dY;\r\n                    let corrected = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    layer.style.top = corrected + \"px\";\r\n                    updateLayersVerticalPosition((layer as any).spot, posToSpot((layer as any).posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: \"all 0.1s linear\"\r\n                    });\r\n                    setTimeout(function () {\r\n                        BB.css(layer, {\r\n                            boxShadow: \"\"\r\n                        });\r\n                    }, 20);\r\n                    (layer as any).posY = Math.max(0, Math.min((klCanvasLayerArr.length - 1) * (35), (layer as any).posY));\r\n                    //regularContainer.appendChild(layer);\r\n                    layer.style.zIndex = \"\";\r\n                    let newSpot = posToSpot((layer as any).posY);\r\n                    let oldSpot = (layer as any).spot;\r\n                    move((layer as any).spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        updatefunc(selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        updatefunc(selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            }\r\n\r\n            (layer as any).pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                maxPointers: 1,\r\n                onPointer: dragEventHandler\r\n            });\r\n\r\n            layerListEl.appendChild(layer);\r\n        }\r\n        layerElArr = [];\r\n        while (layerListEl.firstChild) {\r\n            let child = layerListEl.firstChild;\r\n            (child as any).pointerListener.destroy();\r\n            (child as any).opacitySlider.destroy();\r\n            layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        (div as any).activateLayer(selectedSpotIndex);\r\n        updateHeight();\r\n    }\r\n\r\n\r\n    listdiv.appendChild(layerListEl);\r\n    div.appendChild(listdiv);\r\n\r\n\r\n    function posToSpot(p) {\r\n        let result = parseInt('' + ((p) / (layerHeight + layerSpacing) + 0.5));\r\n        result = Math.min(klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    let lastpos = 0;\r\n\r\n    //update css position of all layers that are not being dragged, while dragging\r\n    function updateLayersVerticalPosition(id, newspot) {\r\n        newspot = Math.min(klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            if (layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = layerElArr[i].spot;\r\n            if (layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n            layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n        }\r\n        lastpos = newspot;\r\n    }\r\n\r\n    function move(oldSpotIndex, newSpotIndex) {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            (function (i) {\r\n                let posy = layerElArr[i].spot; // <- here\r\n                if (layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (layerElArr[i].spot > oldSpotIndex)\r\n                        posy--;\r\n                    if (posy >= newSpotIndex)\r\n                        posy++;\r\n                }\r\n                layerElArr[i].spot = posy;\r\n                layerElArr[i].posY = (layerHeight + layerSpacing) * (klCanvasLayerArr.length - posy - 1);\r\n                layerElArr[i].style.top = layerElArr[i].posY + \"px\";\r\n            }(i));\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        klCanvas.moveLayer(selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        selectedSpotIndex = newSpotIndex;\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    }\r\n\r\n\r\n    //updating the thumbs in interval\r\n    //don't update when: manager not visible || layer didn't change || is drawing\r\n    let updateThumbsInterval = setInterval(function() {\r\n        if (div.style.display !== \"block\") {\r\n            return;\r\n        }\r\n\r\n        let historyState = klHistory.getState();\r\n        if (historyState === oldHistoryState) {\r\n            return;\r\n        }\r\n        oldHistoryState = historyState;\r\n\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot && klCanvasLayerArr[layerElArr[i].spot]) { // second check, because might be out of date\r\n                let ctx = layerElArr[i].thumb.getContext(\"2d\");\r\n                ctx.save();\r\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                if (klCanvasLayerArr[layerElArr[i].spot].context.canvas.width < layerElArr[i].thumb.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.drawImage(klCanvasLayerArr[layerElArr[i].spot].context.canvas, 0, 0, layerElArr[i].thumb.width, layerElArr[i].thumb.height);\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n    }, 1);\r\n\r\n    function updateHeight() {\r\n        layerListEl.style.height = (layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    (div as any).update = function (activeLayerSpotIndex) {\r\n        klCanvasLayerArr = klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        removeBtn.disabled = klCanvasLayerArr.length === 1;\r\n        if (klCanvasLayerArr.length === MAX_LAYERS) {\r\n            addnewBtn.disabled = true;\r\n            duplicateBtn.disabled = true;\r\n        } else {\r\n            addnewBtn.disabled = false;\r\n            duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(function() {\r\n            createLayerList();\r\n        }, 1);\r\n    };\r\n    (div as any).getSelected = function () {\r\n        return selectedSpotIndex;\r\n    };\r\n    (div as any).activateLayer = function (spotIndex) {\r\n        if (spotIndex < 0 || spotIndex > layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + layerElArr.length;\r\n        }\r\n        selectedSpotIndex = spotIndex;\r\n        modeSelect.setValue(klCanvasLayerArr[selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < layerElArr.length; i++) {\r\n            if (selectedSpotIndex === layerElArr[i].spot) {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 250, 250, 250)\";\r\n                layerElArr[i].label.style.color = \"#000\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid var(--active-highlight-color)\";\r\n                layerElArr[i].opacitySlider.setActive(true);\r\n                layerElArr[i].isSelected = true;\r\n            } else {\r\n                layerElArr[i].style.backgroundColor = \"rgb( 220, 220, 220)\";\r\n                layerElArr[i].label.style.color = \"#666\";\r\n                layerElArr[i].style.boxShadow = \"\";\r\n                layerElArr[i].style.border = \"1px solid rgb(158, 158, 158)\";\r\n                layerElArr[i].opacitySlider.setActive(false);\r\n                layerElArr[i].isSelected = false;\r\n            }\r\n        }\r\n        mergeBtn.disabled = selectedSpotIndex === 0;\r\n    };\r\n    (div as any).setUiState = function(stateStr) {\r\n        uiState = '' + stateStr;\r\n\r\n        if (uiState === 'left') {\r\n            BB.css(largeThumbDiv, {\r\n                left: '280px',\r\n                right: ''\r\n            });\r\n        } else {\r\n            BB.css(largeThumbDiv, {\r\n                left: '',\r\n                right: '280px'\r\n            });\r\n        }\r\n    };\r\n\r\n    createLayerList();\r\n\r\n    return div;\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"93PHH\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"96Xkq\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hKRw5\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7jAPh\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"l0ZHH\");","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IKlProject, IMixMode, IRGB, IShapeToolObject} from '../kl.types';\r\nimport {DecoyKlHistory, KlHistoryInterface} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\n\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: IMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    },\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            }\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [].concat(params.projectObj.layers);\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: IMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                let item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                this.layerCanvasArr[i].getContext(\"2d\").drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + \" 1\";\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                this.layerCanvasArr[0].getContext(\"2d\").drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"reset\",\r\n            params: [p] // dont screw with p\r\n        });\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        let origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            let tmp1Ctx = tmp1.getContext('2d');\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                let layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                let layerContext = layerCanvas.getContext('2d');\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            let layerCanvas = this.layerCanvasArr[i];\r\n            let layerCtx = this.layerCanvasArr[i].getContext(\"2d\");\r\n            ctemp.getContext(\"2d\").drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"addLayer\",\r\n            params: [selected - 1]\r\n        });\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        let canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + \" \" + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        canvas.getContext(\"2d\").drawImage(this.layerCanvasArr[i], 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"duplicateLayer\",\r\n            params: [i]\r\n        });\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return this.layerCanvasArr[i].getContext(\"2d\");\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"removeLayer\",\r\n            params: [i]\r\n        });\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"renameLayer\",\r\n            params: [i, name]\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerOpacity\",\r\n            params: [i, o]\r\n        });\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: [\"canvas\"],\r\n                action: \"moveLayer\",\r\n                params: [i, d]\r\n            });\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: IMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            let temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        let topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            let ctx = this.layerCanvasArr[layerBottomIndex].getContext(\"2d\");\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                this.layerCanvasArr[layerBottomIndex].getContext(\"2d\").drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"mergeLayers\",\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr]\r\n        });\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0)\r\n            return;\r\n        let temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        let ctx = temp.getContext(\"2d\");\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        let temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        let tempCtx = temp.getContext(\"2d\");\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            this.layerCanvasArr[i].getContext(\"2d\").clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            this.layerCanvasArr[i].getContext(\"2d\").drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.appendChild(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.appendChild(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"layerFill\",\r\n            params: [layerIndex, colorObj, compositeOperation]\r\n        });\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB, // fill color\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: 'current' | 'all' | 'above',\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = srcCanvas.getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            let srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = this.layerCanvasArr[srcIndex].getContext('2d');\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : this.layerCanvasArr[layerIndex].getContext('2d');\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (opacity === 1) {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = rgb.r;\r\n                    targetData[i * 4 + 1] = rgb.g;\r\n                    targetData[i * 4 + 2] = rgb.b;\r\n                    targetData[i * 4 + 3] = 255;\r\n                }\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this.width * this.height; i++) {\r\n                if (result.data[i] === 255) {\r\n                    targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                    targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                    targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                    targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, targetImageData]\r\n        });\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        drawShape(this.layerCanvasArr[layerIndex].getContext(\"2d\"), shapeObj);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"drawShape\",\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        });\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"text\",\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        });\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"replaceLayer\",\r\n            params: [layerIndex, imageData],\r\n        });\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        let ctx = this.layerCanvasArr[layerIndex].getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"clearLayer\",\r\n            params: [layerIndex]\r\n        });\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: item.getContext(\"2d\"),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: IMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        id: number;\r\n    } {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: this.layerCanvasArr[index].getContext(\"2d\"),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        let ctx = this.pickCanvas.getContext(\"2d\");\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        let imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: IMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: [\"canvas\"],\r\n            action: \"setMixMode\",\r\n            params: [layerIndex, '' + mixModeStr],\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\n/**\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/ but it implemented tolerance wrong, and had bugs.\n * So, my own implementation. can handle tolerance, grow, opacity.\n * Needs to be optimized.\n */\n\n/**\n * Set values in data within rect to 254, unless they're 255\n *\n * @param data Uint8Array\n * @param width int\n * @param x0 int\n * @param y0 int\n * @param x1 int >x0\n * @param y1 int >y0\n */\nfunction fillRect(data, width, x0, y0, x1, y1) {\n    for (let x = x0; x <= x1; x++) {\n        for (let y = y0; y <= y1; y++) {\n            if (data[y * width + x] === 255) {\n                continue;\n            }\n            data[y * width + x] = 254;\n        }\n    }\n}\n\nlet mx, my;\n\n/**\n * Get index i moved by dX, dY. in array with dimensions width height.\n * Returns null if outside bounds.\n *\n * @param width int\n * @param height int\n * @param i int\n * @param dX int\n * @param dY int\n * @returns {null|*}\n */\nfunction moveIndex(width, height, i, dX, dY) {\n    mx = i % width + dX;\n    my = Math.floor(i / width) + dY;\n\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\n        return null;\n    }\n\n    return my * width + mx;\n}\n\n/**\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\n * returns false if already filled, or i is null\n *\n * @param srcArr Uint8Array rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param initRgba rgba\n * @param tolerance int 0 - 255\n * @param i int - srcArr index\n * @returns {boolean}\n */\nfunction testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\n    if (i === null || targetArr[i] === 255) {\n        return false;\n    }\n\n    if (\n        srcArr[i * 4] === initRgba[0] &&\n        srcArr[i * 4 + 1] === initRgba[1] &&\n        srcArr[i * 4 + 2] === initRgba[2] &&\n        srcArr[i * 4 + 3] === initRgba[3]\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    if (\n        tolerance > 0 &&\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    return false;\n}\n\n\n/**\n *\n * @param srcArr Uint8Array rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param px int\n * @param py int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nfunction floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\n\n    let initRgba = [\n        srcArr[(py * width + px) * 4],\n        srcArr[(py * width + px) * 4 + 1],\n        srcArr[(py * width + px) * 4 + 2],\n        srcArr[(py * width + px) * 4 + 3]\n    ];\n\n    if (isContiguous) {\n        let q = [];\n        q.push(py * width + px);\n        targetArr[py * width + px] = 255;\n\n        let i, e;\n        while (q.length) {\n            i = q.pop();\n\n            // queue up unfilled neighbors\n            e = moveIndex(width, height, i, -1, 0); // left\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 1, 0); // right\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 0, -1); // up\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n\n            e = moveIndex(width, height, i, 0, 1); // bottom\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n        }\n    } else {\n        for (let i = 0; i < width * height; i++) {\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\n        }\n    }\n\n\n    // grow\n    if (grow === 0) {\n        return;\n    }\n\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // the rectangle has the value 254, or else it mess it all up.\n    // after it's all done, replaces it with 255\n    let x0, x1, y0, y1;\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            if (targetArr[y * width + x] !== 255) {\n                continue;\n            }\n\n            // bounds of rectangle\n            x0 = x;\n            x1 = x;\n            y0 = y;\n            y1 = y;\n\n            l = targetArr[(y) * width + x - 1] !== 255;\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\n            t = targetArr[(y - 1) * width + x] !== 255;\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\n            r = targetArr[(y) * width + x + 1] !== 255;\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\n            b = targetArr[(y + 1) * width + x] !== 255;\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\n\n            if (l) { // left\n                x0 = x - grow;\n            }\n            if (l && tl && t) { // top left\n                x0 = x - grow;\n                y0 = y - grow;\n            }\n            if (t) { // top\n                y0 = Math.min(y0, y - grow);\n            }\n            if (t && tr && r) { // top right\n                y0 = Math.min(y0, y - grow);\n                x1 = x + grow;\n            }\n            if (r) { // right\n                x1 = Math.max(x1, x + 1 * grow);\n            }\n            if (r && br && b) { // bottom right\n                x1 = Math.max(x1, x + 1 * grow);\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n            if (b) { // bottom\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n            if (b && bl && l) { // bottom left\n                x0 = Math.min(x0, x - 1 * grow);\n                y1 = Math.max(y1, y + 1 * grow);\n            }\n\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\n                continue;\n            }\n\n            fillRect(\n                targetArr,\n                width,\n                Math.max(0, x0),\n                Math.max(0, y0),\n                Math.min(width - 1, x1),\n                Math.min(height - 1, y1)\n            );\n        }\n    }\n    for (let i = 0; i < width * height; i++) {\n        if (targetArr[i] === 254) {\n            targetArr[i] = 255;\n        }\n    }\n\n}\n\n\n/**\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\n *\n * returns {\n *     data: Uint8Array\n * }\n *\n * @param rgbaArr Uint8Array rgba\n * @param width int\n * @param height int\n * @param x int\n * @param y int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n * @returns {{data: Uint8Array}}\n */\nexport function floodFillBits(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\n    x = Math.round(x);\n    y = Math.round(y);\n\n    let resultArr = new Uint8Array(new ArrayBuffer(width * height));\n\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\n\n    return {\n        data: resultArr\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IShapeToolObject} from '../kl.types';\n\n\n/**\n * Input processor for shape tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n *\n * @param p - {onShape: func(isDone, x1, y1, x2, y2, angleRad)}\n * @constructor\n */\nexport function ShapeTool(p) {\n\n    let downX, downY, downAngleRad;\n\n    this.onDown = function(x, y, angleRad) {\n        downX = x;\n        downY = y;\n        downAngleRad = angleRad;\n    };\n\n    this.onMove = function(x, y) {\n        p.onShape(false, downX, downY, x, y, downAngleRad);\n    };\n\n    this.onUp = function(x, y) {\n        p.onShape(true, downX, downY, x, y, downAngleRad);\n    };\n}\n\n/**\n * Draw a shape (rectangle, ellipse, line)\n *\n * @param ctx\n * @param shapeObj\n */\nexport function drawShape(\n    ctx: CanvasRenderingContext2D,\n    shapeObj: IShapeToolObject,\n) {\n\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\n        const lineWidth = Math.round(shapeObj.lineWidth);\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\n\n        // --- prep canvas ---\n        ctx.save();\n        if (shapeObj.opacity) {\n            ctx.globalAlpha = shapeObj.opacity;\n        }\n        if (shapeObj.isEraser) {\n            ctx.globalCompositeOperation = 'destination-out';\n        }\n        ctx.rotate(-shapeObj.angleRad);\n        if (shapeObj.fillRgb) {\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(shapeObj.fillRgb);\n        } else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(shapeObj.strokeRgb);\n            ctx.lineWidth = lineWidth;\n        }\n\n        let x1 = shapeObj.x1;\n        let y1 = shapeObj.y1;\n        let x2 = shapeObj.x2;\n        let y2 = shapeObj.y2;\n\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            let r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n\n            let pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n            let pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            let rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n            x2 = rotated.x;\n            y2 = rotated.y;\n\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                    x2 = x1;\n                } else { // left or right\n                    y2 = y1;\n                }\n            }\n        }\n\n        let x = x1;\n        let y = y1;\n        let dX = x2 - x1;\n        let dY = y2 - y1;\n\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\n\n            let rx = r1.x;\n            let ry = r1.y;\n            let rdX = r2.x - r1.x;\n            let rdY = r2.y - r1.y;\n\n            if (Math.abs(rdX) < Math.abs(rdY)) {\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            } else {\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            }\n            r2.x = rx + rdX;\n            r2.y = ry + rdY;\n\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\n\n            x1 = r1.x;\n            y1 = r1.y;\n            x2 = r2.x;\n            y2 = r2.y;\n\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n\n        let p1;\n        let p2;\n        if (shapeObj.type === 'line') { // --- line ---\n\n            // rounded\n            const x1r = Math.round(x1);\n            const y1r = Math.round(y1);\n            const x2r = Math.round(x2);\n            const y2r = Math.round(y2);\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (lineWidth % 2 === 0) {\n\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r,\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r,\n                    };\n\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f,\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f,\n                    };\n\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1,\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2,\n                    };\n                }\n\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f,\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f,\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n\n        } else if (shapeObj.type === 'rect') { // --- rect ---\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) {\n                        x1 += 1;\n                    }\n                    if (y1 % 1 === 0) {\n                        y1 += 1;\n                    }\n                    if (x2 % 1 === 0) {\n                        x2 += 1;\n                    }\n                    if (y2 % 1 === 0) {\n                        y2 += 1;\n                    }\n\n                    p1 = {\n                        x: x1 < x2 ? x1f : x2f,\n                        y: y1 < y2 ? y1f : y2f,\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n\n                } else {\n                    if (lineWidth % 2 === 0) {\n                        p1 = {\n                            x: x1f,\n                            y: y1f,\n                        };\n                        p2 = {\n                            x: x2f,\n                            y: y2f,\n                        };\n                    } else {\n                        p1 = {\n                            x: x1f + 0.5,\n                            y: y1f + 0.5,\n                        };\n                        p2 = {\n                            x: x2f + 0.5,\n                            y: y2f + 0.5,\n                        };\n                    }\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1,\n                };\n                p2 = {\n                    x: x2,\n                    y: y2,\n                };\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            p2.x = p2.x - p1.x;\n            p2.y = p2.y - p1.y;\n\n            if (shapeObj.fillRgb) {\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\n            } else {\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\n            }\n\n        } else {  // --- circle ---\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n\n            ctx.beginPath();\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) {\n                ctx.fill();\n            } else {\n                ctx.stroke();\n            }\n        }\n\n\n        ctx.restore();\n\n    } else {\n        throw new Error('unknown shape');\n    }\n}","import {BB} from '../../bb/bb';\nimport {IRect} from '../../bb/bb.types';\n\nexport interface IRenderTextParam {\n    textStr: string; // text to be drawn. can contain newlines\n    x: number;\n    y: number;\n    size: number;\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\n    align: 'left' | 'center' | 'right'; // default 'left'\n    isBold: boolean; // default false\n    isItalic: boolean; // default false\n    angleRad: number; // default 0 - rotates around x y\n    lineHeight?: number; // pixels\n    color: string;\n    isDebug?: boolean;\n}\n\n\n/**\n * Draw text on a canvas.\n *\n * @param canvas\n * @param p\n * @returns - bounds. coords relative to p.x p.y\n */\nexport function renderText(canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\n\n    // always at least a space. so bounds aren't just a dot\n    let textStr = p.textStr === '' ? ' ' : p.textStr;\n\n    // --- create el ---\n    // create an actual dom element. figure out where exactly each letter is positioned.\n    // that way multiline is feasible. canvas can't do multiline or text-align\n    let outer = BB.el({\n        css: {\n            position: 'fixed',\n            left: '0',\n            top: '0',\n            width: '100000px',\n            fontSize: p.size + 'px',\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\n        }\n    });\n    let div = BB.el({\n        parent: outer,\n        css: {\n            display: 'inline-block',\n            textAlign: p.align ? p.align : 'left',\n            fontFamily: p.font ? p.font : 'sans-serif',\n            fontSize: p.size + 'px',\n            fontWeight: p.isBold ? 'bold' : 'normal',\n            fontStyle: p.isItalic ? 'italic' : 'normal',\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\n\n\n            opacity: '0',\n            pointerEvents: 'none'\n        }\n    });\n    let spanStr = '';\n    let replaceObj = {\n        \"\\n\": '<br>',\n        \" \": '&nbsp;',\n        \"\t\": '&nbsp;&nbsp;&nbsp;&nbsp;',\n    };\n    for (let i = 0; i < textStr.length; i++) {\n        if (textStr[i] === \"\\n\") {\n            div.appendChild(BB.el({\n                tagName: 'span',\n                textContent: spanStr,\n                css: {\n                    whiteSpace: 'pre'\n                }\n            }));\n            spanStr = '';\n            div.appendChild(BB.el({\n                tagName: 'br'\n            }));\n            continue;\n        }\n        spanStr += textStr[i].replace(\"\\t\", '    ');\n    }\n    div.appendChild(BB.el({\n        tagName: 'span',\n        textContent: spanStr,\n        css: {\n            whiteSpace: 'pre'\n        }\n    }));\n    document.body.appendChild(outer);\n\n\n    // --- determine bounds ---\n    let bounds = {\n        x0: 99999999,\n        y0: 99999999,\n        x1: 0,\n        y1: 0\n    }\n    for (let i = 0; i < div.children.length; i++) {\n        let el = div.children[i] as HTMLElement;\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\n    }\n\n    // --- draw ---\n    let ctx = canvas.getContext('2d');\n    ctx.save();\n\n    let font = [];\n    if (p.isItalic) {\n        font.push('italic');\n    }\n    if (p.isBold) {\n        font.push('bold');\n    }\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\n    ctx.font = font.join(' ');\n    ctx.fillStyle = p.color ? p.color : '#000';\n\n    let x = p.x;\n    let y = p.y;\n    if (p.align === 'right') {\n        x += -bounds.x1 + bounds.x0;\n    }\n    if (p.align === 'center') {\n        x += (-bounds.x1 + bounds.x0) / 2;\n    }\n    ctx.translate(p.x, p.y);\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\n    ctx.translate(-p.x, -p.y);\n    ctx.translate(x, y);\n\n    // fill\n    for (let i = 0; i < div.children.length; i++) {\n        let el = div.children[i] as HTMLElement;\n\n        //ctx.fillText(el.innerText, 0, 0);\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\n    }\n\n    if (p.isDebug) {\n        ctx.lineWidth = 1;\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\n        ctx.restore();\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\n    } else {\n        ctx.restore();\n    }\n\n    document.body.removeChild(outer);\n\n    return {\n        x: x - p.x,\n        y: y - p.y -p.size * 0.85,\n        width: bounds.x1 - bounds.x0,\n        height: bounds.y1 - bounds.y0\n    };\n}","import {BB} from '../../bb/bb';\nimport {IKlProject} from '../kl.types';\n\nexport function drawProject(project: IKlProject, factor) {\n    let resultCanvas = BB.canvas(\n        Math.max(1, Math.round(project.width * factor)),\n        Math.max(1, Math.round(project.height * factor))\n    );\n    let ctx = resultCanvas.getContext(\"2d\");\n    ctx.save();\n    if (factor > 1) {\n        ctx.imageSmoothingEnabled = false;\n    }\n    for (let i = 0; i < project.layers.length; i++) {\n        if (project.layers[i].opacity === 0) {\n            continue;\n        }\n        ctx.globalAlpha = project.layers[i].opacity;\n        ctx.globalCompositeOperation = project.layers[i].mixModeStr ? project.layers[i].mixModeStr : 'source-over';\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\n    }\n    ctx.restore();\n    return resultCanvas;\n}","import {IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {TTranslationCode} from '../../../languages/languages';\n\nexport function translateBlending(blendMode?: IMixMode): string {\n    if (!blendMode) {\n        return LANG('layers-blend-normal');\n    }\n\n    const codes: {\n        [key: string]: TTranslationCode\n    } = {\n        'source-over': 'layers-blend-normal',\n        'darken': 'layers-blend-darken',\n        'multiply': 'layers-blend-multiply',\n        'color-burn': 'layers-blend-color-burn',\n        'lighten': 'layers-blend-lighten',\n        'screen': 'layers-blend-screen',\n        'color-dodge': 'layers-blend-color-dodge',\n        'overlay': 'layers-blend-overlay',\n        'soft-light': 'layers-blend-soft-light',\n        'hard-light': 'layers-blend-hard-light',\n        'difference': 'layers-blend-difference',\n        'exclusion': 'layers-blend-exclusion',\n        'hue': 'layers-blend-hue',\n        'saturation': 'layers-blend-saturation',\n        'color': 'layers-blend-color',\n        'luminosity': 'layers-blend-luminosity',\n    };\n\n    if (!(blendMode in codes)) {\n        throw new Error('unknown blend mode');\n    }\n    return LANG(codes[blendMode]);\n}","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl.types';\n\n/**\n * Overlay for KlCanvasWorkspace.\n * - brush circle\n * - eyedropper circle\n * - compass needle (rotation hud)\n */\nexport class WorkspaceSvgOverlay {\n    private rootElement: SVGElement;\n    private brushCircleOuter: SVGElement;\n    private brushCircleInner: SVGElement;\n    private pickerPreviewBorder: SVGElement;\n    private pickerPreviewCol: SVGElement;\n    private readonly compassSize: number;\n    private compass: SVGElement;\n    private compassInner: SVGElement;\n    private compassBaseCircle: SVGElement;\n    private compassLineCircle: SVGElement;\n    private compassUpperTriangle: SVGElement;\n    private compassLowerTriangle: SVGElement;\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            width: number;\n            height: number;\n        }\n    ) {\n        this.rootElement = BB.createSvg({\n            elementType: 'svg',\n            width: '' + p.width,\n            height: '' + p.height,\n        });\n        BB.css(this.rootElement, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none',\n            userSelect: 'none'\n        });\n\n        //brush circles\n        this.brushCircleOuter = BB.createSvg({\n            elementType: 'circle',\n            r: '10',\n            stroke: 'rgba(0,0,0,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.brushCircleInner = BB.createSvg({\n            elementType: 'circle',\n            r: '9',\n            stroke: 'rgba(255,255,255,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\n\n        //color picker preview circle\n        this.pickerPreviewBorder = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '22',\n            fill: 'none',\n        });\n        this.pickerPreviewBorder.style.opacity = '0';\n        this.pickerPreviewCol = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '20',\n            fill: 'none',\n        });\n        this.pickerPreviewCol.style.opacity = '0';\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\n\n\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = BB.createSvg({\n            elementType: 'g',\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\n        });\n        BB.css(this.compass, {\n            transition: 'opacity 0.25s ease-in-out',\n            opacity: '0',\n        });\n        this.compassInner = BB.createSvg({\n            elementType: 'g',\n            transform: 'rotate(45)',\n        });\n        this.compassBaseCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'rgba(0,0,0,0.9)',\n            stroke: 'none',\n            cx: '0',\n            cy: '0',\n            r: '' + this.compassSize,\n        });\n        this.compassLineCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'none',\n            stroke: 'rgba(255,255,255,0.75)',\n            'stroke-width': '1',\n            cx: '0',\n            cy: '0',\n            r: '' + (this.compassSize * 0.9),\n        });\n        this.compassUpperTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#f00',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\n        });\n        this.compassLowerTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#fff',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\n        });\n\n        this.compassInner.append(\n            this.compassBaseCircle,\n            this.compassLineCircle,\n            this.compassUpperTriangle,\n            this.compassLowerTriangle\n        );\n        this.compass.append(this.compassInner);\n        this.rootElement.append(this.compass);\n    }\n\n    getElement (): SVGElement {\n        return this.rootElement;\n    }\n\n    setSize (width: number, height: number): void {\n        this.rootElement.setAttribute('width', '' + width);\n        this.rootElement.setAttribute('height', '' + height);\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\n    }\n\n    updateCursor (p: {\n        x?: number;\n        y?: number;\n        radius?: number;\n        isVisible?: boolean;\n    }): void {\n        if ('x' in p) {\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\n        }\n        if ('y' in p) {\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\n        }\n        if ('radius' in p) {\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\n        }\n        if ('isVisible' in p) {\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateColorPreview (p: {\n        x?: number;\n        y?: number;\n        color?: IRGB;\n        isVisible?: boolean;\n    }): void {\n        if ('x' in p) {\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\n        }\n        if ('y' in p) {\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\n        }\n        if ('color' in p) {\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\n            let borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\n        }\n        if ('isVisible' in p) {\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateCompass (p: {\n        angleDeg?: number;\n        isVisible?: boolean;\n    }): void {\n        if ('angleDeg' in p) {\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\n        }\n        if ('isVisible' in p) {\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, ITransform} from '../kl.types';\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\nimport {klHistory} from '../history/kl-history';\n// @ts-ignore\nimport pickerImg from 'url:~/src/app/img/ui/cursor-picker.png';\n// @ts-ignore\nimport zoomEwImg from 'url:~/src/app/img/ui/cursor-zoom-ew.png';\n// @ts-ignore\nimport fillImg from 'url:~/src/app/img/ui/cursor-fill.png';\n// @ts-ignore\nimport textImg from 'url:~/src/app/img/ui/cursor-text.png';\nimport {IPressureInput, IVector2D} from '../../bb/bb.types';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {KeyListener} from '../../bb/input/key-listener';\n\nexport interface IViewChangeEvent {\n    changed: ('scale' | 'angle')[];\n    angle: number;\n    scale: number;\n}\n\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'text'; // | 'transform' | 'select'\n\nconst MIN_SCALE = 1 / 16;\nconst MAX_SCALE = 64;\nenum TMode {\n    Draw,\n    Hand,\n    HandGrabbing,\n    Pick,\n    Zoom,\n    Rotate,\n    Rotating,\n    Fill,\n    Text,\n    Shape,\n}\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\n\n/**\n * Work area that displays the KlCanvas.\n * - pan, zoom, rotate (also via multi-touch)\n * - input modes: drawing, hand, pick, fill, text // transform, select\n * - drawing input events\n * - view change events\n * - eyedropper input events (pick)\n * - draws cursor, eyedropper overlay\n *\n * subscribes to klCanvas changes\n * listens to kl history for changes\n * and you can manually trigger redraw\n */\nexport class KlCanvasWorkspace {\n\n    private rootEl: HTMLElement;\n    private klCanvas: KlCanvas;\n    private renderTargetCanvas: HTMLCanvasElement;\n    private renderTargetCtx: CanvasRenderingContext2D;\n    private renderWidth: number;\n    private renderHeight: number;\n    private compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\n    private compositeCtx: CanvasRenderingContext2D;\n    private doResizeCanvas: boolean;\n    private oldTransformObj: ITransform;\n    private targetTransformObj: ITransform; // animation target\n    private highResTransformObj: ITransform; // animated, internal high res\n    private renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\n    private cursorPos: IVector2D;\n    private usesCssCursor: boolean;\n    private bgVisible: boolean;\n    private transformIsDirty: boolean;\n    private doAnimateTranslate: boolean;\n    private svgOverlay: WorkspaceSvgOverlay;\n    private emptyCanvas: HTMLCanvasElement;\n    private keyListener: KeyListener;\n    private currentMode: TMode;\n    private globalMode: TMode;\n    private renderTime: number; // for debugging - average ms per render()\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\n    private linetoolProcessor: any; // todo type - BB.EventChain.LinetoolProcessor\n    private pointer: IVector2D | null; // position of cursor\n    private isDrawing: boolean;\n    private inputProcessorObj: any; // todo type\n    private currentInputProcessor: any; // todo type\n    private angleIsExtraSticky: boolean;\n    private pinchZoomer: any; // todo type - BB.EventChain.PinchZoomer\n    private mainDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\n    private middleDoubleTapper: any; // todo type - BB.EventChain.DoubleTapper - todo docs\n    private twoFingerTap: any; // todo type - BB.EventChain.NFingerTapper\n    private threeFingerTap: any; // todo type - BB.EventChain.NFingerTapper\n    private pointerEventChain: any; // todo type - BB.EventChain.EventChain\n    private pointerListener: any; // todo type - BB.PointerListener\n    private brushRadius: number;\n    private animationFrameRequested: boolean;\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\n    private lastRenderTime: number; // ms from performance.now()\n    private hideBrushCursorTimeout: number;\n    private onViewChange: (e:  IViewChangeEvent) => void;\n\n    private getRenderedTransform (): ITransform {\n        // rounded x & y so canvas is less blurry.\n        const result = this.renderedTransformObj;\n        result.x = this.highResTransformObj.x;\n        result.y = this.highResTransformObj.y;\n        result.scale = this.highResTransformObj.scale;\n        result.angle = this.highResTransformObj.angle;\n\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\n            result.x = Math.round(result.x);\n            result.y = Math.round(result.y);\n        }\n\n        return result;\n    }\n\n    private updateChangeListener (): void {\n        this.klCanvas.addChangeListener(() => {\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n    }\n\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\n        if (modeInt === this.currentMode && !doForce) {\n            return;\n        }\n        const oldMode = this.currentMode;\n        this.currentMode = modeInt;\n        this.lastRenderedState = -1;\n        if (this.currentMode === TMode.Draw) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Hand) {\n            this.rootEl.style.cursor = 'grab';\n        } else if (this.currentMode === TMode.HandGrabbing) {\n            this.rootEl.style.cursor = 'grabbing';\n        } else if (this.currentMode === TMode.Pick) {\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\n        } else if (this.currentMode === TMode.Zoom) {\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\n        } else if (this.currentMode === TMode.Rotate) {\n            this.rootEl.style.cursor = \"grab\";\n        } else if (this.currentMode === TMode.Rotating) {\n            this.rootEl.style.cursor = \"grabbing\";\n        } else if (this.currentMode === TMode.Fill) {\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Text) {\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Shape) {\n            this.rootEl.style.cursor = 'crosshair';\n        }\n\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\n            if (!oldIsHand && currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n            }\n            if (oldIsHand && !currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n            }\n        }\n\n        if (this.currentMode !== TMode.Pick) {\n            this.svgOverlay.updateColorPreview({isVisible: false});\n        }\n    }\n\n    /**\n     * returns false if no change of zoom\n     * @param stepNum\n     * @param centerX\n     * @param centerY\n     * @private\n     */\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\n        const step = Math.log2(this.targetTransformObj.scale);\n\n        let newStep = step / Math.abs(stepNum);\n        newStep += stepNum > 0 ? 1 : -1;\n        newStep = Math.round(newStep);\n        newStep *= Math.abs(stepNum);\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\n\n        //has zoomed?\n        if (newScale === this.targetTransformObj.scale) {\n            return false;\n        }\n\n\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\n        this.targetTransformObj.scale = newScale;\n\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\n\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.transformIsDirty = true;\n\n        return true;\n    }\n\n    /**\n     * mixes two transform objects. modifies A\n     * @param transformA\n     * @param transformB\n     * @param blendFactor 0 -> A, 1 -> B\n     * @private\n     */\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\n        if (transformA.angle === transformB.angle) {\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n            return;\n        }\n\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        // --- determine centerPosA, centerPosB ---\n        const centerPosA = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformA);\n        const centerPosB = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformB);\n\n        // --- centerPosMixed ---\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\n\n        // --- scale and angle ---\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n\n        // --- x and y ---\n        const mixedPos = this.canvasToWorkspaceCoord({\n            x: -w / 2,\n            y: -h / 2\n        }, transformA);\n        transformA.x = mixedPos.x;\n        transformA.y = mixedPos.y;\n    }\n\n    private render (): void {\n        if (this.doResizeCanvas) {\n            this.doResizeCanvas = false;\n            this.renderTargetCanvas.width = this.renderWidth;\n            this.renderTargetCanvas.height = this.renderHeight;\n        }\n        this.renderContext(this.renderTargetCtx);\n    }\n\n    /**\n     * is the gray background that surrounds canvas visible?\n     * @private\n     */\n    private testBgVisible (): boolean {\n        //bring workspace points (corners of workspace) into canvas coordinate system\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\n\n        const workspacePointArr = [\n            [0, 0], // top left\n            [this.renderWidth, 0], // top right\n            [this.renderWidth, this.renderHeight], // bottom right\n            [0, this.renderHeight], // bottom left\n        ];\n\n        const art = this.getRenderedTransform();\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        //transform points, then test if outside of canvas\n        for (let i = 0; i < workspacePointArr.length; i++) {\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n            if (\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\n            ){\n                //if not inside -> bg visible\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private renderContext (ctx: CanvasRenderingContext2D): void {\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        const art = this.getRenderedTransform();\n\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\n            ctx.imageSmoothingEnabled = false;\n        } else {\n            ctx.imageSmoothingEnabled = true;\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\n        }\n        //ctx.imageSmoothingEnabled = false;\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\n\n\n\n        ctx.save();\n        {\n            if (this.bgVisible) {\n                ctx.fillStyle = 'rgb(158,158,158)'; // 'rgb(185,185,185)';\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\n            } else {\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\n            }\n\n\n\n            if (this.bgVisible) {\n                ctx.save();\n\n                ctx.translate(art.x, art.y);\n                ctx.scale(art.scale, art.scale);\n                ctx.rotate(art.angle);\n\n                ctx.imageSmoothingEnabled = false;\n\n                //outline\n                const borderSize = 1;\n                ctx.globalAlpha = 0.2;\n                ctx.drawImage(\n                    this.emptyCanvas,\n                    -borderSize / art.scale,\n                    -borderSize / art.scale,\n                    w + borderSize * 2 / art.scale,\n                    h + borderSize * 2 / art.scale\n                );\n                ctx.globalAlpha = 1;\n\n                //erase\n                ctx.globalCompositeOperation = 'destination-out';\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\n\n                ctx.restore();\n            }\n\n            /*const region = new Path2D();\n            region.rect(80, 10, 20, 130);\n            ctx.clip(region);*/\n\n            ctx.translate(art.x, art.y);\n            ctx.scale(art.scale, art.scale);\n            ctx.rotate(art.angle);\n\n            const layerArr = this.klCanvas.getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                if (layerArr[i].opacity > 0) {\n                    ctx.globalAlpha = layerArr[i].opacity;\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\n\n                    if (layerArr[i].canvas.compositeObj) {\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\n                        } else {\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\n                        }\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\n                    } else {\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\n                    }\n                }\n            }\n            ctx.globalAlpha = 1;\n\n\n\n        }\n        ctx.restore();\n\n        // rotation hud\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\n            this.svgOverlay.updateCompass({\n                isVisible: true,\n                angleDeg: art.angle / Math.PI * 180\n            });\n        } else {\n            this.svgOverlay.updateCompass({\n                isVisible: false\n            });\n        }\n    }\n\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\n        const art = this.getRenderedTransform();\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        let coords = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\n\n        let coords = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\n        let angleDeg = angleRad * 180 / Math.PI;\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\n\n        if (dist <= maxDistDeg) {\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n        }\n\n        return angleDeg / 180 * Math.PI;\n    }\n\n    /**\n     * angle always in range [-PI, PI]\n     * @param angleRad\n     * @private\n     */\n    private minimizeAngleRad (angleRad: number): number {\n        angleRad = angleRad % (2 * Math.PI);\n        if (angleRad > Math.PI) {\n            angleRad -= 2 * Math.PI;\n        } else if (angleRad < -Math.PI) {\n            angleRad += 2 * Math.PI;\n        }\n        return angleRad;\n    }\n\n    private resetInputProcessor (): void {\n        this.currentInputProcessor = null;\n        this.updateCursor(this.globalMode);\n        this.reqFrame(true);\n    }\n\n    private reqFrame (doRedrawCanvas?: boolean): void {\n        this.animationFrameRequested = true;\n        if (doRedrawCanvas) {\n            this.lastRenderedState = -1;\n        }\n    }\n\n    private updateLoop (): void {\n        window.requestAnimationFrame(() => this.updateLoop());\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState;\n\n        //handle variable framerate\n        const nowTime = performance.now();\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\n        this.lastRenderTime = nowTime;\n\n        if (this.animationFrameRequested || doRender) {\n            this.animationFrameRequested = false;\n            this.checkChange(elapsedFrames);\n        }\n    }\n\n    private checkChange (elapsedFrames: number): void {\n\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState ||\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\n            this.highResTransformObj.y !== this.targetTransformObj.y;\n\n        //update transform\n        if (\n            !this.doAnimateTranslate &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else if (\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            this. doAnimateTranslate = false;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else {\n            this.reqFrame(); //probably needs another frame\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\n            this.bgVisible = true; // spare yourself the calculation\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        }\n\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\n            this.svgOverlay.updateCursor({\n                x: this.pointer.x,\n                y: this.pointer.y,\n                isVisible: true\n            });\n        } else {\n            this.svgOverlay.updateCursor({isVisible: false});\n        }\n\n\n        if (doRender) {\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\n            this.lastRenderedState = newState;\n            const start = performance.now();\n            this.render();\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\n        }\n        //setTimeout(this.checkChange, 100);\n\n\n\n        if (doRender) {\n\n            //console.log('rendertime ms: ', this.renderTime);\n        }\n\n    }\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            klCanvas: any; // todo\n            width: number;\n            height: number;\n            onDraw: (val) => void; // todo\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\n            onFill: (canvasX: number, canvasY: number) => void;\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onViewChange: (e:  IViewChangeEvent) => void;\n            onUndo: () => void;\n            onRedo: () => void;\n        }\n    ) {\n        const _this = this;\n        this.rootEl = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                cursor: 'crosshair',\n                userSelect: 'none',\n                colorScheme: 'only light',\n            }\n        });\n        this.klCanvas = p.klCanvas;\n        this.onViewChange = p.onViewChange;\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\n        this.renderTargetCtx = this.renderTargetCanvas.getContext('2d');\n        this.renderWidth = p.width;\n        this.renderHeight = p.height;\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\n        this.compositeCtx = this.compositeCanvas.getContext('2d');\n        this.doResizeCanvas = false;\n        this.oldTransformObj = null;\n        this.targetTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.highResTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.renderedTransformObj = {\n            x: null,\n            y: null,\n            scale: null,\n            angle: null\n        };\n        this.cursorPos = {\n            x: 0,\n            y: 0\n        };\n        this.usesCssCursor = false;\n        this.bgVisible = true;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n\n        this.svgOverlay = new WorkspaceSvgOverlay({\n            width: p.width,\n            height: p.height\n        });\n\n        BB.css(this.renderTargetCanvas, {\n            userSelect: 'none',\n            pointerEvents: 'none',\n        });\n        BB.createCheckerDataUrl(8, (url) => {\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\n        });\n        this.rootEl.appendChild(this.renderTargetCanvas);\n        this.rootEl.appendChild(this.svgOverlay.getElement());\n        BB.addEventListener(this.rootEl, 'touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        BB.addEventListener(this.rootEl, 'contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        BB.addEventListener(this.rootEl, 'dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.emptyCanvas = BB.canvas(1, 1);\n        {\n            const ctx = this.emptyCanvas.getContext('2d');\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n                if (isRepeat) {\n                    return;\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n\n                } else {\n\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if (['r', 'shift+r'].includes(comboStr)) {\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ('z' === comboStr) {\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                }\n\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\n                }\n            }\n        });\n\n        this.updateChangeListener();\n\n        this.currentMode = TMode.Draw;\n        this.globalMode = TMode.Draw;\n\n        this.renderTime = 0;\n\n        this.lastDrawEvent = null;\n\n        this.linetoolProcessor = new BB.EventChain.LinetoolProcessor({\n            onDraw: (event) => {\n                const getMatrix = () => {\n                    const art = this.getRenderedTransform();\n                    let matrix = BB.Matrix.getIdentity();\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n                    return matrix;\n                };\n\n                if (event.type === 'line' && !this.lastDrawEvent) {\n                    const matrix = getMatrix();\n                    let coords = [event.x1, event.y1, 0, 1];\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    this.lastDrawEvent = {\n                        x: coords[0],\n                        y: coords[1],\n                        pressure: event.pressure1\n                    };\n                    return;\n                }\n\n                if ('x' in event || 'x0' in event) {\n\n                    const matrix = getMatrix();\n\n                    if ('x' in event) { //down or move\n                        let coords = [event.x, event.y, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x = coords[0];\n                        event.y = coords[1];\n                    }\n                    if ('x0' in event) { //line\n                        event.x0 = this.lastDrawEvent.x;\n                        event.y0 = this.lastDrawEvent.y;\n                        event.pressure0 = this.lastDrawEvent.pressure;\n                        let coords = [event.x1, event.y1, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x1 = coords[0];\n                        event.y1 = coords[1];\n\n                        this.lastDrawEvent = {\n                            x: event.x1,\n                            y: event.y1,\n                            pressure: event.pressure1,\n                        };\n                    }\n                }\n\n\n                if (['down', 'move'].includes(event.type)) {\n                    this.lastDrawEvent = event;\n                }\n                p.onDraw(event);\n            }\n        });\n\n        this.pointer = null;\n        this.isDrawing = false;\n\n\n        this.inputProcessorObj = {\n            draw: {\n                onPointer: (val) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Draw);\n\n                    const comboStr = this.keyListener.getComboStr();\n\n                    const event: any = {\n                        scale: this.highResTransformObj.scale\n                    };\n                    event.shiftIsPressed = comboStr === 'shift';\n                    event.pressure = val.pressure;\n                    event.isCoalesced = !!val.isCoalesced;\n\n                    if (val.type === 'pointerdown') {\n\n                        this.isDrawing = true;\n                        event.type = 'down';\n\n                    } else if (val.button) {\n                        event.type = 'move';\n\n                    } else if (val.type === 'pointerup') {\n\n                        this.isDrawing = false;\n                        event.type = 'up';\n\n                        this.linetoolProcessor.process(event);\n                        this.resetInputProcessor();\n                        return;\n                    } else {\n                        return;\n                    }\n\n                    event.x = val.relX;\n                    event.y = val.relY;\n\n                    this.linetoolProcessor.process(event);\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            fill: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Fill);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            text: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Text);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            shape: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Shape);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            hand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button)) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            spaceHand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button)) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'space') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            zoom: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Zoom);\n\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale\n                        });\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'z') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Zoom);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            picker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup'\n                        });\n\n                        if (event.type === 'pointerup') {\n                            this.resetInputProcessor();\n                        }\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                }\n            },\n            altPicker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup'\n                        });\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'alt') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                }\n            },\n            rotate: {\n                onPointer: (event) => {\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\n\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n                        //rotation done around center\n                        const centerObj = {\n                            x: this.renderWidth / 2,\n                            y: this.renderHeight / 2\n                        };\n\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\n                        let dAngleRad = angleRad - startAngleRad;\n\n                        //apply angle\n                        this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\n                        this.targetTransformObj.angle += dAngleRad;\n\n                        if (this.keyListener.isPressed('shift')) {\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n                        }\n\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\n\n                        //rotate transform.xy\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\n\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n\n                        this.transformIsDirty = true;\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['angle'],\n                            scale: this.targetTransformObj.scale,\n                            angle: this.targetTransformObj.angle\n                        });\n\n                    }\n                },\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                },\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    const comboStr = this.keyListener.getComboStr();\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                }\n            }\n        };\n        this.currentInputProcessor = null;\n\n\n        this.angleIsExtraSticky = false;\n        this.pinchZoomer = new BB.EventChain.PinchZoomer({\n            onPinch: (event) => {\n\n                if (event.type === 'move') {\n\n                    if (!this.oldTransformObj) {\n                        this.oldTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\n                    }\n\n                    this.targetTransformObj = JSON.parse(JSON.stringify(this.oldTransformObj));\n\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\n\n                    this.targetTransformObj.scale *= event.scale;\n                    this.targetTransformObj.angle += event.angleRad;\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\n                        this.snapAngleRad(\n                            this.targetTransformObj.angle,\n                            90,\n                            this.angleIsExtraSticky ? 12 : 4\n                        )\n                    );\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\n                        this.angleIsExtraSticky = false;\n                    }\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n\n                    //calc translation\n                    {\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\n\n\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                    }\n\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n\n                    //if (event.scale !== 1) {\n                    this.onViewChange({\n                        changed: ['scale', 'angle'],\n                        scale: this.targetTransformObj.scale,\n                        angle: this.targetTransformObj.angle\n                    });\n                    //}\n                    this.reqFrame();\n                    this.transformIsDirty = true;\n                    this.lastRenderedState = -1;\n\n\n                } else if (event.type === 'end') {\n                    this.oldTransformObj = null;\n                }\n\n\n            }\n        });\n\n        const onDoubleTap = () => {\n            let oldTransform = JSON.parse(JSON.stringify(this.targetTransformObj));\n            _this.fitView();\n            //_this.resetView(true);\n            this.lastRenderedState = -1;\n            this.reqFrame();\n\n            if (\n                oldTransform.scale !== this.targetTransformObj.scale ||\n                oldTransform.angle !== this.targetTransformObj.angle\n            ) {\n                this.onViewChange({\n                    changed: ['scale', 'angle'],\n                    angle: this.targetTransformObj.angle,\n                    scale: this.targetTransformObj.scale\n                });\n            }\n        }\n\n        this.mainDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper = new BB.EventChain.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\n\n\n        this.twoFingerTap = new BB.EventChain.NFingerTapper({\n            fingers: 2,\n            onTap: () => {\n                p.onUndo();\n            }\n        });\n        this.threeFingerTap = new BB.EventChain.NFingerTapper({\n            fingers: 3,\n            onTap: () => {\n                p.onRedo();\n            }\n        });\n\n\n        this.pointerEventChain = new BB.EventChain.EventChain({\n            chainArr: [\n                this.twoFingerTap,\n                this.threeFingerTap,\n                this.mainDoubleTapper,\n                this.middleDoubleTapper,\n                this.pinchZoomer,\n                new BB.EventChain.OnePointerLimiter(),\n                new BB.EventChain.CoalescedExploder()\n            ]\n        });\n        this.pointerEventChain.setChainOut((event) => {\n\n            this.cursorPos.x = event.relX;\n            this.cursorPos.y = event.relY;\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\n                this.pointer = null;\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                if (!this.pointer) {\n                    this.pointer = { x: 0, y: 0 };\n                }\n                this.pointer.x = event.relX;\n                this.pointer.y = event.relY;\n            }\n\n            if (this.currentInputProcessor) {\n                this.currentInputProcessor.onPointer(event);\n\n            } else {\n\n                let comboStr = this.keyListener.getComboStr();\n\n                if (this.globalMode === TMode.Draw) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Draw);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Hand) {\n\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n\n                } else if (this.globalMode === TMode.Pick) {\n\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n\n                } else if (this.globalMode === TMode.Fill) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Fill);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Text) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.text;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Text);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Shape) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Shape);\n                        this.reqFrame();\n                    }\n\n                }\n\n\n            }\n\n        });\n\n        //prevent ctrl scroll -> zooming page\n        BB.addEventListener(this.rootEl, 'wheel', (event) => {\n            event.preventDefault();\n        });\n\n\n        setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\n                        try {\n                            e.eventPreventDefault();\n                        } catch (e) {}\n                    }\n                    /*if (e.type === 'pointermove') {\n                        BB.throwOut(JSON.stringify(e));\n                    }*/\n\n                    this.pointerEventChain.chainIn(e)\n                },\n                onWheel: (wheelEvent) => {\n\n                    if (this.isDrawing) {\n                        return;\n                    }\n\n                    this.reqFrame();\n                    let didZoom = this.internalZoomByStep(\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\n                        wheelEvent.relX,\n                        wheelEvent.relY\n                    );\n                    if (didZoom) {\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale\n                        });\n                    }\n\n                    //updateCursor(TMode.Draw, true);\n                    this.lastRenderedState = -1;\n\n\n                },\n                onEnterLeave: (isOver) => {\n                    if (!isOver) {\n                        if (!this.isDrawing) {\n                            this.pointer = null;\n                            this.lastRenderedState = -1;\n                        }\n                    }\n                },\n                maxPointers: 4\n            });\n        }, 1);\n\n        this.brushRadius = 1;\n\n        this.animationFrameRequested = false;\n\n\n\n\n        //setup rendering\n        this.lastRenderedState = -2;\n        this.lastRenderTime = performance.now();\n\n        window.requestAnimationFrame(() => this.updateLoop());\n\n        this.resetView();\n    }\n\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setCanvas (klC: KlCanvas): void {\n        this.klCanvas = klC;\n        this.lastDrawEvent = null;\n        this.resetView();\n\n        this.updateChangeListener();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    /**\n     * set size of workspace area in pixels\n     * @param width\n     * @param height\n     */\n    setSize (width: number, height: number): void {\n        const oldWidth = this.renderWidth;\n        const oldHeight = this.renderHeight;\n\n        if (width === oldWidth && height === oldHeight) {\n            return;\n        }\n\n        this.doResizeCanvas = true;\n        this.renderWidth = width;\n        this.renderHeight = height;\n\n        this.svgOverlay.setSize(width, height);\n\n        this.targetTransformObj.x += (width - oldWidth) / 2;\n        this.targetTransformObj.y += (height - oldHeight) / 2;\n\n        this.highResTransformObj.x = this.targetTransformObj.x;\n        this.highResTransformObj.y = this.targetTransformObj.y;\n\n        this.bgVisible = this.testBgVisible();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setMode (modeStr: TModeStr): void {\n        //only sets the base mode\n        if (modeStr === 'draw') {\n            this.globalMode = TMode.Draw;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'fill') {\n            this.globalMode = TMode.Fill;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'text') {\n            this.globalMode = TMode.Text;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'shape') {\n            this.globalMode = TMode.Shape;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'hand') {\n            this.globalMode = TMode.Hand;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n        }\n        if (modeStr === 'pick') {\n            this.globalMode = TMode.Pick;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n    }\n\n    setEnabled (b: boolean): void {\n        // todo\n    }\n\n    setCursorSize (diameter: number): void {\n        this.brushRadius = diameter / 2;\n\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n\n        if (this.pointer === null) {\n            clearTimeout(this.hideBrushCursorTimeout);\n\n            this.svgOverlay.updateCursor({\n                x: this.renderWidth / 2,\n                y: this.renderHeight / 2,\n                isVisible: true\n            });\n\n            // @ts-ignore\n            this.hideBrushCursorTimeout = setTimeout(() => {\n                if (this.pointer !== null) {\n                    return;\n                }\n                this.svgOverlay.updateCursor({isVisible: false});\n            }, 500);\n        }\n    }\n\n    zoomByStep (stepNum: number): void {\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\n            return;\n        }\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale'],\n            angle: this.targetTransformObj.angle,\n            scale: this.targetTransformObj.scale\n        });\n    }\n\n    resetView (doAnimate?: boolean): void {\n        this.targetTransformObj.scale = 1;\n        this.targetTransformObj.angle = 0;\n\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\n\n        if (!doAnimate) {\n            this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n        } else {\n            this.doAnimateTranslate = true;\n            this.transformIsDirty = true;\n        }\n\n        this.bgVisible = this.testBgVisible();\n        this.reqFrame();\n\n        if (doAnimate) {\n            this.onViewChange({\n                changed: ['scale', 'angle'],\n                scale: this.targetTransformObj.scale,\n                angle: this.targetTransformObj.angle\n            });\n        }\n    }\n\n    fitView (): void {\n        //fit into view. center. keep angle. margin of 10px\n\n        //calc width and height of bounds\n        const canvasPointsArr = [\n            [0, 0], // top left\n            [this.klCanvas.getWidth(), 0], // top right\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\n            [0, this.klCanvas.getHeight()], // bottom left\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\n        ];\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle));\n\n        //rotate points\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n            canvasPointsArr[i][0] = coords[0];\n            canvasPointsArr[i][1] = coords[1];\n        }\n\n        const boundsObj = {\n            x0: null,\n            y0: null,\n            x1: null,\n            y1: null\n        };\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\n                boundsObj.x0 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\n                boundsObj.y0 = canvasPointsArr[i][1];\n            }\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\n                boundsObj.x1 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\n                boundsObj.y1 = canvasPointsArr[i][1];\n            }\n        }\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\n\n        //fit bounds\n        const padding = 40;\n        const { width: fitWidth } = BB.fitInto(\n            boundsWidth,\n            boundsHeight, \n            this.renderWidth - padding, \n            this.renderHeight - padding, \n            1\n        );\n\n        //determine scale\n        const factor = fitWidth / boundsWidth;\n\n        //center\n        this.targetTransformObj.x = (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor;\n        this.targetTransformObj.y = (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor;\n\n        this.targetTransformObj.scale = factor;\n        this.doAnimateTranslate = true;\n        this.transformIsDirty = true;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale', 'angle'],\n            scale: this.targetTransformObj.scale,\n            angle: this.targetTransformObj.angle\n        });\n    }\n\n    setAngle (angleDeg: number, isRelative?: boolean): void {\n        //rotation done around center\n        const centerObj = {\n            x: this.renderWidth / 2,\n            y: this.renderHeight / 2\n        };\n\n        const oldAngleRad = this.targetTransformObj.angle;\n        const angleRad = angleDeg / 180 * Math.PI;\n\n        if (isRelative) {\n            this.targetTransformObj.angle += angleRad;\n        } else {\n            this.targetTransformObj.angle = angleRad;\n        }\n\n        this.targetTransformObj.angle = this.minimizeAngleRad(\n            this.snapAngleRad(\n                this.targetTransformObj.angle,\n                90,\n                4\n            )\n        );\n\n        //rotate transform.xy\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.highResTransformObj = JSON.parse(JSON.stringify(this.targetTransformObj));\n        this.transformIsDirty = true;\n        this.reqFrame(true);\n    }\n\n    /**\n     * translate canvas by viewport pixels\n     * @param tx\n     * @param ty\n     */\n    translateView (tx: number, ty: number): void {\n        const scale = 40;\n\n        this.targetTransformObj.x += tx * scale;\n        this.targetTransformObj.y += ty * scale;\n\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.reqFrame(true);\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    getScale (): number {\n        return this.targetTransformObj.scale;\n    }\n\n    getAngleDeg (): number {\n        return this.targetTransformObj.angle * 180 / Math.PI;\n    }\n\n    getMaxScale (): number {\n        return MAX_SCALE;\n    }\n\n    getMinScale (): number {\n        return MIN_SCALE;\n    }\n\n    requestFrame (): void {\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\n        if (x === null) {\n            this.lastDrawEvent = null;\n            return;\n        }\n\n        if (!this.lastDrawEvent) {\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\n        }\n        this.lastDrawEvent.x = x;\n        this.lastDrawEvent.y = y;\n        this.lastDrawEvent.pressure = pressure;\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"avIaz\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"WOcXY\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"9OHR3\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1HTsX\");","import {BB} from '../../bb/bb';\nimport {IKlBasicLayer} from '../kl.types';\n\n/**\n * preview of image with layers. can do mix modes and opacity.\n * creates a canvas.\n *\n * p = {\n *     width: 123,\n *     height: 123,\n *     layers: [// can be changed after the fact\n *         {\n *             image: Canvas,\n *             opacity: 1,\n *             mixModeStr: 'source-over'\n *         }\n *     ]\n * }\n *\n * @param p\n * @constructor\n */\nexport function KlCanvasPreview(\n    p: {\n        width: number;\n        height: number;\n        layers: IKlBasicLayer[];\n    }\n) {\n    const scale = p.width / p.layers[0].image.width;\n    const width = scale > 1 ? p.layers[0].image.width : p.width;\n    const height = scale > 1 ? p.layers[0].image.height : p.height;\n\n    let canvas = BB.canvas(width, height);\n    canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8) + ')';\n    let ctx = canvas.getContext('2d');\n\n    BB.css(canvas, {\n        width: '100%',\n        height: '100%',\n        imageRendering: scale > 1 ? 'pixelated' : null,\n    });\n\n    function render() {\n        ctx.save();\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        for (let i = 0; i < p.layers.length; i++) {\n            ctx.globalAlpha = p.layers[i].opacity;\n            ctx.globalCompositeOperation = p.layers[i].mixModeStr;\n            if (canvas.width > p.layers[i].image.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(p.layers[i].image, 0, 0, canvas.width, canvas.height);\n        }\n        ctx.restore();\n    }\n\n    setTimeout(render, 0);\n\n    // --- interface ---\n    this.getElement = function() {\n        return canvas;\n    };\n\n    this.render = function() {\n        render();\n    };\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/cursor-rotate.png';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {IVector2D} from '../../../bb/bb.types';\n\nexport interface ITransform {\n    x: number; // center of transform region. image space\n    y: number;\n    width: number; // size of transform region. image space\n    height: number;\n    angleDeg: number; // angle of transform region. degrees\n}\n\n\n/**\n * snap entire transform to pixel grid. changes transform\n *\n * for x y:\n * If a dimension has an even size, it be an integer.\n * If it's uneven, it's sits exactly half way between two pixels.\n *\n * @param transform\n */\nfunction snapToPixel(transform: ITransform): void {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\n        return;\n    }\n\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0 is original orientation.\n    // At 90 and 270 width and height become swapped due to different orientation.\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\n}\n\nfunction copyTransform(transform: ITransform): ITransform {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg,\n    };\n}\n\n/**\n * image space to transform space\n * - origin of transform space is at center of transform bounds.\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\n * - up is where transform points up\n * - x goes right\n * - y goes down\n * @param x\n * @param y\n * @param transform\n */\nfunction toTransformSpace (x: number, y: number, transform: ITransform): IVector2D {\n    let px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: px, y: py},\n        -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n\n    return {\n        x: px,\n        y: py,\n    };\n}\n\n/**\n * transform space to image space\n * @param x\n * @param y\n * @param transform\n */\nfunction toImageSpace(x: number, y: number, transform: ITransform): IVector2D {\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: x, y: y},\n        transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y,\n    };\n}\n\n\n\n/**\n * Free Transform UI\n * rotate, scale, translate\n *\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\n *      - this is what complicates things\n * - if transform region small, corner grips move out of the way\n *\n * iX iY, iP.x, iP.y - i indicates image space\n * tX tY, tP.x, tP.y - t indicates transform space\n *\n * Not sure if can be used for navigable canvas. (especially if canvas rotates view)\n * Probably can't be extended for distort. Needs a different approach.\n *\n * --- DOM structure ---\n * rootEl {\n * \ttransEl [\n * \t\tboundsEl\n * \t\tedges[]\n * \t\tcorners[] - round grips in the corner of transform region\n * \t\tangleGrip\n * \t]\n * }\n *\n */\nexport class FreeTransform {\n\n    // --- private ---\n    private readonly transform: ITransform; // coordinates and dimensions of transformation\n    private isConstrained: boolean;\n    private ratio: number; // aspect ratio of transform\n    private readonly scale: number;\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        corners: [{x: 0, y: 0}], // in transform space\n    };\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\n    private snappingEnabled: boolean;\n    private readonly snapX: number[];\n    private readonly snapY: number[];\n    private readonly callback: (transform: ITransform) => void;\n\n\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n    private readonly gripSize = 14;\n    private readonly edgeSize = 10;\n\n    private readonly rootEl: HTMLElement; // sits at origin of image\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\n    private readonly corners: {\n        i: number; // index in corners array\n        el: HTMLElement; // draggable corner circle in DOM\n        x: number; // unscaled position (transform space)\n        y: number;\n        virtualPos: IVector2D; // unscaled temporary position (image space)\n        updateDOM: () => void; // update styling in DOM\n        pointerListener: any;\n    }[] = [];\n    private keyListener: KeyListener;\n    private boundsPointerListener: any; // BB.PointerListener\n    private anglePointerListener: any; // BB.PointerListener\n    private readonly edges: { // derive position from corners\n        el: HTMLElement;\n        updateDOM: () => void;\n        pointerListener: any;\n    }[] = [];\n    private readonly angleGrip: {\n        el: HTMLElement,\n        x: number; // transform space\n        y: number;\n        snap: boolean,\n        updateDOM: () => void,\n    };\n\n    private updateScaled(): void {\n        this.scaled.x = this.transform.x * this.scale;\n        this.scaled.y = this.transform.y * this.scale;\n        this.scaled.width = this.transform.width * this.scale;\n        this.scaled.height = this.transform.height * this.scale;\n        this.scaled.corners = this.corners.map((item) => {\n            return {x: item.x * this.scale, y: item.y * this.scale};\n        });\n    }\n\n    /**\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\n     * both in image space\n     *\n     * @param iX - image space\n     * @param iY - image space\n     * @private\n     */\n    private snapCorner (iX: number, iY: number): IVector2D {\n        if (!this.snappingEnabled) {\n            return {x: iX, y: iY};\n        }\n        let dist: number;\n        const snap: {\n            x: number;\n            y: number;\n            dist: {\n                x: number;\n                y: number;\n            }\n        } = {\n            x: null,\n            y: null,\n            dist: {\n                x: null,\n                y: null,\n            }\n        };\n        for (let e = 0; e < this.snapX.length; e++) {\n            dist = Math.abs(iX - this.snapX[e]);\n            if (dist < this.minSnapDist / this.scale) {\n                if (snap.x === null || dist < snap.dist.x) {\n                    snap.x = this.snapX[e];\n                    snap.dist.x = dist;\n                }\n            }\n        }\n        for (let e = 0; e < this.snapY.length; e++) {\n            dist = Math.abs(iY - this.snapY[e]);\n            if (dist < this.minSnapDist / this.scale) {\n                if (snap.y === null || dist < snap.dist.y) {\n                    snap.y = this.snapY[e];\n                    snap.dist.y = dist;\n                }\n            }\n        }\n\n        if (snap.x === null && snap.y === null) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        return {\n            x: snap.x ?? iX,\n            y: snap.y ?? iY,\n        };\n    }\n\n    /**\n     * If constrained return nearest corner pos that fits aspect ratio\n     *\n     * @param cornerIndex\n     * @param iX\n     * @param iY\n     * @private\n     */\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\n        if (!this.isConstrained) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\n        return BB.projectPointOnLine(\n            {x: this.transform.x, y: this.transform.y},\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\n            {x: iX, y: iY}\n        );\n    }\n\n    /**\n     * Update corners according to width height.\n     * Not their DOM.\n     */\n    private updateCornerPositions (): void {\n        this.corners[0].x = (-this.transform.width / 2); // top left\n        this.corners[0].y = (-this.transform.height / 2);\n\n        this.corners[1].x = (this.transform.width / 2); // top right\n        this.corners[1].y = (-this.transform.height / 2);\n\n        this.corners[2].x = (this.transform.width / 2); // bottom right\n        this.corners[2].y = (this.transform.height / 2);\n\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\n        this.corners[3].y = (this.transform.height / 2);\n    }\n\n    /**\n     * If constrained and dragging an edge, restore aspect ratio\n     * Updates corner positions.\n     *\n     * @param widthChanged\n     * @param heightChanged\n     * @private\n     */\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\n        if (!this.isConstrained) {\n            return;\n        }\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\n        if (heightChanged && !widthChanged) {\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n            let newWidth = this.ratio * newHeight;\n            if (angle90) {\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\n            }\n            if (this.corners[1].x - this.corners[0].x < 0) {\n                newWidth *= -1;\n            }\n            this.corners[0].x = -newWidth / 2;\n            this.corners[3].x = -newWidth / 2;\n            this.corners[1].x = newWidth / 2;\n            this.corners[2].x = newWidth / 2;\n        }\n        if (!heightChanged && widthChanged) {\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\n            let newHeight = newWidth / this.ratio;\n            if (angle90) {\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\n            }\n            if (this.corners[3].y - this.corners[0].y < 0) {\n                newHeight *= -1;\n            }\n            this.corners[0].y = -newHeight / 2;\n            this.corners[1].y = -newHeight / 2;\n            this.corners[2].y = newHeight / 2;\n            this.corners[3].y = newHeight / 2;\n        }\n    }\n\n\n    /**\n     * update transform based on corners\n     * @private\n     */\n    private updateTransformViaCorners (): void {\n\n        // calc transform center in image space\n        const rot = BB.rotateAround(\n            {x: 0, y: 0},\n            {\n                x: (this.corners[0].x + this.corners[1].x) / 2,\n                y: (this.corners[0].y + this.corners[3].y) / 2,\n            },\n            this.transform.angleDeg\n        );\n        this.transform.x = rot.x + this.transform.x;\n        this.transform.y = rot.y + this.transform.y;\n\n        // update size\n        this.transform.width = this.corners[1].x - this.corners[0].x;\n        this.transform.height = this.corners[3].y - this.corners[0].y;\n\n        // new center means corners changed their position\n        this.updateCornerPositions();\n\n        this.updateDOM();\n    }\n\n    /**\n     * updates DOM according to transform\n     * @param skipCallback\n     */\n    private updateDOM (skipCallback?: boolean) {\n        this.updateScaled();\n\n        BB.css(this.transEl, {\n            left: this.scaled.x + \"px\",\n            top: this.scaled.y + \"px\",\n            transformOrigin: \"0 0\",\n            transform: \"rotate(\" + this.transform.angleDeg + \"deg)\",\n        });\n\n        BB.css(this.boundsEl, {\n            width: Math.abs(this.scaled.width) + \"px\",\n            height: Math.abs(this.scaled.height) + \"px\",\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\n        });\n\n        this.corners[0].updateDOM();\n        this.corners[1].updateDOM();\n        this.corners[2].updateDOM();\n        this.corners[3].updateDOM();\n\n        this.edges[0].updateDOM();\n        this.edges[1].updateDOM();\n        this.edges[2].updateDOM();\n        this.edges[3].updateDOM();\n\n\n        this.angleGrip.x = 0;\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\n        this.angleGrip.updateDOM();\n        if (!skipCallback) {\n            if (this.callback) { // why should updateDOM trigger the callback?\n                this.callback(copyTransform(this.transform));\n            }\n        }\n    }\n\n\n\n    // --- public ---\n    constructor (\n        params: {\n            x: number; // center of transform region. image space\n            y: number;\n            width: number; // size of transform region. image space\n            height: number;\n            angleDeg: number; // angle of transform region. degrees\n\n            isConstrained: boolean; // proportions constrained\n            snapX: number[]; // where snapping along X axis. image space\n            snapY: number[]; // where snapping along X axis. image space\n            scale: number; // ratio of screen-space / image-space\n            callback: (transform: ITransform) => void;\n        }\n    ) {\n        this.transform = { // coordinates and dimensions of transformation\n            x: params.x,\n            y: params.y,\n            width: params.width,\n            height: params.height,\n            angleDeg: params.angleDeg,\n        };\n\n        this.isConstrained = !!params.isConstrained;\n\n        this.snapX = params.snapX;\n        this.snapY = params.snapY;\n        this.callback = params.callback;\n        this.scale = params.scale;\n        this.snappingEnabled = true;\n        this.ratio = this.transform.width / this.transform.height;\n\n        this.rootEl = BB.el({\n            className: 'kl-free-transform',\n            css: {\n                userSelect: 'none',\n            }\n        });\n        this.transEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n            }\n        });\n\n        this.boundsEl = BB.el({\n            css: {\n                position: 'absolute',\n                cursor: 'move',\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\n            }\n        });\n\n        const pointerRemainder = {\n            x: 0,\n            y: 0,\n        };\n        function resetRemainder() {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        }\n        this.keyListener = new BB.KeyListener({});\n\n        let boundsStartP = {\n            x: 0,\n            y: 0,\n        }\n        this.boundsPointerListener = new BB.PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointerdown') {\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\n                }\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\n\n\n                    let dist;\n                    let snap: any = {};\n                    if (this.snappingEnabled) {\n                        let i;\n                        for (i = 0; i < this.snapX.length; i++) {\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\n                            if (dist < this.minSnapDist / this.scale) {\n                                if (!snap.x || dist < snap.distX) {\n                                    snap.x = this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for (i = 0; i < this.snapY.length; i++) {\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\n                            if (dist < this.minSnapDist / this.scale) {\n                                if (!snap.y || dist < snap.distY) {\n                                    snap.y = this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n\n                        let iP;\n                        for (i = 0; i < 4; i++) {\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\n                            let j;\n                            for (j = 0; j < this.snapX.length; j++) {\n                                dist = Math.abs(iP.x - this.snapX[j]);\n                                if (dist < this.minSnapDist / this.scale) {\n                                    if (!snap.x || dist < snap.distX) {\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for (j = 0; j < this.snapY.length; j++) {\n                                dist = Math.abs(iP.y - this.snapY[j]);\n                                if (dist < this.minSnapDist / this.scale) {\n                                    if (!snap.y || dist < snap.distY) {\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        let projected = BB.projectPointOnLine(\n                            {x: 0, y: boundsStartP.y},\n                            {x: 10, y: boundsStartP.y},\n                            {x: this.transform.x, y: this.transform.y});\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        snap = {};\n                        snap.x = projected.x;\n                        snap.y = projected.y;\n                        snap.distX = dist;\n                        snap.distY = dist;\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: 0},\n                            {x: boundsStartP.x, y: 10},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\n                            {x: this.transform.x, y: this.transform.y});\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\n                        if (dist < snap.distX) {\n                            snap.x = projected.x;\n                            snap.y = projected.y;\n                            snap.distX = dist;\n                            snap.distY = dist;\n                        }\n                    }\n                    if (snap.x != undefined) {\n                        this.transform.x = snap.x;\n                    }\n                    if (snap.y != undefined) {\n                        this.transform.y = snap.y;\n                    }\n\n                    // snap to pixels\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                        snapToPixel(this.transform);\n                        this.updateCornerPositions();\n                    }\n\n                    this.updateDOM();\n                }\n            }\n        })\n\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = this.corners[i] = {\n                    i: i,\n                    el: BB.el({\n                        css: {\n                            width: this.gripSize + 'px',\n                            height: this.gripSize + 'px',\n                            background: '#fff',\n                            /*background: [\n                                '#ff0000',\n                                '#00ff00',\n                                '#0000ff',\n                                '#ff00ff',\n                            ][i],*/\n                            borderRadius: this.gripSize + 'px',\n                            position: 'absolute',\n                            boxShadow: 'inset 0 0 0 2px #000'\n                        }\n                    }),\n                    x: 0,\n                    y: 0,\n                    virtualPos: {\n                        x: 0,\n                        y: 0,\n                    },\n                    updateDOM: null,\n                    pointerListener: null,\n                };\n                g.updateDOM = () => {\n\n                    // grip position\n                    // if gets small, offset grips, so easier to handle\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\n                        return item;\n                    });\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\n\n                    BB.css(g.el, {\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px'\n                    });\n\n\n                    // cursor\n                    let angle = BB.pointsToAngleDeg(\n                        {\n                            x: this.transform.x,\n                            y: this.transform.y,\n                        },\n                        toImageSpace(g.x, g.y, this.transform),\n                    ) + 135; // offset so nw is 0\n                    while (angle < 0) {\n                        angle += 360;\n                    }\n                    let index = Math.round(angle / 45) % this.cornerCursors.length;\n                    BB.css(g.el, {\n                        cursor: this.cornerCursors[index] + '-resize',\n                    });\n                };\n\n                g.pointerListener = new BB.PointerListener({\n                    target: this.corners[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\n\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\n\n                            let iP = {\n                                x: this.corners[i].virtualPos.x,\n                                y: this.corners[i].virtualPos.y,\n                            };\n                            iP = this.constrainCorner(i, iP.x, iP.y);\n                            if (!this.isConstrained) {\n                                iP = this.snapCorner(iP.x, iP.y);\n                            }\n\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                                iP.x = Math.round(iP.x);\n                                iP.y = Math.round(iP.y);\n                            }\n\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\n\n                            const dX = tP.x - this.corners[i].x;\n                            const dY = tP.y - this.corners[i].y;\n                            this.corners[i].x = tP.x;\n                            this.corners[i].y = tP.y;\n\n                            let indexes = [];\n                            if (i === 0) { // top left\n                                indexes = [3, 1, 2];\n                            } else if (i === 1) { // top right\n                                indexes = [2, 0, 3];\n                            } else if (i === 2) { // bottom right\n                                indexes = [1, 3, 0];\n                            } else if (i === 3) { // bottom left\n                                indexes = [0, 2, 1];\n                            }\n\n                            this.corners[indexes[0]].x = this.corners[i].x;\n                            this.corners[indexes[1]].y = this.corners[i].y;\n                            if (this.keyListener.isPressed('shift')) {\n                                this.corners[indexes[2]].x -= dX;\n                                this.corners[indexes[2]].y -= dY;\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    }\n                });\n\n            })(i);\n        }\n\n        this.updateCornerPositions();\n        this.updateScaled();\n\n        let isInverted: boolean;\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                this.edges[i] = {\n                    el: BB.el({\n                        css: {\n                            width: this.edgeSize + 'px',\n                            height: this.edgeSize + 'px',\n                            /*background: [\n                                '#ff000044',\n                                '#00ff0044',\n                                '#0000ff44',\n                                '#ff00ff44',\n                            ][i],*/\n                            position: 'absolute',\n                        },\n                    }),\n                    updateDOM: null,\n                    pointerListener: null,\n                };\n                const g = this.edges[i];\n                g.updateDOM = () => {\n                    if (i === 0) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 1) {\n                        BB.css(g.el, {\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    } else if (i === 2) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 3) {\n                        BB.css(g.el, {\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    }\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\n                    while (angleOffset < 0)\n                        angleOffset += 8;\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\n\n                };\n\n                const isVertical = [0, 2].includes(i);\n                g.pointerListener = new BB.PointerListener({\n                    target: this.edges[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            if (isVertical) { // top bottom\n                                isInverted = this.corners[0].y >= this.corners[3].y;\n                            } else { // left right\n                                isInverted = this.corners[0].x >= this.corners[1].x;\n                            }\n                            resetRemainder();\n                        }\n                        if (event.type === 'pointermove' && event.button === 'left') {\n                            const tfD = BB.rotateAround({x: 0, y: 0},\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\n                                -this.transform.angleDeg);\n                            let ti = {\n                                dX: tfD.x,\n                                dY: tfD.y,\n                            };\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\n                            }\n\n                            let indexes = [];\n                            if (i === 0) { // top\n                                indexes = [2, 3, 0, 1];\n                            } else if (i === 1) { // right\n                                indexes = [0, 3, 1, 2];\n                            } else if (i === 2) { // bottom\n                                indexes = [0, 1, 2, 3];\n                            } else if (i === 3) { // left\n                                indexes = [1, 2, 0, 3];\n                            }\n\n                            let dimension = isVertical ? 'y' : 'x';\n                            let d = isVertical ? ti.dY : ti.dX;\n\n                            if (isInverted) {\n                                this.corners[indexes[0]][dimension] += d;\n                                this.corners[indexes[1]][dimension] += d;\n                            } else {\n                                this.corners[indexes[2]][dimension] += d;\n                                this.corners[indexes[3]][dimension] += d;\n                            }\n                            if (this.keyListener.isPressed('shift')) {\n                                if (isInverted) {\n                                    this.corners[indexes[2]][dimension] -= d;\n                                    this.corners[indexes[3]][dimension] -= d;\n                                } else {\n                                    this.corners[indexes[0]][dimension] -= d;\n                                    this.corners[indexes[1]][dimension] -= d;\n                                }\n                            }\n\n                            if (isVertical) { // top bottom\n                                this.restoreRatio(false, true);\n                            } else { // left right\n                                this.restoreRatio(true, false);\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    }\n                });\n\n            })(i);\n        }\n\n        this.angleGrip = {\n            el: BB.el({\n                css: {\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\n                    width: this.gripSize + 'px',\n                    height: this.gripSize + 'px',\n                    background: '#0ff',\n                    borderRadius: this.gripSize + 'px',\n                    position: 'absolute',\n                    boxShadow: 'inset 0 0 0 2px #000',\n                },\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: () => {\n                BB.css(this.angleGrip.el, {\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\n                });\n            },\n        };\n        BB.el({\n            parent: this.angleGrip.el,\n            css: {\n                width: '2px',\n                height: '13px',\n                left: (this.gripSize / 2 - 1) + 'px',\n                top: this.gripSize + 'px',\n                background: '#0ff',\n                position: 'absolute'\n            }\n        });\n\n        this.anglePointerListener = new BB.PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n\n                    const bounds = this.rootEl.getBoundingClientRect();\n                    const offset = {\n                        x: bounds.left - this.rootEl.scrollLeft,\n                        y: bounds.top - this.rootEl.scrollTop,\n                    };\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\n\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\n                    this.transform.angleDeg = a;\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        this.transform.angleDeg = snapDeg;\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\n                        this.transform.angleDeg = snapDeg;\n                    }\n                    this.updateDOM();\n\n                }\n                if (event.type === 'pointerup') {\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                        snapToPixel(this.transform);\n                        this.updateCornerPositions();\n                        this.updateDOM();\n                    }\n                }\n            }\n        });\n\n        snapToPixel(this.transform);\n        this.updateDOM(true);\n        BB.append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el,\n        ]);\n\n\n    }\n\n\n\n    getTransform (): ITransform {\n        return copyTransform(this.transform);\n    }\n\n    setConstrained (b: boolean): void {\n        this.isConstrained = !!b;\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\n        }\n    }\n\n    setSnapping (s: boolean): void {\n        this.snappingEnabled = !!s;\n    }\n\n    setPos (p: IVector2D): void {\n        this.transform.x = p.x;\n        this.transform.y = p.y;\n        this.updateDOM(true);\n    }\n\n    move (dX: number, dY: number): void {\n        this.transform.x += dX;\n        this.transform.y += dY;\n        this.updateDOM(false);\n    }\n\n    setSize (w: number, h: number): void {\n        this.transform.width = w;\n        this.transform.height = h;\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n            snapToPixel(this.transform);\n        }\n        this.updateCornerPositions();\n        this.updateDOM(false);\n    }\n\n    setAngleDeg (a: number): void {\n        this.transform.angleDeg = a;\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n            snapToPixel(this.transform);\n            this.updateCornerPositions();\n        }\n        this.updateDOM(true);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getRatio (): number {\n        return this.ratio;\n    }\n\n    destroy (): void {\n        this.keyListener.destroy();\n        this.boundsPointerListener.destroy();\n        this.corners[0].pointerListener.destroy();\n        this.corners[1].pointerListener.destroy();\n        this.corners[2].pointerListener.destroy();\n        this.corners[3].pointerListener.destroy();\n        this.edges[0].pointerListener.destroy();\n        this.edges[1].pointerListener.destroy();\n        this.edges[2].pointerListener.destroy();\n        this.edges[3].pointerListener.destroy();\n        this.anglePointerListener.destroy();\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"9KeA5\");","import {BB} from '../../../bb/bb';\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\nimport {FreeTransform} from './free-transform';\nimport {IKlBasicLayer, IMixMode} from '../../kl.types';\n\n/**\n * a basic canvas where you can transform one layer(move around, rotate, scale)\n *\n * @param params\n * @returns {HTMLDivElement}\n * @constructor\n */\nexport function FreeTransformCanvas(params: {\n    elementWidth: number;\n    elementHeight: number;\n    imageWidth: number;\n    imageHeight: number;\n    layers: IKlBasicLayer[];\n    transformIndex: number;\n}) {\n    /*\n    div\n        innerWrapper\n            klCanvasPreview\n            transform.div\n    */\n\n    let previewFit = BB.fitInto(\n        params.imageWidth,\n        params.imageHeight,\n        params.elementWidth - 20,\n        params.elementHeight - 60,\n        1\n    );\n    let scale = previewFit.width / params.imageWidth;\n\n    let div = BB.el({\n        css: {\n            width: params.elementWidth + \"px\",\n            height: params.elementHeight + \"px\",\n            backgroundColor: \"#9e9e9e\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            userSelect: \"none\",\n            position: \"relative\",\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        }\n    });\n    div.oncontextmenu = function () {\n        return false;\n    };\n\n    let innerWrapper = BB.el({\n        css: {\n            position: 'relative',\n            boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n            width: previewFit.width + 'px',\n            height: previewFit.height + 'px'\n        }\n    });\n    div.appendChild(innerWrapper);\n\n    let previewLayerArr = params.layers.map(item => {\n        return {\n            image: item.image,\n            mixModeStr: item.mixModeStr,\n            opacity: item.opacity,\n        }\n    });\n    previewLayerArr[previewLayerArr.length - 1].image = BB.canvas(\n        scale > 1 ? params.imageWidth : previewFit.width,\n        scale > 1 ? params.imageHeight : previewFit.height,\n    );\n    let klCanvasPreview = new KlCanvasPreview({\n        width: previewFit.width,\n        height: previewFit.height,\n        layers: previewLayerArr\n    });\n    innerWrapper.appendChild(klCanvasPreview.getElement());\n\n    let freeTransform;\n    let initTransform;\n    function updatePreview() {\n        if (!freeTransform) {\n            return;\n        }\n\n        let transform = freeTransform.getTransform();\n        if (scale < 1) {\n            transform.x *= scale;\n            transform.y *= scale;\n            transform.width *= scale;\n            transform.height *= scale;\n        }\n\n        let destCanvas = previewLayerArr[params.transformIndex].image;\n        let ctx = (destCanvas as HTMLCanvasElement).getContext('2d');\n        ctx.save();\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\n        BB.drawTransformedImageWithBounds(\n            ctx,\n            params.layers[params.transformIndex].image,\n            transform,\n            null,\n            BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n        );\n        ctx.restore();\n        klCanvasPreview.render();\n    }\n\n    {\n        let transformSize = {\n            width: params.layers[params.transformIndex].image.width * scale,\n            height: params.layers[params.transformIndex].image.height * scale\n        };\n        if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\n            transformSize = BB.fitInto(\n                params.layers[params.transformIndex].image.width,\n                params.layers[params.transformIndex].image.height,\n                previewFit.width,\n                previewFit.height,\n                1\n            );\n        }\n        initTransform = {\n            x: params.imageWidth / 2,\n            y: params.imageHeight / 2,\n            width: params.layers[params.transformIndex].image.width,\n            height: params.layers[params.transformIndex].image.height,\n        };\n        freeTransform = new FreeTransform({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: 0,\n            isConstrained: true,\n            snapX: [0, params.imageWidth],\n            snapY: [0, params.imageHeight],\n            scale: scale,\n            callback: (transform) => {\n                updatePreview();\n            },\n        });\n    }\n    BB.css(freeTransform.getElement(), {\n        position: 'absolute',\n        left: '0',\n        top: '0'\n    });\n    innerWrapper.appendChild(freeTransform.getElement());\n    setTimeout(updatePreview, 0);\n\n\n    // --- interface ---\n\n    this.move = function(dX, dY) {\n        freeTransform.move(dX, dY);\n    };\n    this.reset = function() {\n        let w = params.layers[params.transformIndex].image.width;\n        let h = params.layers[params.transformIndex].image.height;\n\n        freeTransform.setSize(w, h);\n        freeTransform.setPos({x: w / 2, y: h / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    this.setTransformFit = function() {\n\n        let fit = BB.fitInto(\n            params.layers[params.transformIndex].image.width,\n            params.layers[params.transformIndex].image.height,\n            params.imageWidth,\n            params.imageHeight,\n            1\n        );\n\n        freeTransform.setSize(fit.width, fit.height);\n        freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    this.setTransformCenter = function() {\n        freeTransform.setPos({x: params.imageWidth / 2, y: params.imageHeight / 2});\n        freeTransform.setAngleDeg(0);\n        updatePreview();\n    };\n    //gives you the transformation in the original scale\n    this.getTransformation = function () {\n        if (!freeTransform) {\n            return false;\n        }\n        return freeTransform.getTransform();\n    };\n    this.getIsPixelated = () => {\n        const transform = freeTransform.getTransform();\n        return BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height);\n    };\n    this.getElement = function() {\n        return div;\n    };\n    this.destroy = function() {\n        freeTransform.destroy();\n    };\n}","import {BB} from '../../../bb/bb';\n\n/*\n\tCropper params\n\t{\n\t\tx: int, //pos in relation zum bild\n\t\ty: int,\n\t\tw: int,\n\t\th: int,\n\t\tscale: float, //zoom\n\t\tcallback: function //wenn sich was ndert\n\t}\n\tthe div that you append this to must be relative\n*/\nexport function Cropper (params) {\n    let x = params.x,\n        y = params.y,\n        width = params.width,\n        height = params.height,\n        scale = params.scale,\n        callback = params.callback,\n        maxW = params.maxW,\n        maxH = params.maxH;\n    let div = document.createElement(\"div\");\n    let gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n\n    let keyListener = new BB.KeyListener({});\n\n    BB.css(div, {\n        position: \"absolute\",\n        left: (x * scale) + \"px\",\n        top: (y * scale) + \"px\"\n    });\n\n    let outline = document.createElement(\"div\");\n    BB.css(outline, {\n        position: \"absolute\",\n        border: \"1px dashed #fff\",\n        cursor: \"move\"\n    });\n    (outline as any).update = function () {\n        BB.css(outline, {\n            left: (grips[0].x * scale - 1) + \"px\",\n            top: (grips[0].y * scale - 1) + \"px\",\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\n        });\n    };\n    let pointerRemainder = { // needs to be reset after dragging complete\n        x: 0,\n        y: 0,\n    };\n    let outlinePointerListener = new BB.PointerListener({\n        target: outline,\n        onPointer: function(event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n\n                grips[0].x += dX;\n                grips[0].y += dY;\n                grips[1].x += dX;\n                grips[1].y += dY;\n                grips[2].x += dX;\n                grips[2].y += dY;\n                grips[3].x += dX;\n                grips[3].y += dY;\n\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n    let thirdsHorizontal = document.createElement(\"div\");\n    BB.css(thirdsHorizontal, {\n        position: \"absolute\",\n        borderTop: \"1px solid #0ff\",\n        borderBottom: \"1px solid #0ff\"\n    });\n    (thirdsHorizontal as any).update = function () {\n        BB.css(thirdsHorizontal, {\n            left: (grips[0].x * scale) + \"px\",\n            top: ((grips[0].y + (grips[2].y - grips[0].y) / 3) * scale) + \"px\",\n            width: ((grips[2].x - grips[0].x) * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) / 3 * scale) + \"px\"\n\n        });\n    };\n    let thirdsVertical = document.createElement(\"div\");\n    BB.css(thirdsVertical, {\n        position: \"absolute\",\n        borderLeft: \"1px solid #0ff\",\n        borderRight: \"1px solid #0ff\"\n    });\n    (thirdsVertical as any).update = function () {\n        BB.css(thirdsVertical, {\n            left: ((grips[0].x + (grips[2].x - grips[0].x) / 3) * scale) + \"px\",\n            top: (grips[0].y * scale) + \"px\",\n            width: ((grips[2].x - grips[0].x) / 3 * scale) + \"px\",\n            height: ((grips[2].y - grips[0].y) * scale) + \"px\"\n\n        });\n    };\n\n    const gripSize = 40;\n    const gripOverlay = 10;\n\n    let grips: {\n        x: number; // int\n        y: number;\n    }[] = [ // aka corner coordinates\n        {x: 0, y: 0}, // top left\n        {x: width, y: 0}, // top right\n        {x: width, y: height}, // bottom right\n        {x: 0, y: height}, //bottom left\n    ];\n\n    function transformTop(dY) {\n        grips[0].y += dY;\n        grips[0].y = Math.max(grips[3].y - maxH, Math.min(grips[3].y - 1, grips[0].y));\n        grips[1].y = grips[0].y;\n    }\n    function transformRight(dX) {\n        grips[1].x += dX;\n        grips[1].x = Math.min(grips[0].x + maxW, Math.max(grips[0].x + 1, grips[1].x));\n        grips[2].x = grips[1].x;\n    }\n    function transformBottom(dY) {\n        grips[2].y += dY;\n        grips[2].y = Math.min(grips[1].y + maxH, Math.max(grips[1].y + 1, grips[2].y));\n        grips[3].y = grips[2].y;\n    }\n    function transformLeft(dX) {\n        grips[0].x += dX;\n        grips[0].x = Math.max(grips[1].x - maxW, Math.min(grips[1].x - 1, grips[0].x));\n        grips[3].x = grips[0].x;\n    }\n\n    function commit() {\n        pointerRemainder.x = 0;\n        pointerRemainder.y = 0;\n        callback(getTransform());\n    }\n\n\n\n\n    let edges = [];\n    for (let i = 0; i < 4; i++) {\n        (function (i) {\n            edges[i] = document.createElement(\"div\");\n            let g = edges[i];\n            g.style.width = gripSize + \"px\";\n            g.style.height = gripSize + \"px\";\n            //g.style.background = \"#0f0\";\n            g.style.position = \"absolute\";\n            g.update = function () {\n                if (i === 0) { //top\n                    g.style.left = (grips[0].x * scale + gripOverlay) + \"px\";\n                    g.style.top = (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\";\n                    g.style.width = ((grips[1].x - grips[0].x) * scale - gripOverlay * 2) + \"px\";\n                    g.style.height = (gripSize * 2) + \"px\";\n                } else if (i === 1) { //right\n                    g.style.left = (grips[1].x * scale - gripOverlay) + \"px\";\n                    g.style.top = (grips[1].y * scale + gripOverlay) + \"px\";\n                    g.style.width = (gripSize * 2) + \"px\";\n                    g.style.height = ((grips[2].y - grips[1].y) * scale - gripOverlay * 2) + \"px\";\n                } else if (i === 2) { //bottom\n                    g.style.left = (grips[3].x * scale + gripOverlay) + \"px\";\n                    g.style.top = (grips[3].y * scale - gripOverlay) + \"px\";\n                    g.style.width = ((grips[2].x - grips[3].x) * scale - gripOverlay * 2) + \"px\";\n                    g.style.height = (gripSize * 2) + \"px\";\n                } else if (i === 3) { //left\n                    g.style.left = (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\";\n                    g.style.top = (grips[0].y * scale + gripOverlay) + \"px\";\n                    g.style.width = (gripSize * 2) + \"px\";\n                    g.style.height = ((grips[3].y - grips[0].y) * scale - gripOverlay * 2) + \"px\";\n                }\n                let angleOffset = i * 2 + 1;\n                g.style.cursor = gripCursors[angleOffset] + \"-resize\";\n\n            };\n        })(i);\n    }\n\n    let darken = [];\n    for (let i = 0; i < 4; i++) {\n        (function (i) {\n            darken[i] = document.createElement(\"div\");\n            let g = darken[i];\n            g.style.position = \"absolute\";\n            g.style.background = \"#000\";\n            g.style.opacity = \"0.5\";\n            g.update = function () {\n                if (i === 0) {\n                    g.style.left = (grips[0].x * scale) + \"px\";\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\n                    g.style.width = ((grips[1].x - grips[0].x) * scale) + \"px\";\n                    g.style.height = \"8000px\";\n                } else if (i === 1) {\n                    g.style.left = (grips[1].x * scale) + \"px\";\n                    g.style.top = (grips[1].y * scale - 8000) + \"px\";\n                    g.style.width = \"8000px\";\n                    g.style.height = 16000 + \"px\";\n                } else if (i === 2) {\n                    g.style.left = (grips[3].x * scale) + \"px\";\n                    g.style.top = (grips[3].y * scale) + \"px\";\n                    g.style.width = ((grips[2].x - grips[3].x) * scale) + \"px\";\n                    g.style.height = \"8000px\";\n                } else if (i === 3) {\n                    g.style.left = (grips[0].x * scale - 8000) + \"px\";\n                    g.style.top = (grips[0].y * scale - 8000) + \"px\";\n                    g.style.width = \"8000px\";\n                    g.style.height = 16000 + \"px\";\n                }\n\n            };\n        })(i);\n    }\n\n    let edge0PointerListener = new BB.PointerListener({\n        target: edges[0],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge1PointerListener = new BB.PointerListener({\n        target: edges[1],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge2PointerListener = new BB.PointerListener({\n        target: edges[2],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    let edge3PointerListener = new BB.PointerListener({\n        target: edges[3],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n\n    let cornerElArr = [];\n    (function() {\n        for (let i = 0; i < 4; i++) {\n            (function (i) {\n                cornerElArr[i] = document.createElement(\"div\");\n                let g = cornerElArr[i];\n                BB.css(g, {\n                    //background: '#f00',\n                    width: (gripSize * 2) + 'px',\n                    height: (gripSize * 2) + 'px',\n                    position: 'absolute'\n                });\n                g.style.cursor = ['nwse-resize', 'nesw-resize'][i % 2];\n                g.update = function () {\n                    if (i === 0) { //top left\n                        BB.css(g, {\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\n                            top: (grips[0].y * scale - gripSize * 2 + gripOverlay) + \"px\"\n                        });\n                    } else if (i === 1) { //top right\n                        BB.css(g, {\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\n                            top: (grips[1].y * scale - gripSize * 2 + gripOverlay) + \"px\"\n                        });\n                    } else if (i === 2) { //bottom right\n                        BB.css(g, {\n                            left: (grips[1].x * scale - gripOverlay) + \"px\",\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\n                        });\n                    } else if (i === 3) { //bottom left\n                        BB.css(g, {\n                            left: (grips[0].x * scale - gripSize * 2 + gripOverlay) + \"px\",\n                            top: (grips[2].y * scale - gripOverlay) + \"px\"\n                        });\n                    }\n                };\n            })(i);\n        }\n    })();\n    //top left\n    let corner0PointerListener = new BB.PointerListener({\n        target: cornerElArr[0],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //top right\n    let corner1PointerListener = new BB.PointerListener({\n        target: cornerElArr[1],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                transformTop(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                    transformBottom(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //bottom right\n    let corner2PointerListener = new BB.PointerListener({\n        target: cornerElArr[2],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformRight(dX);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformLeft(-dX);\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n    //bottom left\n    let corner3PointerListener = new BB.PointerListener({\n        target: cornerElArr[3],\n        fixScribble: true,\n        onPointer: function (event) {\n            event.eventPreventDefault();\n            if (event.type === 'pointermove' && event.button === 'left') {\n                const {dX, dY} = BB.intDxy(pointerRemainder, event.dX / scale, event.dY / scale);\n                transformLeft(dX);\n                transformBottom(dY);\n                if (keyListener.isPressed('shift')) {\n                    transformRight(-dX);\n                    transformTop(-dY);\n                }\n                update();\n            }\n            if (event.type === 'pointerup') {\n                commit();\n            }\n        }\n    });\n\n\n\n\n    function getTransform() {\n        grips[1].x -= grips[0].x;\n        grips[1].y -= grips[0].y;\n        grips[2].x -= grips[0].x;\n        grips[2].y -= grips[0].y;\n        grips[3].x -= grips[0].x;\n        grips[3].y -= grips[0].y;\n        x += grips[0].x;\n        y += grips[0].y;\n        grips[0].x = 0;\n        grips[0].y = 0;\n        return {\n            x: x,\n            y: y,\n            width: grips[1].x,\n            height: grips[2].y\n        };\n    }\n\n\n    div.append(\n        darken[1],\n        darken[0],\n        darken[2],\n        darken[3],\n        thirdsHorizontal,\n        thirdsVertical,\n        outline,\n\n        edges[1],\n        edges[0],\n        edges[2],\n        edges[3],\n\n        cornerElArr[0],\n        cornerElArr[1],\n        cornerElArr[2],\n        cornerElArr[3],\n    );\n\n\n    function update() {\n\n        edges[0].update();\n        edges[1].update();\n        edges[2].update();\n        edges[3].update();\n        cornerElArr[0].update();\n        cornerElArr[1].update();\n        cornerElArr[2].update();\n        cornerElArr[3].update();\n        darken[0].update();\n        darken[1].update();\n        darken[2].update();\n        darken[3].update();\n        (outline as any).update();\n        (thirdsHorizontal as any).update();\n        (thirdsVertical as any).update();\n    }\n\n    update();\n\n\n    // --- interface ---\n\n    this.getTransform = getTransform;\n\n    this.setTransform = function (p) {\n        x = p.x;\n        y = p.y;\n        width = p.width;\n        height = p.height;\n\n        BB.css(div, {\n            left: (x * scale) + \"px\",\n            top: (y * scale) + \"px\"\n        });\n\n        grips[0].x = 0;\n        grips[0].y = 0;\n        grips[1].x = width;\n        grips[1].y = 0;\n        grips[2].x = width;\n        grips[2].y = height;\n        grips[3].x = 0;\n        grips[3].y = height;\n\n        update();\n        commit();\n    };\n\n    this.setScale = function (s) {\n        scale = s;\n        BB.css(div, {\n            left: (x * scale) + \"px\",\n            top: (y * scale) + \"px\"\n        });\n        update();\n    };\n\n    this.showThirds = function (b) {\n        if (b) {\n            thirdsHorizontal.style.display = \"block\";\n            thirdsVertical.style.display = \"block\";\n        } else {\n            thirdsHorizontal.style.display = \"none\";\n            thirdsVertical.style.display = \"none\";\n        }\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.destroy = function() {\n        keyListener.destroy();\n        outlinePointerListener.destroy();\n        corner0PointerListener.destroy();\n        corner1PointerListener.destroy();\n        corner2PointerListener.destroy();\n        corner3PointerListener.destroy();\n        edge0PointerListener.destroy();\n        edge1PointerListener.destroy();\n        edge2PointerListener.destroy();\n        edge3PointerListener.destroy();\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {klHistory} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\n\n/**\n * Previews currently active layer\n * thumbnail (hover shows bigger preview), layername, opacity\n *\n * internally listens to kl history. updates when there's a change.\n * but you need to update it when the active layer changed. (different canvas object)\n *\n * update visibility for performance\n *\n * p = {\n *     onClick: function() // when clicking on layer name\n *     klRootEl: klRootEl,\n * }\n *\n * @param p\n * @constructor\n */\nexport function LayerPreview(p) {\n\n    // internally redraws with in an interval. checks history is something changed\n    // this update will be animated\n    // it will not be animated if the resolution changed\n    // also redraws when you call updateLayer - not animated\n\n    // syncs via updateLayer, and internally updates layer opacity via a hack\n\n    let div = BB.el({});\n    let layerObj;\n    let isVisible = true;\n    const height = 40;\n    const canvasSize = height - 10;\n    const largeCanvasSize = 300;\n    let lastDrawnState = -2;\n    let lastDrawnSize = {\n        width: 0,\n        height: 0\n    };\n    let animationCanvas = BB.canvas(); // to help animate the transition\n    let animationCanvasCtx = animationCanvas.getContext('2d');\n    const animationLength = 30;\n    let animationCount = 0; // >0 means it's animating\n    let largeCanvasIsVisible = false;\n    let largeCanvasAnimationTimeout;\n    const largeCanvasAnimationDurationMs = 300;\n    let uiState = 'right'; // 'left' | 'right'\n\n\n    // --- setup dom ---\n    let contentWrapperEl = BB.el({\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            height: height + 'px',\n            color: '#666',\n        }\n    });\n    let canvasWrapperEl = BB.el({\n        css: {\n            //background: '#f00',\n            minWidth: height + 'px',\n            height: height + 'px',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center'\n        }\n    });\n    let canvas = BB.canvas(canvasSize, canvasSize);\n    let canvasCtx = canvas.getContext('2d');\n    canvas.title = LANG('layers-active-layer');\n    BB.css(canvas, {\n        boxShadow: '0 0 0 1px #9e9e9e',\n        colorScheme: 'only light',\n    });\n    let nameWrapper = BB.el({\n        css: {\n            //background: '#ff0',\n            flexGrow: '1',\n            paddingLeft: '10px',\n            fontSize: '13px',\n            overflow: 'hidden',\n            position: 'relative'\n        }\n    });\n    let nameLabelEl = BB.el({\n        content: '',\n        css: {\n            cssFloat: 'left',\n            whiteSpace: 'nowrap'\n        }\n    });\n    let nameFadeEl = BB.el({\n        css: {\n            backgroundImage: 'linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)',\n            position: 'absolute',\n            right: \"0\",\n            top: \"0\",\n            width: \"50px\",\n            height: '100%'\n        }\n    });\n    let clickableEl = BB.el({\n        css: {\n            //background: 'rgba(0,255,0,0.6)',\n            position: 'absolute',\n            left: \"10px\",\n            top: \"0\",\n            width: \"90px\",\n            height: '100%'\n        }\n    });\n    if (p.onClick) {\n        BB.addEventListener(clickableEl,'click', function() {\n            p.onClick();\n        });\n        BB.addEventListener(canvas,'click', function() {\n            p.onClick();\n        });\n    }\n    let opacityEl = BB.el({\n        content: LANG('opacity') + '<br>100%',\n        css: {\n            minWidth: '60px',\n            fontSize: '12px',\n            textAlign: 'center',\n            background: '#dddddd',\n            color: '#555'\n        }\n    });\n\n    const largeCanvasWrapper = BB.el({\n        onClick: BB.handleClick,\n        css: {\n            pointerEvents: 'none',\n            background: '#fff',\n            position: 'absolute',\n            right: '280px',\n            top: '10px',\n            border: '1px solid #aaa',\n            boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n            transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\n            userSelect: 'none',\n            display: 'block',\n            webkitTouchCallout: 'none',\n            colorScheme: 'only light',\n        }\n    });\n    let largeCanvas = BB.canvas(largeCanvasSize, largeCanvasSize);\n    largeCanvasWrapper.append(largeCanvas);\n    let largeCanvasCtx = largeCanvas.getContext('2d');\n    BB.css(largeCanvas, {\n        display: 'block',\n    });\n\n    div.appendChild(contentWrapperEl);\n    contentWrapperEl.appendChild(canvasWrapperEl);\n    canvasWrapperEl.appendChild(canvas);\n    contentWrapperEl.appendChild(nameWrapper);\n    nameWrapper.appendChild(nameLabelEl);\n    nameWrapper.appendChild(nameFadeEl);\n    nameWrapper.appendChild(clickableEl);\n    contentWrapperEl.appendChild(opacityEl);\n\n\n    let animationCanvasCheckerPattern = animationCanvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\n    let largeCanvasCheckerPattern = canvasCtx.createPattern(BB.createCheckerCanvas(4), 'repeat');\n\n\n\n    // --- update logic ---\n\n    function animate() {\n        if (animationCount === 0) {\n            return;\n        }\n\n        animationCount--;\n\n        canvasCtx.save();\n        canvasCtx.globalAlpha = Math.pow((animationLength - animationCount) / animationLength, 2);\n        canvasCtx.drawImage(animationCanvas, 0, 0);\n        canvasCtx.restore();\n\n        if (animationCount > 0) {\n            requestAnimationFrame(animate);\n        }\n    }\n\n    function draw(isInstant) {\n\n        if (!isVisible) {\n            return;\n        }\n\n        nameLabelEl.textContent = layerObj.name;\n        opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(layerObj.opacity * 100) + '%';\n\n        let layerCanvas = layerObj.context.canvas;\n\n        if (layerCanvas.width !== lastDrawnSize.width || layerCanvas.height !== lastDrawnSize.height) {\n            let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, canvasSize, canvasSize, 1);\n            canvas.width = Math.round(canvasDimensions.width);\n            canvas.height = Math.round(canvasDimensions.height);\n\n            isInstant = true;\n        }\n\n        animationCanvas.width = canvas.width;\n        animationCanvas.height = canvas.height;\n\n        animationCanvasCtx.save();\n        animationCanvasCtx.imageSmoothingEnabled = false;\n        animationCanvasCtx.fillStyle = animationCanvasCheckerPattern;\n        animationCanvasCtx.fillRect(0, 0, animationCanvas.width, animationCanvas.height);\n        animationCanvasCtx.drawImage(layerCanvas, 0, 0, animationCanvas.width, animationCanvas.height);\n        animationCanvasCtx.restore();\n\n        if (isInstant) {\n            animationCount = 0;\n            canvasCtx.save();\n            canvasCtx.drawImage(animationCanvas, 0, 0);\n            canvasCtx.restore();\n\n        } else {\n            animationCount = animationLength;\n            animate();\n\n        }\n\n        drawLargeCanvas();\n\n        lastDrawnState = klHistory.getState();\n        lastDrawnSize.width = layerCanvas.width;\n        lastDrawnSize.height = layerCanvas.height;\n    }\n\n    function update() {\n        draw(true);\n    }\n\n    setInterval(function() {\n\n        if (!layerObj) {\n            return;\n        }\n\n        let currentState = klHistory.getState();\n        if (currentState === lastDrawnState) {\n            return;\n        }\n\n        //update opacity w hack\n        layerObj.opacity = layerObj.context.canvas.opacity;\n\n        draw(false);\n\n    }, 2000);\n\n\n    //is always instant\n    function drawLargeCanvas() {\n\n        if (!largeCanvasIsVisible || !layerObj) {\n            return;\n        }\n\n        let layerCanvas = layerObj.context.canvas;\n\n        let canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, largeCanvasSize, largeCanvasSize, 1);\n        largeCanvas.width = Math.round(canvasDimensions.width);\n        largeCanvas.height = Math.round(canvasDimensions.height);\n        largeCanvasCtx.save();\n        if (largeCanvas.width > layerCanvas.width) {\n            largeCanvasCtx.imageSmoothingEnabled = false;\n        } else {\n            largeCanvasCtx.imageSmoothingEnabled = true;\n            largeCanvasCtx.imageSmoothingQuality = 'high';\n        }\n        largeCanvasCtx.fillStyle = largeCanvasCheckerPattern;\n        largeCanvasCtx.fillRect(0, 0, largeCanvas.width, largeCanvas.height);\n        largeCanvasCtx.drawImage(layerCanvas, 0, 0, largeCanvas.width, largeCanvas.height);\n        largeCanvasCtx.restore();\n\n        const bounds = div.getBoundingClientRect();\n        BB.css(largeCanvasWrapper, {\n            top: Math.max(10, (bounds.top + height / 2 - largeCanvas.height / 2)) + \"px\"\n        });\n\n    }\n\n    function removeLargeCanvas() {\n        try {\n            p.klRootEl.removeChild(largeCanvasWrapper);\n        } catch(e) {\n\n        }\n    }\n\n    function showLargeCanvas(b) {\n        if (largeCanvasIsVisible === b) {\n            return;\n        }\n\n        clearTimeout(largeCanvasAnimationTimeout);\n        largeCanvasIsVisible = b;\n\n        if (b) {\n            largeCanvasAnimationTimeout = setTimeout(function() {\n                drawLargeCanvas();\n                largeCanvasWrapper.style.opacity = '0';\n                p.klRootEl.appendChild(largeCanvasWrapper);\n                setTimeout(function() {\n                    largeCanvasWrapper.style.opacity = '1';\n                }, 20);\n            }, 250);\n\n        } else {\n            largeCanvasWrapper.style.opacity = '0';\n            largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\n        }\n\n    }\n\n    let pointerListener = new BB.PointerListener({\n        target: canvas,\n        onEnterLeave: function(b) {\n            showLargeCanvas(b);\n        }\n    });\n\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(b) {\n        if (isVisible === b) {\n            return;\n        }\n        isVisible = b;\n        contentWrapperEl.style.display = isVisible ? 'flex' : 'none';\n        div.style.marginBottom = isVisible ? '' : '10px';\n\n        let currentState = klHistory.getState();\n        if (b && lastDrawnState !== currentState) {\n            update();\n        }\n    };\n\n    //when the layer might have changed\n    this.setLayer = function(klCanvasLayerObj) {\n        layerObj = klCanvasLayerObj;\n        update();\n    };\n\n    this.setUiState = function(stateStr) {\n        uiState = '' + stateStr;\n\n        if (uiState === 'left') {\n            BB.css(largeCanvasWrapper, {\n                left: '280px',\n                right: ''\n            });\n        } else {\n            BB.css(largeCanvasWrapper, {\n                left: '',\n                right: '280px'\n            });\n        }\n    };\n\n}","import {BB} from '../../../bb/bb';\n\n/**\n * fits image into a size\n * params: {\n *    image: image,\n *    width: int,\n *    height: int\n * }\n *\n * methods:\n * getDiv()\n *\n * @param params\n * @constructor\n */\nexport function FittedImage(params) {\n    let fit = BB.fitInto(params.image.width, params.image.height, params.width, params.height, 1);\n    let w = parseInt('' + fit.width);\n    let h = parseInt('' + fit.height);\n\n    let canvas = BB.canvas(w, h);\n\n    canvas.getContext(\"2d\").drawImage(params.image, 0, 0, w, h);\n    BB.css(canvas, {\n        display: \"block\",\n        boxShadow: \"0 0 0 1px #aaa\"\n    });\n\n    this.getElement = function() {\n        return canvas;\n    };\n}","import { BB } from '../../../bb/bb';\r\nimport { FreeTransformCanvas } from '../components/free-transform-canvas';\r\nimport { popup } from './popup';\r\nimport { KlCanvas } from '../../canvas/kl-canvas';\r\nimport { BBox, IKlBasicLayer } from '../../kl.types';\r\nimport { LANG } from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog(\r\n    params: {\r\n        target: HTMLElement;\r\n        bbox: BBox;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: { x: number, y: number, width: number, height: number, angleDeg: number },\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    let div = document.createElement(\"div\");\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        let noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px'\r\n            }\r\n        });\r\n        div.appendChild(noteEl);\r\n    }\r\n    let isSmall = params.bbox.width < 550;\r\n\r\n    let buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex'\r\n        }\r\n    });\r\n    let originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.reset();\r\n        }\r\n    });\r\n    let fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformFit();\r\n        }\r\n    });\r\n    let centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px'\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformCenter();\r\n        }\r\n    });\r\n    buttonRowEl.appendChild(originalSizeBtn);\r\n    buttonRowEl.appendChild(fitSizeBtn);\r\n    buttonRowEl.appendChild(centerBtn);\r\n    div.appendChild(buttonRowEl);\r\n\r\n\r\n\r\n    let layers: IKlBasicLayer[] = [];\r\n    {\r\n        let klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over'\r\n    });\r\n\r\n\r\n    let freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.appendChild(freeTransformCanvas.getElement());\r\n\r\n    function move(x, y) {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    popup({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? null : {\r\n            width: '500px'\r\n        },\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        clickOnEnter: 'Ok',\r\n        callback: function (buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n *\r\n * @param p object {onDrop: func(files, optionStr), target: DOM Element, enabledTest: func -> bool} - optionStr: 'default'|'layer'|'image'\r\n * @constructor\r\n */\r\nexport function KlImageDropper(p) {\r\n\r\n    //set up DOM\r\n    let rootEl = BB.el({\r\n        content: 'Drop to import',\r\n        css: {\r\n            paddingTop: '100px',\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n            background: 'rgba(50, 50, 50, 0.7)',\r\n            color: '#fff',\r\n            textShadow: '2px 2px #000',\r\n            textAlign: 'center',\r\n            fontSize: '25px'\r\n        }\r\n    });\r\n    let wrapperEl = BB.el({\r\n        css: {\r\n            'marginTop': '50px',\r\n            'display': 'flex',\r\n            'justifyContent': 'center'\r\n        }\r\n    });\r\n    let optionStyle = {\r\n        width: '200px',\r\n        padding: '50px',\r\n        margin: '10px',\r\n        //opacity: 0.5,\r\n        borderRadius: '20px',\r\n        border: '1px dashed #fff',\r\n        background: '#00aefe',\r\n        fontWeight: 'bold'\r\n    };\r\n    let optionLayerEl = BB.el({\r\n        content: 'As Layer',\r\n        css: optionStyle\r\n    });\r\n    let optionImageEl = BB.el({\r\n        content: 'As New Image',\r\n        css: optionStyle\r\n    });\r\n\r\n    rootEl.appendChild(wrapperEl);\r\n    wrapperEl.appendChild(optionLayerEl);\r\n    wrapperEl.appendChild(optionImageEl);\r\n\r\n\r\n    let rootCounter = 0;\r\n    let optionLayerCounter = 0;\r\n    let optionImageCounter = 0;\r\n\r\n    function destroy() {\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        try {\r\n            p.target.removeChild(rootEl);\r\n        } catch (e) { }\r\n    }\r\n\r\n    function testAcceptType(event) {\r\n        try {\r\n            return !event.dataTransfer.types.includes('text/plain');\r\n        } catch(e) {\r\n\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function updateOptions() {\r\n        let boxShadow = '0 0 20px 4px #fff';\r\n        if (optionLayerCounter > 0) {\r\n            optionLayerEl.style.boxShadow = boxShadow;\r\n            optionImageEl.style.boxShadow = '';\r\n        } else if (optionImageCounter > 0) {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = boxShadow;\r\n        } else {\r\n            optionLayerEl.style.boxShadow = '';\r\n            optionImageEl.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n    BB.addEventListener(optionLayerEl,'dragenter', function() {\r\n        optionLayerCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionLayerEl,'dragleave', function() {\r\n        optionLayerCounter--;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragenter', function() {\r\n        optionImageCounter++;\r\n        updateOptions();\r\n    });\r\n    BB.addEventListener(optionImageEl,'dragleave', function() {\r\n        optionImageCounter--;\r\n        updateOptions();\r\n    });\r\n\r\n\r\n    function rootDragOver(event) {\r\n        if (!testAcceptType(event)) {\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n    }\r\n    function rootDragEnter(event) {\r\n        if (!p.enabledTest() || !testAcceptType(event)) {\r\n            return;\r\n        }\r\n        if (rootCounter === 0) {\r\n            p.target.appendChild(rootEl);\r\n        }\r\n        rootCounter++;\r\n\r\n    }\r\n    function rootDragLeave(event) {\r\n        if (!testAcceptType(event) || rootCounter === 0) {\r\n            return;\r\n        }\r\n        rootCounter = Math.max(0, rootCounter - 1);\r\n        if (rootCounter === 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n\r\n    }\r\n    function rootDrop(event) {\r\n        if (!testAcceptType(event) || event.dataTransfer.files.length === 0) {\r\n            destroy();\r\n            return;\r\n        }\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        let optionStr = 'default';\r\n        if (optionLayerCounter > 0) {\r\n            optionStr = 'layer';\r\n        } else if (optionImageCounter > 0) {\r\n            optionStr = 'image';\r\n        }\r\n\r\n        p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n        if (rootCounter > 0) {\r\n            p.target.removeChild(rootEl);\r\n        }\r\n        rootCounter = 0;\r\n        optionLayerCounter = 0;\r\n        optionImageCounter = 0;\r\n        updateOptions();\r\n    }\r\n\r\n    BB.addEventListener(window,'dragover', rootDragOver, false);\r\n    BB.addEventListener(window,'dragenter', rootDragEnter, false);\r\n    BB.addEventListener(window,'dragleave', rootDragLeave, false);\r\n    BB.addEventListener(window,'drop', rootDrop, false);\r\n\r\n    // if something goes wrong and you're stuck with overlay\r\n    BB.addEventListener(rootEl, 'pointerdown', function() {\r\n        destroy();\r\n    });\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function(keyStr) {\r\n            if (rootCounter > 0 && keyStr === 'esc') {\r\n                destroy();\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\nimport {KlSmallColorSlider} from '../base-components/kl-color-slider-small';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {BrushSettingService} from '../../brushes-ui/brush-setting-service';\nimport {LANG} from '../../../language/language';\n\n/**\n * Compressed HUD toolspace. When you hold ctrl+alt.\n * small color picker, brush settings\n *\n * @param p\n * @constructor\n */\nexport function OverlayToolspace(\n    p: {\n        brushSettingService: BrushSettingService; // to sync with outside\n        enabledTest: () => boolean; // calls to see if it's allowed to show\n    }\n) {\n\n    const sizeObj = {\n        width: 150,\n        svHeight: 90,\n        hHeight: 20,\n        sliderHeight: 25\n    };\n\n    let isVisible = false;\n    const div = BB.el({\n        css: {\n            position: 'absolute',\n            left: '500px',\n            top: '500px',\n            background: 'rgb(221, 221, 221)',\n            display: 'none',\n            border: '1px solid #fff',\n            boxShadow: '0 0 10px rgba(0,0,0,0.5)',\n            colorScheme: 'only light',\n        }\n    });\n    const queuedObj = {\n        color: null,\n        size: null,\n        opacity: null\n    };\n\n\n    // --- inputs ---\n\n    //color selection\n    const colorSlider = new KlSmallColorSlider({\n        width: sizeObj.width,\n        heightSV: sizeObj.svHeight,\n        heightH: sizeObj.hHeight,\n        color: p.brushSettingService.getColor(),\n        callback: function (rgbObj) {\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n            p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n        }\n    });\n    const selectedColorEl = BB.el({\n        css: {\n            width: sizeObj.width + 'px',\n            height: sizeObj.hHeight + 'px',\n            pointerEvents: 'none'\n        }\n    });\n    {\n        const initialColor = p.brushSettingService.getColor();\n        selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\n    }\n\n    div.appendChild(selectedColorEl);\n    div.appendChild(colorSlider.getElement());\n\n\n    function updateColor(rgbObj) {\n        colorSlider.setColor(rgbObj);\n        selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n    }\n\n\n\n\n\n    //brushsize slider\n\n    const sizeSlider = new KlSlider({\n        label: LANG('brush-size'),\n        width: sizeObj.width,\n        height: sizeObj.sliderHeight,\n        min: 0,\n        max: 500,\n        initValue: 50,\n        resolution: 225,\n        eventResMs: 1000 / 30,\n        onChange: function(v) {\n            p.brushSettingService.setSize(v);\n        },\n        formatFunc: function(v) {\n            if (v * 2 < 10) {\n                return Math.round(v * 2 * 10) / 10;\n            }\n            return Math.round(v * 2);\n        }\n    });\n    BB.css(sizeSlider.getElement(), {\n        marginTop: '2px'\n    });\n    div.appendChild(sizeSlider.getElement());\n\n    const opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: sizeObj.width,\n        height: sizeObj.sliderHeight,\n        min: 0,\n        max: 1,\n        initValue: 1,\n        resolution: 225,\n        eventResMs: 1000 / 30,\n        onChange: function(v) {\n            p.brushSettingService.setOpacity(v);\n        },\n        formatFunc: function(v) {\n            return Math.round(v * 100);\n        }\n    });\n    BB.css(opacitySlider.getElement(), {\n        margin: '2px 0'\n    });\n    div.appendChild(opacitySlider.getElement());\n\n\n\n    // --- general setup ---\n\n    const subscriptionFunc = function(event) {\n        if (event.type === 'color') {\n            if (!isVisible) {\n                queuedObj.color = event.value;\n            } else {\n                updateColor(event.value);\n            }\n        }\n        if (event.type === 'size') {\n            if (!isVisible) {\n                queuedObj.size = event.value;\n            } else {\n                sizeSlider.setValue(event.value);\n            }\n        }\n        if (event.type === 'opacity') {\n            if (!isVisible) {\n                queuedObj.opacity = event.value;\n            } else {\n                opacitySlider.setValue(event.value);\n            }\n        }\n        if (event.type === 'sliderConfig') {\n            sizeSlider.update(event.value.sizeSlider);\n            opacitySlider.update(event.value.opacitySlider);\n        }\n    };\n    p.brushSettingService.subscribe(subscriptionFunc);\n    {\n        const sliderConfig = p.brushSettingService.getSliderConfig();\n        sizeSlider.update(sliderConfig.sizeSlider);\n        opacitySlider.update(sliderConfig.opacitySlider);\n        sizeSlider.setValue(p.brushSettingService.getSize());\n        opacitySlider.setValue(p.brushSettingService.getOpacity());\n    }\n\n    function updateUI() {\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible && mousePos) {\n            div.style.left = (mousePos.x - Math.round(sizeObj.width / 2)) + 'px';\n            div.style.top = (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px';\n        }\n    }\n\n    let mousePos = null;\n    BB.addEventListener(document, 'pointermove', function(event) {\n        mousePos = {\n            x: event.pageX,\n            y: event.pageY,\n        };\n    });\n\n    const keyListener = new BB.KeyListener({\n        onDown: function(keyStr, event, comboStr, isRepeat) {\n            if (isRepeat) {\n                return;\n            }\n            if (isVisible) {\n                isVisible = false;\n                updateUI();\n                return;\n            }\n\n            if (!p.enabledTest() || !mousePos) {\n                return;\n            }\n\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\n                event.preventDefault();\n                isVisible = true;\n\n                if (queuedObj.color !== null) {\n                    updateColor(queuedObj.color);\n                    queuedObj.color = null;\n                }\n                if (queuedObj.size !== null) {\n                    sizeSlider.setValue(queuedObj.size);\n                    queuedObj.size = null;\n                }\n                if (queuedObj.opacity !== null) {\n                    opacitySlider.setValue(queuedObj.opacity);\n                    queuedObj.opacity = null;\n                }\n\n                updateUI();\n            }\n\n        },\n        onUp: function(keyStr, event, oldComboStr) {\n            if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\n                isVisible = false;\n                colorSlider.end();\n                updateUI();\n            }\n        },\n        onBlur: function() {\n            if (isVisible) {\n                isVisible = false;\n                colorSlider.end();\n                updateUI();\n            }\n        }\n    });\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n}","import { BB } from '../../../bb/bb';\n// @ts-ignore\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\n// @ts-ignore\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\n// @ts-ignore\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\n// @ts-ignore\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\n// @ts-ignore\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\nimport { LANG } from '../../../language/language';\n\n\n/**\n * Topmost row of buttons in toolspace (with the app logo)\n *\n * p = { // button click callbacks\n *      logoImg: img,\n *     onLogo: function(),\n *     onNew: function(),\n *     onImport: function(),\n *     onSave: function(),\n *     onShare: function(),\n *     onHelp: function()\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceTopRow(p) {\n    let div = document.createElement('div');\n    BB.css(div, {\n        height: '36px',\n        //background: '#f00',\n        display: 'flex',\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\n    });\n\n    function createButton(p) {\n        let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n        let result = BB.el({\n            className: 'toolspace-row-button nohighlight',\n            title: p.title,\n            onClick: p.onClick,\n            css: {\n                padding: p.contain ? padding + 'px 0' : ''\n            }\n        });\n        let im = BB.el({\n            css: {\n                backgroundImage: 'url(\\'' + p.image + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: p.contain ? 'contain' : '',\n                //filter: 'grayscale(1)',\n                height: '100%'\n            }\n        });\n        im.style.pointerEvents = 'none';\n        result.appendChild(im);\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n            target: result,\n            onEnterLeave: function (isOver) {\n                if (isOver) {\n                    BB.addClassName(result, 'toolspace-row-button-hover');\n                } else {\n                    BB.removeClassName(result, 'toolspace-row-button-hover');\n                }\n            }\n        });\n        return result;\n    }\n    let logoButton = null;\n    if (typeof p.onLogo === 'function') {\n        logoButton = createButton({\n            onClick: p.onLogo,\n            title: LANG('home'),\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\n            contain: true\n        });\n        logoButton.style.width = '45px';\n        logoButton.style.borderRight = '1px solid rgb(212, 212, 212)';\n    }\n\n    let newButton = createButton({\n        onClick: p.onNew,\n        title: LANG('file-new'),\n        image: newImageImg,\n        extraPadding: 1,\n        contain: true\n    });\n    let importButton = createButton({\n        onClick: p.onImport,\n        title: LANG('file-import'),\n        image: importImg,\n        extraPadding: 1,\n        contain: true\n    });\n    let saveButton = createButton({\n        onClick: p.onSave,\n        title: LANG('file-save'),\n        image: exportImg,\n        extraPadding: 1,\n        contain: true\n    });\n\n\n\n    let shareButton = null;\n    if (BB.canShareFiles() && p.onShare) {\n        shareButton = createButton({\n            onClick: p.onShare,\n            title: LANG('file-share'),\n            image: shareImg,\n            contain: true\n        });\n    }\n    let helpButton = null;\n    if (p.onHelp) {\n        helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true\n        });\n\n    }\n\n    if (logoButton) {\n        div.appendChild(logoButton);\n    }\n    div.appendChild(newButton);\n    div.appendChild(importButton);\n    div.appendChild(saveButton);\n    if (shareButton) {\n        div.appendChild(shareButton);\n    }\n    if (helpButton) {\n        div.appendChild(helpButton);\n    }\n\n\n    // --- interface ---\n    this.getElement = function () {\n        return div;\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8Plcz\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"43S3A\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"bGPtg\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hofH5\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"kfijQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"jjlWQ\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n// @ts-ignore\r\nimport toolPaintImg from 'url:~/src/app/img/ui/tool-paint.svg';\r\n// @ts-ignore\r\nimport toolFillImg from 'url:~/src/app/img/ui/tool-fill.svg';\r\n// @ts-ignore\r\nimport toolTextImg from 'url:~/src/app/img/ui/tool-text.svg';\r\n// @ts-ignore\r\nimport toolShapeImg from 'url:~/src/app/img/ui/tool-shape.svg';\r\n// @ts-ignore\r\nimport caretDownImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n *\r\n * p = {\r\n *     onChange: func(activeStr)\r\n * }\r\n *\r\n * activeStr = 'draw' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolDropdown(p) {\r\n\r\n    let optionArr = ['draw', 'fill', 'text', 'shape'];\r\n    let imArr = [\r\n        toolPaintImg,\r\n        toolFillImg,\r\n        toolTextImg,\r\n        toolShapeImg\r\n    ];\r\n    let titleArr = [\r\n        `${LANG('tool-brush')} [B]`,\r\n        `${LANG('tool-paint-bucket')} [G]`,\r\n        `${LANG('tool-text')} [T]`,\r\n        `${LANG('tool-shape')} [U]`,\r\n    ];\r\n    let currentActiveIndex = 0;\r\n    let isActive = true;\r\n    let isOpen = false;\r\n\r\n    //preload images\r\n    setTimeout(function() {\r\n        for (let i = 1; i < imArr.length; i++) {\r\n            let im = new Image();\r\n            im.src = imArr[i];\r\n        }\r\n    }, 100);\r\n\r\n    let smallMargin = '6px 0';\r\n    let div = BB.el({\r\n        css: {\r\n            position: 'relative',\r\n            flexGrow: '1'\r\n        }\r\n    });\r\n\r\n    let openTimeout;\r\n    let isDragging = false;\r\n    let startX, startY;\r\n    let pointerListener;\r\n    if (BB.hasPointerEvents) {\r\n        pointerListener = new BB.PointerListener({\r\n            target: div,\r\n            maxPointers: 1,\r\n            onPointer: function(event) {\r\n                if (event.type === 'pointerdown') {\r\n                    if (isOpen) {\r\n                        return;\r\n                    }\r\n\r\n                    openTimeout = setTimeout(function() {\r\n                        showDropdown();\r\n                    }, 400);\r\n                    isDragging = true;\r\n                    startX = event.pageX;\r\n                    startY = event.pageY;\r\n\r\n                } else if (event.type === 'pointermove') {\r\n                    if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                        clearTimeout(openTimeout);\r\n                        showDropdown();\r\n                    }\r\n\r\n                } else if (event.type === 'pointerup') {\r\n                    clearTimeout(openTimeout);\r\n                    if (isOpen && isDragging) {\r\n                        let target = document.elementFromPoint(event.pageX, event.pageY);\r\n                        for (let i = 0; i < dropdownBtnArr.length; i++) {\r\n                            if (target === dropdownBtnArr[i].wrapper) {\r\n                                closeDropdown();\r\n                                isActive = true;\r\n                                currentActiveIndex = i;\r\n                                updateButton();\r\n                                p.onChange(optionArr[currentActiveIndex]);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                    isDragging = false;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    let activeButton = BB.el({\r\n        parent: div,\r\n        className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n        title: titleArr[currentActiveIndex],\r\n        onClick: function(e) {\r\n            if (isActive && !isOpen) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n                return;\r\n            }\r\n\r\n            isActive = true;\r\n            p.onChange(optionArr[currentActiveIndex]);\r\n            if (isOpen) {\r\n                closeDropdown();\r\n            }\r\n        },\r\n        css: {\r\n            padding: '10px 0',\r\n            pointerEvents: 'auto',\r\n            height: '100%',\r\n            boxSizing: 'border-box'\r\n        }\r\n    });\r\n\r\n    let activeButtonIm = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: 'contain',\r\n            width: 'calc(100% - 7px)',\r\n            height: '100%',\r\n            pointerEvents: 'none',\r\n            opacity: '0.75',\r\n        }\r\n    });\r\n\r\n    let arrowButton = BB.el({\r\n        parent: activeButton,\r\n        css: {\r\n            position: 'absolute',\r\n            right: '1px',\r\n            bottom: '1px',\r\n            width: '18px',\r\n            height: '18px',\r\n            //background: '#aaa',\r\n            //borderRadius: '2px',\r\n            cursor: 'pointer',\r\n\r\n            backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n            backgroundRepeat: 'no-repeat',\r\n            backgroundPosition: 'center',\r\n            backgroundSize: '60%'\r\n        },\r\n        title: 'More Tools',\r\n        onClick: function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            showDropdown();\r\n        }\r\n    });\r\n\r\n\r\n    let overlay = BB.el({\r\n        css: {\r\n            position: 'absolute',\r\n            //background: 'rgba(255,0,0,0.5)',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0'\r\n        }\r\n    });\r\n    let overlayPointerListener = new BB.PointerListener({\r\n        target: overlay,\r\n        pointers: 1,\r\n        onPointer: function(e) {\r\n            if (e.type === 'pointerdown') {\r\n                e.eventPreventDefault();\r\n                closeDropdown();\r\n            }\r\n        }\r\n    });\r\n\r\n    let dropdownWrapper = BB.el({\r\n        className: 'tool-dropdown-wrapper',\r\n        css: {\r\n            position: 'absolute',\r\n            width: '100%',\r\n            height: (100 * (optionArr.length - 1)) + '%',\r\n            top: '100%',\r\n            left: '0',\r\n            zIndex: '1',\r\n            boxSizing: 'border-box',\r\n            cursor: 'pointer',\r\n            transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n            borderBottomLeftRadius: '5px',\r\n            borderBottomRightRadius: '5px',\r\n            overflow: 'hidden',\r\n        }\r\n    });\r\n\r\n    let dropdownBtnArr = [];\r\n\r\n    function createDropdownButton(p) {\r\n        let result = {};\r\n\r\n        let wrapper = BB.el({\r\n            parent: dropdownWrapper,\r\n            className: 'tool-dropdown-button',\r\n            title: p.title,\r\n            css: {\r\n                padding: '10px 0',\r\n                height: (100 / (optionArr.length - 1)) + '%',\r\n                boxSizing: 'border-box'\r\n            },\r\n            onClick: function(e) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                p.onClick(p.index, p.id);\r\n            }\r\n        });\r\n        (result as any).wrapper = wrapper;\r\n        let im = BB.el({\r\n            parent: wrapper,\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75'\r\n            }\r\n        });\r\n\r\n        // --- interface ---\r\n        (result as any).show = function(b) {\r\n            wrapper.style.display = b ? 'block' : 'none';\r\n        };\r\n\r\n        (result as any).setIsSmall = function(b) {\r\n            wrapper.style.padding = b ? smallMargin : '10px 0';\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function onClickDropdownBtn(index, id) {\r\n        closeDropdown();\r\n\r\n        isActive = true;\r\n        currentActiveIndex = index;\r\n\r\n        updateButton();\r\n\r\n        p.onChange(optionArr[currentActiveIndex]);\r\n    }\r\n\r\n    for (let i = 0; i < optionArr.length; i++) {\r\n        dropdownBtnArr.push(createDropdownButton({\r\n            index: i,\r\n            id: optionArr[i],\r\n            image: imArr[i],\r\n            title: titleArr[i],\r\n            onClick: onClickDropdownBtn\r\n        }));\r\n    }\r\n\r\n    function showDropdown() {\r\n        dialogCounter.increase(0.5);\r\n        isOpen = true;\r\n\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].show(currentActiveIndex !== i);\r\n        }\r\n\r\n        arrowButton.style.display = 'none';\r\n        div.style.zIndex = '1';\r\n        p.klRootEl.appendChild(overlay);\r\n        div.appendChild(dropdownWrapper);\r\n    }\r\n\r\n    function closeDropdown() {\r\n        dialogCounter.decrease(0.5);\r\n        isOpen = false;\r\n        arrowButton.style.removeProperty('display');\r\n        div.style.removeProperty('z-index');\r\n        p.klRootEl.removeChild(overlay);\r\n\r\n        div.removeChild(dropdownWrapper);\r\n    }\r\n\r\n    function updateButton() {\r\n        activeButton.title = titleArr[currentActiveIndex];\r\n        activeButtonIm.style.backgroundImage = 'url(\\'' + imArr[currentActiveIndex] + '\\')';\r\n    }\r\n    updateButton();\r\n\r\n\r\n    // --- interface ---\r\n\r\n    this.setIsSmall = function(b) {\r\n        activeButton.style.padding = b ? smallMargin : '10px 0';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            arrowButton.style.width = '14px';\r\n            arrowButton.style.height = '14px';\r\n        } else {\r\n            arrowButton.style.width = '18px';\r\n            arrowButton.style.height = '18px';\r\n        }\r\n    };\r\n\r\n    this.setActive = function(activeStr) {\r\n        if (optionArr.includes(activeStr)) {\r\n            isActive = true;\r\n            for (let i = 0; i < optionArr.length; i++) {\r\n                if (optionArr[i] === activeStr) {\r\n                    currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            BB.addClassName(activeButton, 'toolspace-row-button-activated');\r\n            updateButton();\r\n        } else {\r\n            isActive = false;\r\n            BB.removeClassName(activeButton, 'toolspace-row-button-activated');\r\n        }\r\n    };\r\n\r\n    this.getActive = function() {\r\n        return optionArr[currentActiveIndex];\r\n    };\r\n\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"4DSYE\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1H3Hd\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"18NiM\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8cnwX\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7EOgw\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\n// @ts-ignore\r\nimport toolHandImg from 'url:~/src/app/img/ui/tool-hand.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\n// @ts-ignore\r\nimport toolUndoImg from 'url:~/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n *\r\n * p = {\r\n *     onActivate: function(activeStr), // clicking on tool button - activating it\r\n *     onZoomIn: function(),\r\n *     onZoomOut: function(),\r\n *     onUndo: function(),\r\n *     onRedo: function(),\r\n * }\r\n *\r\n * activeStr = 'draw' | 'hand' | 'fill' | 'text'\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport function ToolspaceToolRow(p) {\r\n    let div = document.createElement('div');\r\n    BB.css(div, {\r\n        height: '54px',\r\n        //height: '36px',\r\n        display: 'flex',\r\n        backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\r\n    });\r\n\r\n    let currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n    function setActive(activeStr, doEmit?) {\r\n        if (currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        currentActiveStr = activeStr;\r\n\r\n        toolDropdown.setActive(currentActiveStr);\r\n        if (currentActiveStr === 'hand') {\r\n            BB.addClassName(handButton, 'toolspace-row-button-activated');\r\n        } else {\r\n            BB.removeClassName(handButton, 'toolspace-row-button-activated');\r\n        }\r\n\r\n        if (doEmit) {\r\n            p.onActivate(currentActiveStr);\r\n        }\r\n    }\r\n\r\n    function createButton(p) {\r\n\r\n        let smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n        let result = BB.el({\r\n            className: 'toolspace-row-button nohighlight',\r\n            //title: p.title,\r\n            onClick: p.onClick,\r\n            css: {\r\n                padding: p.contain ? '10px 0' : ''\r\n            }\r\n        });\r\n        let im = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: p.contain ? 'contain' : '',\r\n                //filter: 'grayscale(1)',\r\n                height: '100%',\r\n                transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none',\r\n                opacity: p.doLighten ? '0.75' : '1'\r\n            }\r\n        });\r\n        result.appendChild(im);\r\n        (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n            target: result,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(result, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(result, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).setIsSmall = function(b) {\r\n            result.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n        }\r\n        return result;\r\n    }\r\n\r\n\r\n    function createTriangleButton(p) { // because IE and Edge don't support clip path\r\n\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n        let svg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '67px', // can't think of a way doing with percentage\r\n            height: '54px',\r\n            viewBox: '0 0 100 100',\r\n            preserveAspectRatio: 'none'\r\n        });\r\n        BB.css(svg, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n\r\n        let blurRadius = 10;\r\n        let blurOffsetX = 2;\r\n        let blurOffsetY = 2;\r\n\r\n        let defs = BB.createSvg( { // inset shadow via svg\r\n            elementType: 'defs',\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'filter',\r\n                    id: 'innershadow',\r\n                    x0: '-50%',\r\n                    y0: '-50%',\r\n                    width: '200%',\r\n                    height: '200%',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'SourceAlpha',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceAlpha',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'SourceGraphic',\r\n                            operator: 'over',\r\n                            result: 'firstfilter'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feGaussianBlur',\r\n                            in: 'firstfilter',\r\n                            stdDeviation: '' + blurRadius,\r\n                            result: 'blur2'\r\n                        }, {\r\n                            elementType: 'feOffset',\r\n                            dx: '' + blurOffsetX,\r\n                            dy: '' + blurOffsetY\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'arithmetic',\r\n                            k2: '-1',\r\n                            k3: '1',\r\n                            result: 'shadowDiff'\r\n                        },\r\n\r\n                        {\r\n                            elementType: 'feFlood',\r\n                            'flood-color': '#000',\r\n                            'flood-opacity': '0.2'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'shadowDiff',\r\n                            operator: 'in'\r\n                        }, {\r\n                            elementType: 'feComposite',\r\n                            in2: 'firstfilter',\r\n                            operator: 'over'\r\n                        }\r\n                    ]\r\n                }\r\n            ]\r\n        });\r\n\r\n\r\n        let svgTriangleLeft = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M0,0 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleLeft.onclick = function() {\r\n            p.onLeft();\r\n            BB.removeClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        let svgTriangleRight = BB.createSvg({\r\n            elementType: 'path',\r\n            'vector-effect': 'non-scaling-stroke',\r\n            d: 'M100,100 L 100,0 0,100 z',\r\n            fill: 'rgba(0,0,0,0)',\r\n            class: 'toolspace-svg-triangle-button'\r\n        });\r\n        svgTriangleRight.onclick = function() {\r\n            p.onRight();\r\n            BB.removeClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n        };\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: svgTriangleLeft,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n                } else {\r\n                    BB.removeClassName(svgTriangleLeft, 'toolspace-svg-triangle-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: svgTriangleRight,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n                } else {\r\n                    BB.removeClassName(svgTriangleRight, 'toolspace-svg-triangle-button-hover');\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n        svg.appendChild(defs);\r\n        svg.appendChild(svgTriangleLeft);\r\n        svg.appendChild(svgTriangleRight);\r\n        result.appendChild(svg);\r\n\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(leftIm);\r\n\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        result.appendChild(rightIm);\r\n\r\n\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(svgTriangleLeft, 'toolspace-row-button-disabled');\r\n                BB.removeClassName(leftIm, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(svgTriangleLeft, 'toolspace-row-button-disabled');\r\n                BB.addClassName(leftIm, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(svgTriangleRight, 'toolspace-row-button-disabled');\r\n                BB.removeClassName(rightIm, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(svgTriangleRight, 'toolspace-row-button-disabled');\r\n                BB.addClassName(rightIm, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n\r\n        return result;\r\n    }\r\n\r\n    function createTriangleButtonViaClipPath(p) {\r\n        let result = document.createElement('div');\r\n        BB.css(result, {\r\n            flexGrow: '1',\r\n            position: 'relative'\r\n        });\r\n\r\n\r\n        let leftButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onLeft,\r\n            css: {\r\n                clipPath: 'polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let leftIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '8px',\r\n                //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        leftButton.appendChild(leftIm);\r\n\r\n\r\n\r\n        let rightButton = BB.el({\r\n            className: 'toolspace-triangle-button',\r\n            onClick: p.onRight,\r\n            css: {\r\n                clipPath: 'polygon(0% 100%, 100% 0%, 100% 100%, 0% 100%)'\r\n            }\r\n        });\r\n\r\n        let rightIm = BB.el({\r\n            css: {\r\n                backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundSize: 'contain',\r\n                width: '20px',\r\n                height: '20px',\r\n                position: 'absolute',\r\n                right: '10px',\r\n                bottom: '8px',\r\n                transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                pointerEvents: 'none'\r\n            }\r\n        });\r\n        rightButton.appendChild(rightIm);\r\n\r\n\r\n\r\n        result.appendChild(leftButton);\r\n        result.appendChild(rightButton);\r\n\r\n\r\n        // because :hover causes problems w touch\r\n        (result as any).leftPointerListener = new BB.PointerListener({\r\n            target: leftButton,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(leftButton, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(leftButton, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n        (result as any).rightPointerListener = new BB.PointerListener({\r\n            target: rightButton,\r\n            onEnterLeave: function(isOver) {\r\n                if (isOver) {\r\n                    BB.addClassName(rightButton, 'toolspace-row-button-hover');\r\n                } else {\r\n                    BB.removeClassName(rightButton, 'toolspace-row-button-hover');\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n\r\n        (result as any).setIsEnabledLeft = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(leftButton, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(leftButton, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        (result as any).setIsEnabledRight = function(b) {\r\n            if (b) {\r\n                BB.removeClassName(rightButton, 'toolspace-row-button-disabled');\r\n            } else {\r\n                BB.addClassName(rightButton, 'toolspace-row-button-disabled');\r\n            }\r\n        };\r\n        return result;\r\n    }\r\n\r\n    /*let brushButton = createButton({\r\n        onClick: function() {\r\n            setActive('draw', true);\r\n        },\r\n        image: 'app/img/ui/paint.png',\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    BB.addClassName(brushButton, 'toolspace-row-button-activated');\r\n    div.appendChild(brushButton);*/\r\n\r\n    let toolDropdown = new ToolDropdown({\r\n        klRootEl: p.klRootEl,\r\n        onChange: function(activeStr) {\r\n            setActive(activeStr, true);\r\n        }\r\n    });\r\n    div.appendChild(toolDropdown.getElement());\r\n\r\n    let handButton = createButton({\r\n        onClick: function() {\r\n            setActive('hand', true);\r\n        },\r\n        image: toolHandImg,\r\n        contain: true,\r\n        doLighten: true\r\n    });\r\n    handButton.style.borderRight = '1px solid rgb(212, 212, 212)';\r\n    handButton.title = LANG('tool-hand');\r\n    div.appendChild(handButton);\r\n\r\n    let zoomInNOutButton = createTriangleButton({\r\n        onLeft: p.onZoomIn,\r\n        onRight: p.onZoomOut,\r\n        leftImage: toolZoomInImg,\r\n        rightImage: toolZoomOutImg,\r\n    });\r\n    zoomInNOutButton.title = LANG('tool-zoom');\r\n    div.appendChild(zoomInNOutButton);\r\n\r\n    let zoomInButton = createButton({\r\n        onClick: p.onZoomIn,\r\n        image: toolZoomInImg,\r\n        contain: true\r\n    });\r\n    zoomInButton.title = LANG('zoom-in');\r\n    div.appendChild(zoomInButton);\r\n\r\n    let zoomOutButton = createButton({\r\n        onClick: p.onZoomOut,\r\n        image: toolZoomOutImg,\r\n        contain: true\r\n    });\r\n    zoomOutButton.title = LANG('zoom-out');\r\n    div.appendChild(zoomOutButton);\r\n\r\n    let undoNRedoButton = createTriangleButton({\r\n        onLeft: p.onUndo,\r\n        onRight: p.onRedo,\r\n        leftImage: toolUndoImg,\r\n        rightImage: null,\r\n    });\r\n    undoNRedoButton.title = LANG('tool-undo-redo');\r\n    (undoNRedoButton as any).setIsEnabledLeft(false);\r\n    (undoNRedoButton as any).setIsEnabledRight(false);\r\n    div.appendChild(undoNRedoButton);\r\n\r\n    let undoButton = createButton({\r\n        onClick: p.onUndo,\r\n        image: toolUndoImg,\r\n        contain: true\r\n    });\r\n    undoButton.title = LANG('undo');\r\n    BB.addClassName(undoButton, 'toolspace-row-button-disabled');\r\n    div.appendChild(undoButton);\r\n\r\n    let redoButton = createButton({\r\n        onClick: p.onRedo,\r\n        image: toolUndoImg,\r\n        contain: true,\r\n        doMirror: true\r\n    });\r\n    redoButton.title = LANG('redo');\r\n    BB.addClassName(redoButton, 'toolspace-row-button-disabled');\r\n    div.appendChild(redoButton);\r\n\r\n    zoomInButton.style.display = 'none';\r\n    zoomOutButton.style.display = 'none';\r\n    undoButton.style.display = 'none';\r\n    redoButton.style.display = 'none';\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // --- interface ---\r\n    this.getElement = function() {\r\n        return div;\r\n    };\r\n    this.setIsSmall = function(b) {\r\n        BB.css(div, {\r\n            height: b ? '36px' : '54px'\r\n        });\r\n\r\n        toolDropdown.setIsSmall(b);\r\n        (handButton as any).setIsSmall(b);\r\n        (zoomInButton as any).setIsSmall(b);\r\n        (zoomOutButton as any).setIsSmall(b);\r\n        (undoButton as any).setIsSmall(b);\r\n        (redoButton as any).setIsSmall(b);\r\n\r\n        if (b) {\r\n            zoomInNOutButton.style.display = 'none';\r\n            undoNRedoButton.style.display = 'none';\r\n            zoomInButton.style.display = 'block';\r\n            zoomOutButton.style.display = 'block';\r\n            undoButton.style.display = 'block';\r\n            redoButton.style.display = 'block';\r\n        } else {\r\n            zoomInNOutButton.style.display = 'block';\r\n            undoNRedoButton.style.display = 'block';\r\n            zoomInButton.style.display = 'none';\r\n            zoomOutButton.style.display = 'none';\r\n            undoButton.style.display = 'none';\r\n            redoButton.style.display = 'none';\r\n        }\r\n\r\n    };\r\n\r\n    this.setEnableZoomIn = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(zoomInButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(zoomInButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (zoomInNOutButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableZoomOut = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(zoomOutButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(zoomOutButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (zoomInNOutButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setEnableUndo = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(undoButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(undoButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (undoNRedoButton as any).setIsEnabledLeft(b);\r\n    };\r\n    this.setEnableRedo = function(b) {\r\n        if (b) {\r\n            BB.removeClassName(redoButton, 'toolspace-row-button-disabled');\r\n        } else {\r\n            BB.addClassName(redoButton, 'toolspace-row-button-disabled');\r\n        }\r\n        (undoNRedoButton as any).setIsEnabledRight(b);\r\n    };\r\n    this.setActive = function(activeStr) {\r\n        setActive(activeStr);\r\n    };\r\n    this.getActive = function() {\r\n        return currentActiveStr;\r\n    };\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"iY1ZE\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5RV8h\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1WcRu\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hfADS\");","import {BB} from '../../../bb/bb';\nimport {Select} from '../base-components/select';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui to select stabilizer level. 4 options. returned as 0-3\n *\n * p = {\n *     smoothing: number, // initial level 0-3\n *     onSelect: function(level number) // 0-3, when level changes\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceStabilizerRow(p) {\n\n    let div = BB.el({\n        tagName: 'label',\n        content: LANG('stabilizer') + '&nbsp;',\n        title: LANG('stabilizer-title'),\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            fontSize: '13px',\n            color: 'rgba(0,0,0,0.6)'\n        }\n    });\n\n    let strengthSelect = new Select({\n        optionArr: [\n            ['0', '0'],\n            ['1', '1'],\n            ['2', '2'],\n            ['3', '3'],\n            ['4', '4'],\n            ['5', '5']\n        ],\n        initValue: p.smoothing,\n        onChange: function(val) {\n            p.onSelect(parseInt(val));\n        }\n    });\n    div.appendChild(strengthSelect.getElement());\n\n    let pointerListener = new BB.PointerListener({\n        target: div,\n        onWheel: function(e) {\n            strengthSelect.setDeltaValue(e.deltaY);\n        }\n    });\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport invertedBorderImg from 'url:~/src/app/img/ui/inverted-border.svg';\n\n/**\n * row of tabs. uses css class .tabrow-tab\n *\n * p = {\n *     initialId: string, // e.g. 'draw'\n *     useAccent: boolean,\n *     tabArr: [\n *         {\n *             id: string, // e.g. 'draw',\n *             label: string, // optional\n *             image: string, // optional background image\n *             title: string, // optional\n *             isVisible: boolean, // optional - default is true\n *             onOpen: function(),\n *             onClose: function(),\n *             css: {...},\n *         }\n *     ]\n * }\n *\n * @param p\n * @constructor\n */\nexport function TabRow(p) {\n    let _this = this;\n    let height = 35;\n    let div = BB.el({\n        className: 'tabrow',\n        css: {\n            height: height + 'px'\n        }\n    });\n\n    let tabArr = []; //creates its own internal arr\n    let openedTabObj = null;\n\n    const roundSize = 10;\n    const roundRight = BB.el({\n        css: {\n            width: roundSize + 'px',\n            height: roundSize + 'px',\n            backgroundImage: `url('${invertedBorderImg}')`,\n            backgroundSize: 'cover',\n            position: 'absolute',\n            right: -roundSize + 'px',\n            bottom: '0',\n            pointerEvents: 'none',\n        }\n    });\n    const roundLeft = BB.el({\n        css: {\n            width: roundSize + 'px',\n            height: roundSize + 'px',\n            backgroundImage: `url('${invertedBorderImg}')`,\n            backgroundSize: 'cover',\n            position: 'absolute',\n            left: -roundSize + 'px',\n            bottom: '0',\n            transform: 'scale(-1,1)',\n            pointerEvents: 'none',\n        }\n    });\n\n    function createTab(pTabObj, initialId, useAccent) {\n        let result: any = {\n            id: pTabObj.id,\n            isVisible: 'isVisible' in pTabObj ? pTabObj.isVisible : true,\n            onOpen: pTabObj.onOpen,\n            onClose: pTabObj.onClose,\n            update: function(openedTabObj) {\n                tabDiv.className = openedTabObj === result ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab';\n                tabDiv.style.display = result.isVisible ? 'block' : 'none';\n            }\n        };\n        let tabDiv = BB.el({\n            content: 'label' in pTabObj ? pTabObj.label : '',\n            title: 'title' in pTabObj ? pTabObj.title : undefined,\n            className: initialId === result.id ? (useAccent ? 'tabrow-tab tabrow-tab-opened-accented' : 'tabrow-tab tabrow-tab-opened') : 'tabrow-tab',\n            css: {\n                lineHeight: height + 'px',\n                display: result.isVisible ? 'block' : 'none',\n                zIndex: '0',\n            },\n            onClick: function() {\n                if (openedTabObj === result) {\n                    return;\n                }\n                _this.open(result.id);\n            }\n        });\n        result.div = tabDiv;\n        if ('image' in pTabObj) {\n            BB.css(tabDiv, {\n                backgroundImage: 'url(\\'' + pTabObj.image + '\\')',\n                backgroundSize: (height - 7) + 'px'\n            });\n        }\n        if ('css' in pTabObj) {\n            BB.css(tabDiv, pTabObj.css);\n        }\n        div.appendChild(tabDiv);\n\n        let pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n            target: tabDiv,\n            onEnterLeave: function(isOver) {\n                if (isOver) {\n                    BB.addClassName(tabDiv, 'tabrow-tab-hover');\n                } else {\n                    BB.removeClassName(tabDiv, 'tabrow-tab-hover');\n                }\n            }\n        });\n\n        if (initialId === result.id) {\n            result.onOpen();\n            result.div.appendChild(roundRight);\n            result.div.appendChild(roundLeft);\n        } else {\n            result.onClose();\n        }\n\n        return result;\n    }\n\n    for (let i = 0; i < p.tabArr.length; i++) {\n        tabArr.push(createTab(p.tabArr[i], p.initialId, p.useAccent));\n    }\n\n    for (let i = 0; i < tabArr.length; i++) {\n        if (tabArr[i].id === p.initialId) {\n            openedTabObj = tabArr[i];\n        }\n    }\n    if (openedTabObj === null) {\n        throw 'invalid initialId';\n    }\n\n    function update() {\n        for (let i = 0; i < tabArr.length; i++) {\n            tabArr[i].update(openedTabObj);\n        }\n    }\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n\n    this.open = function(tabId) {\n        for (let i = 0; i < tabArr.length; i++) {\n            if (tabArr[i].id === tabId) {\n                if (openedTabObj === tabArr[i]) { // already open\n                    return;\n                }\n                openedTabObj.onClose();\n                openedTabObj = tabArr[i];\n                openedTabObj.onOpen();\n                openedTabObj.div.appendChild(roundRight);\n                openedTabObj.div.appendChild(roundLeft);\n                update();\n                return;\n            }\n        }\n        throw 'TabRow.open - invalid tabId';\n    };\n\n    this.getOpenedTabId = function() {\n        return '' + openedTabObj.id;\n    };\n\n    this.setIsVisible = function(tabId, isVisible) {\n        for (let i = 0; i < tabArr.length; i++) {\n            if (tabArr[i].id === tabId) {\n                tabArr[i].isVisible = !!isVisible;\n                update();\n                return;\n            }\n        }\n        throw 'TabRow.setIsVisible - invalid tabId';\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"dPZrf\");","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport angleImg from 'url:~/src/app/img/ui/angle.svg';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui, when hand tool tab is open.\n *\n * p = {\n *     scale: number, // initial value\n *     angleDeg: number, // initial value\n *     onReset: function(),\n *     onFit: function(),\n *     onAngleChange: function(angleDeg number, isRelative number)\n * }\n *\n * @param p\n * @constructor\n */\nexport function HandUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n    let scale = p.scale;\n    let angleDeg = p.angleDeg;\n\n    let row1 = BB.el({\n        css: {\n            marginBottom: '10px',\n            display: 'flex'\n        }\n    });\n    let row2 = BB.el({\n        css: {\n            display: 'flex',\n            marginBottom: '10px',\n        }\n    });\n    let row3 = BB.el({\n        css: {\n            display: 'flex'\n        }\n    });\n    div.append(row1, row2, row3);\n\n\n    let scaleEl = BB.el({\n        css: {\n            width: '55px',\n            userSelect: 'none'\n        }\n    });\n    row1.appendChild(scaleEl);\n\n    let angleIm = new Image();\n    angleIm.src = angleImg;\n    BB.css(angleIm, {\n        verticalAlign: 'bottom',\n        width: '20px',\n        height: '20px',\n        marginRight: '5px',\n        borderRadius: '10px',\n        background: 'rgba(0,0,0,0.2)',\n        userSelect: 'none'\n    });\n    row1.appendChild(angleIm);\n\n    let angleEl = BB.el({\n        css: {\n            userSelect: 'none'\n        }\n    });\n    row1.appendChild(angleEl);\n\n\n    function update() {\n        scaleEl.innerHTML = Math.round(scale * 100) + '%';\n        angleEl.innerHTML =  Math.round(angleDeg) + '';\n\n\n        angleIm.style.transform = 'rotate(' + angleDeg + 'deg)';\n        if (angleDeg % 90 === 0) {\n            angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\n        } else {\n            angleIm.style.boxShadow = '';\n        }\n    }\n    update();\n\n\n    let resetButton = BB.el({\n        tagName: 'button',\n        content: LANG('hand-reset'),\n        onClick: p.onReset\n    });\n    BB.makeUnfocusable(resetButton);\n\n    let fitButton = BB.el({\n        tagName: 'button',\n        content: LANG('hand-fit'),\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: p.onFit\n    });\n    BB.makeUnfocusable(fitButton);\n    row2.append(resetButton, fitButton);\n\n    let leftRotateButton = BB.el({\n        tagName: 'button',\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\n        onClick: function() {\n            p.onAngleChange(-15, true);\n        }\n    });\n    BB.makeUnfocusable(leftRotateButton);\n\n    let resetAngleButton = BB.el({\n        tagName: 'button',\n        content: '0',\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: function() {\n            p.onAngleChange(0);\n        }\n    });\n    BB.makeUnfocusable(resetAngleButton);\n\n    let rightRotateButton = BB.el({\n        tagName: 'button',\n        content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\n        css: {\n            marginLeft: '10px'\n        },\n        onClick: function() {\n            p.onAngleChange(15, true);\n        }\n    });\n    BB.makeUnfocusable(rightRotateButton);\n    row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n\n\n\n    // --- interface ---\n    this.getElement = function() {\n        return div;\n    };\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            update();\n        }\n    };\n    this.update = function(pScale, pAngleDeg) {\n        scale = pScale;\n        angleDeg = pAngleDeg;\n        if (isVisible) {\n            update();\n        }\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"clLlI\");","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {Select} from '../base-components/select';\nimport {Checkbox} from '../base-components/checkbox';\nimport {LANG} from '../../../language/language';\n\n/**\n * Paint Bucket tab contents (color slider, opacity slider, etc)\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function FillUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: 250,\n        height: 30,\n        min: 0,\n        max: 1,\n        initValue: 1,\n        onChange: function (val) {\n        },\n        formatFunc: function(v) {\n            return Math.round(v * 100);\n        }\n    });\n    div.appendChild(opacitySlider.getElement());\n\n    let toleranceSlider = new KlSlider({\n        label: LANG('bucket-tolerance'),\n        width: 250,\n        height: 30,\n        min: 0,\n        max: 255,\n        initValue: 255 / 100 * 20,\n        onChange: function (val) {\n        },\n        formatFunc: function(v) {\n            return Math.round(v / 255 * 100);\n        }\n    });\n    BB.css(toleranceSlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(toleranceSlider.getElement());\n\n    let selectRow = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            marginTop: '10px'\n        }\n    });\n\n    let modeWrapper;\n    let modeSelect;\n    modeWrapper = BB.el({\n        content: LANG('bucket-sample') + '&nbsp;',\n        title: LANG('bucket-sample-title'),\n        css: {\n            fontSize: '15px'\n        }\n    });\n    modeSelect = new Select({\n        optionArr: [\n            ['all', LANG('bucket-sample-all')],\n            ['current', LANG('bucket-sample-active')],\n            ['above', LANG('bucket-sample-above')]\n        ],\n        initValue: 'all',\n        onChange: function(val) {}\n    });\n    let modePointerListener = new BB.PointerListener({\n        target: modeSelect.getElement(),\n        onWheel: function(e) {\n            modeSelect.setDeltaValue(e.deltaY);\n        }\n    });\n    modeWrapper.appendChild(modeSelect.getElement());\n    selectRow.appendChild(modeWrapper);\n\n    let growWrapper;\n    let growSelect;\n    growWrapper = BB.el({\n        content: LANG('bucket-grow') + '&nbsp;',\n        title: LANG('bucket-grow-title'),\n        css: {\n            fontSize: '15px',\n            marginLeft: '10px'\n        }\n    });\n    growSelect = new Select({\n        optionArr: [\n            ['0', '0'],\n            ['1', '1'],\n            ['2', '2'],\n            ['3', '3'],\n            ['4', '4'],\n            ['5', '5'],\n            ['6', '6'],\n            ['7', '7'],\n        ],\n        initValue: '0',\n        onChange: function(val) {}\n    });\n    let growPointerListener = new BB.PointerListener({\n        target: growSelect.getElement(),\n        onWheel: function(e) {\n            growSelect.setDeltaValue(e.deltaY);\n        }\n    });\n    growWrapper.appendChild(growSelect.getElement());\n    selectRow.appendChild(growWrapper);\n\n\n    let isContiguous = true;\n    let contiguousToggle = new Checkbox({\n        init: true,\n        label: LANG('bucket-contiguous'),\n        title: LANG('bucket-contiguous-title'),\n        callback: function (b) {\n            isContiguous = b;\n        },\n        css: {\n            marginTop: '10px',\n            paddingRight: '5px',\n            display: 'inline-block',\n        }\n    });\n    div.appendChild(contiguousToggle.getElement());\n\n\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n        }\n    };\n\n    this.getTolerance = function() {\n        return toleranceSlider.getValue();\n    };\n\n    this.getOpacity = function() {\n        return opacitySlider.getValue();\n    };\n\n    /**\n     * returns string 'current' | 'all' | 'above'\n     */\n    this.getSample = function() {\n        return modeSelect.getValue();\n    };\n\n    this.getGrow = function() {\n        return parseInt(growSelect.getValue(), 10);\n    }\n\n    this.getContiguous = function() {\n        return isContiguous;\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\n\n/**\n * Text Tool tab contents (color slider)\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function TextUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let hint = BB.el({\n        parent: div,\n        content: LANG('text-instruction'),\n    });\n\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n            //update();\n        }\n    };\n\n}","import {BB} from '../../../bb/bb';\nimport {Options} from '../base-components/options';\nimport {Checkbox} from '../base-components/checkbox';\nimport {KlSlider} from '../base-components/kl-slider';\nimport {LANG} from '../../../language/language';\n\n/**\n * Shape Tool tab contents\n *\n * p = {\n *     colorSlider: KlColorSlider// when opening tab, inserts it (snatches it from where else it was)\n * }\n *\n * @param p\n * @constructor\n */\nexport function ShapeUi(p) {\n    let div = BB.el({\n        css: {\n            margin: '10px'\n        }\n    });\n    let isVisible = true;\n\n    let colorDiv = BB.el({\n        parent: div,\n        css: {\n            marginBottom: '10px'\n        }\n    });\n\n    let previewSize = 35;\n    let previewPadding = 8;\n    let shape; // 'rect'|'ellipse'|'line'\n    let mode; // 'stroke'|'fill'\n\n\n    let rectStrokeSvgRect = BB.createSvg({\n        elementType: 'rect',\n        x: '' + previewPadding,\n        width: '' + (previewSize - previewPadding * 2)\n    });\n    let rectStrokeSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    rectStrokeSvg.appendChild(rectStrokeSvgRect);\n    BB.css(rectStrokeSvg, {\n        display: 'block'\n    });\n\n    let rectFilledSvgRect = BB.createSvg({\n        elementType: 'rect',\n        x: '' + previewPadding,\n        width: '' + (previewSize - previewPadding * 2)\n    });\n    let rectFilledSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    rectFilledSvg.appendChild(rectFilledSvgRect);\n    BB.css(rectFilledSvg, {\n        display: 'block'\n    });\n\n\n    let ellipseStrokeSvgEllipse = BB.createSvg({\n        elementType: 'ellipse',\n        cx: '' + (previewSize / 2),\n        cy: '' + (previewSize / 2),\n        rx: '' + (previewSize / 2 - previewPadding)\n    });\n    let ellipseStrokeSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize,\n    });\n    ellipseStrokeSvg.appendChild(ellipseStrokeSvgEllipse);\n    BB.css(ellipseStrokeSvg, {\n        display: 'block'\n    });\n\n    let ellipseFilledSvgEllipse = BB.createSvg({\n        elementType: 'ellipse',\n        cx: '' + (previewSize / 2),\n        cy: '' + (previewSize / 2),\n        rx: '' + (previewSize / 2 - previewPadding)\n    });\n    let ellipseFilledSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize,\n    });\n    ellipseFilledSvg.appendChild(ellipseFilledSvgEllipse);\n    BB.css(ellipseFilledSvg, {\n        display: 'block'\n    });\n\n\n    let lineSvgLine = BB.createSvg({\n        elementType: 'line',\n        x1: '' + previewPadding,\n        x2: '' + (previewSize - previewPadding)\n    });\n    let lineSvg = BB.createSvg({\n        elementType: 'svg',\n        width: '' + previewSize,\n        height: '' + previewSize\n    });\n    lineSvg.appendChild(lineSvgLine);\n    BB.css(lineSvg, {\n        display: 'block'\n    });\n\n    function updatePreviews() {\n        let strokeWidth = BB.clamp(Math.round(lineWidthSlider.getValue() / 10), 1, 10) + 'px';\n\n        let squish = 1.35;\n\n        BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n        BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\n\n        BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n        BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\n\n        BB.css(\n            lineSvgLine,\n            { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\n        );\n\n        if ((fixedToggle as any).getValue()) {\n            rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n            rectFilledSvgRect.setAttribute('y', '' + previewPadding);\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n        } else {\n            rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\n            rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n            rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\n            rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n\n            ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n            ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n        }\n\n        if ((snapToggle as any).getValue()) {\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\n            lineSvgLine.setAttribute('y2', '' + previewPadding);\n        } else {\n            lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\n            lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\n        }\n    }\n\n    let row1 = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'start'\n        }\n    });\n\n    let shapeOptions = new Options({\n        optionArr: [\n            {\n                id: 'rect-stroke',\n                label: rectStrokeSvg,\n                title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\n            },\n            {\n                id: 'ellipse-stroke',\n                label: ellipseStrokeSvg,\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\n            },\n            {\n                id: 'line',\n                label: lineSvg,\n                title: LANG('shape-line'),\n            },\n            {\n                id: 'rect-fill',\n                label: rectFilledSvg,\n                title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\n            },\n            {\n                id: 'ellipse-fill',\n                label: ellipseFilledSvg,\n                title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\n            },\n        ],\n        initId: 'rect',\n        onChange: function(id) {\n            let split = id.split('-');\n            shape = split[0];\n            mode = split[1];\n\n            BB.css(fixedToggle.getElement(), {\n                display: shape === 'line' ? 'none' : null\n            });\n            BB.css(snapToggle.getElement(), {\n                display: shape === 'line' ? null : 'none'\n            });\n            BB.css(lineWidthSlider.getElement(), {\n                display: (shape !== 'line' && mode === 'fill') ? 'none' : null\n            });\n        },\n        changeOnInit: true\n    });\n    shapeOptions.getElement().style.width = '120px';\n    row1.appendChild(shapeOptions.getElement());\n\n    let eraserToggle = new Checkbox({\n        init: false,\n        label: LANG('eraser'),\n        callback: function(b) {\n            updatePreviews();\n        }\n    });\n    row1.appendChild(eraserToggle.getElement());\n\n    let lineWidthSlider = new KlSlider({\n        label: LANG('shape-line-width'),\n        width: 250,\n        height: 30,\n        min: 1,\n        max: 200,\n        initValue: 4,\n        curve: 'quadratic',\n        onChange: function (val) {\n            updatePreviews();\n        },\n        formatFunc: function (v) {\n            return Math.round(v);\n        }\n    });\n    BB.css(lineWidthSlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(lineWidthSlider.getElement());\n\n    let opacitySlider = new KlSlider({\n        label: LANG('opacity'),\n        width: 250,\n        height: 30,\n        min: 0,\n        max: 1,\n        initValue: 1,\n        onChange: function (val) {\n        },\n        formatFunc: function (v) {\n            return Math.round(v * 100);\n        }\n    });\n    BB.css(opacitySlider.getElement(), {\n        marginTop: '10px'\n    });\n    div.appendChild(opacitySlider.getElement());\n\n    let row2 = BB.el({\n        parent: div,\n        css: {\n            display: 'flex',\n            alignItems: 'center',\n            marginTop: '10px'\n        }\n    });\n\n    let outwardsToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-outwards'),\n        callback: function(b) {},\n        css: {\n            width: '50%',\n            marginRight: '10px',\n        }\n    });\n    row2.appendChild(outwardsToggle.getElement());\n\n    let fixedToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-fixed'),\n        callback: function(b) {\n            updatePreviews();\n        },\n        css: {\n            flexGrow: '1',\n        }\n    });\n    row2.appendChild(fixedToggle.getElement());\n\n    let snapToggle = new Checkbox({\n        init: false,\n        label: LANG('shape-snap'),\n        title: LANG('shape-snap-title'),\n        callback: function(b) {\n            updatePreviews();\n        },\n        css: {\n            flexGrow: '1',\n        }\n    });\n    row2.appendChild(snapToggle.getElement());\n\n\n\n    updatePreviews();\n\n    // --- interface ---\n\n    this.getElement = function() {\n        return div;\n    };\n\n    this.setIsVisible = function(pIsVisible) {\n        isVisible = !!pIsVisible;\n        div.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            colorDiv.appendChild(p.colorSlider.getElement());\n            colorDiv.appendChild(p.colorSlider.getOutputElement());\n            //update();\n        }\n    };\n\n    this.getShape = function() {\n        return shape;\n    };\n\n    this.getMode = function() {\n        return mode;\n    };\n\n    this.getIsEraser = function() {\n        return (eraserToggle as any).getValue();\n    };\n\n    this.getOpacity = function() {\n        return opacitySlider.getValue();\n    };\n\n    this.getLineWidth = function() {\n        return lineWidthSlider.getValue();\n    };\n\n    this.getIsOutwards = function() {\n        return (outwardsToggle as any).getValue();\n    };\n\n    this.getIsFixed = function() {\n        return (fixedToggle as any).getValue();\n    };\n\n    this.getIsSnap = function() {\n        return (snapToggle as any).getValue();\n    };\n\n}","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../base-components/select';\r\nimport {ColorOptions} from '../base-components/color-options';\r\nimport {popup} from './popup';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * P = {\r\n *     currentColor: RGB, // current color\r\n *     secondaryColor: RGB,\r\n *     maxCanvasSize: number,\r\n *     canvasWidth: number, // current canvas size\r\n *     canvasHeight: number, // current canvas size\r\n *     workspaceWidth: number,\r\n *     workspaceHeight: number,\r\n *     onConfirm: function(width number, height number, color RGBA),\r\n *     onCancel: function()\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function newImageDialog(p) {\r\n\r\n    let currentColor = p.currentColor;\r\n    let secondaryColor = p.secondaryColor;\r\n    let maxCanvasSize = p.maxCanvasSize;\r\n    let canvasWidth = p.canvasWidth;\r\n    let canvasHeight = p.canvasHeight;\r\n    let workspaceWidth = p.workspaceWidth;\r\n    let workspaceHeight = p.workspaceHeight;\r\n    let onConfirm = p.onConfirm;\r\n    let onCancel = p.onCancel;\r\n\r\n\r\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\r\n        return BB.fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\r\n    }\r\n\r\n    let newImDiv = document.createElement(\"div\");\r\n    let widthWrapper = document.createElement(\"div\");\r\n    let heightWrapper = document.createElement(\"div\");\r\n    let widthInput = document.createElement(\"input\");\r\n    let widthUnit = document.createElement(\"div\");\r\n    let heightInput = document.createElement(\"input\");\r\n    let heightUnit = document.createElement(\"div\");\r\n    widthWrapper.style.position = \"relative\";\r\n    widthWrapper.style.width = \"145px\";\r\n    widthWrapper.style.height = \"35px\";\r\n    widthWrapper.style.lineHeight = \"30px\";\r\n    heightWrapper.style.width = \"145px\";\r\n    heightWrapper.style.height = \"35px\";\r\n    heightWrapper.style.lineHeight = \"30px\";\r\n\r\n    widthUnit.innerText = LANG('new-px');\r\n    widthUnit.style.color = '#888';\r\n    widthUnit.style.fontSize = \"12px\";\r\n    widthUnit.style.marginLeft = \"5px\";\r\n    widthUnit.style.cssFloat = \"right\";\r\n\r\n    heightUnit.innerText = LANG('new-px');\r\n    heightUnit.style.color = '#888';\r\n    heightUnit.style.fontSize = \"12px\";\r\n    heightUnit.style.marginLeft = \"5px\";\r\n    heightUnit.style.cssFloat = \"right\";\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = maxCanvasSize;\r\n    widthInput.style.cssFloat = \"right\";\r\n    widthInput.style.width = \"70px\";\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = maxCanvasSize;\r\n    heightInput.style.cssFloat = \"right\";\r\n    heightInput.style.width = \"70px\";\r\n    widthInput.value = canvasWidth;\r\n    heightInput.value = canvasHeight;\r\n    widthInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = function () {\r\n        (this as any).focus();\r\n        updateRatio();\r\n    };\r\n    widthWrapper.appendChild(widthUnit);\r\n    widthWrapper.appendChild(widthInput);\r\n    BB.appendTextDiv(widthWrapper, LANG('width') + \": \");\r\n    heightWrapper.appendChild(heightUnit);\r\n    heightWrapper.appendChild(heightInput);\r\n    BB.appendTextDiv(heightWrapper, LANG('height') + \": \");\r\n    let ratioWrapper = document.createElement(\"div\");\r\n    ratioWrapper.style.marginTop = '5px';\r\n    ratioWrapper.style.color = '#888';\r\n\r\n    let templateWrapper = document.createElement(\"div\");\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    let presetFitBtn = document.createElement(\"button\");\r\n    templateWrapper.style.marginBottom = \"10px\";\r\n    let presetCurrentBtn = document.createElement(\"button\");\r\n    let presetSquareBtn = document.createElement(\"button\");\r\n    let presetLandscapeBtn = document.createElement(\"button\");\r\n    let presetPortraitBtn = document.createElement(\"button\");\r\n    let presetOversizeBtn = document.createElement(\"button\");\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = \"5px\";\r\n    presetFitBtn.style.marginRight = \"5px\";\r\n    presetOversizeBtn.style.marginRight = \"5px\";\r\n    presetLandscapeBtn.style.marginTop = \"5px\";\r\n    presetLandscapeBtn.style.marginRight = \"5px\";\r\n    presetPortraitBtn.style.marginTop = \"5px\";\r\n    presetPortraitBtn.style.marginRight = \"5px\";\r\n\r\n    templateWrapper.appendChild(presetCurrentBtn);\r\n    templateWrapper.appendChild(presetFitBtn);\r\n    templateWrapper.appendChild(presetOversizeBtn);\r\n    templateWrapper.appendChild(presetSquareBtn);\r\n    templateWrapper.appendChild(presetLandscapeBtn);\r\n    templateWrapper.appendChild(presetPortraitBtn);\r\n\r\n    let templatePadding = 50;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = canvasWidth;\r\n        heightInput.value = canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth;\r\n        heightInput.value = workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = workspaceWidth + 500;\r\n        heightInput.value = workspaceHeight + 500;\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        let sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    let select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2']\r\n        ],\r\n        onChange: function(val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                let sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                let split = val.split(' ');\r\n                let sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        }\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.appendChild(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    let colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0}\r\n    ];\r\n    colorOptionsArr.push({\r\n        r: currentColor.r,\r\n        g: currentColor.g,\r\n        b: currentColor.b,\r\n        a: 1\r\n    });\r\n    colorOptionsArr.push({\r\n        r: secondaryColor.r,\r\n        g: secondaryColor.g,\r\n        b: secondaryColor.b,\r\n        a: 1\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        onChange: function(rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\r\n        }\r\n    });\r\n\r\n    let previewWrapper = document.createElement(\"div\");\r\n    BB.css(previewWrapper, {\r\n        boxSizing: 'border-box',\r\n        width: '340px',\r\n        height: '140px',\r\n        display: 'table',\r\n        backgroundColor: '#9e9e9e',\r\n        padding: '10px',\r\n        marginTop: '10px',\r\n        boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n        marginLeft: '-20px',\r\n        colorScheme: 'only light',\r\n    });\r\n    let preview = document.createElement(\"div\");\r\n    BB.css(preview, {\r\n        width: 200 + \"px\",\r\n        height: 100 + \"px\",\r\n        backgroundColor: \"#fff\",\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        color: \"#aaa\",\r\n        fontSize: \"16px\",\r\n        fontWeight: \"bold\",\r\n        textAlign: \"center\",\r\n        verticalAlign: \"center\",\r\n        display: \"table\",\r\n        overflow: \"hidden\",\r\n        boxShadow: \"0px 0px 3px rgba(0,0,0,0.5)\"\r\n    });\r\n    let previewcell = document.createElement(\"div\");\r\n    previewcell.style.display = \"table-cell\";\r\n    previewcell.style.verticalAlign = \"middle\";\r\n    previewcell.appendChild(preview);\r\n    previewWrapper.appendChild(previewcell);\r\n    let cell = BB.appendTextDiv(preview, \"\");\r\n    //let ratio = BB.appendTextDiv(cell, \"1:2\");\r\n    cell.style.display = \"table-cell\";\r\n    cell.style.verticalAlign = \"middle\";\r\n    let prevW = parseInt(widthInput.value);\r\n    let prevH = parseInt(heightInput.value);\r\n\r\n    function updateRatio() {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function HCF(u, v) {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V))\r\n                    return V;\r\n                if (!(V %= U))\r\n                    return U;\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize)\r\n                w = maxCanvasSize;\r\n            else if (h > maxCanvasSize)\r\n                h = maxCanvasSize;\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        let commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        let reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        prevW = w;\r\n        prevH = h;\r\n        let realw = w;\r\n        let T = HCF(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + \"px\";\r\n        preview.style.height = h + \"px\";\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = \"url(\" + url + \")\";\r\n        });\r\n    }\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.appendChild(templateWrapper);\r\n    let secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end'\r\n        }\r\n    });\r\n    let secondRowLeft = BB.el({\r\n        parent: secondRow\r\n    });\r\n    secondRowLeft.appendChild(widthWrapper);\r\n    secondRowLeft.appendChild(heightWrapper);\r\n    secondRowLeft.appendChild(ratioWrapper);\r\n    secondRow.appendChild(colorOptions.getElement());\r\n\r\n    newImDiv.appendChild(previewWrapper);\r\n\r\n    popup({\r\n        target: p.klRootEl,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n\r\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\r\n        },\r\n        clickOnEnter: 'Ok'\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\n// @ts-ignore\nimport collapseImg from 'url:~/src/app/img/ui/ui-collapse.svg';\nimport {LANG} from \"../../../language/language\";\n\n/**\n * button that allows to collapse toolspace (for mobile)\n *\n * p = {\n *     onChange: function()\n * }\n *\n * @param p\n * @constructor\n */\nexport function ToolspaceCollapser(p) {\n    let isOpen = true;\n    let directionStr = 'right'; // 'left' | 'right'\n\n    function update() {\n        if (directionStr === 'left') {\n            icon.style.transform = isOpen ? 'rotate(180deg)' : '';\n        } else {\n            icon.style.transform = isOpen ? '' : 'rotate(180deg)';\n        }\n    }\n\n    let div = BB.el({\n        css: {\n            width: '36px',\n            height: '36px',\n            background: 'rgba(100, 100, 100, 0.9)',\n            color: '#fff',\n            position: 'absolute',\n            top: '0',\n            textAlign: 'center',\n            lineHeight: '36px',\n            cursor: 'pointer',\n            userSelect: 'none',\n            padding: '6px',\n            boxSizing: 'border-box'\n        },\n        title: LANG('toggle-show-tools'),\n        onClick: function(e) {\n            e.preventDefault();\n            isOpen = !isOpen;\n            update();\n            p.onChange();\n        }\n    });\n\n    let icon = BB.el({\n        parent: div,\n        css: {\n            backgroundImage: `url(${collapseImg})`,\n            width: '100%',\n            height: '100%',\n            backgroundSize: 'contain',\n            backgroundRepeat: 'no-repeat',\n            backgroundPosition: 'center',\n            userSelect: 'none'\n        }\n    });\n    div.oncontextmenu = function () {\n        return false;\n    };\n\n    // --- interface ---\n    this.isOpen = function() {\n        return isOpen;\n    };\n\n    /**\n     *\n     * @param dirStr\n     */\n    this.setDirection = function(dirStr) {\n        directionStr = dirStr;\n        update();\n    };\n\n    this.getElement = function() {\n        return div;\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"l3vCz\");","import { BB } from '../../../bb/bb';\r\nimport { renderText } from '../../image-operations/render-text';\r\nimport { ColorOptions } from '../base-components/color-options';\r\nimport { Select } from '../base-components/select';\r\nimport { ImageRadioList } from '../base-components/image-radio-list';\r\nimport { ImageToggle } from '../base-components/image-toggle';\r\nimport { KlSlider } from '../base-components/kl-slider';\r\nimport { popup } from './popup';\r\n// @ts-ignore\r\nimport alignLeftImg from 'url:~/src/app/img/ui/align-left.svg';\r\n// @ts-ignore\r\nimport alignCenterImg from 'url:~/src/app/img/ui/align-center.svg';\r\n// @ts-ignore\r\nimport alignRightImg from 'url:~/src/app/img/ui/align-right.svg';\r\n// @ts-ignore\r\nimport typoItalicImg from 'url:~/src/app/img/ui/typo-italic.svg';\r\n// @ts-ignore\r\nimport typoBoldImg from 'url:~/src/app/img/ui/typo-bold.svg';\r\n// @ts-ignore\r\nimport toolZoomInImg from 'url:~/src/app/img/ui/tool-zoom-in.svg';\r\n// @ts-ignore\r\nimport toolZoomOutImg from 'url:~/src/app/img/ui/tool-zoom-out.svg';\r\nimport { BBox, IRGB } from '../../kl.types';\r\nimport { KlCanvas } from '../../canvas/kl-canvas';\r\nimport { LANG } from '../../../language/language';\r\n\r\n/**\r\n * Text Tool dialog\r\n *\r\n * confirmP = {\r\n *     x: number,\r\n *     y: number,\r\n *     textStr: string,\r\n *     align: 'left' | 'center' | 'right',\r\n *     isItalic: boolean,\r\n *     isBold: boolean,\r\n *     color: rgb,\r\n *     size: number, // px\r\n *     font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy',\r\n *     opacity: number, // 0 - 1\r\n * }\r\n *\r\n * @param p\r\n */\r\nexport function textToolDialog(\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: 'left' | 'center' | 'right'; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n        opacity: number; // 0 - 1; default 1\r\n        onConfirm: (confirmP) => void;\r\n        klRootEl: HTMLElement;\r\n        bbox: BBox;\r\n    }\r\n) {\r\n\r\n    let div = BB.el({});\r\n\r\n    let isSmallWidth = p.bbox.width < 550;\r\n    let isSmallHeight = p.bbox.height < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    let width = isSmallWidth ? 340 : 540;\r\n    let height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    let layerArr = p.klCanvas.getLayersFast();\r\n    let textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    let textCtx = textCanvas.getContext('2d');\r\n    let targetCanvas = BB.canvas(width, height);\r\n    let targetCtx = targetCanvas.getContext('2d');\r\n    let layersCanvas = BB.canvas(width, height);\r\n    let layersCtx = layersCanvas.getContext('2d');\r\n    let previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    let previewCtx = previewCanvas.getContext('2d');\r\n    BB.css(previewCanvas, {\r\n        display: 'block'\r\n    });\r\n    let previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            colorScheme: 'only light',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: function () {\r\n            textInput.focus();\r\n        }\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            boxShadow: 'rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset',\r\n            pointerEvents: 'none',\r\n        }\r\n    });\r\n    previewWrapper.appendChild(previewCanvas);\r\n    let checkerPattern = previewCtx.createPattern(BB.createCheckerCanvas(8), 'repeat');\r\n    let emptyCanvas = BB.canvas(1, 1);\r\n    {\r\n        let ctx = emptyCanvas.getContext('2d');\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updatePreview() {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        let colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        let bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        let rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        let rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        let centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        let centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        let padding = 100;\r\n        let fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            let borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = 0.2;\r\n            layersCtx.drawImage(emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (var i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    function move(x, y) {\r\n        let rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    let previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        pointers: 1,\r\n        onPointer: function (e) {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: function (e) {\r\n            changeZoomFac(-e.deltaY);\r\n        }\r\n    });\r\n\r\n    const wheelPrevent = (event) => {\r\n        event.preventDefault();\r\n    }\r\n    BB.addEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n\r\n\r\n\r\n    let row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px'\r\n        }\r\n    });\r\n    let row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between'\r\n        }\r\n    });\r\n    let row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px'\r\n        }\r\n    });\r\n    let row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px'\r\n        }\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    let selectedRgbaObj = { r: 0, g: 0, b: 0, a: 1 };\r\n    let colorOptionsArr = [\r\n        { r: 0, g: 0, b: 0, a: 1 },\r\n        { r: 255, g: 255, b: 255, a: 1 }\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    let colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: function (rgbaObj) {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        }\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.appendChild(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n    function changeZoomFac(d) {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n    function canZoom(d) {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    let zoomWrapper = BB.el({\r\n        parent: row1,\r\n        css: {\r\n\r\n        }\r\n    })\r\n\r\n    let zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: function () {\r\n            changeZoomFac(1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold'\r\n        }\r\n    }) as HTMLButtonElement;\r\n    let zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: function () {\r\n            changeZoomFac(-1);\r\n        },\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px'\r\n        }\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    let sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size\r\n        },\r\n        css: {\r\n            width: '60px'\r\n        },\r\n        onChange: function () {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        }\r\n    }) as HTMLInputElement;\r\n    let sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: function (e) {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        }\r\n    });\r\n\r\n    let modeWrapper;\r\n    let fontSelect;\r\n    let fontPointerListener;\r\n    {\r\n        modeWrapper = BB.el({\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px'\r\n            }\r\n        });\r\n        fontSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['sans-serif', 'Sans-serif'],\r\n                ['serif', 'Serif'],\r\n                ['monospace', 'Monospace'],\r\n                ['cursive', 'Cursive'],\r\n                ['fantasy', 'Fantasy'],\r\n            ],\r\n            initValue: p.font,\r\n            onChange: function (val) {\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        modeWrapper.appendChild(fontSelect.getElement());\r\n        row2.appendChild(modeWrapper);\r\n\r\n        fontPointerListener = new BB.PointerListener({\r\n            target: fontSelect.getElement(),\r\n            onWheel: function (e) {\r\n                fontSelect.setDeltaValue(e.deltaY);\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    let alignRadioList = new ImageRadioList({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n            }\r\n        ],\r\n        initId: p.align,\r\n        onChange: function (id) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(alignRadioList.getElement());\r\n\r\n    let italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: function (b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(italicToggle.getElement());\r\n\r\n    let boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: function (b) {\r\n            updatePreview();\r\n        }\r\n    });\r\n    row3.appendChild(boldToggle.getElement());\r\n\r\n\r\n\r\n    let opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 0,\r\n        max: 1,\r\n        initValue: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        onChange: function (v) {\r\n            updatePreview();\r\n        },\r\n        formatFunc: function (v) {\r\n            return Math.round(v * 100);\r\n        }\r\n    });\r\n    row3.appendChild(opacitySlider.getElement());\r\n\r\n\r\n\r\n    let textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'nowrap',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px'\r\n        },\r\n        onChange: function () {\r\n            updatePreview();\r\n        }\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(function () {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    let closefunc;\r\n    let keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr) {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        }\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll() {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    popup({\r\n        target: p.klRootEl,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: [\"Ok\", \"Cancel\"],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px'\r\n        },\r\n        callback: function (val) {\r\n            let result = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: sizeInput.value,\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue()\r\n            };\r\n\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            BB.removeEventListener(previewCanvas, 'wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n        closefunc: function (func) {\r\n            closefunc = func;\r\n        },\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"cZo4h\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"11saA\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hcB4I\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"gPzoD\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"kKe79\");","import { BB } from '../../../bb/bb';\r\nimport { CropCopy } from '../components/crop-copy';\r\nimport { Checkbox } from '../base-components/checkbox';\r\nimport { popup } from './popup';\r\nimport { LANG } from '../../../language/language';\r\n\r\n/**\r\n *\r\n * p = {\r\n *     image: convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas},\r\n *     maxSize: number,\r\n *     target: htmlElement,\r\n *     callback: func(\r\n *         {\r\n *             type: 'as-image',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'as-image-psd',\r\n *             image: convertedPsd,\r\n *             cropObj: {x: number, y: number, width: number, height: number}\r\n *         } | {\r\n *             type: 'as-layer',\r\n *             image: image | canvas,\r\n *         } | {\r\n *             type: 'cancel',\r\n *         }\r\n *     )\r\n * }\r\n *\r\n * @param p {}\r\n */\r\nexport function showImportImageDialog(p) {\r\n    const div = BB.el({});\r\n\r\n    const isSmall = p.bbox.width < 550 || p.bbox.height < 550;\r\n    const style = isSmall ? {} : { width: '500px' };\r\n    let resolutionEl;\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: function (width, height) {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        }\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n        borderTop: '1px solid #bbb',\r\n        borderBottom: '1px solid #bbb'\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n    div.appendChild(cropCopy.getEl());\r\n\r\n\r\n    resolutionEl = BB.el({\r\n        parent: div,\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        }\r\n    });\r\n    function updateResolution(w: number, h: number) {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span style=\"color:#f00\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings(psdWarningArr) {\r\n        let contentArr = [];\r\n        let warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join(\"\\n\"));\r\n    }\r\n\r\n    let flattenCheckbox;\r\n    if (p.image.type === 'psd') {\r\n        const noteStyle = {\r\n            background: 'rgba(255,255,0,0.5)',\r\n            padding: '10px',\r\n            marginTop: '5px',\r\n            marginBottom: '5px',\r\n            border: '1px solid #e7d321',\r\n            borderRadius: '5px'\r\n        };\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: function (b) {\r\n                    doFlatten = b;\r\n                }\r\n            });\r\n            div.appendChild(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    content: LANG('import-psd-limited-support'),\r\n                    css: noteStyle\r\n                });\r\n                noteEl.appendChild(BB.el({\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    onClick: function () {\r\n                        showWarnings(p.image.warningArr);\r\n                    }\r\n                }));\r\n                div.appendChild(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                content: LANG('import-psd-unsupported'),\r\n                css: noteStyle\r\n            });\r\n            div.appendChild(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback(result) {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        cropCopy.destroy();\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: croppedImage\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    p.image.layers = null;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel'\r\n            });\r\n        }\r\n    }\r\n    popup({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: div,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), \"Cancel\"],\r\n        callback: callback,\r\n        autoFocus: 'As Image'\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\nimport {Psd} from 'ag-psd/dist/psd';\nimport {IKlProject, IKlPsd, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\n\nlet kl2PsdMap;\nlet psd2KlMap;\n\nfunction init() {\n    if (kl2PsdMap) {\n        return;\n    }\n\n    kl2PsdMap = {\n        'source-over': 'normal',\n\n        'darken': 'darken',\n        'multiply': 'multiply',\n        'color-burn': 'color burn',\n\n        'lighten': 'lighten',\n        'screen': 'screen',\n        'color-dodge': 'color dodge',\n\n        'overlay': 'overlay',\n        'soft-light': 'soft light',\n        'hard-light': 'hard light',\n\n        'difference': 'difference',\n        'exclusion': 'exclusion',\n\n        'hue': 'hue',\n        'saturation': 'saturation',\n        'color': 'color',\n        'luminosity': 'luminosity',\n    };\n\n    psd2KlMap = {};\n    let keys = Object.keys(kl2PsdMap);\n    for (let i = 0; i < keys.length; i++) {\n        psd2KlMap[kl2PsdMap[keys[i]]] = keys[i];\n    }\n}\n\nexport function blendPsdToKl(str: string): IMixMode {\n    init();\n    return psd2KlMap[str];\n}\n\nexport function blendKlToPsd(str: string): string {\n    init();\n    return kl2PsdMap[str];\n}\n\n\n/**\n * Converts ag-psd object into something that KlCanvas can represent\n * @param psdObj\n */\nexport function readPsd(psdObj: Psd): IKlPsd {\n    let result: IKlPsd = {\n        type: 'psd',\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height\n    };\n\n    function addWarning(warningStr) {\n        if (!result.warningArr) {\n            result.warningArr = [];\n        }\n        if (result.warningArr.includes(warningStr)) {\n            return;\n        }\n        result.warningArr.push(warningStr);\n    }\n\n    function getMixModeStr(blendMode): IMixMode {\n        let mixModeStr: IMixMode = blendPsdToKl(blendMode);\n        if (!mixModeStr) {\n            addWarning('blend-mode');\n            mixModeStr = 'source-over';\n        }\n        return mixModeStr;\n    }\n\n    if (psdObj.bitsPerChannel !== 8) {\n        addWarning('bits-per-channel');\n    }\n\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n\n    // count resulting layers\n    let maxLayers = MAX_LAYERS;\n    let layerCount = 0;\n    function countWithinGroup(groupObj) {\n        let result = 0;\n        if (groupObj.blendMode) {\n            let mixModeStr = blendPsdToKl(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== 'source-over') {\n                return 1;\n            }\n        }\n        for (let i = 0; i < groupObj.children.length; i++) {\n            let item = groupObj.children[i];\n            if (item.clipping || item.adjustment) {\n                continue;\n            }\n\n            if (item.children) {\n                addWarning('group');\n                result += countWithinGroup(item);\n            } else {\n                result++;\n            }\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n\n    result.layers = [];\n\n    function prepareMask(maskCanvas, defaultColor) {\n        const groupMaskCtx = maskCanvas.getContext('2d');\n        let imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = imData.data[i];\n            }\n        } else {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = 255 - imData.data[i];\n            }\n        }\n        groupMaskCtx.putImageData(imData, 0, 0);\n    }\n\n    function convertGroup(psdGroupObj): {\n        name: string;\n        mixModeStr: IMixMode;\n        opacity: number;\n        image: HTMLCanvasElement;\n    }[] {\n\n        let resultArr: {\n            name: string;\n            mixModeStr: IMixMode;\n            opacity: number;\n            image: HTMLCanvasElement;\n        }[] = [];\n        let groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\n        let groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\n        let groupCanvas;\n        let groupCtx;\n        if (groupMixModeStr !== 'source-over') {\n            groupCanvas = createCanvas(result.width, result.height);\n            groupCtx = groupCanvas.getContext('2d');\n        }\n\n\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning('mask');\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\n        }\n\n\n        for (let i = 0; i < psdGroupObj.children.length; i++) {\n            let item = psdGroupObj.children[i];\n            if (item.clipping) {\n                continue;\n            }\n            if (item.adjustment) {\n                addWarning('adjustment');\n                continue;\n            }\n\n            let hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\n            if (hasClipping) {\n                addWarning('clipping');\n            }\n\n            if (item.children) {\n                let innerArr = convertGroup(item);\n\n                for (let e = 0; e < innerArr.length; e++) {\n                    let innerItem = innerArr[e];\n                    let innerCtx = innerItem.image.getContext('2d');\n\n                    // clipping\n                    if (hasClipping) {\n                        let clippingCanvas = createCanvas(result.width, result.height);\n                        let clippingCtx = clippingCanvas.getContext('2d');\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\n\n                        for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\n                            let clippingItem = psdGroupObj.children[f];\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                                continue;\n                            }\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                            clippingCtx.globalAlpha = clippingItem.opacity;\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\n                        }\n\n                        innerCtx.globalCompositeOperation = 'source-atop';\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\n                    }\n\n\n\n                    // group mask\n                    if (psdGroupObj.mask) {\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                    }\n\n                    if (groupCanvas) {\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                        groupCtx.globalAlpha = innerItem.opacity;\n                        groupCtx.drawImage(innerItem.image, 0, 0);\n\n                    } else {\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\n                        resultArr.push(innerItem);\n                    }\n                }\n\n                continue;\n            }\n\n            let canvas = createCanvas(result.width, result.height);\n            let ctx = canvas.getContext('2d');\n            if (item.canvas) { // if a layer is empty it has no canvas\n                ctx.drawImage(item.canvas, item.left, item.top);\n            }\n\n            // effects\n            if (item.effects) {\n                addWarning('layer-effect');\n            }\n\n            // mask\n            if (item.mask) {\n                addWarning('mask');\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\n\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n            }\n\n            // clipping\n            if (hasClipping) {\n                let clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\n                let clippingCtx = clippingCanvas.getContext('2d');\n                clippingCtx.drawImage(item.canvas, 0, 0);\n\n                for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\n                    let clippingItem = psdGroupObj.children[e];\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                        continue;\n                    }\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                    clippingCtx.globalAlpha = clippingItem.opacity;\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\n                }\n\n                ctx.globalCompositeOperation = 'source-atop';\n                ctx.drawImage(clippingCanvas, item.left, item.top);\n            }\n\n            // group mask\n            if (psdGroupObj.mask) {\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n            }\n\n            if (groupCanvas) {\n                if (groupOpacity > 0) {\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                    groupCtx.drawImage(canvas, 0, 0);\n                }\n\n            } else {\n                resultArr.push({\n                    name: item.name,\n                    opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\n                    mixModeStr: getMixModeStr(item.blendMode),\n                    image: canvas,\n                });\n            }\n        }\n\n        if (groupCanvas) {\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas,\n                }\n            ];\n        }\n\n        return resultArr;\n    }\n\n    result.layers = convertGroup({\n        name: 'root',\n        opacity: 1,\n        blendMode: 'normal',\n        children: psdObj.children\n    });\n\n    return result;\n}\n\nexport function klPsdToKlProject(klPsd: IKlPsd): IKlProject {\n    // only share references to Canvas elements\n    const result: IKlProject = {\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: [],\n    };\n    if (klPsd.layers) {\n        result.layers = result.layers.concat(klPsd.layers.map(item => {\n            return {\n                name: item.name,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                image: item.image,\n            };\n        }));\n    } else {\n        // flattened\n        result.layers.push({\n            name: LANG('background'),\n            opacity: 1,\n            mixModeStr: 'source-over',\n            image: klPsd.canvas,\n        });\n    }\n    return result;\n}","//browser storage indexedDB\n\n\nimport {IKlStorageProject} from '../kl.types';\n\nconst indexedDbIsSupported = !!window.indexedDB;\nlet dbNameStr = 'Klecks';\nconst storageNameStr = 'ProjectStore';\n\nexport function setDbName(name: string) {\n    dbNameStr = '' + name;\n}\n\n/**\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\n * with index 'id'\n *\n * @param actionFunction function(storeObj) - what you want to execute during transaction\n * @param successCallback function() - on succesful transaction\n * @param errorCallback function(errorStr) - on error\n */\nfunction execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\n\n    let hasFinished = false;\n\n    function onSuccess() {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        successCallback();\n    }\n\n    function onError(errorStr) {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        errorCallback(errorStr);\n    }\n\n    if (!indexedDbIsSupported) {\n        setTimeout(function () {\n            onError('no indexed db available');\n        }, 0);\n        return;\n    }\n    let requestObj;\n\n    try {\n        requestObj = window.indexedDB.open(dbNameStr, 1);\n    } catch (e) {\n        onError(e.message);\n        return;\n    }\n\n    requestObj.onupgradeneeded = function (e) {\n        try {\n            let db = requestObj.result;\n            let store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\n            store.createIndex('id', 'id', {unique: true});\n        } catch (e) {\n            onError(e.message);\n        }\n    };\n    requestObj.onerror = function (e) {\n        onError('indexedDB.open failed, ' + requestObj.error);\n    };\n    requestObj.onsuccess = function (e) {\n        let databaseObj;\n        let transactionObj;\n        let storeObj;\n\n        try {\n            databaseObj = requestObj.result;\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\n                //someone maybe messed with the db, or creation failed earlier\n                //it's broken -> destroy\n                window.indexedDB.deleteDatabase(dbNameStr);\n                onError('object store ' + storageNameStr + ' missing. destroying db');\n                return;\n            }\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\n            storeObj = transactionObj.objectStore(storageNameStr);\n            storeObj.index('id');\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n\n        databaseObj.onerror = function (e) {\n            onError('database error, ' + databaseObj.error);\n        };\n\n        try {\n            actionFunction(storeObj);\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n\n        transactionObj.oncomplete = function () {\n            onSuccess();\n            databaseObj.close();\n        };\n        transactionObj.onerror = function () {\n            onError('transaction error, ' + transactionObj.error);\n        };\n    };\n}\n\n/**\n * getKlProjectObj {\n *     width: int,\n *     height: int,\n *     layers: {\n *        name: string,\n *        opacity: float (0 - 1),\n *        mixModeStr: string,\n *        image: image object                <--------- image already loaded!\n *     }[]\n * }\n *\n * @param successCallback function - called when succesfully queried. passes KlProjectObj\n * @param errorCallback - function(errorStr) - called when error during query\n */\nexport function getKlProjectObj(successCallback, errorCallback) {\n    if (indexedDbIsSupported) {\n        let query;\n        execIndexedDBTransaction(function (storeObj) {\n            query = storeObj.get(1);\n        }, function () {\n            successCallback(query.result);\n        }, function (errorStr) {\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\n        });\n    } else {\n        successCallback(null);\n    }\n}\n\n/**\n * stores a klProjectObj into id = 1 in database:dbNameStr > storage: storageNameStr\n *\n * KlProjectObj {\n *     width: int,\n *     height: int,\n *     layers: {\n *        name: string,\n *        opacity: float (0 - 1),\n *        mixModeStr: string,\n *        blob: blob object                 <--------- blob!\n *     }[]\n * }\n *\n * @param storageProject IKlStorageProject - project to be stored\n * @param successCallback function() - on successful transaction\n * @param errorCallback function(errorStr) - on error\n */\nexport function storeKlProjectObj(storageProject: IKlStorageProject, successCallback, errorCallback) {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.put(storageProject);\n    }, function () {\n        successCallback();\n    }, function (errorStr) {\n        errorCallback(errorStr);\n    });\n\n}\n\n/**\n * removes id = 1 from database:dbNameStr > storage: storageNameStr\n *\n * @param successCallback function() - on successful transaction\n * @param errorCallback function(error) - on error\n */\nexport function clear(successCallback, errorCallback) {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.delete(1);\n    }, function () {\n        successCallback();\n    }, function (error) {\n        errorCallback(error);\n    });\n\n}\n","import {IFilter} from '../kl.types';\n// @ts-ignore\nimport glBrightnessContrastImg from 'url:~/src/app/img/ui/edit-brightness-contrast.svg';\n// @ts-ignore\nimport cropExtendImg from 'url:~/src/app/img/ui/edit-crop.svg';\n// @ts-ignore\nimport glCurvesImg from 'url:~/src/app/img/ui/edit-curves.svg';\n// @ts-ignore\nimport flipImg from 'url:~/src/app/img/ui/edit-flip.svg';\n// @ts-ignore\nimport glHueSaturationImg from 'url:~/src/app/img/ui/edit-hue-saturation.svg';\n// @ts-ignore\nimport invertImg from 'url:~/src/app/img/ui/edit-invert.png';\n// @ts-ignore\nimport glPerspectiveImg from 'url:~/src/app/img/ui/edit-perspective.svg';\n// @ts-ignore\nimport resizeImg from 'url:~/src/app/img/ui/edit-resize.svg';\n// @ts-ignore\nimport rotateImg from 'url:~/src/app/img/ui/edit-rotate.svg';\n// @ts-ignore\nimport glTiltShiftImg from 'url:~/src/app/img/ui/edit-tilt-shift.png';\n// @ts-ignore\nimport toAlphaImg from 'url:~/src/app/img/ui/edit-to-alpha.svg';\n// @ts-ignore\nimport transformImg from 'url:~/src/app/img/ui/edit-transform.svg';\n// @ts-ignore\nimport glBlurImg from 'url:~/src/app/img/ui/edit-triangle-blur.png';\n// @ts-ignore\nimport glUnsharpMaskImg from 'url:~/src/app/img/ui/edit-unsharp-mask.png';\n// @ts-ignore\nimport aImg from 'url:~/src/app/img/ui/';\nimport {LANG, languageStrings} from '../../language/language';\n\n\nexport const filterLibStatus = {\n    isLoaded: false,\n};\nexport const filterLib: {\n    [key:string]: IFilter;\n} = {\n    glBrightnessContrast: {\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\n        name: '',\n        buttonLabel: '',\n        webgl: true,\n        updateContext: true,\n        icon: glBrightnessContrastImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    cropExtend: {\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\n        name: '',\n        buttonLabel: '',\n        icon: cropExtendImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    glCurves: {\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\n        name: '',\n        buttonLabel: '',\n        icon: glCurvesImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    flip: {\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\n        name: '',\n        buttonLabel: '',\n        icon: flipImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glHueSaturation: {\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\n        name: '',\n        buttonLabel: '',\n        icon: glHueSaturationImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    invert: {\n        lang: {name: 'filter-invert', button: 'filter-invert'},\n        name: '',\n        icon: invertImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glPerspective: {\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\n        name: '',\n        buttonLabel: '',\n        icon: glPerspectiveImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    resize: {\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\n        name: '',\n        buttonLabel: '',\n        icon: resizeImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    rotate: {\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\n        name: '',\n        buttonLabel: '',\n        icon: rotateImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    glTiltShift: {\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\n        name: '',\n        buttonLabel: '',\n        icon: glTiltShiftImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    toAlpha: {\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\n        name: '',\n        buttonLabel: '',\n        icon: toAlphaImg,\n        webgl: true,\n        updateContext: false,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    transform: {\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\n        name: '',\n        buttonLabel: '',\n        icon: transformImg,\n        webgl: false,\n        neededWithWebGL: true,\n        updateContext: true,\n        updatePos: false,\n        ieFails: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glBlur: {\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\n        name: '',\n        buttonLabel: '',\n        icon: glBlurImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    glUnsharpMask: {\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\n        name: '',\n        buttonLabel: '',\n        icon: glUnsharpMaskImg,\n        webgl: true,\n        updateContext: true,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    }\n};\n\nfunction updateNames() {\n    const keys = Object.keys(filterLib);\n    keys.forEach(item => {\n        filterLib[item].name = LANG(filterLib[item].lang.name);\n        filterLib[item].buttonLabel = LANG(filterLib[item].lang.button);\n    });\n}\nupdateNames();\n\nlanguageStrings.subscribe(() => {\n    updateNames();\n});","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1Oflz\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"dGQ4d\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8rV5I\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"iPOLX\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"2WSEP\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5bY62\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"eyn8D\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8KV42\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"bXtKb\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"fGBUx\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8Rt9n\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"1nMkR\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"5voce\");","import {PenBrush} from './pen-brush';\nimport {BlendBrush} from './blend-brush';\nimport {SketchyBrush} from './sketchy-brush';\nimport {PixelBrush} from './pixel-brush';\nimport {EraserBrush} from './eraser-brush';\nimport {SmudgeBrush} from './smudge-brush';\nimport {ChemyBrush} from './chemy-brush';\n\nexport const brushes = {\n    PenBrush,\n    BlendBrush,\n    SketchyBrush,\n    PixelBrush,\n    ChemyBrush,\n    SmudgeBrush,\n    EraserBrush,\n}","import {BB} from '../../bb/bb';\nimport {alphaImArr} from './brushes-common';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\n\nexport function PenBrush() {\n\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let settingColor, settingSize = 2, settingSpacing = 0.8489, settingOpacity = 1;\n    let settingColorStr;\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\n    let settingLockLayerAlpha = false;\n    let ALPHA_CIRCLE = 0, ALPHA_CHALK = 1, ALPHA_CAL = 2, ALPHA_SQUARE = 3;\n    let settingAlphaId = ALPHA_CIRCLE;\n\n    let lineToolLastDot;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n\n    let isDrawing = false;\n    let alphaOpacityArr = [1, 0.9, 1, 1];\n\n    //mipmapping\n    let alphaCanvas128 = BB.canvas(128, 128);\n    let alphaCanvas64 = BB.canvas(64, 64);\n    let alphaCanvas32 = BB.canvas(32, 32);\n\n    let bezierLine = null;\n\n    let twoPI = Math.PI * 2;\n    let hasDrawnDot = false; // current stroke has drawn at least one dot\n    let inputArr: {x: number, y: number, pressure: number}[];\n\n    // pressure: 0-1\n    function calcOpacity(pressure: number) {\n        return settingOpacity * (settingHasOpacityPressure ? pressure * pressure : 1);\n    }\n\n    function updateAlphaCanvas() {\n        if (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE) {\n            return;\n        }\n\n        let instructionArr = [\n            [alphaCanvas128, 128],\n            [alphaCanvas64, 64],\n            [alphaCanvas32, 32]\n        ];\n\n        let ctx;\n\n        for (let i = 0; i < instructionArr.length; i++) {\n            ctx = (instructionArr[i][0] as any).getContext(\"2d\");\n\n            ctx.save();\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.fillStyle = \"rgba(\" + settingColor.r + \", \" + settingColor.g + \", \" + settingColor.b + \", \" + alphaOpacityArr[settingAlphaId] + \")\";\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.globalCompositeOperation = \"destination-in\";\n            ctx.imageSmoothingQuality = 'high';\n            ctx.drawImage(alphaImArr[settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.restore();\n        }\n    }\n\n    /**\n     *\n     *\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     * @param angle\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\n     */\n    function drawDot(x, y, size, opacity, angle?, before?) {\n        if (size <= 0) {\n            return;\n        }\n\n        if (settingLockLayerAlpha) {\n            context.globalCompositeOperation = \"source-atop\";\n        }\n\n        if (!before || before[3] !== opacity) {\n            context.globalAlpha = opacity;\n        }\n\n        if (!before && (settingAlphaId === ALPHA_CIRCLE || settingAlphaId === ALPHA_SQUARE)) {\n            context.fillStyle = settingColorStr;\n        }\n\n        if (settingAlphaId === ALPHA_CIRCLE) {\n            context.beginPath();\n            context.arc(x, y, size, 0, twoPI);\n            context.closePath();\n            context.fill();\n            hasDrawnDot = true;\n\n        } else if (settingAlphaId === ALPHA_SQUARE) {\n            if (angle !== undefined) {\n                context.save();\n                context.translate(x, y);\n                context.rotate(angle / 180 * Math.PI);\n                context.fillRect(-size, -size, size * 2, size * 2);\n                context.restore();\n                hasDrawnDot = true;\n            }\n\n        } else { // other brush alphas\n            context.save();\n            context.translate(x, y);\n            let targetMipmap = alphaCanvas128;\n            if (size <= 32 && size > 16) {\n                targetMipmap = alphaCanvas64;\n            } else if (size <= 16) {\n                targetMipmap = alphaCanvas32;\n            }\n            context.scale(size, size);\n            if (settingAlphaId === ALPHA_CHALK) {\n                context.rotate(((x + y) * 53123) % twoPI); // without mod it sometimes looks different\n            }\n            context.drawImage(targetMipmap, -1, -1, 2, 2);\n\n            context.restore();\n            hasDrawnDot = true;\n        }\n    }\n\n    function continueLine(x, y, size, pressure) {\n        if (bezierLine === null) {\n            bezierLine = new BB.BezierLine();\n            bezierLine.add(lastInput.x, lastInput.y, 0, function(){});\n        }\n\n        let drawArr = []; //draw instructions. will be all drawn at once\n\n        function dotCallback(val) {\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\n            let localOpacity = calcOpacity(localPressure);\n            let localSize = Math.max(0.1, settingSize * (settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        }\n\n        let localSpacing = size * settingSpacing;\n        if (x === null) {\n            bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        context.save();\n        let before;\n        for (let i = 0; i < drawArr.length; i++) {\n            let item = drawArr[i];\n            drawDot(item[0], item[1], item[2], item[3], item[4], before);\n            before = item;\n        }\n        context.restore();\n    }\n\n    //------------------ interface ---------------------------------------------------\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"PenBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [settingHasOpacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setAlpha\",\n            params: [settingAlphaId]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n\n        p = BB.clamp(p, 0, 1);\n        let localOpacity = calcOpacity(p);\n        let localSize = settingHasSizePressure ? Math.max(0.1, p * settingSize) : Math.max(0.1, settingSize);\n\n        hasDrawnDot = false;\n\n        isDrawing = true;\n        context.save();\n        drawDot(x, y, localSize, localOpacity);\n        context.restore();\n\n        lineToolLastDot = localSize * settingSpacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2.pressure = p;\n\n        inputArr = [{\n            x,\n            y,\n            pressure: p,\n        }];\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n\n    this.goLine = function (x, y, p) {\n        if (!isDrawing) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        let pressure = BB.clamp(p, 0, 1);\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n\n        context.save();\n        continueLine(x, y, localSize, lastInput.pressure);\n\n        /*context.fillStyle = 'red';\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\n\n        context.restore();\n\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput2.pressure = lastInput.pressure;\n        lastInput.pressure = pressure;\n\n        inputArr.push({\n            x,\n            y,\n            pressure: p,\n        });\n    };\n\n    this.endLine = function (x, y) {\n\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n        context.save();\n        continueLine(null, null, localSize, lastInput.pressure);\n        context.restore();\n\n        isDrawing = false;\n\n        if (settingAlphaId === ALPHA_SQUARE && !hasDrawnDot) {\n            // find max pressure input, use that one\n            let maxInput = inputArr[0];\n            inputArr.forEach(item => {\n                if (item.pressure > maxInput.pressure) {\n                    maxInput = item;\n                }\n            })\n\n            context.save();\n            let p = BB.clamp(maxInput.pressure, 0, 1);\n            let localOpacity = calcOpacity(p);\n            drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\n            context.restore();\n        }\n\n        bezierLine = null;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: [x, y]\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n\n        hasDrawnDot = false;\n        inputArr = [];\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        context.save();\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\n        }\n        context.restore();\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"PenBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [settingHasOpacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setAlpha\",\n            params: [settingAlphaId]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n    //SET\n    this.setAlpha = function (a) {\n        if (settingAlphaId === a) {\n            return;\n        }\n        settingAlphaId = a;\n        updateAlphaCanvas();\n    };\n    this.setColor = function (c) {\n        if (settingColor === c) {\n            return;\n        }\n        settingColor = {r: c.r, g: c.g, b: c.b};\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\n        updateAlphaCanvas();\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        settingSize = s;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.setSpacing = function (s) {\n        settingSpacing = s;\n    };\n    this.sizePressure = function (b) {\n        settingHasSizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        settingHasOpacityPressure = b;\n    };\n    this.setLockAlpha = function (b) {\n        settingLockLayerAlpha = b;\n    };\n    //GET\n    this.getSpacing = function () {\n        return settingSpacing;\n    };\n    this.getSize = function () {\n        return settingSize;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.getLockAlpha = function (b) {\n        return settingLockLayerAlpha;\n    };\n}","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\n\nexport const alphaImArr = []; //used by default brush\nalphaImArr[1] = genBrushAlpha01(128);\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\nimport {noise} from '../../../bb/math/perlin';\nimport {IVector2D} from '../../../bb/bb.types';\n\n// chalk\nexport function genBrushAlpha01(w: number): HTMLCanvasElement {\n\n    const scaleFac = w / 500;\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = canvas.getContext('2d');\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            let i = (y * w + x) * 4;\n\n            // base noise\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\n\n            // fade out in circular shape\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\n            let falloff = BB.clamp(\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\n                0,\n                1);\n            noisePattern = noisePattern * falloff;\n\n            // make the middle darker\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\n            noisePattern = noisePattern * falloff2;\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n// https://www.shadertoy.com/view/3tdSDj\nfunction udSegment( p: IVector2D, a: IVector2D, b: IVector2D ) {\n    let ba = BB.Vec2.sub(b, a);\n    let pa = BB.Vec2.sub(p, a);\n    let h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\n}\n\n// calligraphy\nexport function genBrushAlpha02(w: number): HTMLCanvasElement {\n\n    const pDist = 1 / 4;\n    let centerSize = 2 / 3;\n    let transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\n    const p2 = {x: w - (w * pDist), y: pDist * w};\n\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    let ctx = canvas.getContext('2d');\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            let col = udSegment({x: x, y: y}, p1, p2);\n\n            col = BB.clamp(\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\n                0,\n                255\n            );\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = col;\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}","/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nconst myModule = {} as any;\n\n\nfunction Grad(x, y, z) {\n    this.x = x; this.y = y; this.z = z;\n}\n\nGrad.prototype.dot2 = function(x, y) {\n    return this.x*x + this.y*y;\n};\n/*\nGrad.prototype.dot3 = function(x, y, z) {\n    return this.x*x + this.y*y + this.z*z;\n};*/\n\nlet grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\n\nlet p = [151,160,137,91,90,15,\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\n// To remove the need for index wrapping, double the permutation table length\nlet perm = new Array(512);\nlet gradP = new Array(512);\n\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\nmyModule.seed = function(seed) {\n    if (seed > 0 && seed < 1) {\n        // Scale the seed out\n        seed *= 65536;\n    }\n\n    seed = Math.floor(seed);\n    if (seed < 256) {\n        seed |= seed << 8;\n    }\n\n    for (let i = 0; i < 256; i++) {\n        let v;\n        if (i & 1) {\n            v = p[i] ^ (seed & 255);\n        } else {\n            v = p[i] ^ ((seed>>8) & 255);\n        }\n\n        perm[i] = perm[i + 256] = v;\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\n    }\n};\n\nmyModule.seed(0);\n\n/*\nfor (let i=0; i<256; i++) {\n  perm[i] = perm[i + 256] = p[i];\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nlet F2 = 0.5*(Math.sqrt(3)-1);\nlet G2 = (3-Math.sqrt(3))/6;\n\n/*let F3 = 1/3;\nlet G3 = 1/6;*/\n\n// 2D simplex noise\nmyModule.simplex2 = function(xin, yin) {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin)*F2; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let t = (i+j)*G2;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n        i1=1; j1=0;\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        i1=0; j1=1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n    let y1 = y0 - j1 + G2;\n    let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n    let y2 = y0 - 1 + 2 * G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    let gi0 = gradP[i+perm[j]];\n    let gi1 = gradP[i+i1+perm[j+j1]];\n    let gi2 = gradP[i+1+perm[j+1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0*x0-y0*y0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1*x1-y1*y1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2*x2-y2*y2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\n/*\n// 3D simplex noise\nmyModule.simplex3 = function(xin, yin, zin) {\n    let n0, n1, n2, n3; // Noise contributions from the four corners\n\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let k = Math.floor(zin+s);\n\n    let t = (i+j+k)*G3;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    let z0 = zin-k+t;\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // Determine which simplex we are in.\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n    if (x0 >= y0) {\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\n    } else {\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\n    }\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n    // c = 1/6.\n    let x1 = x0 - i1 + G3; // Offsets for second corner\n    let y1 = y0 - j1 + G3;\n    let z1 = z0 - k1 + G3;\n\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n    let y2 = y0 - j2 + 2 * G3;\n    let z2 = z0 - k2 + 2 * G3;\n\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n    let y3 = y0 - 1 + 3 * G3;\n    let z3 = z0 - 1 + 3 * G3;\n\n    // Work out the hashed gradient indices of the four simplex corners\n    i &= 255;\n    j &= 255;\n    k &= 255;\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\n\n    // Calculate the contribution from the four corners\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n    }\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n    }\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\n    if (t3<0) {\n        n3 = 0;\n    } else {\n        t3 *= t3;\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 32 * (n0 + n1 + n2 + n3);\n\n};\n*/\n// ##### Perlin noise stuff\n/*\nfunction fade(t) {\n    return t*t*t*(t*(t*6-15)+10);\n}\n\nfunction lerp(a, b, t) {\n    return (1-t)*a + t*b;\n}\n\n// 2D Perlin Noise\nmyModule.perlin2 = function(x, y) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y);\n    // Get relative xy coordinates of point within that cell\n    x = x - X; y = y - Y;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255;\n\n    // Calculate noise contributions from each of the four corners\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\n\n    // Compute the fade curve value for x\n    let u = fade(x);\n\n    // Interpolate the four results\n    return lerp(\n        lerp(n00, n10, u),\n        lerp(n01, n11, u),\n        fade(y));\n};*/\n/*\n// 3D Perlin Noise\nmyModule.perlin3 = function(x, y, z) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\n    // Get relative xyz coordinates of point within that cell\n    x = x - X; y = y - Y; z = z - Z;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255; Z = Z & 255;\n\n    // Calculate noise contributions from each of the eight corners\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\n\n    // Compute the fade curve value for x, y, z\n    let u = fade(x);\n    let v = fade(y);\n    let w = fade(z);\n\n    // Interpolate\n    return lerp(\n        lerp(\n            lerp(n000, n100, u),\n            lerp(n001, n101, u), w),\n        lerp(\n            lerp(n010, n110, u),\n            lerp(n011, n111, u), w),\n        v);\n};*/\n\nexport const noise = myModule;","import {BB} from '../../bb/bb';\nimport {IRGB, IRGBA} from '../kl.types';\nimport {IBounds, IPressureInput} from '../../bb/bb.types';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\n\nconst cellSize = 256;\n\ninterface IDrawBufferItem {\n    x: number;\n    y: number;\n    size: number;\n    opacity: number;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    r: number;\n    g: number;\n    b: number;\n}\n\n// faster than using BB.clamp somehow (in chrome)\nfunction clamp(num, min, max) {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num\n}\n\nexport class BlendBrush {\n\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\n\n    private context: CanvasRenderingContext2D;\n    private color: IRGB;\n    private size: number = 29; // radius - 0.5 - 99999\n    private opacity: number = 0.6; // 0-1\n    private blending: number = 0.65; // 0-1\n\n    private settingLockLayerAlpha: boolean = false;\n    private settingSizePressure: boolean = true;\n    private settingOpacityPressure: boolean = false;\n\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\n    private blendMix: number = 0.45; // todo docs\n    private mixr: number; // todo docs\n    private mixg: number; // todo docs\n    private mixb: number; // todo docs\n    private localColOld: IRGBA; // todo docs\n\n    private isDrawing: boolean = false;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private bezierLine: any; // todo type\n\n    private history: KlHistoryInterface | null;\n    private historyEntry: IHistoryEntry;\n    private redrawBounds: IBounds;\n    private cells: (ImageData | null)[];\n    private drawBuffer: IDrawBufferItem[];\n\n    private updateRedrawBounds (bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    private getCellsWidth(): number {\n        return Math.ceil(this.context.canvas.width / cellSize);\n    }\n\n    /**\n     * draw changed cells (changed by brushstroke) onto context\n     * @private\n     */\n    private drawChangedCells(): void {\n        const cells = this.cells.map(item => null);\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\n        touchedCells.forEach((isTouched, index) => {\n            if (isTouched) {\n                cells[index] = this.cells[index];\n            }\n        });\n        this.drawCells(cells);\n        this.redrawBounds = null;\n    }\n\n    private getTouchedCells(bounds: IBounds): boolean[] {\n        const touchedCells = this.cells.map(item => false);\n        const cellsW = this.getCellsWidth();\n        bounds = {\n            x1: Math.floor(bounds.x1 / cellSize),\n            y1: Math.floor(bounds.y1 / cellSize),\n            x2: Math.floor(bounds.x2 / cellSize),\n            y2: Math.floor(bounds.y2 / cellSize),\n        };\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\n                touchedCells[e * cellsW + i] = true;\n            }\n        }\n        return touchedCells;\n    }\n\n    /**\n     * Slice up bounds accordings to cells\n     * @param bounds\n     * @private\n     */\n    private sliceBounds(bounds: IBounds): {index: number; bounds: IBounds}[] {\n        const cellsW = this.getCellsWidth();\n        const result: {index: number; bounds: IBounds}[] = [];\n        const touchedCells = this.getTouchedCells(bounds);\n\n        touchedCells.forEach((cell, i) => {\n            if (!cell) {\n                return;\n            }\n\n            const cellOffsetX = (i % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\n            const cellWidth = this.cells[i].width;\n            const cellHeight = this.cells[i].height;\n\n            const inCellBounds = {\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\n            }\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\n                return;\n            }\n            result.push({\n                index: i,\n                bounds: inCellBounds,\n            });\n        });\n\n        return result;\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    private copyFromCanvas(bounds: IBounds) {\n        if (!bounds) {\n            return;\n        }\n\n        const touchedCells = this.getTouchedCells(bounds);\n        const cellsW = this.getCellsWidth();\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.cells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = tmpCanvas.getContext('2d');\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\n\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\n        });\n    }\n\n    private getAverage (x, y, size): IRGBA {\n\n        size = Math.max(0.5, size * 0.75);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0,\n            };\n        }\n\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\n\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\n        slicedBounds.forEach(slice => {\n            const width = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n            const bounds = slice.bounds;\n\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\n                    alpha = data[e2 + 3];\n                    ar += data[e2] * alpha;\n                    ag += data[e2 + 1] * alpha;\n                    ab += data[e2 + 2] * alpha;\n                    aa += alpha;\n                }\n            }\n        });\n\n        if (aa !== 0) {\n            ar /= aa;\n            ag /= aa;\n            ab /= aa;\n            aa = Math.min(1, aa);\n        }\n        return {\n            r: ar,\n            g: ag,\n            b: ab,\n            a: aa\n        };\n    }\n\n    private prepDot (x: number, y: number, size: number): IBounds {\n        size = Math.max(0.5, size);\n        let x1 = Math.max(0, Math.floor(x - size));\n        let y1 = Math.max(0, Math.floor(y - size));\n        let x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        let y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return null;\n        }\n        return { x1, y1, x2, y2 };\n    }\n\n    private drawDot (params: IDrawBufferItem): void {\n        // array with random numbers. faster than Math.random()\n        let randI = 0;\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n        const randArr = [];\n        for (let i = 0; i < randLen; i++) {\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n        }\n\n        // thin lines take more than just 1 sample\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\n        const samples = sampleArr[Math.floor(params.size * 2)];\n        const samplesSquared: number = samples ? samples * samples : 0;\n        const sampleOffsets = [];\n        if (samples) {\n            let i = 0;\n            for (let n = 0; n < samples; n++) {\n                for (let m = 0; m < samples; m++, i += 2) {\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\n                }\n            }\n        }\n\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\n        // to optimize calculations\n        const invSharpness = 1 - sharpness;\n        const sharpnessSubtrahend = sharpness / invSharpness;\n        const sizeSquared = params.size * params.size;\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n\n\n        const slicedBounds = this.sliceBounds({\n            x1: params.x1,\n            y1: params.y1,\n            x2: params.x2,\n            y2: params.y2,\n        });\n\n        const cellsW = this.getCellsWidth();\n        slicedBounds.forEach(slice => {\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\n            const cellWidth = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n\n            // i - y index within cell\n            // e - x index within cell\n\n            // e2 - index in image data\n\n            // ri - y index within image relative to dot-center\n            // re - x index within image relative to dot-center\n\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\n                for (\n                    let e = slice.bounds.x1,\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\n                        re = e + cellOffsetX - params.x;\n                    e <= slice.bounds.x2;\n                    e++,\n                        e2 += 4,\n                        re++\n                ) {\n                    // O = over -> brush-dot\n                    // U = under -> image\n\n                    let alphaO = 0;\n                    if (samplesSquared) {\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\n                            if (dist >= sizeSquared) {\n                                continue;\n                            }\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                        }\n                        if (!alphaO) {\n                            continue;\n                        }\n                        alphaO /= samplesSquared;\n                    } else {\n                        // technically needs + 0.5 offset, but not noticeable with large brush\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\n                        if (dist >= sizeSquared) {\n                            continue;\n                        }\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                    }\n\n                    const invAlphaO = 1 - alphaO;\n                    const alphaU =data[e2 + 3] / 255;\n\n                    if (this.settingLockLayerAlpha) {\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\n                        if (alphaU) {\n                            data[e2] = Math.floor(underR + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                        }\n                    } else {\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\n\n                        let newAlpha = 1 - invAlphaO * (1 - alphaU);\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                        if (newAlpha) {\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\n                        }\n                    }\n                    randI = (randI + 1) % randLen;\n\n                }\n            }\n\n        });\n    }\n\n    private calcSpacing (size: number): number {\n        return BB.mix(\n            (size * 2) / 2, // until size 5.3\n            (size * 2) / 9, // at size 24\n            BB.clamp((size - 2.7) / (12 - 2.7), 0, 1)\n        );\n    }\n\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n\n        this.drawBuffer = [];\n\n        let localPressure;\n        let localOpacity;\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\n\n        let bdist = this.calcSpacing(localSize);\n\n        let avgX = x;\n        let avgY = y;\n        if (x === null) {\n            avgX = this.lastInput.x;\n            avgY = this.lastInput.y;\n        }\n\n        let localColNew;\n\n        if (this.blending === 0) {\n            this.mixr = this.color.r;\n            this.mixg = this.color.g;\n            this.mixb = this.color.b;\n        } else {\n            let average;\n            if (isCoalesced) {\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\n            } else {\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\n                this.copyFromCanvas(bounds);\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n            }\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\n\n            if (average.a > 0 && this.blendCol.a === 0) {\n                this.blendCol.r = average.r;\n                this.blendCol.g = average.g;\n                this.blendCol.b = average.b;\n                this.blendCol.a = average.a;\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n\n            } else {\n                if (average.a === 0) {\n                    average.r = this.color.r;\n                    average.g = this.color.g;\n                    average.b = this.color.b;\n                    average.a = 1 - this.blending;\n                }\n\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            }\n\n        }\n\n\n        const bezierCallback = (val) => {\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\n                return;\n            }\n            let factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n            if (this.blending != 0) {\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\n            }\n            if (this.blending === 1 && this.localColOld.a === 0) {\n                this.mixr = localColNew.r;\n                this.mixg = localColNew.g;\n                this.mixb = localColNew.b;\n            }\n            const bounds = this.prepDot(val.x, val.y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: val.x,\n                    y: val.y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        };\n\n        if (x === null) {\n            this.bezierLine.addFinal(bdist, bezierCallback);\n        } else {\n            this.bezierLine.add(x, y, bdist, bezierCallback);\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.localColOld = localColNew;\n    }\n\n\n\n\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.size;\n    }\n\n    setSize (s: number): void {\n        this.size = s;\n    }\n\n    getOpacity (): number {\n        return this.opacity;\n    }\n\n    setOpacity (o: number): void {\n        this.opacity = o;\n    }\n\n    getBlending (): number {\n        return this.blending;\n    }\n\n    setBlending (b: number) {\n        this.blending = b;\n    }\n\n    setColor (c: IRGB): void {\n        this.color = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setSizePressure (b: boolean): void {\n        this.settingSizePressure = !!b;\n    }\n\n    setOpacityPressure (b: boolean): void {\n        this.settingOpacityPressure = !!b;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setIsTesting (b: boolean): void {\n        this.isTesting = !!b;\n    }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: [\"brush\", \"BlendBrush\"],\n            actions: []\n        };\n\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\n\n        this.isDrawing = true;\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        let localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        if (this.blending === 0) {\n            this.mixr = this.color.r;\n            this.mixg = this.color.g;\n            this.mixb = this.color.b;\n        } else {\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\n\n            let average = this.getAverage(\n                x,\n                y,\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\n            );\n            if (average.a === 0) {\n                this.blendCol = {\n                    r: this.color.r,\n                    g: this.color.g,\n                    b: this.color.b,\n                    a: 1 - this.blending,\n                };\n            } else {\n                this.blendCol = {\n                    r: average.r,\n                    g: average.g,\n                    b: average.b,\n                    a: average.a,\n                };\n            }\n\n            this.mixr = this.blendCol.r;\n            this.mixg = this.blendCol.g;\n            this.mixb = this.blendCol.b;\n        }\n\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\n\n        this.redrawBounds = null;\n        this.drawBuffer = [];\n\n        if (this.blending < 1 || this.blendCol.a > 0) {\n            const bounds = this.prepDot(x, y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: x,\n                    y: y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, function () {\n        });\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        if (this.redrawBounds && !this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n        if (!this.isDrawing) {\n            return;\n        }\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n\n        if (this.redrawBounds && !this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    endLine (): void {\n        if (this.bezierLine) {\n            this.continueLine(null, null, this.lastInput.pressure, false);\n        }\n\n        this.isDrawing = false;\n        this.bezierLine = null;\n\n        if (this.redrawBounds) {\n            this.drawChangedCells();\n        }\n\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\n            this.historyEntry.actions.push({\n                action: \"drawCells\",\n                params: [this.cells],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = null;\n        }\n        this.cells = null;\n    }\n\n    /**\n     * draw cells onto context\n     * @param cells\n     */\n    drawCells (cells: (ImageData | null)[]): void {\n        const cellsW = this.getCellsWidth();\n        cells.forEach((imageData, index) => {\n            if (!imageData) {\n                return;\n            }\n            const cellOffsetX = (index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n        });\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.isDrawing || x1 === undefined) {\n            return;\n        }\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\n        this.redrawBounds = null;\n        this.drawBuffer = [];\n\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\n        let average = this.getAverage(x1, y1, Math.max(0.1, this.size));\n\n        if (average.a === 0) {\n            this.blendCol = {\n                r: this.color.r,\n                g: this.color.g,\n                b: this.color.b,\n                a: 1 - this.blending,\n            };\n        } else {\n            this.blendCol = {\n                r: average.r,\n                g: average.g,\n                b: average.b,\n                a: average.a,\n            };\n        }\n\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\n\n\n        const p = 1;\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        const bdist = this.calcSpacing(localSize);\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\n            if (bounds) {\n                this.copyFromCanvas(bounds);\n                this.drawBuffer.push({\n                    x: x1 + eX * loopDist,\n                    y: y1 + eY * loopDist,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\n                })\n            }\n        }\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        if (this.history && this.cells.find(item => !!item)) {\n            this.drawCells(this.cells);\n            this.historyEntry = {\n                tool: [\"brush\", \"BlendBrush\"],\n                actions: [{\n                    action: \"drawCells\",\n                    params: [this.cells],\n                }],\n            };\n            this.history.push(this.historyEntry);\n            this.historyEntry = null;\n        }\n        this.cells = null;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nconst sampleCanvas = BB.canvas(32, 32);\nconst sampleCtx = sampleCanvas.getContext('2d');\n\nexport function SketchyBrush() {\n    let context;\n    let settingColor;\n\n    let settingSize = 1, settingOpacity = 0.2;\n    let settingBlending = 0.5;\n    let settingScale = 1;\n\n    let lastX, lastY;\n    let isDrawing = false;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n    let sketchySeed = 0;\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSeed = function (s) {\n        sketchySeed = parseInt(s);\n    };\n    this.getSeed = function () {\n        return parseInt('' + sketchySeed);\n    };\n\n    function rand() {\n        sketchySeed++;\n        return Math.sin(6324634.2345 * Math.cos(sketchySeed * 5342.3423)) * 0.5 + 0.5;\n    }\n\n    let points = [];\n    let count = 0;\n    let mixmode = [\n        function (c1, c2) {\n            return c1;\n        },\n        function (c1, c2) {\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        },\n        function (c1, c2) {\n            let result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        }\n    ];\n\n    this.getSize = function () {\n        return settingSize / 2;\n    };\n    this.setColor = function (c) {\n        settingColor = c;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.getBlending = function () {\n        return settingBlending;\n    };\n    this.setBlending = function (b) {\n        settingBlending = b;\n    };\n    this.setSize = function (s) {\n        settingSize = s * 2;\n    };\n    this.getScale = function () {\n        return settingScale;\n    };\n    this.setScale = function (s) {\n        settingScale = s;\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.startLine = function (x, y, pressure, shift) {\n        if (shift && lastInput.x) {\n            let lx = lastInput.x, ly = lastInput.y;\n            isDrawing = true;\n            //this.goLine(x,y,pressure);\n            this.endLine();\n        } else {\n            isDrawing = true;\n            lastX = x;\n            lastY = y;\n            lastInput.x = x;\n            lastInput.y = y;\n            historyEntry = {\n                tool: [\"brush\", \"SketchyBrush\"],\n                actions: []\n            };\n            historyEntry.actions.push({\n                action: \"setScale\",\n                params: [settingScale]\n            });\n            historyEntry.actions.push({\n                action: \"setSize\",\n                params: [settingSize / 2]\n            });\n            historyEntry.actions.push({\n                action: \"setOpacity\",\n                params: [settingOpacity]\n            });\n            historyEntry.actions.push({\n                action: \"setColor\",\n                params: [settingColor]\n            });\n            historyEntry.actions.push({\n                action: \"setBlending\",\n                params: [settingBlending]\n            });\n            historyEntry.actions.push({\n                action: \"startLine\",\n                params: [x, y, pressure]\n            });\n        }\n\n    };\n    this.goLine = function (p_x, p_y, pressure, preMixedColor) {\n        if (!isDrawing || (p_x === lastInput.x && p_y === lastInput.y)) {\n            return;\n        }\n\n        let e, b, a, g;\n        let x = parseInt(p_x);\n        let y = parseInt(p_y);\n        points.push([x, y]);\n\n        let mixr = settingColor.r;\n        let mixg = settingColor.g;\n        let mixb = settingColor.b;\n\n        if (preMixedColor !== null) {\n            mixr = preMixedColor.r;\n            mixg = preMixedColor.g;\n            mixb = preMixedColor.b;\n        } else {\n            if (settingBlending !== 0) {\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < context.canvas.width - 1 && y - 5 < context.canvas.height - 1) {\n                    mixr = 0;\n                    mixg = 0;\n                    mixb = 0;\n                    let mixx = Math.min(context.canvas.width - 1, Math.max(0, x - 5));\n                    let mixy = Math.min(context.canvas.height - 1, Math.max(0, y - 5));\n                    let mixw = Math.min(context.canvas.width - 1, Math.max(0, x + 5));\n                    let mixh = Math.min(context.canvas.height - 1, Math.max(0, y + 5));\n                    mixw -= mixx;\n                    mixh -= mixy;\n\n                    if (mixw > 0 && mixh > 0) {\n                        let imdat = context.getImageData(mixx, mixy, mixw, mixh);\n                        let countmix = 0;\n                        for (let i = 0; i < imdat.data.length; i += 4) {\n                            mixr += imdat.data[i + 0];\n                            mixg += imdat.data[i + 1];\n                            mixb += imdat.data[i + 2];\n                            countmix++;\n                        }\n                        mixr /= countmix;\n                        mixg /= countmix;\n                        mixb /= countmix;\n                    }\n\n                    let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\n                    mixr = parseInt('' + BB.mix(settingColor.r, mixed.r, settingBlending));\n                    mixg = parseInt('' + BB.mix(settingColor.g, mixed.g, settingBlending));\n                    mixb = parseInt('' + BB.mix(settingColor.b, mixed.b, settingBlending));\n                }\n            }\n        }\n\n        context.save();\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.lineWidth = settingSize;\n\n        context.beginPath();\n        context.moveTo(lastX, lastY);\n        context.lineTo(x, y);\n\n        for (e = 0; e < points.length; e++) {\n            b = points[e][0] - points[count][0];\n            a = points[e][1] - points[count][1];\n            g = b * b + a * a;\n            if (g < 4000 * settingScale * settingScale && rand() > g / 2000 / settingScale / settingScale) {\n                context.moveTo(points[count][0] + (b * 0.3), points[count][1] + (a * 0.3));\n                context.lineTo(points[e][0] - (b * 0.3), points[e][1] - (a * 0.3));\n            }\n        }\n\n        context.stroke();\n        context.restore();\n\n\n        count++;\n        lastX = x;\n        lastY = y;\n        lastInput.x = x;\n        lastInput.y = y;\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}]\n        });\n    };\n    this.endLine = function () {\n        isDrawing = false;\n        count = 0;\n        points = [];\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n\n        context.save();\n        context.lineWidth = settingSize;\n\n        let mixr = settingColor.r, mixg = settingColor.g, mixb = settingColor.b;\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < context.canvas.width - 1 && y1 - 5 < context.canvas.height - 1) {\n            mixr = 0;\n            mixg = 0;\n            mixb = 0;\n            let mixx = Math.min(context.canvas.width - 1, Math.max(0, x1 - 5));\n            let mixy = Math.min(context.canvas.height - 1, Math.max(0, y1 - 5));\n            let mixw = Math.min(context.canvas.width - 1, Math.max(0, x1 + 5));\n            let mixh = Math.min(context.canvas.height - 1, Math.max(0, y1 + 5));\n            mixw -= mixx;\n            mixh -= mixy;\n            if (mixw > 0 && mixh > 0) {\n                let w = Math.min(sampleCanvas.width, mixw);\n                let h = Math.min(sampleCanvas.height, mixh);\n                sampleCtx.save();\n                sampleCtx.globalCompositeOperation = 'copy';\n                sampleCtx.drawImage(context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\n                sampleCtx.restore();\n\n                let imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\n                let countmix = 0;\n                for (let i = 0; i < imdat.data.length; i += 4) {\n                    mixr += imdat.data[i + 0];\n                    mixg += imdat.data[i + 1];\n                    mixb += imdat.data[i + 2];\n                    countmix++;\n                }\n                mixr /= countmix;\n                mixg /= countmix;\n                mixb /= countmix;\n            }\n        }\n        let mixed = mixmode[0](new BB.RGB(mixr, mixg, mixb), settingColor);\n        mixr = parseInt('' + (settingBlending * mixed.r + settingColor.r * (1 - settingBlending)));\n        mixg = parseInt('' + (settingBlending * mixed.g + settingColor.g * (1 - settingBlending)));\n        mixb = parseInt('' + (settingBlending * mixed.b + settingColor.b * (1 - settingBlending)));\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.beginPath();\n        context.moveTo(x1, y1);\n        context.lineTo(x2, y2);\n        context.stroke();\n        context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + settingOpacity + \")\";\n        context.restore();\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SketchyBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"setScale\",\n            params: [settingScale]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize / 2]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setBlending\",\n            params: [settingBlending]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nexport function PixelBrush() {\n\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let settingColor, settingSize = 0.5, settingSpacing = 0.9, settingOpacity = 1;\n    let settingColorStr;\n    let settingHasSizePressure = true, settingHasOpacityPressure = false;\n    let settingLockLayerAlpha = false;\n    let settingIsEraser = false;\n    let settingUseDither = true;\n\n    let lineToolLastDot;\n    let lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n\n    let isDrawing = false;\n    let bezierLine = null;\n    let twoPI = Math.PI * 2;\n\n\n    let ditherCanvas = BB.canvas(4, 4);\n    let ditherCtx = ditherCanvas.getContext('2d');\n    let ditherPattern;\n    let ditherArr = [\n        [3, 2],\n        [1, 0],\n        [3, 0],\n        [1, 2],\n        [2, 1],\n        [0, 3],\n        [0, 1],\n        [2, 3],\n\n        [2, 0],\n        [0, 2],\n        [0, 0],\n        [2, 2],\n        [1, 1],\n        [3, 3],\n        [3, 1],\n        [1, 3]\n    ];\n\n    function updateDither() {\n        ditherCtx.clearRect(0, 0, 4, 4);\n        ditherCtx.fillStyle = settingIsEraser ? '#fff' : settingColorStr;\n        for (let i = 0; i < Math.max(1, Math.round(settingOpacity * ditherArr.length)); i++) {\n            ditherCtx.fillRect(ditherArr[i][0], ditherArr[i][1], 1, 1);\n        }\n        ditherPattern = context.createPattern(ditherCanvas, 'repeat');\n    }\n\n\n    /**\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\n     * @param p1\n     * @param p2\n     * @param p3\n     * @param p4\n     * @param maxAngleRad\n     */\n    function cubicCurveOverThreshold(p1, p2, p3, p4, max) {\n        let d = BB.Vec2.nor({\n            x: p4.x - p1.x,\n            y: p4.y - p1.y\n        });\n        let d2 = BB.Vec2.nor({\n            x: p2.x - p1.x,\n            y: p2.y - p1.y\n        });\n        let d3 = BB.Vec2.nor({\n            x: p4.x - p3.x,\n            y: p4.y - p3.y\n        });\n        let a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n        let a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > max;\n    }\n\n    //bresenheim line drawing\n    function plotLine(x0, y0, x1, y1, skipFirst) {\n        context.save();\n\n        if (settingIsEraser) {\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            } else {\n                context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n        context.globalAlpha = settingUseDither ? 1 : settingOpacity;\n\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n\n        let dX = Math.abs(x1 - x0);\n        let sX = x0 < x1 ? 1 : -1;\n        let dY = -Math.abs(y1 - y0);\n        let sY = y0 < y1 ? 1 : -1;\n        let err = dX + dY;\n        while (true) {\n            if (skipFirst) {\n                skipFirst = false;\n            } else {\n                context.fillRect(x0, y0, 1, 1);\n            }\n            if (x0 === x1 && y0 === y1) {\n                break;\n            }\n            let e2 = 2 * err;\n            if (e2 >= dY) {\n                err += dY;\n                x0 += sX;\n            }\n            if (e2 <= dX) {\n                err += dX;\n                y0 += sY;\n            }\n        }\n\n        context.restore();\n    }\n\n    function plotCubicBezierLine(p1, p2, p3, p4) {\n\n        let isOverThreshold = cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n\n        p1.x = Math.floor(p1.x);\n        p1.y = Math.floor(p1.y);\n        p4.x = Math.floor(p4.x);\n        p4.y = Math.floor(p4.y);\n\n        let dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\n        if (!isOverThreshold || dist < 7) {\n            plotLine(p1.x, p1.y, p4.x, p4.y, true);\n            return;\n        }\n\n        let n = Math.max(2, Math.round(dist / 4));\n        let pointArr = [];\n        for (let i = 0; i <= n; i++) {\n            let t = i / n;\n            let a = Math.pow(1 - t, 3);\n            let b = 3 * t * Math.pow(1 - t, 2);\n            let c = 3 * Math.pow(t, 2) * (1 - t);\n            let d = Math.pow(t, 3);\n            pointArr.push({\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\n            });\n        }\n\n        for (let i = 0; i < n; i++) {\n            plotLine(\n                Math.round(pointArr[i].x),\n                Math.round(pointArr[i].y),\n                Math.round(pointArr[i + 1].x),\n                Math.round(pointArr[i + 1].y),\n                true\n            );\n        }\n    }\n\n    function drawDot(x, y, size, opacity, angle?) {\n        context.save();\n        if (settingIsEraser) {\n            context.fillStyle = settingUseDither ? ditherPattern : '#fff';\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            } else {\n                context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            context.fillStyle = settingUseDither ? ditherPattern : settingColorStr;\n            if (settingLockLayerAlpha) {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n        context.globalAlpha = settingUseDither ? 1 : opacity;\n        context.fillRect(\n            Math.round(x + -size),\n            Math.round(y + -size),\n            Math.round(size * 2),\n            Math.round(size * 2)\n        );\n        context.restore();\n    }\n\n\n    function continueLine(x, y, size, pressure) {\n        if (bezierLine === null) {\n            bezierLine = new BB.BezierLine();\n            bezierLine.add(lastInput.x, lastInput.y, 0, function () {\n            });\n        }\n\n        context.save();\n\n        function dotCallback(val) {\n            let localPressure = BB.mix(lastInput2.pressure, pressure, val.t);\n            let localOpacity = settingOpacity * (settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            let localSize = Math.max(0.5, settingSize * (settingHasSizePressure ? localPressure : 1));\n            drawDot(val.x, val.y, localSize, localOpacity, val.angle);\n        }\n\n        function controlCallback(controlObj) {\n            plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n        }\n\n        if (Math.round(settingSize * 2) === 1) {\n            if (x === null) {\n                bezierLine.addFinal(4, null, controlCallback);\n            } else {\n                bezierLine.add(x, y, 4, null, controlCallback);\n            }\n\n        } else {\n            let localSpacing = size * settingSpacing;\n\n            if (x === null) {\n                bezierLine.addFinal(localSpacing, dotCallback);\n            } else {\n                bezierLine.add(x, y, localSpacing, dotCallback);\n            }\n        }\n\n        context.restore();\n    }\n\n    //------------------ interface ---------------------------------------------------\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"PixelBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n        historyEntry.actions.push({\n            action: \"setIsEraser\",\n            params: [settingIsEraser]\n        });\n        historyEntry.actions.push({\n            action: \"setUseDither\",\n            params: [settingUseDither]\n        });\n\n        if (settingUseDither) {\n            updateDither();\n        }\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = settingHasOpacityPressure ? (settingOpacity * p * p) : settingOpacity;\n        let localSize = settingHasSizePressure ? Math.max(0.5, p * settingSize) : Math.max(0.5, settingSize);\n\n        isDrawing = true;\n        drawDot(x, y, localSize, localOpacity);\n        lineToolLastDot = localSize * settingSpacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2 = BB.copyObj(lastInput);\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n\n    this.goLine = function (x, y, p) {\n        if (!isDrawing) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        //debug\n        //drawDot(x, y, 1, 0.5);\n\n        let pressure = BB.clamp(p, 0, 1);\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n\n        continueLine(x, y, localSize, lastInput.pressure);\n\n        lastInput2 = BB.copyObj(lastInput);\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = pressure;\n    };\n\n    this.endLine = function (x, y) {\n\n        let localSize = settingHasSizePressure ? Math.max(0.1, lastInput.pressure * settingSize) : Math.max(0.1, settingSize);\n        continueLine(null, null, localSize, lastInput.pressure);\n\n        //debug\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\n        //drawDot(x, y, 10, 0.1);\n\n        isDrawing = false;\n\n        bezierLine = null;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: [x, y]\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        if (settingUseDither) {\n            updateDither();\n        }\n\n        if (Math.round(settingSize * 2) === 1) {\n            plotLine(x1, y1, x2, y2, true);\n        } else {\n            let angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\n            let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n            let eX = (x2 - x1) / mouseDist;\n            let eY = (y2 - y1) / mouseDist;\n            let loopDist;\n            let bdist = settingSize * settingSpacing;\n            lineToolLastDot = settingSize * settingSpacing;\n            for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n                drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity, angle);\n            }\n        }\n\n        let historyEntry = {\n            tool: [\"brush\", \"PixelBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [settingHasSizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [settingSize]\n        });\n        historyEntry.actions.push({\n            action: \"setSpacing\",\n            params: [settingSpacing]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [settingOpacity]\n        });\n        historyEntry.actions.push({\n            action: \"setColor\",\n            params: [settingColor]\n        });\n        historyEntry.actions.push({\n            action: \"setLockAlpha\",\n            params: [settingLockLayerAlpha]\n        });\n        historyEntry.actions.push({\n            action: \"setIsEraser\",\n            params: [settingIsEraser]\n        });\n        historyEntry.actions.push({\n            action: \"setUseDither\",\n            params: [settingUseDither]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return isDrawing;\n    };\n    //SET\n    this.setColor = function (c) {\n        if (settingColor === c) {\n            return;\n        }\n        settingColor = c;\n        settingColorStr = \"rgb(\" + settingColor.r + \",\" + settingColor.g + \",\" + settingColor.b + \")\";\n    };\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        settingSize = s;\n    };\n    this.setOpacity = function (o) {\n        settingOpacity = o;\n    };\n    this.setSpacing = function (s) {\n        settingSpacing = s;\n    };\n    this.sizePressure = function (b) {\n        settingHasSizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        settingHasOpacityPressure = b;\n    };\n    this.setLockAlpha = function (b) {\n        settingLockLayerAlpha = b;\n    };\n    this.setIsEraser = function (b) {\n        settingIsEraser = !!b;\n    };\n    this.setUseDither = function (b) {\n        settingUseDither = !!b;\n    };\n    //GET\n    this.getSpacing = function () {\n        return settingSpacing;\n    };\n    this.getSize = function () {\n        return settingSize;\n    };\n    this.getOpacity = function () {\n        return settingOpacity;\n    };\n    this.getLockAlpha = function () {\n        return settingLockLayerAlpha;\n    };\n    this.getIsEraser = function () {\n        return settingIsEraser;\n    };\n    this.getUseDither = function () {\n        return settingUseDither;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\n\nexport function EraserBrush() {\n    let context;\n    let history: KlHistoryInterface = new KL.DecoyKlHistory();\n    let historyEntry: IHistoryEntry;\n\n    let size = 30, spacing = 0.4, opacity = 1;\n    let sizePressure = true, opacityPressure = false;\n    let lastDot, lastInput = {x: 0, y: 0, pressure: 0};\n    let lastInput2 = {x: 0, y: 0, pressure: 0};\n    let started = false;\n\n    let bezierLine;\n    let isBaseLayer = false;\n    let isTransparentBG = false;\n\n    function drawDot(x, y, size, opacity) {\n\n        context.save();\n        if (isBaseLayer) {\n            if (isTransparentBG) {\n                context.globalCompositeOperation = \"destination-out\";\n            } else {\n                context.globalCompositeOperation = \"source-atop\";\n            }\n        } else {\n            context.globalCompositeOperation = \"destination-out\";\n        }\n        let radgrad = context.createRadialGradient(size, size, 0, size, size, size);\n        let sharpness = Math.pow(opacity, 2);\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n        let oFac = Math.max(0, Math.min(1, opacity));\n        let localOpacity = 2 * oFac - oFac * oFac;\n        radgrad.addColorStop(sharpness, \"rgba(255, 255, 255, \" + localOpacity + \")\");\n        radgrad.addColorStop(1, \"rgba(255, 255, 255, 0)\");\n        context.fillStyle = radgrad;\n        context.translate(x - size, y - size);\n        context.fillRect(0, 0, size * 2, size * 2);\n        context.restore();\n    }\n\n    function continueLine(x, y, p) {\n        p = Math.max(0, Math.min(1, p));\n        let localPressure;\n        let localOpacity;\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\n\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * localSize * spacing);\n\n        function bezierCallback(val) {\n            let factor = val.t;\n            localPressure = lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (opacityPressure) ? (opacity * localPressure * localPressure) : opacity;\n            localSize = (sizePressure) ? Math.max(0.1, localPressure * size) : Math.max(0.1, size);\n\n            drawDot(val.x, val.y, localSize, localOpacity);\n        }\n\n        if (x === null) {\n            bezierLine.addFinal(bdist, bezierCallback);\n        } else {\n            bezierLine.add(x, y, bdist, bezierCallback);\n        }\n    }\n\n\n    this.startLine = function (x, y, p) {\n        historyEntry = {\n            tool: [\"brush\", \"EraserBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [opacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [sizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [size]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [opacity]\n        });\n        historyEntry.actions.push({\n            action: \"setTransparentBG\",\n            params: [isTransparentBG]\n        });\n\n        isBaseLayer = 0 === context.canvas.index;\n\n        p = Math.max(0, Math.min(1, p));\n        let localOpacity = (opacityPressure) ? (opacity * p * p) : opacity;\n        let localSize = (sizePressure) ? Math.max(0.1, p * size) : Math.max(0.1, size);\n\n        started = true;\n        if (localSize > 1) {\n            drawDot(x, y, localSize, localOpacity);\n        }\n        lastDot = localSize * spacing;\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n        lastInput2 = BB.copyObj(lastInput);\n\n        bezierLine = new BB.BezierLine();\n        bezierLine.add(x, y, 0, function () {\n        });\n\n        historyEntry.actions.push({\n            action: \"startLine\",\n            params: [x, y, p]\n        });\n    };\n    this.goLine = function (x, y, p) {\n        if (!started) {\n            return;\n        }\n        historyEntry.actions.push({\n            action: \"goLine\",\n            params: [x, y, p]\n        });\n\n        continueLine(x, y, lastInput.pressure);\n\n        lastInput2 = BB.copyObj(lastInput);\n        lastInput.x = x;\n        lastInput.y = y;\n        lastInput.pressure = p;\n    };\n    this.endLine = function () {\n\n        if (bezierLine) {\n            continueLine(null, null, lastInput.pressure);\n        }\n\n        started = false;\n        bezierLine = undefined;\n\n        if (historyEntry) {\n            historyEntry.actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            history.push(historyEntry);\n            historyEntry = undefined;\n        }\n    };\n    //cheap n' ugly\n    this.drawLineSegment = function (x1, y1, x2, y2) {\n\n        isBaseLayer = 0 === context.canvas.index;\n\n        lastInput.x = x2;\n        lastInput.y = y2;\n\n        if (started || x1 === undefined) {\n            return;\n        }\n\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = Math.max(1, Math.max(0.5, 1 - opacity) * size * spacing);\n        lastDot = 0;\n        for (loopDist = lastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, size, opacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"EraserBrush\"],\n            actions: []\n        };\n        historyEntry.actions.push({\n            action: \"opacityPressure\",\n            params: [opacityPressure]\n        });\n        historyEntry.actions.push({\n            action: \"sizePressure\",\n            params: [sizePressure]\n        });\n        historyEntry.actions.push({\n            action: \"setSize\",\n            params: [size]\n        });\n        historyEntry.actions.push({\n            action: \"setOpacity\",\n            params: [opacity]\n        });\n        historyEntry.actions.push({\n            action: \"setTransparentBG\",\n            params: [isTransparentBG]\n        });\n\n        historyEntry.actions.push({\n            action: \"drawLineSegment\",\n            params: [x1, y1, x2, y2]\n        });\n        history.push(historyEntry);\n    };\n\n    //IS\n    this.isDrawing = function () {\n        return started;\n    };\n    //SET\n    /*this.setAlpha = function(a) {\n        lastInput = {};\n        alpha = a;\n        updateAlphaCanvas();\n    };*/\n    this.setContext = function (c) {\n        context = c;\n    };\n    this.setHistory = function (l: KlHistoryInterface) {\n        history = l;\n    };\n    this.setSize = function (s) {\n        size = s;\n    };\n    this.setOpacity = function (o) {\n        opacity = o;\n    };\n    this.sizePressure = function (b) {\n        sizePressure = b;\n    };\n    this.opacityPressure = function (b) {\n        opacityPressure = b;\n    };\n    this.setTransparentBG = function (b) {\n        isTransparentBG = b == true;\n    };\n    //GET\n    this.getSize = function () {\n        return size;\n    };\n    this.getOpacity = function () {\n        return opacity;\n    };\n}","import {BB} from '../../bb/bb';\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb.types';\nimport {IHistoryEntry, KlHistoryInterface} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB} from '../kl.types';\n\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\n\nconst CELL_SIZE = 256;\n\ninterface ISmudgeParams {\n    aP: IVector2D;\n    bP: IVector2D;\n    size: {\n        w: number;\n        h: number;\n    };\n    brush: {\n        center: IVector2D,\n        size: number;\n        opacity: number;\n        alphaLock: boolean;\n    };\n}\n\n\n/**\n * determine bounds of smudge\n * @param imWidth\n * @param imHeight\n * @param aP\n * @param bP\n * @param size\n */\nfunction prepSmudge(\n    imWidth: number,\n    imHeight: number,\n    aP: IVector2D, // top left of source, integers\n    bP: IVector2D, // top left of dest, integers\n    size: {w: number; h: number}, // size of both rectangles, integers\n): {\n    aP: IVector2D,\n    bP: IVector2D,\n    size: {w: number; h: number},\n} {\n\n    if (aP.x === bP.x && aP.y === bP.y) {\n        return null;\n    }\n\n    aP = BB.copyObj(aP);\n    bP = BB.copyObj(bP);\n    size = BB.copyObj(size);\n\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        let top = 0;\n        let right = 0;\n        let bottom = 0;\n        let left = 0;\n\n        if (aP.x < 0) {\n            left = -aP.x;\n        }\n        if (aP.y < 0) {\n            top = -aP.y;\n        }\n        if (bP.x < 0) {\n            left = Math.max(left, -bP.x);\n        }\n        if (bP.y < 0) {\n            top = Math.max(top, -bP.y);\n        }\n        if (aP.x + size.w > imWidth) {\n            right = aP.x + size.w - imWidth;\n        }\n        if (aP.y + size.h > imHeight) {\n            bottom = aP.y + size.h - imHeight;\n        }\n        if (bP.x + size.w > imWidth) {\n            right = Math.max(right, bP.x + size.w - imWidth);\n        }\n        if (bP.y + size.h > imHeight) {\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        }\n\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) {\n            return null;\n        }\n    }\n\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y,\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y,\n        },\n        size: {\n            w: size.w,\n            h: size.h,\n        }\n    };\n}\n\n// faster than using BB.clamp somehow (in chrome)\nfunction clamp(num, min, max) {\n    return num <= min\n        ? min\n        : num >= max\n            ? max\n            : num\n}\n\n/**\n * Pixel operations that do the smudging via ImageData\n * @param imageData\n * @param p\n */\nfunction smudge(imageData: ImageData, p : ISmudgeParams): void {\n\n    p = BB.copyObj(p);\n\n    const cSize = p.brush.size;\n    const cX = p.brush.center.x;\n    const cY = p.brush.center.y;\n\n    /*if (statCount % 1000 === 0) {\n        console.log(statAcc / 1000);\n        statAcc = 0;\n    }\n    let start = performance.now();*/\n\n\n    // determine offset\n    let aIndex = p.aP.y * imageData.width + p.aP.x;\n    let bIndex = p.bP.y * imageData.width + p.bP.x;\n    const offset = (bIndex - aIndex) * 4;\n\n    // array with random numbers. faster than Math.random()\n    let randI = 0;\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    const randArr = [];\n    for (let i = 0; i < randLen; i++) {\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    }\n\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n\n    const pixel = (ai, bi, ix, iy) => {\n\n        const dist = BB.dist(cX, cY, ix, iy);\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n\n        if (fac === 1) {\n            return;\n        }\n\n        if (!imageData.data[ai + 3]) {\n\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\n            imageData.data[bi] = imageData.data[ai + 0];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            let fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\n            } else {\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\n            }\n\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\n\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) {\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\n        }\n\n    };\n\n    const bx1 = p.bP.x * 4;\n    const bx2 = bx1 + (p.size.w - 1) * 4;\n\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) {\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else if (p.aP.y > p.bP.y) {\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else {\n        if (p.aP.x < p.bP.x) {\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        } else {\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        }\n    }\n\n    //statCount++;\n    //statAcc += performance.now() - start;\n}\n\nexport class SmudgeBrush {\n\n    private context: CanvasRenderingContext2D;\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IHistoryEntry;\n\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\n    private settingSize: number = 35;\n    private settingSpacing: number = 0.20446882736951905;\n    private settingOpacity: number = 0.8;\n    private settingColorStr: string;\n    private settingHasSizePressure: boolean = false;\n    private settingHasOpacityPressure: boolean = false;\n    private settingLockLayerAlpha: boolean = false;\n\n    private lineToolLastDot: number;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastDot: IVector2D;\n\n    private isDrawing: boolean = false;\n\n    private bezierLine: any = null; // todo type BezierLine\n\n    private redrawBounds: IBounds;\n    private completeRedrawBounds: IBounds;\n\n    private copyImageData: ImageData;\n\n    private drawBuffer: ISmudgeParams[] = [];\n\n    private copiedCells: boolean[];\n\n    updateRedrawBounds(bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    updateCompleteRedrawBounds (x1, y1, x2, y2): void {\n        this.completeRedrawBounds = BB.updateBounds(\n            this.completeRedrawBounds,\n            { x1, y1, x2, y2 }\n        );\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    copyFromCanvas(): void {\n\n        const touchedCells = this.copiedCells.map(item => false);\n\n        const bounds: IBounds[] = [];\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\n\n        if (!this.redrawBounds) {\n            return;\n        }\n        bounds.push({\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\n        });\n        bounds.forEach(item => {\n            for (let i = item.x1; i <= item.x2; i++) {\n                for (let e = item.y1; e <= item.y2; e++) {\n                    touchedCells[e * cellsW + i] = true;\n                }\n            }\n        });\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.copiedCells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            this.copiedCells[i] = true;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = tmpCanvas.getContext('2d');\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\n\n            const data = tmpCtx.getImageData(0, 0, w, h);\n\n            for (let i = 0; i < h; i++) {\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\n                    this.copyImageData.data[e3] = data.data[e2];\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n                }\n            }\n        });\n    }\n\n\n    /**\n     * fill drawBuffer with params about to be drawn\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     */\n    prepDot (x: number, y: number, size: number, opacity: number): void {\n        if (!this.lastDot) {\n            this.lastDot = {\n                x: x,\n                y: y,\n            };\n            return;\n        }\n\n        size = Math.round(size);\n\n\n        const w = Math.round(size * 2);\n        const h = Math.round(size * 2);\n\n        const bounds = prepSmudge(\n            this.copyImageData.width,\n            this.copyImageData.height,\n            {\n                x: Math.round(this.lastDot.x - size),\n                y: Math.round(this.lastDot.y - size),\n            },\n            {\n                x: Math.round(x - size),\n                y: Math.round(y - size),\n            },\n            {\n                w,\n                h,\n            },\n        );\n\n        if (bounds) {\n            const params: ISmudgeParams = {\n                aP: bounds.aP,\n                bP: bounds.bP,\n                size: bounds.size,\n                brush: {\n                    center: { x, y },\n                    size,\n                    opacity,\n                    alphaLock: this.settingLockLayerAlpha,\n                }\n            };\n            this.updateRedrawBounds({\n                x1: params.bP.x,\n                y1: params.bP.y,\n                x2: params.bP.x + params.brush.size * 2,\n                y2: params.bP.y + params.brush.size * 2,\n            });\n            this.drawBuffer.push(params);\n        }\n\n        this.lastDot = {\n            x: x,\n            y: y,\n        };\n    }\n\n    continueLine (x: number, y: number, size: number, pressure: number): void {\n        this.drawBuffer = [];\n\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function(){});\n        }\n\n        const drawArr = []; //draw instructions. will be all drawn at once\n\n        const dotCallback = (val): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing / 3;\n        if (x === null) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        let before;\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.prepDot(item[0], item[1], item[2], item[3]);\n            before = item;\n        }\n\n        this.copyFromCanvas();\n\n        for (let i = 0; i < this.drawBuffer.length; i++) {\n            smudge(this.copyImageData, this.drawBuffer[i]);\n        }\n    }\n\n\n\n    // ---- public ----\n\n    constructor () { }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.lastDot = null;\n        this.isDrawing = true;\n\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\n\n        this.prepDot(x, y, localSize, localOpacity);\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.completeRedrawBounds = null;\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        this.redrawBounds = null;\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine (): void {\n        this.redrawBounds = null;\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.isDrawing = false;\n        this.bezierLine = null;\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        if (this.historyEntry && this.completeRedrawBounds) {\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\n            if (!(\n                this.completeRedrawBounds.x1 === 0 &&\n                this.completeRedrawBounds.y1 === 0 &&\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\n            )) {\n\n                // temp canvas to prevent main canvas from getting slowed down in chrome\n                const tmpCanvas = BB.canvas(\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n                );\n                const tmpCtx = tmpCanvas.getContext('2d');\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\n            }\n            this.historyEntry.actions.push({\n                action: \"drawImage\",\n                params: [\n                    historyIm,\n                    this.completeRedrawBounds.x1,\n                    this.completeRedrawBounds.y1,\n                ],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.copyImageData = null;\n    }\n\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\n        if (im instanceof ImageData) {\n            this.context.putImageData(im, x, y);\n        } else {\n            this.context.clearRect(x, y, im.width, im.height);\n            this.context.drawImage(im, x, y);\n        }\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        return;\n        /*\n        // todo\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n        // todo\n        history.add(historyEntry);*/\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setColor (c: IRGB): void {\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\n            return;\n        }\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = !!b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = !!b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl.types';\nimport {IBounds} from '../../bb/bb.types';\nimport {KlHistoryInterface} from '../history/kl-history';\n\ntype TChemyMode = 'fill' | 'stroke';\n\nexport class ChemyBrush {\n\n    private context: CanvasRenderingContext2D;\n    private settingColor: IRGB;\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\n    private settingOpacity: number = 1; // 0-1\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingMode: TChemyMode = 'fill';\n    private settingDistort: number = 0; // 0 - 1\n    private settingXSymmetry: boolean = false;\n    private settingYSymmetry: boolean = false;\n    private settingGradient: boolean = false;\n\n    private isDrawing: boolean = false;\n\n    private history: KlHistoryInterface;\n\n    private copyCanvas: HTMLCanvasElement;\n    private path: {x: number, y: number}[];\n    private minY: number;\n    private maxY: number;\n    private completeRedrawBounds: IBounds;\n\n    updateCompleteRedrawBounds (x, y): void {\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\n        if (this.settingXSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: -x + this.copyCanvas.width,\n                    y1: y,\n                    x2: -x + this.copyCanvas.width,\n                    y2: y,\n                }\n                );\n        }\n        if (this.settingYSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: x,\n                    y1: -y + this.copyCanvas.height,\n                    x2: x,\n                    y2: -y + this.copyCanvas.height,\n                }\n            );\n        }\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\n\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\n    }\n\n    private drawShape (): void {\n        this.context.save();\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.context.drawImage(this.copyCanvas, 0, 0);\n\n        let color = {...this.settingColor};\n        if (this.settingIsEraser) {\n            color.r = 255;\n            color.g = 255;\n            color.b = 255;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = \"source-atop\";\n            } else {\n                this.context.globalCompositeOperation = \"destination-out\";\n            }\n        } else {\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = \"source-atop\";\n            }\n        }\n\n        if (this.path) {\n\n            // path\n            const path = new Path2D();\n            this.path.forEach((item, index) => {\n                if (index === 0) {\n                    path.moveTo(item.x, item.y);\n                } else {\n                    path.lineTo(item.x, item.y);\n                }\n            });\n\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\n                r: color.r,\n                g: color.g,\n                b: color.b,\n                a: this.settingOpacity,\n            });\n            if (this.settingGradient) {\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                const gradient = this.context.createLinearGradient(\n                    0, startAtTop ? this.minY : this.maxY,\n                    0, startAtTop ? this.maxY : this.minY,\n                );\n                gradient.addColorStop(\n                    0,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: this.settingOpacity,\n                    })\n                );\n                gradient.addColorStop(\n                    1,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: 0,\n                    })\n                );\n                style = gradient;\n            }\n\n            // setup params\n            if (this.settingMode === 'fill') {\n                this.context.fillStyle = style;\n\n            } else {\n                this.context.lineWidth = this.settingSize * 2;\n                this.context.lineJoin = 'bevel';\n                this.context.strokeStyle = style;\n            }\n\n            // draw\n            const draw = () => {\n                if (this.settingMode === 'fill') {\n                    this.context.fill(path);\n                } else {\n                    this.context.stroke(path);\n                }\n            };\n\n            draw();\n            if (this.settingXSymmetry) {\n                this.context.save();\n                this.context.translate(this.context.canvas.width / 2, 0);\n                this.context.scale(-1, 1);\n                this.context.translate(-this.context.canvas.width / 2, 0);\n                draw();\n                this.context.restore();\n            }\n            if (this.settingYSymmetry) {\n                this.context.save();\n                this.context.translate(0, this.context.canvas.height / 2);\n                this.context.scale(1, -1);\n                this.context.translate(0, -this.context.canvas.height / 2);\n                draw();\n                this.context.restore();\n                if (this.settingXSymmetry) {\n                    this.context.save();\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\n                    this.context.scale(-1, -1);\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\n                    draw();\n                    this.context.restore();\n                }\n            }\n        }\n\n        this.context.restore();\n    }\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setColor (c: IRGB): void {\n        this.settingColor = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setMode (mode: TChemyMode): void {\n        this.settingMode = mode;\n    }\n\n    getMode (): TChemyMode {\n        return this.settingMode;\n    }\n\n    setDistort (distort: number): void {\n        this.settingDistort = BB.clamp(distort, 0, 1);\n    }\n\n    getDistort (): number {\n        return this.settingDistort;\n    }\n\n    setXSymmetry (b: boolean): void {\n        this.settingXSymmetry = !!b;\n    }\n\n    getXSymmetry (): boolean {\n        return this.settingXSymmetry;\n    }\n\n    setYSymmetry (b: boolean): void {\n        this.settingYSymmetry = !!b;\n    }\n\n    getYSymmetry (): boolean {\n        return this.settingYSymmetry;\n    }\n\n    setGradient (b: boolean): void {\n        this.settingGradient = !!b;\n    }\n\n    getGradient (): boolean {\n        return this.settingGradient;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = !!b;\n    }\n\n    getIsEraser (): boolean {\n        return this.settingIsEraser;\n    }\n\n    setIsEraser (b: boolean): void {\n        this.settingIsEraser = !!b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    startLine (x: number, y: number): void {\n        this.isDrawing = true;\n        this.path = [{x, y}];\n        this.minY = y;\n        this.maxY = y;\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\n        this.copyCanvas.getContext('2d').drawImage(this.context.canvas, 0, 0);\n        this.completeRedrawBounds = null;\n        this.updateCompleteRedrawBounds(x, y);\n    }\n\n    goLine (x: number, y: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        let pos = { x, y };\n        if (this.settingDistort > 0) {\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n        }\n\n        this.minY = Math.min(this.minY, pos.y);\n        this.maxY = Math.max(this.maxY, pos.y);\n        this.path.push(pos);\n        this.updateCompleteRedrawBounds(x, y);\n        this.drawShape();\n    }\n\n    endLine (): void {\n        this.isDrawing = false;\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\n        if (this.path.length > 1 && this.completeRedrawBounds) {\n            const historyCanvas = BB.canvas(\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n            );\n            const historyCtx = historyCanvas.getContext('2d');\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n            this.history.push({\n                tool: [\"brush\", \"ChemyBrush\"],\n                actions: [\n                    {\n                        action: \"drawImage\",\n                        params: [\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\n                            this.completeRedrawBounds.x1,\n                            this.completeRedrawBounds.y1,\n                        ],\n                    }\n                ]\n            });\n        }\n        this.path = null;\n        this.copyCanvas = null;\n    }\n\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\n        this.context.save();\n        this.context.clearRect(x, y, im.width, im.height);\n        this.context.drawImage(im, x, y);\n        this.context.restore();\n    }\n\n    drawLineSegment (x1, y1, x2, y2): void {\n        // might make sense for stroke\n    }\n}\n","import {penBrushUi} from './pen-brush-ui';\nimport {blendBrushUi} from './blend-brush-ui';\nimport {sketchyBrushUi} from './sketchy-brush-ui';\nimport {pixelBrushUi} from './pixel-brush-ui';\nimport {eraserBrushUi} from './eraser-brush-ui';\nimport {smudgeBrushUi} from './smudge-brush-ui';\nimport {chemyBrushUi} from './chemy-brush-ui';\nimport {IBrushUi} from '../kl.types';\n\n/**\n * UI for brushes.\n * Each brush ui carries the brush with it.\n * So if you want to draw, you do it through the UI. should be changed sometime.\n */\n\nexport const brushesUI: {\n    [key: string]: IBrushUi;\n} = {\n    penBrush: penBrushUi,\n    blendBrush: blendBrushUi,\n    sketchyBrush: sketchyBrushUi,\n    pixelBrush: pixelBrushUi,\n    chemyBrush: chemyBrushUi,\n    smudgeBrush: smudgeBrushUi,\n    eraserBrush: eraserBrushUi,\n};\n","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pen.svg';\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const penBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pen'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    let alphaNames = [\n        LANG('brush-pen-circle'),\n        LANG('brush-pen-chalk'),\n        LANG('brush-pen-calligraphy'),\n        LANG('brush-pen-square'),\n    ];\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pen');\n        alphaNames = [\n            LANG('brush-pen-circle'),\n            LANG('brush-pen-chalk'),\n            LANG('brush-pen-calligraphy'),\n            LANG('brush-pen-square'),\n        ];\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.PenBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let alphas = [];\n        let currentAlpha = 0;\n        for (let i = 0; i < 4; i++) {\n            (function (i) {\n                let alpha = BB.el({\n                    title: alphaNames[i],\n                    onClick: () => {\n                        alphaClick(i);\n                    }\n                });\n                let canvas = BB.canvas(70, 70);\n                let ctx = canvas.getContext('2d');\n                if (i === 0 || i === 3) {\n                    if (i === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else {\n                        ctx.fillRect(5, 5, 60, 60);\n                    }\n                } else if (i === 1) {\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\n                } else if (i === 2) {\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\n                }\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\n\n                alphas.push(alpha);\n            }(i));\n        }\n\n        function updateAlphas() {\n            for (let i = 0; i < alphas.length; i++) {\n                if (i === currentAlpha) {\n                    alphas[i].className = 'brush-alpha-selected';\n                } else {\n                    alphas[i].className = 'brush-alpha';\n                }\n            }\n        }\n\n        updateAlphas();\n\n        function alphaClick(id) {\n            currentAlpha = id;\n            brush.setAlpha(id);\n            updateAlphas();\n        }\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('brush-lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('brush-lock-alpha-title'),\n            css: {\n                cssFloat: 'right',\n                textAlign: 'right',\n            }\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                curve: brushInterface.opacitySlider.curve,\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let alphaWrapper = document.createElement(\"div\");\n            for (let i = 0; i < alphas.length; i++) {\n                alphaWrapper.appendChild(alphas[i]);\n            }\n            alphaWrapper.style.marginTop = \"10px\";\n            div.appendChild(alphaWrapper);\n            alphaWrapper.appendChild(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8Cez6\");","import {BB} from '../../bb/bb';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-blend.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const blendBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-blend'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-blend');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.BlendBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: 58 / 2,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    return Math.round(v);\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n            let blendingSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: brush.getBlending() * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setBlending(val / 100);\n                }\n            });\n            blendingSlider.getElement().style.marginTop = \"10px\";\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.setSizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.setOpacityPressure(b);\n            });\n\n            let lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('brush-lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('brush-lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                    display: 'inline-block',\n                }\n            });\n\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                }),\n                blendingSlider.getElement(),\n                lockAlphaToggle.getElement()\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, isCoalesced);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"bRhqj\");","import {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-sketchy.png';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const sketchyBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-sketchy'),\n        sizeSlider: {\n            min: 0.5,\n            max: 10\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-sketchy');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.SketchyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setSize(val);\n                    p.onSizeChange(brush.getSize());\n                },\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n            let blendSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: brush.getBlending() * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setBlending(val / 100);\n                }\n            });\n            let scaleSlider = new KlSlider({\n                label: LANG('brush-sketchy-scale'),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                initValue: brush.getScale(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setScale(val);\n                }\n            });\n            opacitySlider.getElement().style.marginTop = \"10px\";\n            blendSlider.getElement().style.marginTop = \"10px\";\n            scaleSlider.getElement().style.marginTop = \"10px\";\n            div.appendChild(sizeSlider.getElement());\n            div.appendChild(opacitySlider.getElement());\n            div.appendChild(blendSlider.getElement());\n            div.appendChild(scaleSlider.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function (x, y, pressure) {\n            brush.goLine(x, y, pressure, null);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getSeed = function () {\n            return parseInt(brush.getSeed());\n        };\n        this.setSeed = function (s) {\n            brush.setSeed(parseInt(s));\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"c33WP\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-pixel.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const pixelBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pixel'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pixel');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.PixelBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('brush-lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('brush-lock-alpha-title'),\n            css: {\n                marginRight: '10px',\n            }\n        });\n\n        let eraserToggle = new Checkbox({\n            init: brush.getIsEraser(),\n            label: LANG('eraser'),\n            callback: function (b) {\n                brush.setIsEraser(b);\n            },\n            css: {\n                marginRight: '10px',\n            }\n        });\n\n        let ditherToggle = new Checkbox({\n            init: brush.getUseDither(),\n            label: LANG('brush-pixel-dither'),\n            callback: function (b) {\n                brush.setUseDither(b);\n            }\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    val = Math.round(val * 2) / 2;\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    return Math.round(v);\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                curve: brushInterface.opacitySlider.curve,\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                opacitySlider.getElement()\n            );\n\n            let toggleRow = BB.el({\n                parent: div,\n                css: {\n                    display: 'flex',\n                    marginTop: '10px'\n                }\n            });\n\n            toggleRow.appendChild(lockAlphaToggle.getElement());\n            toggleRow.appendChild(eraserToggle.getElement());\n            toggleRow.appendChild(ditherToggle.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"4ahev\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\nimport {Checkbox} from '../ui/base-components/checkbox';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-eraser.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const eraserBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('eraser') + ' [E]',\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1)\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.EraserBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n        let isTransparentBg = false;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: 30,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: 1,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let transparencyToggle = new Checkbox({\n                init: false,\n                label: LANG('brush-eraser-transparent-bg'),\n                callback: function (b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: \"10px\",\n                }\n            });\n            div.appendChild(transparencyToggle.getElement());\n        }\n\n        init();\n\n        function drawDot(x, y) {\n            brush.drawDot(x, y);\n        }\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            //brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.getIsTransparentBg = function () {\n            return isTransparentBg;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        }\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"hgAG9\");","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {penPressureToggle} from '../ui/base-components/pen-pressure-toggle';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-smudge.svg';\nimport {IBrushUi} from '../kl.types';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const smudgeBrushUi = (function () {\n    let brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-smudge'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]]\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-smudge');\n    });\n\n    brushInterface.Ui = function (p) {\n        let div = document.createElement(\"div\"); // the gui\n        let brush = new brushes.SmudgeBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n\n        let lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('brush-lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('brush-lock-alpha-title'),\n        });\n\n        let spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    if (v < 10) {\n                        return Math.round(v * 10) / 10;\n                    } else {\n                        return Math.round(v);\n                    }\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                curve: brushInterface.opacitySlider.curve,\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            let pressureSizeToggle = penPressureToggle(false, function (b) {\n                brush.sizePressure(b);\n            });\n            let pressureOpacityToggle = penPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    }\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    }\n                })\n            );\n\n            let bottomRow = BB.el({\n                parent: div,\n                css: {\n                    marginTop: '10px',\n                }\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7jlxa\");","import {BB} from '../../bb/bb';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/base-components/kl-slider';\n// @ts-ignore\nimport brushIconImg from 'url:~/src/app/img/ui/brush-chemy.svg';\nimport {IBrushUi} from '../kl.types';\nimport {Options} from '../ui/base-components/options';\nimport {BoxToggle} from '../ui/base-components/box-toggle';\nimport {LANG, languageStrings} from '../../language/language';\n\nexport const chemyBrushUi = (function () {\n    const brushInterface: IBrushUi = {\n        image: brushIconImg,\n        tooltip: LANG('brush-chemy'),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\n            isDisabled: true,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1\n        },\n        Ui: null,\n    };\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-chemy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new brushes.ChemyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider;\n        let opacitySlider;\n\n        function setSize(size) {\n            brush.setSize(size);\n        }\n\n        function init() {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                initValue: brush.getSize(),\n                eventResMs: eventResMs,\n                isEnabled: brush.getMode() === 'stroke',\n                onChange: function (val) {\n                    setSize(val);\n                    p.onSizeChange(brush.getSize());\n                },\n                curve: brushInterface.sizeSlider.curve,\n                formatFunc: function (v) {\n                    v *= 2;\n                    return v < 5 ? (Math.round(v * 10) / 10) : Math.round(v);\n                }\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                initValue: brush.getOpacity(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n                formatFunc: function(v) {\n                    return Math.round(v * 100);\n                }\n            });\n\n            BB.css(opacitySlider.getElement(), {\n                marginTop: '10px',\n            });\n\n            let eraserToggle = new Checkbox({\n                init: brush.getIsEraser(),\n                label: LANG('eraser'),\n                callback: function (b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: '10px',\n                    marginLeft: '10px',\n                }\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('brush-lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('brush-lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                }\n            });\n\n            const toggleRow = BB.el({\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                }\n            });\n\n            const iconSize = 35;\n            const padding = 8;\n            const actualIconSize = iconSize - padding * 2;\n            const halfSize = actualIconSize / 2;\n\n            const modeOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'fill',\n                        label: BB.createSvg({\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: '#000',\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-fill'),\n                    },\n                    {\n                        id: 'stroke',\n                        label: BB.createSvg({\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: 'none',\n                                    stroke: '#000',\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-stroke'),\n                    }\n                ],\n                initId: brush.getMode(),\n                onChange: (id: string): void => {\n                    brush.setMode(id as 'stroke' | 'fill');\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n                    sizeSlider.setValue(brush.getSize());\n                    p.onSizeChange(brush.getSize());\n                    p.onConfigChange();\n                }\n            });\n\n            const mirrorXToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-mirror-x'),\n                init: brush.getXSymmetry(),\n                onChange: (b) => {\n                    brush.setXSymmetry(b);\n                },\n            });\n\n            const mirrorYToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-mirror-y'),\n                init: brush.getYSymmetry(),\n                onChange: (b) => {\n                    brush.setYSymmetry(b);\n                },\n            });\n\n            const gradientToggle = new BoxToggle({\n                label: BB.createSvg({\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'defs',\n                            childrenArr: [\n                                {\n                                    elementType: 'linearGradient',\n                                    id: 'gradient',\n                                    x1: '0',\n                                    y1: '0',\n                                    x2: '0',\n                                    y2: '1',\n                                    childrenArr: [\n                                        {\n                                            elementType: 'stop',\n                                            offset: '0%',\n                                            'stop-color': 'rgba(0,0,0,0)',\n                                        },\n                                        {\n                                            elementType: 'stop',\n                                            offset: '100%',\n                                            'stop-color': 'rgba(0,0,0,1)',\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            elementType: 'rect',\n                            fill: \"url('#gradient')\",\n                            x: '' + padding,\n                            y: '' + padding,\n                            width: '' + actualIconSize,\n                            height: '' + actualIconSize,\n                        },\n                    ]\n                }),\n                title: LANG('brush-chemy-gradient'),\n                init: brush.getGradient(),\n                onChange: (b) => {\n                    brush.setGradient(b);\n                },\n            });\n\n            BB.css(mirrorXToggle.getElement(), {\n                marginLeft: '10px',\n            });\n            {\n                const margin = {\n                    marginLeft: '4px',\n                };\n                BB.css(mirrorYToggle.getElement(), margin);\n                BB.css(gradientToggle.getElement(), margin);\n            }\n\n            toggleRow.append(\n                modeOptions.getElement(),\n                mirrorXToggle.getElement(),\n                mirrorYToggle.getElement(),\n                gradientToggle.getElement(),\n            );\n\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                toggleRow,\n                BB.el({\n                    content: [\n                        lockAlphaToggle.getElement(),\n                        eraserToggle.getElement(),\n                    ],\n                    css: {\n                        display: 'flex',\n                    }\n                })\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.increaseValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.decreaseValue(f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    };\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"58hyx\");","import {BB} from '../../../bb/bb';\n\nexport class BoxToggle {\n    el: HTMLElement;\n    value: boolean;\n\n    update (): void {\n        if (this.value) {\n            BB.addClassName(this.el, 'kl-box-toggle--active');\n        } else {\n            BB.removeClassName(this.el, 'kl-box-toggle--active');\n        }\n    }\n\n    // --- public ---\n    constructor (\n        p: {\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n            init?: boolean;\n            onChange: (b: boolean) => void;\n        }\n    ) {\n        this.value = !!p.init;\n        this.el = BB.el({\n            content: p.label,\n            title: p.title,\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\n            onClick: () => {\n                this.value = !this.value;\n                this.update();\n                p.onChange(this.value);\n            },\n            css: {\n                cursor: 'pointer',\n            }\n        });\n        if (typeof p.label !== 'string') {\n            BB.css(p.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n        this.update();\n    }\n\n    getValue (): boolean {\n        return this.value;\n    }\n\n    setValue (b: boolean): void {\n        this.value = !!b;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.el;\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.el);\n    }\n}","import { BB } from '../../../bb/bb';\r\nimport { Popup } from './popup';\r\nimport { LANG } from '../../../language/language';\r\n\r\nexport function showIframePopup(url, isEmbed, klRootEl, bbox) {\r\n    if (!isEmbed && ((bbox.height || window.innerHeight) < 500 || (bbox.width || window.innerWidth) < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    let iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%'\r\n        }\r\n    }) as HTMLIFrameElement;\r\n    let titleEl = BB.el({});\r\n\r\n    let linkEl;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function () {\r\n                popup.close();\r\n            }\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = function () {\r\n            BB.setAttributes(linkEl, {\r\n                href: '' + iframe.contentWindow.location,\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    let popup = new Popup({\r\n        target: klRootEl,\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                BB.destroyEl(linkEl);\r\n            }\r\n        }\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\n\nexport class RadioList {\n\n    el: HTMLDivElement;\n    inputs: HTMLInputElement[] = [];\n\n    constructor({name, init, items, ignoreFocus}: {\n        name: string;\n        init?: string;\n        items: {\n            label: string;\n            value: string;\n        }[],\n        ignoreFocus?: boolean; // default false\n    }) {\n        this.el = BB.el({\n            className: 'kl-radio'\n        }) as HTMLDivElement;\n\n        items.forEach(item => {\n            let label = BB.el({\n                tagName: 'label'\n            });\n            let input = BB.el({\n                tagName: 'input',\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: 'radio',\n                }\n            }) as HTMLInputElement;\n            if (ignoreFocus) {\n                input.setAttribute('data-ignore-focus', 'true');\n            }\n            if (init === item.value) {\n                input.checked = true;\n            }\n            label.append(item.label);\n            this.el.append(label);\n            this.inputs.push(input);\n        });\n    }\n\n\n    getValue(): string {\n        for (let i = 0; i < this.inputs.length; i++) {\n            if (this.inputs[i].checked) {\n                return this.inputs[i].value;\n            }\n        }\n        return null;\n    }\n\n    getElement() {\n        return this.el;\n    }\n\n}","import { BB } from '../../../bb/bb';\r\n\r\n// @ts-ignore\r\nimport removeLayerImg from 'url:~/src/app/img/ui/remove-layer.svg';\r\nimport { BBox, IKlProject } from '../../kl.types';\r\nimport { showIframePopup } from '../modals/show-iframe-popup';\r\nimport { SaveReminder } from './save-reminder';\r\nimport { IProjectStoreListener, ProjectStore } from '../../storage/project-store';\r\nimport { KL } from '../../kl';\r\nimport { LANG } from '../../../language/language';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private infoEl: HTMLDivElement;\r\n    private ageEl: HTMLDivElement;\r\n    private storeEl: HTMLButtonElement;\r\n    private clearEl: HTMLButtonElement;\r\n    private storeListener: IProjectStoreListener;\r\n\r\n    private timestamp: number | undefined;\r\n\r\n    private updateAge() {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons() {\r\n        if (this.timestamp) {\r\n            this.storeEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = false;\r\n        } else {\r\n            this.storeEl.textContent = LANG('file-storage-store');\r\n            this.storeEl.disabled = false;\r\n            this.clearEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        if (this.timestamp) {\r\n            BB.css(thumbnail, {\r\n                display: 'block',\r\n                maxWidth: 'calc(100% - 2px)',\r\n                maxHeight: 'calc(100% - 2px)',\r\n                margin: '0 auto',\r\n                background: \"url('\" + BB.createCheckerCanvas(4).toDataURL('image/png') + \"')\",\r\n                boxShadow: '0 0 0 1px #aaa',\r\n                pointerEvents: 'none',\r\n            });\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store() {\r\n        const p = this.getProject();\r\n        if (p) {\r\n            this.storeEl.textContent = LANG('file-storage-storing');\r\n            this.storeEl.disabled = true;\r\n            this.clearEl.disabled = true;\r\n            await new Promise((resolve) => {\r\n                setTimeout(() => resolve(null), 20);\r\n            });\r\n            try {\r\n                await this.projectStore.store(p);\r\n                this.saveReminder.reset();\r\n            } catch (e) {\r\n                this.resetButtons();\r\n                KL.popup({\r\n                    target: this.saveReminder.getEl(),\r\n                    type: 'error',\r\n                    message: [\r\n                        `${LANG('file-storage-failed-1')}<ul>`,\r\n                        `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                        `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                        `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                        `</ul>`,\r\n                    ].join(''),\r\n                    buttons: ['Ok'],\r\n                });\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    private async clear() {\r\n        this.storeEl.disabled = true;\r\n        this.clearEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.saveReminder.getEl(),\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor(\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject | null,\r\n        private saveReminder: SaveReminder,\r\n        private options?: { hideClearButton?: boolean },\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            }\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            title: LANG('file-storage-about'),\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '19px',\r\n                height: '19px',\r\n                borderRadius: '100%',\r\n                textAlign: 'center',\r\n                lineHeight: '19px',\r\n                fontWeight: 'bold',\r\n                boxShadow: 'inset 0 0 0 1px #000',\r\n            },\r\n            onClick: () => {\r\n                showIframePopup('./help/#help-browser-storage', false, saveReminder.getEl(), saveReminder.getBBox());\r\n            }\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: \" \" + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            css: {\r\n                gridArea: 'preview',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                boxShadow: 'inset 0 0 0 1px #aaa',\r\n                background: '#cdcdcd',\r\n                color: '#545454',\r\n                colorScheme: 'only light',\r\n                minHeight: '67px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                bottom: '0',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            }\r\n        }) as HTMLDivElement;\r\n        this.storeEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.storeEl.tabIndex = -1;\r\n        this.clearEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'gridButton',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: {\r\n                tabIndex: -1,\r\n            },\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearEl.style.display = 'none';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement() {\r\n        return this.element;\r\n    }\r\n\r\n    show() {\r\n        // todo\r\n    }\r\n\r\n    hide() {\r\n        // todo\r\n    }\r\n\r\n    destroy() {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeEl);\r\n        BB.destroyEl(this.clearEl);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\nimport {ProjectConverter} from './project-converter';\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\nimport {LocalStorage} from '../../bb/base/local-storage';\n\n\nexport interface IProjectStoreListener {\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void,\n}\n\nfunction makeAsync(func): Promise<any> {\n    return new Promise((resolve, reject) => {\n        func(resolve, reject);\n    });\n}\n\n/**\n * simplified interface for storing projects into browser storage\n */\nexport class ProjectStore {\n\n    private listeners: IProjectStoreListener[] = [];\n    private accessHasFailed: boolean = false;\n\n    async lowLevelStore (project: IKlStorageProject): Promise<any> {\n        await new Promise((resolve, reject) => {\n            storeKlProjectObj(project, resolve, reject);\n        });\n    }\n\n    async lowLevelRead (): Promise<IKlStorageProject> {\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\n    }\n\n    async lowLevelClear (): Promise<any> {\n        await makeAsync(clear);\n    }\n\n\n\n    private emit(timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\n        this.listeners.forEach(item => {\n            item.onUpdate(timestamp, thumbnail);\n        });\n    }\n\n    private updateTimestamp() {\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\n    }\n\n    // --- public ---\n\n    constructor () {\n        window.addEventListener('storage', (e) => {\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\n                return;\n            }\n            try {\n                ( async () => {\n                    const readResult = await this.read();\n                    if (readResult) {\n                        this.emit(readResult.timestamp, readResult.thumbnail);\n                    } else {\n                        this.emit();\n                    }\n                })();\n            } catch (e) {\n                if (e.message.indexOf('db-error') === 0) {\n                    this.accessHasFailed = true;\n                }\n            }\n\n        });\n    }\n\n    async read(): Promise<{\n        project: IKlProject,\n        timestamp: number,\n        thumbnail: HTMLImageElement | HTMLCanvasElement\n    } | null> {\n        let storageProject;\n        try {\n            storageProject = await this.lowLevelRead();\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        if (!storageProject) {\n            return null;\n        }\n        let result;\n        try {\n            result = await ProjectConverter.readStorageProject(storageProject);\n        } catch (e) {\n            throw new Error('format-error: ' + e);\n        }\n        return result;\n    }\n\n    async store(project: IKlProject): Promise<void> {\n        try {\n            const storageProject = ProjectConverter.createStorageProject(project);\n            await this.lowLevelStore(storageProject);\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        {\n            // immediately test if it can be read\n            const storageProject = await this.lowLevelRead();\n            let readResult = null;\n            try {\n                readResult = await ProjectConverter.readStorageProject(storageProject);\n            } catch (e) {\n                await this.lowLevelClear();\n                this.updateTimestamp();\n                setTimeout(() => this.emit(), 0);\n                throw new Error('format-error: ' + e);\n            }\n            this.updateTimestamp();\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\n        }\n    }\n\n    async clear(): Promise<void> {\n        await this.lowLevelClear();\n        this.updateTimestamp();\n        setTimeout(() => this.emit(), 0);\n    }\n\n    subscribe(listener: IProjectStoreListener) {\n        if (this.listeners.includes(listener)) {\n            return;\n        }\n        this.listeners.push(listener);\n    }\n\n    unsubscribe(listener: IProjectStoreListener) {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (listener === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    isBroken() {\n        return this.accessHasFailed;\n    }\n\n}","import {IKlProject, IKlStorageProject} from '../kl.types';\nimport {BB} from '../../bb/bb';\nimport {drawProject} from '../canvas/draw-project';\nimport {base64ToBlob} from './base-64-to-blob';\n\n\nconst thumbSize = 240;\n\nfunction loadImage(blob: Blob): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const im = new Image();\n        try {\n            im.src = BB.imageBlobToUrl(blob);\n        } catch (e) {\n            reject('imageBlobToUrl, ' + e.message);\n            return;\n        }\n        im.onload = () => {\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        }\n        im.onabort = function () {\n            reject('layer image failed loading');\n        };\n        im.onerror = function () {\n            reject('layer image failed loading');\n        };\n    });\n}\n\n/**\n * for:\n * - preparing project to be stored in ProjectStore\n * - reading a project that came out of the ProjectStore\n */\nexport class ProjectConverter {\n\n    private static createThumbnail(project): HTMLCanvasElement {\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\n        const factor = size.width / project.width;\n        return drawProject(project, factor);\n    }\n\n    static createStorageProject(project: IKlProject): IKlStorageProject {\n        return {\n            id: 1,\n            timestamp: new Date().getTime(),\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\n            width: project.width,\n            height: project.height,\n            layers: project.layers.map(item => {\n                let blob;\n                if (item.image instanceof HTMLCanvasElement) {\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\n                } else {\n                    // todo image\n                    throw new Error('Not implemented');\n                }\n                return {\n                    name: item.name,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                    blob,\n                }\n            }),\n        };\n    }\n\n    static async readStorageProject(storageProject: IKlStorageProject): Promise<{\n        project: IKlProject,\n        timestamp: number,\n        thumbnail: HTMLImageElement | HTMLCanvasElement\n    }> {\n        if (\n            !storageProject.width || !storageProject.height ||\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\n            storageProject.width < 1 || storageProject.height < 1\n        ) {\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\n        }\n        const project: IKlProject = {\n            width: storageProject.width,\n            height: storageProject.height,\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\n                .map((image, i) => {\n                    return {\n                        name: storageProject.layers[i].name,\n                        opacity: storageProject.layers[i].opacity,\n                        mixModeStr: storageProject.layers[i].mixModeStr,\n                        image,\n                    };\n                }),\n        };\n\n        let thumbnail;\n        if (storageProject.thumbnail) {\n            thumbnail = await loadImage(storageProject.thumbnail);\n        } else {\n            thumbnail = ProjectConverter.createThumbnail(project);\n        }\n\n        return {\n            project: project,\n            timestamp: storageProject.timestamp,\n            thumbnail: thumbnail,\n        };\n    }\n\n}","\nexport function base64ToBlob(base64Str: string): Blob {\n    let parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n    let binStr = atob(parts[3]);\n    let buf = new ArrayBuffer(binStr.length);\n    let view = new Uint8Array(buf);\n    for (let i = 0; i < view.length; i++) {\n        view[i] = binStr.charCodeAt(i);\n    }\n    return new Blob([view], {'type': parts[1]});\n}","import { BB } from '../../../bb/bb';\nimport { KL } from '../../kl';\n// @ts-ignore\nimport newImageImg from 'url:~/src/app/img/ui/new-image.svg';\n// @ts-ignore\nimport exportImg from 'url:~/src/app/img/ui/export.svg';\n// @ts-ignore\nimport shareImg from 'url:~/src/app/img/ui/share.svg';\n// @ts-ignore\nimport uploadImg from 'url:~/src/app/img/ui/upload.svg';\n// @ts-ignore\nimport importImg from 'url:~/src/app/img/ui/import.svg';\n// @ts-ignore\nimport copyImg from 'url:~/src/app/img/ui/copy.svg';\nimport { BrowserStorageUi } from '../components/browser-storage-ui';\nimport { IKlProject } from '../../kl.types';\nimport { SaveReminder } from '../components/save-reminder';\nimport { ProjectStore } from '../../storage/project-store';\nimport { LANG } from '../../../language/language';\n\nexport type exportType = 'png' | 'layers' | 'psd';\n\nexport class FileTab {\n\n  private readonly div: HTMLDivElement;\n  private importButton: HTMLInputElement;\n  private fileBrowserStorage: BrowserStorageUi;\n\n  constructor(\n    klRootEl,\n    projectStore: ProjectStore | null | undefined,\n    getProject: () => IKlProject,\n    private exportType,\n    onExportTypeChange,\n    onFileSelect,\n    onSaveImageToComputer,\n    onNewImage,\n    onShareImage,\n    onUpload,\n    onCopyToClipboard,\n    saveReminder: SaveReminder,\n  ) {\n    const _this = this;\n    this.div = document.createElement(\"div\");\n\n    const asyncCreation = () => {\n      let filemenu = document.createElement(\"div\");\n      let newButton = document.createElement(\"button\");\n      let saveButton = document.createElement(\"button\");\n      let shareButton = document.createElement(\"button\");\n      let uploadImgurButton = document.createElement(\"button\");\n      let clipboardButton = document.createElement(\"button\");\n\n      newButton.style.cssFloat = 'left';\n      BB.css(saveButton, {\n        cssFloat: 'left',\n        clear: 'both',\n      });\n      BB.css(clipboardButton, {\n        cssFloat: 'left',\n        clear: 'both',\n      });\n\n      newButton.tabIndex = -1;\n      saveButton.tabIndex = -1;\n      shareButton.tabIndex = -1;\n      uploadImgurButton.tabIndex = -1;\n      clipboardButton.tabIndex = -1;\n\n      newButton.innerHTML = `<img src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\n      saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\n      shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\n      uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\n      clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\n      clipboardButton.title = LANG('file-copy-title');\n      newButton.className = \"gridButton\";\n      saveButton.className = \"gridButton\";\n      shareButton.className = \"gridButton\";\n      uploadImgurButton.className = \"gridButton\";\n      clipboardButton.className = \"gridButton\";\n\n\n      this.importButton = document.createElement(\"input\");\n      this.importButton.tabIndex = -1;\n      this.importButton.type = \"file\";\n      this.importButton.multiple = true;\n      this.importButton.accept = \"image\";\n      (this.importButton as any).size = \"71\";\n      this.importButton.textContent = \"Import\";\n      let importWrapper: any = this.importButton;\n\n      function createImportButton() {\n        importWrapper = document.createElement(\"div\");\n        importWrapper.className = \"gridButton\";\n        importWrapper.style.position = \"relative\";\n        importWrapper.style.cursor = \"pointer\";\n        importWrapper.style.cssFloat = \"left\";\n\n        let innerMask = document.createElement(\"div\");\n        innerMask.style.width = \"120px\";\n        innerMask.style.height = \"28px\";\n        innerMask.style.overflow = \"hidden\";\n        innerMask.style.cursor = \"pointer\";\n        innerMask.style.position = \"relative\";\n\n        importWrapper.appendChild(innerMask);\n        innerMask.appendChild(_this.importButton);\n\n        let importFakeButton = document.createElement(\"button\");\n        importFakeButton.innerHTML = \"<img style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import');\n        importFakeButton.tabIndex = -1;\n\n        BB.css(importFakeButton, {\n          width: \"120px\",\n          display: \"box\",\n          position: \"absolute\",\n          left: '0',\n          top: '0',\n          cursor: \"pointer\"\n        });\n        BB.css(_this.importButton, {\n          display: 'none'\n        });\n        importWrapper.appendChild(importFakeButton);\n\n        importFakeButton.onclick = function () {\n          _this.importButton.click();\n        }\n      }\n\n      createImportButton();\n\n      this.importButton.onchange = function (e) {\n        onFileSelect(_this.importButton.files, 'default');\n        _this.importButton.value = \"\";\n\n      };\n\n\n      // --- export filetype dropdown ---\n      let exportTypeWrapper;\n      let exportTypeSelect;\n      {\n        exportTypeWrapper = BB.el({\n          css: {\n            fontSize: '15px',\n            marginLeft: '10px',\n            marginTop: '10px',\n            cssFloat: 'left',\n            width: 'calc(50% - 15px)',\n            height: '30px'\n          }\n        });\n        exportTypeSelect = new KL.Select({\n          optionArr: [\n            ['png', LANG('file-save-png')],\n            ['psd', LANG('file-save-psd')],\n            ['layers', LANG('file-save-layers')],\n          ],\n          initValue: exportType,\n          onChange: function (val) {\n            exportType = val;\n            onExportTypeChange(exportType);\n            onSaveImageToComputer();\n          }\n        });\n        BB.css(exportTypeSelect.getElement(), {\n          width: '120px',\n          height: '30px'\n        });\n        exportTypeWrapper.appendChild(exportTypeSelect.getElement());\n\n      }\n\n\n\n      newButton.onclick = onNewImage;\n      saveButton.onclick = function () {\n        onSaveImageToComputer();\n      };\n      shareButton.onclick = function () {\n        shareButton.disabled = true;\n        if (typeof onShareImage === 'function') {\n          onShareImage(() => {\n            shareButton.disabled = false;\n          });\n        }\n      };\n      uploadImgurButton.onclick = function () {\n        onUpload();\n      };\n\n      clipboardButton.onclick = function () {\n        clipboardButton.blur();\n        onCopyToClipboard();\n      };\n\n      let saveNote = document.createElement(\"div\");\n      saveNote.textContent = \" \" + LANG('file-no-autosave');\n      BB.css(saveNote, {\n        textAlign: \"center\",\n        marginTop: \"10px\",\n        background: \"rgb(243, 243, 161)\",\n        padding: \"5px 0px\",\n        color: 'rgba(0,0,0,0.65)',\n        fontSize: '15px',\n      });\n\n      function createSpacer() {\n        let el = document.createElement(\"div\");\n        let clearer = document.createElement(\"div\");\n        let line = document.createElement(\"div\");\n        el.appendChild(clearer);\n        el.appendChild(line);\n        BB.css(clearer, {\n          clear: 'both'\n        });\n        BB.css(line, {\n          marginLeft: \"10px\",\n          marginRight: \"10px\",\n          marginTop: \"10px\",\n          borderBottom: \"1px solid rgba(0,0,0,0.2)\",\n          clear: 'both'\n        });\n        return el;\n      }\n\n      if (projectStore) {\n        _this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder);\n        BB.css(_this.fileBrowserStorage.getElement(), {\n          //background: 'red',\n          margin: '10px',\n        });\n      }\n\n\n      //actual structure\n      BB.append(filemenu, [\n        saveNote,\n        newButton,\n        importWrapper,\n        BB.el({ css: { clear: 'both' } }),\n\n        saveButton,\n        exportTypeWrapper,\n        BB.el({ css: { clear: 'both' } }),\n\n        clipboardButton,\n        typeof onShareImage === 'function' && BB.canShareFiles() ? shareButton : null,\n        BB.el({ css: { clear: 'both' } }),\n\n        createSpacer(),\n        _this.fileBrowserStorage ? _this.fileBrowserStorage.getElement() : null,\n        _this.fileBrowserStorage ? createSpacer() : null,\n        uploadImgurButton,\n      ]);\n\n      this.div.appendChild(filemenu);\n    };\n\n    setTimeout(asyncCreation, 1);\n  }\n\n  refresh() {\n  }\n\n  getElement() {\n    return this.div;\n  }\n\n  setIsVisible(isVisible: boolean) {\n    if (isVisible) {\n      this.refresh();\n    }\n  }\n\n  triggerImport() {\n    this.importButton.click();\n  }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"aisua\");","import { BB } from '../../../bb/bb';\r\nimport { KL } from '../../kl';\r\nimport { klHistory } from '../../history/kl-history';\r\nimport { IKeyString } from '../../../bb/bb.types';\r\nimport { StatusOverlay } from '../components/status-overlay';\r\nimport { KlCanvasWorkspace } from '../../canvas-ui/kl-canvas-workspace';\r\nimport { KlCanvas } from '../../canvas/kl-canvas';\r\nimport { LANG } from '../../../language/language';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly div: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor(\r\n        private klApp,\r\n        private klColorSlider,\r\n        private layerManager,\r\n        private setCurrentLayer,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi,\r\n        private getCurrentColor,\r\n        private getKlMaxCanvasSize,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.div = document.createElement(\"div\");\r\n    }\r\n\r\n    private init() {\r\n        const _this = this;\r\n        let hasWebGl = BB.hasWebGl();\r\n        let filters = KL.filterLib;\r\n        let buttons = [];\r\n\r\n        BB.BbLog.emit({\r\n            type: 'init-filters',\r\n        });\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        function createButton(filterKey, filterArr) {\r\n            let button = document.createElement(\"button\");\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let im = '<img height=\"20\" width=\"18\" src=\"' + filterArr[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = \"gridButton\";\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n            button.onclick = function () {\r\n\r\n                function finishedDialog(result, filterDialog) {\r\n                    if (result == \"Cancel\") {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterArr[filterKey].name;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                }\r\n\r\n                if (!('apply' in filterArr[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                function applyFilter(input) {\r\n                    let filterResult = filterArr[filterKey].apply({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input\r\n                    });\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    if (filterArr[filterKey].updateContext === true) {\r\n                        _this.setCurrentLayer(_this.getKlCanvas().getLayer(_this.layerManager.getSelected()));\r\n                    }\r\n                    if (filterArr[filterKey].updatePos === true) {\r\n                        _this.klCanvasWorkspace.resetView();\r\n                        _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    _this.layerManager.update();\r\n                }\r\n\r\n                if (filterArr[filterKey].isInstant) {\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    _this.statusOverlay.out('\"' + filterArr[filterKey].name + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    let secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\r\n                    let filterDialog = filterArr[filterKey].getDialog({\r\n                        context: _this.getCurrentLayerCtx(),\r\n                        canvas: _this.getKlCanvas(),\r\n                        maxWidth: _this.getKlMaxCanvasSize(),\r\n                        maxHeight: _this.getKlMaxCanvasSize(),\r\n                        bbox: _this.klApp.getBBox(),\r\n                        currentColorRgb: { r: _this.getCurrentColor().r, g: _this.getCurrentColor().g, b: _this.getCurrentColor().b },\r\n                        secondaryColorRgb: { r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b }\r\n                    });\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closefunc;\r\n                    filterDialog.errorCallback = function (e) {\r\n                        setTimeout(function () {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closefunc();\r\n                    };\r\n\r\n\r\n                    let style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px'\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: _this.klApp.getEl(),\r\n                        message: \"<b>\" + filterArr[filterKey].name + \"</b>\",\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: [\"Ok\", \"Cancel\"],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: function (result) {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closefunc: function (func) {\r\n                            closefunc = func;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        }\r\n\r\n        function createDisabledButton(filterKey, filterArr) {\r\n            if (!filterArr[filterKey].webgl && !filterArr[filterKey].ieFails) {\r\n                return;\r\n            }\r\n            if (filterArr[filterKey].ieFails && navigator.appName !== 'Microsoft Internet Explorer') {\r\n                return;\r\n            }\r\n            let buttonLabel = filterArr[filterKey].buttonLabel ? filterArr[filterKey].buttonLabel : filterArr[filterKey].name;\r\n            let button = document.createElement(\"button\");\r\n            let im = '<img style=\"opacity: 0.5\" src=\"img/' + filterArr[filterKey].icon + '\" />';\r\n            let name = filterArr[filterKey].name;\r\n            if (name.length > 11) {\r\n                name = \"<span style='font-size: 12px'>\" + buttonLabel + \"</span>\";\r\n            }\r\n            button.innerHTML = im + name;\r\n            button.className = \"gridButton\";\r\n            button.disabled = true;\r\n            return button;\r\n        }\r\n\r\n        function addGroup(groupArr, filterArr, targetEl) {\r\n            for (let filterKey in filterArr) {\r\n                if (filterArr.hasOwnProperty[filterKey] || !groupArr.includes(filterKey)) {\r\n                    continue;\r\n                }\r\n                if (_this.isEmbed && !filterArr[filterKey].inEmbed) {\r\n                    continue;\r\n                }\r\n                if ((filterArr[filterKey].webgl && hasWebGl)\r\n                    || (filterArr[filterKey].neededWithWebGL)\r\n                    || (!filterArr[filterKey].webgl && !hasWebGl)\r\n                    && !(filterArr[filterKey].ieFails && navigator.appName == 'Microsoft Internet Explorer')) {\r\n\r\n                    targetEl.appendChild(createButton(filterKey, filterArr));\r\n\r\n                } else {\r\n                    targetEl.appendChild(createDisabledButton(filterKey, filterArr));\r\n                    filterArr[filterKey] = undefined;\r\n                }\r\n            }\r\n        }\r\n\r\n        let groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'glPerspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform'\r\n        ];\r\n        let groupB = [];\r\n        for (let filterKey in filters) {\r\n            if (filters.hasOwnProperty[filterKey] || groupA.includes(filterKey)) {\r\n                continue;\r\n            }\r\n            groupB.push(filterKey);\r\n        }\r\n\r\n        addGroup(groupA, filters, _this.div);\r\n        let hrEl = document.createElement(\"div\");\r\n        hrEl.className = \"gridHr\";\r\n        _this.div.appendChild(hrEl);\r\n        addGroup(groupB, filters, _this.div);\r\n\r\n\r\n        if (!hasWebGl) {\r\n            let webglnote = BB.appendTextDiv(_this.div, \"Some actions are disabled because WebGL isn't working.\");\r\n            webglnote.style.margin = \"10px\";\r\n            BB.css(webglnote, {\r\n                fontSize: \"11px\",\r\n                color: \"#555\",\r\n                background: \"#ffe\",\r\n                padding: \"10px\",\r\n                borderRadius: \"10px\",\r\n                textAlign: \"center\"\r\n            });\r\n        }\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement() {\r\n        return this.div;\r\n    }\r\n\r\n    show() {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.div.style.display = 'block';\r\n    }\r\n\r\n    hide() {\r\n        this.div.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\n// @ts-ignore\r\nimport loadingImg from 'url:~/src/app/img/ui/loading.gif';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\n\r\n\r\nasync function upload(canvas, title, description, type: 'png' | 'jpeg', imgurKey: string): Promise<{deletehash: string}> {\r\n    let img = base64ToBlob(canvas.toDataURL(\"image/\" + type));\r\n\r\n    let w = window.open();\r\n    let label = w.document.createElement(\"div\");\r\n    let gif = w.document.createElement(\"img\");\r\n    gif.src = loadingImg;\r\n    label.appendChild(gif);\r\n    BB.css(gif, {\r\n        filter: \"invert(1)\"\r\n    });\r\n    w.document.body.style.backgroundColor = \"#121211\";\r\n    w.document.body.style.backgroundImage = \"linear-gradient(#2b2b2b 0%, #121211 50%)\";\r\n    w.document.body.style.backgroundRepeat = \"no-repeat\";\r\n    let labelText = w.document.createElement(\"div\");\r\n    labelText.style.marginTop = \"10px\";\r\n    label.appendChild(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.appendChild(label);\r\n    BB.css(label, {\r\n        marginLeft: \"auto\",\r\n        marginRight: \"auto\",\r\n        marginTop: \"100px\",\r\n        fontFamily: \"Arial, sans-serif\",\r\n        fontSize: \"20px\",\r\n        textAlign: \"center\",\r\n        transition: \"opacity 0.3s ease-in-out\",\r\n        opacity: '0',\r\n        color: \"#ccc\"\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    let data = (await response.json()).data;\r\n\r\n    w.location.href = (data as any).link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload(klCanvas: KlCanvas, klRootEl, saveReminder: SaveReminder, imgurKey: string) {\r\n    /* if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    } */\r\n\r\n    let inputTitle = document.createElement(\"input\");\r\n    inputTitle.type = \"text\";\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    let inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    let labelTitle = document.createElement(\"div\");\r\n    labelTitle.textContent = LANG('upload-name') + \":\";\r\n    let labelDescription = BB.el({\r\n        content: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        }\r\n    });\r\n\r\n    let tos = document.createElement(\"div\");\r\n    tos.innerHTML = `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('upload-tos')}</a> ${LANG('upload-tos-2')}`;\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    let outDiv = document.createElement(\"div\");\r\n    let infoHint = document.createElement(\"div\");\r\n    infoHint.className = \"info-hint\";\r\n    infoHint.textContent = LANG('upload-link-notice');\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: \"upload\",\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), \"Cancel\"],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === \"Yes\" || val === \"Ok\") {\r\n                try {\r\n                    if (!imgurKey) {\r\n                        throw new Error('imgur key missing');\r\n                    }\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"ok\",\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/<b>delete</b>/${result.deletehash}</a><br><br>`,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: \"error\",\r\n                        message: LANG('upload-failed') + \": \" + e.message,\r\n                        buttons: [\"Ok\"]\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"8mdF2\");","import {BB} from '../../bb/bb';\n\nlet agPsdLazy;\nexport async function loadAgPsd() {\n    if (!agPsdLazy) {\n        agPsdLazy = await import('ag-psd');\n        BB.BbLog.emit({\n            type: 'loaded-agpsd',\n        });\n    }\n    return agPsdLazy;\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"6YuND\"))).then(() => parcelRequire('2m2jt'));","import { KL } from '../../kl';\r\nimport { BB } from '../../../bb/bb';\r\nimport { KlHistoryInterface } from '../../history/kl-history';\r\nimport { LANG } from '../../../language/language';\r\nimport { BrowserStorageUi } from './browser-storage-ui';\r\nimport { ProjectStore } from '../../storage/project-store';\r\nimport { IKlProject, BBox } from '../../kl.types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup(): void {\r\n        if (!this.projectStore || !this.getProject || !this.getProject()) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el({});\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                }\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            }\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            }\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            {\r\n                hideClearButton: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: this.getEl(),\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closefunc: (f) => {\r\n                this.closeFunc = f;\r\n            }\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor(\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject | null) | null, // needed if showReminder\r\n        public getEl: () => HTMLElement,\r\n        public getBBox: () => BBox,\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init(): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                let unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload(e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            let actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                BB.setEventListener(window, 'onbeforeunload', onBeforeUnload);\r\n            } else {\r\n                BB.setEventListener(window, 'onbeforeunload', null);\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener(\"visibilitychange\", () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    let actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset(): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        BB.setEventListener(window, 'onbeforeunload', null);\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import { BB } from '../../bb/bb';\nimport { KL } from '../kl';\nimport { saveAs } from 'file-saver';\nimport { KlCanvas } from '../canvas/kl-canvas';\n\nexport class SaveToComputer {\n\n    constructor(\n        private customSave,\n        private saveReminder,\n        private klRootEl,\n        private getExportType,\n        private getKlCanvas: () => KlCanvas,\n        private filenameBase: string,\n    ) { }\n\n    save(format?: 'psd' | 'layers' | 'png') {\n        const _this = this;\n\n        _this.saveReminder.reset();\n\n\n        function saveImage(canvas, filename, mimeType) {\n            let parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n            //assume base64 encoding\n            let binStr = atob(parts[3]);\n            //convert to binary in ArrayBuffer\n            let buf = new ArrayBuffer(binStr.length);\n            let view = new Uint8Array(buf);\n            for (let i = 0; i < view.length; i++) {\n                view[i] = binStr.charCodeAt(i);\n            }\n            let blob = new Blob([view], { 'type': parts[1] });\n            if (typeof _this.customSave === 'function') {\n                _this.customSave(blob, filename);\n            } else {\n                saveAs(blob, filename);\n            }\n        }\n\n        if (!format) {\n            format = _this.getExportType();\n        }\n\n        if (format === 'png') {\n            let extension = 'png';\n            let mimeType = 'image/png';\n            let filename = BB.getDate() + this.filenameBase + \".\" + extension;\n            let fullCanvas = _this.getKlCanvas().getCompleteCanvas(1);\n\n            /*fullCanvas.toBlob(function(blob) {\n                if (blob === null) {\n                    throw 'save image error, blob is null';\n                }\n                saveAs(blob, filename);\n            }, mimetype);*/\n\n            //using old code, because saving somehow doesn't work for ipad before ios 13\n            //and it doesn't even throw an exception\n            try {\n                saveImage(fullCanvas, filename, mimeType);\n            } catch (error) { //fallback for old browsers\n                let im = new Image();\n                im.width = _this.getKlCanvas().getWidth();\n                im.height = _this.getKlCanvas().getHeight();\n                im.src = fullCanvas.toDataURL(mimeType);\n                KL.exportDialog(_this.klRootEl, im);\n            }\n        } else if (format === 'layers') {\n            let extension = 'png';\n            let mimeType = 'image/png';\n            let fileBase = BB.getDate() + this.filenameBase;\n            let layerArr = _this.getKlCanvas().getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                let item = layerArr[i];\n                let fnameArr = [\n                    fileBase,\n                    '_',\n                    ('' + (i + 1)).padStart(2, '0'),\n                    '_',\n                    item.name,\n                    '.',\n                    extension\n                ];\n                saveImage(item.canvas, fnameArr.join(''), mimeType);\n            }\n        } else if (format === 'psd') {\n\n            let layerArr = _this.getKlCanvas().getLayersFast();\n\n            let psdConfig = {\n                width: _this.getKlCanvas().getWidth(),\n                height: _this.getKlCanvas().getHeight(),\n                children: [],\n                canvas: _this.getKlCanvas().getCompleteCanvas(1)\n            };\n            for (let i = 0; i < layerArr.length; i++) {\n                let item = layerArr[i];\n                psdConfig.children.push({\n                    name: item.name,\n                    opacity: item.opacity,\n                    canvas: item.canvas,\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                    left: 0,\n                    top: 0\n                });\n            }\n\n            KL.loadAgPsd().then((agPsdLazy) => {\n                let buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                let blob = new Blob([buffer], { type: 'application/octet-stream' });\n                if (typeof _this.customSave === 'function') {\n                    _this.customSave(blob, BB.getDate() + this.filenameBase + '.psd');\n                } else {\n                    saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\n                }\n            }).catch(() => {\n                alert('Error: failed to load PSD library');\n            });\n\n        }\n\n    }\n\n}","/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","import {KL} from '../kl';\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\nimport {IFilterApply, IInitState} from '../kl.types';\nimport {KlCanvas} from '../canvas/kl-canvas';\n\nexport class UndoRedoCatchup {\n\n    private doIgnore = false;\n\n    /**\n     * Prevent multiple undo / redo getting triggered at once.\n     * Might be confusing if main thread is choking.\n     */\n    private ignoreTest (): boolean {\n        if (this.doIgnore) {\n            return false;\n        }\n        this.doIgnore = true;\n        setTimeout(() => {\n            this.doIgnore = false;\n        }, 0);\n        return true;\n    }\n\n    // ---- public ----\n\n    constructor (\n        private brushUiObj,\n        private layerPreview,\n        private layerManager,\n        private handUi,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private getInitState: () => IInitState,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx,\n        private setCurrentLayerCtx,\n        private getCurrentBrush,\n    ) { }\n\n    undo (): boolean {\n        if (!this.ignoreTest()) {\n            return false;\n        }\n\n        if (!klHistory.canUndo()) { // || workspace.isPainting()) {\n            return false;\n        }\n        const actions: IHistoryEntry[] = klHistory.undo();\n        klHistory.pause(true);\n        const initState: IInitState = this.getInitState();\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\n        this.getKlCanvas().copy(initState.canvas);\n        let layerIndex = initState.focus;\n        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n        const brushes: any = {};\n        for (let b in KL.brushes) {\n            if (KL.brushes.hasOwnProperty(b)) {\n                brushes[b] = new KL.brushes[b]();\n                brushes[b].setContext(this.getCurrentLayerCtx());\n            }\n        }\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\n        for (let i = 0; i < actions.length; i++) {\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    const b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: this.getCurrentLayerCtx(),\n                        canvas: this.getKlCanvas(),\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(this.getCurrentLayerCtx());\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = this.getKlCanvas().addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\n                }\n            })(i);\n        }\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\n            this.klCanvasWorkspace.resetView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        this.layerManager.update(layerIndex);\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(layerIndex));\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent(null);\n\n        klHistory.pause(false);\n        return true;\n    }\n\n    redo (): boolean {\n        if (!this.ignoreTest()) {\n            return false;\n        }\n\n        if (!klHistory.canRedo()) {\n            return false;\n        }\n        const actions = klHistory.redo();\n        klHistory.pause(true);\n        const oldSize = {w: this.getKlCanvas().getWidth(), h: this.getKlCanvas().getHeight()};\n        let layerIndex;\n        const brushes: any = {};\n        for (let b in KL.brushes) {\n            if (KL.brushes.hasOwnProperty(b)) {\n                brushes[b] = new KL.brushes[b]();\n                brushes[b].setContext(this.getCurrentLayerCtx());\n            }\n        }\n        brushes.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());\n        for (let i = 0; i < actions.length; i++) {\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    const b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = this.getKlCanvas()[actions[i].action].apply(this.getKlCanvas(), p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: this.getCurrentLayerCtx(),\n                        canvas: this.getKlCanvas(),\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(actions[i].params[0]));\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(this.getCurrentLayerCtx());\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = this.getKlCanvas().addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(layerIndex));\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(this.getCurrentLayerCtx());\n                            }\n                        }\n                    }\n                    this.getCurrentLayerCtx().drawImage(actions[i].params[0], 0, 0);\n                }\n            })(i);\n        }\n\n        if (oldSize.w !== this.getKlCanvas().getWidth() || oldSize.h !== this.getKlCanvas().getHeight()) {\n            this.klCanvasWorkspace.resetView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        const currentLayerIndex = this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);\n        this.layerManager.update(currentLayerIndex);\n        this.layerPreview.setLayer(this.getKlCanvas().getLayer(currentLayerIndex));\n        this.brushUiObj.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent(null);\n        klHistory.pause(false);\n\n        return true;\n    }\n\n    catchup (logParam: IHistoryBroadcast | null): void {\n        // const start = performance.now();\n        //play catch up (the version that is a few steps behind)\n        if (logParam && logParam.bufferUpdate) {\n            const initState: IInitState = this.getInitState();\n\n            const brushes = initState.brushes;\n            const actions = [logParam.bufferUpdate];\n            let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\n            const canvas = initState.canvas;\n            let layerIndex = initState.focus;\n            ((i) => {\n                if (actions[i].tool[0] === \"brush\") {\n                    let b = brushes[actions[i].tool[1]];\n                    if (actions[i].actions) {\n                        for (let e = 0; e < actions[i].actions.length; e++) {\n                            const p = actions[i].actions[e].params;\n                            b[actions[i].actions[e].action].apply(b, p);\n                        }\n                    } else {\n                        const p = actions[i].params;\n                        b[actions[i].action].apply(b, p);\n                    }\n                } else if (actions[i].tool[0] === \"canvas\") {\n                    const p = actions[i].params;\n                    const id = canvas[actions[i].action].apply(canvas, p);\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(localCurrentLayerCtx);\n                            }\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"filter\") {\n                    const p = [{\n                        context: localCurrentLayerCtx,\n                        canvas: canvas,\n                        input: actions[i].params[0].input,\n                        history: new KL.DecoyKlHistory(),\n                    } as IFilterApply];\n                    KL.filterLib[actions[i].tool[1]][actions[i].action].apply(null, p);\n\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"focusLayer\") {\n                    layerIndex = actions[i].params[0];\n                    localCurrentLayerCtx = canvas.getLayerContext(actions[i].params[0]);\n                    for (let b in brushes) {\n                        if (brushes.hasOwnProperty(b)) {\n                            brushes[b].setContext(localCurrentLayerCtx);\n                        }\n                    }\n                } else if (actions[i].tool[0] === \"misc\" && actions[i].action === \"importImage\") {\n                    const id = canvas.addLayer();\n                    if (typeof id === 'number') {\n                        layerIndex = id;\n                        if (actions[i].params[1]) {\n                            this.getKlCanvas().renameLayer(layerIndex, actions[i].params[1]);\n                        }\n                        localCurrentLayerCtx = canvas.getLayerContext(layerIndex);\n                        for (let b in brushes) {\n                            if (brushes.hasOwnProperty(b)) {\n                                brushes[b].setContext(localCurrentLayerCtx);\n                            }\n                        }\n                    }\n                    localCurrentLayerCtx.drawImage(actions[i].params[0], 0, 0);\n                }\n            })(0);\n            initState.focus = layerIndex;\n        }\n        // console.log('catchup', performance.now() - start);\n    }\n\n\n}","import {IRGB, ISliderConfig} from '../kl.types';\n\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\n    { type: 'opacity'; value: number } |\n    { type: 'size'; value: number } |\n    { type: 'sliderConfig'; value: ISliderConfig };\n\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\n\n/**\n * Central place to update brush settings, and to subscribe to changes.\n */\nexport class BrushSettingService {\n\n    private static instance: BrushSettingService;\n    subscriberArr: TBrushSettingSubscriber[] = [];\n\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (this.subscriberArr[i] === skipSubscriber) {\n                continue;\n            }\n            this.subscriberArr[i](obj);\n        }\n    }\n\n    // --- public ---\n\n    constructor (\n        private onSetColor: (rgb: IRGB) => void,\n        private onSetSize: (size: number) => void,\n        private onSetOpacity: (opacity: number) => void,\n        private onGetColor: () => IRGB,\n        private onGetSize: () => number,\n        private onGetOpacity: () => number,\n        private onGetSliderConfig: () => ISliderConfig,\n    ) {\n        if (BrushSettingService.instance) {\n            throw new Error('BrushSettingService already instantiated');\n        }\n        BrushSettingService.instance = this;\n    }\n\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'color',\n                value: color\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'size',\n                value: size\n            },\n            skipSubscriber\n        );\n    }\n\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'opacity',\n                value: opacity\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\n        this.emit(\n            {\n                type: 'sliderConfig',\n                value: sliderConfig\n            },\n            skipSubscriber\n        );\n    }\n\n    /**\n     * set current brush color\n     * @param color\n     * @param skipSubscriber\n     */\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetColor(color);\n        this.emitColor(color, skipSubscriber);\n    }\n\n    /**\n     * set current brush size\n     * @param size\n     * @param skipSubscriber\n     */\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetSize(size);\n        // why not emitting?\n    }\n\n    /**\n     * set current opacity\n     * @param opacity\n     * @param skipSubscriber\n     */\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetOpacity(opacity);\n        // why not emitting?\n    }\n\n    /**\n     * get current brush color\n     */\n    getColor (): IRGB {\n        return this.onGetColor();\n    }\n\n    getSize (): number {\n        return this.onGetSize();\n    }\n\n    getOpacity (): number {\n        return this.onGetOpacity();\n    }\n\n    getSliderConfig (): ISliderConfig {\n        return this.onGetSliderConfig();\n    }\n\n    /**\n     * subscribe to changes\n     * @param func\n     */\n    subscribe (func: TBrushSettingSubscriber): void {\n        if (this.subscriberArr.includes(func)) {\n            return;\n        }\n        this.subscriberArr.push(func);\n    }\n\n    unsubscribe (func: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (func === this.subscriberArr[i]) {\n                this.subscriberArr.splice(i, 1);\n                i--;\n            }\n        }\n    }\n}\n\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {Popup} from '../modals/popup';\r\n// @ts-ignore\r\nimport bitbofLogoImg from 'url:~/src/app/img/bitbof-logo.svg';\r\n// @ts-ignore\r\nimport klecksLogoImg from 'url:~/src/app/img/klecks-logo.png';\r\n// @ts-ignore\r\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n        klRootEl?: HTMLElement,\r\n    ) {\r\n\r\n\r\n\r\n\r\n        // ---- language ----\r\n        const language = languageStrings.getLanguage();\r\n\r\n        this.el = BB.el({\r\n            content: `\r\n${LANG('settings-language')}: ${language.name} (${language.code})\r\n            `,\r\n            css: {\r\n                margin: '10px',\r\n            }\r\n        });\r\n\r\n        const preferredLanguageRow = BB.el({\r\n            content: LANG('settings-preferred-language') + ':<br>',\r\n            css: {\r\n                marginTop: '10px',\r\n            }\r\n        });\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto')] as [string, string]\r\n        ].concat(\r\n            languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`];\r\n            })\r\n        );\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        const languageHint = BB.el({\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n            }\r\n        });\r\n\r\n        preferredLanguageRow.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n        this.el.append(preferredLanguageRow);\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '20px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            }\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'gridHr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses() {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new Popup({\r\n                            target: klRootEl,\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    }\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                }\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   }\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2022<br>`\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    }\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"dijyJ\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"c4VmC\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"et4zb\"))).then(() => parcelRequire('jNQF2'));","import { BB } from '../../../bb/bb';\r\n// @ts-ignore\r\nimport caretImg from 'url:~/src/app/img/ui/caret-down.svg';\r\nimport { IKeyString } from '../../../bb/bb.types';\r\nimport { LANG } from '../../../language/language';\r\nimport { dialogCounter } from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private toolspace: HTMLElement;\r\n    private upBtn: HTMLElement;\r\n    private downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update(): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor(p: { toolspace: HTMLElement, uiState: 'left' | 'right' }) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace.parentNode,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            }\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace.parentNode,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            }\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update()\r\n                    }, 50);\r\n                }\r\n            }\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState(uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : null,\r\n            right: uiState === 'right' ? '0' : null,\r\n        });\r\n    }\r\n}","/**\n * Topmost row of buttons in toolspace\n *\n * p = { // button click callbacks\n *     onSubmit: function(),\n *     onLeftRight: function(),\n *     onHelp: function()\n * }\n *\n * @param p\n * @constructor\n */\nimport {BB} from \"../bb/bb\";\n// @ts-ignore\nimport uiSwapImg from 'url:~/src/app/img/ui/ui-swap-lr.svg';\n// @ts-ignore\nimport helpImg from 'url:~/src/app/img/ui/help.svg';\nimport {LANG} from '../language/language';\n\nexport class ToolspaceTopRow {\n    el: HTMLDivElement;\n\n    constructor(p: {onSubmit: () => void, onLeftRight: () => void, onHelp: () => void}) {\n        let div = document.createElement('div');\n        this.el = div;\n        BB.css(div, {\n            height: '36px',\n            //background: '#f00',\n            display: 'flex',\n            backgroundImage: 'linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)'\n        });\n\n        function createButton(p) {\n            let padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            let result = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\n                }\n            });\n            if (p.content) {\n                result.appendChild(p.content);\n            } else {\n                let im = BB.el({\n                    css: {\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\n                        backgroundRepeat: 'no-repeat',\n                        backgroundPosition: 'center',\n                        backgroundSize: p.contain ? 'contain' : '',\n                        //filter: 'grayscale(1)',\n                        height: '100%'\n                    }\n                });\n                im.style.pointerEvents = 'none';\n                result.appendChild(im);\n            }\n            (result as any).pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: result,\n                onEnterLeave: function(isOver) {\n                    if (isOver) {\n                        BB.addClassName(result, 'toolspace-row-button-hover');\n                    } else {\n                        BB.removeClassName(result, 'toolspace-row-button-hover');\n                    }\n                }\n            });\n            return result;\n        }\n\n        let submitButton = createButton({\n            onClick: p.onSubmit,\n            title: LANG('submit-title'),\n            content: BB.el({\n                content: LANG('submit'),\n                className: 'toolspace-row-button__submit',\n                css: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    width: '100%',\n                    height: '100%'\n                }\n            }),\n            contain: true\n        });\n        submitButton.style.width = '45px';\n\n        let helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true\n        });\n\n        let leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: LANG('switch-ui-left-right'),\n            image: uiSwapImg,\n            contain: true\n        });\n\n        div.appendChild(submitButton);\n        div.appendChild(leftRightButton);\n        div.appendChild(helpButton);\n    }\n\n    getElement() {\n        return this.el;\n    }\n}\n","import {filterLib, filterLibStatus} from './filters';\nimport {glBrightnessContrast} from './gl-brightness-contrast';\nimport {cropExtend} from './crop-extend';\nimport {glCurves} from './gl-curves';\nimport {flip} from './flip';\nimport {glHueSaturation} from './gl-hue-saturation';\nimport {invert} from './invert';\nimport {glPerspective} from './gl-perspective';\nimport {resize} from './resize';\nimport {rotate} from './rotate';\nimport {glTiltShift} from './gl-tilt-shift';\nimport {transform} from './transform';\nimport {glBlur} from './gl-blur';\nimport {glUnsharpMask} from './gl-unsharp-mask';\nimport {toAlpha} from './to-alpha';\n\nlet embed: boolean;\nfunction importFilter(libObj, moduleObj): void {\n    if (moduleObj.getDialog) {\n        libObj.getDialog = moduleObj.getDialog;\n    }\n    libObj.apply = moduleObj.apply;\n}\n\n\nexport function importFilters(isEmbed?: boolean) {\n    if (filterLibStatus.isLoaded) {\n        return;\n    }\n    embed = isEmbed\n\n    importFilter(filterLib.glBrightnessContrast, glBrightnessContrast);\n    importFilter(filterLib.cropExtend, cropExtend);\n    importFilter(filterLib.glCurves, glCurves);\n    importFilter(filterLib.flip, flip);\n    importFilter(filterLib.glHueSaturation, glHueSaturation);\n    importFilter(filterLib.invert, invert);\n    importFilter(filterLib.glPerspective, glPerspective);\n    importFilter(filterLib.resize, resize);\n    importFilter(filterLib.rotate, rotate);\n    importFilter(filterLib.glTiltShift, glTiltShift);\n    importFilter(filterLib.transform, transform);\n    importFilter(filterLib.glBlur, glBlur);\n    importFilter(filterLib.glUnsharpMask, glUnsharpMask);\n    importFilter(filterLib.toAlpha, toAlpha);\n\n    filterLibStatus.isLoaded = true;\n}","import {BB} from '../../bb/bb';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glBrightnessContrast = {\n    getDialog(params: IFilterGetDialogParam) {\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n\n        let context = params.context; //2d context of canvas\n        let canvas = params.canvas; //the klCanvas and dom element\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n\n        function finishInit() {\n\n            let brightness = 0, contrast = 0;\n            div.innerHTML = LANG('filter-bright-contrast-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let brightnessSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-brightness'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: (brightness + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brightness = val / 50 - 1;\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                }\n            });\n            let contrastSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-contrast'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: (contrast + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    contrast = val / 50 - 1;\n                    glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                }\n            });\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(brightnessSlider.getElement());\n            div.appendChild(contrastSlider.getElement());\n\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                brightnessSlider.destroy();\n                contrastSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    brightness: brightness,\n                    contrast: contrast\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let brightness = params.input.brightness;\n        let contrast = params.input.contrast;\n        let history = params.history;\n        if (!context || brightness === null || contrast === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glBrightnessContrast\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n\n        return true;\n    }\n}","\nexport const eventResMs = 60;","import {fx} from '../../../script-vendor/glfx';\n\nlet fxCanvas = null\ntry {\n    fxCanvas = fx.canvas();\n} catch (e) {\n}\n\nexport function getSharedFx() {\n    if (!fxCanvas || fxCanvas._.gl.isContextLost()) {\n        try {\n            fxCanvas = fx.canvas();\n        } catch (e) {\n        }\n    }\n    return fxCanvas;\n}","/*\n * glfx.script\n * http://evanw.github.com/glfx.js/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n *\n * modifications by bitbof\n */\nexport const fx = (function() {\nlet exports: any = {};\n\n// src/OES_texture_float_linear-polyfill.script\n// From: https://github.com/evanw/OES_texture_float_linear-polyfill\n(function() {\n  // Uploads a 2x2 floating-point texture where one pixel is 2 and the other\n  // three pixels are 0. Linear filtering is only supported if a sample taken\n  // from the center of that texture is (2 + 0 + 0 + 0) / 4 = 0.5.\n  function supportsOESTextureFloatLinear(gl) {\n    // Need floating point textures in the first place\n    if (!gl.getExtension('OES_texture_float')) {\n      return false;\n    }\n\n    // Create a render target\n    let framebuffer = gl.createFramebuffer();\n    let byteTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, byteTexture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, byteTexture, 0);\n\n    // Create a simple floating-point texture with value of 0.5 in the center\n    let rgba = [\n      2, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0,\n      0, 0, 0, 0\n    ];\n    let floatTexture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 2, 2, 0, gl.RGBA, gl.FLOAT, new Float32Array(rgba));\n\n    // Create the test shader\n    let program = gl.createProgram();\n    let vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    let fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(vertexShader, '\\\n      attribute vec2 vertex;\\\n      void main() {\\\n        gl_Position = vec4(vertex, 0.0, 1.0);\\\n      }\\\n    ');\n    gl.shaderSource(fragmentShader, '\\\n      uniform sampler2D texture;\\\n      void main() {\\\n        gl_FragColor = texture2D(texture, vec2(0.5));\\\n      }\\\n    ');\n    gl.compileShader(vertexShader);\n    gl.compileShader(fragmentShader);\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n\n    // Create a buffer containing a single point\n    let buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0]), gl.STREAM_DRAW);\n    gl.enableVertexAttribArray(0);\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n\n    // Render the point and read back the rendered pixel\n    let pixel = new Uint8Array(4);\n    gl.useProgram(program);\n    gl.viewport(0, 0, 1, 1);\n    gl.bindTexture(gl.TEXTURE_2D, floatTexture);\n    gl.drawArrays(gl.POINTS, 0, 1);\n    gl.readPixels(0, 0, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixel);\n\n    // The center sample will only have a value of 0.5 if linear filtering works\n    return pixel[0] === 127 || pixel[0] === 128;\n  }\n\n  // The constructor for the returned extension object\n  function OESTextureFloatLinear() {\n  }\n\n  // Cache the extension so it's specific to each context like extensions should be\n  function getOESTextureFloatLinear(gl) {\n    if (gl.$OES_texture_float_linear$ === void 0) {\n      Object.defineProperty(gl, '$OES_texture_float_linear$', {\n        enumerable: false,\n        configurable: false,\n        writable: false,\n        value: new OESTextureFloatLinear()\n      });\n    }\n    return gl.$OES_texture_float_linear$;\n  }\n\n  // This replaces the real getExtension()\n  function getExtension(name) {\n    return name === 'OES_texture_float_linear'\n      ? getOESTextureFloatLinear(this)\n      : oldGetExtension.call(this, name);\n  }\n\n  // This replaces the real getSupportedExtensions()\n  function getSupportedExtensions() {\n    let extensions = oldGetSupportedExtensions.call(this);\n    if (extensions.indexOf('OES_texture_float_linear') === -1) {\n      extensions.push('OES_texture_float_linear');\n    }\n    return extensions;\n  }\n\n  // Get a WebGL context\n  try {\n    let gl = document.createElement('canvas').getContext('experimental-webgl');\n  } catch (e) {\n  }\n\n  // Don't install the polyfill if the browser already supports it or doesn't have WebGL\n  if (!gl || (gl as any).getSupportedExtensions().indexOf('OES_texture_float_linear') !== -1) {\n    return;\n  }\n\n  // Install the polyfill if linear filtering works with floating-point textures\n  let oldGetExtension;\n  let oldGetSupportedExtensions;\n  if (supportsOESTextureFloatLinear(gl)) {\n    oldGetExtension = WebGLRenderingContext.prototype.getExtension;\n    oldGetSupportedExtensions = WebGLRenderingContext.prototype.getSupportedExtensions;\n    WebGLRenderingContext.prototype.getExtension = getExtension;\n    WebGLRenderingContext.prototype.getSupportedExtensions = getSupportedExtensions;\n  }\n}());\n\n// src/core\\canvas.script\nvar gl;\n\nfunction clamp(lo, value, hi) {\n    return Math.max(lo, Math.min(value, hi));\n}\n\nfunction wrapTexture(texture) {\n    return {\n        _: texture,\n        loadContentsOf: function(element) {\n            // Make sure that we're using the correct global WebGL context\n            gl = this._.gl;\n            this._.loadContentsOf(element);\n        },\n        destroy: function() {\n            // Make sure that we're using the correct global WebGL context\n            gl = this._.gl;\n            this._.destroy();\n        }\n    };\n}\n\nfunction texture(element) {\n    return wrapTexture(Texture.fromElement(element));\n}\n\nfunction initialize(width, height) {\n    let type = gl.UNSIGNED_BYTE;\n\n    // Go for floating point buffer textures if we can, it'll make the bokeh\n    // filter look a lot better. Note that on Windows, ANGLE does not let you\n    // render to a floating-point texture when linear filtering is enabled.\n    // See http://crbug.com/172278 for more information.\n    if (gl.getExtension('OES_texture_float') && gl.getExtension('OES_texture_float_linear')) {\n        let testTexture = new Texture(100, 100, gl.RGBA, gl.FLOAT);\n        try {\n            // Only use gl.FLOAT if we can render to it\n            testTexture.drawTo(function() { type = gl.FLOAT; });\n        } catch (e) {\n        }\n        testTexture.destroy();\n    }\n\n    if (this._.texture) this._.texture.destroy();\n    if (this._.spareTexture) this._.spareTexture.destroy();\n    this.width = width;\n    this.height = height;\n    this._.texture = new Texture(width, height, gl.RGBA, type);\n    this._.spareTexture = new Texture(width, height, gl.RGBA, type);\n    this._.extraTexture = this._.extraTexture || new Texture(0, 0, gl.RGBA, type);\n    this._.flippedShader = this._.flippedShader || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\\n        }\\\n    ', 'flippedShader');\n    this._.isInitialized = true;\n}\n\n/*\n   Draw a texture to the canvas, with an optional width and height to scale to.\n   If no width and height are given then the original texture width and height\n   are used.\n*/\nfunction draw(texture, width, height) {\n    if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\n        initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n    }\n\n    texture._.use();\n    this._.texture.drawTo(function() {\n        Shader.getDefaultShader().drawRect();\n    });\n\n    return this;\n}\n\nfunction update() {\n    this._.texture.use();\n    this._.flippedShader.drawRect();\n    return this;\n}\n\nfunction simpleShader(shader, uniforms, textureIn, textureOut) {\n    (textureIn || this._.texture).use();\n    this._.spareTexture.drawTo(function() {\n        shader.uniforms(uniforms).drawRect();\n    });\n    this._.spareTexture.swapWith(textureOut || this._.texture);\n}\n\nfunction replace(node) {\n    node.parentNode.insertBefore(this, node);\n    node.parentNode.removeChild(node);\n    return this;\n}\n\nfunction contents() {\n    let texture = new Texture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\n    this._.texture.use();\n    texture.drawTo(function() {\n        Shader.getDefaultShader().drawRect();\n    });\n    return wrapTexture(texture);\n}\n\n/*\n   Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\n   Length of the array will be width * height * 4.\n*/\nfunction getPixelArray() {\n    let w = this._.texture.width;\n    let h = this._.texture.height;\n    let array = new Uint8Array(w * h * 4);\n    this._.texture.drawTo(function() {\n        gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\n    });\n    return array;\n}\n\nfunction wrap(func) {\n    return function() {\n        // Make sure that we're using the correct global WebGL context\n        gl = this._.gl;\n\n        // Now that the context has been switched, we can call the wrapped function\n        return func.apply(this, arguments);\n    };\n}\n\nexports.canvas = function() {\n    let canvas: any = document.createElement('canvas');\n    try {\n        gl = canvas.getContext('experimental-webgl', { premultipliedAlpha: false });\n    } catch (e) {\n        gl = null;\n    }\n    if (!gl) {\n        throw 'This browser does not support WebGL';\n    }\n    canvas._ = {\n        gl: gl,\n        isInitialized: false,\n        texture: null,\n        spareTexture: null,\n        flippedShader: null\n    };\n\n    // Core methods\n    canvas.texture = wrap(texture);\n    canvas.draw = wrap(draw);\n    canvas.update = wrap(update);\n    canvas.replace = wrap(replace);\n    canvas.contents = wrap(contents);\n    canvas.getPixelArray = wrap(getPixelArray);\n\n    // Filter methods\n    canvas.brightnessContrast = wrap(brightnessContrast);\n    canvas.hexagonalPixelate = wrap(hexagonalPixelate);\n    canvas.hueSaturation = wrap(hueSaturation);\n    canvas.colorHalftone = wrap(colorHalftone);\n    canvas.triangleBlur = wrap(triangleBlur);\n    canvas.unsharpMask = wrap(unsharpMask);\n    canvas.perspective = wrap(perspective);\n    canvas.matrixWarp = wrap(matrixWarp);\n    canvas.bulgePinch = wrap(bulgePinch);\n    canvas.tiltShift = wrap(tiltShift);\n    canvas.dotScreen = wrap(dotScreen);\n    canvas.edgeWork = wrap(edgeWork);\n    canvas.lensBlur = wrap(lensBlur);\n    canvas.zoomBlur = wrap(zoomBlur);\n    canvas.noise = wrap(noise);\n    canvas.denoise = wrap(denoise);\n    canvas.curves = wrap(curves);\n    canvas.swirl = wrap(swirl);\n    canvas.ink = wrap(ink);\n    canvas.vignette = wrap(vignette);\n    canvas.vibrance = wrap(vibrance);\n    canvas.sepia = wrap(sepia);\n    canvas.invert = wrap(invert);\n    canvas.toAlpha = wrap(toAlpha);\n\n    return canvas;\n};\nexports.splineInterpolate = splineInterpolate;\n\n// src/core\\matrix.script\n// from javax.media.jai.PerspectiveTransform\n\nfunction getSquareToQuad(x0, y0, x1, y1, x2, y2, x3, y3) {\n    let dx1 = x1 - x2;\n    let dy1 = y1 - y2;\n    let dx2 = x3 - x2;\n    let dy2 = y3 - y2;\n    let dx3 = x0 - x1 + x2 - x3;\n    let dy3 = y0 - y1 + y2 - y3;\n    let det = dx1*dy2 - dx2*dy1;\n    let a = (dx3*dy2 - dx2*dy3) / det;\n    let b = (dx1*dy3 - dx3*dy1) / det;\n    return [\n        x1 - x0 + a*x1, y1 - y0 + a*y1, a,\n        x3 - x0 + b*x3, y3 - y0 + b*y3, b,\n        x0, y0, 1\n    ];\n}\n\nfunction getInverse(m) {\n    let a = m[0], b = m[1], c = m[2];\n    let d = m[3], e = m[4], f = m[5];\n    let g = m[6], h = m[7], i = m[8];\n    let det = a*e*i - a*f*h - b*d*i + b*f*g + c*d*h - c*e*g;\n    return [\n        (e*i - f*h) / det, (c*h - b*i) / det, (b*f - c*e) / det,\n        (f*g - d*i) / det, (a*i - c*g) / det, (c*d - a*f) / det,\n        (d*h - e*g) / det, (b*g - a*h) / det, (a*e - b*d) / det\n    ];\n}\n\nfunction multiply(a, b) {\n    return [\n        a[0]*b[0] + a[1]*b[3] + a[2]*b[6],\n        a[0]*b[1] + a[1]*b[4] + a[2]*b[7],\n        a[0]*b[2] + a[1]*b[5] + a[2]*b[8],\n        a[3]*b[0] + a[4]*b[3] + a[5]*b[6],\n        a[3]*b[1] + a[4]*b[4] + a[5]*b[7],\n        a[3]*b[2] + a[4]*b[5] + a[5]*b[8],\n        a[6]*b[0] + a[7]*b[3] + a[8]*b[6],\n        a[6]*b[1] + a[7]*b[4] + a[8]*b[7],\n        a[6]*b[2] + a[7]*b[5] + a[8]*b[8]\n    ];\n}\n\n// src/core\\shader.script\nvar Shader = (function() {\n    function isArray(obj) {\n        return Object.prototype.toString.call(obj) == '[object Array]';\n    }\n\n    function isNumber(obj) {\n        return Object.prototype.toString.call(obj) == '[object Number]';\n    }\n\n    function compileSource(type, source, nameStr) {\n        let shader = gl.createShader(type);\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\n        }\n        return shader;\n    }\n\n    let defaultVertexSource = '\\\n    attribute vec2 vertex;\\\n    attribute vec2 _texCoord;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        texCoord = _texCoord;\\\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\n    }';\n\n    let defaultFragmentSource = '\\\n    uniform sampler2D texture;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        gl_FragColor = texture2D(texture, texCoord);\\\n    }';\n\n    // added test 2020-04-27 bitbof\n    let floatPrecision = null;\n    function testPrecisionSupport(precisionType) {\n        let format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\n        return format !== null && format.precision !== 0;\n    }\n\n    function Shader(vertexSource?, fragmentSource?, nameStr?) {\n        this.vertexAttribute = null;\n        this.texCoordAttribute = null;\n        this.program = gl.createProgram();\n        vertexSource = vertexSource || defaultVertexSource;\n        fragmentSource = fragmentSource || defaultFragmentSource;\n        if (floatPrecision === null) {\n            floatPrecision = testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\n        }\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\n        gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\n        gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\n        gl.linkProgram(this.program);\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\n        }\n    }\n\n    Shader.prototype.destroy = function() {\n        gl.deleteProgram(this.program);\n        this.program = null;\n    };\n\n    Shader.prototype.uniforms = function(uniforms) {\n        gl.useProgram(this.program);\n        for (var name in uniforms) {\n            if (!uniforms.hasOwnProperty(name)) continue;\n            let location = gl.getUniformLocation(this.program, name);\n            if (location === null) continue; // will be null if the uniform isn't used in the shader\n            let value = uniforms[name];\n            if (isArray(value)) {\n                switch (value.length) {\n                    case 1: gl.uniform1fv(location, new Float32Array(value)); break;\n                    case 2: gl.uniform2fv(location, new Float32Array(value)); break;\n                    case 3: gl.uniform3fv(location, new Float32Array(value)); break;\n                    case 4: gl.uniform4fv(location, new Float32Array(value)); break;\n                    case 9: gl.uniformMatrix3fv(location, false, new Float32Array(value)); break;\n                    case 16: gl.uniformMatrix4fv(location, false, new Float32Array(value)); break;\n                    default: throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\n                }\n            } else if (isNumber(value)) {\n                gl.uniform1f(location, value);\n            } else {\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\n            }\n        }\n        // allow chaining\n        return this;\n    };\n\n    // textures are uniforms too but for some reason can't be specified by gl.uniform1f,\n    // even though floating point numbers represent the integers 0 through 7 exactly\n    Shader.prototype.textures = function(textures) {\n        gl.useProgram(this.program);\n        for (var name in textures) {\n            if (!textures.hasOwnProperty(name)) continue;\n            gl.uniform1i(gl.getUniformLocation(this.program, name), textures[name]);\n        }\n        // allow chaining\n        return this;\n    };\n\n    Shader.prototype.drawRect = function(left, top, right, bottom) {\n        let undefined;\n        let viewport = gl.getParameter(gl.VIEWPORT);\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n        if (gl.vertexBuffer == null) {\n            gl.vertexBuffer = gl.createBuffer();\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ left, top, left, bottom, right, top, right, bottom ]), gl.STATIC_DRAW);\n        if (gl.texCoordBuffer == null) {\n            gl.texCoordBuffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([ 0, 0, 0, 1, 1, 0, 1, 1 ]), gl.STATIC_DRAW);\n        }\n        if (this.vertexAttribute == null) {\n            this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\n            gl.enableVertexAttribArray(this.vertexAttribute);\n        }\n        if (this.texCoordAttribute == null) {\n            this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\n            gl.enableVertexAttribArray(this.texCoordAttribute);\n        }\n        gl.useProgram(this.program);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    };\n\n    Shader.getDefaultShader = function() {\n        gl.defaultShader = gl.defaultShader || new Shader();\n        return gl.defaultShader;\n    };\n\n    return Shader;\n})();\n\n// src/core\\spline.script\n// from SplineInterpolator.cs in the Paint.NET source code\n\nfunction SplineInterpolator(points) {\n    let n = points.length;\n    this.xa = [];\n    this.ya = [];\n    this.u = [];\n    this.y2 = [];\n\n    points.sort(function(a, b) {\n        return a[0] - b[0];\n    });\n    for (var i = 0; i < n; i++) {\n        this.xa.push(points[i][0]);\n        this.ya.push(points[i][1]);\n    }\n\n    this.u[0] = 0;\n    this.y2[0] = 0;\n\n    for (var i = 1; i < n - 1; ++i) {\n        // This is the decomposition loop of the tridiagonal algorithm. \n        // y2 and u are used for temporary storage of the decomposed factors.\n        let wx = this.xa[i + 1] - this.xa[i - 1];\n        let sig = (this.xa[i] - this.xa[i - 1]) / wx;\n        let p = sig * this.y2[i - 1] + 2.0;\n\n        this.y2[i] = (sig - 1.0) / p;\n\n        let ddydx = \n            (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) - \n            (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n        this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n    }\n\n    this.y2[n - 1] = 0;\n\n    // This is the backsubstitution loop of the tridiagonal algorithm\n    for (var i = n - 2; i >= 0; --i) {\n        this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n}\n\nSplineInterpolator.prototype.interpolate = function(x) {\n    let n = this.ya.length;\n    let klo = 0;\n    let khi = n - 1;\n\n    // We will find the right place in the table by means of\n    // bisection. This is optimal if sequential calls to this\n    // routine are at random values of x. If sequential calls\n    // are in order, and closely spaced, one would do better\n    // to store previous values of klo and khi.\n    while (khi - klo > 1) {\n        let k = (khi + klo) >> 1;\n\n        if (this.xa[k] > x) {\n            khi = k; \n        } else {\n            klo = k;\n        }\n    }\n\n    let h = this.xa[khi] - this.xa[klo];\n    let a = (this.xa[khi] - x) / h;\n    let b = (x - this.xa[klo]) / h;\n\n    // Cubic spline polynomial is now evaluated.\n    return a * this.ya[klo] + b * this.ya[khi] + \n        ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n};\n\n// src/core\\texture.script\nvar Texture = (function() {\n    Texture.fromElement = function(element) {\n        let texture = new Texture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\n        texture.loadContentsOf(element);\n        return texture;\n    };\n\n    function Texture(width, height, format, type) {\n        this.gl = gl;\n        this.id = gl.createTexture();\n        this.width = width;\n        this.height = height;\n        this.format = format;\n        this.type = type;\n\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        if (width && height) gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n    }\n\n    Texture.prototype.loadContentsOf = function(element) {\n        this.width = element.width || element.videoWidth;\n        this.height = element.height || element.videoHeight;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\n    };\n\n    Texture.prototype.initFromBytes = function(width, height, data) {\n        this.width = width;\n        this.height = height;\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\n    };\n\n    Texture.prototype.destroy = function() {\n        gl.deleteTexture(this.id);\n        this.id = null;\n    };\n\n    Texture.prototype.use = function(unit) {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n    };\n\n    Texture.prototype.unuse = function(unit) {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    };\n\n    Texture.prototype.ensureFormat = function(width, height, format, type) {\n        // allow passing an existing texture instead of individual arguments\n        if (arguments.length == 1) {\n            let texture = arguments[0];\n            width = texture.width;\n            height = texture.height;\n            format = texture.format;\n            type = texture.type;\n        }\n\n        // change the format only if required\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n    };\n\n    Texture.prototype.drawTo = function(callback) {\n        // start rendering to this texture\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            throw new Error('incomplete framebuffer');\n        }\n        gl.viewport(0, 0, this.width, this.height);\n\n        // do the drawing\n        callback();\n\n        // stop rendering to this texture\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    };\n\n    let canvas = null;\n\n    function getCanvas(texture) {\n        if (canvas == null) canvas = document.createElement('canvas');\n        canvas.width = texture.width;\n        canvas.height = texture.height;\n        let c = canvas.getContext('2d');\n        c.clearRect(0, 0, canvas.width, canvas.height);\n        return c;\n    }\n\n    Texture.prototype.fillUsingCanvas = function(callback) {\n        callback(getCanvas(this));\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, canvas);\n        return this;\n    };\n\n    Texture.prototype.toImage = function(image) {\n        this.use();\n        Shader.getDefaultShader().drawRect();\n        let size = this.width * this.height * 4;\n        let pixels = new Uint8Array(size);\n        let c = getCanvas(this);\n        let data = c.createImageData(this.width, this.height);\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n        for (var i = 0; i < size; i++) {\n            data.data[i] = pixels[i];\n        }\n        c.putImageData(data, 0, 0);\n        image.src = canvas.toDataURL();\n    };\n\n    Texture.prototype.swapWith = function(other) {\n        let temp;\n        temp = other.id; other.id = this.id; this.id = temp;\n        temp = other.width; other.width = this.width; this.width = temp;\n        temp = other.height; other.height = this.height; this.height = temp;\n        temp = other.format; other.format = this.format; this.format = temp;\n    };\n\n    return Texture;\n})();\n\n// src/filters\\common.script\nfunction warpShader(uniforms, warp) {\n    return new Shader(null, uniforms + '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        vec2 coord = texCoord * texSize;\\\n        ' + warp + '\\\n        gl_FragColor = texture2D(texture, coord / texSize);\\\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\n        if (coord != clampedCoord) {\\\n            /* fade to transparent if we are outside the image */\\\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\n        }\\\n    }', 'warp');\n}\n\n// returns a random number between 0 and 1\nvar randomShaderFunc = '\\\n    float random(vec3 scale, float seed) {\\\n        /* use the fragment position for a different seed per-pixel */\\\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\n    }\\\n';\n\n// src/filters\\adjust\\brightnesscontrast.script\n/**\n * @filter           Brightness / Contrast\n * @description      Provides additive brightness and multiplicative contrast control.\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nfunction brightnessContrast(brightness, contrast) {\n    gl.brightnessContrast = gl.brightnessContrast || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float brightness;\\\n        uniform float contrast;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.rgb += brightness;\\\n            if (contrast > 0.0) {\\\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\n            } else {\\\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\n            }\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'brightnessContrast');\n\n    simpleShader.call(this, gl.brightnessContrast, {\n        brightness: clamp(-1, brightness, 1),\n        contrast: clamp(-1, contrast, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\curves.script\nfunction splineInterpolate(points) {\n    let interpolator = new SplineInterpolator(points);\n    let array = [];\n    for (var i = 0; i < 256; i++) {\n        array.push(clamp(0, Math.floor(interpolator.interpolate(i / 255) * 256), 255));\n    }\n    return array;\n}\n\n/**\n * @filter      Curves\n * @description A powerful mapping tool that transforms the colors in the image\n *              by an arbitrary function. The function is interpolated between\n *              a set of 2D points using splines. The curves filter can take\n *              either one or three arguments which will apply the mapping to\n *              either luminance or RGB values, respectively.\n * @param red   A list of points that define the function for the red channel.\n *              Each point is a list of two values: the value before the mapping\n *              and the value after the mapping, both in the range 0 to 1. For\n *              example, [[0,1], [1,0]] would invert the red channel while\n *              [[0,0], [1,1]] would leave the red channel unchanged. If green\n *              and blue are omitted then this argument also applies to the\n *              green and blue channels.\n * @param green (optional) A list of points that define the function for the green\n *              channel (just like for red).\n * @param blue  (optional) A list of points that define the function for the blue\n *              channel (just like for red).\n */\nfunction curves(red, green, blue) {\n    // Create the ramp texture\n    red = splineInterpolate(red);\n    if (arguments.length == 1) {\n        green = blue = red;\n    } else {\n        green = splineInterpolate(green);\n        blue = splineInterpolate(blue);\n    }\n    let array = [];\n    for (var i = 0; i < 256; i++) {\n        array.splice(array.length, 0, red[i], green[i], blue[i], 255);\n    }\n    this._.extraTexture.initFromBytes(256, 1, array);\n    this._.extraTexture.use(1);\n\n    gl.curves = gl.curves || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform sampler2D map;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.r = texture2D(map, vec2(color.r)).r;\\\n            color.g = texture2D(map, vec2(color.g)).g;\\\n            color.b = texture2D(map, vec2(color.b)).b;\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'curves');\n\n    gl.curves.textures({\n        map: 1\n    });\n    simpleShader.call(this, gl.curves, {});\n\n    return this;\n}\n\n// src/filters\\adjust\\denoise.script\n/**\n * @filter         Denoise\n * @description    Smooths over grainy noise in dark images using an 9x9 box filter\n *                 weighted by color intensity, similar to a bilateral filter.\n * @param exponent The exponent of the color intensity difference, should be greater\n *                 than zero. A value of zero just gives an 9x9 box blur and high values\n *                 give the original image, but ideal values are usually around 10-20.\n */\nfunction denoise(exponent) {\n    // Do a 9x9 bilateral box filter\n    gl.denoise = gl.denoise || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float exponent;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 center = texture2D(texture, texCoord);\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            for (float x = -4.0; x <= 4.0; x += 1.0) {\\\n                for (float y = -4.0; y <= 4.0; y += 1.0) {\\\n                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);\\\n                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));\\\n                    weight = pow(weight, exponent);\\\n                    color += sample * weight;\\\n                    total += weight;\\\n                }\\\n            }\\\n            gl_FragColor = color / total;\\\n        }\\\n    ', 'denoise');\n\n    // Perform two iterations for stronger results\n    for (var i = 0; i < 2; i++) {\n        simpleShader.call(this, gl.denoise, {\n            exponent: Math.max(0, exponent),\n            texSize: [this.width, this.height]\n        });\n    }\n\n    return this;\n}\n\n// src/filters\\adjust\\huesaturation.script\n/**\n * @filter           Hue / Saturation\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\n *                   can be imagined as a cube where the axes are the red, green, and blue color\n *                   values. Hue changing works by rotating the color vector around the grayscale\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\n *                   Saturation is implemented by scaling all color channel values either toward\n *                   or away from the average color channel value.\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\n *                   and 1 is 180 degree rotation in the positive direction)\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nfunction hueSaturation(hue, saturation) {\n    gl.hueSaturation = gl.hueSaturation || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float hue;\\\n        uniform float saturation;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\n            float angle = hue * 3.14159265;\\\n            float s = sin(angle), c = cos(angle);\\\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\n            float len = length(color.rgb);\\\n            color.rgb = vec3(\\\n                dot(color.rgb, weights.xyz),\\\n                dot(color.rgb, weights.zxy),\\\n                dot(color.rgb, weights.yzx)\\\n            );\\\n            \\\n            /* saturation adjustment */\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            if (saturation > 0.0) {\\\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\n            } else {\\\n                color.rgb += (average - color.rgb) * (-saturation);\\\n            }\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'hueSaturation');\n\n    simpleShader.call(this, gl.hueSaturation, {\n        hue: clamp(-1, hue, 1),\n        saturation: clamp(-1, saturation, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\noise.script\n/**\n * @filter         Noise\n * @description    Adds black and white noise to the image.\n * @param amount   0 to 1 (0 for no effect, 1 for maximum noise)\n */\nfunction noise(amount) {\n    gl.noise = gl.noise || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        float rand(vec2 co) {\\\n            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\\\n        }\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            float diff = (rand(texCoord) - 0.5) * amount;\\\n            color.r += diff;\\\n            color.g += diff;\\\n            color.b += diff;\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'noise');\n\n    simpleShader.call(this, gl.noise, {\n        amount: clamp(0, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\sepia.script\n/**\n * @filter         Sepia\n * @description    Gives the image a reddish-brown monochrome tint that imitates an old photograph.\n * @param amount   0 to 1 (0 for no effect, 1 for full sepia coloring)\n */\nfunction sepia(amount) {\n    gl.sepia = gl.sepia || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float r = color.r;\\\n            float g = color.g;\\\n            float b = color.b;\\\n            \\\n            color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));\\\n            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));\\\n            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'sepia');\n\n    simpleShader.call(this, gl.sepia, {\n        amount: clamp(0, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\unsharpmask.script\n/**\n * @filter         Unsharp Mask\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\n *                 is implemented by scaling pixels away from the average of their neighbors.\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\n */\nfunction unsharpMask(radius, strength) {\n    gl.unsharpMask = gl.unsharpMask || new Shader(null, '\\\n        uniform sampler2D blurredTexture;\\\n        uniform sampler2D originalTexture;\\\n        uniform float strength;\\\n        uniform float threshold;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\n            vec4 original = texture2D(originalTexture, texCoord);\\\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\n        }\\\n    ', 'unsharpMask');\n\n    // Store a copy of the current texture in the second texture unit\n    this._.extraTexture.ensureFormat(this._.texture);\n    this._.texture.use();\n    this._.extraTexture.drawTo(function() {\n        Shader.getDefaultShader().drawRect();\n    });\n\n    // Blur the current texture, then use the stored texture to detect edges\n    this._.extraTexture.use(1);\n    this.triangleBlur(radius);\n    gl.unsharpMask.textures({\n        originalTexture: 1\n    });\n    simpleShader.call(this, gl.unsharpMask, {\n        strength: strength\n    });\n    this._.extraTexture.unuse(1);\n\n    return this;\n}\n\n// src/filters\\adjust\\vibrance.script\n/**\n * @filter       Vibrance\n * @description  Modifies the saturation of desaturated colors, leaving saturated colors unmodified.\n * @param amount -1 to 1 (-1 is minimum vibrance, 0 is no change, and 1 is maximum vibrance)\n */\nfunction vibrance(amount) {\n    gl.vibrance = gl.vibrance || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            float mx = max(color.r, max(color.g, color.b));\\\n            float amt = (mx - average) * (-amount * 3.0);\\\n            color.rgb = mix(color.rgb, vec3(mx), amt);\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'vibrance');\n\n    simpleShader.call(this, gl.vibrance, {\n        amount: clamp(-1, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\adjust\\vignette.script\n/**\n * @filter         Vignette\n * @description    Adds a simulated lens edge darkening effect.\n * @param size     0 to 1 (0 for center of frame, 1 for edge of frame)\n * @param amount   0 to 1 (0 for no effect, 1 for maximum lens darkening)\n */\nfunction vignette(size, amount) {\n    gl.vignette = gl.vignette || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float size;\\\n        uniform float amount;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            float dist = distance(texCoord, vec2(0.5, 0.5));\\\n            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'vignette');\n\n    simpleShader.call(this, gl.vignette, {\n        size: clamp(0, size, 1),\n        amount: clamp(0, amount, 1)\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\lensblur.script\n/**\n * @filter           Lens Blur\n * @description      Imitates a camera capturing the image out of focus by using a blur that generates\n *                   the large shapes known as bokeh. The polygonal shape of real bokeh is due to the\n *                   blades of the aperture diaphragm when it isn't fully open. This blur renders\n *                   bokeh from a 6-bladed diaphragm because the computation is more efficient. It\n *                   can be separated into three rhombi, each of which is just a skewed box blur.\n *                   This filter makes use of the floating point texture WebGL extension to implement\n *                   the brightness parameter, so there will be severe visual artifacts if brightness\n *                   is non-zero and the floating point texture extension is not available. The\n *                   idea was from John White's SIGGRAPH 2011 talk but this effect has an additional\n *                   brightness parameter that fakes what would otherwise come from a HDR source.\n * @param radius     the radius of the hexagonal disk convolved with the image\n * @param brightness -1 to 1 (the brightness of the bokeh, negative values will create dark bokeh)\n * @param angle      the rotation of the bokeh in radians\n */\nfunction lensBlur(radius, brightness, angle) {\n    // All averaging is done on values raised to a power to make more obvious bokeh\n    // (we will raise the average to the inverse power at the end to compensate).\n    // Without this the image looks almost like a normal blurred image. This hack is\n    // obviously not realistic, but to accurately simulate this we would need a high\n    // dynamic range source photograph which we don't have.\n    gl.lensBlurPrePass = gl.lensBlurPrePass || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float power;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color = pow(color, vec4(power));\\\n            gl_FragColor = vec4(color);\\\n        }\\\n    ', 'lensBlurPrePass');\n\n    let common = '\\\n        uniform sampler2D texture0;\\\n        uniform sampler2D texture1;\\\n        uniform vec2 delta0;\\\n        uniform vec2 delta1;\\\n        uniform float power;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        vec4 sample(vec2 delta) {\\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(delta, 151.7182), 0.0);\\\n            \\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            for (float t = 0.0; t <= 30.0; t++) {\\\n                float percent = (t + offset) / 30.0;\\\n                color += texture2D(texture0, texCoord + delta * percent);\\\n                total += 1.0;\\\n            }\\\n            return color / total;\\\n        }\\\n    ';\n\n    gl.lensBlur0 = gl.lensBlur0 || new Shader(null, common + '\\\n        void main() {\\\n            gl_FragColor = sample(delta0);\\\n        }\\\n    ', 'lensBlur0');\n    gl.lensBlur1 = gl.lensBlur1 || new Shader(null, common + '\\\n        void main() {\\\n            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;\\\n        }\\\n    ', 'lensBlur1');\n    gl.lensBlur2 = gl.lensBlur2 || new Shader(null, common + '\\\n        void main() {\\\n            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;\\\n            gl_FragColor = pow(color, vec4(power));\\\n        }\\\n    ', 'lensBlur2').textures({ texture1: 1 });\n\n    // Generate\n    let dir = [];\n    for (var i = 0; i < 3; i++) {\n        let a = angle + i * Math.PI * 2 / 3;\n        dir.push([radius * Math.sin(a) / this.width, radius * Math.cos(a) / this.height]);\n    }\n    let power = Math.pow(10, clamp(-1, brightness, 1));\n\n    // Remap the texture values, which will help make the bokeh effect\n    simpleShader.call(this, gl.lensBlurPrePass, {\n        power: power\n    });\n\n    // Blur two rhombi in parallel into extraTexture\n    this._.extraTexture.ensureFormat(this._.texture);\n    simpleShader.call(this, gl.lensBlur0, {\n        delta0: dir[0]\n    }, this._.texture, this._.extraTexture);\n    simpleShader.call(this, gl.lensBlur1, {\n        delta0: dir[1],\n        delta1: dir[2]\n    }, this._.extraTexture, this._.extraTexture);\n\n    // Blur the last rhombus and combine with extraTexture\n    simpleShader.call(this, gl.lensBlur0, {\n        delta0: dir[1]\n    });\n    this._.extraTexture.use(1);\n    simpleShader.call(this, gl.lensBlur2, {\n        power: 1 / power,\n        delta0: dir[2]\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\tiltshift.script\n/**\n * @filter               Tilt Shift\n * @description          Simulates the shallow depth of field normally encountered in close-up\n *                       photography, which makes the scene seem much smaller than it actually\n *                       is. This filter assumes the scene is relatively planar, in which case\n *                       the part of the scene that is completely in focus can be described by\n *                       a line (the intersection of the focal plane and the scene). An example\n *                       of a planar scene might be looking at a road from above at a downward\n *                       angle. The image is then blurred with a blur radius that starts at zero\n *                       on the line and increases further from the line.\n * @param startX         The x coordinate of the start of the line segment.\n * @param startY         The y coordinate of the start of the line segment.\n * @param endX           The x coordinate of the end of the line segment.\n * @param endY           The y coordinate of the end of the line segment.\n * @param blurRadius     The maximum radius of the pyramid blur.\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\n */\nfunction tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\n    gl.tiltShift = gl.tiltShift || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float blurRadius;\\\n        uniform float gradientRadius;\\\n        uniform vec2 start;\\\n        uniform vec2 end;\\\n        uniform vec2 delta;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'tiltShift');\n\n    let dx = endX - startX;\n    let dy = endY - startY;\n    let d = Math.sqrt(dx * dx + dy * dy);\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [dx / d, dy / d],\n        texSize: [this.width, this.height]\n    });\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [-dy / d, dx / d],\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\triangleblur.script\n/**\n * @filter       Triangle Blur\n * @description  This is the most basic blur filter, which convolves the image with a\n *               pyramid filter. The pyramid filter is separable and is applied as two\n *               perpendicular triangle filters.\n * @param radius The radius of the pyramid convolved with the image.\n */\nfunction triangleBlur(radius) {\n    gl.triangleBlur = gl.triangleBlur || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'triangleBlur');\n\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [radius / this.width, 0]\n    });\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [0, radius / this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\blur\\zoomblur.script\n/**\n * @filter         Zoom Blur\n * @description    Blurs the image away from a certain point, which looks like radial motion blur.\n * @param centerX  The x coordinate of the blur origin.\n * @param centerY  The y coordinate of the blur origin.\n * @param strength The strength of the blur. Values in the range 0 to 1 are usually sufficient,\n *                 where 0 doesn't change the image and 1 creates a highly blurred image.\n */\nfunction zoomBlur(centerX, centerY, strength) {\n    gl.zoomBlur = gl.zoomBlur || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            vec2 toCenter = center - texCoord * texSize;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = 0.0; t <= 40.0; t++) {\\\n                float percent = (t + offset) / 40.0;\\\n                float weight = 4.0 * (percent - percent * percent);\\\n                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);\\\n                \\\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\n                sample.rgb *= sample.a;\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n            \\\n            /* switch back from pre-multiplied alpha */\\\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\n        }\\\n    ', 'zoomBlur');\n\n    simpleShader.call(this, gl.zoomBlur, {\n        center: [centerX, centerY],\n        strength: strength,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\colorhalftone.script\n/**\n * @filter        Color Halftone\n * @description   Simulates a CMYK halftone rendering of the image by multiplying pixel values\n *                with a four rotated 2D sine wave patterns, one each for cyan, magenta, yellow,\n *                and black.\n * @param centerX The x coordinate of the pattern origin.\n * @param centerY The y coordinate of the pattern origin.\n * @param angle   The rotation of the pattern in radians.\n * @param size    The diameter of a dot in pixels.\n */\nfunction colorHalftone(centerX, centerY, angle, size) {\n    gl.colorHalftone = gl.colorHalftone || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float angle;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        \\\n        float pattern(float angle) {\\\n            float s = sin(angle), c = cos(angle);\\\n            vec2 tex = texCoord * texSize - center;\\\n            vec2 point = vec2(\\\n                c * tex.x - s * tex.y,\\\n                s * tex.x + c * tex.y\\\n            ) * scale;\\\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\n        }\\\n        \\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            vec3 cmy = 1.0 - color.rgb;\\\n            float k = min(cmy.x, min(cmy.y, cmy.z));\\\n            cmy = (cmy - k) / (1.0 - k);\\\n            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);\\\n            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);\\\n            gl_FragColor = vec4(1.0 - cmy - k, color.a);\\\n        }\\\n    ', 'colorHalftone');\n\n    simpleShader.call(this, gl.colorHalftone, {\n        center: [centerX, centerY],\n        angle: angle,\n        scale: Math.PI / size,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\dotscreen.script\n/**\n * @filter        Dot Screen\n * @description   Simulates a black and white halftone rendering of the image by multiplying\n *                pixel values with a rotated 2D sine wave pattern.\n * @param centerX The x coordinate of the pattern origin.\n * @param centerY The y coordinate of the pattern origin.\n * @param angle   The rotation of the pattern in radians.\n * @param size    The diameter of a dot in pixels.\n */\nfunction dotScreen(centerX, centerY, angle, size) {\n    gl.dotScreen = gl.dotScreen || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float angle;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        \\\n        float pattern() {\\\n            float s = sin(angle), c = cos(angle);\\\n            vec2 tex = texCoord * texSize - center;\\\n            vec2 point = vec2(\\\n                c * tex.x - s * tex.y,\\\n                s * tex.x + c * tex.y\\\n            ) * scale;\\\n            return (sin(point.x) * sin(point.y)) * 4.0;\\\n        }\\\n        \\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\\\n        }\\\n    ', 'dotScreen');\n\n    simpleShader.call(this, gl.dotScreen, {\n        center: [centerX, centerY],\n        angle: angle,\n        scale: Math.PI / size,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\edgework.script\n/**\n * @filter       Edge Work\n * @description  Picks out different frequencies in the image by subtracting two\n *               copies of the image blurred with different radii.\n * @param radius The radius of the effect in pixels.\n */\nfunction edgeWork(radius) {\n    gl.edgeWork1 = gl.edgeWork1 || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec2 color = vec2(0.0);\\\n            vec2 total = vec2(0.0);\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;\\\n                float average = (sample.r + sample.g + sample.b) / 3.0;\\\n                color.x += average * weight;\\\n                total.x += weight;\\\n                if (abs(t) < 15.0) {\\\n                    weight = weight * 2.0 - 1.0;\\\n                    color.y += average * weight;\\\n                    total.y += weight;\\\n                }\\\n            }\\\n            gl_FragColor = vec4(color / total, 0.0, 1.0);\\\n        }\\\n    ', 'edgeWork1');\n    gl.edgeWork2 = gl.edgeWork2 || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec2 color = vec2(0.0);\\\n            vec2 total = vec2(0.0);\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;\\\n                color.x += sample.x * weight;\\\n                total.x += weight;\\\n                if (abs(t) < 15.0) {\\\n                    weight = weight * 2.0 - 1.0;\\\n                    color.y += sample.y * weight;\\\n                    total.y += weight;\\\n                }\\\n            }\\\n            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);\\\n            gl_FragColor = vec4(c, c, c, 1.0);\\\n        }\\\n    ', 'edgeWork2');\n\n    simpleShader.call(this, gl.edgeWork1, {\n        delta: [radius / this.width, 0]\n    });\n    simpleShader.call(this, gl.edgeWork2, {\n        delta: [0, radius / this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\hexagonalpixelate.script\n/**\n * @filter        Hexagonal Pixelate\n * @description   Renders the image using a pattern of hexagonal tiles. Tile colors\n *                are nearest-neighbor sampled from the centers of the tiles.\n * @param centerX The x coordinate of the pattern center.\n * @param centerY The y coordinate of the pattern center.\n * @param scale   The width of an individual tile, in pixels.\n */\nfunction hexagonalPixelate(centerX, centerY, scale) {\n    gl.hexagonalPixelate = gl.hexagonalPixelate || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 center;\\\n        uniform float scale;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec2 tex = (texCoord * texSize - center) / scale;\\\n            tex.y /= 0.866025404;\\\n            tex.x -= tex.y * 0.5;\\\n            \\\n            vec2 a;\\\n            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));\\\n            else a = vec2(ceil(tex.x), ceil(tex.y));\\\n            vec2 b = vec2(ceil(tex.x), floor(tex.y));\\\n            vec2 c = vec2(floor(tex.x), ceil(tex.y));\\\n            \\\n            vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\\\n            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\\\n            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\\\n            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\\\n            \\\n            float alen = length(TEX - A);\\\n            float blen = length(TEX - B);\\\n            float clen = length(TEX - C);\\\n            \\\n            vec2 choice;\\\n            if (alen < blen) {\\\n                if (alen < clen) choice = a;\\\n                else choice = c;\\\n            } else {\\\n                if (blen < clen) choice = b;\\\n                else choice = c;\\\n            }\\\n            \\\n            choice.x += choice.y * 0.5;\\\n            choice.y *= 0.866025404;\\\n            choice *= scale / texSize;\\\n            gl_FragColor = texture2D(texture, choice + center / texSize);\\\n        }\\\n    ', 'hexagonalPixelate');\n\n    simpleShader.call(this, gl.hexagonalPixelate, {\n        center: [centerX, centerY],\n        scale: scale,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\fun\\ink.script\n/**\n * @filter         Ink\n * @description    Simulates outlining the image in ink by darkening edges stronger than a\n *                 certain threshold. The edge detection value is the difference of two\n *                 copies of the image, each blurred using a blur of a different radius.\n * @param strength The multiplicative scale of the ink edges. Values in the range 0 to 1\n *                 are usually sufficient, where 0 doesn't change the image and 1 adds lots\n *                 of black edges. Negative strength values will create white ink edges\n *                 instead of black ones.\n */\nfunction ink(strength) {\n    gl.ink = gl.ink || new Shader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float strength;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec2 dx = vec2(1.0 / texSize.x, 0.0);\\\n            vec2 dy = vec2(0.0, 1.0 / texSize.y);\\\n            vec4 color = texture2D(texture, texCoord);\\\n            float bigTotal = 0.0;\\\n            float smallTotal = 0.0;\\\n            vec3 bigAverage = vec3(0.0);\\\n            vec3 smallAverage = vec3(0.0);\\\n            for (float x = -2.0; x <= 2.0; x += 1.0) {\\\n                for (float y = -2.0; y <= 2.0; y += 1.0) {\\\n                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\\\n                    bigAverage += sample;\\\n                    bigTotal += 1.0;\\\n                    if (abs(x) + abs(y) < 2.0) {\\\n                        smallAverage += sample;\\\n                        smallTotal += 1.0;\\\n                    }\\\n                }\\\n            }\\\n            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\\\n            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);\\\n        }\\\n    ', 'ink');\n\n    simpleShader.call(this, gl.ink, {\n        strength: strength * strength * strength * strength * strength,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\warp\\bulgepinch.script\n/**\n * @filter         Bulge / Pinch\n * @description    Bulges or pinches the image in a circle.\n * @param centerX  The x coordinate of the center of the circle of effect.\n * @param centerY  The y coordinate of the center of the circle of effect.\n * @param radius   The radius of the circle of effect.\n * @param strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge)\n */\nfunction bulgePinch(centerX, centerY, radius, strength) {\n    gl.bulgePinch = gl.bulgePinch || warpShader('\\\n        uniform float radius;\\\n        uniform float strength;\\\n        uniform vec2 center;\\\n    ', '\\\n        coord -= center;\\\n        float distance = length(coord);\\\n        if (distance < radius) {\\\n            float percent = distance / radius;\\\n            if (strength > 0.0) {\\\n                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);\\\n            } else {\\\n                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);\\\n            }\\\n        }\\\n        coord += center;\\\n    ');\n\n    simpleShader.call(this, gl.bulgePinch, {\n        radius: radius,\n        strength: clamp(-1, strength, 1),\n        center: [centerX, centerY],\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n// src/filters\\warp\\matrixwarp.script\n/**\n * @filter                Matrix Warp\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\n *                        3x3 matrix, where x and y are in units of pixels.\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\n * @param inverse         A boolean value that, when true, applies the inverse transformation\n *                        instead. (optional, defaults to false)\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\n *                        instead of screen-space coordinates. Texture-space coordinates range\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\n *                        to use for simple operations like flipping and rotating.\n */\nfunction matrixWarp(matrix, inverse, useTextureSpace) {\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\n        uniform mat3 matrix;\\\n        uniform bool useTextureSpace;\\\n    ', '\\\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\n        vec3 warp = matrix * vec3(coord, 1.0);\\\n        coord = warp.xy / warp.z;\\\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\n    ');\n\n    // Flatten all members of matrix into one big list\n    matrix = Array.prototype.concat.apply([], matrix);\n\n    // Extract a 3x3 matrix out of the arguments\n    if (matrix.length == 4) {\n        matrix = [\n            matrix[0], matrix[1], 0,\n            matrix[2], matrix[3], 0,\n            0, 0, 1\n        ];\n    } else if (matrix.length != 9) {\n        throw 'can only warp with 2x2 or 3x3 matrix';\n    }\n\n    simpleShader.call(this, gl.matrixWarp, {\n        matrix: inverse ? getInverse(matrix) : matrix,\n        texSize: [this.width, this.height],\n        useTextureSpace: useTextureSpace | 0\n    });\n\n    return this;\n}\n\n// src/filters\\warp\\perspective.script\n/**\n * @filter       Perspective\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\n * @param before The x and y coordinates of four points before the transform in a flat list. This\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\n *               (cx, cy), and (dx, dy).\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\n *               like the other argument.\n */\nfunction perspective(before, after) {\n    let a = getSquareToQuad.apply(null, after);\n    let b = getSquareToQuad.apply(null, before);\n    let c = multiply(getInverse(a), b);\n    return this.matrixWarp(c);\n}\n\n// src/filters\\warp\\swirl.script\n/**\n * @filter        Swirl\n * @description   Warps a circular region of the image in a swirl.\n * @param centerX The x coordinate of the center of the circular region.\n * @param centerY The y coordinate of the center of the circular region.\n * @param radius  The radius of the circular region.\n * @param angle   The angle in radians that the pixels in the center of\n *                the circular region will be rotated by.\n */\nfunction swirl(centerX, centerY, radius, angle) {\n    gl.swirl = gl.swirl || warpShader('\\\n        uniform float radius;\\\n        uniform float angle;\\\n        uniform vec2 center;\\\n    ', '\\\n        coord -= center;\\\n        float distance = length(coord);\\\n        if (distance < radius) {\\\n            float percent = (radius - distance) / radius;\\\n            float theta = percent * percent * angle;\\\n            float s = sin(theta);\\\n            float c = cos(theta);\\\n            coord = vec2(\\\n                coord.x * c - coord.y * s,\\\n                coord.x * s + coord.y * c\\\n            );\\\n        }\\\n        coord += center;\\\n    ');\n\n    simpleShader.call(this, gl.swirl, {\n        radius: radius,\n        center: [centerX, centerY],\n        angle: angle,\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n/**\n * @filter        Invert\n * @description   Inverts color of each pixel\n */\nfunction invert() {\n    gl.invert = gl.invert || new Shader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);\\\n    }\\\n', 'invert');\n\n    simpleShader.call(this, gl.invert, {\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n/**\n * @filter        To Alpha\n * @description   Generates alpha channel from luminance (r+g+b)\n * @param isInverted    boolean - invert luminance\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\n */\nfunction toAlpha(isInverted, replaceRGBA) {\n    gl.toAlpha = gl.toAlpha || new Shader(null, '\\\n    uniform bool isInverted;\\\n    uniform vec4 replace;\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\n        if (isInverted) alpha = 1.0 - alpha;\\\n        alpha = min(color.a, alpha);\\\n        if (replace.a > 0.0) color = replace;\\\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\n    }\\\n', 'toAlpha');\n\n    simpleShader.call(this, gl.toAlpha, {\n        isInverted: isInverted ? 1 : 0,\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0,0,0,0],\n        texSize: [this.width, this.height]\n    });\n\n    return this;\n}\n\n\nreturn exports;\n})();\n","import {BB} from '../../bb/bb';\nimport {input} from '../ui/base-components/input';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {Cropper} from '../ui/components/cropper';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const cropExtend = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        const canvas = params.canvas;\n        if (!canvas)\n            return false;\n        const tempCanvas = BB.canvas();\n        {\n            let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 560, 400, 1);\n            let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n            let previewFactor = w / canvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = 'block';\n            tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n\n        const div = document.createElement(\"div\");\n        const result: any = {\n            element: div\n        };\n        div.innerHTML = LANG('filter-crop-description') + \"<br/><br/>\";\n        let left = 0, right = 0, top = 0, bottom = 0;\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        let scale;\n\n\n\n        // --- input elements ---\n\n        const lrWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'}\n        });\n        const tbWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'}\n        });\n        div.appendChild(lrWrapper);\n        div.appendChild(tbWrapper);\n\n        const leftInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                leftChanged = true;\n                updateInput();\n            }\n        });\n        const rightInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px'},\n            callback: function(v) {\n                rightChanged = true;\n                updateInput();\n            }\n        });\n        const topInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function(v) {\n                topChanged = true;\n                updateInput();\n            }\n        });\n        const bottomInput = input({\n            init: 0,\n            type: 'number',\n            min: -canvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px'},\n            callback: function(v) {\n                bottomChanged = true;\n                updateInput();\n            }\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            width: '60px'\n        };\n        lrWrapper.append(\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\n            leftInput,\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\n            rightInput\n        );\n        tbWrapper.append(\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\n            topInput,\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\n            bottomInput\n        );\n\n        function updateInput() {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            let newWidth = canvas.getWidth() + left + right;\n            let newHeight = canvas.getHeight() + top + bottom;\n\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -canvas.getWidth() - right + 1;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -canvas.getWidth() - left + 1;\n                    rightInput.value = '' + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -canvas.getWidth() - right + maxWidth;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -canvas.getWidth() - left + maxWidth;\n                    rightInput.value = '' + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -canvas.getHeight() - bottom + 1;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -canvas.getHeight() - top + 1;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -canvas.getHeight() - bottom + maxHeight;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -canvas.getHeight() - top + maxHeight;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight\n            });\n\n\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        }\n\n        let useRuleOfThirds = true;\n        let ruleOThirdsCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-crop-rule-thirds'),\n            allowTab: true,\n            callback: function(b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            }\n        });\n        div.appendChild(BB.el({\n            css: {\n                clear: 'both'\n            }\n        }));\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 0},\n            {r: 255, g: 255, b: 255, a: 1},\n            {r: 0, g: 0, b: 0, a: 1}\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n\n        const colorOptions = new ColorOptions({\n            label: LANG('filter-crop-fill'),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                updateBg(rgbaObj);\n            }\n        });\n\n\n        const flexRow = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between'\n            }\n        });\n        div.appendChild(flexRow);\n        flexRow.appendChild(ruleOThirdsCheckbox.getElement());\n        flexRow.appendChild(colorOptions.getElement());\n\n\n        // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update(transform) {\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n\n            const offset = BB.centerWithin(340, 220, fit.width, fit.height);\n\n            tempCanvas.style.width = canvas.getWidth() * scale + \"px\";\n            tempCanvas.style.height = canvas.getHeight() * scale + \"px\";\n\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + \"px\";\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + \"px\";\n\n            left = parseInt('' + -transform.x);\n            top = parseInt('' + -transform.y);\n            right = parseInt('' + (transform.x + transform.width - canvas.getWidth()));\n            bottom = parseInt('' + (transform.y + transform.height - canvas.getHeight()));\n            leftInput.value = '' + left;\n            topInput.value = '' + top;\n            rightInput.value = '' + right;\n            bottomInput.value = '' + bottom;\n\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                previewWrapper.style.background = \"url(\" + url + \")\";\n                if (selectedRgbaObj.a !== 0) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                }\n            });\n            previewWrapper.style.backgroundPosition = (offset.x) + \"px \" + (offset.y) + \"px\";\n\n            cropper.setScale(scale);\n        }\n\n        const previewWrapper = BB.el({\n            css: {\n                width: \"340px\",\n                marginTop: '10px',\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                position: \"relative\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                userSelect: 'none',\n                colorScheme: 'only light',\n                touchAction: 'none',\n            }\n        });\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        const bgColorOverlay = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0'\n            }\n        });\n        previewWrapper.appendChild(bgColorOverlay);\n\n        const offsetWrapper = document.createElement(\"div\");\n        offsetWrapper.style.position = \"absolute\";\n        offsetWrapper.style.left = \"0px\";\n        offsetWrapper.style.top = \"0px\";\n        previewWrapper.appendChild(offsetWrapper);\n\n\n        const canvasWrapper = BB.appendTextDiv(offsetWrapper, \"\");\n        canvasWrapper.appendChild(tempCanvas);\n        //tempCanvas.style.width = w + \"px\";\n        //tempCanvas.style.height = h + \"px\";\n        tempCanvas.style.boxShadow = \"0 0 3px 1px rgba(0,0,0,0.5)\";\n        tempCanvas.style.position = \"absolute\";\n        tempCanvas.style.left = \"0px\";\n        tempCanvas.style.top = \"0px\";\n\n        div.appendChild(previewWrapper);\n        const cropper = new Cropper({\n            x: 0,\n            y: 0,\n            width: canvas.getWidth(),\n            height: canvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight\n        });\n        update(cropper.getTransform());\n        offsetWrapper.appendChild(cropper.getElement());\n\n        function updateBg(rgbaObj) {\n\n            let borderColor;\n            if (rgbaObj.a === 0) {\n                borderColor = 'rgba(0,0,0,0.5)';\n                bgColorOverlay.style.background = '';\n                tempCanvas.style.background = '';\n            } else {\n                borderColor = (rgbaObj.r + rgbaObj.g + rgbaObj.b < 255 * 3 / 2) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)'\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(rgbaObj);\n\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                });\n            }\n            tempCanvas.style.boxShadow = \"0 0 3px 1px \" + borderColor;\n        }\n\n        result.destroy = () => {\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? null : selectedRgbaObj\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        const canvas = params.canvas;\n        const history = params.history;\n        if (!canvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) {\n            return false;\n        }\n        history.pause(true);\n        canvas.resizeCanvas(params.input);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"cropExtend\"],\n            action: \"apply\",\n            params: [{\n                input: JSON.parse(JSON.stringify(params.input))\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {Options} from '../ui/base-components/options';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glCurves = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div,\n        };\n        let klCanvasPreview;\n\n        function finishInit() {\n\n            let previewFactor = w / context.canvas.width;\n            let brightness = 0, contrast = 0;\n\n            div.innerHTML = LANG('filter-curves-description') + \"<br/><br/>\";\n\n            let curves = {\n                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n            };\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            function update() {\n                try {\n                    glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n                    if (klCanvasPreview) {\n                        klCanvasPreview.render();\n                    }\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }\n\n            let modeButtons;\n\n            function CurvesInput(p) {\n                let div = document.createElement(\"div\");\n                div.oncontextmenu = function () {\n                    return false;\n                };\n                div.style.position = \"relative\";\n                div.style.marginBottom = \"10px\";\n                let mode = \"All\";\n                let curves = p.curves;\n                modeButtons = new Options( {\n                    optionArr: [\n                        {\n                            id: 'All',\n                            label: LANG('filter-curves-all')\n                        },\n                        {\n                            id: 'Red',\n                            label: LANG('red')\n                        },\n                        {\n                            id: 'Green',\n                            label: LANG('green')\n                        },\n                        {\n                            id: 'Blue',\n                            label: LANG('blue')\n                        },\n                    ],\n                    initialId: 'All',\n                    onChange: function(id) {\n                        mode = id;\n                        if (mode === \"All\") {\n                            curves = {\n                                r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                                g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                                b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n                            };\n                        }\n                        let curve = curves.r;\n                        if (mode === \"Green\") {\n                            curve = curves.g;\n                        }\n                        if (mode === \"Blue\") {\n                            curve = curves.b;\n                        }\n                        (p0 as any).setPos(0, areah - curve[0][1] * areah);\n                        (p1 as any).setPos(curve[1][0] * areaw, areah - curve[1][1] * areah);\n                        (p2 as any).setPos(curve[2][0] * areaw, areah - curve[2][1] * areah);\n                        (p3 as any).setPos(areaw, areah - curve[3][1] * areah);\n\n                        update();\n                    }\n                });\n                div.appendChild(modeButtons.getElement());\n\n                let curveArea = document.createElement(\"div\");\n                BB.css(curveArea, {\n                    position: 'relative',\n                    marginTop: '10px',\n                    colorScheme: 'only light',\n                })\n                div.appendChild(curveArea);\n\n                let areaw = 300, areah = 100;\n                let canvas = BB.canvas(areaw, areah);\n                BB.css(canvas, {\n                    background: \"#c6c6c6\",\n                    boxShadow: \"0 0 0 1px rgba(0,0,0,0.3)\"\n                });\n                let ctx = canvas.getContext(\"2d\");\n                curveArea.appendChild(canvas);\n\n                let points = {\n                    r: [],\n                    g: [],\n                    b: []\n                };\n\n                function fit(v) {\n                    return Math.max(0, Math.min(1, v));\n                }\n\n                function createPoint(x, y, callback, lock?) {\n                    let gripSize = 14;\n                    let internalY = y, internalX = x;\n                    let point = document.createElement(\"div\");\n                    BB.css(point, {\n                        position: \"absolute\",\n                        left: (x - gripSize / 2) + \"px\",\n                        top: (y - gripSize / 2) + \"px\",\n                        width: gripSize + \"px\",\n                        height: gripSize + \"px\",\n                        background: \"#fff\",\n                        cursor: \"move\",\n                        borderRadius: gripSize + \"px\",\n                        boxShadow: \"inset 0 0 0 2px #000\",\n                        userSelect: 'none',\n                        touchAction: 'none',\n                    });\n\n                    function update() {\n                        BB.css(point, {\n                            left: (x - gripSize / 2) + \"px\",\n                            top: (y - gripSize / 2) + \"px\"\n                        });\n                    }\n\n                    (point as any).pointerListener = new BB.PointerListener({\n                        target: point,\n                        maxPointers: 1,\n                        onPointer: function(event) {\n                            event.eventPreventDefault();\n                            if (event.type === 'pointerdown') {\n                                internalX = x;\n                                internalY = y;\n                            }\n                            if (event.button === 'left' && event.type === 'pointermove') {\n                                if (!lock) {\n                                    internalX += event.dX;\n                                }\n                                x = Math.max(0, Math.min(areaw, internalX));\n                                internalY += event.dY;\n                                y = Math.max(0, Math.min(areah, internalY));\n                                update();\n                                callback({\n                                    x: x,\n                                    y: y\n                                });\n                            }\n                        }\n                    });\n\n                    curveArea.appendChild(point);\n\n                    (point as any).setPos = function (newX, newY) {\n                        x = newX;\n                        y = newY;\n                        internalY = y;\n                        internalX = x;\n                        BB.css(point, {\n                            left: (x - gripSize / 2) + \"px\",\n                            top: (y - gripSize / 2) + \"px\"\n                        });\n                    };\n\n                    return point;\n                }\n\n                function updateControl(i, x, y) {\n                    if (mode === \"All\") {\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Red\") {\n                        curves.r[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Green\") {\n                        curves.g[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                    if (mode === \"Blue\") {\n                        curves.b[i] = [fit(x / areaw), fit(1 - y / areah)];\n                    }\n                }\n\n                let p0 = createPoint(0, areah, function (val) {\n                    updateControl(0, val.x, val.y);\n                    update();\n                }, true);\n                let p1 = createPoint(areaw / 3, areah / 3 * 2, function (val) {\n                    updateControl(1, val.x, val.y);\n                    update();\n                });\n                let p2 = createPoint(areaw / 3 * 2, areah / 3, function (val) {\n                    updateControl(2, val.x, val.y);\n                    update();\n                });\n                let p3 = createPoint(areaw, 0, function (val) {\n                    updateControl(3, val.x, val.y);\n                    update();\n                }, true);\n\n\n                function update() {\n                    canvas.width = canvas.width;\n                    ctx = canvas.getContext(\"2d\");\n\n                    let outCurves = {\n                        r: [],\n                        g: [],\n                        b: []\n                    };\n                    for (let i = 0; i < curves.r.length; i++) {\n                        outCurves.r.push(curves.r[i]);\n                        outCurves.g.push(curves.g[i]);\n                        outCurves.b.push(curves.b[i]);\n                    }\n\n                    function drawCurve(curve) {\n                        ctx.beginPath();\n                        let spline = new BB.SplineInterpolator(curve);\n                        for (let i = 0; i < 100; i++) {\n                            let y = spline.interpolate(i / 100);\n                            y = Math.max(0, Math.min(1, y));\n\n                            if (i === 0) {\n                                ctx.moveTo(i / 100 * areaw, areah - y * areah);\n                            } else {\n                                ctx.lineTo(i / 100 * areaw, areah - y * areah);\n                            }\n                        }\n                        ctx.stroke();\n                    }\n\n                    ctx.save();\n                    if (mode === \"All\") {\n                        ctx.strokeStyle = \"black\";\n                        drawCurve(outCurves.r);\n                    } else {\n                        ctx.globalAlpha = 0.5;\n                        ctx.strokeStyle = \"red\";\n                        drawCurve(outCurves.r);\n                        ctx.strokeStyle = \"green\";\n                        drawCurve(outCurves.g);\n                        ctx.strokeStyle = \"blue\";\n                        drawCurve(outCurves.b);\n                    }\n                    ctx.restore();\n                    p.callback(outCurves);\n                }\n\n                update();\n\n\n                this.getDiv = function () {\n                    return div;\n                };\n                this.destroy = function() {\n                    (p0 as any).pointerListener.destroy();\n                    (p1 as any).pointerListener.destroy();\n                    (p2 as any).pointerListener.destroy();\n                    (p3 as any).pointerListener.destroy();\n                };\n            }\n\n            let input = new CurvesInput({\n                curves: curves,\n                callback: function (val) {\n                    curves = val;\n                    update();\n                }\n            });\n\n\n            div.appendChild(input.getDiv());\n\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            result.destroy = () => {\n                input.destroy();\n                texture.destroy();\n                modeButtons.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    curves: curves\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let curves = params.input.curves;\n        let history = params.history;\n        if (!context || curves === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glCurves\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n\n        return true;\n    }\n\n\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\n// @ts-ignore\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer, IMixMode} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const flip = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let isHorizontal = true;\n        let isVertical = false;\n        let doFlipCanvas = true;\n        div.innerHTML = LANG('filter-flip-description') + \"<br/><br/>\";\n\n\n        let horizontalCheckbox = new Checkbox({\n            init: isHorizontal,\n            label: LANG('filter-flip-horizontal') + ' ',\n            allowTab: true,\n            callback: function(v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px'\n            }\n        });\n        let verticalCheckbox = new Checkbox({\n            init: isVertical,\n            label: LANG('filter-flip-vertical') + ' ',\n            allowTab: true,\n            callback: function(v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px'\n            }\n        });\n        div.appendChild(horizontalCheckbox.getElement());\n        div.appendChild(verticalCheckbox.getElement());\n\n\n\n\n\n        let fcOption = document.createElement(\"div\");\n        BB.setEventListener(fcOption, 'onpointerdown', function () {\n            return false;\n        });\n        fcOption.textContent = LANG('filter-flip-image');\n        fcOption.style.width = \"150px\";\n        fcOption.style.height = \"30px\";\n        fcOption.style.paddingTop = \"10px\";\n        fcOption.style.textAlign = \"center\";\n        fcOption.style.cssFloat = \"left\";\n        fcOption.style.paddingBottom = \"0px\";\n        fcOption.style.borderTopLeftRadius = \"10px\";\n        fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n        fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n        fcOption.style.backgroundSize = '8%';\n        fcOption.style.backgroundColor = \"#9e9e9e\";\n\n        let flOption = document.createElement(\"div\");\n        BB.setEventListener(flOption, 'onpointerdown', function () {\n            return false;\n        });\n        flOption.textContent = LANG('filter-flip-layer');\n        flOption.style.width = \"150px\";\n        flOption.style.height = \"30px\";\n        flOption.style.paddingTop = \"10px\";\n        flOption.style.textAlign = \"center\";\n        flOption.style.cssFloat = \"left\";\n        flOption.style.paddingBottom = \"0px\";\n        flOption.style.borderTopRightRadius = \"10px\";\n        flOption.style.cursor = \"pointer\";\n        flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        flOption.style.backgroundSize = '8%';\n\n        BB.setEventListener(fcOption, 'onpointerover', function () {\n            if (doFlipCanvas === false)\n                fcOption.style.backgroundColor = \"#ccc\";\n        });\n        BB.setEventListener(fcOption, 'onpointerout', function () {\n            if (doFlipCanvas === false)\n                fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        });\n        BB.setEventListener(flOption, 'onpointerover', function () {\n            if (doFlipCanvas === true)\n                flOption.style.backgroundColor = \"#ccc\";\n        });\n        BB.setEventListener(flOption, 'onpointerout', function () {\n            if (doFlipCanvas === true)\n                flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n        });\n\n        fcOption.onclick = function () {\n            doFlipCanvas = true;\n\n            flOption.style.background = \"\";\n            flOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n            flOption.style.boxShadow = \"\";\n            flOption.style.cursor = \"pointer\";\n\n            fcOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n            fcOption.style.backgroundSize = '8%';\n            fcOption.style.backgroundColor = \"#9e9e9e\";\n            fcOption.style.cursor = \"default\";\n            fcOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n\n            updatePreview();\n        };\n        flOption.onclick = function () {\n            doFlipCanvas = false;\n\n            fcOption.style.background = \"\";\n            fcOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\n            fcOption.style.boxShadow = \"\";\n            fcOption.style.cursor = \"pointer\";\n\n            flOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\n            flOption.style.backgroundSize = '8%';\n            flOption.style.backgroundColor = \"#9e9e9e\";\n            flOption.style.cursor = \"default\";\n            flOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\n\n            updatePreview();\n        };\n\n        let optionWrapper = document.createElement(\"div\");\n        optionWrapper.appendChild(fcOption);\n        optionWrapper.appendChild(flOption);\n        div.appendChild(optionWrapper);\n\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            colorScheme: 'only light',\n        });\n\n        let previewLayer: IKlBasicLayer = {\n            image: BB.canvas(Math.round(w), Math.round(h)),\n            opacity: 1,\n            mixModeStr: 'source-over' as IMixMode,\n        };\n        let klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [previewLayer]\n        });\n\n        let previewInnerWrapper = BB.el({\n            css: {\n                position: 'relative',\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px'\n            }\n        });\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n        previewWrapper.appendChild(previewInnerWrapper);\n\n        function updatePreview() {\n            let ctx = (previewLayer.image as HTMLCanvasElement).getContext('2d');\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n\n            for (let i = 0; i < layers.length; i++) {\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        }\n        setTimeout(updatePreview, 0);\n\n\n        div.appendChild(previewWrapper);\n        result.destroy = () => {\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let canvas = params.canvas;\n        let history = params.history;\n        let horizontal = params.input.horizontal;\n        let vertical = params.input.vertical;\n        let flipCanvas = params.input.flipCanvas;\n        if (!context || !canvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        canvas.flip(horizontal, vertical, flipCanvas ? null : canvas.getLayerIndex(context.canvas));\n        history.pause(false);\n\n        history.push({\n            tool: [\"filter\", \"flip\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    },\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7UudW\");","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glHueSaturation = {\n\n    getDialog(params: IFilterGetDialogParam) {\n\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let hue = 0, Saturation = 0;\n            div.innerHTML = LANG('filter-hue-sat-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let hueSlider = new KlSlider({\n                label: LANG('filter-hue-sat-hue'),\n                width: 300,\n                height: 30,\n                min: -100,\n                max: 100,\n                initValue: hue * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    hue = val / 100;\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n                    klCanvasPreview.render();\n                }\n            });\n            let saturationSlider = new KlSlider({\n                label: LANG('filter-hue-sat-saturation'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                initValue: (Saturation + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    Saturation = val / 50 - 1;\n                    glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n                    klCanvasPreview.render();\n                }\n            });\n            hueSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(hueSlider.getElement());\n            div.appendChild(saturationSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                hueSlider.destroy();\n                saturationSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    hue: hue,\n                    Saturation: Saturation\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let hue = params.input.hue;\n        let history = params.history;\n        let Saturation = params.input.Saturation;\n        if (!context || hue === null || Saturation === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).hueSaturation(hue, Saturation).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glHueSaturation\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply} from '../kl.types';\n\nexport const invert = {\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false;\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).invert().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"invert\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import { BB } from '../../bb/bb';\r\nimport { KlCanvasPreview } from '../canvas-ui/canvas-preview';\r\n// @ts-ignore\r\nimport checkmarkImg from 'url:~/src/app/img/ui/checkmark.svg';\r\nimport { getSharedFx } from './shared-gl-fx';\r\nimport { IFilterApply, IFilterGetDialogParam, IKlBasicLayer } from '../kl.types';\r\nimport { LANG } from '../../language/language';\r\n\r\nexport const glPerspective = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = params.bbox.width < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n\r\n        let tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = tempCanvas.getContext(\"2d\");\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        let pointerListenerArr = [];\r\n\r\n        function finishInit() {\r\n            div.innerHTML = LANG('filter-perspective-description') + \"<br/><br/>\";\r\n\r\n            let glCanvas = getSharedFx();\r\n            if (!glCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            let texture = glCanvas.texture(tempCanvas);\r\n            glCanvas.draw(texture).update(); // update glCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update() {\r\n                try {\r\n                    glCanvas.draw(texture).perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch (e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob(x, y, callback?) {\r\n                let nobSize = 14;\r\n                let div = document.createElement(\"div\");\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + \"px\",\r\n                    height: nobSize + \"px\",\r\n                    backgroundColor: \"#fff\",\r\n                    boxShadow: \"inset 0 0 0 2px #000\",\r\n                    borderRadius: nobSize + \"px\",\r\n                    position: \"absolute\",\r\n                    cursor: \"move\",\r\n                    left: ((div as any).x - nobSize / 2) + \"px\",\r\n                    top: ((div as any).y - nobSize / 2) + \"px\",\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                let pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    maxPointers: 1,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    }\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + \"px\";\r\n                    div.style.top = ((div as any).y - nobSize / 2) + \"px\";\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter() {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n            let beforeOption = document.createElement(\"div\");\r\n            BB.setEventListener(beforeOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            beforeOption.textContent = LANG('filter-perspective-before');\r\n            beforeOption.style.width = \"150px\";\r\n            beforeOption.style.height = \"30px\";\r\n            beforeOption.style.marginLeft = isSmall ? '0' : \"100px\";\r\n            beforeOption.style.paddingTop = \"10px\";\r\n            beforeOption.style.textAlign = \"center\";\r\n            beforeOption.style.cssFloat = \"left\";\r\n            beforeOption.style.paddingBottom = \"0px\";\r\n            beforeOption.style.borderTopLeftRadius = \"10px\";\r\n            beforeOption.style.cursor = \"pointer\";\r\n            beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            beforeOption.style.backgroundSize = '8%';\r\n\r\n            let afterOption = document.createElement(\"div\");\r\n            BB.setEventListener(afterOption, 'onpointerdown', function () {\r\n                return false;\r\n            });\r\n            afterOption.textContent = LANG('filter-perspective-after');\r\n            afterOption.style.width = \"150px\";\r\n            afterOption.style.height = \"30px\";\r\n            afterOption.style.paddingTop = \"10px\";\r\n            afterOption.style.textAlign = \"center\";\r\n            afterOption.style.cssFloat = \"left\";\r\n            afterOption.style.paddingBottom = \"0px\";\r\n            afterOption.style.borderTopRightRadius = \"10px\";\r\n            afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n            afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n            afterOption.style.backgroundSize = '8%';\r\n            afterOption.style.backgroundColor = \"#9e9e9e\";\r\n\r\n\r\n            BB.setEventListener(beforeOption, 'onpointerover', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(beforeOption, 'onpointerout', function () {\r\n                if (before === false)\r\n                    beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerover', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"#ccc\";\r\n            });\r\n            BB.setEventListener(afterOption, 'onpointerout', function () {\r\n                if (before === true)\r\n                    afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n            });\r\n\r\n            beforeOption.onclick = function () {\r\n\r\n                beforeOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                beforeOption.style.backgroundSize = '8%';\r\n                beforeOption.style.backgroundColor = \"#9e9e9e\";\r\n                beforeOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                beforeOption.style.cursor = \"default\";\r\n\r\n                afterOption.style.background = \"\";\r\n                afterOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                afterOption.style.boxShadow = \"\";\r\n                afterOption.style.cursor = \"pointer\";\r\n\r\n                aa.style.display = \"none\";\r\n                ab.style.display = \"none\";\r\n                ac.style.display = \"none\";\r\n                ad.style.display = \"none\";\r\n\r\n                ba.style.display = \"block\";\r\n                bb.style.display = \"block\";\r\n                bc.style.display = \"block\";\r\n                bd.style.display = \"block\";\r\n                ba.copy(aa);\r\n                bb.copy(ab);\r\n                bc.copy(ac);\r\n                bd.copy(ad);\r\n                before = true;\r\n                update();\r\n            };\r\n            afterOption.onclick = function () {\r\n                before = false;\r\n\r\n                afterOption.style.background = \"url(\" + checkmarkImg + \") no-repeat 12px 16px\";\r\n                afterOption.style.backgroundSize = '8%';\r\n                afterOption.style.backgroundColor = \"#9e9e9e\";\r\n                afterOption.style.boxShadow = \"inset 0px 5px 10px rgba(0,0,0,0.5)\";\r\n                afterOption.style.cursor = \"default\";\r\n\r\n                beforeOption.style.background = \"\";\r\n                beforeOption.style.backgroundColor = \"rgba(0, 0, 0, 0.1)\";\r\n                beforeOption.style.boxShadow = \"\";\r\n                beforeOption.style.cursor = \"pointer\";\r\n\r\n                ba.style.display = \"none\";\r\n                bb.style.display = \"none\";\r\n                bc.style.display = \"none\";\r\n                bd.style.display = \"none\";\r\n\r\n                aa.style.display = \"block\";\r\n                ab.style.display = \"block\";\r\n                ac.style.display = \"block\";\r\n                ad.style.display = \"block\";\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            };\r\n\r\n            let optionWrapper = document.createElement(\"div\");\r\n            optionWrapper.appendChild(beforeOption);\r\n            optionWrapper.appendChild(afterOption);\r\n            div.appendChild(optionWrapper);\r\n\r\n\r\n            let previewWrapper = document.createElement(\"div\");\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n            BB.css(previewWrapper, {\r\n                width: isSmall ? '340px' : '540px',\r\n                marginLeft: \"-20px\",\r\n                height: isSmall ? '260px' : '300px',\r\n                backgroundColor: \"#9e9e9e\",\r\n                marginTop: \"10px\",\r\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n                overflow: \"hidden\",\r\n                position: \"relative\",\r\n                userSelect: 'none',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                colorScheme: 'only light',\r\n            });\r\n\r\n            let previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    let canvas = i === selectedLayerIndex ? glCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr\r\n                    });\r\n                }\r\n            }\r\n            let klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr\r\n            });\r\n\r\n            let previewInnerWrapper = BB.el({\r\n                css: {\r\n                    position: 'relative',\r\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px'\r\n                }\r\n            });\r\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n            previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.appendChild(aa);\r\n            previewInnerWrapper.appendChild(ab);\r\n            previewInnerWrapper.appendChild(ac);\r\n            previewInnerWrapper.appendChild(ad);\r\n\r\n            ba.style.display = \"none\";\r\n            bb.style.display = \"none\";\r\n            bc.style.display = \"none\";\r\n            bd.style.display = \"none\";\r\n            previewInnerWrapper.appendChild(ba);\r\n            previewInnerWrapper.appendChild(bb);\r\n            previewInnerWrapper.appendChild(bc);\r\n            previewInnerWrapper.appendChild(bd);\r\n\r\n\r\n            div.appendChild(previewWrapper);\r\n            update();\r\n            result.destroy = () => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n            };\r\n            result.getInput = function () {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ]\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        let context = params.context;\r\n        let history = params.history;\r\n        let before = params.input.before;\r\n        let after = params.input.after;\r\n        if (!context || !before || !after || !history)\r\n            return false;\r\n        history.pause(true);\r\n        let glCanvas = getSharedFx();\r\n        if (!glCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        let texture = glCanvas.texture(context.canvas);\r\n        let w = context.canvas.width;\r\n        let h = context.canvas.height;\r\n        glCanvas.draw(texture).perspective(before, after).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(glCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"glPerspective\"],\r\n            action: \"apply\",\r\n            params: [{\r\n                input: params.input\r\n            }]\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/base-components/checkbox';\nimport {Select} from '../ui/base-components/select';\n// @ts-ignore\nimport constrainImg from 'url:~/src/app/img/ui/constrain.svg';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const resize = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        //BB.centerWithin\n        let canvas = params.canvas;\n        if (!canvas)\n            return false;\n\n        let fit = BB.fitInto( canvas.getWidth(), canvas.getHeight(), 280, 200,1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / canvas.getWidth();\n        let tempCanvas = canvas.getCompleteCanvas(1);\n\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let newWidth = canvas.getWidth(), newHeight = canvas.getHeight();\n\n        div.innerHTML = LANG('filter-resize-description') + \"<br/><br/>\";\n\n\n        let maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n\n        let widthWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            }\n        });\n        let heightWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            }\n        });\n        let widthInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxWidth,\n                value: '' + canvas.getWidth(),\n            }\n        }) as HTMLInputElement;\n        let heightInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxHeight,\n                value: '' + canvas.getHeight(),\n            }\n        }) as HTMLInputElement;\n        widthInput.onclick = function () {\n            (this as any).focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function () {\n            (this as any).focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function () {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function () {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append(LANG('width') + \": \", widthInput);\n        heightWrapper.append(LANG('height') + \": \", heightInput);\n        let inputWrapper = BB.el({\n            css: {\n                background: \"url(\" + constrainImg + \") no-repeat 140px 5px\",\n                backgroundSize: '50px 52px',\n            }\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        div.appendChild(inputWrapper);\n\n        //contrain checkbox\n        let heightChanged = false, widthChanged = false;\n        let ratio = canvas.getWidth() / canvas.getHeight();\n\n        function updateConstrain() {\n            if (isConstrained) {\n                widthInput.value = '' + canvas.getWidth();\n                heightInput.value = '' + canvas.getHeight();\n                inputWrapper.style.background = \"url(\" + constrainImg + \") no-repeat 140px 5px\";\n                inputWrapper.style.backgroundSize = '50px 52px';\n                update();\n            } else {\n                inputWrapper.style.background = \"\";\n            }\n        }\n\n        let isConstrained = true;\n        let constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function(b) {\n                isConstrained = b;\n                updateConstrain();\n            }\n        });\n        div.appendChild(BB.el({\n            css: {\n                clear: 'both'\n            }\n        }));\n\n\n        let algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')]\n            ],\n            title: LANG('scaling-algorithm'),\n            initValue: 'smooth',\n            onChange: function() {\n                update();\n            },\n        });\n\n        let secondRowElement = BB.el({\n            parent: div,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between'\n            }\n        });\n        secondRowElement.appendChild(constrainCheckbox.getElement());\n        secondRowElement.appendChild(algorithmSelect.getElement());\n\n        let previewCanvas = BB.canvas(w, h);\n        previewCanvas.style.imageRendering = 'pixelated';\n\n\n        let previewCtx = previewCanvas.getContext('2d');\n\n\n        function draw() {\n            if (algorithmSelect.getValue() === 'smooth') {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\n\n                previewCanvas.width = canvas.getWidth();\n                previewCanvas.height = canvas.getHeight();\n\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = 'high';\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n\n            } else {\n                previewCanvas.style.imageRendering = 'pixelated';\n\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n\n        }\n\n        function update() {\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) {\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\n                }\n                if (widthChanged) {\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\n                }\n\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\n                    let fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\n                    widthInput.value = '' + parseInt('' + fit.width);\n                    heightInput.value = '' + parseInt('' + fit.height);\n                }\n            }\n\n            if (parseInt(widthInput.value) > maxWidth) {\n                widthInput.value = '' + maxWidth;\n            }\n            if (parseInt(heightInput.value) > maxHeight) {\n                heightInput.value = '' + maxHeight;\n            }\n\n            heightChanged = false;\n            widthChanged = false;\n\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n\n            let preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\n            let previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\n            previewFactor = previewW / newWidth;\n\n            let offset = BB.centerWithin(340, 220, previewW, previewH);\n\n            draw();\n\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\n            canvasWrapper.style.left = offset.x + \"px\";\n            canvasWrapper.style.top = offset.y + \"px\";\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\n        }\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            display: \"table\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            position: \"relative\",\n            userSelect: 'none',\n            colorScheme: 'only light',\n        });\n\n\n        let canvasWrapper = BB.appendTextDiv(previewWrapper, \"\");\n        canvasWrapper.appendChild(previewCanvas);\n        canvasWrapper.style.width = w + \"px\";\n        canvasWrapper.style.height = h + \"px\";\n        canvasWrapper.style.position = \"absolute\";\n        canvasWrapper.style.overflow = \"hidden\";\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\n        canvasWrapper.style.overflow = \"hidden\";\n        BB.createCheckerDataUrl(8, function (url) {\n            previewWrapper.style.background = \"url(\" + url + \")\";\n        });\n\n        div.appendChild(previewWrapper);\n        update();\n\n        result.destroy = () => {\n            constrainCheckbox.destroy();\n        };\n        result.getInput = function () {\n            result.destroy();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue()\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let canvas = params.canvas;\n        let history = params.history;\n        let width = params.input.width;\n        let height = params.input.height;\n        let algorithm = params.input.algorithm;\n        if (!canvas || !history) {\n            return false;\n        }\n        history.pause(true);\n        canvas.resize(width, height, algorithm);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"resize\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"7Suhe\");","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const rotate = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let canvas = params.canvas;\n        if (!canvas)\n            return false;\n\n        let fit = BB.fitInto(canvas.getWidth(), canvas.getHeight(), 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / canvas.getWidth();\n        let tempCanvas = BB.canvas(w, h);\n        tempCanvas.style.display = 'block';\n        tempCanvas.getContext(\"2d\").drawImage(canvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n        let deg = 0;\n        div.innerHTML = LANG('filter-rotate-description') + \"<br/><br/>\";\n\n        let first = true;\n\n        function update() {\n            (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg)\";\n            (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg)\";\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                let fit = BB.fitInto(h, w, 280, 200, 1);\n                let scale = parseInt('' + fit.height) / w;\n                (canvasWrapper.style as any).WebkitTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).MozTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).OTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n                (canvasWrapper.style as any).msTransform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n            }\n        }\n\n        let btnPlus = document.createElement(\"button\");\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\n        let btnMinus = document.createElement(\"button\");\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\n        btnMinus.style.marginRight = '5px';\n\n\n        btnPlus.onclick = function () {\n            deg += 90;\n            update();\n        };\n        btnMinus.onclick = function () {\n            deg -= 90;\n            update();\n        };\n\n        div.appendChild(btnMinus);\n        div.appendChild(btnPlus);\n\n        let previewWrapper = document.createElement(\"div\");\n        BB.css(previewWrapper, {\n            width: \"340px\",\n            marginLeft: \"-20px\",\n            height: \"220px\",\n            display: \"table\",\n            backgroundColor: \"#9e9e9e\",\n            marginTop: \"10px\",\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n            overflow: \"hidden\",\n            position: \"relative\",\n            userSelect: 'none',\n            colorScheme: 'only light',\n        });\n\n        let previewcell = document.createElement(\"div\");\n        previewcell.style.display = \"table-cell\";\n        previewcell.style.verticalAlign = \"middle\";\n        let canvasWrapper = BB.appendTextDiv(previewcell, \"\");\n        canvasWrapper.appendChild(tempCanvas);\n        previewWrapper.appendChild(previewcell);\n        canvasWrapper.style.width = w + \"px\";\n        canvasWrapper.style.height = h + \"px\";\n        canvasWrapper.style.marginLeft = \"auto\";\n        canvasWrapper.style.marginRight = \"auto\";\n        canvasWrapper.style.boxShadow = \"0 0 5px rgba(0,0,0,0.8)\";\n        canvasWrapper.style.overflow = \"hidden\";\n        BB.createCheckerDataUrl(4, function (url) {\n            canvasWrapper.style.background = \"url(\" + url + \")\";\n        });\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\n\n        div.appendChild(previewWrapper);\n        update();\n\n        result.getInput = function () {\n            return {\n                deg: deg\n            };\n        };\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let canvas = params.canvas;\n        let history = params.history;\n        let deg = params.input.deg;\n        if (!canvas || !history)\n            return false;\n        history.pause(true);\n        canvas.rotate(deg);\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"rotate\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glTiltShift = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n        let displayPreviewFactor = displayW / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        let pointerListenerArr = [];\n\n        function finishInit() {\n            let blur = 20, gradient = 200;\n            div.innerHTML = LANG('filter-tilt-shift-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n            let fa, fb; // focus line\n            function update() {\n                try {\n                    glCanvas.draw(texture).tiltShift(\n                        fa.x / displayPreviewFactor * previewFactor,\n                        fa.y / displayPreviewFactor * previewFactor,\n                        fb.x / displayPreviewFactor * previewFactor,\n                        fb.y / displayPreviewFactor * previewFactor,\n                        blur * previewFactor,\n                        gradient * previewFactor\n                    ).update();\n                    klCanvasPreview.render();\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }\n\n            function nob(x, y) {\n                let nobSize = 14;\n                let div = BB.el({\n                    css: {\n                        width: nobSize + \"px\",\n                        height: nobSize + \"px\",\n                        backgroundColor: '#fff',\n                        boxShadow: \"inset 0 0 0 2px #000\",\n                        borderRadius: nobSize + \"px\",\n                        position: \"absolute\",\n                        cursor: 'move',\n                        left: (x - nobSize / 2) + \"px\",\n                        top: (y - nobSize / 2) + \"px\",\n                        userSelect: 'none',\n                        touchAction: 'none',\n                    }\n                });\n                (div as any).x = x;\n                (div as any).y = y;\n                let pointerListener = new BB.PointerListener({\n                    target: div,\n                    maxPointers: 1,\n                    onPointer: function(event) {\n                        event.eventPreventDefault();\n                        if (event.button === 'left' && event.type === 'pointermove') {\n                            (div as any).x += event.dX;\n                            (div as any).y += event.dY;\n                            div.style.left = ((div as any).x - nobSize / 2) + \"px\";\n                            div.style.top = ((div as any).y - nobSize / 2) + \"px\";\n                            update();\n                        }\n                    }\n                });\n                pointerListenerArr.push(pointerListener);\n                return div;\n            }\n\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\n\n            let blurSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-blur'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                initValue: blur,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    blur = val;\n                    update();\n                }\n            });\n            blurSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(blurSlider.getElement());\n            let gradientSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-gradient'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 1000,\n                initValue: gradient,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    gradient = val;\n                    update();\n                }\n            });\n            div.appendChild(gradientSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            previewWrapper.oncontextmenu = function () {\n                return false;\n            };\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            previewInnerWrapper.appendChild(fa);\n            previewInnerWrapper.appendChild(fb);\n\n\n            div.appendChild(previewWrapper);\n            update();\n            result.destroy = () => {\n                for (let i = 0; i < pointerListenerArr.length; i++) {\n                    pointerListenerArr[i].destroy();\n                }\n                blurSlider.destroy();\n                gradientSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\n                    blur: blur,\n                    gradient: gradient\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let a = params.input.a;\n        let b = params.input.b;\n        let blur = params.input.blur;\n        let gradient = params.input.gradient;\n        if (!context || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glTiltShift\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/base-components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform, ITransform} from '../ui/components/free-transform';\r\nimport {Select} from '../ui/base-components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\r\nimport {LANG} from '../../language/language';\r\n\r\ninterface IFilterTransformInput {\r\n    bounds: {x: number, y: number, width: number, height: number};\r\n    transform: ITransform;\r\n    isPixelated: boolean;\r\n}\r\n\r\nexport const transform = {\r\n\r\n    getDialog(params: IFilterGetDialogParam) {\r\n        let i;\r\n        let context = params.context;\r\n        let canvas = params.canvas;\r\n        if (!context || !canvas) {\r\n            return false;\r\n        }\r\n\r\n        let isSmall = params.bbox.width < 550;\r\n        let layers = canvas.getLayers();\r\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\r\n\r\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        let w = Math.min(displayW, context.canvas.width);\r\n        let h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        let displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        let boundsObj: {\r\n            x: number;\r\n            y: number;\r\n            width: number;\r\n            height: number;\r\n        } = { x: 0, y: 0, width: 0, height: 0 };\r\n        {\r\n            let tempBounds: any = {\r\n                x1: null,\r\n                y1: null,\r\n                x2: null,\r\n                y2: null\r\n            };\r\n            let imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n            if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n                tempBounds.x1 = 0;\r\n                tempBounds.y1 = 0;\r\n                tempBounds.x2 = context.canvas.width - 1;\r\n                tempBounds.y2 = context.canvas.height - 1;\r\n            } else {\r\n                for (i = 3; i < imdat.data.length; i += 4) {\r\n                    if (imdat.data[i] > 0 ) {\r\n                        let x = ((i - 3) / 4) %  context.canvas.width;\r\n                        let y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                        if (tempBounds.x1 > x || tempBounds.x1 === null) {\r\n                            tempBounds.x1 = x;\r\n                        }\r\n                        if (tempBounds.y1 === null) {\r\n                            tempBounds.y1 = y;\r\n                        }\r\n                        if (tempBounds.x2 < x || tempBounds.x2 === null) {\r\n                            tempBounds.x2 = x;\r\n                        }\r\n                        if (tempBounds.y2 < y || tempBounds.y2 === null) {\r\n                            tempBounds.y2 = y;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (tempBounds.x1 === null || tempBounds.y1 === null) {\r\n                alert(LANG('filter-transform-empty'));\r\n                return false;\r\n            }\r\n            boundsObj.x = tempBounds.x1;\r\n            boundsObj.y = tempBounds.y1;\r\n            boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\r\n            boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\r\n        }\r\n\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n\r\n        let div = document.createElement(\"div\");\r\n        let result: any = {\r\n            element: div\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        let keyListener = new BB.KeyListener({\r\n            onDown: function(keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        let leftWrapper = document.createElement(\"div\");\r\n        let rightWrapper = document.createElement(\"div\");\r\n        let rotWrapper = document.createElement(\"div\");\r\n        let inputY = document.createElement(\"input\");\r\n        let inputX = document.createElement(\"input\");\r\n        let inputR = document.createElement(\"input\");\r\n        leftWrapper.style.width = \"100px\";\r\n        leftWrapper.style.height = \"30px\";\r\n        rightWrapper.style.width = \"100px\";\r\n        rightWrapper.style.height = \"30px\";\r\n        rightWrapper.style.display = \"inline-block\";\r\n        leftWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.display = \"inline-block\";\r\n        rotWrapper.style.width = \"150px\";\r\n        rotWrapper.style.height = \"30px\";\r\n        inputY.type = \"number\";\r\n        inputX.type = \"number\";\r\n        inputR.type = \"number\";\r\n        inputX.style.width = 70 + \"px\";\r\n        inputY.style.width = 70 + \"px\";\r\n        inputR.style.width = 70 + \"px\";\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append(\"X: \", inputX);\r\n        rightWrapper.append(\"Y: \", inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                }\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            }\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        let constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block'\r\n            }\r\n        });\r\n        let isSnapping = false;\r\n        let snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function(b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            }\r\n        });\r\n        const checkboxWrapper = BB.el({});\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.appendChild(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px'\r\n            }\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n            }\r\n        });\r\n\r\n        let algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')]\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function() {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        let previewWrapper = document.createElement(\"div\");\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        BB.css(previewWrapper, {\r\n            width: isSmall ? '340px' : '540px',\r\n            marginLeft: \"-20px\",\r\n            height: isSmall ? '260px' : '300px',\r\n            backgroundColor: \"#9e9e9e\",\r\n            marginTop: \"10px\",\r\n            boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\r\n            overflow: \"hidden\",\r\n            position: \"relative\",\r\n            userSelect: 'none',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            colorScheme: 'only light',\r\n        });\r\n\r\n        let previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    let ctx = canvas.getContext('2d');\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr\r\n                });\r\n            }\r\n        }\r\n        let klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr\r\n        });\r\n\r\n        let previewInnerWrapper = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                boxShadow: '0 0 5px rgba(0,0,0,0.5)',\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px'\r\n            }\r\n        });\r\n        previewInnerWrapper.appendChild(klCanvasPreview.getElement());\r\n        previewWrapper.appendChild(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview(doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            let transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            let transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            let ctx = transformLayerCanvas.getContext('2d');\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0'\r\n        });\r\n        previewInnerWrapper.appendChild(freeTransform.getElement());\r\n\r\n        function onInputsChanged() {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.appendChild(previewWrapper);\r\n        result.destroy = () => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n        };\r\n        result.getInput = function () {\r\n            const transform = freeTransform.getTransform();\r\n            let input = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            } as IFilterTransformInput;\r\n            result.destroy();\r\n            return JSON.parse(JSON.stringify(input));\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply(params: IFilterApply) {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input: IFilterTransformInput = params.input;\r\n\r\n        let copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: [\"filter\", \"transform\"],\r\n            action: \"apply\",\r\n            params: [{input}],\r\n        });\r\n        return true;\r\n    }\r\n\r\n};","import {BB} from '../../bb/bb';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glBlur = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let canvas = params.canvas;\n        let context = params.context;\n        if (!canvas || !context) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n\n        function finishInit() {\n            let radius = 10;\n            div.innerHTML = LANG('filter-triangle-blur-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 1,\n                max: 200,\n                initValue: radius,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                    klCanvasPreview.render();\n                }\n            });\n            div.appendChild(radiusSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                texture.destroy();\n                radiusSlider.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    radius: radius\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let radius = params.input.radius;\n        if (!context || !radius || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).triangleBlur(radius).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glBlur\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/base-components/kl-slider';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const glUnsharpMask = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\n        let w = Math.min(displayW, context.canvas.width);\n        let h = Math.min(displayH, context.canvas.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (w > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        let previewFactor = w / context.canvas.width;\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let radius = 2, strength = 5.1 / 10;\n            div.innerHTML = LANG('filter-unsharp-mask-description') + \"<br/><br/>\";\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            let radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                initValue: 2,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]]\n            });\n            let strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 50,\n                initValue: 5.1,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    strength = val / 10;\n                    glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]]\n            });\n            radiusSlider.getElement().style.marginBottom = \"10px\";\n            div.appendChild(radiusSlider.getElement());\n            div.appendChild(strengthSlider.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + displayW),\n                height: parseInt('' + displayH),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + displayW) + 'px',\n                    height: parseInt('' + displayH) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            try {\n                glCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                klCanvasPreview.render();\n            } catch(e) {\n                (div as any).errorCallback(e);\n            }\n\n            result.destroy = () => {\n                radiusSlider.destroy();\n                strengthSlider.destroy();\n                texture.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    radius: radius,\n                    strength: strength\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let radius = params.input.radius;\n        let strength = params.input.strength;\n        if (!context || radius === null || strength === null || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).unsharpMask(radius, strength).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"glUnsharpMask\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {BB} from '../../bb/bb';\nimport {Options} from '../ui/base-components/options';\nimport {ColorOptions} from '../ui/base-components/color-options';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {getSharedFx} from './shared-gl-fx';\nimport {IFilterApply, IFilterGetDialogParam, IKlBasicLayer} from '../kl.types';\nimport {LANG} from '../../language/language';\n\nexport const toAlpha = {\n\n    getDialog(params: IFilterGetDialogParam) {\n        let context = params.context;\n        let canvas = params.canvas;\n        if (!context || !canvas) {\n            return false;\n        }\n\n        let layers = canvas.getLayers();\n        let selectedLayerIndex = canvas.getLayerIndex(context.canvas);\n\n        let fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        let w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let tempCanvas = BB.canvas(w, h);\n        {\n            const ctx = tempCanvas.getContext(\"2d\");\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) {\n                ctx.imageSmoothingEnabled = false;\n            }\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n\n        let div = document.createElement(\"div\");\n        let result: any = {\n            element: div\n        };\n\n        function finishInit() {\n            let radius = 2, strength = 5.1 / 10;\n            div.appendChild(BB.el({\n                content: LANG('filter-to-alpha-description'),\n                css: {\n                    marginBottom: '5px'\n                }\n            }));\n\n            let glCanvas = getSharedFx();\n            if (!glCanvas) {\n                return; // todo throw?\n            }\n            let texture = glCanvas.texture(tempCanvas);\n            glCanvas.draw(texture).update(); // update glCanvas size\n\n            function updatePreview() {\n                glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n                klCanvasPreview.render();\n            }\n\n            // source\n            let sourceId = 'inverted-luminance';\n            let sourceOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'inverted-luminance',\n                        label: LANG('filter-to-alpha-inverted-lum')\n                    },\n                    {\n                        id: 'luminance',\n                        label: LANG('filter-to-alpha-lum')\n                    }\n                ],\n                initialId: sourceId,\n                onChange: function(id) {\n                    sourceId = id;\n                    updatePreview();\n                }\n            });\n            div.appendChild(sourceOptions.getElement());\n\n            // color\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n            let colorOptionsArr = [\n                null,\n                {r: 0, g: 0, b: 0, a: 1},\n                {r: 255, g: 255, b: 255, a: 1}\n            ];\n            colorOptionsArr.push({\n                r: params.currentColorRgb.r,\n                g: params.currentColorRgb.g,\n                b: params.currentColorRgb.b,\n                a: 1,\n            });\n            colorOptionsArr.push({\n                r: params.secondaryColorRgb.r,\n                g: params.secondaryColorRgb.g,\n                b: params.secondaryColorRgb.b,\n                a: 1,\n            });\n\n            let colorOptions = new ColorOptions({\n                label: LANG('filter-to-alpha-replace'),\n                colorArr: colorOptionsArr,\n                initialIndex: 1,\n                onChange: function(rgbaObj) {\n                    selectedRgbaObj = rgbaObj;\n                    updatePreview();\n                }\n            });\n            colorOptions.getElement().style.marginTop = '10px';\n            div.appendChild(colorOptions.getElement());\n\n\n            let previewWrapper = document.createElement(\"div\");\n            BB.css(previewWrapper, {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                backgroundColor: \"#9e9e9e\",\n                marginTop: \"10px\",\n                boxShadow: \"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset\",\n                overflow: \"hidden\",\n                position: \"relative\",\n                userSelect: 'none',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                colorScheme: 'only light',\n            });\n\n            let previewLayerArr: IKlBasicLayer[] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? glCanvas : layers[i].context.canvas,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr\n                    });\n                }\n            }\n            let klCanvasPreview = new KlCanvasPreview({\n                width: parseInt('' + w),\n                height: parseInt('' + h),\n                layers: previewLayerArr\n            });\n\n            let previewInnerWrapper = BB.el({\n                css: {\n                    position: 'relative',\n                    boxShadow: '0 0 5px rgba(0,0,0,0.5)',\n                    width: parseInt('' + w) + 'px',\n                    height: parseInt('' + h) + 'px'\n                }\n            });\n            previewInnerWrapper.appendChild(klCanvasPreview.getElement());\n            previewWrapper.appendChild(previewInnerWrapper);\n\n\n            div.appendChild(previewWrapper);\n\n            setTimeout(function() { //ie has a problem otherwise...\n                try {\n                    updatePreview();\n                } catch(e) {\n                    (div as any).errorCallback(e);\n                }\n            }, 1);\n\n            result.destroy = () => {\n                texture.destroy();\n                sourceOptions.destroy();\n            };\n            result.getInput = function () {\n                result.destroy();\n                return {\n                    sourceId: sourceId,\n                    selectedRgbaObj: selectedRgbaObj\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply(params: IFilterApply) {\n        let context = params.context;\n        let history = params.history;\n        let sourceId = params.input.sourceId;\n        let selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId || !history)\n            return false;\n        history.pause(true);\n        let glCanvas = getSharedFx();\n        if (!glCanvas) {\n            return false; // todo more specific error?\n        }\n        let texture = glCanvas.texture(context.canvas);\n        glCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(glCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\"filter\", \"toAlpha\"],\n            action: \"apply\",\n            params: [{\n                input: params.input\n            }]\n        });\n        return true;\n    }\n\n};","import {KL} from '../kl';\nimport {KlCanvas} from '../canvas/kl-canvas';\n\nexport async function klCanvasToPsdBlob(klCanvas: KlCanvas): Promise<Blob> {\n    let layerArr = klCanvas.getLayersFast();\n\n    let psdConfig = {\n        width: klCanvas.getWidth(),\n        height: klCanvas.getHeight(),\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n        children: []\n    };\n    for (let i = 0; i < layerArr.length; i++) {\n        // todo - can be optimized if layer mostly empty\n        let item = layerArr[i];\n        psdConfig.children.push({\n            name: item.name,\n            opacity: item.opacity,\n            canvas: item.canvas,\n            blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n            left: 0,\n            top: 0\n        });\n    }\n\n    let agPsd = await import('ag-psd');\n    let buffer = agPsd.writePsdBuffer(psdConfig);\n    return new Blob([buffer], { type: 'application/octet-stream' });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"67TaG\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"55mKQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"jc8Ev\");","module.exports = require('./helpers/bundle-url').getBundleURL('3k3pd') + require('./helpers/bundle-manifest').resolve(\"udYZ0\");"],"names":["$d2fa9a947070c225$export$a84540bc8b694b2d","p1","klApp","agPsd","onProjectReady","project","projectStore","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","embed","changeTitle","showReminder","saveAsPsd","isDrawing","getEl","container","document","body","getBBox","$3C7jC","KlApp","undefined","logoImg","onLogo","customSave","hideFile","isShare","helpPath","bottomBar","aboutEl","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","appendChild","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","projectStore1","$hrnUX","KL","ProjectStore","this","openProject","read","then","readResult","p","setTimeout","out","catch","message","indexOf","initError","getPNG","getPSD","$4gaLD","asyncToGenerator","$parcel$interopDefault","$cijLd","mark","_callee","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","parcelRequire","_ctx","sent","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","window","getItem","setItem","removeItem","t1","e1","Array","slice","call","arguments","n","createDocumentFragment","t","Node","createTextNode","String","Document","DocumentFragment","hasOwnProperty","configurable","enumerable","writable","insertBefore","firstChild","padStart","repeat","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","ref","translateSmoothing","s","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","importFinishedLoading","importedImage","filename","optionStr","getResizedDimensions","width","height","w","parseInt","h","klMaxCanvasSize","importAsImage","canvas","resizedDimensions","tempCanvas","$eWjiX","BB","getContext","drawImage","resizeCanvas","klCanvas","reset","image","layerName","layerManager","update","setCurrentLayer","getLayer","resetView","getScale","getAngleDeg","importAsImagePsd","convertedPsdObj","cropObj1","crop","targetCanvas","cropCanvas","cropObj","cropCanvas1","layers","i","i1","item1","layerIndex","showImportAsLayerDialog","klRootEl","transformObj","isPixelated","pause","addLayer","getLayers","renameLayer","activeLayerIndex","activeLayerContext","getLayerContext","drawTransformedImageWithBounds","tool","action","params","copyCanvas","isNaN","popup","target","type","buttons","showImportImageDialog","bbox","maxSize","res","importAsLayer","files","showWarningPsdFlattened","file","name","split","extension","toLowerCase","f1","maxResolution","size","doShowLoader","loaderIsOpen","result","closeLoader","f","FileReader","readerResult","loadAgPsd","agPsdLazy","replace","convertedPsd","PSD","skipLayerImageData","skipThumbnail","alert","match","URL","webkitURL","url","createObjectURL","im","Image","src","loadImage","hasUnsupportedFile","collapseThreshold","getElement","style","display","setDirection","uiState","toolspaceCollapser","isOpen","css","left","right","setSize","Math","max","uiWidth","toolWidth","uiHeight","setWide","statusOverlay","toolspace","borderLeft","borderRight","setUiState","updateCollapse","toolspaceScroller","updateUiState","layer","currentLayerCtx","context","currentBrush","setContext","layerPreview","setLayer","newImageDialog","currentColor","klColorSlider","getSecondaryRGB","getWidth","getHeight","color","a","handUi","onCancel","shareImage","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","title","mainTabRow","activeStr","toolspaceToolRow","getActive","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","fill","shape","setIsVisible","open","showCrop","clipboardDialog","inputObj","top","bottom","input","history","filterLib","cropExtend","apply","updateBottomBar","isVisible","toolspaceInner","scrollHeight","bottomBarWrapper","clientWidth","offsetWidth","innerWidth","clientHeight","offsetHeight","innerHeight","min","screen","$6l0gQ","LocalStorage","app","createElement","bbox1","exportType","KlCanvas","projectObj","setHistory","initState","layerFill","g","b","copy","focus","getLayerCount","brushes","destroy","RGB","currentBrushId","lastNonEraserBrushId","BrushSettingService","setColor","copyObj","opacity","setOpacity","getColor","brushUiObj","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","EventChain","LineSmoothing","smoothing","LineSanitizer","lineSanitizer","setChainOut","event","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","KlCanvasWorkspace","drawEventChain","chainIn","rgbObj","isDragDone","pickingDone","setMode","canvasX","canvasY","getLayerIndex","floodFill","fillUi","getTolerance","getSample","getGrow","getContiguous","angleRad","dialogCounter","get","textToolDialog","font","colorRGBA","text","textStr","ColorConverter","toRgbaStr","typeStr","shapeTool","onDown","onMove","onUp","onViewChange","viewChangeObj","changed","includes","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","onUndo","canUndo","undoRedoCatchup","undo","canRedo","redo","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","keyListener","isPressed","fitView","preventDefault","sameKeys","prev","next","store","getProject","t0","success","stop","copyToClipboard","comboOnlyContains","translateView","setAngle","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","r","setActive","updateMainTabVisibility","brushTabRow","swapColors","KlImageDropper","onDrop","handleFileSelect","enabledTest","addEventListener","pasteEvent","clipboardData","items","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","img","onload","revokeObjectURL","URLObj","getAsString","pasteStr","trim","onerror","log","crossOrigin","hexToRGB","b1","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","ui","padding","position","StatusOverlay","el","parent","oncontextmenu","onclick","handleClick","ToolspaceCollapser","overlayToolspace","OverlayToolspace","append","backgroundColor","toolspaceTopRow","$85H3x","ToolspaceTopRow","showIframePopup","wrap","abrupt","overlay","updateUi","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","saveToComputer","save","onShare","onHelp","$5ebUJ","marginBottom","ToolspaceToolRow","onZoomIn","onZoomOut","onRedo","setIsSmall","addListener","setEnableUndo","setEnableRedo","addClassName","KlColorSlider","onPick","p_color","emitColor","setHeight","setPickCallback","doPick","brushDiv","colorDiv","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","tooltip","brushId","enable","onClose","keyArr","createTab","b2","HandUi","onFit","onAngleChange","isRelative","FillUi","colorSlider","TextUi","ShapeUi","ShapeTool","isDone","x2","y2","shapeObj","shapeUi","getShape","isOutwards","getIsOutwards","getIsEraser","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","getMode","fillRgb","setComposite","drawShape","ctx","klLayerManager","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","clctx","catchup","SaveToComputer","flename","FileTab","imgurUpload","imgurKey","SettingsTab","$kafYx","onOpen","minWidth","id","$4IKdh","$l1AcR","$8vwUW","textUi","$TSTUW","$81LGj","$bZgtG","show","hide","$9YnQS","$kzmUj","settingsTab","MutationObserver","observe","attributes","childList","subtree","ToolspaceScroller","resize","scrollY","scrollTo","_ref","swapUiLeftRight","_this","userSelect","_this1","ResizeObserver","windowResizeWatcher","e2","$iUR3L","importFilters","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","setDbName","$9BlwZ","indexedDb","$6mTnI","$lkluh","$eyygR","calcSliderFalloffFactor","$l4PqG","Checkbox","$lXqiv","$c4LUw","Select","$21VAD","ImageToggle","$jKOQl","ImageRadioList","$gmlbk","RadioList","$bHZQg","penPressureToggle","$fCJWy","KlSlider","$llzZ0","HexColorDialog","$lfHl9","$h7i9r","KlSmallColorSlider","$kzhsD","PointSlider","$bd9hB","ColorOptions","$9A7OD","Options","$iskOY","BoxToggle","$iDHln","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","FittedImage","$j1kEL","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$ekHRj","Popup","exportDialog","$auloj","$isYih","$8ebuX","$76Qvv","$keKW3","$kDGzx","$5ENro","$khi8I","$dJXmR","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$5rdL4","DecoyKlHistory","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","key","l","$b60fce38973759d6$export$28b6f4d98dde9845","$b60fce38973759d6$export$1a1044741a812c67","state","dataArr","listeners","pauseStack","maxState","actionNumber","pop","maxBefore","broadcast","bufferUpdate","concat","$9fd01211d0fde0a8$export$63b4813c5280c707","close","isClosed","clearSelection","focusEl","tagName","select","rootRootEl","decrease","destroyEl","xButton","bgEl","removeEventListener","rootEl","wheelPrevent","btnElArr","splice","increase","overflow","minHeight","flexDirection","scrollContent","ignoreBackground","zIndex","$1bOI3","titleHeight","lineHeight","background","boxShadow","content","div","marginRight","boxClasses","join","flex","boxEl","clickOnEnterBtn","stopPropagation","click","autoFocus","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","label","$h7G7V","iconImg","custom","btn","clickOnEnter","closefunc","onscroll","clearInterval","updatePos","elW","popupEl","elH","animationName","animationDuration","animationTimingFunction","isCssMinMaxSupported","borderRadius","titleEl","paddingLeft","tabindex","contentEl","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","$dd0d395ff14a3e11$export$f5386afdb763a67e","count","emit","listener","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","mouseEventHasMovement","hasPointerEvents","hasWebGl","getVisitor","canShareFiles","insertAfter","$7jh4K","setAttributes","removeClassName","fitInto","centerWithin","gcd","reduce","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","testShouldPixelate","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","convertToAlphaChannelCanvas","freeCanvas","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","$h4olN","setEventListener","$idV3L","PointerListener","$04lDo","$exufe","$cdd5ef6b176accd6$export$d031894fc27e45","DomEl","$cdd5ef6b176accd6$export$3f65cefe8380dbea","options","$cdd5ef6b176accd6$export$8ff9f68337b520c0","hasWebgl","visitor","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$ebcc19037a7ab076","mouseEvent","MouseEvent","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$9cbe517943afd6db","premultipliedAlpha","$878b1f179a521546$export$96cd70eaafd80100","chrome","gl","JSON","parse","stringify","$878b1f179a521546$export$fe0a7220ab4eecad","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","$44dda2e48e48a872$export$cd3d1f114b139967","$2bd9b7b9bc92046d$export$c4f94c8b3850a5a9","referenceNode","newNode","nextSibling","$2bd9b7b9bc92046d$export$fe58198efe02b173","counter","check","complete","$2bd9b7b9bc92046d$export$dbf350e5966cf602","styleObj","alignContent","webkitUserSelect","$2bd9b7b9bc92046d$export$74da2cba014bdc09","attrObj","setAttribute","$2bd9b7b9bc92046d$export$5cf2b5b76bc9d0c","classStr","classAttr","getAttribute","splitArr","$2bd9b7b9bc92046d$export$1789407f05ca7654","$2bd9b7b9bc92046d$export$10d8903dec122b9d","els","fragment","$2bd9b7b9bc92046d$export$fa55905620c22535","aw","ah","bw","bh","$2bd9b7b9bc92046d$export$76d0c1a172b67a61","$2bd9b7b9bc92046d$export$aa350b96d91cd94","date","Date","getFullYear","getMonth","toString","getHours","getMinutes","$2bd9b7b9bc92046d$export$f81847884871263e","$2bd9b7b9bc92046d$export$533b26079ad0b4b","numerator","denominator","$2bd9b7b9bc92046d$export$8215e6b900906daa","decimalNumber","len","pow","$2bd9b7b9bc92046d$export$5063ec57a23c4f2e","blobObj","Blob","constructor","fauxBlob","encoding","data","$2bd9b7b9bc92046d$export$1093707c159148e8","dateA","dateB","setHours","getTime","$2bd9b7b9bc92046d$export$af0d87255f3cfd7e","obj","$2bd9b7b9bc92046d$export$331c30fd60da0115","mimetype","err","toBlob","filesArray","File","share","$2bd9b7b9bc92046d$export$b981489921ee18cd","clickEvent","allowClick","$2bd9b7b9bc92046d$export$c54fe3b9ecaa84cf","createElementNS","elementType","childrenArr","$74d1f29ad2137b2c$var$globalKey","emitDown","c","d","listenerArr","emitUp","keyDown","code","keyCode","keyToKeyStrObj","isDownObj","comboArr","codeIsDownObj","keyUp","oldComboStr","blur","eventArr","keyToKeyStrArr","i2","keyStrToKeyObj","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","u","z","plus","minus","up","down","home","end","code1","add","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","keyStrArr","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","sort","pointerArr","pressureNormalizeAvgCount","pressureNormalizeAvgPressure","pressureNormalizeIsComplete","pressureNormalizeFactor","$893e90c2dcf687ac$var$WheelCleaner","endSequenceTimeout","delta","deltaY","round","sequenceUnit","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","clearTimeout","deltaMode","absDelta","abs","$893e90c2dcf687ac$export$9371bd96776f4e82","onTouchstart","onTouchmove","onTouchend","getDragObj","pointerId","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","normalizePressure","correctPointerEvent","corrected","correctedObj","pointerType","movementX","movementY","timeStampOffset","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","pointerObj","getPointer","lastPageX","lastPageY","addPointer","totalLastX","totalLastY","eventItem","createPointerOutEvent","correctedEvent","bounds","targetElement","getBoundingClientRect","relX","relY","dX","dY","time","coalescedItem","createTouchOutEvent","touchListItem","touchEvent","identifier","destroyDocumentListeners","onGlobalPointerMove","onGlobalPointerUp","onGlobalPointerLeave","onPointerEnter","isOverCounter","onEnterLeaveCallback","onPointerLeave","onPointermove","tempLastPointerType","lastPointerType","maxPointers","didSkip","outEvent","onPointerCallback","onPointerdown","dragObj","downPageX","downPageY","lastTimeStamp","setTouchTimeout","buttonsToStr","clearTouchTimeout","outEvent1","touchTimeout","fakeEvent","performance","now","onTouchTimeout","onPointer","onWheelCallback","onWheel","onEnterLeave","wheelCleaner","wheelEvent","isDestroyed","timing","navigationStart","fixScribble","touchArr","changedTouches","touchObj","isOver","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$12950380ec51f25d$export$649a211db9812745","continueChain","chainArr","chainOut","func","$12950380ec51f25d$export$db3963a21c01d803","fail","sequenceArr","timeoutObj","maxUntilSecondDown","eventQueueArr","lastSequenceItem","onDoubleTap","setupTimeout","timeoutStr","targetFunc","timeMS","diff","nowTime","minSilenceBeforeDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","allowedPointerTypeArr","allowedButtonArr","pointersDownIdArr","lastUpTime","isDown","isUp","processEvent","setAllowedPointerTypeArr","arr","setAllowedButtonArr","$12950380ec51f25d$export$510622b8aed00381","firstDownTime","firstLastDownTimeout","tapTimeout","fingerArr","tempLastEventTime","lastEventTime","fingers","maxFirstLastFingerDownMs","downTime","maxTapMs","fingerObj","fingerObj1","i3","allAreUp","i4","onTap","$12950380ec51f25d$export$d62358ac2d82abb3","gestureObj1","doSwallow","secondFingerTimeout","touchPointerArr","isInProgress","continuePinch","index","beginPinch","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","i6","i7","endPinch","touchPointerObj","i5","firstFingerMaxDistancePx","gestureObj","pincherArr","onPinch","actionObj","startDist","distance","startAngle","$12950380ec51f25d$export$fe11e0afe623a677","eventCopy","$12950380ec51f25d$export$71ff2f51bf1f4062","pointers","downPointerId","ignorePointerIdArr","$12950380ec51f25d$export$d429e21f52463d17","downEvent","eventQueue","direction","shiftIsPressed","onDraw","pressure0","pressure1","i8","$12950380ec51f25d$export$91dcf4209534d21f","$12950380ec51f25d$export$c57e2ed65bcf4d6a","lastMixedInput","interval","timeout","inputX","inputY","inputPressure","setInterval","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","size1","create","toDataURL","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","multiplyMatrixAndPoint","$e4df33b4b16105d5$export$5b12bf1653c0dd85","getIdentity","matrix","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","mul","dot","aArr","bArr","map","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getAtDist","getLength","fac","$77ae015f37ebe4f1$export$5379d955c16d4d43","lastPoint","lastCallbackPoint","lastAngle","pointArr","lastDot","lastSpacing","spacing","controlsCallback","dir","pointM1","pointM2","pointM3","pointLine","curvePoints","p3","p4","resolution","getBezierPoints","tempSpacing","dAngle","addFinal","newP","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","xa","ya","wx","sig","ddydx","getFirstX","getLastX","interpolate","klo","khi","k","findX","tempX","tempY","tempDist","$77ae015f37ebe4f1$export$4551d4af86c1eb08","startVal","endVal","stepSize","dec","resultArr","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","o","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbaObj","hexStr","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","getAll","activeElement","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","$cfe3aa45a75894cc$var$els","isArray","onChange","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","msg","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","module","exports","getBundleURL","resolve","$d82e0c66c1aaca81$export$48513f6b9f8ce62d","element","innerEl","checked","doHighlight","allowTab","tabIndex","onchange","$aa0ec58519fa7d10$export$b7e3ae3d7c15e42e","$eb01976a4bab51ce$export$ef9b1a59e592288f","selectEl","changeListener","cursor","fontSize","colorScheme","isFocusable","optionArr","option","initValue","$5cde84e643fb89d6$export$b6d053cded550773","isActive","backgroundImage","isRadio","setValue","getValue","$459eb3dcb08ae3f8$export$7cc1012a658e6ad8","activeIndex","createOption","initId","radioEl","$12a3b74a8702bb1f$export$77219f67585650fa","isChecked","changeCallback","redraw","toggleDiv","border","cssFloat","$1JVLJ","backgroundSize","backgroundRepeat","boxSizing","$cf8be10874d1afb1$export$a1855b925e534de7","splineInterpolator","toLinearValue","useSpline","updateEnable","isEnabled","getOutsideVal","linearValue","updateLabel","pLinearValue","outVal","formatFunc","toLocaleString","languageStrings","getCode","labelCaption","control","elementWidth","isFinal","isChangeOnFinal","eventResMs","lastCallbackTime","virtualVal","deltaX","curve","elementHeight","curveArr","controlInner","labelFontSize","pointerListener","pointerListenerTimeout","increaseValue","decreaseValue","config","setIsEnabled","isDisabled","$0c2dd884393cffca$export$f8e41e222e32615d","isRightButton","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$lwYTO","execCommand","resultStr","$9eeb6c00ea2d3242$export$4e5102252876c5d7","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","rgb","hueStop","updateSVPointer","svHeight","pointerSV","setColPreview","divPreview","primaryColorRGB","pickerButton","filter","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","secondaryColorHSV","controlH","pickCallback","outputDiv","startValue","svWrapper","svSvg","DOMParser","parseFromString","documentElement","divH","SVContainer","virtualHSV","$lnp03","backgroundPosition","isPicking","targetEl","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","$3ac3f56275b45315$export$dcd33f7653c95f09","updateSV","canvasSV","gradient1","colleft","colright","heightSV","updateHPointer","pointerH","canvasH","heightH","svPointerId","svPointerListener","hPointerId","hPointerListener","cleardiv","clear","$0b17443c34517974$export$ac00cea56cec3037","param","redrawPoint","sliderPoint","sliderPos","isDragging","pointSize","sliderLine","isFirst","imaginaryPos","margin","transition","$a19b2655062f09b7$export$24ba9b81662d4366","buttonArr","setIsSelected","selectedIndex","colorArr","checkerUrl","found","sItem","initialIndex","colorButton","buttonSize","textAlign","$c8511e371b1e3768$export$c019608e5b5bb4cb","optionObj","classArr","isSmall","wrapperEl","selectedId","getIndex","initialId","changeOnInit","previous","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$neyVU","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout2","$81ac8fccf3fa43c3$export$8e17099f54853f0e","aboutDiv","closed","aniToggle","imageContainer","coverImage","coverSize","aniTimeout","boxSize","ontouchstart","ontouchmove","ontouchend","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRect","thumbX","scaleW","thumbY","scaleH","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","isReset","eventTarget","isNotCopy","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","startP","updateCropTimeout","startCrop","didMove","rect","doUpdate","getRect","getCroppedImage","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","fetch","clipboard","write","ClipboardItem","topWrapper","borderTop","borderBottom","KeyEvent","rectObj","$aacd8170d7ccb1c6$export$56cc6eb0b4c43d97","p_canvas","p_func","p_rootDiv","oldHistoryState","row","clearBtn","$hkSYR","suggestions","suggestionBtns","createLayerList","updatefunc","createLayerEntry","klCanvasLayerArr","layercanvas","layerElArr","posY","innerLayer","container1","container2","spot","oldOpacity","thumbDimensions","thumb","thc","lname","whiteSpace","ondblclick","opacityLabel","sliderValue","isLast","layerOpacity","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","dragstart","freshSelection","lastpos","isSelected","div1","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","selectedSpotIndex","layerListEl","getState","child","updateHeight","layerHeight","layerSpacing","newspot","posy","oldSpotIndex","newSpotIndex","moveLayer","mergeBtn","disabled","listdiv","disableButtons","enableButtons","div2","modeWrapper","modeSelect","addnewBtn","duplicateBtn","removeBtn","renameBtn","paddingRight","$94kI0","$bcAoE","$635Wu","$NA9np","clearboth","MAX_LAYERS","duplicateLayer","removeLayer","mixModeStr","$bBcC4","translateBlending","topCanvas","preview","spacer","alphaCanvas","bottomCanvas","globalAlpha","topOpacity","mergeDialog","mode","mergeLayers","setMixMode","historyState","activeLayerSpotIndex","getSelected","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcData","targetCtx","targetImageData","srcCanvas","srcImageData","srcCtx","srcIndex","targetData","imageData","canvasObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","$7069db2f5e23d00f$export$13d50f258a8034f","rgbaArr","Uint8Array","ArrayBuffer","px","py","q","tl","tr","br","bl","$7069db2f5e23d00f$var$floodFill","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","onShape","$01d7180c5d1d0fdf$export$71b514a25c47df50","isEraser","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$d256278b259ca979$export$6b9252711ea5997f","rootElement","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$var$TMode","$d492af58f4721011$export$6eaf6f7c0cc177fc","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","emptyCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","_this2","getRenderedTransform","matrix2","coords","matrix1","coords1","coords2","pointer","reqFrame","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","onFill","onText","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","lastRenderedState","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","PinchZoomer","snapAngleRad","oldTransform","mainDoubleTapper","DoubleTapper","middleDoubleTapper","twoFingerTap","NFingerTapper","threeFingerTap","pointerEventChain","OnePointerLimiter","CoalescedExploder","_this3","brushRadius","animationFrameRequested","lastRenderTime","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$18Tc8","$8n8Ho","$gU5bE","$dyPX7","oldIsHand","currentIsHand","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","renderContext","workspacePointArr","borderSize","layerArr","getLayersFast","compositeObj","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","doRender","elapsedFrames","checkChange","testBgVisible","mixTransformObj","start","render","klC","oldWidth","oldHeight","modeStr","diameter","hideBrushCursorTimeout","doAnimate","canvasPointsArr","boundsObj","boundsWidth","boundsHeight","oldAngleRad","tx","ty","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$var$snapToPixel","$0370167ee97a20d9$var$copyTransform","$0370167ee97a20d9$var$toTransformSpace","$0370167ee97a20d9$var$toImageSpace","$0370167ee97a20d9$export$79a74567acf241b0","scaled","corners","minSnapDist","cornerCursors","gripSize","edgeSize","edges","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","pointerRemainder","isInverted","boundsStartP","boundsPointerListener","snap","iP","distX","distY","j","projected","dist1","updateCornerPositions","updateDOM","virtualPos","offsetArr","tinyOffset","constrainCorner","snapCorner","tP","indexes","updateTransformViaCorners","updateScaled","angleOffset","tfD","ti","dimension","restoreRatio","angleGrip","$bpZoe","anglePointerListener","offset","snapDeg","iX","iY","_x","_y","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","$48f5d87739d28bf9$export$205c2dd29f8a66b5","updatePreview","freeTransform","getTransform","destCanvas","previewLayerArr","transformIndex","initTransform","klCanvasPreview","previewFit","imageWidth","imageHeight","innerWrapper","transformSize","setPos","setAngleDeg","setTransformFit","fit","setTransformCenter","getTransformation","getIsPixelated","$de496a1759b04ed9$export$71ed2b85d4ca43d3","transformTop","grips","maxH","transformRight","maxW","transformBottom","transformLeft","commit","cornerElArr","outline","thirdsHorizontal","thirdsVertical","gripCursors","outlinePointerListener","gripOverlay","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","setTransform","setScale","showThirds","$18e69c7d4cb991e8$export$d25420b53e16716f","layerObj","largeCanvasAnimationTimeout","isInstant","nameLabelEl","opacityEl","lastDrawnSize","canvasDimensions","canvasSize","animationCanvas","animationCanvasCtx","animationCanvasCheckerPattern","animationCount","animationLength","animate","drawLargeCanvas","lastDrawnState","largeCanvasIsVisible","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasCheckerPattern","largeCanvasWrapper","removeLargeCanvas","largeCanvasAnimationDurationMs","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameFadeEl","clickableEl","webkitTouchCallout","createPattern","showLargeCanvas","currentState","klCanvasLayerObj","$a29ff52bf33e0691$export$83ae33786c7b4ee5","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","centerBtn","importImage","buttonStr","$01cb8095758db224$export$e789742143ba5b1","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","optionLayerEl","optionImageEl","paddingTop","textShadow","optionStyle","$d6fe881e8fc421ac$export$9f0da9b942594e99","updateColor","selectedColorEl","updateUI","mousePos","sizeObj","hHeight","sliderHeight","queuedObj","subscriptionFunc","initialColor","subscribe","sliderConfig","getSliderConfig","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$5a9IX","newButton","$aIuek","importButton","$iSExi","saveButton","$bJ468","shareButton","$1cU21","helpButton","$dLSOl","$18c597dee53260ff$export$a0a40f8a0b8fee15","createDropdownButton","wrapper","dropdownWrapper","smallMargin","onClickDropdownBtn","closeDropdown","currentActiveIndex","updateButton","showDropdown","dropdownBtnArr","arrowButton","activeButton","titleArr","activeButtonIm","imArr","openTimeout","startX","startY","elementFromPoint","$ljHFh","borderBottomLeftRadius","borderBottomRightRadius","$a372d78c806cd0cc$export$c744a22bef9e0b97","doEmit","currentActiveStr","toolDropdown","handButton","onActivate","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","zoomInNOutButton","$kfbw6","$89wUh","zoomInButton","zoomOutButton","undoNRedoButton","$jVJD7","undoButton","redoButton","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","pTabObj","useAccent","openedTabObj","tabDiv","openedTabObj1","roundRight","roundLeft","tabArr","roundSize","$lpHLy","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","onReset","fitButton","leftRotateButton","$38LBW","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","updatePreviews","strokeWidth","lineWidthSlider","squish","rectStrokeSvgRect","rectFilledSvgRect","ellipseStrokeSvgEllipse","ellipseFilledSvgEllipse","lineSvgLine","fixedToggle","previewPadding","previewSize","snapToggle","rectStrokeSvg","rectFilledSvg","ellipseStrokeSvg","ellipseFilledSvg","lineSvg","shapeOptions","eraserToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","maxCanvasSize","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","HCF","secondaryColor","canvasWidth","canvasHeight","workspaceWidth","workspaceHeight","onConfirm","newImDiv","widthWrapper","heightWrapper","widthUnit","heightUnit","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","colorOptions","previewcell","cell","onkeyup","secondRow","secondRowLeft","$3f73fb4b1b574d52$export$5b91f641162972fc","icon","directionStr","$10vLG","dirStr","$cd9e7df6e228ea45$export$e263e067d6140649","textCtx","textCanvas","objectSpread","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","previewCtx","checkerPattern","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","touchAction","previewPointerListener","row2n3Wrapper","unshift","fontPointerListener","zoomWrapper","sizePointerListener","$hYo3Z","$iZEgo","$b6U2o","$28VIu","$9N32U","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","resolutionEl","updateResolution","flattenCheckbox","doFlatten","noteStyle","warningArr","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","showWarnings","noteEl1","cropRect","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","onupgradeneeded","createObjectStore","keyPath","createIndex","unique","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","contains","deleteDatabase","transaction","objectStore","e3","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","glBrightnessContrast","lang","buttonLabel","webgl","updateContext","$lwRqL","getDialog","inEmbed","$iZHb0","neededWithWebGL","glCurves","$d76q3","$gOquh","glHueSaturation","$9gBJM","invert","$kBjrm","glPerspective","$7YbO8","$99Hvm","glTiltShift","$df9fA","toAlpha","$2jUvB","$2TBzi","ieFails","glBlur","$cE8nO","glUnsharpMask","$kGBiW","$805be15a1e91c0ee$var$updateNames","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","$68QTJ","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","historyEntry1","settingColor","settingColorStr","lineToolLastDot","inputArr","calcOpacity","settingOpacity","settingHasOpacityPressure","updateAlphaCanvas","settingAlphaId","ALPHA_CIRCLE","ALPHA_SQUARE","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","$5CF7D","alphaImArr","drawDot","before","settingLockLayerAlpha","arc","twoPI","closePath","hasDrawnDot","targetMipmap","ALPHA_CHALK","continueLine","bezierLine","lastInput","drawArr","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","localSpacing","settingSpacing","actions","maxInput","loopDist","mouseDist","eX","eY","bdist","historyEntry","setAlpha","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","getLockAlpha","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","$74D3O","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","noise","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","dot2","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","j1","gi0","gi1","gi2","t2","$dfc47a34ad9bc378$export$d3022aad56692482","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$var$clamp","$02d77b8dd5755328$export$9659db8d01dd5313","isTesting","blending","settingSizePressure","settingOpacityPressure","blendCol","blendMix","redrawBounds","cells","getTouchedCells","isTouched","drawCells","touchedCells","cellsW","getCellsWidth","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","underR1","underG1","underB1","newAlpha","drawBuffer","localColNew","calcSpacing","avgX","avgY","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","bezierCallback","updateRedrawBounds","totalCells","drawChangedCells","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","lastX","lastY","settingBlending","settingScale","sketchySeed","setSeed","getSeed","mixmode","c1","c2","getBlending","setBlending","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherPattern","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherCanvas","plotLine","skipFirst","settingUseDither","sX","sY","plotCubicBezierLine","isOverThreshold","d2","d3","cubicCurveOverThreshold","controlCallback","controlObj","setIsEraser","setUseDither","getUseDither","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","createRadialGradient","oFac","opacity1","started","setTransparentBG","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aIndex","aP","bP","softnessPx","pixel","ai","bi","ix","iy","fac2","alphaLock","bx1","bx2","iy4","yStart","ix4","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","$78ad817c60f81b7c$export$c9f800961903deab","completeRedrawBounds","copiedCells","copyImageData","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","tmpCanvas","$348fcce123898af9$export$38b08aa4ea8f61c6","settingMode","settingDistort","settingXSymmetry","settingYSymmetry","settingGradient","buffer","path","Path2D","startAtTop","gradient","minY","maxY","lineJoin","distort","pos","historyCanvas","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","$cVFne","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$3uATk","updateAlphas","alphas","currentAlpha","spacingSpline","lockAlphaToggle","$7NTKy","pressureSizeToggle","pressureOpacityToggle","alphaWrapper","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$kWKVM","blendingSlider","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$dT95N","blendSlider","scaleSlider","$9519e739bc9666ee$export$d001f3406562d07","$fqvTS","ditherToggle","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$9OYoy","isTransparentBg","transparencyToggle","$1045b9bae2ffbbb4$export$84831662ba707e7a","$bSKev","$18456e8104a5a825$export$80819a93636ebb04","$7cAXf","actualIconSize","iconSize","modeOptions","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$14dc4cf18966a4f4$export$2358c75ad3c15b2d","$6f92981a32875bca$export$5334e08b3589fc5c","isEmbed","linkEl","iframe","href","contentWindow","location","isMaxHeight","$142eacf53b1eb43d$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","storeEl","clearEl","hideClearButton","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","ageStr","age","maxWidth","maxHeight","resetButtons","Promise","bind","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","onabort","$3ee249752703e788$export$f3c1ac6650038646","$2wCWz","base64ToBlob","createThumbnail","HTMLCanvasElement","all","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","view","charCodeAt","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","createSpacer","clearer","line","filemenu","uploadImgurButton","clipboardButton","$kmrRo","multiple","accept","exportTypeWrapper","exportTypeSelect","importWrapper","innerMask","importFakeButton","createImportButton","saveNote","fileBrowserStorage","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filterKey","filterArr","applyFilter","filterDialog1","currentColorRgb","secondaryColorRgb","filterDialog","getInput","finishedDialog","createDisabledButton","appName","addGroup","groupArr","filters","groupA","groupB","filterKey1","hrEl","webglnote","$6349b006a6604e1b$var$upload","description","_upload","gif","labelText","response","formData","$a5qtk","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$ae23cd0c3e53f398$var$agPsdLazy","$ae23cd0c3e53f398$export$ab3d838b1d336b38","_loadAgPsd","$06e8423858d08972$export$befc6437ad34b28a","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","closeFunc","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","format","saveImage","mimeType","$98ax7","saveAs","mimeType2","filename1","fileBase","fnameArr","layerArr1","psdConfig","blendKlToPsd","writePsdBuffer","XMLHttpRequest","responseType","g1","send","d1","a2","status","dispatchEvent","createEvent","initMouseEvent","self","$parcel$global","global","a1","HTMLAnchorElement","download","rel","msSaveOrOpenBlob","autoBom","warn","HTMLElement","safari","onloadend","readAsDataURL","define","amd","FileSaver","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","setCurrentLayerCtx","getCurrentBrush","doIgnore","ignoreTest","oldSize","b4","id1","b3","b8","p5","b5","p6","b6","id2","b7","currentLayerIndex","logParam","localCurrentLayerCtx","p7","p8","b9","p9","b10","id3","b11","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","onLeftRight","customAbout","makeLicenses","licenses","overflowY","language","getLanguage","preferredLanguageRow","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","$7YsoP","$jewBv","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$b37f5cd553722692$export$665d2c76b1eb8459","submitButton","onSubmit","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$99EgS","$5deND","$4d8c6","$5Ta9b","$gMKRz","$7z464","$diAhN","$c1rJJ","$2elec","$gACTl","$dIv7c","$1NZ3i","$cJB4E","$gTwOE","$1e763c481ba6cf00$export$80884bc1ac80aa1d","selectedLayerIndex","brightness","contrast","glCanvas","$5RaQo","getSharedFx","texture","brightnessSlider","$cH2YE","brightnessContrast","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$0e6e34a2063e157d$var$fxCanvas","$TEtAx","fx","$0e6e34a2063e157d$export$8c4423af32b21158","_","isContextLost","$5eb53faa48338ac6$export$68ae324f2f6c6252","gl1","lo","hi","wrapTexture","loadContentsOf","texture1","Texture1","fromElement","initialize","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","Shader1","use","getDefaultShader","drawRect","simpleShader","shader","uniforms","textureIn","textureOut","swapWith","node","contents","getPixelArray","array","readPixels","getSquareToQuad","dx1","dy1","dx2","dy2","dx3","dy3","det","getInverse","warpShader","warp","splineInterpolate","interpolator","curves","red","green","blue","initFromBytes","textures","denoise","exponent","texSize","hueSaturation","amount","sepia","unsharpMask","strength","ensureFormat","triangleBlur","originalTexture","unuse","vibrance","vignette","lensBlur","lensBlurPrePass","common","randomShaderFunc","lensBlur0","lensBlur1","lensBlur2","power","delta0","delta1","tiltShift","endX","endY","blurRadius","gradientRadius","zoomBlur","colorHalftone","dotScreen","edgeWork","edgeWork1","edgeWork2","hexagonalPixelate","ink","bulgePinch","matrixWarp","inverse","useTextureSpace","perspective","after","swirl","replaceRGBA","oldGetExtension","oldGetSupportedExtensions","OESTextureFloatLinear","getSupportedExtensions","framebuffer","createFramebuffer","byteTexture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","floatTexture","LINEAR","Float32Array","program","createProgram","vertexShader","createShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","shaderSource","compileShader","attachShader","linkProgram","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STREAM_DRAW","enableVertexAttribArray","vertexAttribPointer","useProgram","viewport","drawArrays","POINTS","supportsOESTextureFloatLinear","WebGLRenderingContext","$OES_texture_float_linear$","extensions","isNumber","compileSource","testPrecisionSupport","Shader","defaultVertexSource","defaultFragmentSource","floatPrecision","source","nameStr","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","vertexSource","fragmentSource","vertexAttribute","texCoordAttribute","HIGH_FLOAT","MEDIUM_FLOAT","getProgramParameter","LINK_STATUS","getProgramInfoLog","deleteProgram","getUniformLocation","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","uniform1f","uniform1i","getParameter","VIEWPORT","vertexBuffer","STATIC_DRAW","texCoordBuffer","getAttribLocation","TRIANGLE_STRIP","defaultShader","Texture","getCanvas","videoWidth","videoHeight","deleteTexture","unit","activeTexture","TEXTURE0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","fillUsingCanvas","toImage","pixels","other","$21fb62da4f6e89f8$export$4630dcf80f8ceb88","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","offsetWrapper","selectedRgbaObj","fit1","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","bgColorOverlay","updateBg","flexRow","$e250f451a2faf8b3$export$2e9081b953703a77","canvas1","ctx1","curves1","modeButtons","p0","areah","areaw","update2","curveArea","createPoint","lock","internalY","internalX","newX","newY","updateControl","outCurves","drawCurve","spline","getDiv","update1","$ae0fd60a73f3b8a4$export$8a83211c878a3f1f","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","fcOption","borderTopLeftRadius","$8acL3","flOption","borderTopRightRadius","optionWrapper","horizontal","vertical","flipCanvas","$b5e471d752989800$export$88005259b9a70e15","Saturation","hueSlider","saturationSlider","$d23471d9289cfec2$export$6897c284b6f9f4dc","$ed63f0c6c7ca7574$export$358acb0cd681f612","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeOption","afterOption","nobSize","$2405b4796fda9858$export$4380c87abf28fdf","previewW","previewH","algorithmSelect","canvasWrapper","inputWrapper","$3sYrR","constrainCheckbox","secondRowElement","$5b99ea702a5304d2$export$bb628a54ab399bc9","WebkitTransform","MozTransform","OTransform","msTransform","btnPlus","btnMinus","$e3bfa9cf59911118$export$83a0900d4b9a8022","fa","fb","blurSlider","gradientSlider","$dc2850290325f029$export$51186ad6e864892a","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputR","tempBounds","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","$6f2c67b7999657bb$export$5a82a801f025d40a","radiusSlider","$f7bb3cad91091576$export$a959f91352b242e2","strengthSlider","$e96a6eb511826b00$export$be1ee5ea42904fdc","sourceId","sourceOptions","$40b8cea12adf584e$export$92433b641be3f7a","_klCanvasToPsdBlob"],"version":3,"file":"main-embed.82e36f61.js.map"}