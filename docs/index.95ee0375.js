!function(){function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},i={},a=n.parcelRequire94c2;null==a&&((a=function(e){if(e in r)return r[e].exports;if(e in i){var t=i[e];delete i[e];var n={id:e,exports:{}};return r[e]=n,t.call(n.exports,n,n.exports),n.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){i[e]=t},n.parcelRequire94c2=a),a.register("a3WMe",(function(t,n){var r,i;e(t.exports,"register",(function(){return r}),(function(e){return r=e})),e(t.exports,"resolve",(function(){return i}),(function(e){return i=e}));var a={};r=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)a[t[n]]=e[t[n]]},i=function(e){var t=a[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),a.register("cf2NR",(function(t,n){e(t.exports,"applyDecoratedDescriptor",(function(){return a("6xwrT").default})),e(t.exports,"arrayWithHoles",(function(){return a("aRZzS").default})),e(t.exports,"arrayWithoutHoles",(function(){return a("6fb3s").default})),e(t.exports,"assertThisInitialized",(function(){return a("cmjz0").default})),e(t.exports,"asyncGenerator",(function(){return a("jkE65").default})),e(t.exports,"asyncGeneratorDelegate",(function(){return a("fW3dX").default})),e(t.exports,"asyncIterator",(function(){return a("8F0QZ").default})),e(t.exports,"asyncToGenerator",(function(){return a("5atYG").default})),e(t.exports,"awaitAsyncGenerator",(function(){return a("97JYU").default})),e(t.exports,"awaitValue",(function(){return a("258Im").default})),e(t.exports,"classCallCheck",(function(){return a("hDZfO").default})),e(t.exports,"classNameTDZError",(function(){return a("6zvNl").default})),e(t.exports,"classPrivateFieldGet",(function(){return a("kNT96").default})),e(t.exports,"classPrivateFieldLooseBase",(function(){return a("72D51").default})),e(t.exports,"classPrivateFieldSet",(function(){return a("ebflU").default})),e(t.exports,"classPrivateMethodGet",(function(){return a("3Qoh8").default})),e(t.exports,"classPrivateMethodSet",(function(){return a("h5JCA").default})),e(t.exports,"classStaticPrivateFieldSpecGet",(function(){return a("lgwDw").default})),e(t.exports,"classStaticPrivateFieldSpecSet",(function(){return a("baShK").default})),e(t.exports,"construct",(function(){return a("cSOZd").default})),e(t.exports,"createClass",(function(){return a("3SSYo").default})),e(t.exports,"decorate",(function(){return a("2h4pF").default})),e(t.exports,"defaults",(function(){return a("6QjFu").default})),e(t.exports,"defineEnumerableProperties",(function(){return a("5lcdu").default})),e(t.exports,"defineProperty",(function(){return a("hH4eb").default})),e(t.exports,"extends",(function(){return a("8FALb").default})),e(t.exports,"get",(function(){return a("2YRtX").default})),e(t.exports,"getPrototypeOf",(function(){return a("1S4ko").default})),e(t.exports,"inherits",(function(){return a("ltgnF").default})),e(t.exports,"inheritsLoose",(function(){return a("gbPGa").default})),e(t.exports,"initializerDefineProperty",(function(){return a("2JASh").default})),e(t.exports,"initializerWarningHelper",(function(){return a("7F7PW").default})),e(t.exports,"_instanceof",(function(){return a("3eJU0").default})),e(t.exports,"interopRequireDefault",(function(){return a("5YFft").default})),e(t.exports,"interopRequireWildcard",(function(){return a("dvrat").default})),e(t.exports,"isNativeFunction",(function(){return a("ftgRa").default})),e(t.exports,"iterableToArray",(function(){return a("c7HsL").default})),e(t.exports,"iterableToArrayLimit",(function(){return a("4a5GT").default})),e(t.exports,"iterableToArrayLimitLoose",(function(){return a("l7ABH").default})),e(t.exports,"jsx",(function(){return a("fJgt0").default})),e(t.exports,"newArrowCheck",(function(){return a("OXQSy").default})),e(t.exports,"nonIterableRest",(function(){return a("dQnEc").default})),e(t.exports,"nonIterableSpread",(function(){return a("4RbFO").default})),e(t.exports,"objectSpread",(function(){return a("2EcGA").default})),e(t.exports,"objectWithoutProperties",(function(){return a("fdNvk").default})),e(t.exports,"objectWithoutPropertiesLoose",(function(){return a("iadAQ").default})),e(t.exports,"possibleConstructorReturn",(function(){return a("kvYzr").default})),e(t.exports,"readOnlyError",(function(){return a("l0MGN").default})),e(t.exports,"set",(function(){return a("7ZIo4").default})),e(t.exports,"setPrototypeOf",(function(){return a("7ZkrR").default})),e(t.exports,"skipFirstGeneratorNext",(function(){return a("juoRK").default})),e(t.exports,"slicedToArray",(function(){return a("1q97l").default})),e(t.exports,"slicedToArrayLoose",(function(){return a("2gPjf").default})),e(t.exports,"superPropBase",(function(){return a("glat8").default})),e(t.exports,"taggedTemplateLiteral",(function(){return a("clNRf").default})),e(t.exports,"taggedTemplateLiteralLoose",(function(){return a("4Z8CH").default})),e(t.exports,"_throw",(function(){return a("gtIe1").default})),e(t.exports,"toArray",(function(){return a("9LHuc").default})),e(t.exports,"toConsumableArray",(function(){return a("jvo9j").default})),e(t.exports,"toPrimitive",(function(){return a("doYAd").default})),e(t.exports,"toPropertyKey",(function(){return a("d7bfx").default})),e(t.exports,"typeOf",(function(){return a("aH1hf").default})),e(t.exports,"wrapAsyncGenerator",(function(){return a("iA0qa").default})),e(t.exports,"wrapNativeSuper",(function(){return a("l4Pg2").default})),e(t.exports,"createSuper",(function(){return a("1IWGn").default})),e(t.exports,"isNativeReflectConstruct",(function(){return a("kQG23").default}));a("6xwrT"),a("aRZzS"),a("6fb3s"),a("cmjz0"),a("jkE65"),a("fW3dX"),a("8F0QZ"),a("5atYG"),a("97JYU"),a("258Im"),a("hDZfO"),a("6zvNl"),a("kNT96"),a("72D51"),a("ebflU"),a("3Qoh8"),a("h5JCA"),a("lgwDw"),a("baShK"),a("cSOZd"),a("3SSYo"),a("2h4pF"),a("6QjFu"),a("5lcdu"),a("hH4eb"),a("8FALb"),a("2YRtX"),a("1S4ko"),a("ltgnF"),a("gbPGa"),a("2JASh"),a("7F7PW"),a("3eJU0"),a("5YFft"),a("dvrat"),a("ftgRa"),a("c7HsL"),a("4a5GT"),a("l7ABH"),a("fJgt0"),a("OXQSy"),a("dQnEc"),a("4RbFO"),a("2EcGA"),a("fdNvk"),a("iadAQ"),a("kvYzr"),a("l0MGN"),a("7ZIo4"),a("7ZkrR"),a("juoRK"),a("1q97l"),a("2gPjf"),a("glat8"),a("clNRf"),a("4Z8CH"),a("gtIe1"),a("9LHuc"),a("jvo9j"),a("doYAd"),a("d7bfx"),a("aH1hf"),a("iA0qa"),a("l4Pg2"),a("1IWGn"),a("kQG23")})),a.register("6xwrT",(function(t,n){function r(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r&&r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}e(t.exports,"default",(function(){return r}))})),a.register("aRZzS",(function(t,n){function r(e){if(Array.isArray(e))return e}e(t.exports,"default",(function(){return r}))})),a.register("6fb3s",(function(t,n){function r(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}e(t.exports,"default",(function(){return r}))})),a.register("cmjz0",(function(t,n){function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}e(t.exports,"default",(function(){return r}))})),a.register("jkE65",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("258Im");function i(e){var t,n;function i(t,n){try{var o=e[t](n),s=o.value,l=s instanceof r.default;Promise.resolve(l?s.wrapped:s).then((function(e){l?i("next",e):a(o.done?"return":"normal",e)}),(function(e){i("throw",e)}))}catch(e){a("throw",e)}}function a(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(e,r){return new Promise((function(a,o){var s={key:e,arg:r,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,i(e,r))}))},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(e){return this._invoke("next",e)},i.prototype.throw=function(e){return this._invoke("throw",e)},i.prototype.return=function(e){return this._invoke("return",e)}})),a.register("258Im",(function(t,n){function r(e){this.wrapped=e}e(t.exports,"default",(function(){return r}))})),a.register("fW3dX",(function(t,n){function r(e,t){var n={},r=!1;function i(n,i){return r=!0,i=new Promise((function(t){t(e[n](i))})),{done:!1,value:t(i)}}return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(e){return r?(r=!1,e):i("next",e)},"function"==typeof e.throw&&(n.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"==typeof e.return&&(n.return=function(e){return i("return",e)}),n}e(t.exports,"default",(function(){return r}))})),a.register("8F0QZ",(function(t,n){function r(e){var t;if("function"==typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}e(t.exports,"default",(function(){return r}))})),a.register("5atYG",(function(t,n){function r(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)}))}}e(t.exports,"default",(function(){return i}))})),a.register("97JYU",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("258Im");function i(e){return new r.default(e)}})),a.register("hDZfO",(function(t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(t.exports,"default",(function(){return r}))})),a.register("6zvNl",(function(t,n){function r(e){throw new Error('Class "'+e+'" cannot be referenced in computed property keys.')}e(t.exports,"default",(function(){return r}))})),a.register("kNT96",(function(t,n){function r(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e).value}e(t.exports,"default",(function(){return r}))})),a.register("72D51",(function(t,n){function r(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}e(t.exports,"default",(function(){return r}))})),a.register("ebflU",(function(t,n){function r(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var r=t.get(e);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}e(t.exports,"default",(function(){return r}))})),a.register("3Qoh8",(function(t,n){function r(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}e(t.exports,"default",(function(){return r}))})),a.register("h5JCA",(function(t,n){function r(){throw new TypeError("attempted to reassign private method")}e(t.exports,"default",(function(){return r}))})),a.register("lgwDw",(function(t,n){function r(e,t,n){if(e!==t)throw new TypeError("Private static access of wrong provenance");return n.value}e(t.exports,"default",(function(){return r}))})),a.register("baShK",(function(t,n){function r(e,t,n,r){if(e!==t)throw new TypeError("Private static access of wrong provenance");if(!n.writable)throw new TypeError("attempted to set read only private field");return n.value=r,r}e(t.exports,"default",(function(){return r}))})),a.register("cSOZd",(function(t,n){function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function i(e,t,n){return(i=r()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function a(e,t,n){return i.apply(null,arguments)}e(t.exports,"default",(function(){return a}))})),a.register("3SSYo",(function(t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}e(t.exports,"default",(function(){return i}))})),a.register("2h4pF",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("9LHuc"),i=a("d7bfx");function o(e,t,n){var r,i,a,o=t((function(e){!function(e,t){["method","field"].forEach((function(n){t.forEach((function(t){t.kind===n&&"own"===t.placement&&h(e,t)}))}))}(e,g.elements)}),n),g=function(e,t){var n=[],r=[],i={static:[],prototype:[],own:[]};if(e.forEach((function(e){d(e,i)})),e.forEach((function(e){if(!c(e))return n.push(e);var t=function(e,t){for(var n=[],r=[],i=e.decorators,a=i.length-1;a>=0;a--){var o=t[e.placement];o.splice(o.indexOf(e.key),1);var s=p(e),l=m((0,i[a])(s)||s);d(e=l.element,t),l.finisher&&r.push(l.finisher);var c=l.extras;if(c){for(var u=0;u<c.length;u++)d(c[u],t);n.push.apply(n,c)}}return{element:e,finishers:r,extras:n}}(e,i);n.push(t.element),n.push.apply(n,t.extras),r.push.apply(r,t.finishers)})),!t)return{elements:n,finishers:r};var a=function(e,t){for(var n=[],r=t.length-1;r>=0;r--){var i=v(e),a=y((0,t[r])(i)||i);if(void 0!==a.finisher&&n.push(a.finisher),void 0!==a.elements){e=a.elements;for(var o=0;o<e.length-1;o++)for(var s=o+1;s<e.length;s++)if(e[o].key===e[s].key&&e[o].placement===e[s].placement)throw new TypeError("Duplicated element ("+e[o].key+")")}}return{elements:e,finishers:n}}(n,t);return r.push.apply(r,a.finishers),a.finishers=r,a}(function(e){for(var t=[],n=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=t.find(n)))if(u(a.descriptor)||u(i.descriptor)){if(c(a)||c(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(c(a)){if(c(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}l(a,i)}else t.push(a)}return t}(o.d.map(s)),e);return r=o.F,i=g.elements,a=r.prototype,["method","field"].forEach((function(e){i.forEach((function(t){var n=t.placement;t.kind!==e||"static"!==n&&"prototype"!==n||h("static"===n?r:a,t)}))})),function(e,t){for(var n=0;n<t.length;n++){var r=(0,t[n])(e);if(void 0!==r){if("function"!=typeof r)throw new TypeError("Finishers must return a constructor.");e=r}}return e}(o.F,g.finishers)}function s(e){var t,n=i.default(e.key);"method"===e.kind?(t={value:e.value,writable:!0,configurable:!0,enumerable:!1},Object.defineProperty(e.value,"name",{value:"symbol"===_typeof(n)?"":n,configurable:!0})):"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var r={kind:"field"===e.kind?"field":"method",key:n,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(r.decorators=e.decorators),"field"===e.kind&&(r.initializer=e.value),r}function l(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function c(e){return e.decorators&&e.decorators.length}function u(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function h(e,t){var n=t.descriptor;if("field"===t.kind){var r=t.initializer;n={enumerable:n.enumerable,writable:n.writable,configurable:n.configurable,value:void 0===r?void 0:r.call(e)}}Object.defineProperty(e,t.key,n)}function d(e,t,n){var r=t[e.placement];if(!n&&-1!==r.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");r.push(e.key)}function p(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t}function g(e){if(void 0!==e)return r.default(e).map((function(e){var t=f(e);return x(e,"finisher","An element descriptor"),x(e,"extras","An element descriptor"),t}))}function f(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var n=i.default(e.key),r=String(e.placement);if("static"!==r&&"prototype"!==r&&"own"!==r)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+r+'"');var a=e.descriptor;x(e,"elements","An element descriptor");var o={kind:t,key:n,placement:r,descriptor:Object.assign({},a)};return"field"!==t?x(e,"initializer","A method descriptor"):(x(a,"get","The property descriptor of a field descriptor"),x(a,"set","The property descriptor of a field descriptor"),x(a,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o}function m(e){return{element:f(e),finisher:b(e,"finisher"),extras:g(e.extras)}}function v(e){var t={kind:"class",elements:e.map(p)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t}function y(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');x(e,"key","A class descriptor"),x(e,"placement","A class descriptor"),x(e,"descriptor","A class descriptor"),x(e,"initializer","A class descriptor"),x(e,"extras","A class descriptor");var n=b(e,"finisher");return{elements:g(e.elements),finisher:n}}function x(e,t,n){if(void 0!==e[t])throw new TypeError(n+" can't have a ."+t+" property.")}function b(e,t){var n=e[t];if(void 0!==n&&"function"!=typeof n)throw new TypeError("Expected '"+t+"' to be a function");return n}})),a.register("9LHuc",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("aRZzS"),i=a("c7HsL"),o=a("dQnEc");function s(e){return r.default(e)||i.default(e)||o.default()}})),a.register("c7HsL",(function(t,n){function r(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}e(t.exports,"default",(function(){return r}))})),a.register("dQnEc",(function(t,n){function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}e(t.exports,"default",(function(){return r}))})),a.register("d7bfx",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("aH1hf"),i=a("doYAd");function o(e){var t=i.default(e,"string");return"symbol"===r.default(t)?t:String(t)}})),a.register("aH1hf",(function(t,n){function r(e){return e&&e.constructor===Symbol?"symbol":typeof e}e(t.exports,"default",(function(){return r}))})),a.register("doYAd",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("aH1hf");function i(e,t){if("object"!==r.default(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r.default(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}})),a.register("6QjFu",(function(t,n){function r(e,t){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var i=n[r],a=Object.getOwnPropertyDescriptor(t,i);a&&a.configurable&&void 0===e[i]&&Object.defineProperty(e,i,a)}return e}e(t.exports,"default",(function(){return r}))})),a.register("5lcdu",(function(t,n){function r(e,t){for(var n in t){(a=t[n]).configurable=a.enumerable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n,a)}if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(t),i=0;i<r.length;i++){var a,o=r[i];(a=t[o]).configurable=a.enumerable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,o,a)}return e}e(t.exports,"default",(function(){return r}))})),a.register("hH4eb",(function(t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e(t.exports,"default",(function(){return r}))})),a.register("8FALb",(function(t,n){function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}function i(){return r.apply(this,arguments)}e(t.exports,"default",(function(){return i}))})),a.register("2YRtX",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("glat8");function i(e,t,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=r.default(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n||e):a.value}})(e,t,n)}function o(e,t,n){return i(e,t,n)}})),a.register("glat8",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("1S4ko");function i(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r.default(e)););return e}})),a.register("1S4ko",(function(t,n){function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e){return r(e)}e(t.exports,"default",(function(){return i}))})),a.register("ltgnF",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("7ZkrR");function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r.default(e,t)}})),a.register("7ZkrR",(function(t,n){function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(e,t){return r(e,t)}e(t.exports,"default",(function(){return i}))})),a.register("gbPGa",(function(t,n){function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}e(t.exports,"default",(function(){return r}))})),a.register("2JASh",(function(t,n){function r(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}e(t.exports,"default",(function(){return r}))})),a.register("7F7PW",(function(t,n){function r(e,t){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and set to use loose mode. To use proposal-class-properties in spec mode with decorators, wait for the next major version of decorators in stage 2.")}e(t.exports,"default",(function(){return r}))})),a.register("3eJU0",(function(t,n){function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}e(t.exports,"default",(function(){return r}))})),a.register("5YFft",(function(t,n){function r(e){return e&&e.__esModule?e:{default:e}}e(t.exports,"default",(function(){return r}))})),a.register("dvrat",(function(t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}e(t.exports,"default",(function(){return r}))})),a.register("ftgRa",(function(t,n){function r(e){return-1!==Function.toString.call(e).indexOf("[native code]")}e(t.exports,"default",(function(){return r}))})),a.register("4a5GT",(function(t,n){function r(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}e(t.exports,"default",(function(){return r}))})),a.register("l7ABH",(function(t,n){function r(e,t){for(var n,r=[],i=e[Symbol.iterator]();!(n=i.next()).done&&(r.push(n.value),!t||r.length!==t););return r}e(t.exports,"default",(function(){return r}))})),a.register("fJgt0",(function(t,n){var r;function i(e,t,n,i){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),t&&a)for(var s in a)void 0===t[s]&&(t[s]=a[s]);else t||(t=a||{});if(1===o)t.children=i;else if(o>1){for(var l=new Array(o),c=0;c<o;c++)l[c]=arguments[c+3];t.children=l}return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}e(t.exports,"default",(function(){return i}))})),a.register("OXQSy",(function(t,n){function r(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}e(t.exports,"default",(function(){return r}))})),a.register("4RbFO",(function(t,n){function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}e(t.exports,"default",(function(){return r}))})),a.register("2EcGA",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("hH4eb");function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){r.default(e,t,n[t])}))}return e}})),a.register("fdNvk",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("iadAQ");function i(e,t){if(null==e)return{};var n,i,a=r.default(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}})),a.register("iadAQ",(function(t,n){function r(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}e(t.exports,"default",(function(){return r}))})),a.register("kvYzr",(function(t,n){e(t.exports,"default",(function(){return o}));var r=a("cmjz0"),i=a("aH1hf");function o(e,t){return!t||"object"!==i.default(t)&&"function"!=typeof t?r.default(e):t}})),a.register("l0MGN",(function(t,n){function r(e){throw new Error('"'+e+'" is read-only')}e(t.exports,"default",(function(){return r}))})),a.register("7ZIo4",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("hH4eb"),i=a("glat8");function o(e,t,n,a){return(o="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var o,s=i.default(e,t);if(s){if((o=Object.getOwnPropertyDescriptor(s,t)).set)return o.set.call(a,n),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(a,t)){if(!o.writable)return!1;o.value=n,Object.defineProperty(a,t,o)}else r.default(a,t,n);return!0})(e,t,n,a)}function s(e,t,n,r,i){if(!o(e,t,n,r||e)&&i)throw new Error("failed to set property");return n}})),a.register("juoRK",(function(t,n){function r(e){return function(){var t=e.apply(this,arguments);return t.next(),t}}e(t.exports,"default",(function(){return r}))})),a.register("1q97l",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("aRZzS"),i=a("c7HsL"),o=a("dQnEc");function s(e,t){return r.default(e)||i.default(e,t)||o.default()}})),a.register("2gPjf",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("aRZzS"),i=a("l7ABH"),o=a("dQnEc");function s(e,t){return r.default(e)||i.default(e,t)||o.default()}})),a.register("clNRf",(function(t,n){function r(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}e(t.exports,"default",(function(){return r}))})),a.register("4Z8CH",(function(t,n){function r(e,t){return t||(t=e.slice(0)),e.raw=t,e}e(t.exports,"default",(function(){return r}))})),a.register("gtIe1",(function(t,n){function r(e){throw e}e(t.exports,"default",(function(){return r}))})),a.register("jvo9j",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("6fb3s"),i=a("c7HsL"),o=a("4RbFO");function s(e){return r.default(e)||i.default(e)||o.default()}})),a.register("iA0qa",(function(t,n){e(t.exports,"default",(function(){return i}));var r=a("jkE65");function i(e){return function(){return new r.default(e.apply(this,arguments))}}})),a.register("l4Pg2",(function(t,n){e(t.exports,"default",(function(){return c}));var r=a("cSOZd"),i=a("ftgRa"),o=a("1S4ko"),s=a("7ZkrR");function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){if(null===e||!i.default(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return r.default(e,arguments,o.default(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s.default(n,e)},l(e)}function c(e){return l(e)}})),a.register("1IWGn",(function(t,n){e(t.exports,"default",(function(){return s}));var r=a("kQG23"),i=a("1S4ko"),o=a("kvYzr");function s(e){var t=r.default();return function(){var n,r=i.default(e);if(t){var a=i.default(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return o.default(this,n)}}})),a.register("kQG23",(function(t,n){function r(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}e(t.exports,"default",(function(){return r}))})),a.register("d6Kdu",(function(t,n){var r;e(t.exports,"getBundleURL",(function(){return r}),(function(e){return r=e}));var i={};function a(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}r=function(e){var t=i[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return a(e[2])}return"/"}(),i[e]=t),t}})),a.register("1CRVs",(function(e,t){e.exports=a("hRUxH")(a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("82oMg")).then((function(){return a("bfRGr")}))})),a.register("hRUxH",(function(e,t){"use strict";var n=a("kh1nK");e.exports=n((function(e){return new Promise((function(t,n){var r=document.getElementsByTagName("script");if([].concat(r).some((function(t){return t.src===e})))t();else{var i=document.createElement("script");i.async=!0,i.type="text/javascript",i.charset="utf-8",i.src=e,i.onerror=function(t){var r=new TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));i.onerror=i.onload=null,i.remove(),n(r)},i.onload=function(){i.onerror=i.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(i)}}))}))})),a.register("kh1nK",(function(e,t){"use strict";var n={},r={},i={};function a(e){switch(e){case"preload":return r;case"prefetch":return i;default:return n}}e.exports=function(e,t){return function(n){var r=a(t);return r[n]?r[n]:r[n]=e.apply(null,arguments).catch((function(e){throw delete r[n],e}))}}})),a.register("64Sid",(function(e,t){e.exports=a("hRUxH")(a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("6dHay")).then((function(){return a("ish38")}))})),a.register("1NHNA",(function(e,t){e.exports=a("hRUxH")(a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("cVZlz")).then((function(){return a("gu9tJ")}))})),a.register("d0m5g",(function(e,t){e.exports=a("hRUxH")(a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("1ovNs")).then((function(){return a("kxfLe")}))})),a.register("2TDyk",(function(e,t){e.exports=a("hRUxH")(a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("crGqn")).then((function(){return a("cgWlW")}))})),a.register("ao3kK",(function(e,t){e.exports=a("hRUxH")(a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("jjNSQ")).then((function(){return a("iZ3ce")}))})),a("a3WMe").register(JSON.parse('{"70875":"edit-unsharp-mask.c58e988c.png","jdbgX":"index.95ee0375.js","h8axR":"check.8d706b11.svg","ePsJo":"cancel.17aa34ea.svg","82oMg":"de.4fe8b36e.js","6dHay":"ja.0f995f93.js","cVZlz":"zh-CN.4cee0a25.js","1ovNs":"zh-TW.0aade1dd.js","kgT8h":"brush-pressure.f4437531.svg","kHZ5B":"copy.4adadd0c.svg","aSjVH":"tool-picker.d0e69c3a.svg","h5jJy":"angle.f0b557ac.svg","fCbWX":"add-layer.ce1078bb.svg","1urq0":"duplicate-layer.3314e3c7.svg","hx4Ut":"merge-layers.19da79a6.svg","dUjL8":"remove-layer.4e9b2b7d.svg","fV96v":"rename-layer.13b70bac.svg","chkV0":"cursor-picker.db2f5b39.png","hTn63":"cursor-zoom-ew.fbb85406.png","k7gZz":"cursor-fill.8027a243.png","blNtI":"cursor-text.dcaa5de5.png","5hkqh":"cursor-rotate.5b164044.png","dyCML":"klecks-logo.77be0db3.png","7Ni0l":"new-image.68a10269.svg","iTYjK":"import.7a68c844.svg","ao3EV":"export.bc31616f.svg","aHpN6":"share.454898d1.svg","8jhwW":"help.208e9032.svg","dd7wR":"tool-paint.6cdb3344.svg","bPk42":"tool-fill.3358320a.svg","jwKq0":"tool-text.1cbd0325.svg","hSaP4":"tool-shape.3de78c3f.svg","d5TL5":"caret-down.68d4cd16.svg","bwHmE":"tool-hand.e7fc81b9.svg","2HRWr":"tool-zoom-in.d413f042.svg","hozz0":"tool-zoom-out.299f4d1f.svg","7MADq":"tool-undo.540bf765.svg","knlRM":"inverted-border.3353c7f3.svg","louD5":"edit-rotate.fd0e572a.svg","g0o7l":"ui-collapse.2b5dfc6a.svg","haldc":"align-left.4876a845.svg","dAfZw":"align-center.6f56d4bd.svg","7t9Dm":"align-right.1521d61c.svg","aGqvb":"typo-italic.39f02a8d.svg","jiH2w":"typo-bold.8156fef3.svg","69LYT":"edit-brightness-contrast.8430cb26.svg","a7L6K":"edit-crop.16c534dd.svg","hGj7H":"edit-curves.bbdb97b2.svg","e15bs":"edit-flip.00fd2c6b.svg","l8Jmo":"edit-hue-saturation.c9c1c847.svg","h4IKM":"edit-invert.fa435c66.png","dGn60":"edit-perspective.e23100db.svg","80Qzz":"edit-resize.56391e2b.svg","hFIw6":"edit-tilt-shift.dd20efff.png","cv8EA":"edit-to-alpha.f7a2065a.svg","3FgCK":"edit-transform.c8795430.svg","iU63i":"edit-triangle-blur.9df2dbef.png","6YIcr":"brush-pen.49a7b91e.svg","bB4UN":"brush-blend.2b9837fa.svg","g9P1I":"brush-sketchy.9e5d0120.png","4iuI5":"brush-pixel.673f3e4c.svg","b6iuj":"brush-eraser.a9e10dce.svg","592st":"brush-smudge.45852bcd.svg","8PAZJ":"brush-chemy.a5a188f6.svg","jiQCe":"upload.fb8f9195.svg","iYFqx":"loading.7ff8a2ac.gif","crGqn":"dist.219d33cb.js","77gwM":"bitbof-logo.bc5e3ed5.svg","4EoRT":"ui-swap-lr.7f474f51.svg","jjNSQ":"licenses.6c4e9014.js","b8E1f":"checkmark.5cb0764b.svg","bkm0n":"constrain.62f04e45.svg","4vTN0":"tab-settings.01d01dfb.svg","j3U20":"tab-layers.c8a104e7.svg","eWrXl":"tab-edit.1ad61255.svg","l1oc0":"tab-file.d5937518.svg"}')),a("cf2NR");var o,s=a("5atYG"),l={},c=function(e){var t,n=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]},r=function(e,t,n,r){var i=t&&t.prototype instanceof a?t:a,o=Object.create(i.prototype),s=new p(r||[]);return o._invoke=u(e,n,s),o},i=function(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}},a=function(){},o=function(){},s=function(){},l=function(e){["next","throw","return"].forEach((function(t){n(e,t,(function(e){return this._invoke(t,e)}))}))},c=function(e,t){function n(r,a,o,s){var l=i(e[r],e,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&v.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var r;this._invoke=function(e,i){function a(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(a,a):a()}},u=function(e,t,n){var r=C;return function(a,o){if(r===k)throw new Error("Generator is already running");if(r===E){if("throw"===a)throw o;return f()}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var l=A(s,n);if(l){if(l===M)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===C)throw r=E,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=k;var c=i(e,t,n);if("normal"===c.type){if(r=n.done?E:S,c.arg===M)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=E,n.method="throw",n.arg=c.arg)}}},h=function(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)},d=function(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t},p=function(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)},g=function(e){if(e){var n=e[x];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function n(){for(;++r<e.length;)if(v.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:f}},f=function(){return{value:t,done:!0}},m=Object.prototype,v=m.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},x=y.iterator||"@@iterator",b=y.asyncIterator||"@@asyncIterator",w=y.toStringTag||"@@toStringTag";try{n({},"")}catch(e){n=function(e,t,n){return e[t]=n}}e.wrap=r;var C="suspendedStart",S="suspendedYield",k="executing",E="completed",M={},I={};n(I,x,(function(){return this}));var T=Object.getPrototypeOf,R=T&&T(T(g([])));R&&R!==m&&v.call(R,x)&&(I=R);var L=s.prototype=a.prototype=Object.create(I);function A(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method))return M;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return M}var a=i(r,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,M;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,M):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,M)}return o.prototype=s,n(L,"constructor",s),n(s,"constructor",o),o.displayName=n(s,w,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,n(e,w,"GeneratorFunction")),e.prototype=Object.create(L),e},e.awrap=function(e){return{__await:e}},l(c.prototype),n(c.prototype,b,(function(){return this})),e.AsyncIterator=c,e.async=function(t,n,i,a,o){void 0===o&&(o=Promise);var s=new c(r(t,n,i,a),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},l(L),n(L,w,"Generator"),n(L,x,(function(){return this})),n(L,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=g,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(d),!e)for(var n in this)"t"===n.charAt(0)&&v.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){var n=function(n,i){return o.type="throw",o.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i};if(this.done)throw e;for(var r=this,i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=v.call(a,"catchLoc"),l=v.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&v.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,M):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),M},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),M}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;d(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:g(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),M}},e}(l);try{regeneratorRuntime=c}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=c:Function("r","regeneratorRuntime = r")(c)}if(o=function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.appendChild(t)},[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:o})})),function(){var e=function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach((function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))})),this.insertBefore(t,this.firstChild)};[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach((function(t){t.hasOwnProperty("prepend")||Object.defineProperty(t,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:e})}))}(),String.prototype.padStart||(String.prototype.padStart=function(e,t){return e>>=0,t=String(t||" "),this.length>e?String(this):((e-=this.length)>t.length&&(t+=t.repeat(e/t.length)),t.slice(0,e)+String(this))}),"scrollTo"in Element.prototype||Object.defineProperty(Element.prototype,"scrollTo",{value:function(e,t){this.scrollLeft=e,this.scrollTop=t}}),"scrollBy"in Element.prototype||Object.defineProperty(Element.prototype,"scrollBy",{value:function(e,t){this.scrollLeft+=e,this.scrollTop+=t}}),!("localStorage"in window))try{window.localStorage={getItem:function(){return null},setItem:function(){},removeItem:function(){}}}catch(e){}function u(e,t){var n=document.createElement("canvas");return e&&t&&(n.width=e,n.height=t),n}var h,d,p,g,f=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,m=function(){var e,t=null;return document.body?(e=new Event(""),t=e.timeStamp<36e5):window.addEventListener("DOMContentLoaded",(function(e){t=e.timeStamp<36e5})),function(){if(null===t)throw"eventUsesHighResTimeStamp not initialized";return t}}(),v=function(){if(!("MouseEvent"in window))return!1;var e;try{e=new MouseEvent("mousemove")}catch(e){return!1}return"movementX"in e&&!f}(),y=!!window.PointerEvent,x=(h=function(){var e=u();try{return e.getContext("experimental-webgl",{premultipliedAlpha:!1}),!0}catch(e){return!1}}(),function(){return h}),b=(d={chrome:!1,gl:!1},window.chrome&&window.chrome.app&&(d.chrome=!0),d.gl=x(),function(){return JSON.parse(JSON.stringify(d))}),w=(p=function(){var e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="max(0px, 25px)",document.body.appendChild(e),setTimeout((function(){g=25===e.offsetLeft,document.body.removeChild(e)}),25)},g=null,document.body?p():window.addEventListener("DOMContentLoaded",(function(){p()})),function(){if(null===g)throw new Error("isCssMinMaxSupported not initialized");return g}),C=function(e,t,n,r){y||(t=t.replace("pointer","mouse")),e.addEventListener(t,n,r)},S=function(e,t,n,r){y||(t=t.replace("pointer","mouse")),e.removeEventListener(t,n,r)};function k(e,t){for(var n,r=Object.keys(t),i=e.style,a=0;a<r.length;a++)i[n=r[a]]=t[n],i.alignContent="true","userSelect"===n&&(i.webkitUserSelect=t[n])}function E(e,t){return t?E(t,e%t):e}function M(e,t){var n=E(e,t);return[e/n,t/n]}a("cf2NR");var I=a("hDZfO"),T=a("3SSYo"),R=function(){for(var e=function(e,t,n,r){h.forEach((function(i){i[0]&&i[0](e,t,n,r)}))},t=function(e,t,n){h.forEach((function(r){r[1]&&r[1](e,t,n)}))},n=function(t){var n=t.key,r="code"in t?t.code:t.keyCode;if(n in l){var i=l[n];if(s[i])return void e(i,t,c.join("+"),!0);s[i]=!0,u[r]=i,c.push(i),e(i,t,c.join("+"))}},r=function(e){e.key;var n="code"in e?e.code:e.keyCode,r=c.join("+");if(["Meta","MetaLeft","MetaRight","OSLeft","OSRight"].includes(n))i(null);else if(n in u&&null!==u[n]){var a=u[n];s[a]=!1,u[n]=null;for(var o=0;o<c.length;o++)c[o]==a&&(c.splice(o,1),o--);t(a,e,r)}},i=function(e){var n=c.join("+");c=[],u={};for(var r=[],i=0;i<o.length;i++)s[o[i]]&&(s[o[i]]=!1,r.push(o[i]));for(var a=0;a<r.length;a++)t(r[a],{preventDefault:function(){},stopPropagation:function(){}},n);h.forEach((function(e){e[2]&&e[2]()}))},a={space:[" ","Spacebar"],alt:["Alt","AltGraph"],shift:"Shift",ctrl:"Control",cmd:["Meta","MetaLeft","MetaRight"],enter:"Enter",esc:"Escape",backspace:"Backspace",delete:"Delete",sqbr_open:"[",sqbr_close:"]",a:["a","A"],b:["b","B"],c:["c","C"],e:["e","E"],f:["f","F"],g:["g","G"],r:["r","R"],s:["s","S"],t:["t","T"],u:["u","U"],x:["x","X"],y:["y","Y"],z:["z","Z"],plus:"+",minus:"-",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",home:"Home",end:"End"},o=Object.keys(a),s={},l={},c=[],u={},h=[],d=0;d<o.length;d++){s[o[d]]=!1;var p=a[o[d]];if("string"==typeof p)l[a[o[d]]]=o[d];else for(var g=0;g<p.length;g++)l[p[g]]=o[d]}return{add:function(e){if(!h.includes(e)){var t=0===h.length;h.push(e),t&&(C(document,"keydown",n),C(document,"keyup",r),C(window,"blur",i))}},remove:function(e){if(h.includes(e)){for(var t=1===h.length,a=0;a<h.length;a++)if(h[a]===e){h.splice(a,1);break}t&&(S(document,"keydown",n),S(document,"keyup",r),S(window,"blur",i))}},getIsDown:function(){return s},getCombo:function(){return c}}}(),L=function(){"use strict";function e(t){I.default(this,e),this.onDown=t.onDown,this.onUp=t.onUp,this.onBlur=t.onBlur,this.ref=[this.onDown,this.onUp,this.onBlur],R.add(this.ref)}return T.default(e,[{key:"isPressed",value:function(e){if(!(e in R.getIsDown()))throw'key "'+e+'" not found';return R.getIsDown()[e]}},{key:"getComboStr",value:function(){return R.getCombo().join("+")}},{key:"comboOnlyContains",value:function(e){for(var t=0;t<R.getCombo().length;t++)if(!e.includes(R.getCombo()[t]))return!1;return!0}},{key:"destroy",value:function(){R.remove(this.ref)}}]),e}();function A(e,t,n){return e*(1-n)+t*n}function P(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))}function O(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function D(e,t){return 180*O(e,t)/Math.PI}function B(e,t,n){return e<=t?t:e>=n?n:e}function z(e,t,n){var r=n*(Math.PI/180),i=Math.cos(r),a=Math.sin(r);return{x:e*i-t*a,y:e*a+t*i}}var j,H,F,N,_,X=function(e){var t,n=function(t){e({deltaY:Math.round(t/o),pageX:l.pageX,pageY:l.pageY,clientX:l.clientX,clientY:l.clientY})},r=function(){null!==s&&(n(s),s=null),null===o||i.includes(o)||i.push(o),a=0,o=null},i=[100],a=0,o=null,s=null,l=null;this.process=function(e){l={pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY},clearTimeout(t),t=setTimeout(r,200);var c=e.deltaY;"deltaMode"in e&&1===e.deltaMode&&(c*=100/3);var u=Math.abs(c);if(a>0&&null===o)s=null;else{if(0===a){if(a++,u<50)return;return o=u,void(i.includes(o)?n(c):s=c)}if(0!==u){if(u===o||u/o%1<1e-4);else if(o/u%1<1e-4)o=u;else if(u!==o)return o=null,void(s=null);null!==s&&(n(s),s=null),n(c)}}}},U=(j=[],H=0,F=null,N=!1,_=1,function(e){var t,n,r,i=function(e){for(var t=0;t<U.length;t++)if(e===U[t].pointerId)return U[t];return null},a=function(e){for(var t=null,n=0;n<Y.length;n++)Y[n]===e&&(t=U[n],U.splice(n,1),Y.splice(n,1),n--);return t},o=function(e,t){return 0===e||1===e?e:(H<60?(F=0===H?e:A(e,F,.95),H++):N||(N=!0,F<.13&&(_=2.3)),Math.pow(e,1/_))},s=function(e){if(e.corrected)return e.corrected;var t={pointerId:e.pointerId,pointerType:e.pointerType,pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,movementX:e.movementX,movementY:e.movementY,timeStamp:e.timeStamp+D,pressure:o(e.pressure,e.type),buttons:e.buttons,button:e.button,coalescedArr:[],eventPreventDefault:function(){e.preventDefault()},eventStopPropagation:function(){e.stopPropagation()}};e.corrected=t;var n=null;"pointerId"in e?"pressure"in e&&0!==e.buttons&&(["mouse"].includes(e.pointerType)||"touch"===e.pointerType&&0===e.pressure)&&(t.pressure=1,n=1):(t.pointerId=0,t.pointerType="mouse",t.pressure=0!==e.buttons?1:0,n=t.pressure),f&&"mouse"!=e.pointerType&&"pointermove"===e.type&&0===e.buttons&&(t.buttons=1);var r=[];"getCoalescedEvents"in e&&(r=e.getCoalescedEvents());var i=function(e){for(var t=j.length-1;t>=0;t--)if(e.pointerId===j[t].pointerId)return j[t];return null}(t);null===i&&(i=function(e){var t={pointerId:e.pointerId,lastPageX:null,lastPageY:null};return j.push(t),j.length>15&&j.shift(),t}(t));for(var a=i.lastPageX,s=i.lastPageY,l=0;l<r.length;l++){var c=r[l];t.coalescedArr.push({pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,movementX:null===i.lastPageX?0:c.pageX-i.lastPageX,movementY:null===i.lastPageY?0:c.pageY-i.lastPageY,timeStamp:0===c.timeStamp?t.timeStamp:c.timeStamp+D,pressure:null===n?o(c.pressure):n}),i.lastPageX=c.pageX,i.lastPageY=c.pageY}return i.lastPageX=t.pageX,i.lastPageY=t.pageY,t.movementX=null===a?0:i.lastPageX-a,t.movementY=null===s?0:i.lastPageY-s,t},l=function(e,t,n){var r=E.getBoundingClientRect(),i={type:e,pointerId:t.pointerId,pointerType:t.pointerType,pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.clientX-r.left+E.scrollLeft,relY:t.clientY-r.top+E.scrollTop,dX:t.movementX,dY:t.movementY,time:t.timeStamp,eventPreventDefault:t.eventPreventDefault,eventStopPropagation:t.eventStopPropagation};if("pointermove"===e&&(i.coalescedArr=[],t.coalescedArr.length>1))for(var a,o=0;o<t.coalescedArr.length;o++)a=t.coalescedArr[o],i.coalescedArr.push({pageX:a.pageX,pageY:a.pageY,clientX:a.clientX,clientY:a.clientY,relX:a.clientX-r.left+E.scrollLeft,relY:a.clientY-r.top+E.scrollTop,dX:a.movementX,dY:a.movementY,time:a.timeStamp});if(n)for(var s=Object.keys(n),l=0;l<s.length;l++)i[s[l]]=n[s[l]];return i},c=function(e,t,n,r){var i=E.getBoundingClientRect(),a={type:e,pointerId:t.identifier,pointerType:"touch",pageX:t.pageX,pageY:t.pageY,clientX:t.clientX,clientY:t.clientY,relX:t.pageX-i.left+E.scrollLeft,relY:t.pageY-i.top+E.scrollTop,time:n.timeStamp+D,eventPreventDefault:function(){n.preventDefault()},eventStopPropagation:function(){n.stopPropagation()}};"pointermove"===e&&(a.coalescedArr=[]);for(var o=Object.keys(r),s=0;s<o.length;s++)a[o[s]]=r[o[s]];return a},u=function(){S(document,"pointermove",v),S(document,"pointerup",x),S(document,"pointerleave",b)},h=function(){W++,T&&T(!0)},d=function(){W--,T&&T(!1)},p=function(e){e=s(e);var t=B;if(B=e.pointerType,Y.includes(e.pointerId)||Y.length===R||"touch"===e.pointerType)z=!1;else if(z||"mouse"!==e.pointerType||"pen"!==t){z=!1;var n=l("pointermove",e);M(n)}else z=!0},g=function(e){if(e=s(e),!Y.includes(e.pointerId)&&Y.length!==R&&[1,2,4].includes(e.buttons)){0===U.length&&(C(document,"pointermove",v),C(document,"pointerup",x),C(document,"pointerleave",b));var t={pointerId:e.pointerId,pointerType:e.pointerType,downPageX:e.pageX,downPageY:e.pageY,buttons:e.buttons,lastPageX:e.pageX,lastPageY:e.pageY,lastTimeStamp:e.timeStamp};U.push(t),w(t),Y.push(e.pointerId);var n=l("pointerdown",e,{downPageX:e.pageX,downPageY:e.pageY,button:L[e.buttons],pressure:e.pressure});M(n)}},v=function(e){if(e=s(e),Y.includes(e.pointerId)){var t=i(e.pointerId);if(k(t),e.buttons===t.buttons){if(w(t),"pen"!==e.pointerType||e.pageX!==t.lastPageX||e.pageY!==t.lastPageY||e.timeStamp!==t.lastTimeStamp){var n=l("pointermove",e,{downPageX:t.downPageX,downPageY:t.downPageY,button:L[e.buttons],pressure:e.pressure});t.lastPageX=e.pageX,t.lastPageY=e.pageY,t.lastTimeStamp=e.timeStamp,M(n)}}else{1===U.length&&u(),a(e.pointerId);var r=l("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});M(r)}}},x=function(e){if(e=s(e),Y.includes(e.pointerId)){1===U.length&&u();var t=a(e.pointerId);k(t);var n=l("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});M(n)}},b=function(e){if(e=s(e),Y.includes(e.pointerId)){1===U.length&&u();var t=a(e.pointerId);k(t);var n=l("pointerup",e,{downPageX:t.downPageX,downPageY:t.downPageY});M(n)}},w=function(e){"touch"===e.pointerType&&(e.touchTimeout=setTimeout((function(){!function(e){var t={pointerId:e.pointerId,pointerType:e.pointerType,type:"pointerup",timeStamp:performance.now(),pageX:0,pageY:0,clientX:0,clientY:0,preventDefault:function(){},stopPropagation:function(){}};x(t)}(e)}),2500))},k=function(e){e.touchTimeout&&(clearTimeout(e.touchTimeout),e.touchTimeout=null)},E=e.target,M=e.onPointer,I=e.onWheel,T=e.onEnterLeave,R="maxPointers"in e?e.maxPointers:1,L={1:"left",2:"right",4:"middle"},P=new X((function(e){if(!O&&I){var t=E.getBoundingClientRect();e.relX=e.clientX-t.left+E.scrollLeft,e.relY=e.clientY-t.top+E.scrollTop,I(e)}})),O=!1,D=m()?0:-performance.timing.navigationStart,B="",z=!1,U=[],Y=[],W=0;T&&(C(E,"pointerenter",h),C(E,"pointerleave",d)),M&&(C(E,"pointermove",p),C(E,"pointerdown",g)),I&&C(E,"wheel",P.process),y?e.fixScribble&&C(E,"touchmove",n=function(e){e.preventDefault()}):(t=function(e){e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length&&U.length<R;i++){var a=t[i];0===U.length&&(C(document,"touchmove",n),C(document,"touchend",r),C(document,"touchcancel",r)),U.push({pointerId:a.identifier,downPageX:a.pageX,downPageY:a.pageY,buttons:1,lastPageX:a.pageX,lastPageY:a.pageY}),Y.push(a.identifier);var o=c("pointerdown",a,e,{dX:0,dY:0,downPageX:a.downPageX,downPageY:a.downPageY,button:"left",pressure:1});M(o)}},n=function(e){e.preventDefault();for(var t=e.changedTouches,n=0;n<t.length;n++){var r=t[n];if(Y.includes(r.identifier)){var a=i(r.identifier),o=c("pointermove",r,e,{dX:r.pageX-a.lastPageX,dY:r.pageY-a.lastPageY,downPageX:a.downPageX,downPageY:a.downPageY,button:"left",isCoalesced:!1,pressure:1});a.lastPageX=r.pageX,a.lastPageY=r.pageY,M(o)}}},r=function(e){"touchcancel"!==e.type&&e.preventDefault();for(var t=e.changedTouches,i=0;i<t.length;i++){var o=t[i];if(Y.includes(o.identifier)){1===U.length&&(S(document,"touchmove",n),S(document,"touchend",r),S(document,"touchcancel",r));var s=a(o.identifier),l=c("pointerup",o,e,{dX:o.pageX-s.lastPageX,dY:o.pageY-s.lastPageY,downPageX:s.downPageX,downPageY:s.downPageY});M(l)}}},M&&C(E,"touchstart",t)),this.isOver=function(){return W>0},this.destroy=function(){O||(O=!0,S(E,"pointerenter",h),S(E,"pointerleave",d),S(E,"pointermove",p),S(E,"pointerdown",g),S(E,"wheel",P.process),U.length>0&&u(),y?S(E,"touchmove",n):(S(E,"touchstart",t),U.length>0&&(S(document,"touchmove",n),S(document,"touchend",r),S(document,"touchcancel",r))))}}),Y={};e(Y,"EventChain",(function(){return W})),e(Y,"DoubleTapper",(function(){return V})),e(Y,"NFingerTapper",(function(){return G})),e(Y,"PinchZoomer",(function(){return K})),e(Y,"CoalescedExploder",(function(){return q})),e(Y,"OnePointerLimiter",(function(){return Z})),e(Y,"LinetoolProcessor",(function(){return J})),e(Y,"LineSanitizer",(function(){return Q})),e(Y,"LineSmoothing",(function(){return $}));var W=function(e){for(var t=function(e,t){for(;e<n.length;e++)if(null===(t=n[e].chainIn(t)))return null;return r(t),null},n=e.chainArr,r=function(){},i=0;i<n.length;i++)!function(e){n[e].setChainOut((function(n){t(e+1,n)}))}(i);this.chainIn=function(e){return t(0,e)},this.setChainOut=function(e){r=e}},V=function(e){var t=function(){if(0!==g.length){clearTimeout(x.fail),clearTimeout(x.maxUntilSecondDown),clearTimeout(x.success),x.fail=null,x.maxUntilSecondDown=null,x.success=null;for(var e=0;e<y.length;e++)i(y[e]);y=[],g=[]}},n=function(){x.fail=null,x.success=null,y=[];var t=g[g.length-1];g=[],e.onDoubleTap({pageX:t.pageX,pageY:t.pageY})},r=function(e,t,n){var r=n-v;return!(r<=0)&&(x[e]=setTimeout(t,r),!0)},i=function(){},a=400,o=300,s=10,l=19,c=500,u=300,h=250,d=["touch","mouse","pen"],p=["left"],g=[],f=[],m=0,v=0,y=[],x={fail:null,maxUntilSecondDown:null,success:null};this.chainIn=function(e){return function(e){if("pointerdown"===e.type)f.push(e.pointerId);else if("pointerup"===e.type)for(var i=0;i<f.length;i++)if(f[i]===e.pointerId){f.splice(i,1);break}if(d.includes(e.pointerType)){v=performance.now();var y=g.length>0?g[g.length-1]:null;if("pointerup"===e.type&&(m=e.time),"pointerdown"===e.type){if(f.length>1)return void t();if(null!==x.success)return void t();if(0===g.length&&v-m<a)return void t();if(!p.includes(e.button))return void t();if(y&&y.isDown||g.length>2)return void t();if(y&&P(y.position[0],y.position[1],e.pageX,e.pageY)>l&&(t(),v-y.time<a))return;if(g.push({isDown:!0,time:v,position:[e.pageX,e.pageY],pointerId:e.pointerId}),g.length>1)clearTimeout(x.maxUntilSecondDown);else if(!r("maxUntilSecondDown",t,e.time+u))return void t();if(clearTimeout(x.fail),!r("fail",t,e.time+o))return void t()}if(y&&"pointermove"===e.type&&y.pointerId===e.pointerId&&P(y.position[0],y.position[1],e.pageX,e.pageY)>s)return void t();if(y&&"pointerup"===e.type){if(y.pointerId!==e.pointerId)return void t();if(v>=y.time+o)return void t();if(clearTimeout(x.fail),g.length<3)return r("fail",t,e.time+c)?void(g=[y,{isUp:!0,time:v,position:[e.pageX,e.pageY]}]):void t();v<g[1].time+c?(g.push({pageX:e.pageX,pageY:e.pageY}),r("success",n,e.time+h)||t()):t()}}else t()}(e),0===g.length?(t(),e):(y.push(e),null)},this.setChainOut=function(e){i=e},this.setAllowedPointerTypeArr=function(e){d=e},this.setAllowedButtonArr=function(e){p=e}},G=function(e){var t,n,r=function(){if(0!==p.length){clearTimeout(m.firstLastDownTimeout),clearTimeout(m.tapTimeout);for(var e=0;e<p.length;e++)s(p[e]);p=[],d=[]}},i=function(e,t){var i=t-n;return!(i<=0)&&(m[e]=setTimeout(r,i),!0)},a=function(a){var s=g;if(g=a.time,"pointerdown"===a.type)f.push(a.pointerId);else if("pointerup"===a.type)for(var v=0;v<f.length;v++)if(f[v]===a.pointerId){f.splice(v,1);break}if("touch"===a.pointerType){if(n=performance.now(),"pointerdown"===a.type)return d.length+1!==f.length||d.length===o||d.length>0&&a.time-u>d[0].downTime||0===d.length&&a.time-l<s?void r():0!==d.length||(t=a.time,i("firstLastDownTimeout",a.time+u)&&i("tapTimeout",a.time+c))?void d.push({pointerId:a.pointerId,downTime:a.time,downPageX:a.pageX,downPageY:a.pageY}):void r();if("pointermove"===a.type){if(0===d.length)return;for(var y=null,x=0;x<d.length;x++)if(d[x].pointerId===a.pointerId){y=d[x];break}if(null===y)return void r();if(a.time-c>t)return void r();if(P(a.pageX,a.pageY,y.downPageX,y.downPageY)>h)return void r()}if("pointerup"===a.type){if(0===d.length)return;if(d.length!==o)return void r();for(var b=null,w=0;w<d.length;w++)if(d[w].pointerId===a.pointerId){b=d[w];break}if(null===b)return;if(a.time-c>t)return void r();if(P(a.pageX,a.pageY,b.downPageX,b.downPageY)>h)return void r();b.isUp=!0;for(var C=!0,S=0;S<d.length;S++)if(!d[S].isUp){C=!1;break}if(C)return clearTimeout(m.firstLastDownTimeout),clearTimeout(m.tapTimeout),p=[],d=[],e.onTap(),!0}}else d.length>0&&r()},o=e.fingers,s=function(){},l=50,c=500,u=250,h=12,d=[],p=[],g=0,f=[],m={firstLastDownTimeout:null,tapTimeout:null};this.chainIn=function(e){return!0===a(e)?null:0===d.length?e:(p.push(e),null)},this.setChainOut=function(e){s=e}},K=function(e){var t,n=function(){d=null,p=[]},r=function(e){if(d){if(clearTimeout(g.secondFingerTimeout),!e)for(var t=0;t<p.length;t++)u(p[t]);n()}},i=function(e){if("pointerdown"===e.type)h.push(e.pointerId);else if("pointerup"===e.type)for(var i=0;i<h.length;i++)if(h[i]===e.pointerId){h.splice(i,1);break}if(d||!("touch"!==e.pointerType||"pointermove"===e.type&&h.length>0||h.length>1||"pointerup"===e.type)){if(t=performance.now(),"pointerdown"===e.type)return d?"touch"===e.pointerType?(d.touchPointerArr.push({pointerId:e.pointerId,relX:e.relX,relY:e.relY}),void(d.isInProgress?o(d,{type:"down",index:d.touchPointerArr.length-1}):(clearTimeout(g.secondFingerTimeout),d.isInProgress=!0,a(d)))):void(d.isInProgress?d.otherPointerIdArr.push(e.pointerId):r()):(d={touchPointerArr:[{pointerId:e.pointerId,relX:e.relX,relY:e.relY,downRelX:e.relX,downRelY:e.relY}],otherPointerIdArr:[],isInProgress:!1},u="secondFingerTimeout",p=function(){r()},f=e.time+c,(m=f-t)<=0||(g[u]=setTimeout(p,m),0)?void r():void 0);var u,p,f,m;if("pointermove"!==e.type||"touch"!==e.pointerType){if("pointerup"===e.type){if("touch"===e.pointerType){for(var v=0;v<d.touchPointerArr.length;v++)if(d.touchPointerArr[v].pointerId===e.pointerId){d.touchPointerArr.splice(v,1);break}d.touchPointerArr.length>0&&o(d,{type:"up",index:v})}else for(var y=0;y<d.otherPointerIdArr.length;y++)if(d.otherPointerIdArr[y]===e.pointerId){d.otherPointerIdArr.splice(y,1);break}if(0===d.touchPointerArr.length&&0===d.otherPointerIdArr.length)return void(d.isInProgress?(n(),s()):r())}}else{for(var x=null,b=0;b<d.touchPointerArr.length;b++)if(e.pointerId===d.touchPointerArr[b].pointerId){x=d.touchPointerArr[b];break}if(x.relX=e.relX,x.relY=e.relY,d.isInProgress)b<2&&o(d,{type:"move",index:b});else if(P(x.downRelX,x.downRelY,x.relX,x.relY)>l)return void r()}}},a=function(t){for(var n=0;n<t.touchPointerArr.length;n++){var r=t.touchPointerArr[n];f.push({pointerId:r.pointerId,relX:r.relX,relY:r.relY,downRelX:r.relX,downRelY:r.relY})}var i={type:"move",angleRad:0,scale:1};1===f.length?(i.relX=f[0].downRelX,i.relY=f[0].downRelY):(i.relX=.5*(f[0].downRelX+f[1].downRelX),i.relY=.5*(f[0].downRelY+f[1].downRelY)),i.downRelX=i.relX,i.downRelY=i.relY,e.onPinch(i)},o=function(t,n){if(!(n.index>1))if("move"===n.type){var r;if(f[n.index].relX=t.touchPointerArr[n.index].relX,f[n.index].relY=t.touchPointerArr[n.index].relY,1===f.length)r={type:"move",downRelX:f[0].downRelX,downRelY:f[0].downRelY,relX:f[0].relX,relY:f[0].relY,angleRad:0,scale:1};else{var i=P(f[0].downRelX,f[0].downRelY,f[1].downRelX,f[1].downRelY),o=P(f[0].relX,f[0].relY,f[1].relX,f[1].relY),l=O({x:f[0].downRelX,y:f[0].downRelY},{x:f[1].downRelX,y:f[1].downRelY}),c=O({x:f[0].relX,y:f[0].relY},{x:f[1].relX,y:f[1].relY});r={type:"move",downRelX:.5*(f[0].downRelX+f[1].downRelX),downRelY:.5*(f[0].downRelY+f[1].downRelY),relX:.5*(f[0].relX+f[1].relX),relY:.5*(f[0].relY+f[1].relY),angleRad:c-l,scale:o/i}}e.onPinch(r)}else"down"!==n.type&&"up"!==n.type||(s(),a(t))},s=function(){f=[],e.onPinch({type:"end"})},l=10,c=250,u=function(){},h=[],d=null,p=[],g={secondFingerTimeout:null},f=[];this.chainIn=function(e){return i(e),d?(d.isInProgress||p.push(e),null):e},this.setChainOut=function(e){u=e}},q=function(){var e=function(){};this.chainIn=function(t){if("pointermove"!==t.type)return t;if(!(t.coalescedArr.length>0))return t;var n,r=JSON.parse(JSON.stringify(t));r.coalescedArr=[];for(var i=0;i<t.coalescedArr.length;i++)i>0&&(r=JSON.parse(JSON.stringify(t))),n=t.coalescedArr[i],r.pageX=n.pageX,r.pageY=n.pageY,r.relX=n.relX,r.relY=n.relY,r.dX=n.dX,r.dY=n.dY,r.time=n.time,i<t.coalescedArr.length-1&&(r.isCoalesced=!0),e(r);return null},this.setChainOut=function(t){e=t}},Z=function(e){var t=null,n=[];this.chainIn=function(e){if(n.includes(e.pointerId)){if("pointerup"===e.type)for(var r=0;r<n.length;r++)if(n[r]===e.pointerId){n.splice(r,1);break}return null}return null===t?("pointerdown"===e.type&&(t=e.pointerId),e):e.pointerId!==t?("pointerdown"===e.type&&n.push(e.pointerId),null):("pointerup"===e.type&&(t=null),e)},this.setChainOut=function(e){e}},J=function(e){var t=null,n=[],r=null;this.process=function(i){if("down"===i.type&&(t=i,r=null,i.shiftIsPressed))return e.onDraw({type:"line",x0:null,y0:null,pressure0:null,x1:i.x,y1:i.y,pressure1:i.pressure}),void n.push(i);if("move"===i.type)if(i.shiftIsPressed){if(null===r){var a=Math.abs(i.x-t.x),o=Math.abs(i.y-t.y);if(a>5||o>5){r=a>o?0:1;for(var s=0;s<n.length;s++){var l=n[s];0===r?l.y=t.y:l.x=t.x,e.onDraw(JSON.parse(JSON.stringify(l)))}n=[]}}if(null===r)return void n.push(i);0===r?i.y=t.y:i.x=t.x}else if(n.length>0){for(var c=0;c<n.length;c++)e.onDraw(JSON.parse(JSON.stringify(n[c])));n=[]}"up"===i.type&&(n=[]),e.onDraw(JSON.parse(JSON.stringify(i)))}},Q=function(){var e=function(){},t=!1;this.chainIn=function(n){return"down"===n.type&&(t?e({type:"up",scale:n.scale,shiftIsPressed:n.shiftIsPressed,isCoalesced:!1}):t=!0),t||"move"!==n.type&&"up"!==n.type?("up"===n.type&&t&&(t=!1),n):null},this.setChainOut=function(t){e=t},this.getIsDrawing=function(){return t}},$=function(e){var t,n,r,i=function(){},a=B(e.smoothing,0,1);this.chainIn=function(e){if(e=JSON.parse(JSON.stringify(e)),clearTimeout(r),clearInterval(n),"down"===e.type&&(t={x:e.x,y:e.y,pressure:e.pressure}),"move"===e.type){var o=e.x,s=e.y,l=e.pressure;e.x=A(e.x,t.x,a),e.y=A(e.y,t.y,a),e.pressure=A(e.pressure,t.pressure,a),t={x:e.x,y:e.y,pressure:e.pressure},a>0&&(r=setTimeout((function(){n=setInterval((function(){(e=JSON.parse(JSON.stringify(e))).x=A(o,t.x,a),e.y=A(s,t.y,a),e.pressure=A(l,t.pressure,a),t={x:e.x,y:e.y,pressure:e.pressure},i(e)}),35)}),80))}return e},this.setChainOut=function(e){i=e},this.setSmoothing=function(e){a=B(e,0,1)}};var ee,te=function(e){var t,n=u();if(e<1){if(n.width=1,n.height=1,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(128, 128, 128)",t.fillRect(0,0,1,1)}else if(e>200)n.width=401,n.height=401;else{if(n.width=2*e,n.height=2*e,!(t=n.getContext("2d")))throw new Error("2d context not supported or canvas already initialized");t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,2*e,2*e),t.fillStyle="rgb(200, 200, 200)",t.fillRect(0,0,e,e),t.fillRect(e,e,2*e,2*e)}return n},ne=(ee={8:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC",4:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC"},function(e,t){var n=function(e){if(e=parseInt(""+e),ee[""+e])return ee[""+e];var t=te(e).toDataURL("image/png");return ee[""+e]=t,t};if(!t)return n(e);setTimeout((function(){t(n(e))}),1)});var re,ie={getIdentity:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},multiplyMatrixAndPoint:re=function(e,t){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15]]},multiplyMatrices:function(e,t){var n=[t[0],t[1],t[2],t[3]],r=[t[4],t[5],t[6],t[7]],i=[t[8],t[9],t[10],t[11]],a=[t[12],t[13],t[14],t[15]],o=re(e,n),s=re(e,r),l=re(e,i),c=re(e,a);return[o[0],o[1],o[2],o[3],s[0],s[1],s[2],s[3],l[0],l[1],l[2],l[3],c[0],c[1],c[2],c[3]]},createTranslationMatrix:function(e,t){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]},createRotationMatrix:function(e){return[Math.cos(-e),-Math.sin(-e),0,0,Math.sin(-e),Math.cos(-e),0,0,0,0,1,0,0,0,0,1]},createScaleMatrix:function(e){return[e,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]}},ae={add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},sub:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},nor:function(e){var t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));return{x:e.x/t,y:e.y/t}},len:function(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))},dist:function(e,t){return ae.len(ae.sub(e,t))},mul:function(e,t){return{x:e.x*t,y:e.y*t}},angle:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},dot:function(e,t){var n=[e.x,e.y],r=[t.x,t.y];return n.map((function(e,t){return n[t]*r[t]})).reduce((function(e,t){return e+t}))}},oe=function(e){for(var t=[],n=this,r=0;r<e.points.length;r++)!function(n){var r=void 0;n<e.points.length-1&&(r=P(e.points[n].x,e.points[n].y,e.points[n+1].x,e.points[n+1].y)),t[n]={x:e.points[n].x,y:e.points[n].y,length:r}}(r);this.getAtDist=function(e){for(var r=Math.min(n.getLength(),e),i=0;r>t[i].length&&i<t.length-2;i++)r-=t[i].length;var a=Math.min(1,Math.max(0,r/t[i].length));return{x:t[i].x*(1-a)+t[i+1].x*a,y:t[i].y*(1-a)+t[i+1].y*a}},this.getLength=function(){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].length;return e}},se=function(e){var t,n=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[];var r=e[0][0],i=e[e.length-1][0];for(e.sort((function(e,t){return e[0]-t[0]})),t=0;t<n;t++)this.xa.push(e[t][0]),this.ya.push(e[t][1]);for(this.u[0]=0,this.y2[0]=0,t=1;t<n-1;++t){var a=this.xa[t+1]-this.xa[t-1],o=(this.xa[t]-this.xa[t-1])/a,s=o*this.y2[t-1]+2;this.y2[t]=(o-1)/s;var l=(this.ya[t+1]-this.ya[t])/(this.xa[t+1]-this.xa[t])-(this.ya[t]-this.ya[t-1])/(this.xa[t]-this.xa[t-1]);this.u[t]=(6*l/a-o*this.u[t-1])/s}for(this.y2[n-1]=0,t=n-2;t>=0;--t)this.y2[t]=this.y2[t]*this.y2[t+1]+this.u[t];this.getFirstX=function(){return r},this.getLastX=function(){return i}};se.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var r=n+t>>1;this.xa[r]>e?n=r:t=r}var i=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/i,o=(e-this.xa[t])/i;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(i*i)/6},se.prototype.findX=function(e,t){for(var n=null,r=null,i=0;i<=t;i++){var a=i/t,o=this.interpolate(a);if(null!==n){var s=Math.abs(o-e);if(!(s<r))break;n=a,r=s}else n=a,r=Math.abs(o-e)}return n};a("cf2NR");I=a("hDZfO");var le=function e(t,n,r){"use strict";I.default(this,e),this.h=Math.max(0,Math.min(360,t)),this.s=Math.max(.001,Math.min(100,n)),this.v=Math.max(0,Math.min(100,r))},ce=function e(t,n,r){"use strict";I.default(this,e),this.r=Math.max(0,Math.min(255,t)),this.g=Math.max(0,Math.min(255,n)),this.b=Math.max(0,Math.min(255,r))},ue=function e(t,n,r,i){"use strict";I.default(this,e),this.c=Math.max(0,Math.min(100,t)),this.m=Math.max(0,Math.min(100,n)),this.y=Math.max(0,Math.min(100,r)),this.k=Math.max(0,Math.min(100,i))},he={_RGBtoHSV:function(e){var t=new le(0,0,0),n=e.r/255,r=e.g/255,i=e.b/255,a=Math.min(n,r,i),o=Math.max(n,r,i),s=o-a;if(t.v=o,0==s)t.h=0,t.s=0;else{t.s=s/o;var l=((o-n)/6+s/2)/s,c=((o-r)/6+s/2)/s,u=((o-i)/6+s/2)/s;n==o?t.h=u-c:r==o?t.h=1/3+l-u:i==o&&(t.h=2/3+c-l),t.h<0&&(t.h+=1),t.h>1&&(t.h-=1)}return t.h=Math.round(360*t.h),t.s=Math.round(100*t.s),t.v=Math.round(100*t.v),t},_HSVtoRGB:function(e){var t,n,r,i,a,o,s,l,c=new ce(0,0,0),u=e.h/360%1,h=e.s/100,d=e.v/100;return 0==h?(c.r=255*d,c.g=255*d,c.b=255*d):(r=d*(1-h),i=d*(1-h*((t=6*u)-(n=Math.floor(t)))),a=d*(1-h*(1-(t-n))),0==n?(o=d,s=a,l=r):1==n?(o=i,s=d,l=r):2==n?(o=r,s=d,l=a):3==n?(o=r,s=i,l=d):4==n?(o=a,s=r,l=d):(o=d,s=r,l=i),c.r=255*o,c.g=255*s,c.b=255*l,c.r=Math.round(c.r),c.g=Math.round(c.g),c.b=Math.round(c.b)),c},_CMYKtoRGB:function(e){var t=new ce(0,0,0),n=e.c/100,r=e.m/100,i=e.y/100,a=e.k/100;return t.r=1-Math.min(1,n*(1-a)+a),t.g=1-Math.min(1,r*(1-a)+a),t.b=1-Math.min(1,i*(1-a)+a),t.r=Math.round(255*t.r),t.g=Math.round(255*t.g),t.b=Math.round(255*t.b),t},_RGBtoCMYK:function(e){var t=new ue(0,0,0,0),n=e.r/255,r=e.g/255,i=e.b/255;return t.k=Math.min(1-n,1-r,1-i),t.c=(1-n-t.k)/(1-t.k),t.m=(1-r-t.k)/(1-t.k),t.y=(1-i-t.k)/(1-t.k),t.c=Math.round(100*t.c),t.m=Math.round(100*t.m),t.y=Math.round(100*t.y),t.k=Math.round(100*t.k),t},toRGB:function(e){return e instanceof ce?e:e instanceof le?this._HSVtoRGB(e):e instanceof ue?this._CMYKtoRGB(e):void 0},toHSV:function(e){return e instanceof le?e:e instanceof ce?this._RGBtoHSV(e):e instanceof ue?this._RGBtoHSV(this._CMYKtoRGB(e)):void 0},toCMYK:function(e){return e instanceof ue?e:e instanceof ce?this._RGBtoCMYK(e):e instanceof le?this._RGBtoCMYK(this._HSVtoRGB(e)):void 0},toHexString:function(e){if(e instanceof ce){var t=parseInt(""+e.r).toString(16),n=parseInt(""+e.g).toString(16),r=parseInt(""+e.b).toString(16);return 1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),1==r.length&&(r="0"+r),t+n+r}},toRgbStr:function(e){return"rgb("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+")"},toRgbaStr:function(e){return"rgba("+Math.round(e.r)+", "+Math.round(e.g)+", "+Math.round(e.b)+", "+e.a+")"},hexToRGB:function(e){e=(e=e.trim()).replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,r){return t+t+n+n+r+r}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?new ce(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):null}};var de,pe=(de=function(e){e.preventDefault();var t=!1;if(e.relatedTarget)try{e.relatedTarget.focus(),t=!0}catch(e){console.error("failed to focus")}t||e.currentTarget.blur()},function(e){e.setAttribute("tabindex","-1"),C(e,"focus",de)}),ge=[];a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var fe=function(){"use strict";function e(){I.default(this,e)}return T.default(e,null,[{key:"subscribe",value:function(t){e.listeners.includes(t)||e.listeners.push(t)}},{key:"unsubscribe",value:function(t){for(var n=0;n<e.listeners.length;n++)if(t===e.listeners[n])return void e.listeners.splice(n,1)}},{key:"emit",value:function(t){e.listeners.forEach((function(e){e(t)}))}}]),e}();fe.listeners=[],a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var me=function(){"use strict";function e(){I.default(this,e)}return T.default(e,null,[{key:"getItem",value:function(e){var t=null;try{t=localStorage.getItem(e)}catch(e){this.error=e}return t}},{key:"setItem",value:function(e,t){try{localStorage.setItem(e,t)}catch(e){this.error=e}}},{key:"removeItem",value:function(e){try{localStorage.removeItem(e)}catch(e){this.error=e}}},{key:"getError",value:function(){return this.error}}]),e}(),ve={eventUsesHighResTimeStamp:m,mouseEventHasMovement:v,hasPointerEvents:y,hasWebGl:x,getVisitor:b,isCssMinMaxSupported:w,canShareFiles:function(){return"share"in navigator&&"canShare"in navigator},insertAfter:function(e,t){e.parentNode&&e.parentNode.insertBefore(t,e.nextSibling)},loadImage:function(e,t){var n=0;!function r(){1e3!==n?e.complete?(n++,t()):setTimeout(r,1):alert("couldn't load")}()},css:k,setAttributes:function(e,t){for(var n,r=Object.keys(t),i=0;i<r.length;i++)n=r[i],e.setAttribute(n,t[n])},addClassName:function(e,t){var n=e.getAttribute("class"),r=null===n?[]:n.split(" ");r.includes(t)||(r.push(t),e.setAttribute("class",r.join(" ")))},removeClassName:function(e,t){var n=e.getAttribute("class"),r=null===n?[]:n.split(" ");if(r.includes(t)){for(var i=0;i<r.length;i++)r[i]===t&&(r.splice(i,1),i--);e.setAttribute("class",r.join(" "))}},append:function(e,t){var n=document.createDocumentFragment();t.forEach((function(e){return e?n.append(e):null})),e.append(n)},fitInto:function(e,t,n,r,i){var a=e*n,o=t*n;return a>n&&(o*=n/a,a=n),o>r&&(a*=r/o,o=r),i&&(a=Math.max(i,a),o=Math.max(i,o)),{width:a,height:o}},centerWithin:function(e,t,n,r){return{x:e/2-n/2,y:t/2-r/2}},getDate:function(){var e=new Date;return e.getFullYear()+"_"+(e.getMonth()+1).toString().padStart(2,"0")+"_"+e.getDate().toString().padStart(2,"0")+"_"+(60*e.getHours()+e.getMinutes()).toString(36).padStart(3,"0")+"_"},gcd:E,reduce:M,decToFraction:function(e){var t=e.toString().length-2,n=Math.pow(10,t);return M(e*n,n)},imageBlobToUrl:function(e){if(!e)throw new Error("blobObj is undefined or null");if(window.Blob&&e instanceof Blob)return URL.createObjectURL(e);if("Object"===e.constructor.name){var t=e;return"data:"+t.type+";"+t.encoding+","+t.data}throw new Error("unknown blob format")},dateDayDifference:function(e,t){return e=new Date(e),t=new Date(t),e.setHours(0,0,0,0),t.setHours(0,0,0,0),(t.getTime()-e.getTime())/864e5},copyObj:function(e){return JSON.parse(JSON.stringify(e))},shareCanvas:function(e){var t="image/png",n=function(){return alert("sharing not supported")};e.canvas.toBlob((function(r){if(null===r)return n(),void e.callback();try{var i=[new File([r],e.fileName,{type:t})];navigator.share({title:e.title,files:i}).then((function(e){})).catch((function(e){n()}))}catch(e){n()}e.callback()}),t)},handleClick:function(e){var t=e.target;return!!t&&(!(!["A","LABEL","INPUT"].includes(t.tagName)&&!t.allowClick)||(e.preventDefault(),!1))},createSvg:function e(t){for(var n,r=document.createElementNS("http://www.w3.org/2000/svg",t.elementType),i=Object.keys(t),a=0;a<i.length;a++)if("childrenArr"===(n=i[a]))for(var o=0;o<t.childrenArr.length;o++)r.appendChild(e(t.childrenArr[o]));else"elementType"!==n&&r.setAttribute(n,t[n]);return r},BbLog:fe,LocalStorage:me,mix:A,dist:P,distSquared:function(e,t,n,r){return Math.pow(e-n,2)+Math.pow(t-r,2)},lenSquared:function(e,t){return e*e+t*t},pointsToAngleRad:O,pointsToAngleDeg:D,clamp:B,rotate:z,rotateAround:function(e,t,n){var r=z(t.x-e.x,t.y-e.y,n);return r.x+=e.x,r.y+=e.y,r},Matrix:ie,Vec2:ae,intDxy:function(e,t,n){e.x+=t,e.y+=n;var r=Math.round(e.x),i=Math.round(e.y);return e.x-=r,e.y-=i,{dX:r,dY:i}},roundEven:function(e){if(e%1==0)return e%2==0?e:e+1;var t=Math.ceil(e),n=Math.floor(e);return t%2==0?t:n},roundUneven:function(e){if(e%1==0)return e%2==0?e+1:e;var t=Math.ceil(e),n=Math.floor(e);return t%2==1?t:n},updateBounds:function(e,t){return t?(e?(e.x1=Math.min(e.x1,t.x1),e.y1=Math.min(e.y1,t.y1),e.x2=Math.max(e.x2,t.x2),e.y2=Math.max(e.y2,t.y2)):e={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},e):e},boundsInArea:function(e,t,n){var r=Math.max(0,e.x1),i=Math.max(0,e.y1),a=Math.min(t-1,e.x2),o=Math.min(n-1,e.y2);return r>a||i>o?null:{x1:r,y1:i,x2:a,y2:o}},projectPointOnLine:function(e,t,n){if(e.x===t.x)return{x:e.x,y:n.y};var r=(t.y-e.y)/(t.x-e.x),i=e.y-r*e.x;return{x:(r*n.y+n.x-r*i)/(r*r+1),y:(r*r*n.y+r*n.x+i)/(r*r+1)}},PointLine:oe,BezierLine:function(){var e,t,n,r=this,i=[],a=0,o=null;this.add=function(r,s,l,c,u){if(!e||r!==e.x||s!==e.y)if(e={x:r,y:s},i[i.length]={x:r,y:s,spacing:l},1!==i.length){if(2===i.length)return i[0].dir=ae.nor(ae.sub(i[1],i[0])),a=l,void(o=l);var h=i[i.length-1],d=i[i.length-2],p=i[i.length-3];d.dir=ae.nor(ae.sub(h,p)),(isNaN(d.dir.x)||isNaN(d.dir.y))&&(d.dir=JSON.parse(JSON.stringify(p.dir)));var g,f,m=i[i.length-3],v=i[i.length-2],y=m,x=ae.add(m,ae.mul(m.dir,ae.dist(m,v)/4)),b=ae.sub(v,ae.mul(v.dir,ae.dist(m,v)/4)),w=v;if(c)f=function(e,t,n,r,i){for(var a,o,s=[],l=0;l<=i;l++)a=l/i,(o={}).x=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*t.x+3*(1-a)*Math.pow(a,2)*n.x+Math.pow(a,3)*r.x,o.y=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*t.y+3*(1-a)*Math.pow(a,2)*n.y+Math.pow(a,3)*r.y,s[s.length]=o;return s}(y,x,b,w,20),g=new oe({points:f});else g=new oe({points:[y,w]});for(var C=g.getLength(),S=A(o,l,B(a/C,0,1)),k=a;k<=C;k+=S){S=A(o,l,B(k/C,0,1));var E=g.getAtDist(k),M=t?D(t,E):void 0;c&&c({x:E.x,y:E.y,t:k/C,angle:M,dAngle:t?M-n:0}),t=E,n=M}c?a=k-C:(a=0,u({p1:y,p2:x,p3:b,p4:w})),o=l}else o=l},this.addFinal=function(e,t,n){if(!(i.length<2)){var a=i[i.length-2],o=i[i.length-1],s=ae.add(o,ae.sub(o,a));r.add(s.x,s.y,e,t,n)}}},SplineInterpolator:se,quadraticSplineInput:function(e,t,n){for(var r=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},i=[],a=0;a<=1;a+=n)i.push([r(a,4),r(e+Math.pow(a,2)*(t-e),4)]);return i},canvas:u,copyCanvas:function(e){var t=u(e.width,e.height),n=t.getContext("2d");if(!n)throw new Error("2d context not supported or canvas already initialized");return n.drawImage(e,0,0),t},testShouldPixelate:function(e,t,n){if(![1,-1].includes(t)||![1,-1].includes(n)||e.width%1!=0||e.height%1!=0||Math.abs(e.angleDeg)%90!=0)return!1;var r=Math.abs(e.angleDeg-90)%180==0,i=r?e.height:e.width,a=r?e.width:e.height;return(Math.abs(i)%2==0&&e.x%1==0||Math.abs(i)%2==1&&e.x%1==.5)&&(Math.abs(a)%2==0&&e.y%1==0||Math.abs(a)%2==1&&e.y%1==.5)},drawTransformedImageWithBounds:function(e,t,n,r,i){r||(r={x:0,y:0,width:t.width,height:t.height}),e.save(),i?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high"),e.translate(n.x,n.y),e.rotate(n.angleDeg/180*Math.PI),e.scale(n.width>0?1:-1,n.height>0?1:-1),e.drawImage(t,r.x,r.y,r.width,r.height,-Math.abs(n.width)/2,-Math.abs(n.height)/2,Math.abs(n.width),Math.abs(n.height)),e.restore()},drawTransformedImageOnCanvas:function(e,t,n){(n=JSON.parse(JSON.stringify(n))).center||(n.center={x:t.width/2,y:t.height/2}),n.scale||(n.scale={x:1,y:1}),n.angleDegree||(n.angleDegree=0),n.translate||(n.translate={x:0,y:0});var r=e.getContext("2d");if(!r)throw new Error("2d context not supported or canvas already initialized");r.save(),Math.abs(n.scale.x-1)>1e-6||Math.abs(n.scale.y-1)>1e-6||Math.abs(n.angleDegree%90)>1e-6?(r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high"):r.imageSmoothingEnabled=!1,r.translate(n.translate.x,n.translate.y),r.translate(n.center.x,n.center.y),r.rotate(n.angleDegree/180*Math.PI),r.scale(n.scale.x,n.scale.y),r.translate(-n.center.x,-n.center.y),r.drawImage(t,0,0,t.width,t.height),r.restore()},createCheckerCanvas:te,createCheckerDataUrl:ne,resizeCanvas:function e(t,n,r,i,a){if(n&&r&&(n!==t.width||r!==t.height))if(n=Math.max(n,1),r=Math.max(r,1),n<=t.width&&r<=t.height){i=i||u(),a=a||u();var o,s,l=function(e,t,n,r){var i={oldWidthEx:Math.round(Math.log2(e)),oldHeightEx:Math.round(Math.log2(t)),newWidthEx:Math.ceil(Math.log2(n)),newHeightEx:Math.ceil(Math.log2(r))};return i.oldWidthEx=Math.max(i.oldWidthEx,i.newWidthEx),i.oldHeightEx=Math.max(i.oldHeightEx,i.newHeightEx),i}(t.width,t.height,n,r);a.width=l.oldWidthEx>l.newWidthEx?Math.pow(2,l.oldWidthEx):n,a.height=l.oldHeightEx>l.newHeightEx?Math.pow(2,l.oldHeightEx):r,i.getContext("2d").save(),a.getContext("2d").save();var c=i,h=a;o=l.oldWidthEx,s=l.oldHeightEx;var d=h.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.globalCompositeOperation="copy",d.drawImage(t,0,0,h.width,h.height);for(var p=h.width,g=h.height;o>l.newWidthEx||s>l.newHeightEx;o--,s--){(d=c.getContext("2d")).imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.globalCompositeOperation="copy";var f=o>l.newWidthEx?p/2:p,m=s>l.newHeightEx?g/2:g;c.width=f,c.height=m,d.drawImage(h,0,0,p,g,0,0,f,m),p=f,g=m;var v=c;c=h,h=v}t.width=n,t.height=r;var y=t.getContext("2d");y.save(),y.imageSmoothingEnabled=!0,y.imageSmoothingQuality="high",y.drawImage(h,0,0,p,g,0,0,n,r),y.restore(),i.getContext("2d").restore(),a.getContext("2d").restore()}else if(n>=t.width&&r>=t.height){(i=i||u()).width=n,i.height=r;var x=i.getContext("2d");x.save(),x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(t,0,0,n,r),x.restore(),t.width=n,t.height=r,t.getContext("2d").drawImage(i,0,0)}else e(t,n,t.height,i,a),e(t,n,r,i,a)},convertToAlphaChannelCanvas:function(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=0;n<t.data.length;n+=4)0!==t.data[n+3]&&(t.data[n+3]=(t.data[n]+t.data[n+1]+t.data[n+2])/3*(t.data[n+3]/255));e.getContext("2d").putImageData(t,0,0)},freeCanvas:function(e){e.width=1,e.height=1;var t=e.getContext("2d");t&&t.clearRect(0,0,1,1)},HSV:le,RGB:ce,CMYK:ue,ColorConverter:he,testIsWhiteBestContrast:function(e){return.299*e.r+.587*e.g+.114*e.b<125},appendTextDiv:function(e,t){var n=document.createElement("div");return n.innerHTML=t,e.appendChild(n),n},clearSelection:function(){if(window.getSelection){var e=window.getSelection();e&&(e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges())}else"selection"in document&&document.selection.empty()},makeUnfocusable:pe,el:function(e){var t=document.createElement(e.tagName?e.tagName:"div");e.css&&k(t,e.css),e.content&&("string"==typeof e.content?t.innerHTML=e.content:Array.isArray(e.content)?ve.append(t,e.content):t.appendChild(e.content)),e.textContent&&(t.textContent=e.textContent),e.className&&(t.className=e.className),e.id&&(t.id=e.id),e.parent&&e.parent.appendChild(t),"title"in e&&void 0!==e.title&&(t.title=e.title);var n=[];if("onClick"in e&&(C(t,"click",e.onClick),n.push(["click",e.onClick])),"onChange"in e&&(C(t,"change",e.onChange),n.push(["change",e.onChange])),n.length>0&&ge.push({el:t,listeners:n}),"custom"in e)for(var r=Object.keys(e.custom),i=0;i<r.length;i++)t.setAttribute(r[i],e.custom[r[i]]);return t},destroyEl:function(e){for(var t=0;t<ge.length;t++){var n=ge[t];if(n.el===e)return n.listeners.forEach((function(t){e.removeEventListener(t[0],t[1])})),void ge.splice(t,1)}},isInputFocused:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName);return e?t:t&&!document.activeElement.getAttribute("data-ignore-focus")},addEventListener:C,removeEventListener:S,setEventListener:function(e,t,n){y||(t=t.replace("pointer","mouse")),e[t]=n},KeyListener:L,PointerListener:U,sameKeys:function(e,t){return e.split("+").sort().join("+")===t.split("+").sort().join("+")},EventChain:Y};a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var ye=!1,xe=function(){"use strict";function e(){I.default(this,e)}return T.default(e,[{key:"pause",value:function(e){}},{key:"addListener",value:function(e){}},{key:"push",value:function(e){}},{key:"undo",value:function(){return[]}},{key:"redo",value:function(){return[]}},{key:"getAll",value:function(){return[]}},{key:"canRedo",value:function(){return!1}},{key:"canUndo",value:function(){return!1}},{key:"getState",value:function(){return 0}},{key:"getActionNumber",value:function(){return 0}}]),e}(),be=function(){"use strict";function e(){if(I.default(this,e),this.max=20,ye)throw new Error("klHistory already instantiated");ye=!0,this.state=0,this.dataArr=[],this.listeners=[],this.pauseStack=0,this.maxState=-1,this.actionNumber=-1}return T.default(e,[{key:"broadcast",value:function(e){var t=this;setTimeout((function(){for(var n=0;n<t.listeners.length;n++)t.listeners[n](e);t.state++}),1)}},{key:"pause",value:function(e){!1===e?this.pauseStack=Math.max(0,this.pauseStack-1):this.pauseStack++}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"push",value:function(e){if(!(this.pauseStack>0)){for(;this.actionNumber<this.dataArr.length-1;)this.dataArr.pop();var t=this.dataArr[this.dataArr.length-1];if("layerOpacity"===e.action&&t&&"layerOpacity"===t.action&&t.params[0]===e.params[0])return this.dataArr[this.dataArr.length-1]=e,void this.state++;if("focusLayer"===e.action&&t&&"focusLayer"===t.action)return this.dataArr[this.dataArr.length-1]=e,void this.state++;this.dataArr[this.dataArr.length]=e,this.actionNumber=this.dataArr.length-1;var n=this.maxState;this.maxState=Math.max(this.maxState,this.actionNumber-this.max),n<this.maxState?this.broadcast({bufferUpdate:this.dataArr[this.maxState]}):this.broadcast(null),this.maxState>=0&&(this.dataArr[this.maxState]=null)}}},{key:"undo",value:function(){var e;if(this.canUndo()){e=[];for(var t=this.maxState+1;t<this.actionNumber;t++)e.push(this.dataArr[t]);this.actionNumber--,this.broadcast(null)}return e}},{key:"redo",value:function(){var e=[];return this.canRedo()&&(this.actionNumber++,e.push(this.dataArr[this.actionNumber]),this.broadcast(null)),e}},{key:"getAll",value:function(){return[].concat(this.dataArr)}},{key:"canRedo",value:function(){return this.actionNumber<this.dataArr.length-1}},{key:"canUndo",value:function(){return this.actionNumber>this.maxState}},{key:"getState",value:function(){return this.state}},{key:"getActionNumber",value:function(){return this.actionNumber+1}}]),e}(),we=new be;a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var Ce,Se=new(function(){"use strict";function e(){I.default(this,e),this.listeners=[],this.count=0}return T.default(e,[{key:"emit",value:function(){var e=this;this.listeners.forEach((function(t){t(e.count)}))}},{key:"increase",value:function(e){void 0!==e?this.count+=e:this.count++,this.emit()}},{key:"decrease",value:function(e){void 0!==e?this.count-=e:this.count--,this.emit()}},{key:"get",value:function(){return this.count}},{key:"subscribe",value:function(e){this.listeners.push(e)}}]),e}());Ce=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("h8axR");var ke;ke=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("ePsJo");var Ee=a("cf2NR");a("cf2NR");s=a("5atYG");var Me=t(JSON.parse('{"switch-ui-left-right":"Switch left/right UI","toggle-show-tools":"Show/Hide Tools","scroll":"Scroll","donate":"Donate","home":"Home","modal-new-tab":"Open in new tab","tab-layers":"Layers","tab-edit":"Edit","tab-file":"File","tool-brush":"Brush","tool-paint-bucket":"Paint Bucket","tool-shape":"Shape","tool-text":"Text","tool-hand":"Hand Tool","tool-zoom":"Zoom","tool-undo-redo":"Undo / Redo","undo":"Undo","redo":"Redo","brush-pen":"Pen","brush-blend":"Blend","brush-sketchy":"Sketchy","brush-pixel":"Pixel","brush-chemy":"Chemy","brush-smudge":"Smudge","brush-size":"Size","brush-blending":"Blending","brush-toggle-pressure":"Toggle Pressure Sensitivity","brush-lock-alpha":"Lock Alpha","brush-lock-alpha-title":"Locks layer\'s alpha channel","brush-pen-circle":"Circle","brush-pen-chalk":"Chalk","brush-pen-calligraphy":"Calligraphy","brush-pen-square":"Square","brush-sketchy-scale":"Scale","brush-pixel-dither":"Dither","brush-chemy-fill":"Fill","brush-chemy-stroke":"Stroke","brush-chemy-mirror-x":"Horizontal Symmetry","brush-chemy-mirror-y":"Vertical Symmetry","brush-chemy-gradient":"Gradient","brush-eraser-transparent-bg":"Transparent Background","stabilizer":"Stabilizer","stabilizer-title":"Stroke Stabilizer","eyedropper":"Eyedropper","secondary-color":"Secondary Color","manual-color-input":"Manual Color Input","mci-hex":"Hex","mci-copy":"Copy","modal-ok":"Ok","modal-cancel":"Cancel","modal-close":"Close","layers-active-layer":"Active Layer","layers-layer":"Layer","layers-copy":"copy","layers-blending":"Blending","layers-new":"New Layer","layers-remove":"Remove Layer","layers-duplicate":"Duplicate Layer","layers-merge":"Merge with layer below","layers-rename":"Rename","layers-blend-normal":"normal","layers-blend-darken":"darken","layers-blend-multiply":"multiply","layers-blend-color-burn":"color burn","layers-blend-lighten":"lighten","layers-blend-screen":"screen","layers-blend-color-dodge":"color dodge","layers-blend-overlay":"overlay","layers-blend-soft-light":"soft light","layers-blend-hard-light":"hard light","layers-blend-difference":"difference","layers-blend-exclusion":"exclusion","layers-blend-hue":"hue","layers-blend-saturation":"saturation","layers-blend-color":"color","layers-blend-luminosity":"luminosity","layers-rename-title":"Rename Layer","layers-rename-name":"Name","layers-rename-clear":"Clear Name","layers-rename-sketch":"Sketch","layers-rename-colors":"Colors","layers-rename-lines":"Lines","layers-rename-foreground":"Foreground","layers-merge-modal-title":"Merge/Mix Layers","layers-merge-description":"Merges the selected layer with the one underneath. Select the mix mode:","file-no-autosave":"No autosave, no cloud storage","file-new":"New","file-import":"Import","file-save":"Save","file-save-png":"Save PNG","file-save-psd":"Save PSD","file-save-layers":"Save Layers","file-copy":"Copy","file-copy-title":"Copy To Clipboard","file-share":"Share","file-storage":"Browser Storage","file-storage-thumb-title":"Restores when reopening page","file-storage-about":"About Browser Storage","file-storage-cant-access":"Can\'t access","file-storage-empty":"Empty","file-storage-store":"Store","file-storage-clear":"Clear","file-storage-storing":"Storing","file-storage-overwrite":"Overwrite","file-storage-min-ago":"{x}min ago","file-storage-hours-ago":"{x}h ago","file-storage-days-ago":"{x}d ago","file-storage-month-ago":"> 1month ago","file-storage-restored":"Restored from Browser Storage","file-storage-stored":"Stored to Browser Storage","file-storage-failed":"Failed to store to Browser Storage","file-storage-failed-1":"Failed to store. Possible causes:","file-storage-failed-2":"Out of disk space","file-storage-failed-3":"Storage disabled in incognito tab","file-storage-failed-4":"Browser doesn\'t support storage","file-storage-failed-clear":"Failed to clear.","file-upload":"Upload","cleared-layer":"Cleared layer","filled":"Filled","new-title":"New Image","new-current":"Current","new-fit":"Fit","new-oversize":"Oversize","new-square":"Square","new-landscape":"Landscape","new-portrait":"Portrait","new-screen":"Screen","new-video":"Video","new-din-paper":"DIN Paper","new-px":"px","new-ratio":"Ratio","upload-title":"Upload to Imgur","upload-link-notice":"Anyone with the link to your uploaded image will be able to view it.","upload-name":"Title","upload-title-untitled":"Untitled","upload-caption":"Caption","upload-tos":"Terms of Service","upload-tos-2":"for imgur.com","upload-submit":"Upload","upload-uploading":"Uploading...","upload-success":"Upload Successful","upload-failed":"Upload failed.","upload-delete":"To delete your image from Imgur visit:","cropcopy-title-copy":"Copy To Clipboard","cropcopy-title-crop":"Crop","cropcopy-btn-copy":"To Clipboard","cropcopy-copied":"Copied.","cropcopy-btn-crop":"Apply Crop","crop-drag-to-crop":"Drag to crop","filter-crop-extend":"Crop/Extend","filter-flip":"Flip","filter-perspective":"Perspective","filter-resize":"Resize","filter-rotate":"Rotate","filter-transform":"Transform","filter-bright-contrast":"Bright/Contrast","filter-curves":"Curves","filter-hue-sat":"Hue/Saturation","filter-invert":"Invert","filter-tilt-shift":"Tilt Shift","filter-to-alpha":"To Alpha","filter-triangle-blur":"Triangle Blur","filter-unsharp-mask":"Unsharp Mask","filter-crop-title":"Crop / Extend","filter-crop-description":"Crop or extend the image.","filter-crop-left":"Left","filter-crop-right":"Right","filter-crop-top":"Top","filter-crop-bottom":"Bottom","filter-crop-rule-thirds":"Rule of Thirds","filter-crop-fill":"Fill","filter-flip-title":"Flip","filter-flip-description":"Flips layer or whole image.","filter-flip-horizontal":"Horizontal","filter-flip-vertical":"Vertical","filter-flip-image":"Flip Image","filter-flip-layer":"Flip Layer","filter-perspective-title":"Perspective","filter-perspective-description":"Transforms the selected layer.","filter-perspective-before":"Before","filter-perspective-after":"After","filter-resize-title":"Resize","filter-resize-description":"Resizes the image.","filter-rotate-title":"Rotate","filter-rotate-description":"Rotates the image.","filter-transform-empty":"Layer is empty.","filter-transform-title":"Transform","filter-transform-description":"Transforms selected layer. Hold Shift for additional behavior.","filter-transform-rotation":"Rotation","filter-transform-flip":"Flip","filter-transform-center":"Center","filter-transform-constrain":"Constrain","filter-transform-snap":"Snap","filter-transform-snap-title":"Snap Rotation And Position","filter-bright-contrast-title":"Brightness / Contrast","filter-bright-contrast-description":"Change brightness and contrast for the selected layer.","filter-bright-contrast-brightness":"Brightness","filter-bright-contrast-contrast":"Contrast","filter-curves-title":"Curves","filter-curves-description":"Apply curves on the selected layer.","filter-curves-all":"All","filter-hue-sat-title":"Hue / Saturation","filter-hue-sat-description":"Change hue and saturation for the selected layer.","filter-hue-sat-hue":"Hue","filter-hue-sat-saturation":"Saturation","filter-applied":"applied","filter-tilt-shift-title":"Tilt Shift","filter-tilt-shift-description":"Applies tilt shift on the selected layer.","filter-tilt-shift-blur":"Blur Radius","filter-tilt-shift-gradient":"Gradient Radius","filter-to-alpha-title":"To Alpha","filter-to-alpha-description":"Generates alpha channel for selected layer from:","filter-to-alpha-inverted-lum":"Inverted Luminance","filter-to-alpha-lum":"Luminance","filter-to-alpha-replace":"Replace RGB","filter-triangle-blur-title":"Triangle Blur","filter-triangle-blur-description":"Applies triangle blur on the selected layer.","filter-unsharp-mask-title":"Unsharp Mask","filter-unsharp-mask-description":"Sharpens the selected layer by scaling pixels away from the average of their neighbors.","filter-unsharp-mask-strength":"Strength","import-opening":"Opening file...","import-title":"Import Image","import-too-large":"Image too large, will be downscaled.","import-btn-as-layer":"As Layer","import-btn-as-image":"As Image","import-as-layer-title":"Import Image as New Layer","import-as-layer-description":"Adjust the position of the imported image.","import-as-layer-limit-reached":"Layer limit reached. Image will be placed on existing layer.","import-as-layer-fit":"Fit","import-flatten":"Flatten image","import-unsupported-file":"Unsupported file type. See Help for supported types.","import-broken-file":"Couldn\'t load image. File might be corrupted.","import-psd-unsupported":"Unsupported features. PSD had to be flattened.","import-psd-limited-support":"PSD support is limited. Flattened will more likely look correct.","import-psd-too-large":"Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.","import-psd-size":"Image size","hand-reset":"Reset","hand-fit":"Fit","bucket-tolerance":"Tolerance","bucket-sample":"Sample","bucket-sample-title":"Which layers to sample color from","bucket-sample-all":"All","bucket-sample-active":"Active","bucket-sample-above":"Above","bucket-grow":"Grow","bucket-grow-title":"Grow filled area (in pixels)","bucket-contiguous":"Contiguous","bucket-contiguous-title":"Only fill connected areas","shape-stroke":"Stroke","shape-fill":"Fill","shape-rect":"Rectangle","shape-ellipse":"Ellipse","shape-line":"Line","shape-line-width":"Line Width","shape-outwards":"Outwards","shape-fixed":"Fixed 1:1","shape-snap":"Snap","shape-snap-title":"45 Angle Snapping","text-instruction":"Click canvas to place text","text-title":"Add Text","text-placeholder":"Your text (multiline Shift+Enter)","text-color":"Color","text-size":"Size","text-left":"Left","text-center":"Center","text-right":"Right","text-italic":"Italic","text-bold":"Bold","save-reminder-title":"Unsaved Work","save-reminder-text":"Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.","save-reminder-save-psd":"Save As PSD","save-reminder-psd-layers":"PSD will remember all layers.","submit":"Submit","submit-title":"Submit Drawing","submit-prompt":"Submit drawing?","submit-submitting":"Submitting","embed-init-loading":"Loading app","embed-init-waiting":"Waiting for image","unsaved":"Unsaved","help":"Help","tab-settings":"Settings","settings-language":"Language","settings-preferred-language":"Preferred Language","settings-language-reload":"Will update after reloading.","licenses":"Licenses","source-code":"Source Code","auto":"auto","zoom-in":"Zoom In","zoom-out":"Zoom Out","radius":"Radius","constrain-proportions":"Constrain Proportions","width":"Width","height":"Height","opacity":"Opacity","red":"Red","green":"Green","blue":"Blue","eraser":"Eraser","center":"Center","background":"Background","scaling-algorithm":"Scaling Algorithm","algorithm-smooth":"Smooth","algorithm-pixelated":"Pixelated","preview":"Preview"}')),Ie=[{code:"en",name:"English"},{code:"de",name:"Deutsch"},{code:"ja",name:""},{code:"zh-CN",name:""},{code:"zh-TW",name:""}],Te=s.default(t(l).mark((function e(n){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("en"!==n){e.next=4;break}return e.abrupt("return",Me);case 4:if("de"!==n){e.next=10;break}return e.next=7,a("1CRVs");case 7:case 13:case 19:case 25:return e.abrupt("return",e.sent);case 10:if("ja"!==n){e.next=16;break}return e.next=13,a("64Sid");case 16:if("zh-CN"!==n){e.next=22;break}return e.next=19,a("1NHNA");case 22:if("zh-TW"!==n){e.next=26;break}return e.next=25,a("d0m5g");case 26:throw new Error("unknown language code");case 27:case"end":return e.stop()}}),e)}))),Re="klecks-language",Le=function(){"use strict";function e(){Ee.classCallCheck(this,e),this.listeners=[],this.data=Ee.objectSpread({},Me),this.code="en"}return Ee.createClass(e,[{key:"setLanguage",value:function(e){return Ee.asyncToGenerator(t(l).mark((function n(){return t(l).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("en"!==e){t.next=4;break}this.data=Ee.objectSpread({},Me),t.next=11;break;case 4:return t.t0=Ee,t.t1={},t.t2=Me,t.next=9,Te(e);case 9:t.t3=t.sent,this.data=t.t0.objectSpread.call(t.t0,t.t1,t.t2,t.t3);case 11:this.code=e,document.documentElement.setAttribute("lang",e),this.listeners.forEach((function(e){e()}));case 14:case"end":return t.stop()}}),n,this)})).bind(this))()}},{key:"get",value:function(e){if(!(e in this.data))throw new Error("translation code doesn't exist: "+e);return this.data[e]}},{key:"getLanguage",value:function(){var e=this;return Ie.find((function(t){return t.code===e.code}))}},{key:"getCode",value:function(){return this.code}},{key:"subscribe",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return void this.listeners.splice(t,1)}}]),e}(),Ae="en",Pe=function(e){var t=Oe[e],n=Ie.find((function(e){return e.code.toLowerCase()===t.toLowerCase()}));if(n)return Ae=n.code,"break"},Oe=[];(navigator.languages?navigator.languages:[navigator.language]).forEach((function(e){var t=e.split("-");Oe.push(e),2===t.length&&Oe.push(t[0])}));try{localStorage.getItem(Re)&&Oe.unshift(localStorage.getItem(Re))}catch(e){}Oe.splice(0),Oe.push("zh-TW");for(var De=0;De<Oe.length;De++){if("break"===Pe(De))break}var Be=new Le,ze=function(e,t){if(t){var n=Be.get(e);return Object.keys(t).forEach((function(e){n=n.replace("{".concat(e,"}"),t[e])})),n}return Be.get(e)};function je(e){var n=function(t){if(!r){r=!0,ve.clearSelection();var n=ve.el({parent:document.body,tagName:"input",css:{opacity:"0",width:"0",height:"0"}});setTimeout((function(){n.select(),n.focus(),n.parentNode.removeChild(n)}),10),i.parentNode.removeChild(i),Se.decrease(),ve.destroyEl(l),ve.destroyEl(s),h.destroy(),ve.removeEventListener(a,"wheel",d),a.onclick=null,m.forEach((function(e){ve.destroyEl(e)})),m.splice(0,m.length),e.callback&&e.callback(t)}};Se.increase();var r=!1,i=ve.el({parent:e.target||document.body,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",overflow:"hidden"}}),a=ve.el({parent:i,className:"kl-popup"}),o=ve.el({parent:a,css:{width:"100%",minHeight:"100%",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}}),s=ve.el({parent:o,onClick:function(){e.ignoreBackground||n("Cancel")},css:{position:"absolute",left:"0",top:"0",zIndex:"0",width:"100%",height:"100%"}}),l=ve.el({tagName:"button",className:"popup-x",content:'<img alt="'.concat(ze("modal-close"),'" height="20" src="').concat(t(ke),'">'),title:ze("modal-close"),onClick:function(){n("Cancel")},css:{width:"40px",height:"40px",lineHeight:"40px",position:"absolute",right:"0",top:"0",background:"none",boxShadow:"none"}}),c=["kl-popup-box"];c.push("kl-popup-box--sm");var u=ve.el({content:[l,ve.el({content:e.message,css:{marginBottom:e.div?"10px":null,marginRight:"15px"}}),e.div],className:c.join(" "),css:e.style?e.style:null});o.append(ve.el({css:{flex:"0.5"}}),u,ve.el({css:{flex:"1"}})),"error"===e.type&&ve.addClassName(u,"poperror"),"ok"===e.type&&ve.addClassName(u,"popok"),"warning"===e.type&&ve.addClassName(u,"popwarning"),"upload"===e.type&&ve.addClassName(u,"popupload");var h=new ve.KeyListener({onDown:function(e,t,i){r||(g&&"enter"===i&&!ve.isInputFocused()&&(t.stopPropagation(),setTimeout((function(){g.click()}),10)),"esc"===i&&(t.stopPropagation(),n("Cancel")))}}),d=function(e){h.isPressed("ctrl")&&e.preventDefault()};ve.addEventListener(a,"wheel",d),a.onclick=ve.handleClick;var p=null;p=e.autoFocus?e.autoFocus:!1===e.autoFocus?null:"Ok";var g,f=e.buttons&&e.buttons.length>0?ve.el({parent:u,css:{display:"flex",flexWrap:"wrap",justifyContent:"flex-end",marginTop:"12px",marginLeft:"-8px"}}):null,m=[];e.buttons&&e.buttons.forEach((function(r){var i,o=["kl-popup__btn"];("Ok"===r||e.primaries&&e.primaries.includes(r))&&o.push("kl-button-primary");var s=r;"Ok"===r&&(s=ze("modal-ok"),i=t(Ce)),"Cancel"===r&&(s=ze("modal-cancel"),i=t(ke));var l=null;i&&(l=ve.el({tagName:"img",custom:{src:i,height:"17"}}));var c=ve.el({parent:f,tagName:"button",className:o.join(" "),content:[l,s],onClick:function(){n(r)}});m.push(c),p===r&&(setTimeout((function(){c.focus(),a.scrollTo(0,0)}),10),setTimeout((function(){a.scrollTo(0,0)}),20)),r===e.clickOnEnter&&(g=c)})),e.closefunc&&e.closefunc((function(){n("Cancel")}))}window.onscroll=function(e){e.preventDefault()};var He=function(e){var n=function(){Se.decrease(),a.onclick=null,i.removeChild(a),clearInterval(undefined),window.removeEventListener("resize",r),h.destroy(),ve.destroyEl(c),ve.destroyEl(o),e.onClose&&e.onClose()},r=function(){var t=e.target?e.target.clientWidth||e.target.offsetWidth:window.innerWidth,n=e.target?e.target.clientHeight||e.target.offsetHeight:window.innerHeight,r=s.offsetWidth,i=s.offsetHeight;ve.css(s,{left:Math.max(0,(t-r)/2)+"px",top:Math.max(20,(n-i)/2-.2*i)+"px"})};Se.increase();var i=e.target||document.body,a=ve.el({parent:i,css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0",background:"rgba(0, 0, 0, 0.45)",overflow:"auto",animationName:"consoleIn",animationDuration:"0.3s",animationTimingFunction:"ease-out"}});a.onclick=ve.handleClick;var o=ve.el({parent:a,css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"},onClick:n}),s=ve.el({parent:a,css:{position:"absolute",width:ve.isCssMinMaxSupported()?"min(calc(100% - 40px), "+(e.width?e.width:400)+"px)":(e.width?e.width:400)+"px",height:"calc(100% - 40px)",background:"#eee",borderRadius:"10px",overflow:"hidden",boxShadow:"rgba(0, 0, 0, 0.25) 0px 5px 60px"}});r(),window.addEventListener("resize",r);var l=ve.el({parent:s,css:{height:"40px",display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"20px"}});e.title&&l.appendChild(e.title);var c=ve.el({parent:l,tagName:"button",className:"popup-x",content:'<img alt="'.concat(ze("modal-close"),'" height="20" src="').concat(t(ke),'">'),title:ze("modal-close"),onClick:n,css:{width:"40px",height:"40px",lineHeight:"40px",background:"none",boxShadow:"none"},custom:{tabindex:"0"}}),u=ve.el({parent:s,css:{height:"calc(100% - 40px)"}});e.content&&u.appendChild(e.content);var h=new ve.KeyListener({onDown:function(e,t){"esc"===e&&(t.stopPropagation(),n())}});this.close=function(){n()}};a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var Fe=function(){"use strict";function e(t){var n=this;I.default(this,e),this.element=ve.el({className:"kl-checkbox"});var r=ve.el({parent:this.element,tagName:"label",className:"kl-checkbox__inner"});this.check=ve.el({parent:r,tagName:"input",css:{marginLeft:"0",display:"inline-block"},custom:{type:"checkbox"}}),this.check.checked=t.init,t.doHighlight&&this.check.checked&&ve.addClassName(this.element,"kl-checkbox--highlight"),t.allowTab||(this.check.tabIndex=-1),t.title&&(r.title=t.title);var i=document.createElement("div");i.style.display="inline-block",i.innerHTML=t.label,i.allowClick=!0,r.appendChild(i),this.check.onchange=function(){var e=n;t.doHighlight&&(n.check.checked?ve.addClassName(n.element,"kl-checkbox--highlight"):ve.removeClassName(n.element,"kl-checkbox--highlight")),t.callback(n.check.checked),setTimeout((function(){e.check.blur()}),0)},t.css&&ve.css(this.element,t.css)}return T.default(e,[{key:"getValue",value:function(){return this.check.checked}},{key:"getElement",value:function(){return this.element}},{key:"destroy",value:function(){this.check.onchange=null}}]),e}(),Ne=function(e){var t=document.createElement("input");if(e.type)try{t.type=e.type}catch(e){}else t.type="text";return void 0!==e.min&&(t.min=""+e.min),void 0!==e.max&&(t.max=""+e.max),t.value=""+e.init,e.callback&&(t.onchange=function(){e.callback(t.value)}),e.css&&ve.css(t,e.css),t};a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var _e,Xe=function(){"use strict";function e(t){var n=this;I.default(this,e),this.destroy=function(){n.selectEl.removeEventListener("change",n.changeListener)},this.selectEl=ve.el({tagName:"select",title:t.title,css:{cursor:"pointer",fontSize:"15px",padding:"3px",background:"#fff",colorScheme:"only light"}}),t.css&&ve.css(this.selectEl,t.css);var r=t.isFocusable;r||(this.selectEl.tabIndex=-1),this.optionArr=t.optionArr;for(var i=0;i<this.optionArr.length;i++)if(null!==this.optionArr[i]){var a=document.createElement("option");a.value=this.optionArr[i][0],a.textContent=this.optionArr[i][1],this.selectEl.append(a)}this.onChange=t.onChange,this.changeListener=function(e){r||n.selectEl.blur(),n.onChange(n.selectEl.value)},this.selectEl.addEventListener("change",this.changeListener),this.selectEl.value="initValue"in t?t.initValue:null}return T.default(e,[{key:"setValue",value:function(e){this.selectEl.value=e}},{key:"getValue",value:function(){return this.selectEl.value}},{key:"setDeltaValue",value:function(e){for(var t=0,n=0;n<this.optionArr.length;n++)if(""+this.optionArr[n][0]===this.selectEl.value){t=n;break}t=Math.max(0,Math.min(this.optionArr.length-1,t+e)),this.selectEl.value=this.optionArr[t][0],this.onChange(this.selectEl.value)}},{key:"getElement",value:function(){return this.selectEl}}]),e}(),Ue=function(e){var t=function(){n?ve.addClassName(r,"image-toggle-active"):ve.removeClassName(r,"image-toggle-active")},n=!!e.initValue,r=ve.el({className:"image-toggle",title:e.title,css:{backgroundImage:"url('"+e.image+"')"},onClick:function(r){r.preventDefault(),e.isRadio&&n||(n=!n,t(),e.onChange(n))}});t(),this.setValue=function(e){n=!!e,t()},this.getElement=function(){return r},this.getValue=function(){return n},this.destroy=function(){ve.destroyEl(r)}},Ye=function(e){for(var t,n=function(n,a){a.id===e.initId&&(t=n);var o=new Ue({image:a.image,title:a.title,initValue:a.id===e.initId,isRadio:!0,onChange:function(){!function(n,r){t=n;for(var a=0;a<i.length;a++)i[a].setValue(a===t);e.onChange(r)}(n,a.id)}});return r.appendChild(o.getElement()),o},r=ve.el({className:"image-radio-wrapper",css:{display:"flex"}}),i=[],a=0;a<e.optionArr.length;a++)i.push(n(a,e.optionArr[a]));this.getElement=function(){return r},this.getValue=function(){return e.optionArr[t].id},this.destroy=function(){i.forEach((function(e){e.destroy()}))}};_e=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("kgT8h");var We,Ve=function(e,n){var r=function(){e?ve.css(i,{backgroundColor:"#fff",opacity:"0.9",border:"1px solid var(--active-highlight-color)"}):ve.css(i,{backgroundColor:"transparent",opacity:"0.5",border:"1px solid #666"})},i=ve.el({css:{cssFloat:"right",borderRadius:"3px",width:"18px",height:"18px",backgroundImage:'url("'+t(_e)+'")',backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer",boxSizing:"border-box",colorScheme:"only light"}});return ve.hasPointerEvents||(i.style.display="none"),i.title=ze("brush-toggle-pressure"),i.onclick=function(){e=!e,r(),n(e)},r(),n(e),i},Ge=function(e,t){var n=Math.min(10,1+Math.pow(Math.floor(e/50),2));return t&&(n*=2),1/n},Ke=function(e){var t,n=function(e){return u?t.findX(e,Math.floor(1.5*p)):(e-g)/(f-g)},r=function(){c?ve.css(w,{opacity:null,pointerEvents:null}):ve.css(w,{opacity:"0.5",pointerEvents:"none"})},i=function(){var e=g+M*(f-g);return u&&(e=t.interpolate(M)),e},a=function(){var e=function(e){var n=g+e*(f-g);return u&&(n=t.interpolate(e)),n}(M);e=(e=y?y(e):parseInt(e)).toLocaleString(Be.getCode()),S.innerHTML=C+'&nbsp;&nbsp;<span style="font-weight:bold">'+e+"</span>",k.style.width=M*h+"px"},o=function(e){if(e||!v)if(x&&!e){var t=performance.now();t-L>=x&&(L=t,m(i()))}else m(i())},s=function(e){if(e.eventPreventDefault(),c){if("pointerdown"===e.type&&(w.className="sliderWrapper sliderWrapperActive","left"===e.button&&(M=e.relX/h,M=Math.max(0,Math.min(1,M)),a(),o(!1)),T=M),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=e.dX,n=Math.abs(e.pageY-e.downPageY);t*=Ge(n,"right"===e.button),T+=t/=h,M=Math.max(0,Math.min(1,T)),a(),o(!1)}"pointerup"===e.type&&(w.className="sliderWrapper",o(!0))}},l=this,c=!1!==e.isEnabled,u=!!e.curve;if(!e.label||!e.onChange)throw"PcSlider missing params";if(!(0==e.min||0==e.max||0==e.initValue||e.min&&e.max&&e.initValue))throw"PcSlider broken params";if(e.min>=e.max)throw"PcSlider broken params";var h=e.width,d=e.height,p=e.resolution?e.resolution:h,g=e.min,f=e.max,m=e.onChange,v=!!e.isChangeOnFinal,y=e.formatFunc,x=e.eventResMs;if(u){var b="quadratic"===e.curve?ve.quadraticSplineInput(g,f,.1):e.curve;t=new ve.SplineInterpolator(b)}var w=ve.el({className:"sliderWrapper",css:{overflow:"hidden",position:"relative",width:h+"px",height:d+"px",userSelect:"none"}}),C=e.label,S=document.createElement("div"),k=document.createElement("div"),E=document.createElement("div"),M=n(e.initValue);w.appendChild(k),w.appendChild(S),k.appendChild(E),k.className="sliderInner",w.oncontextmenu=function(){return!1},S.innerHTML=C,k.style.position="absolute",k.style.left="0",k.style.top="0",k.style.width=M*h+"px",k.style.height=d+"px";var I=d-14;ve.css(S,{position:"absolute",left:"7px",top:d/2-I/2+1+"px",lineHeight:I+"px",fontSize:I+"px",pointerEvents:"none"}),r();var T,R,L=0,A=setTimeout((function(){R=new ve.PointerListener({target:w,maxPointers:1,fixScribble:!0,onPointer:s,onWheel:function(e){u?(M+=-e.deltaY*(t.getLastX()-t.getFirstX())/40,M=Math.max(t.getFirstX(),Math.min(t.getLastX(),M))):(M+=-e.deltaY/40,M=Math.max(0,Math.min(1,M))),a(),m(i())}}),a()}),1);this.increaseValue=function(e){M=Math.min(1,M+Math.abs(e)),a(),m(i())},this.decreaseValue=function(e){M=Math.max(0,M-Math.abs(e)),a(),m(i())},this.setValue=function(e){M=n(e),a()},this.getValue=function(){return i()},this.update=function(e){if(g=e.min,f=e.max,u=!!e.curve){var n="quadratic"===e.curve?ve.quadraticSplineInput(g,f,.1):e.curve;t=new ve.SplineInterpolator(n)}else t=null;l.setIsEnabled(!e.isDisabled)},this.setIsEnabled=function(e){c=!!e,r()},this.destroy=function(){clearTimeout(A),R&&R.destroy()},this.getElement=function(){return w}};We=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("kHZ5B");var qe,Ze=function(e){var n=function(e,t){var n={},o=ve.el({css:{display:"flex",alignItems:"center",marginTop:"5px"}}),s=ve.el({content:e,css:{width:"60px"}}),c=Ne({init:r[t],min:0,max:255,type:"number",css:{width:"80px"},callback:function(){""===c.value||parseFloat(c.value)<0||parseFloat(c.value)>255?n.update():(c.value=""+Math.round(parseFloat(c.value)),r[t]=c.value,a.style.background="#"+ve.ColorConverter.toHexString(r),l.value="#"+ve.ColorConverter.toHexString(r))}});return o.appendChild(s),o.appendChild(c),i.appendChild(o),n.update=function(){c.value=r[t]},n.destroy=function(){c.onchange=null},n},r=new ve.RGB(e.color.r,e.color.g,e.color.b),i=ve.el({}),a=ve.el({css:{width:"20px",height:"20px",marginBottom:"10px",boxShadow:"inset 0 0 0 1px #fff, 0 0 0 1px #000",background:"#"+ve.ColorConverter.toHexString(r),colorScheme:"only light"}});i.appendChild(a);var o=ve.el({css:{display:"flex",alignItems:"center",marginBottom:"15px"}}),s=ve.el({content:ze("mci-hex"),css:{width:"60px"}}),l=Ne({init:"#"+ve.ColorConverter.toHexString(r),css:{width:"80px"},callback:function(){var e=ve.ColorConverter.hexToRGB(l.value);null===e?(e=r,l.value="#"+ve.ColorConverter.toHexString(r)):r=e,a.style.background="#"+ve.ColorConverter.toHexString(e);for(var t=0;t<u.length;t++)u[t].update()}}),c=ve.el({tagName:"button",content:'<img src="'+t(We)+'" height="20"/>',title:ze("mci-copy"),css:{marginLeft:"10px"},onClick:function(){l.select(),document.execCommand("copy")}});o.appendChild(s),o.appendChild(l),o.appendChild(c),i.appendChild(o),setTimeout((function(){l.focus(),l.select()}),0);var u=[];u.push(n(ze("red"),"r")),u.push(n(ze("green"),"g")),u.push(n(ze("blue"),"b")),je({target:e.klRootEl,message:"<b>".concat(ze("manual-color-input"),"</b>"),div:i,autoFocus:!1,clickOnEnter:"Ok",buttons:["Ok","Cancel"],callback:function(t){ve.destroyEl(c),u.forEach((function(e){return e.destroy()})),u.splice(0,u.length),e.onClose("Ok"===t?ve.ColorConverter.hexToRGB(l.value):null)}})};qe=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("aSjVH");var Je=function(e){var t=function(){for(var e=o.getContext("2d"),t=0;t<o.height;t+=1){var n=e.createLinearGradient(0,0,o.width,0),r=ve.ColorConverter.toRGB(new ve.HSV(a.h,1,100-t/o.height*100)),i=ve.ColorConverter.toRGB(new ve.HSV(a.h,100,100-t/o.height*100));n.addColorStop(0,"#"+ve.ColorConverter.toHexString(r)),n.addColorStop(1,"#"+ve.ColorConverter.toHexString(i)),e.fillStyle="#ff0000",e.fillStyle=n,e.fillRect(0,t,o.width,1)}},n=function(){var t=a.s/100*e.width-4,n=(1-a.v/100)*e.heightSV-4;ve.css(l,{left:t+"px",top:n+"px"})},r=function(){c.style.left=a.h/359.999*e.width-1+"px"},i=document.createElement("div");i.oncontextmenu=function(e){e.preventDefault()};var a=ve.ColorConverter.toHSV(new ve.RGB(e.color.r,e.color.g,e.color.b));ve.css(i,{width:e.width+"px",position:"relative",overflow:"hidden",userSelect:"none"});var o=ve.canvas(10,10);o.style.width=e.width+"px",o.style.height=e.heightSV+"px",o.style.cursor="crosshair",t();var s=ve.canvas(e.width,e.heightH);s.style.cursor="ew-resize",function(){for(var t=s.getContext("2d"),n=t.createLinearGradient(0,0,e.width,0),r=0;r<1;r+=.01){var i=ve.ColorConverter.toRGB(new ve.HSV(360*r,100,100));n.addColorStop(r,"rgba("+parseInt(""+i.r)+", "+parseInt(""+i.g)+", "+parseInt(""+i.b)+", 1)")}t.fillStyle=n,t.fillRect(0,0,e.width,e.heightH)}(),ve.css(o,{width:e.width+"px",height:e.heightSV+"px",overflow:"hidden",position:"relative"}),o.style.cssFloat="left",s.style.cssFloat="left",i.appendChild(o),i.appendChild(s);var l=document.createElement("div");ve.css(l,{width:"8px",height:"8px",borderRadius:"8px",position:"absolute",pointerEvents:"none",boxShadow:"0 0 0 1px #000, inset 0 0 0 1px #fff"}),i.appendChild(l);var c=document.createElement("div");ve.css(c,{width:"0",height:e.heightH+"px",borderLeft:"1px solid #fff",borderRight:"1px solid #000",position:"absolute",top:e.heightSV+"px",pointerEvents:"none"}),i.appendChild(c),n(),r();var u={h:0,s:0,v:0},h=null,d=new ve.PointerListener({target:o,maxPointers:1,fixScribble:!0,onPointer:function(t){if("pointerdown"===t.type&&(h=t.pointerId,"left"===t.button?(u.s=t.relX/e.width*100,u.v=100-t.relY/e.heightSV*100,a=new ve.HSV(a.h,u.s,u.v),n(),e.callback(ve.ColorConverter.toRGB(a))):(u.s=a.s,u.v=a.v)),"pointermove"===t.type&&["left","right"].includes(t.button)&&h===t.pointerId){var r=1;"right"===t.button&&(r=.5),u.s+=t.dX/e.width*100*r,u.v-=t.dY/e.heightSV*100*r,a=new ve.HSV(a.h,u.s,u.v),n(),e.callback(ve.ColorConverter.toRGB(a))}"pointerup"===t.type&&(h=null)}}),p=null,g=new ve.PointerListener({target:s,maxPointers:1,fixScribble:!0,onPointer:function(n){if("pointerdown"===n.type&&(p=n.pointerId,"left"===n.button?(u.h=n.relX/e.width*359.99,a=new ve.HSV(u.h,a.s,a.v),t(),r(),e.callback(ve.ColorConverter.toRGB(a))):u.h=a.h),"pointermove"===n.type&&["left","right"].includes(n.button)&&p===n.pointerId){var i=Math.abs(n.pageY-n.downPageY),o=Ge(i,"right"===n.button);u.h+=n.dX/e.width*359.99*o,"right"===n.button&&(u.h=u.h%359.99,u.h<0&&(u.h+=359.99)),u.h=Math.min(359.99,u.h),a=new ve.HSV(u.h,a.s,a.v),t(),r(),e.callback(ve.ColorConverter.toRGB(a))}"pointerup"===n.type&&(p=null)}}),f=document.createElement("div");f.style.clear="both",i.appendChild(f),this.setColor=function(e){a=ve.ColorConverter.toHSV(new ve.RGB(e.r,e.g,e.b)),t(),n(),r()},this.getColor=function(){return ve.ColorConverter.toRGB(a)},this.getElement=function(){return i},this.destroy=function(){d.destroy(),g.destroy()},this.end=function(){h=null,p=null}},Qe=function(e){var t=function(){o.style.left=i+"px",o.style.boxShadow=s?"0 0 6px rgba(0,0,0,1)":"0 0 3px rgba(0,0,0,0.8)"},n=function(){return i/(e.width-e.pointSize)},r=document.createElement("div");r.style.position="relative";var i,a=ve.el({}),o=ve.el({css:{colorScheme:"only light"}});r.appendChild(a),r.appendChild(o);var s=!1;ve.css(a,{marginTop:parseInt(""+(e.pointSize/2-1))+"px",height:"2px",background:"#aaa",width:e.width+"px"});var l,c,u;ve.el({parent:o,css:{margin:"-7px 0 0 -7px",width:"calc(100% + 14px)",height:"calc(100% + 7px)"}});i=ve.clamp(e.init*(e.width-e.pointSize),0,e.width-e.pointSize),ve.css(o,{position:"absolute",top:"0px",backgroundColor:"#eaeaea",boxShadow:"0 0 3px rgba(0,0,0,0.8)",width:e.pointSize+"px",height:e.pointSize+"px",borderRadius:e.pointSize+"px",cursor:"ew-resize",transition:"box-shadow 0.2s ease-in-out"}),t(),l=new ve.PointerListener({target:o,fixScribble:!0,onPointer:function(r){"pointerdown"===r.type&&"left"===r.button?(c=!0,s=!0,u=i,t(),r.eventStopPropagation()):"pointermove"===r.type&&"left"===r.button&&(r.eventStopPropagation(),u+=r.dX,i=parseInt(""+ve.clamp(u,0,e.width-e.pointSize)),t(),e.callback(n(),c,!1),c=!1),"pointerup"===r.type&&(r.eventStopPropagation(),s=!1,t(),e.callback(n(),!1,!0))}}),this.getEl=function(){return r},this.setActive=function(e){o.style.backgroundColor=e?"#fff":"#eaeaea"},this.destroy=function(){l.destroy()}},$e=function(e){for(var t=function(){for(var e=0;e<a.length;e++)a[e].setIsSelected(e===r)},n=ve.el({content:e.label?e.label:"",css:{display:"flex",alignItems:"center",colorScheme:"only light"}}),r=0,i=[],a=[],o=ve.createCheckerDataUrl(5),s=0;s<e.colorArr.length;s++){for(var l=e.colorArr[s],c=!1,u=0;u<i.length;u++){var h=i[u];if(null!==h&&null!==l&&(h.r===l.r&&h.g===l.g&&h.b===l.b&&h.a===l.a)){c=!0;break}}c||(i.push(l),"initialIndex"in e&&e.initialIndex===s&&(r=i.length-1))}for(var d=0;d<i.length;d++)!function(s){var l=ve.el({content:i[s]?"":"X",css:{width:"22px",height:"22px",backgroundColor:i[s]?ve.ColorConverter.toRgbaStr(i[s]):"transparent",marginLeft:"7px",boxShadow:"0 0 0 1px #aaa",cursor:"pointer",userSelect:"none",textAlign:"center",lineHeight:"23px",color:"#aaa"}});i[s]&&0===i[s].a&&(l.style.backgroundImage="url("+o+")"),l.onclick=function(n){n.preventDefault(),r=s,t(),e.onChange(i[s])},l.setIsSelected=function(e){e?ve.css(l,{boxShadow:"0 0 0 2px var(--active-highlight-color), 0 0 5px 0 var(--active-highlight-color)",pointerEvents:"none"}):ve.css(l,{boxShadow:"0 0 0 1px #aaa",pointerEvents:""})},n.appendChild(l),a.push(l)}(d);t(),this.getElement=function(){return n},this.destroy=function(){a.forEach((function(e){e.onclick=null})),a.splice(0,a.length)}},et=function(e){for(var t=function(t){var r={id:t.id,el:null},i=["kl-option"];e.isSmall&&i.push("kl-option--small"),"string"!=typeof t.label&&(i.push("kl-option--custom-el"),ve.css(t.label,{display:"block",pointerEvents:"none"})),r.el=ve.el({parent:a,content:t.label,className:i.join(" "),onClick:function(){s!==r.id&&(s=r.id,n(),e.onChange(s))}}),t.title&&(r.el.title=t.title),o.push(r)},n=function(){for(var e=0;e<o.length;e++)o[e].id===s?ve.addClassName(o[e].el,"kl-option-selected"):ve.removeClassName(o[e].el,"kl-option-selected")},r=function(){for(var e=0;e<o.length;e++)if(o[e].id===s)return e},i=ve.el({}),a=ve.el({parent:i,className:"kl-option-wrapper",css:{display:"flex"}}),o=[],s=("initialId"in e?e.initialId:e.optionArr[0].id),l=0;l<e.optionArr.length;l++)t(e.optionArr[l]);n(),e.changeOnInit&&setTimeout((function(){e.onChange(s)}),0),this.getElement=function(){return i},this.getValue=function(){return s},this.next=function(){s=o[(r()+1)%o.length].id,n(),e.onChange(s)},this.previous=function(){s=o[(o.length+r()-1)%o.length].id,n(),e.onChange(s)},this.destroy=function(){o.forEach((function(e){ve.destroyEl(e.el)})),o.splice(0,o.length)}};a("cf2NR");var tt;I=a("hDZfO"),T=a("3SSYo");tt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("h5jJy");var nt=function(){"use strict";function e(t){I.default(this,e),this.container=t,this.init()}return T.default(e,[{key:"updateUiState",value:function(){this.el&&(setTimeout((function(){}),100),"left"===this.uiState?this.el.style.left="271px":this.el.style.removeProperty("left"))}},{key:"init",value:function(){this.el=ve.el({className:"top-overlay",onClick:ve.handleClick}),this.isWide&&(this.el.style.width="100%"),this.updateUiState(),this.innerEl=ve.el({className:"top-overlay-inner"}),this.angleIm=new Image,this.angleIm.src=t(tt),ve.css(this.angleIm,{verticalAlign:"bottom",width:"20px",height:"20px",marginLeft:"5px",borderRadius:"10px"}),this.innerInnerEl=document.createElement("div"),this.innerInnerEl.style.display="inline-block",this.innerEl.appendChild(this.innerInnerEl),this.innerEl.appendChild(this.angleIm),this.el.appendChild(this.innerEl),this.container.appendChild(this.el),this.el.style.display="none"}},{key:"setWide",value:function(e){this.isWide=!!e,this.el&&(this.isWide?(this.el.style.width="100%",this.el.style.left=""):(this.el.style.removeProperty("width"),this.el.style.left="left"===this.uiState?"271px":""))}},{key:"setUiState",value:function(e){this.uiState=e,this.updateUiState()}},{key:"out",value:function(e,t){var n=this;if(e&&"object"==typeof e?"transform"===e.type?(this.angleIm.style.display="inline-block",this.angleIm.style.transform="rotate("+e.angleDeg+"deg)",e.angleDeg%90==0?this.angleIm.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.7)":this.angleIm.style.boxShadow="",this.innerInnerEl.innerHTML=Math.round(100*e.scale)+"%"):this.angleIm.style.display="none":"string"==typeof e&&(this.angleIm.style.display="none",this.innerInnerEl.innerHTML=e),t){var r=this;this.innerEl.style.animation="",setTimeout((function(){return r.innerEl.style.animation="top-overlay-pulse 0.5s ease-out"}),20),this.timeout3&&clearTimeout(this.timeout3),this.timeout3=window.setTimeout((function(){return r.innerEl.style.animation=""}),520)}this.timeout&&clearTimeout(this.timeout),this.timeout2&&clearTimeout(this.timeout2),this.el.style.animationName=t?"consoleInFast":"consoleIn",this.el.style.opacity="1",this.timeout=window.setTimeout((function(){var e=n;n.el.style.opacity="0",n.el.style.animationName="consoleOut",n.timeout2=window.setTimeout((function(){e.el.style.display="none",e.timeout2=0}),450),n.timeout=0}),1200),this.el.style.display="flex"}}]),e}();function rt(e){var t,n=function(){t={x:0,y:0,width:e.canvas.width,height:e.canvas.height}},r=function(){c.width=Math.round(t.width),c.height=Math.round(t.height),c.getContext("2d").drawImage(e.canvas,Math.round(-t.x),Math.round(-t.y)),h&&(h.src=c.toDataURL("image/png")),e.onChange&&e.onChange(c.width,c.height)},i=function(){ve.css(w,{left:y+t.x*f+"px",top:x+t.y*m+"px",width:t.width*f+"px",height:t.height*m+"px"}),e.onChange&&e.onChange(Math.round(t.width),Math.round(t.height))},a=function(t){return{x:ve.clamp((t.x-y)/f,0,e.canvas.width),y:ve.clamp((t.y-x)/m,0,e.canvas.height)}},o=function(e,t){var n={x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)},r={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)},i=a(n),o=a(r);return i.x=Math.floor(i.x),i.y=Math.floor(i.y),o.x=Math.ceil(o.x),o.y=Math.ceil(o.y),{x:i.x,y:i.y,width:o.x-i.x,height:o.y-i.y}},s=function(){return 0===t.x&&0===t.y&&t.width===e.canvas.width&&t.height===e.canvas.height},l=document.createElement("div");ve.css(l,{position:"relative",height:e.height+"px",width:e.width+"px",overflow:"hidden",colorScheme:"only light"}),l.style.position="relative",n();var c=ve.canvas(),u=c,h=null;e.isNotCopy||(h=new Image,u=h),ve.css(u,{height:e.height+"px",width:e.width+"px"}),l.appendChild(u),r();var d=ve.el({css:{width:e.width+"px",height:e.height+"px",position:"absolute",left:"0",top:"0",pointerEvents:"none"}});l.appendChild(d),ve.createCheckerDataUrl(4,(function(e){d.style.backgroundImage="url("+e+")"}));var p=ve.fitInto(e.canvas.width,e.canvas.height,e.width-40,e.height-40,1),g=ve.canvas(Math.round(p.width),Math.round(p.height));g.style.imageRendering="pixelated";var f=g.width/e.canvas.width,m=g.height/e.canvas.height,v=g.getContext("2d");v.imageSmoothingEnabled=!1,v.drawImage(e.canvas,0,0,g.width,g.height),d.appendChild(g);var y=parseInt(""+(e.width-g.width)/2),x=parseInt(""+(e.height-g.height)/2);ve.css(g,{position:"absolute",left:y+"px",top:x+"px"});var b,w=ve.el({css:{position:"absolute",boxShadow:"0 0 0 1px #fff, 0 0 0 2px #000, 0 0 40px 1px #000"}});d.appendChild(w),i();var C,S=null,k=!1,E=!1,M=new ve.PointerListener({target:u,fixScribble:!0,onPointer:function(a){var l,c,u,h,d;"pointerdown"===a.type&&"left"===a.button?(a.eventPreventDefault(),k=!0,b={x:a.relX,y:a.relY},!s()&&(l=b,c=Math.round(y+t.x*f),u=Math.round(x+t.y*m),h=Math.round(t.width*f),d=Math.round(t.height*m),c<=l.x&&l.x<=c+h&&u<=l.y&&l.y<=u+d)?S={x:t.x,y:t.y,width:t.width,height:t.height}:t=o(b,b)):"pointermove"===a.type&&"left"===a.button?(a.eventPreventDefault(),E=!0,S?(t.x=S.x+Math.round((a.relX-b.x)/f),t.y=S.y+Math.round((a.relY-b.y)/m),t.x=ve.clamp(t.x,0,e.canvas.width-t.width),t.y=ve.clamp(t.y,0,e.canvas.height-t.height)):t=o(b,{x:a.relX,y:a.relY}),i()):"pointerup"===a.type&&b&&(a.eventPreventDefault(),k=!1,S=null,b=null,0!==t.width&&0!==t.height&&E||(n(),i()),E=!1,C=setTimeout(r,1))}}),I=new ve.KeyListener({onDown:function(n,a,o){if(!k){var s=!1,l=Math.max(1,1/f),c=I.isPressed("shift");"left"===n&&(c?t.width=ve.clamp(t.width-l,1,e.canvas.width-t.x):t.x=ve.clamp(t.x-l,0,e.canvas.width-t.width),s=!0),"right"===n&&(c?t.width=ve.clamp(t.width+l,1,e.canvas.width-t.x):t.x=ve.clamp(t.x+l,0,e.canvas.width-t.width),s=!0),"up"===n&&(c?t.height=ve.clamp(t.height-l,1,e.canvas.height-t.y):t.y=ve.clamp(t.y-l,0,e.canvas.height-t.height),s=!0),"down"===n&&(c?t.height=ve.clamp(t.height+l,1,e.canvas.height-t.y):t.y=ve.clamp(t.y+l,0,e.canvas.height-t.height),s=!0),s&&(a.preventDefault(),i(),clearTimeout(C),C=setTimeout(r,100))}}});this.getEl=function(){return l},this.reset=function(){n(),r(),i()},this.destroy=function(){u.style.removeProperty("width"),u.style.removeProperty("height"),I.destroy(),M.destroy()},this.isReset=function(){return s()},this.getRect=function(){return JSON.parse(JSON.stringify(t))},this.getCroppedImage=function(){return c}}a("cf2NR");s=a("5atYG");var it=a("hH4eb");var at;at=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("fCbWX");var ot;ot=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("1urq0");var st;st=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("hx4Ut");var lt;lt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("dUjL8");var ct;ct=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("fV96v"),a("cf2NR");var ut,ht;I=a("hDZfO"),T=a("3SSYo");function dt(e,t,n,r,i,a){for(var o=n;o<=i;o++)for(var s=r;s<=a;s++)255!==e[s*t+o]&&(e[s*t+o]=254)}function pt(e,t,n,r,i){return ut=n%e+r,ht=Math.floor(n/e)+i,ut<0||ht<0||ut>=e||ht>=t?null:ht*e+ut}function gt(e,t,n,r,i,a,o){return null!==o&&255!==t[o]&&((e[4*o]===i[0]&&e[4*o+1]===i[1]&&e[4*o+2]===i[2]&&e[4*o+3]===i[3]||a>0&&Math.abs(e[4*o]-i[0])<=a&&Math.abs(e[4*o+1]-i[1])<=a&&Math.abs(e[4*o+2]-i[2])<=a&&Math.abs(e[4*o+3]-i[3])<=a)&&(t[o]=255,!0))}function ft(e,t,n,r,i,a,o,s){r=Math.round(r),i=Math.round(i);var l=new Uint8Array(new ArrayBuffer(t*n));return function(e,t,n,r,i,a,o,s,l){var c=[e[4*(a*n+i)],e[4*(a*n+i)+1],e[4*(a*n+i)+2],e[4*(a*n+i)+3]];if(l){var u,h,d=[];for(d.push(a*n+i),t[a*n+i]=255;d.length;)gt(e,t,0,0,c,o,h=pt(n,r,u=d.pop(),-1,0))&&d.push(h),gt(e,t,0,0,c,o,h=pt(n,r,u,1,0))&&d.push(h),gt(e,t,0,0,c,o,h=pt(n,r,u,0,-1))&&d.push(h),gt(e,t,0,0,c,o,h=pt(n,r,u,0,1))&&d.push(h)}else for(var p=0;p<n*r;p++)gt(e,t,0,0,c,o,p);if(0!==s){for(var g=void 0,f=void 0,m=void 0,v=void 0,y=void 0,x=void 0,b=void 0,w=void 0,C=void 0,S=void 0,k=void 0,E=void 0,M=0;M<n;M++)for(var I=0;I<r;I++)255===t[I*n+M]&&(g=M,f=M,m=I,v=I,y=255!==t[I*n+M-1],x=255!==t[(I-1)*n+M-1],b=255!==t[(I-1)*n+M],w=255!==t[(I-1)*n+M+1],C=255!==t[I*n+M+1],S=255!==t[(I+1)*n+M+1],k=255!==t[(I+1)*n+M],E=255!==t[(I+1)*n+M-1],y&&(g=M-s),y&&x&&b&&(g=M-s,m=I-s),b&&(m=Math.min(m,I-s)),b&&w&&C&&(m=Math.min(m,I-s),f=M+s),C&&(f=Math.max(f,M+1*s)),C&&S&&k&&(f=Math.max(f,M+1*s),v=Math.max(v,I+1*s)),k&&(v=Math.max(v,I+1*s)),k&&E&&y&&(g=Math.min(g,M-1*s),v=Math.max(v,I+1*s)),(y||x||b||w||C||S||k||E)&&dt(t,n,Math.max(0,g),Math.max(0,m),Math.min(n-1,f),Math.min(r-1,v)));for(var T=0;T<n*r;T++)254===t[T]&&(t[T]=255)}}(e,l,t,n,r,i,a,o,s),{data:l}}function mt(e,t){if(!["rect","ellipse","line"].includes(t.type))throw new Error("unknown shape");var n=Math.round(t.lineWidth),r=180*t.angleRad/Math.PI;e.save(),t.opacity&&(e.globalAlpha=t.opacity),t.isEraser&&(e.globalCompositeOperation="destination-out"),e.rotate(-t.angleRad),t.fillRgb?e.fillStyle=ve.ColorConverter.toRgbStr(t.fillRgb):t.strokeRgb&&(e.strokeStyle=ve.ColorConverter.toRgbStr(t.strokeRgb),e.lineWidth=n);var i=t.x1,a=t.y1,o=t.x2,s=t.y2;if(t.isAngleSnap){var l=ve.rotate(i,a,t.angleRad/Math.PI*180),c=ve.rotate(o,s,t.angleRad/Math.PI*180),u=ve.pointsToAngleDeg(l,c)+90,h=45*Math.round(u/45),d=ve.rotateAround({x:i,y:a},{x:o,y:s},h-u);o=d.x,s=d.y,(r+h)%90==0&&(Math.round((r-h)/90)%2==0?o=i:s=a)}var p,g,f=i,m=a,v=o-i,y=s-a;if("line"!==t.type&&t.isFixedRatio){var x=ve.rotate(t.x1,t.y1,t.angleRad/Math.PI*180),b=ve.rotate(t.x2,t.y2,t.angleRad/Math.PI*180),w=x.x,C=x.y,S=b.x-x.x,k=b.y-x.y;Math.abs(S)<Math.abs(k)?k=Math.abs(S)*(k<0?-1:1):S=Math.abs(k)*(S<0?-1:1),b.x=w+S,b.y=C+k,x=ve.rotate(x.x,x.y,-t.angleRad/Math.PI*180),b=ve.rotate(b.x,b.y,-t.angleRad/Math.PI*180),f=i=x.x,m=a=x.y,v=(o=b.x)-i,y=(s=b.y)-a}if(t.isOutwards&&(i=f-=v,a=m-=y,o=f+(v*=2),s=m+(y*=2)),"line"===t.type){var E=Math.round(i),M=Math.round(a),I=Math.round(o),T=Math.round(s),R=Math.floor(i),L=Math.floor(a),A=Math.floor(o),P=Math.floor(s);n%2==0?M===T?(p={x:R,y:M},g={x:A,y:T},R<A?g.x+=1:p.x+=1):E===I?(p={x:E,y:L},g={x:I,y:P},L<P?g.y+=1:p.y+=1):(p={x:i,y:a},g={x:o,y:s}):(p={x:R,y:L},g={x:A,y:P},L===P?(R<A?g.x+=1:p.x+=1,p.y+=.5,g.y+=.5):R===A?(L<P?g.y+=1:p.y+=1,p.x+=.5,g.x+=.5):(p.x=i,p.y=a,g.x=o,g.y=s)),p=ve.rotate(p.x,p.y,t.angleRad/Math.PI*180),g=ve.rotate(g.x,g.y,t.angleRad/Math.PI*180),e.beginPath(),e.moveTo(p.x,p.y),e.lineTo(g.x,g.y),e.stroke()}else if("rect"===t.type){var O=Math.floor(i),D=Math.floor(a),B=Math.floor(o),z=Math.floor(s);r%90==0?t.fillRgb?(i%1==0&&(i+=1),a%1==0&&(a+=1),o%1==0&&(o+=1),s%1==0&&(s+=1),p={x:i<o?O:B,y:a<s?D:z},(g={x:Math.ceil((i<o?o:i)-p.x),y:Math.ceil((a<s?s:a)-p.y)}).x=p.x+g.x,g.y=p.y+g.y):n%2==0?(p={x:O,y:D},g={x:B,y:z}):(p={x:O+.5,y:D+.5},g={x:B+.5,y:z+.5}):(p={x:i,y:a},g={x:o,y:s}),p=ve.rotate(p.x,p.y,t.angleRad/Math.PI*180),(g=ve.rotate(g.x,g.y,t.angleRad/Math.PI*180)).x=g.x-p.x,g.y=g.y-p.y,t.fillRgb?e.fillRect(p.x,p.y,g.x,g.y):e.strokeRect(p.x,p.y,g.x,g.y)}else p=ve.rotate(i,a,t.angleRad/Math.PI*180),g=ve.rotate(o,s,t.angleRad/Math.PI*180),f=p.x,m=p.y,v=g.x-p.x,y=g.y-p.y,e.beginPath(),e.ellipse(f+v/2,m+y/2,Math.abs(v/2),Math.abs(y/2),0,0,2*Math.PI),t.fillRgb?e.fill():e.stroke();e.restore()}function vt(e,t){for(var n=""===t.textStr?" ":t.textStr,r=ve.el({css:{position:"fixed",left:"0",top:"0",width:"100000px",fontSize:t.size+"px",lineHeight:t.lineHeight?t.lineHeight+"px":"default"}}),i=ve.el({parent:r,css:{display:"inline-block",textAlign:t.align?t.align:"left",fontFamily:t.font?t.font:"sans-serif",fontSize:t.size+"px",fontWeight:t.isBold?"bold":"normal",fontStyle:t.isItalic?"italic":"normal",lineHeight:t.lineHeight?t.lineHeight+"px":"default",opacity:"0",pointerEvents:"none"}}),a="",o=0;o<n.length;o++)"\n"!==n[o]?a+=n[o].replace("\t","    "):(i.appendChild(ve.el({tagName:"span",textContent:a,css:{whiteSpace:"pre"}})),a="",i.appendChild(ve.el({tagName:"br"})));i.appendChild(ve.el({tagName:"span",textContent:a,css:{whiteSpace:"pre"}})),document.body.appendChild(r);for(var s={x0:99999999,y0:99999999,x1:0,y1:0},l=0;l<i.children.length;l++){var c=i.children[l];s.x0=Math.min(s.x0,c.offsetLeft),s.y0=Math.min(s.y0,c.offsetTop),s.x1=Math.max(s.x1,c.offsetLeft+c.offsetWidth),s.y1=Math.max(s.y1,c.offsetTop+c.offsetHeight)}var u=e.getContext("2d");u.save();var h=[];t.isItalic&&h.push("italic"),t.isBold&&h.push("bold"),h.push(t.size+"px "+(t.font?t.font:"sans-serif")),u.font=h.join(" "),u.fillStyle=t.color?t.color:"#000";var d=t.x,p=t.y;"right"===t.align&&(d+=-s.x1+s.x0),"center"===t.align&&(d+=(-s.x1+s.x0)/2),u.translate(t.x,t.y),u.rotate(t.angleRad?-t.angleRad:0),u.translate(-t.x,-t.y),u.translate(d,p);for(var g=0;g<i.children.length;g++){var f=i.children[g];u.fillText(f.innerText,f.offsetLeft,f.offsetTop)}return t.isDebug?(u.lineWidth=1,u.strokeRect(0,.85*-t.size,s.x1,s.y1),u.restore(),u.fillRect(t.x-1,t.y-1,2,2)):u.restore(),document.body.removeChild(r),{x:d-t.x,y:p-t.y-.85*t.size,width:s.x1-s.x0,height:s.y1-s.y0}}function yt(e,t){var n=ve.canvas(Math.max(1,Math.round(e.width*t)),Math.max(1,Math.round(e.height*t))),r=n.getContext("2d");r.save(),t>1&&(r.imageSmoothingEnabled=!1);for(var i=0;i<e.layers.length;i++)0!==e.layers[i].opacity&&(r.globalAlpha=e.layers[i].opacity,r.globalCompositeOperation=e.layers[i].mixModeStr?e.layers[i].mixModeStr:"source-over",r.drawImage(e.layers[i].image,0,0,n.width,n.height));return r.restore(),n}var xt=["source-over","darken","multiply","color-burn","lighten","screen","color-dodge","overlay","soft-light","hard-light","difference","exclusion","hue","saturation","color","luminosity"],bt=16,wt=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(I.default(this,e),this.layerNrOffset=n,this.layerCanvasArr=[],this.pickCanvas=ve.canvas(1,1),this.history=new xe,"copy"in t?(this.width=1,this.height=1):"width"in t&&"height"in t?(this.width=t.width,this.height=t.height):(this.width=1,this.height=1),this.init(this.width,this.height),this.changeListenerArr=[],"copy"in t)try{this.copy(t.copy)}catch(e){throw this.destroy(),e}else if("projectObj"in t){var r=[].concat(t.projectObj.layers);if(this.init(t.projectObj.width,t.projectObj.height),!r.length)throw new Error("project.layers needs at least 1 layer");for(var i=0;i<r.length;i++){if(r[i].mixModeStr&&!xt.includes(r[i].mixModeStr))throw new Error("unknown mixModeStr "+r[i].mixModeStr);this.addLayer(),this.layerOpacity(i,r[i].opacity),this.layerCanvasArr[i].name=r[i].name,this.layerCanvasArr[i].mixModeStr=r[i].mixModeStr?r[i].mixModeStr:"source-over",this.layerCanvasArr[i].getContext("2d").drawImage(r[i].image,0,0)}}this.updateIndices()}return T.default(e,[{key:"init",value:function(e,t){if(!e||!t||isNaN(e)||isNaN(t)||e<1||t<1)throw new Error("init - invalid canvas size: "+e+", "+t);this.width=e,this.height=t}},{key:"emitChange",value:function(){this.changeListenerArr.forEach((function(e){return e()}))}},{key:"updateIndices",value:function(){this.layerCanvasArr.forEach((function(e,t){e.index=t}))}},{key:"setHistory",value:function(e){this.history=e}},{key:"reset",value:function(e){if(!e.width||!e.height||e.width<1||e.height<1||isNaN(e.width)||isNaN(e.height))throw new Error("invalid canvas size");if(this.history.pause(!0),this.width=e.width,this.height=e.height,this.layerCanvasArr.splice(1,Math.max(0,this.layerCanvasArr.length-1)),e.layers)for(var t=0;t<e.layers.length;t++){var n=e.layers[t];this.layerCanvasArr[t]||this.addLayer(),this.layerCanvasArr[t].name=n.name,this.layerCanvasArr[t].width=this.width,this.layerCanvasArr[t].height=this.height,this.layerCanvasArr[t].mixModeStr=n.mixModeStr?n.mixModeStr:"source-over",this.layerCanvasArr[t].getContext("2d").drawImage(n.image,0,0),this.layerOpacity(t,n.opacity)}else this.layerCanvasArr[0].name=e.layerName?e.layerName:ze("layers-layer")+" 1",this.layerCanvasArr[0].width=this.width,this.layerCanvasArr[0].height=this.height,this.layerCanvasArr[0].mixModeStr="source-over",this.layerOpacity(0,1),e.color?this.layerFill(0,e.color):e.image&&this.layerCanvasArr[0].getContext("2d").drawImage(e.image,0,0);return this.updateIndices(),this.history.pause(!1),this.history.push({tool:["canvas"],action:"reset",params:[e]}),this.layerCanvasArr.length-1}},{key:"isLayerLimitReached",value:function(){return this.layerCanvasArr.length>=bt}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"copy",value:function(e){if(e.getWidth()<1||e.getHeight()<1||isNaN(e.getWidth())||isNaN(e.getHeight()))throw new Error("invalid canvas size");for(var t=e.getLayers();this.layerCanvasArr.length>t.length;)this.removeLayer(this.layerCanvasArr.length-1);e.getWidth()==this.width&&e.getHeight()==this.height||this.init(e.getWidth(),e.getHeight());for(var n=0;n<t.length;n++)n>=this.layerCanvasArr.length?this.addLayer():(this.layerCanvasArr[n].width=this.width,this.layerCanvasArr[n].height=this.height),this.layerOpacity(n,t[n].opacity),this.layerCanvasArr[n].name=t[n].name,this.layerCanvasArr[n].mixModeStr=t[n].mixModeStr,this.layerCanvasArr[n].getContext("2d").drawImage(t[n].context.canvas,0,0);this.updateIndices()}},{key:"getLayerCount",value:function(){return this.layerCanvasArr.length}},{key:"resize",value:function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"smooth";if(!e||!t||e===this.width&&t===this.height||isNaN(e)||isNaN(t)||e<1||t<1)return!1;if(e=Math.max(e,1),t=Math.max(t,1),"pixelated"===i){var a=(n=ve.canvas(e,t)).getContext("2d");a.imageSmoothingEnabled=!1;for(var o=0;o<this.layerCanvasArr.length;o++){o>0&&a.clearRect(0,0,e,t);var s=this.layerCanvasArr[o];a.drawImage(s,0,0,e,t),s.width=e,s.height=t;var l=s.getContext("2d");l.drawImage(n,0,0)}}else{if("smooth"!==i)throw new Error("unknown resize algorithm");n=ve.canvas(),r=ve.canvas();for(var c=0;c<this.layerCanvasArr.length;c++)ve.resizeCanvas(this.layerCanvasArr[c],e,t,n,r)}return this.width=e,this.height=t,!0}},{key:"resizeCanvas",value:function(e){var t=Math.round(e.left)+this.width+Math.round(e.right),n=Math.round(e.top)+this.height+Math.round(e.bottom),r=Math.round(e.left),i=Math.round(e.top);if(isNaN(t)||isNaN(n)||t<1||n<1)throw new Error("KlCanvas.resizeCanvas - invalid canvas size");for(var a=0;a<this.layerCanvasArr.length;a++){var o=ve.canvas(this.width,this.height),s=this.layerCanvasArr[a],l=this.layerCanvasArr[a].getContext("2d");o.getContext("2d").drawImage(s,0,0),this.layerCanvasArr[a].width=t,this.layerCanvasArr[a].height=n,l.save(),0===a&&e.fillColor&&(l.fillStyle=ve.ColorConverter.toRgbStr(e.fillColor),l.fillRect(0,0,t,n),l.clearRect(r,i,this.width,this.height)),l.drawImage(o,r,i),l.restore()}this.width=t,this.height=n}},{key:"addLayer",value:function(e){if(this.isLayerLimitReached())return!1;var t=ve.canvas(this.width,this.height);if(!t.getContext("2d"))throw new Error("kl-create-canvas-error");return t.mixModeStr="source-over",void 0===e?(this.layerCanvasArr[this.layerCanvasArr.length]=t,e=Math.max(0,this.layerCanvasArr.length-1)):(this.layerCanvasArr.splice(e+1,0,t),e++),t.name=ze("layers-layer")+" "+(this.layerCanvasArr.length+this.layerNrOffset),this.history.pause(!0),this.layerOpacity(e,1),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"addLayer",params:[e-1]}),e}},{key:"duplicateLayer",value:function(e){if(!this.layerCanvasArr[e]||this.isLayerLimitReached())return!1;var t=ve.canvas(this.width,this.height);return this.layerCanvasArr.splice(e+1,0,t),t.name=this.layerCanvasArr[e].name+" "+ze("layers-copy"),t.mixModeStr=this.layerCanvasArr[e].mixModeStr,t.getContext("2d").drawImage(this.layerCanvasArr[e],0,0),this.history.pause(!0),this.layerOpacity(e+1,this.layerCanvasArr[e].opacity),this.history.pause(!1),this.updateIndices(),this.history.push({tool:["canvas"],action:"duplicateLayer",params:[e]}),e+1}},{key:"getLayerContext",value:function(e,t){if(this.layerCanvasArr[e])return this.layerCanvasArr[e].getContext("2d");if(t)return null;throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)")}},{key:"removeLayer",value:function(e){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr.splice(e,1),this.updateIndices(),this.history.push({tool:["canvas"],action:"removeLayer",params:[e]}),Math.max(0,e-1))}},{key:"renameLayer",value:function(e,t){return!!this.layerCanvasArr[e]&&(this.layerCanvasArr[e].name=t,this.history.push({tool:["canvas"],action:"renameLayer",params:[e,t]}),!0)}},{key:"layerOpacity",value:function(e,t){this.layerCanvasArr[e]&&(t=Math.max(0,Math.min(1,t)),this.layerCanvasArr[e].opacity=t,this.history.push({tool:["canvas"],action:"layerOpacity",params:[e,t]}),this.emitChange())}},{key:"moveLayer",value:function(e,t){if(0!==t&&this.layerCanvasArr[e]){var n=this.layerCanvasArr[e];this.layerCanvasArr.splice(e,1);var r=Math.max(0,Math.min(e+t,this.layerCanvasArr.length));return this.layerCanvasArr.splice(r,0,n),this.updateIndices(),this.history.push({tool:["canvas"],action:"moveLayer",params:[e,t]}),r}}},{key:"mergeLayers",value:function(e,t,n){if(this.layerCanvasArr[e]&&this.layerCanvasArr[t]&&e!==t){if(e>t){var r=e;e=t,t=r}var i=this.layerCanvasArr[t].opacity;if(0!==i&&i){var a=this.layerCanvasArr[e].getContext("2d");a.save(),"as-alpha"===n?(ve.convertToAlphaChannelCanvas(this.layerCanvasArr[t]),a.globalCompositeOperation="destination-in",a.globalAlpha=i,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)):(n&&(a.globalCompositeOperation=n),a.globalAlpha=i,this.layerCanvasArr[e].getContext("2d").drawImage(this.layerCanvasArr[t],0,0)),a.restore(),n&&(a.save(),a.fillStyle="rgba(0,0,0,0.01)",a.fillRect(-.9999999,-.9999999,1,1),a.restore())}return this.updateIndices(),this.history.pause(!0),this.removeLayer(t),this.history.pause(!1),this.history.push({tool:["canvas"],action:"mergeLayers",params:[e,t,n]}),e}}},{key:"rotate",value:function(e){for(;e<0;)e+=360;if((e%=360)%90==0&&0!==e){var t=ve.canvas();0===e||180===e?(t.width=this.width,t.height=this.height):90!==e&&270!==e||(t.width=this.height,t.height=this.width);for(var n=t.getContext("2d"),r=0;r<this.layerCanvasArr.length;r++)n.clearRect(0,0,t.width,t.height),n.save(),n.translate(t.width/2,t.height/2),n.rotate(e*Math.PI/180),180===e?n.drawImage(this.layerCanvasArr[r],-t.width/2,-t.height/2):90!==e&&270!==e||n.drawImage(this.layerCanvasArr[r],-t.height/2,-t.width/2),this.layerCanvasArr[r].width=t.width,this.layerCanvasArr[r].height=t.height,this.layerCanvasArr[r].getContext("2d").clearRect(0,0,this.layerCanvasArr[r].width,this.layerCanvasArr[r].height),this.layerCanvasArr[r].getContext("2d").drawImage(t,0,0),n.restore();this.width=t.width,this.height=t.height}}},{key:"flip",value:function(e,t,n){if(e||t){var r=ve.canvas(this.width,this.height);r.width=this.width,r.height=this.height;for(var i=r.getContext("2d"),a=0;a<this.layerCanvasArr.length;a++)(!n&&0!==n||a===n)&&(i.save(),i.clearRect(0,0,r.width,r.height),i.translate(r.width/2,r.height/2),i.scale(e?-1:1,t?-1:1),i.drawImage(this.layerCanvasArr[a],-r.width/2,-r.height/2),i.restore(),this.layerCanvasArr[a].getContext("2d").clearRect(0,0,this.layerCanvasArr[a].width,this.layerCanvasArr[a].height),this.layerCanvasArr[a].getContext("2d").drawImage(r,0,0))}}},{key:"layerFill",value:function(e,t,n){var r=this.layerCanvasArr[e].getContext("2d");r.save(),n&&(r.globalCompositeOperation=n),r.fillStyle="rgba("+t.r+","+t.g+","+t.b+",1)",r.fillRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),r.restore(),r.save(),r.fillStyle="rgba(0,0,0,0.01)",r.fillRect(-.9999999,-.9999999,1,1),r.restore(),this.history.push({tool:["canvas"],action:"layerFill",params:[e,t,n]})}},{key:"floodFill",value:function(e,t,n,r,i,a,o,s,l){if(!(t<0||n<0||t>=this.width||n>=this.height||0===i)){if(a=Math.round(a),!["above","current","all"].includes(o))throw new Error("invalid sampleStr");var c,u,h,d,p,g;if("all"===o){var f=1===this.layerCanvasArr.length?this.layerCanvasArr[0]:this.getCompleteCanvas(1);c=ft((h=(u=f.getContext("2d")).getImageData(0,0,this.width,this.height)).data,this.width,this.height,t,n,a,Math.round(s),l),f=null,u=null,h=null,null,p=(d=this.layerCanvasArr[e].getContext("2d")).getImageData(0,0,this.width,this.height)}else{var m="above"===o?e+1:e;if(m>=this.layerCanvasArr.length)return;c=ft((h=(u=this.layerCanvasArr[m].getContext("2d")).getImageData(0,0,this.width,this.height)).data,this.width,this.height,t,n,a,Math.round(s),l),e!==m&&(u=null,h=null,null),d=e===m?u:this.layerCanvasArr[e].getContext("2d"),p=e===m?h:d.getImageData(0,0,this.width,this.height)}if(g=p.data,1===i)for(var v=0;v<this.width*this.height;v++)255===c.data[v]&&(g[4*v]=r.r,g[4*v+1]=r.g,g[4*v+2]=r.b,g[4*v+3]=255);else for(var y=0;y<this.width*this.height;y++)255===c.data[y]&&(g[4*y]=ve.mix(g[4*y],r.r,i),g[4*y+1]=ve.mix(g[4*y+1],r.g,i),g[4*y+2]=ve.mix(g[4*y+2],r.b,i),g[4*y+3]=ve.mix(g[4*y+3],255,i));d.putImageData(p,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,p]})}}},{key:"drawShape",value:function(e,t){mt(this.layerCanvasArr[e].getContext("2d"),t),this.history.push({tool:["canvas"],action:"drawShape",params:[e,ve.copyObj(t)]})}},{key:"text",value:function(e,t){vt(this.layerCanvasArr[e],ve.copyObj(t)),this.history.push({tool:["canvas"],action:"text",params:[e,ve.copyObj(t)]})}},{key:"replaceLayer",value:function(e,t){this.layerCanvasArr[e].getContext("2d").putImageData(t,0,0),this.history.push({tool:["canvas"],action:"replaceLayer",params:[e,t]})}},{key:"clearLayer",value:function(e){var t=this.layerCanvasArr[e].getContext("2d");t.save(),t.clearRect(0,0,this.layerCanvasArr[e].width,this.layerCanvasArr[e].height),t.restore(),this.history.push({tool:["canvas"],action:"clearLayer",params:[e]})}},{key:"getLayers",value:function(){return this.layerCanvasArr.map((function(e){return{context:e.getContext("2d"),opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayersFast",value:function(){return this.layerCanvasArr.map((function(e){return{canvas:e,opacity:e.opacity,name:e.name,mixModeStr:e.mixModeStr}}))}},{key:"getLayerIndex",value:function(e,t){for(var n=0;n<this.layerCanvasArr.length;n++)if(this.layerCanvasArr[n]===e)return n;if(!t)throw new Error("layer not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getLayer",value:function(e,t){if(this.layerCanvasArr[e])return{context:this.layerCanvasArr[e].getContext("2d"),opacity:this.layerCanvasArr[e].opacity,name:this.layerCanvasArr[e].name,id:e};if(!t)throw new Error("layer of index "+e+" not found (in "+this.layerCanvasArr.length+" layers)");return null}},{key:"getColorAt",value:function(e,t){e=Math.floor(e),t=Math.floor(t);var n=this.pickCanvas.getContext("2d");n.save(),n.imageSmoothingEnabled=!1,n.clearRect(0,0,1,1);for(var r=0;r<this.layerCanvasArr.length;r++)n.globalAlpha=this.layerCanvasArr[r].opacity,n.globalCompositeOperation=this.layerCanvasArr[r].mixModeStr,n.drawImage(this.layerCanvasArr[r],-e,-t);n.restore();var i=n.getImageData(0,0,1,1);return new ve.RGB(i.data[0],i.data[1],i.data[2])}},{key:"getCompleteCanvas",value:function(e){return yt(this.getProject(),e)}},{key:"getProject",value:function(){return{width:this.width,height:this.height,layers:this.layerCanvasArr.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e}}))}}},{key:"addChangeListener",value:function(e){this.changeListenerArr.includes(e)||this.changeListenerArr.push(e)}},{key:"removeChangeListener",value:function(e){for(var t=0;t<this.changeListenerArr.length;t++)if(this.changeListenerArr[t]===e)return void this.changeListenerArr.splice(t,1)}},{key:"setMixMode",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].mixModeStr=t,this.history.push({tool:["canvas"],action:"setMixMode",params:[e,""+t]})}},{key:"setComposite",value:function(e,t){if(!this.layerCanvasArr[e])throw new Error("invalid layer");this.layerCanvasArr[e].compositeObj=t}},{key:"destroy",value:function(){null!==this.layerCanvasArr&&(this.layerCanvasArr.forEach((function(e){ve.freeCanvas(e)})),this.layerCanvasArr=null)}}]),e}();function Ct(e){if(!e)return ze("layers-blend-normal");var t={"source-over":"layers-blend-normal",darken:"layers-blend-darken",multiply:"layers-blend-multiply","color-burn":"layers-blend-color-burn",lighten:"layers-blend-lighten",screen:"layers-blend-screen","color-dodge":"layers-blend-color-dodge",overlay:"layers-blend-overlay","soft-light":"layers-blend-soft-light","hard-light":"layers-blend-hard-light",difference:"layers-blend-difference",exclusion:"layers-blend-exclusion",hue:"layers-blend-hue",saturation:"layers-blend-saturation",color:"layers-blend-color",luminosity:"layers-blend-luminosity"};if(!(e in t))throw new Error("unknown blend mode");return ze(t[e])}a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var St=function(){"use strict";function e(t){I.default(this,e),this.rootElement=ve.createSvg({elementType:"svg",width:""+t.width,height:""+t.height}),ve.css(this.rootElement,{position:"absolute",left:"0",top:"0",pointerEvents:"none",userSelect:"none"}),this.brushCircleOuter=ve.createSvg({elementType:"circle",r:"10",stroke:"rgba(0,0,0,0.7)","stroke-width":"1",fill:"none"}),this.brushCircleInner=ve.createSvg({elementType:"circle",r:"9",stroke:"rgba(255,255,255,0.7)","stroke-width":"1",fill:"none"}),this.rootElement.append(this.brushCircleOuter,this.brushCircleInner),this.pickerPreviewBorder=ve.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"22",fill:"none"}),this.pickerPreviewBorder.style.opacity="0",this.pickerPreviewCol=ve.createSvg({elementType:"circle",r:"47",stroke:"black","stroke-width":"20",fill:"none"}),this.pickerPreviewCol.style.opacity="0",this.rootElement.append(this.pickerPreviewBorder,this.pickerPreviewCol),this.compassSize=30,this.compass=ve.createSvg({elementType:"g",transform:"translate("+t.width/2+", "+t.height/2+")"}),ve.css(this.compass,{transition:"opacity 0.25s ease-in-out",opacity:"0"}),this.compassInner=ve.createSvg({elementType:"g",transform:"rotate(45)"}),this.compassBaseCircle=ve.createSvg({elementType:"circle",fill:"rgba(0,0,0,0.9)",stroke:"none",cx:"0",cy:"0",r:""+this.compassSize}),this.compassLineCircle=ve.createSvg({elementType:"circle",fill:"none",stroke:"rgba(255,255,255,0.75)","stroke-width":"1",cx:"0",cy:"0",r:""+.9*this.compassSize}),this.compassUpperTriangle=ve.createSvg({elementType:"path",fill:"#f00",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,-"+.9*this.compassSize+" z"}),this.compassLowerTriangle=ve.createSvg({elementType:"path",fill:"#fff",stroke:"none",d:"M -"+.25*this.compassSize+",0 "+.25*this.compassSize+",0 0,"+.9*this.compassSize+" z"}),this.compassInner.append(this.compassBaseCircle,this.compassLineCircle,this.compassUpperTriangle,this.compassLowerTriangle),this.compass.append(this.compassInner),this.rootElement.append(this.compass)}return T.default(e,[{key:"getElement",value:function(){return this.rootElement}},{key:"setSize",value:function(e,t){this.rootElement.setAttribute("width",""+e),this.rootElement.setAttribute("height",""+t),this.compass.setAttribute("transform","translate("+e/2+", "+t/2+")")}},{key:"updateCursor",value:function(e){"x"in e&&(this.brushCircleOuter.setAttribute("cx",""+e.x),this.brushCircleInner.setAttribute("cx",""+e.x)),"y"in e&&(this.brushCircleOuter.setAttribute("cy",""+e.y),this.brushCircleInner.setAttribute("cy",""+e.y)),"radius"in e&&(this.brushCircleOuter.setAttribute("r",""+Math.max(0,e.radius)),this.brushCircleInner.setAttribute("r",""+Math.max(0,e.radius-1))),"isVisible"in e&&(this.brushCircleOuter.style.opacity=e.isVisible?"1":"0",this.brushCircleInner.style.opacity=e.isVisible?"1":"0")}},{key:"updateColorPreview",value:function(e){if("x"in e&&(this.pickerPreviewCol.setAttribute("cx",""+e.x),this.pickerPreviewBorder.setAttribute("cx",""+e.x)),"y"in e&&(this.pickerPreviewCol.setAttribute("cy",""+e.y),this.pickerPreviewBorder.setAttribute("cy",""+e.y)),"color"in e){this.pickerPreviewCol.setAttribute("stroke",ve.ColorConverter.toRgbStr(e.color));var t=ve.testIsWhiteBestContrast(e.color)?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";this.pickerPreviewBorder.setAttribute("stroke",t)}"isVisible"in e&&(this.pickerPreviewCol.style.opacity=e.isVisible?"1":"0",this.pickerPreviewBorder.style.opacity=e.isVisible?"1":"0")}},{key:"updateCompass",value:function(e){"angleDeg"in e&&(this.compassInner.setAttribute("transform","rotate("+e.angleDeg+")"),this.compassLineCircle.style.opacity=e.angleDeg%90==0?"1":"0"),"isVisible"in e&&(this.compass.style.opacity=e.isVisible?"1":"0")}}]),e}();a("cf2NR");var kt;I=a("hDZfO"),T=a("3SSYo");kt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("chkV0");var Et;Et=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("hTn63");var Mt;Mt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("k7gZz");var It;It=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("blNtI");var Tt,Rt,Lt=.0625;(Rt=Tt||(Tt={}))[Rt.Draw=0]="Draw",Rt[Rt.Hand=1]="Hand",Rt[Rt.HandGrabbing=2]="HandGrabbing",Rt[Rt.Pick=3]="Pick",Rt[Rt.Zoom=4]="Zoom",Rt[Rt.Rotate=5]="Rotate",Rt[Rt.Rotating=6]="Rotating",Rt[Rt.Fill=7]="Fill",Rt[Rt.Text=8]="Text",Rt[Rt.Shape=9]="Shape";var At=function(){"use strict";function e(t){var n=this;I.default(this,e);var r=this;this.rootEl=ve.el({css:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",cursor:"crosshair",userSelect:"none",colorScheme:"only light"}}),this.klCanvas=t.klCanvas,this.onViewChange=t.onViewChange,this.renderTargetCanvas=ve.canvas(t.width,t.height),this.renderTargetCtx=this.renderTargetCanvas.getContext("2d"),this.renderWidth=t.width,this.renderHeight=t.height,this.compositeCanvas=ve.canvas(1,1),this.compositeCtx=this.compositeCanvas.getContext("2d"),this.doResizeCanvas=!1,this.oldTransformObj=null,this.targetTransformObj={x:0,y:0,scale:1,angle:0},this.highResTransformObj={x:0,y:0,scale:1,angle:0},this.renderedTransformObj={x:null,y:null,scale:null,angle:null},this.cursorPos={x:0,y:0},this.usesCssCursor=!1,this.bgVisible=!0,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.svgOverlay=new St({width:t.width,height:t.height}),ve.css(this.renderTargetCanvas,{userSelect:"none",pointerEvents:"none"}),ve.createCheckerDataUrl(8,(function(e){n.renderTargetCanvas.style.background="url("+e+")"})),this.rootEl.appendChild(this.renderTargetCanvas),this.rootEl.appendChild(this.svgOverlay.getElement()),ve.addEventListener(this.rootEl,"touchend",(function(e){return e.preventDefault(),!1})),ve.addEventListener(this.rootEl,"contextmenu",(function(e){return e.preventDefault(),!1})),ve.addEventListener(this.rootEl,"dragstart",(function(e){return e.preventDefault(),!1})),this.emptyCanvas=ve.canvas(1,1),this.emptyCanvas.getContext("2d").fillRect(0,0,1,1),this.keyListener=new ve.KeyListener({onDown:function(e,t,r,i){if("alt"===e&&t.preventDefault(),!i)if(n.currentInputProcessor)n.currentInputProcessor.onKeyDown(e,t,r,i);else{if([Tt.Draw,Tt.Pick,Tt.Fill,Tt.Text,Tt.Shape].includes(n.globalMode)&&"space"===r)return n.currentInputProcessor=n.inputProcessorObj.spaceHand,void n.currentInputProcessor.onKeyDown(e,t,r,i);if([Tt.Draw,Tt.Hand,Tt.Fill,Tt.Text,Tt.Shape].includes(n.globalMode)&&"alt"===r)return n.currentInputProcessor=n.inputProcessorObj.altPicker,void n.currentInputProcessor.onKeyDown(e,t,r,i);if(["r","shift+r"].includes(r))return n.currentInputProcessor=n.inputProcessorObj.rotate,void n.currentInputProcessor.onKeyDown(e,t,r,i);if("z"===r)return n.currentInputProcessor=n.inputProcessorObj.zoom,void n.currentInputProcessor.onKeyDown(e,t,r,i)}},onUp:function(e,t,r){n.currentInputProcessor&&n.currentInputProcessor.onKeyUp(e,t,r)}}),this.updateChangeListener(),this.currentMode=Tt.Draw,this.globalMode=Tt.Draw,this.renderTime=0,this.lastDrawEvent=null,this.linetoolProcessor=new ve.EventChain.LinetoolProcessor({onDraw:function(e){var r=n,i=function(){var e=r.getRenderedTransform(),t=ve.Matrix.getIdentity();return t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createScaleMatrix(1/e.scale)),t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createRotationMatrix(-e.angle)),t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createTranslationMatrix(-e.x,-e.y))};if("line"===e.type&&!n.lastDrawEvent){var a=i(),o=[e.x1,e.y1,0,1];return o=ve.Matrix.multiplyMatrixAndPoint(a,o),void(n.lastDrawEvent={x:o[0],y:o[1],pressure:e.pressure1})}if("x"in e||"x0"in e){var s=i();if("x"in e){var l=[e.x,e.y,0,1];l=ve.Matrix.multiplyMatrixAndPoint(s,l),e.x=l[0],e.y=l[1]}if("x0"in e){e.x0=n.lastDrawEvent.x,e.y0=n.lastDrawEvent.y,e.pressure0=n.lastDrawEvent.pressure;var c=[e.x1,e.y1,0,1];c=ve.Matrix.multiplyMatrixAndPoint(s,c),e.x1=c[0],e.y1=c[1],n.lastDrawEvent={x:e.x1,y:e.y1,pressure:e.pressure1}}}["down","move"].includes(e.type)&&(n.lastDrawEvent=e),t.onDraw(e)}}),this.pointer=null,this.isDrawing=!1,this.inputProcessorObj={draw:{onPointer:function(e){n.reqFrame(),n.updateCursor(Tt.Draw);var t=n.keyListener.getComboStr(),r={scale:n.highResTransformObj.scale};if(r.shiftIsPressed="shift"===t,r.pressure=e.pressure,r.isCoalesced=!!e.isCoalesced,"pointerdown"===e.type)n.isDrawing=!0,r.type="down";else{if(!e.button)return"pointerup"===e.type?(n.isDrawing=!1,r.type="up",n.linetoolProcessor.process(r),void n.resetInputProcessor()):void 0;r.type="move"}r.x=e.relX,r.y=e.relY,n.linetoolProcessor.process(r)},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},fill:{onPointer:function(e){if(n.reqFrame(),n.updateCursor(Tt.Fill),"pointerdown"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY});t.onFill(Math.floor(r.x),Math.floor(r.y))}else if("pointerup"===e.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},text:{onPointer:function(e){if(n.reqFrame(),n.updateCursor(Tt.Text),"pointerdown"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY});t.onText(Math.floor(r.x),Math.floor(r.y),n.renderedTransformObj.angle)}else if("pointerup"===e.type)return void n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},shape:{onPointer:function(e){n.reqFrame(),n.updateCursor(Tt.Shape);var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY});"pointerdown"===e.type?(n.isDrawing=!0,t.onShape("down",r.x,r.y,n.renderedTransformObj.angle)):"pointermove"===e.type?t.onShape("move",r.x,r.y,n.renderedTransformObj.angle):"pointerup"===e.type&&(n.isDrawing=!1,t.onShape("up",r.x,r.y,n.renderedTransformObj.angle),n.resetInputProcessor())},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},hand:{onPointer:function(e){n.updateCursor(Tt.Hand),["left","middle"].includes(e.button)?(n.updateCursor(Tt.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0)):"pointerup"===e.type&&n.resetInputProcessor()},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},spaceHand:{onPointer:function(e){n.updateCursor(Tt.Hand),["left","middle"].includes(e.button)&&(n.updateCursor(Tt.HandGrabbing),n.targetTransformObj.x+=e.dX,n.targetTransformObj.y+=e.dY,n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.doAnimateTranslate=!1,n.transformIsDirty=!0,n.reqFrame(!0))},onKeyDown:function(e,t,r,i){"space"!==r?n.resetInputProcessor():n.updateCursor(Tt.Hand)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},zoom:{onPointer:function(e){if(n.updateCursor(Tt.Zoom),"left"===e.button&&!e.isCoalesced&&0!=e.dX){var t=e.pageX-e.relX,r=e.pageY-e.relY;n.internalZoomByStep(e.dX/175,e.downPageX-t,e.downPageY-r),n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["scale"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale})}},onKeyDown:function(e,t,r,i){"z"!==r?n.resetInputProcessor():n.updateCursor(Tt.Zoom)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},picker:{onPointer:function(e){if(n.updateCursor(Tt.Pick),["left","right"].includes(e.button)&&!e.isCoalesced||"pointerup"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY}),i=n.klCanvas.getColorAt(r.x,r.y);t.onPick(i,"pointerup"===e.type),n.svgOverlay.updateColorPreview({x:e.relX,y:e.relY,color:i,isVisible:"pointerup"!==e.type}),"pointerup"===e.type&&n.resetInputProcessor()}},onKeyDown:function(e,t,n,r){},onKeyUp:function(e,t,n){}},altPicker:{onPointer:function(e){if(n.updateCursor(Tt.Pick),["left","right"].includes(e.button)&&!e.isCoalesced||"pointerup"===e.type){var r=n.workspaceToCanvasCoord({x:e.relX,y:e.relY}),i=n.klCanvas.getColorAt(r.x,r.y);t.onPick(i,"pointerup"===e.type),n.svgOverlay.updateColorPreview({x:e.relX,y:e.relY,color:i,isVisible:"pointerup"!==e.type})}},onKeyDown:function(e,t,r,i){"alt"!==r?n.resetInputProcessor():n.updateCursor(Tt.Pick)},onKeyUp:function(e,t,r){n.resetInputProcessor()}},rotate:{onPointer:function(e){if(n.updateCursor("left"===e.button?Tt.Rotating:Tt.Rotate),"pointerdown"===e.type&&"left"===e.button)n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj));else if("left"===e.button&&!e.isCoalesced&&n.oldTransformObj){var t=e.pageX-e.relX,r=e.pageY-e.relY,i={x:n.renderWidth/2,y:n.renderHeight/2},a=ve.Vec2.angle(i,{x:e.downPageX-t,y:e.downPageY-r}),o=ve.Vec2.angle(i,{x:e.pageX-t,y:e.pageY-r})-a;n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),n.targetTransformObj.angle+=o,n.keyListener.isPressed("shift")&&(n.targetTransformObj.angle=Math.round(n.targetTransformObj.angle/Math.PI*8)*Math.PI/8,o=n.targetTransformObj.angle-n.oldTransformObj.angle),n.targetTransformObj.angle=n.minimizeAngleRad(n.targetTransformObj.angle);var s=ve.Matrix.getIdentity();s=ve.Matrix.multiplyMatrices(s,ve.Matrix.createTranslationMatrix(i.x,i.y)),s=ve.Matrix.multiplyMatrices(s,ve.Matrix.createRotationMatrix(o)),s=ve.Matrix.multiplyMatrices(s,ve.Matrix.createTranslationMatrix(-i.x,-i.y));var l=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];l=ve.Matrix.multiplyMatrixAndPoint(s,l),n.targetTransformObj.x=l[0],n.targetTransformObj.y=l[1],n.highResTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.transformIsDirty=!0,n.lastRenderedState=-1,n.reqFrame(),n.onViewChange({changed:["angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle})}},onKeyDown:function(e,t,r,i){["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(r)?n.updateCursor(Tt.Rotate):n.resetInputProcessor()},onKeyUp:function(e,t,r){var i=n.keyListener.getComboStr();["r","r+shift","shift+r","r+left","r+right","r+left+right","r+right+left","r+up"].includes(i)?n.updateCursor(Tt.Rotate):n.resetInputProcessor()}}},this.currentInputProcessor=null,this.angleIsExtraSticky=!1,this.pinchZoomer=new ve.EventChain.PinchZoomer({onPinch:function(e){if("move"===e.type){n.oldTransformObj||(n.oldTransformObj=JSON.parse(JSON.stringify(n.targetTransformObj)),n.angleIsExtraSticky=n.targetTransformObj.angle%(Math.PI/2)==0),n.targetTransformObj=JSON.parse(JSON.stringify(n.oldTransformObj)),e.scale=Math.max(Lt,Math.min(64,n.targetTransformObj.scale*e.scale))/n.targetTransformObj.scale,n.targetTransformObj.scale*=e.scale,n.targetTransformObj.angle+=e.angleRad,n.targetTransformObj.angle=n.minimizeAngleRad(n.snapAngleRad(n.targetTransformObj.angle,90,n.angleIsExtraSticky?12:4)),n.targetTransformObj.angle%(Math.PI/2)!=0&&(n.angleIsExtraSticky=!1),e.angleRad=n.targetTransformObj.angle-n.oldTransformObj.angle;var t=ve.Matrix.getIdentity();t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createTranslationMatrix(e.relX,e.relY)),t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createScaleMatrix(e.scale)),t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createRotationMatrix(e.angleRad)),t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createTranslationMatrix(-e.relX,-e.relY)),t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createTranslationMatrix(e.relX-e.downRelX,e.relY-e.downRelY));var r=[n.targetTransformObj.x,n.targetTransformObj.y,0,1];r=ve.Matrix.multiplyMatrixAndPoint(t,r),n.targetTransformObj.x=r[0],n.targetTransformObj.y=r[1],n.highResTransformObj=ve.copyObj(n.targetTransformObj),n.onViewChange({changed:["scale","angle"],scale:n.targetTransformObj.scale,angle:n.targetTransformObj.angle}),n.reqFrame(),n.transformIsDirty=!0,n.lastRenderedState=-1}else"end"===e.type&&(n.oldTransformObj=null)}});var i=function(){var e=JSON.parse(JSON.stringify(n.targetTransformObj));r.fitView(),n.lastRenderedState=-1,n.reqFrame(),e.scale===n.targetTransformObj.scale&&e.angle===n.targetTransformObj.angle||n.onViewChange({changed:["scale","angle"],angle:n.targetTransformObj.angle,scale:n.targetTransformObj.scale})};this.mainDoubleTapper=new ve.EventChain.DoubleTapper({onDoubleTap:i}),this.middleDoubleTapper=new ve.EventChain.DoubleTapper({onDoubleTap:i}),this.middleDoubleTapper.setAllowedButtonArr(["middle"]),this.twoFingerTap=new ve.EventChain.NFingerTapper({fingers:2,onTap:function(){t.onUndo()}}),this.threeFingerTap=new ve.EventChain.NFingerTapper({fingers:3,onTap:function(){t.onRedo()}}),this.pointerEventChain=new ve.EventChain.EventChain({chainArr:[this.twoFingerTap,this.threeFingerTap,this.mainDoubleTapper,this.middleDoubleTapper,this.pinchZoomer,new ve.EventChain.OnePointerLimiter,new ve.EventChain.CoalescedExploder]}),this.pointerEventChain.setChainOut((function(e){if(n.cursorPos.x=e.relX,n.cursorPos.y=e.relY,"pointerup"===e.type&&"touch"===e.pointerType?(n.pointer=null,n.lastRenderedState=-1,n.reqFrame()):(n.pointer||(n.pointer={x:0,y:0}),n.pointer.x=e.relX,n.pointer.y=e.relY),n.currentInputProcessor)n.currentInputProcessor.onPointer(e);else{var t=n.keyListener.getComboStr();n.globalMode===Tt.Draw?["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.draw,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(Tt.Draw),n.reqFrame()):n.globalMode===Tt.Hand?"pointerdown"===e.type&&["left","middle"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):n.updateCursor(Tt.Hand):n.globalMode===Tt.Pick?"pointerdown"===e.type&&["left","right"].includes(e.button)?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):n.updateCursor(Tt.Pick):n.globalMode===Tt.Fill?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.fill,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(Tt.Fill),n.reqFrame()):n.globalMode===Tt.Text?"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.text,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(Tt.Text),n.reqFrame()):n.globalMode===Tt.Shape&&(["","shift","ctrl"].includes(t)&&"pointerdown"===e.type&&"left"===e.button?(n.currentInputProcessor=n.inputProcessorObj.shape,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"right"===e.button?(n.currentInputProcessor=n.inputProcessorObj.picker,n.currentInputProcessor.onPointer(e)):[""].includes(t)&&"pointerdown"===e.type&&"middle"===e.button?(n.currentInputProcessor=n.inputProcessorObj.hand,n.currentInputProcessor.onPointer(e)):(n.updateCursor(Tt.Shape),n.reqFrame()))}})),ve.addEventListener(this.rootEl,"wheel",(function(e){e.preventDefault()})),setTimeout((function(){var e=n;n.pointerListener=new ve.PointerListener({target:n.rootEl,fixScribble:!0,onPointer:function(t){if("pointerdown"===t.type&&"middle"===t.button)try{t.eventPreventDefault()}catch(e){}e.pointerEventChain.chainIn(t)},onWheel:function(t){e.isDrawing||(e.reqFrame(),e.internalZoomByStep(-t.deltaY/(e.keyListener.isPressed("shift")?8:2),t.relX,t.relY)&&e.onViewChange({changed:["scale"],angle:e.targetTransformObj.angle,scale:e.targetTransformObj.scale}),e.lastRenderedState=-1)},onEnterLeave:function(t){t||e.isDrawing||(e.pointer=null,e.lastRenderedState=-1)},maxPointers:4})}),1),this.brushRadius=1,this.animationFrameRequested=!1,this.lastRenderedState=-2,this.lastRenderTime=performance.now(),window.requestAnimationFrame((function(){return n.updateLoop()})),this.resetView()}return T.default(e,[{key:"getRenderedTransform",value:function(){var e=this.renderedTransformObj;return e.x=this.highResTransformObj.x,e.y=this.highResTransformObj.y,e.scale=this.highResTransformObj.scale,e.angle=this.highResTransformObj.angle,e.angle%(Math.PI/2)==0&&e.scale%1==0&&(e.x=Math.round(e.x),e.y=Math.round(e.y)),e}},{key:"updateChangeListener",value:function(){var e=this;this.klCanvas.addChangeListener((function(){e.lastRenderedState=-1,e.reqFrame()}))}},{key:"updateCursor",value:function(e,n){if(e!==this.currentMode||n){var r=this.currentMode;if(this.currentMode=e,this.lastRenderedState=-1,this.currentMode===Tt.Draw?this.rootEl.style.cursor="crosshair":this.currentMode===Tt.Hand?this.rootEl.style.cursor="grab":this.currentMode===Tt.HandGrabbing?this.rootEl.style.cursor="grabbing":this.currentMode===Tt.Pick?this.rootEl.style.cursor="url('"+t(kt)+"') 0 15, crosshair":this.currentMode===Tt.Zoom?this.rootEl.style.cursor="url('"+t(Et)+"') 7 7, zoom-in":this.currentMode===Tt.Rotate?this.rootEl.style.cursor="grab":this.currentMode===Tt.Rotating?this.rootEl.style.cursor="grabbing":this.currentMode===Tt.Fill?this.rootEl.style.cursor="url('"+t(Mt)+"') 1 12, crosshair":this.currentMode===Tt.Text?this.rootEl.style.cursor="url('"+t(It)+"') 1 12, crosshair":this.currentMode===Tt.Shape&&(this.rootEl.style.cursor="crosshair"),[Tt.Draw,Tt.Pick,Tt.Fill,Tt.Text,Tt.Shape].includes(this.globalMode)){var i=[Tt.Hand,Tt.HandGrabbing].includes(r),a=[Tt.Hand,Tt.HandGrabbing].includes(this.currentMode);!i&&a&&this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"]),i&&!a&&this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])}this.currentMode!==Tt.Pick&&this.svgOverlay.updateColorPreview({isVisible:!1})}}},{key:"internalZoomByStep",value:function(e,t,n){var r=Math.log2(this.targetTransformObj.scale)/Math.abs(e);r+=e>0?1:-1,r=Math.round(r),r*=Math.abs(e);var i=Math.max(Lt,Math.min(64,Math.pow(2,r)));if(i===this.targetTransformObj.scale)return!1;var a=i/this.targetTransformObj.scale;this.targetTransformObj.scale=i;var o=ve.Matrix.getIdentity();o=ve.Matrix.multiplyMatrices(o,ve.Matrix.createTranslationMatrix(t,n)),o=ve.Matrix.multiplyMatrices(o,ve.Matrix.createScaleMatrix(a)),o=ve.Matrix.multiplyMatrices(o,ve.Matrix.createTranslationMatrix(-t,-n));var s=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];return s=ve.Matrix.multiplyMatrixAndPoint(o,s),this.targetTransformObj.x=s[0],this.targetTransformObj.y=s[1],this.transformIsDirty=!0,!0}},{key:"mixTransformObj",value:function(e,t,n){if(e.angle===t.angle)return e.scale=ve.mix(e.scale,t.scale,n),e.x=ve.mix(e.x,t.x,n),e.y=ve.mix(e.y,t.y,n),void(e.angle=ve.mix(e.angle,t.angle,n));var r=this.klCanvas.getWidth(),i=this.klCanvas.getHeight(),a=this.canvasToWorkspaceCoord({x:r/2,y:i/2},e),o=this.canvasToWorkspaceCoord({x:r/2,y:i/2},t);e.x=ve.mix(a.x,o.x,n),e.y=ve.mix(a.y,o.y,n),e.scale=ve.mix(e.scale,t.scale,n),e.angle=ve.mix(e.angle,t.angle,n);var s=this.canvasToWorkspaceCoord({x:-r/2,y:-i/2},e);e.x=s.x,e.y=s.y}},{key:"render",value:function(){this.doResizeCanvas&&(this.doResizeCanvas=!1,this.renderTargetCanvas.width=this.renderWidth,this.renderTargetCanvas.height=this.renderHeight),this.renderContext(this.renderTargetCtx)}},{key:"testBgVisible",value:function(){var e=[[0,0],[this.renderWidth,0],[this.renderWidth,this.renderHeight],[0,this.renderHeight]],t=this.getRenderedTransform(),n=ve.Matrix.getIdentity();n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createScaleMatrix(1/t.scale)),n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createRotationMatrix(-t.angle)),n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createTranslationMatrix(-t.x,-t.y));for(var r=0;r<e.length;r++){var i=[e[r][0],e[r][1],0,1];if(!(0<=(i=ve.Matrix.multiplyMatrixAndPoint(n,i))[0]&&i[0]<=this.klCanvas.getWidth()&&0<=i[1]&&i[1]<=this.klCanvas.getHeight()))return!0}return!1}},{key:"renderContext",value:function(e){var t=this.klCanvas.getWidth(),n=this.klCanvas.getHeight(),r=this.getRenderedTransform();if(r.scale>=4||1===r.scale&&0===r.angle?e.imageSmoothingEnabled=!1:(e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="low"),e.save(),this.bgVisible?(e.fillStyle="rgb(158,158,158)",e.fillRect(0,0,this.renderWidth,this.renderHeight)):e.clearRect(0,0,this.renderWidth,this.renderHeight),this.bgVisible){e.save(),e.translate(r.x,r.y),e.scale(r.scale,r.scale),e.rotate(r.angle),e.imageSmoothingEnabled=!1;e.globalAlpha=.2,e.drawImage(this.emptyCanvas,-1/r.scale,-1/r.scale,t+2/r.scale,n+2/r.scale),e.globalAlpha=1,e.globalCompositeOperation="destination-out",e.drawImage(this.emptyCanvas,0,0,t,n),e.restore()}e.translate(r.x,r.y),e.scale(r.scale,r.scale),e.rotate(r.angle);for(var i=this.klCanvas.getLayersFast(),a=0;a<i.length;a++)i[a].opacity>0&&(e.globalAlpha=i[a].opacity,e.globalCompositeOperation=i[a].mixModeStr,i[a].canvas.compositeObj?(this.compositeCanvas.width!==i[a].canvas.width||this.compositeCanvas.height!==i[a].canvas.height?(this.compositeCanvas.width=i[a].canvas.width,this.compositeCanvas.height=i[a].canvas.height):this.compositeCtx.clearRect(0,0,this.compositeCanvas.width,this.compositeCanvas.height),this.compositeCtx.drawImage(i[a].canvas,0,0),i[a].canvas.compositeObj.draw(this.compositeCtx),e.drawImage(this.compositeCanvas,0,0,t,n)):e.drawImage(i[a].canvas,0,0,t,n));e.globalAlpha=1,e.restore(),Tt.Rotate===this.currentMode||Tt.Rotating===this.currentMode?this.svgOverlay.updateCompass({isVisible:!0,angleDeg:r.angle/Math.PI*180}):this.svgOverlay.updateCompass({isVisible:!1})}},{key:"workspaceToCanvasCoord",value:function(e){var t=this.getRenderedTransform(),n=ve.Matrix.getIdentity();n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createScaleMatrix(1/t.scale)),n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createRotationMatrix(-t.angle)),n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createTranslationMatrix(-t.x,-t.y));var r=[e.x,e.y,0,1];return{x:(r=ve.Matrix.multiplyMatrixAndPoint(n,r))[0],y:r[1]}}},{key:"canvasToWorkspaceCoord",value:function(e,t){var n=ve.Matrix.getIdentity();n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createTranslationMatrix(t.x,t.y)),n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createRotationMatrix(t.angle)),n=ve.Matrix.multiplyMatrices(n,ve.Matrix.createScaleMatrix(t.scale));var r=[e.x,e.y,0,1];return{x:(r=ve.Matrix.multiplyMatrixAndPoint(n,r))[0],y:r[1]}}},{key:"snapAngleRad",value:function(e,t,n){var r=180*e/Math.PI,i=Math.abs(r%t);return Math.min(i,t-i)<=n&&(r=Math.round(r/t)*t),r/180*Math.PI}},{key:"minimizeAngleRad",value:function(e){return(e%=2*Math.PI)>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),e}},{key:"resetInputProcessor",value:function(){this.currentInputProcessor=null,this.updateCursor(this.globalMode),this.reqFrame(!0)}},{key:"reqFrame",value:function(e){this.animationFrameRequested=!0,e&&(this.lastRenderedState=-1)}},{key:"updateLoop",value:function(){var e=this;window.requestAnimationFrame((function(){return e.updateLoop()}));var t=we.getState(),n=this.lastRenderedState<t,r=performance.now(),i=60*(r-this.lastRenderTime)/1e3;this.lastRenderTime=r,(this.animationFrameRequested||n)&&(this.animationFrameRequested=!1,this.checkChange(i))}},{key:"checkChange",value:function(e){var t=we.getState(),n=this.lastRenderedState<t||this.highResTransformObj.scale!==this.targetTransformObj.scale||this.highResTransformObj.x!==this.targetTransformObj.x||this.highResTransformObj.y!==this.targetTransformObj.y;if(!this.doAnimateTranslate&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else if((this.highResTransformObj.x===this.targetTransformObj.x||Math.abs(this.highResTransformObj.x-this.targetTransformObj.x)<.5)&&(this.highResTransformObj.y===this.targetTransformObj.y||Math.abs(this.highResTransformObj.y-this.targetTransformObj.y)<.5)&&(this.highResTransformObj.scale===this.targetTransformObj.scale||Math.abs(this.highResTransformObj.scale-this.targetTransformObj.scale)<.008*this.targetTransformObj.scale))this.highResTransformObj.scale=this.targetTransformObj.scale,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.highResTransformObj.angle=this.targetTransformObj.angle,this.doAnimateTranslate=!1,this.transformIsDirty&&(this.transformIsDirty=!1,this.bgVisible=this.testBgVisible()),this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale});else{this.reqFrame();var r=Math.min(1,.3*e);this.mixTransformObj(this.highResTransformObj,this.targetTransformObj,r),this.bgVisible=!0,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale})}if(this.pointer&&this.currentMode==Tt.Draw&&!this.usesCssCursor?this.svgOverlay.updateCursor({x:this.pointer.x,y:this.pointer.y,isVisible:!0}):this.svgOverlay.updateCursor({isVisible:!1}),n){this.lastRenderedState=t;var i=performance.now();this.render(),this.renderTime=ve.mix(this.renderTime,performance.now()-i,.05)}}},{key:"getElement",value:function(){return this.rootEl}},{key:"setCanvas",value:function(e){this.klCanvas=e,this.lastDrawEvent=null,this.resetView(),this.updateChangeListener(),this.lastRenderedState=-1,this.reqFrame()}},{key:"setSize",value:function(e,t){var n=this.renderWidth,r=this.renderHeight;e===n&&t===r||(this.doResizeCanvas=!0,this.renderWidth=e,this.renderHeight=t,this.svgOverlay.setSize(e,t),this.targetTransformObj.x+=(e-n)/2,this.targetTransformObj.y+=(t-r)/2,this.highResTransformObj.x=this.targetTransformObj.x,this.highResTransformObj.y=this.targetTransformObj.y,this.bgVisible=this.testBgVisible(),this.lastRenderedState=-1,this.reqFrame())}},{key:"setMode",value:function(e){"draw"===e&&(this.globalMode=Tt.Draw,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"fill"===e&&(this.globalMode=Tt.Fill,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"text"===e&&(this.globalMode=Tt.Text,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"shape"===e&&(this.globalMode=Tt.Shape,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"])),"hand"===e&&(this.globalMode=Tt.Hand,this.mainDoubleTapper.setAllowedPointerTypeArr(["mouse","pen","touch"])),"pick"===e&&(this.globalMode=Tt.Pick,this.mainDoubleTapper.setAllowedPointerTypeArr(["touch"]))}},{key:"setEnabled",value:function(e){}},{key:"setCursorSize",value:function(e){if(this.brushRadius=e/2,this.svgOverlay.updateCursor({radius:this.brushRadius*this.highResTransformObj.scale}),null===this.pointer){var t=this;clearTimeout(this.hideBrushCursorTimeout),this.svgOverlay.updateCursor({x:this.renderWidth/2,y:this.renderHeight/2,isVisible:!0}),this.hideBrushCursorTimeout=setTimeout((function(){null===t.pointer&&t.svgOverlay.updateCursor({isVisible:!1})}),500)}}},{key:"zoomByStep",value:function(e){this.internalZoomByStep(e,this.renderWidth/2,this.renderHeight/2)&&(this.lastRenderedState=-1,this.reqFrame(),this.onViewChange({changed:["scale"],angle:this.targetTransformObj.angle,scale:this.targetTransformObj.scale}))}},{key:"resetView",value:function(e){this.targetTransformObj.scale=1,this.targetTransformObj.angle=0,this.targetTransformObj.x=(this.renderWidth-this.klCanvas.getWidth())/2,this.targetTransformObj.y=(this.renderHeight-this.klCanvas.getHeight())/2,e?(this.doAnimateTranslate=!0,this.transformIsDirty=!0):this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.bgVisible=this.testBgVisible(),this.reqFrame(),e&&this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle})}},{key:"fitView",value:function(){var e=[[0,0],[this.klCanvas.getWidth(),0],[this.klCanvas.getWidth(),this.klCanvas.getHeight()],[0,this.klCanvas.getHeight()],[this.klCanvas.getWidth()/2,this.klCanvas.getHeight()/2]],t=ve.Matrix.getIdentity();t=ve.Matrix.multiplyMatrices(t,ve.Matrix.createRotationMatrix(this.targetTransformObj.angle));for(var n=0;n<e.length;n++){var r=[e[n][0],e[n][1],0,1];r=ve.Matrix.multiplyMatrixAndPoint(t,r),e[n][0]=r[0],e[n][1]=r[1]}for(var i={x0:null,y0:null,x1:null,y1:null},a=0;a<e.length;a++)(null===i.x0||e[a][0]<i.x0)&&(i.x0=e[a][0]),(null===i.y0||e[a][1]<i.y0)&&(i.y0=e[a][1]),(null===i.x1||e[a][0]>i.x1)&&(i.x1=e[a][0]),(null===i.y1||e[a][1]>i.y1)&&(i.y1=e[a][1]);var o=i.x1-i.x0,s=i.y1-i.y0,l=ve.fitInto(o,s,this.renderWidth-40,this.renderHeight-40,1).width/o;this.targetTransformObj.x=this.renderWidth/2-(e[4][0]-e[0][0])*l,this.targetTransformObj.y=this.renderHeight/2-(e[4][1]-e[0][1])*l,this.targetTransformObj.scale=l,this.doAnimateTranslate=!0,this.transformIsDirty=!0,this.reqFrame(),this.onViewChange({changed:["scale","angle"],scale:this.targetTransformObj.scale,angle:this.targetTransformObj.angle})}},{key:"setAngle",value:function(e,t){var n={x:this.renderWidth/2,y:this.renderHeight/2},r=this.targetTransformObj.angle,i=e/180*Math.PI;t?this.targetTransformObj.angle+=i:this.targetTransformObj.angle=i,this.targetTransformObj.angle=this.minimizeAngleRad(this.snapAngleRad(this.targetTransformObj.angle,90,4));var a=ve.Matrix.getIdentity();a=ve.Matrix.multiplyMatrices(a,ve.Matrix.createTranslationMatrix(n.x,n.y)),a=ve.Matrix.multiplyMatrices(a,ve.Matrix.createRotationMatrix(this.targetTransformObj.angle-r)),a=ve.Matrix.multiplyMatrices(a,ve.Matrix.createTranslationMatrix(-n.x,-n.y));var o=[this.targetTransformObj.x,this.targetTransformObj.y,0,1];o=ve.Matrix.multiplyMatrixAndPoint(a,o),this.targetTransformObj.x=o[0],this.targetTransformObj.y=o[1],this.highResTransformObj=JSON.parse(JSON.stringify(this.targetTransformObj)),this.transformIsDirty=!0,this.reqFrame(!0)}},{key:"translateView",value:function(e,t){this.targetTransformObj.x+=40*e,this.targetTransformObj.y+=40*t,this.transformIsDirty=!0,this.doAnimateTranslate=!0,this.reqFrame(!0)}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"getScale",value:function(){return this.targetTransformObj.scale}},{key:"getAngleDeg",value:function(){return 180*this.targetTransformObj.angle/Math.PI}},{key:"getMaxScale",value:function(){return 64}},{key:"getMinScale",value:function(){return Lt}},{key:"requestFrame",value:function(){this.lastRenderedState=-1,this.reqFrame()}},{key:"setLastDrawEvent",value:function(e,t,n){null!==e?(this.lastDrawEvent||(this.lastDrawEvent={x:0,y:0,pressure:0}),this.lastDrawEvent.x=e,this.lastDrawEvent.y=t,this.lastDrawEvent.pressure=n):this.lastDrawEvent=null}}]),e}();function Pt(e){var t=function(){o.save(),o.clearRect(0,0,a.width,a.height);for(var t=0;t<e.layers.length;t++)o.globalAlpha=e.layers[t].opacity,o.globalCompositeOperation=e.layers[t].mixModeStr,a.width>e.layers[t].image.width&&(o.imageSmoothingEnabled=!1),o.drawImage(e.layers[t].image,0,0,a.width,a.height);o.restore()},n=e.width/e.layers[0].image.width,r=n>1?e.layers[0].image.width:e.width,i=n>1?e.layers[0].image.height:e.height,a=ve.canvas(r,i);a.style.backgroundImage="url("+ve.createCheckerDataUrl(8)+")";var o=a.getContext("2d");ve.css(a,{width:"100%",height:"100%",imageRendering:n>1?"pixelated":null}),setTimeout(t,0),this.getElement=function(){return a},this.render=function(){t()}}a("cf2NR");var Ot;I=a("hDZfO"),T=a("3SSYo");function Dt(e){if(Math.abs(e.angleDeg)%90==0){e.width=Math.round(e.width),e.height=Math.round(e.height);var t=Math.abs(e.angleDeg-90)%180==0;e.x=(t?e.height:e.width)%2==0?Math.round(e.x):Math.round(e.x-.5)+.5,e.y=(t?e.width:e.height)%2==0?Math.round(e.y):Math.round(e.y-.5)+.5}}function Bt(e){return{x:e.x,y:e.y,width:e.width,height:e.height,angleDeg:e.angleDeg}}function zt(e,t,n){var r,i;r=e-n.x,i=t-n.y;var a=ve.rotateAround({x:0,y:0},{x:r,y:i},-n.angleDeg);return{x:r=a.x,y:i=a.y}}function jt(e,t,n){var r=ve.rotateAround({x:0,y:0},{x:e,y:t},n.angleDeg);return{x:r.x+n.x,y:r.y+n.y}}Ot=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("5hkqh");var Ht=function(){"use strict";function e(n){var r=this;I.default(this,e);this.scaled={x:0,y:0,width:0,height:0,corners:[{x:0,y:0}]},this.minSnapDist=7,this.cornerCursors=["nw","n","ne","e","se","s","sw","w"],this.gripSize=14,this.edgeSize=10,this.corners=[],this.edges=[],this.transform={x:n.x,y:n.y,width:n.width,height:n.height,angleDeg:n.angleDeg},this.isConstrained=!!n.isConstrained,this.snapX=n.snapX,this.snapY=n.snapY,this.callback=n.callback,this.scale=n.scale,this.snappingEnabled=!0,this.ratio=this.transform.width/this.transform.height,this.rootEl=ve.el({className:"kl-free-transform",css:{userSelect:"none"}}),this.transEl=ve.el({parent:this.rootEl,css:{position:"absolute"}}),this.boundsEl=ve.el({css:{position:"absolute",cursor:"move",boxShadow:"rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px"}});var i={x:0,y:0};this.keyListener=new ve.KeyListener({});var a,o={x:0,y:0};this.boundsPointerListener=new ve.PointerListener({target:this.boundsEl,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointerdown"===e.type&&(o={x:r.transform.x,y:r.transform.y}),"pointermove"===e.type&&"left"===e.button){var t;r.transform.x=o.x+(e.pageX-e.downPageX)/r.scale,r.transform.y=o.y+(e.pageY-e.downPageY)/r.scale;var n={};if(r.snappingEnabled){var i,a;for(i=0;i<r.snapX.length;i++)(t=Math.abs(r.transform.x-r.snapX[i]))<r.minSnapDist/r.scale&&(!n.x||t<n.distX)&&(n.x=r.snapX[i],n.distX=t);for(i=0;i<r.snapY.length;i++)(t=Math.abs(r.transform.y-r.snapY[i]))<r.minSnapDist/r.scale&&(!n.y||t<n.distY)&&(n.y=r.snapY[i],n.distY=t);for(i=0;i<4;i++){a=jt(r.corners[i].x,r.corners[i].y,r.transform);var s=void 0;for(s=0;s<r.snapX.length;s++)(t=Math.abs(a.x-r.snapX[s]))<r.minSnapDist/r.scale&&(!n.x||t<n.distX)&&(n.x=r.snapX[s]-(a.x-r.transform.x),n.distX=t);for(s=0;s<r.snapY.length;s++)(t=Math.abs(a.y-r.snapY[s]))<r.minSnapDist/r.scale&&(!n.y||t<n.distY)&&(n.y=r.snapY[s]-(a.y-r.transform.y),n.distY=t)}}if("shift"===r.keyListener.getComboStr()){var l=ve.projectPointOnLine({x:0,y:o.y},{x:10,y:o.y},{x:r.transform.x,y:r.transform.y}),c=ve.dist(l.x,l.y,r.transform.x,r.transform.y);(n={}).x=l.x,n.y=l.y,n.distX=c,n.distY=c,l=ve.projectPointOnLine({x:o.x,y:0},{x:o.x,y:10},{x:r.transform.x,y:r.transform.y}),(c=ve.dist(l.x,l.y,r.transform.x,r.transform.y))<n.distX&&(n.x=l.x,n.y=l.y,n.distX=c,n.distY=c),l=ve.projectPointOnLine({x:o.x,y:o.y},{x:o.x+1,y:o.y+1},{x:r.transform.x,y:r.transform.y}),(c=ve.dist(l.x,l.y,r.transform.x,r.transform.y))<n.distX&&(n.x=l.x,n.y=l.y,n.distX=c,n.distY=c),l=ve.projectPointOnLine({x:o.x,y:o.y},{x:o.x+1,y:o.y-1},{x:r.transform.x,y:r.transform.y}),(c=ve.dist(l.x,l.y,r.transform.x,r.transform.y))<n.distX&&(n.x=l.x,n.y=l.y,n.distX=c,n.distY=c)}null!=n.x&&(r.transform.x=n.x),null!=n.y&&(r.transform.y=n.y),Math.abs(r.transform.angleDeg)%90==0&&(Dt(r.transform),r.updateCornerPositions()),r.updateDOM()}}});for(var s=0;s<4;s++)!function(e){var t=r,n=r.corners[e]={i:e,el:ve.el({css:{width:r.gripSize+"px",height:r.gripSize+"px",background:"#fff",borderRadius:r.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,virtualPos:{x:0,y:0},updateDOM:null,pointerListener:null};n.updateDOM=function(){var r=t,i=[[-1,-1],[1,-1],[1,1],[-1,1]].map((function(e){return e[0]*=r.transform.width>0?1:-1,e[1]*=r.transform.height>0?1:-1,e})),a=Math.abs(t.scaled.width)<20||Math.abs(t.scaled.height)<20?10:0;ve.css(n.el,{left:t.scaled.corners[n.i].x-t.gripSize/2+i[e][0]*a+"px",top:t.scaled.corners[n.i].y-t.gripSize/2+i[e][1]*a+"px"});for(var o=ve.pointsToAngleDeg({x:t.transform.x,y:t.transform.y},jt(n.x,n.y,t.transform))+135;o<0;)o+=360;var s=Math.round(o/45)%t.cornerCursors.length;ve.css(n.el,{cursor:t.cornerCursors[s]+"-resize"})},n.pointerListener=new ve.PointerListener({target:r.corners[e].el,fixScribble:!0,onPointer:function(n){if(n.eventPreventDefault(),"pointerdown"===n.type&&"left"===n.button)t.corners[e].virtualPos=jt(t.corners[e].x,t.corners[e].y,t.transform);else if("pointermove"===n.type&&"left"===n.button){t.corners[e].virtualPos.x+=n.dX/t.scale,t.corners[e].virtualPos.y+=n.dY/t.scale;var r={x:t.corners[e].virtualPos.x,y:t.corners[e].virtualPos.y};r=t.constrainCorner(e,r.x,r.y),t.isConstrained||(r=t.snapCorner(r.x,r.y)),Math.abs(t.transform.angleDeg)%90==0&&(r.x=Math.round(r.x),r.y=Math.round(r.y));var i=zt(r.x,r.y,t.transform),a=i.x-t.corners[e].x,o=i.y-t.corners[e].y;t.corners[e].x=i.x,t.corners[e].y=i.y;var s=[];0===e?s=[3,1,2]:1===e?s=[2,0,3]:2===e?s=[1,3,0]:3===e&&(s=[0,2,1]),t.corners[s[0]].x=t.corners[e].x,t.corners[s[1]].y=t.corners[e].y,t.keyListener.isPressed("shift")&&(t.corners[s[2]].x-=a,t.corners[s[2]].y-=o,t.corners[s[1]].x=t.corners[s[2]].x,t.corners[s[0]].y=t.corners[s[2]].y),t.updateTransformViaCorners()}}})}(s);this.updateCornerPositions(),this.updateScaled();for(var l=0;l<4;l++)!function(e){var t=r;r.edges[e]={el:ve.el({css:{width:r.edgeSize+"px",height:r.edgeSize+"px",position:"absolute"}}),updateDOM:null,pointerListener:null};var n=r.edges[e];n.updateDOM=function(){0===e?ve.css(n.el,{left:Math.min(t.scaled.corners[0].x,t.scaled.corners[1].x)+"px",top:Math.min(t.scaled.corners[0].y,t.scaled.corners[3].y)-t.edgeSize+"px",width:Math.abs(t.scaled.width)+"px",height:t.edgeSize+"px"}):1===e?ve.css(n.el,{left:Math.max(t.scaled.corners[0].x,t.scaled.corners[1].x)+"px",top:Math.min(t.scaled.corners[1].y,t.scaled.corners[2].y)+"px",width:t.edgeSize+"px",height:Math.abs(t.scaled.height)+"px"}):2===e?ve.css(n.el,{left:Math.min(t.scaled.corners[3].x,t.scaled.corners[2].x)+"px",top:Math.max(t.scaled.corners[0].y,t.scaled.corners[3].y)+"px",width:Math.abs(t.scaled.width)+"px",height:t.edgeSize+"px"}):3===e&&ve.css(n.el,{left:Math.min(t.scaled.corners[0].x,t.scaled.corners[1].x)-t.edgeSize+"px",top:Math.min(t.scaled.corners[0].y,t.scaled.corners[3].y)+"px",width:t.edgeSize+"px",height:Math.abs(t.scaled.height)+"px"});for(var r=Math.round(t.transform.angleDeg/45);r<0;)r+=8;r=(2*e+1+r)%t.cornerCursors.length,n.el.style.cursor=t.cornerCursors[r]+"-resize"};var o=[0,2].includes(e);n.pointerListener=new ve.PointerListener({target:r.edges[e].el,fixScribble:!0,onPointer:function(n){if(n.eventPreventDefault(),"pointerdown"===n.type&&"left"===n.button&&(a=o?t.corners[0].y>=t.corners[3].y:t.corners[0].x>=t.corners[1].x,i.x=0,i.y=0),"pointermove"===n.type&&"left"===n.button){var r=ve.rotateAround({x:0,y:0},{x:n.dX/t.scale,y:n.dY/t.scale},-t.transform.angleDeg),s={dX:r.x,dY:r.y};Math.abs(t.transform.angleDeg)%90==0&&(s=ve.intDxy(i,r.x,r.y));var l=[];0===e?l=[2,3,0,1]:1===e?l=[0,3,1,2]:2===e?l=[0,1,2,3]:3===e&&(l=[1,2,0,3]);var c=o?"y":"x",u=o?s.dY:s.dX;a?(t.corners[l[0]][c]+=u,t.corners[l[1]][c]+=u):(t.corners[l[2]][c]+=u,t.corners[l[3]][c]+=u),t.keyListener.isPressed("shift")&&(a?(t.corners[l[2]][c]-=u,t.corners[l[3]][c]-=u):(t.corners[l[0]][c]-=u,t.corners[l[1]][c]-=u)),o?t.restoreRatio(!1,!0):t.restoreRatio(!0,!1),t.updateTransformViaCorners()}}})}(l);this.angleGrip={el:ve.el({css:{cursor:"url("+t(Ot)+") 10 10, move",width:this.gripSize+"px",height:this.gripSize+"px",background:"#0ff",borderRadius:this.gripSize+"px",position:"absolute",boxShadow:"inset 0 0 0 2px #000"}}),x:0,y:0,snap:!1,updateDOM:function(){ve.css(r.angleGrip.el,{left:r.angleGrip.x-r.gripSize/2+"px",top:r.angleGrip.y-r.gripSize/2+"px"})}},ve.el({parent:this.angleGrip.el,css:{width:"2px",height:"13px",left:this.gripSize/2-1+"px",top:this.gripSize+"px",background:"#0ff",position:"absolute"}}),this.anglePointerListener=new ve.PointerListener({target:this.angleGrip.el,fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=r.rootEl.getBoundingClientRect(),n={x:t.left-r.rootEl.scrollLeft,y:t.top-r.rootEl.scrollTop},i={x:(e.clientX-n.x)/r.scale,y:(e.clientY-n.y)/r.scale},a=ve.pointsToAngleDeg({x:r.transform.x,y:r.transform.y},i)+90;r.transform.angleDeg=a;var o=45*Math.round(a/360*8);("shift"===r.keyListener.getComboStr()||r.snappingEnabled&&Math.abs(o-a)<8)&&(r.transform.angleDeg=o),r.updateDOM()}"pointerup"===e.type&&Math.abs(r.transform.angleDeg)%90==0&&(Dt(r.transform),r.updateCornerPositions(),r.updateDOM())}}),Dt(this.transform),this.updateDOM(!0),ve.append(this.transEl,[this.boundsEl,this.edges[0].el,this.edges[1].el,this.edges[2].el,this.edges[3].el,this.corners[0].el,this.corners[1].el,this.corners[2].el,this.corners[3].el,this.angleGrip.el])}return T.default(e,[{key:"updateScaled",value:function(){var e=this;this.scaled.x=this.transform.x*this.scale,this.scaled.y=this.transform.y*this.scale,this.scaled.width=this.transform.width*this.scale,this.scaled.height=this.transform.height*this.scale,this.scaled.corners=this.corners.map((function(t){return{x:t.x*e.scale,y:t.y*e.scale}}))}},{key:"snapCorner",value:function(e,t){if(!this.snappingEnabled)return{x:e,y:t};for(var n,r,i,a={x:null,y:null,dist:{x:null,y:null}},o=0;o<this.snapX.length;o++)(n=Math.abs(e-this.snapX[o]))<this.minSnapDist/this.scale&&(null===a.x||n<a.dist.x)&&(a.x=this.snapX[o],a.dist.x=n);for(var s=0;s<this.snapY.length;s++)(n=Math.abs(t-this.snapY[s]))<this.minSnapDist/this.scale&&(null===a.y||n<a.dist.y)&&(a.y=this.snapY[s],a.dist.y=n);return null===a.x&&null===a.y?{x:e,y:t}:{x:null!==(r=a.x)&&void 0!==r?r:e,y:null!==(i=a.y)&&void 0!==i?i:t}}},{key:"constrainCorner",value:function(e,t,n){if(!this.isConstrained)return{x:t,y:n};var r=this.transform.width*this.transform.height<0?-1:1;return ve.projectPointOnLine({x:this.transform.x,y:this.transform.y},jt(this.ratio,r*([0,2].includes(e)?1:-1),this.transform),{x:t,y:n})}},{key:"updateCornerPositions",value:function(){this.corners[0].x=-this.transform.width/2,this.corners[0].y=-this.transform.height/2,this.corners[1].x=this.transform.width/2,this.corners[1].y=-this.transform.height/2,this.corners[2].x=this.transform.width/2,this.corners[2].y=this.transform.height/2,this.corners[3].x=-this.transform.width/2,this.corners[3].y=this.transform.height/2}},{key:"restoreRatio",value:function(e,t){if(this.isConstrained){var n=Math.abs(this.transform.angleDeg)%90==0,r=Math.abs(this.transform.angleDeg-90)%180==0;if(t&&!e){var i=Math.abs(this.corners[3].y-this.corners[0].y),a=this.ratio*i;n&&(a=0==(r?this.transform.y%1:this.transform.x%1)?ve.roundEven(a):ve.roundUneven(a)),this.corners[1].x-this.corners[0].x<0&&(a*=-1),this.corners[0].x=-a/2,this.corners[3].x=-a/2,this.corners[1].x=a/2,this.corners[2].x=a/2}if(!t&&e){var o=Math.abs(this.corners[0].x-this.corners[1].x)/this.ratio;n&&(o=0==(r?this.transform.x%1:this.transform.y%1)?ve.roundEven(o):ve.roundUneven(o)),this.corners[3].y-this.corners[0].y<0&&(o*=-1),this.corners[0].y=-o/2,this.corners[1].y=-o/2,this.corners[2].y=o/2,this.corners[3].y=o/2}}}},{key:"updateTransformViaCorners",value:function(){var e=ve.rotateAround({x:0,y:0},{x:(this.corners[0].x+this.corners[1].x)/2,y:(this.corners[0].y+this.corners[3].y)/2},this.transform.angleDeg);this.transform.x=e.x+this.transform.x,this.transform.y=e.y+this.transform.y,this.transform.width=this.corners[1].x-this.corners[0].x,this.transform.height=this.corners[3].y-this.corners[0].y,this.updateCornerPositions(),this.updateDOM()}},{key:"updateDOM",value:function(e){this.updateScaled(),ve.css(this.transEl,{left:this.scaled.x+"px",top:this.scaled.y+"px",transformOrigin:"0 0",transform:"rotate("+this.transform.angleDeg+"deg)"}),ve.css(this.boundsEl,{width:Math.abs(this.scaled.width)+"px",height:Math.abs(this.scaled.height)+"px",left:Math.min(this.scaled.corners[0].x,this.scaled.corners[1].x)+"px",top:Math.min(this.scaled.corners[0].y,this.scaled.corners[3].y)+"px"}),this.corners[0].updateDOM(),this.corners[1].updateDOM(),this.corners[2].updateDOM(),this.corners[3].updateDOM(),this.edges[0].updateDOM(),this.edges[1].updateDOM(),this.edges[2].updateDOM(),this.edges[3].updateDOM(),this.angleGrip.x=0,this.angleGrip.y=-Math.abs(this.transform.height*this.scale)/2-20,this.angleGrip.updateDOM(),e||this.callback&&this.callback(Bt(this.transform))}},{key:"getTransform",value:function(){return Bt(this.transform)}},{key:"setConstrained",value:function(e){this.isConstrained=!!e,e&&0!==this.transform.width&&0!==this.transform.height&&(this.ratio=Math.abs(this.transform.width/this.transform.height))}},{key:"setSnapping",value:function(e){this.snappingEnabled=!!e}},{key:"setPos",value:function(e){this.transform.x=e.x,this.transform.y=e.y,this.updateDOM(!0)}},{key:"move",value:function(e,t){this.transform.x+=e,this.transform.y+=t,this.updateDOM(!1)}},{key:"setSize",value:function(e,t){this.transform.width=e,this.transform.height=t,Math.abs(this.transform.angleDeg)%90==0&&Dt(this.transform),this.updateCornerPositions(),this.updateDOM(!1)}},{key:"setAngleDeg",value:function(e){this.transform.angleDeg=e,Math.abs(this.transform.angleDeg)%90==0&&(Dt(this.transform),this.updateCornerPositions()),this.updateDOM(!0)}},{key:"getElement",value:function(){return this.rootEl}},{key:"getRatio",value:function(){return this.ratio}},{key:"destroy",value:function(){this.keyListener.destroy(),this.boundsPointerListener.destroy(),this.corners[0].pointerListener.destroy(),this.corners[1].pointerListener.destroy(),this.corners[2].pointerListener.destroy(),this.corners[3].pointerListener.destroy(),this.edges[0].pointerListener.destroy(),this.edges[1].pointerListener.destroy(),this.edges[2].pointerListener.destroy(),this.edges[3].pointerListener.destroy(),this.anglePointerListener.destroy()}}]),e}();function Ft(e){var t=function(){if(s){var t=s.getTransform();r<1&&(t.x*=r,t.y*=r,t.width*=r,t.height*=r);var n=o[e.transformIndex].image,i=n.getContext("2d");i.save(),i.clearRect(0,0,n.width,n.height),ve.drawTransformedImageWithBounds(i,e.layers[e.transformIndex].image,t,null,ve.testShouldPixelate(t,t.width/l.width,t.height/l.height)),i.restore(),c.render()}},n=ve.fitInto(e.imageWidth,e.imageHeight,e.elementWidth-20,e.elementHeight-60,1),r=n.width/e.imageWidth,i=ve.el({css:{width:e.elementWidth+"px",height:e.elementHeight+"px",backgroundColor:"#9e9e9e",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"}});i.oncontextmenu=function(){return!1};var a=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:n.width+"px",height:n.height+"px"}});i.appendChild(a);var o=e.layers.map((function(e){return{image:e.image,mixModeStr:e.mixModeStr,opacity:e.opacity}}));o[o.length-1].image=ve.canvas(r>1?e.imageWidth:n.width,r>1?e.imageHeight:n.height);var s,l,c=new Pt({width:n.width,height:n.height,layers:o});a.appendChild(c.getElement());var u={width:e.layers[e.transformIndex].image.width*r,height:e.layers[e.transformIndex].image.height*r};(u.width>n.width||u.height>n.height)&&(u=ve.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,n.width,n.height,1)),l={x:e.imageWidth/2,y:e.imageHeight/2,width:e.layers[e.transformIndex].image.width,height:e.layers[e.transformIndex].image.height},s=new Ht({x:l.x,y:l.y,width:l.width,height:l.height,angleDeg:0,isConstrained:!0,snapX:[0,e.imageWidth],snapY:[0,e.imageHeight],scale:r,callback:function(e){t()}}),ve.css(s.getElement(),{position:"absolute",left:"0",top:"0"}),a.appendChild(s.getElement()),setTimeout(t,0),this.move=function(e,t){s.move(e,t)},this.reset=function(){var n=e.layers[e.transformIndex].image.width,r=e.layers[e.transformIndex].image.height;s.setSize(n,r),s.setPos({x:n/2,y:r/2}),s.setAngleDeg(0),t()},this.setTransformFit=function(){var n=ve.fitInto(e.layers[e.transformIndex].image.width,e.layers[e.transformIndex].image.height,e.imageWidth,e.imageHeight,1);s.setSize(n.width,n.height),s.setPos({x:n.width/2,y:n.height/2}),s.setAngleDeg(0),t()},this.setTransformCenter=function(){s.setPos({x:e.imageWidth/2,y:e.imageHeight/2}),s.setAngleDeg(0),t()},this.getTransformation=function(){return!!s&&s.getTransform()},this.getIsPixelated=function(){var e=s.getTransform();return ve.testShouldPixelate(e,e.width/l.width,e.height/l.height)},this.getElement=function(){return i},this.destroy=function(){s.destroy()}}function Nt(e){var t=function(e){E[0].y+=e,E[0].y=Math.max(E[3].y-f,Math.min(E[3].y-1,E[0].y)),E[1].y=E[0].y},n=function(e){E[1].x+=e,E[1].x=Math.min(E[0].x+g,Math.max(E[0].x+1,E[1].x)),E[2].x=E[1].x},r=function(e){E[2].y+=e,E[2].y=Math.min(E[1].y+f,Math.max(E[1].y+1,E[2].y)),E[3].y=E[2].y},i=function(e){E[0].x+=e,E[0].x=Math.max(E[1].x-g,Math.min(E[1].x-1,E[0].x)),E[3].x=E[0].x},a=function(){b.x=0,b.y=0,p(o())},o=function(){return E[1].x-=E[0].x,E[1].y-=E[0].y,E[2].x-=E[0].x,E[2].y-=E[0].y,E[3].x-=E[0].x,E[3].y-=E[0].y,l+=E[0].x,c+=E[0].y,E[0].x=0,E[0].y=0,{x:l,y:c,width:E[1].x,height:E[2].y}},s=function(){M[0].update(),M[1].update(),M[2].update(),M[3].update(),D[0].update(),D[1].update(),D[2].update(),D[3].update(),T[0].update(),T[1].update(),T[2].update(),T[3].update(),x.update(),C.update(),S.update()},l=e.x,c=e.y,u=e.width,h=e.height,d=e.scale,p=e.callback,g=e.maxW,f=e.maxH,m=document.createElement("div"),v=["nw","n","ne","e","se","s","sw","w"],y=new ve.KeyListener({});ve.css(m,{position:"absolute",left:l*d+"px",top:c*d+"px"});var x=document.createElement("div");ve.css(x,{position:"absolute",border:"1px dashed #fff",cursor:"move"}),x.update=function(){ve.css(x,{left:E[0].x*d-1+"px",top:E[0].y*d-1+"px",width:(E[2].x-E[0].x)*d+"px",height:(E[2].y-E[0].y)*d+"px"})};var b={x:0,y:0},w=new ve.PointerListener({target:x,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=ve.intDxy(b,e.dX/d,e.dY/d),n=t.dX,r=t.dY;E[0].x+=n,E[0].y+=r,E[1].x+=n,E[1].y+=r,E[2].x+=n,E[2].y+=r,E[3].x+=n,E[3].y+=r,s()}"pointerup"===e.type&&a()}}),C=document.createElement("div");ve.css(C,{position:"absolute",borderTop:"1px solid #0ff",borderBottom:"1px solid #0ff"}),C.update=function(){ve.css(C,{left:E[0].x*d+"px",top:(E[0].y+(E[2].y-E[0].y)/3)*d+"px",width:(E[2].x-E[0].x)*d+"px",height:(E[2].y-E[0].y)/3*d+"px"})};var S=document.createElement("div");ve.css(S,{position:"absolute",borderLeft:"1px solid #0ff",borderRight:"1px solid #0ff"}),S.update=function(){ve.css(S,{left:(E[0].x+(E[2].x-E[0].x)/3)*d+"px",top:E[0].y*d+"px",width:(E[2].x-E[0].x)/3*d+"px",height:(E[2].y-E[0].y)*d+"px"})};for(var k=10,E=[{x:0,y:0},{x:u,y:0},{x:u,y:h},{x:0,y:h}],M=[],I=0;I<4;I++)!function(e){M[e]=document.createElement("div");var t=M[e];t.style.width="40px",t.style.height="40px",t.style.position="absolute",t.update=function(){0===e?(t.style.left=E[0].x*d+k+"px",t.style.top=E[0].y*d-80+k+"px",t.style.width=(E[1].x-E[0].x)*d-20+"px",t.style.height="80px"):1===e?(t.style.left=E[1].x*d-k+"px",t.style.top=E[1].y*d+k+"px",t.style.width="80px",t.style.height=(E[2].y-E[1].y)*d-20+"px"):2===e?(t.style.left=E[3].x*d+k+"px",t.style.top=E[3].y*d-k+"px",t.style.width=(E[2].x-E[3].x)*d-20+"px",t.style.height="80px"):3===e&&(t.style.left=E[0].x*d-80+k+"px",t.style.top=E[0].y*d+k+"px",t.style.width="80px",t.style.height=(E[3].y-E[0].y)*d-20+"px");var n=2*e+1;t.style.cursor=v[n]+"-resize"}}(I);for(var T=[],R=0;R<4;R++)!function(e){T[e]=document.createElement("div");var t=T[e];t.style.position="absolute",t.style.background="#000",t.style.opacity="0.5",t.update=function(){0===e?(t.style.left=E[0].x*d+"px",t.style.top=E[0].y*d-8e3+"px",t.style.width=(E[1].x-E[0].x)*d+"px",t.style.height="8000px"):1===e?(t.style.left=E[1].x*d+"px",t.style.top=E[1].y*d-8e3+"px",t.style.width="8000px",t.style.height="16000px"):2===e?(t.style.left=E[3].x*d+"px",t.style.top=E[3].y*d+"px",t.style.width=(E[2].x-E[3].x)*d+"px",t.style.height="8000px"):3===e&&(t.style.left=E[0].x*d-8e3+"px",t.style.top=E[0].y*d-8e3+"px",t.style.width="8000px",t.style.height="16000px")}}(R);var L=new ve.PointerListener({target:M[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=ve.intDxy(b,e.dX/d,e.dY/d),i=(n.dX,n.dY);t(i),y.isPressed("shift")&&r(-i),s()}"pointerup"===e.type&&a()}}),A=new ve.PointerListener({target:M[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=ve.intDxy(b,e.dX/d,e.dY/d),r=t.dX;t.dY;n(r),y.isPressed("shift")&&i(-r),s()}"pointerup"===e.type&&a()}}),P=new ve.PointerListener({target:M[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var n=ve.intDxy(b,e.dX/d,e.dY/d),i=(n.dX,n.dY);r(i),y.isPressed("shift")&&t(-i),s()}"pointerup"===e.type&&a()}}),O=new ve.PointerListener({target:M[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var t=ve.intDxy(b,e.dX/d,e.dY/d),r=t.dX;t.dY;i(r),y.isPressed("shift")&&n(-r),s()}"pointerup"===e.type&&a()}}),D=[];!function(){for(var e=0;e<4;e++)!function(e){D[e]=document.createElement("div");var t=D[e];ve.css(t,{width:"80px",height:"80px",position:"absolute"}),t.style.cursor=["nwse-resize","nesw-resize"][e%2],t.update=function(){0===e?ve.css(t,{left:E[0].x*d-80+k+"px",top:E[0].y*d-80+k+"px"}):1===e?ve.css(t,{left:E[1].x*d-k+"px",top:E[1].y*d-80+k+"px"}):2===e?ve.css(t,{left:E[1].x*d-k+"px",top:E[2].y*d-k+"px"}):3===e&&ve.css(t,{left:E[0].x*d-80+k+"px",top:E[2].y*d-k+"px"})}}(e)}();var B=new ve.PointerListener({target:D[0],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=ve.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;i(l),t(c),y.isPressed("shift")&&(n(-l),r(-c)),s()}"pointerup"===e.type&&a()}}),z=new ve.PointerListener({target:D[1],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=ve.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;n(l),t(c),y.isPressed("shift")&&(i(-l),r(-c)),s()}"pointerup"===e.type&&a()}}),j=new ve.PointerListener({target:D[2],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=ve.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;n(l),r(c),y.isPressed("shift")&&(i(-l),t(-c)),s()}"pointerup"===e.type&&a()}}),H=new ve.PointerListener({target:D[3],fixScribble:!0,onPointer:function(e){if(e.eventPreventDefault(),"pointermove"===e.type&&"left"===e.button){var o=ve.intDxy(b,e.dX/d,e.dY/d),l=o.dX,c=o.dY;i(l),r(c),y.isPressed("shift")&&(n(-l),t(-c)),s()}"pointerup"===e.type&&a()}});m.append(T[1],T[0],T[2],T[3],C,S,x,M[1],M[0],M[2],M[3],D[0],D[1],D[2],D[3]),s(),this.getTransform=o,this.setTransform=function(e){l=e.x,c=e.y,u=e.width,h=e.height,ve.css(m,{left:l*d+"px",top:c*d+"px"}),E[0].x=0,E[0].y=0,E[1].x=u,E[1].y=0,E[2].x=u,E[2].y=h,E[3].x=0,E[3].y=h,s(),a()},this.setScale=function(e){d=e,ve.css(m,{left:l*d+"px",top:c*d+"px"}),s()},this.showThirds=function(e){e?(C.style.display="block",S.style.display="block"):(C.style.display="none",S.style.display="none")},this.getElement=function(){return m},this.destroy=function(){y.destroy(),w.destroy(),B.destroy(),z.destroy(),j.destroy(),H.destroy(),L.destroy(),A.destroy(),P.destroy(),O.destroy()}}var _t;_t=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("dyCML");var Xt;Xt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("7Ni0l");var Ut;Ut=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("iTYjK");var Yt;Yt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("ao3EV");var Wt;Wt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("aHpN6");var Vt;Vt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("8jhwW");var Gt;Gt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("dd7wR");var Kt;Kt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("bPk42");var qt;qt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("jwKq0");var Zt;Zt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("hSaP4");var Jt;function Qt(e){var n=function(e){var t={},n=ve.el({parent:S,className:"tool-dropdown-button",title:e.title,css:{padding:"10px 0",height:100/(s.length-1)+"%",boxSizing:"border-box"},onClick:function(t){t.preventDefault(),t.stopPropagation(),e.onClick(e.index,e.id)}});t.wrapper=n;ve.el({parent:n,css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",height:"100%",pointerEvents:"none",opacity:"0.75"}});return t.show=function(e){n.style.display=e?"block":"none"},t.setIsSmall=function(e){n.style.padding=e?m:"10px 0"},t},r=function(t,n){a(),h=!0,u=t,o(),e.onChange(s[u])},i=function(){Se.increase(.5),d=!0;for(var t=0;t<s.length;t++)k[t].show(u!==t);w.style.display="none",v.style.zIndex="1",e.klRootEl.appendChild(C),v.appendChild(S)},a=function(){Se.decrease(.5),d=!1,w.style.removeProperty("display"),v.style.removeProperty("z-index"),e.klRootEl.removeChild(C),v.removeChild(S)},o=function(){x.title=c[u],b.style.backgroundImage="url('"+l[u]+"')"},s=["draw","fill","text","shape"],l=[t(Gt),t(Kt),t(qt),t(Zt)],c=["".concat(ze("tool-brush")," [B]"),"".concat(ze("tool-paint-bucket")," [G]"),"".concat(ze("tool-text")," [T]"),"".concat(ze("tool-shape")," [U]")],u=0,h=!0,d=!1;setTimeout((function(){for(var e=1;e<l.length;e++){(new Image).src=l[e]}}),100);var p,g,f,m="6px 0",v=ve.el({css:{position:"relative",flexGrow:"1"}}),y=!1;ve.hasPointerEvents&&new ve.PointerListener({target:v,maxPointers:1,onPointer:function(t){if("pointerdown"===t.type){if(d)return;p=setTimeout((function(){i()}),400),y=!0,g=t.pageX,f=t.pageY}else if("pointermove"===t.type)y&&!d&&ve.dist(g,f,t.pageX,t.pageY)>5&&(clearTimeout(p),i());else if("pointerup"===t.type){if(clearTimeout(p),d&&y)for(var n=document.elementFromPoint(t.pageX,t.pageY),r=0;r<k.length;r++)if(n===k[r].wrapper){a(),h=!0,u=r,o(),e.onChange(s[u]);break}y=!1}}});for(var x=ve.el({parent:v,className:"toolspace-row-button nohighlight toolspace-row-button-activated",title:c[u],onClick:function(t){if(h&&!d)return t.preventDefault(),t.stopPropagation(),void i();h=!0,e.onChange(s[u]),d&&a()},css:{padding:"10px 0",pointerEvents:"auto",height:"100%",boxSizing:"border-box"}}),b=ve.el({parent:x,css:{backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"contain",width:"calc(100% - 7px)",height:"100%",pointerEvents:"none",opacity:"0.75"}}),w=ve.el({parent:x,css:{position:"absolute",right:"1px",bottom:"1px",width:"18px",height:"18px",cursor:"pointer",backgroundImage:"url('"+t(Jt)+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:"60%"},title:"More Tools",onClick:function(e){e.preventDefault(),e.stopPropagation(),i()}}),C=ve.el({css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"}}),S=(new ve.PointerListener({target:C,pointers:1,onPointer:function(e){"pointerdown"===e.type&&(e.eventPreventDefault(),a())}}),ve.el({className:"tool-dropdown-wrapper",css:{position:"absolute",width:"100%",height:100*(s.length-1)+"%",top:"100%",left:"0",zIndex:"1",boxSizing:"border-box",cursor:"pointer",transition:"height 0.1s ease-in-out, opacity 0.1s ease-in-out",borderBottomLeftRadius:"5px",borderBottomRightRadius:"5px",overflow:"hidden"}})),k=[],E=0;E<s.length;E++)k.push(n({index:E,id:s[E],image:l[E],title:c[E],onClick:r}));o(),this.setIsSmall=function(e){x.style.padding=e?m:"10px 0";for(var t=0;t<s.length;t++)k[t].setIsSmall(e);e?(w.style.width="14px",w.style.height="14px"):(w.style.width="18px",w.style.height="18px")},this.setActive=function(e){if(s.includes(e)){h=!0;for(var t=0;t<s.length;t++)if(s[t]===e){u=t;break}ve.addClassName(x,"toolspace-row-button-activated"),o()}else h=!1,ve.removeClassName(x,"toolspace-row-button-activated")},this.getActive=function(){return s[u]},this.getElement=function(){return v}}Jt=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("d5TL5");var $t;$t=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("bwHmE");var en;en=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("2HRWr");var tn;tn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("hozz0");var nn;nn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("7MADq");var rn;rn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("knlRM");var an;an=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("louD5");var on;on=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("g0o7l"),a("cf2NR");var sn,ln=a("2EcGA");sn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("haldc");var cn;cn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("dAfZw");var un;un=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("7t9Dm");var hn;hn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("aGqvb");var dn;dn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("jiH2w");var pn,gn,fn={};function mn(){if(!pn){pn={"source-over":"normal",darken:"darken",multiply:"multiply","color-burn":"color burn",lighten:"lighten",screen:"screen","color-dodge":"color dodge",overlay:"overlay","soft-light":"soft light","hard-light":"hard light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"},gn={};for(var e=Object.keys(pn),t=0;t<e.length;t++)gn[pn[e[t]]]=e[t]}}function vn(e){return mn(),gn[e]}function yn(e){return mn(),pn[e]}function xn(e){var t=function(e){i.warningArr||(i.warningArr=[]),i.warningArr.includes(e)||i.warningArr.push(e)},n=function(e){var n=vn(e);return n||(t("blend-mode"),n="source-over"),n},r=function(e,t){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height);if(0===t)for(var i=0;i<r.data.length;i+=4)r.data[i+3]=r.data[i];else for(var a=0;a<r.data.length;a+=4)r.data[a+3]=255-r.data[a];n.putImageData(r,0,0)},i={type:"psd",canvas:e.canvas,width:e.width,height:e.height};if(8!==e.bitsPerChannel&&t("bits-per-channel"),!e.children)return i.error=!0,i;var a=0;if(a+=function e(n){var r=0;if(n.blendMode){var i=vn(n.blendMode);if(i&&"source-over"!==i)return 1}for(var a=0;a<n.children.length;a++){var o=n.children[a];o.clipping||o.adjustment||(o.children?(t("group"),r+=e(o)):r++)}return r}(e),a>16)return i.error=!0,i;return i.layers=[],i.layers=function e(a){var o,s,l=[],c=a.hidden?0:a.opacity,h=n(a.blendMode);"source-over"!==h&&(s=(o=u(i.width,i.height)).getContext("2d")),a.mask&&(t("mask"),r(a.mask.canvas,a.mask.defaultColor));for(var d=0;d<a.children.length;d++){var p=a.children[d];if(!p.clipping)if(p.adjustment)t("adjustment");else{var g=(p.children||p.canvas)&&a.children[d+1]&&a.children[d+1].clipping;if(g&&t("clipping"),p.children)for(var f=e(p),m=0;m<f.length;m++){var v=f[m],y=v.image.getContext("2d");if(g){var x=u(i.width,i.height),b=x.getContext("2d");b.drawImage(v.image,0,0);for(var w=d+1;w<a.children.length&&a.children[w].clipping;w++){var C=a.children[w];0===C.opacity||C.hidden||(b.globalCompositeOperation=n(C.blendMode),b.globalAlpha=C.opacity,b.drawImage(C.canvas,C.left,C.top))}y.globalCompositeOperation="source-atop",y.drawImage(x,0,0)}a.mask&&(y.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",y.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),o?(s.globalCompositeOperation=v.mixModeStr,s.globalAlpha=v.opacity,s.drawImage(v.image,0,0)):(v.opacity=v.opacity*c,l.push(v))}else{var S=u(i.width,i.height),k=S.getContext("2d");if(p.canvas&&k.drawImage(p.canvas,p.left,p.top),p.effects&&t("layer-effect"),p.mask&&(t("mask"),r(p.mask.canvas,p.mask.defaultColor),k.globalCompositeOperation=0===p.mask.defaultColor?"destination-in":"destination-out",k.drawImage(p.mask.canvas,p.mask.left,p.mask.top)),g){var E=u(p.right-p.left,p.bottom-p.top),M=E.getContext("2d");M.drawImage(p.canvas,0,0);for(var I=d+1;I<a.children.length&&a.children[I].clipping;I++){var T=a.children[I];0===T.opacity||T.hidden||(M.globalCompositeOperation=n(T.blendMode),M.globalAlpha=T.opacity,M.drawImage(T.canvas,T.left-p.left,T.top-p.top))}k.globalCompositeOperation="source-atop",k.drawImage(E,p.left,p.top)}a.mask&&(k.globalCompositeOperation=0===a.mask.defaultColor?"destination-in":"destination-out",k.drawImage(a.mask.canvas,a.mask.left,a.mask.top)),o?c>0&&(s.globalCompositeOperation=n(p.blendMode),s.globalAlpha=p.hidden?0:p.opacity,s.drawImage(S,0,0)):l.push({name:p.name,opacity:(p.hidden?0:p.opacity)*c,mixModeStr:n(p.blendMode),image:S})}}}return o&&(l=[{name:a.name,opacity:c,mixModeStr:h,image:o}]),l}({name:"root",opacity:1,blendMode:"normal",children:e.children}),i}function bn(e){var t={width:e.width,height:e.height,layers:[]};return e.layers?t.layers=t.layers.concat(e.layers.map((function(e){return{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,image:e.image}}))):t.layers.push({name:ze("background"),opacity:1,mixModeStr:"source-over",image:e.canvas}),t}e(fn,"blendPsdToKl",(function(){return vn})),e(fn,"blendKlToPsd",(function(){return yn})),e(fn,"readPsd",(function(){return xn})),e(fn,"klPsdToKlProject",(function(){return bn}));var wn={};e(wn,"setDbName",(function(){return En})),e(wn,"getKlProjectObj",(function(){return In})),e(wn,"storeKlProjectObj",(function(){return Tn})),e(wn,"clear",(function(){return Rn}));var Cn=!!window.indexedDB,Sn="Klecks",kn="ProjectStore";function En(e){Sn=""+e}function Mn(e,t,n){var r=function(e){i||(i=!0,n(e))},i=!1;if(Cn){var a;try{a=window.indexedDB.open(Sn,1)}catch(e){return void r(e.message)}a.onupgradeneeded=function(e){try{a.result.createObjectStore(kn,{keyPath:"id"}).createIndex("id","id",{unique:!0})}catch(e){r(e.message)}},a.onerror=function(e){r("indexedDB.open failed, "+a.error)},a.onsuccess=function(n){var o,s,l;try{if(!(o=a.result).objectStoreNames.contains(kn))return window.indexedDB.deleteDatabase(Sn),void r("object store ProjectStore missing. destroying db");(l=(s=o.transaction(kn,"readwrite")).objectStore(kn)).index("id")}catch(e){return void r(e.message)}o.onerror=function(e){r("database error, "+o.error)};try{e(l)}catch(e){return void r(e.message)}s.oncomplete=function(){i||(i=!0,t()),o.close()},s.onerror=function(){r("transaction error, "+s.error)}}}else setTimeout((function(){r("no indexed db available")}),0)}function In(e,t){var n;Cn?Mn((function(e){n=e.get(1)}),(function(){e(n.result)}),(function(e){t("execIndexedDBTransaction error, "+e)})):e(null)}function Tn(e,t,n){Mn((function(t){t.put(e)}),(function(){t()}),(function(e){n(e)}))}function Rn(e,t){Mn((function(e){e.delete(1)}),(function(){e()}),(function(e){t(e)}))}var Ln;Ln=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("69LYT");var An;An=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("a7L6K");var Pn;Pn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("hGj7H");var On;On=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("e15bs");var Dn;Dn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("l8Jmo");var Bn;Bn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("h4IKM");var zn;zn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("dGn60");var jn;jn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("80Qzz");var Hn;Hn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("hFIw6");var Fn;Fn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("cv8EA");var Nn;Nn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("3FgCK");var _n;_n=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("iU63i");var Xn;Xn=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("70875");var Un={isLoaded:!1},Yn={glBrightnessContrast:{lang:{name:"filter-bright-contrast-title",button:"filter-bright-contrast"},name:"",buttonLabel:"",webgl:!0,updateContext:!0,icon:t(Ln),updatePos:!1,getDialog:null,apply:null,inEmbed:!0},cropExtend:{lang:{name:"filter-crop-title",button:"filter-crop-extend"},name:"",buttonLabel:"",icon:t(An),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!0,getDialog:null,apply:null,inEmbed:!1},glCurves:{lang:{name:"filter-curves-title",button:"filter-curves"},name:"",buttonLabel:"",icon:t(Pn),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},flip:{lang:{name:"filter-flip-title",button:"filter-flip"},name:"",buttonLabel:"",icon:t(On),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},glHueSaturation:{lang:{name:"filter-hue-sat-title",button:"filter-hue-sat"},name:"",buttonLabel:"",icon:t(Dn),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},invert:{lang:{name:"filter-invert",button:"filter-invert"},name:"",icon:t(Bn),webgl:!0,updateContext:!0,updatePos:!1,isInstant:!0,getDialog:null,apply:null,inEmbed:!0},glPerspective:{lang:{name:"filter-perspective-title",button:"filter-perspective"},name:"",buttonLabel:"",icon:t(zn),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},resize:{lang:{name:"filter-resize-title",button:"filter-resize"},name:"",buttonLabel:"",icon:t(jn),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!0,getDialog:null,apply:null,inEmbed:!1},rotate:{lang:{name:"filter-rotate-title",button:"filter-rotate"},name:"",buttonLabel:"",icon:t(an),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!0,getDialog:null,apply:null,inEmbed:!1},glTiltShift:{lang:{name:"filter-tilt-shift-title",button:"filter-tilt-shift"},name:"",buttonLabel:"",icon:t(Hn),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},toAlpha:{lang:{name:"filter-to-alpha-title",button:"filter-to-alpha"},name:"",buttonLabel:"",icon:t(Fn),webgl:!0,updateContext:!1,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},transform:{lang:{name:"filter-transform-title",button:"filter-transform"},name:"",buttonLabel:"",icon:t(Nn),webgl:!1,neededWithWebGL:!0,updateContext:!0,updatePos:!1,ieFails:!0,getDialog:null,apply:null,inEmbed:!0},glBlur:{lang:{name:"filter-triangle-blur-title",button:"filter-triangle-blur"},name:"",buttonLabel:"",icon:t(_n),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0},glUnsharpMask:{lang:{name:"filter-unsharp-mask-title",button:"filter-unsharp-mask"},name:"",buttonLabel:"",icon:t(Xn),webgl:!0,updateContext:!0,updatePos:!1,getDialog:null,apply:null,inEmbed:!0}};function Wn(){Object.keys(Yn).forEach((function(e){Yn[e].name=ze(Yn[e].lang.name),Yn[e].buttonLabel=ze(Yn[e].lang.button)}))}Wn(),Be.subscribe((function(){Wn()}));var Vn={};function Gn(e,t,n){this.x=e,this.y=t,this.z=n}Gn.prototype.dot2=function(e,t){return this.x*e+this.y*t};var Kn=[new Gn(1,1,0),new Gn(-1,1,0),new Gn(1,-1,0),new Gn(-1,-1,0),new Gn(1,0,1),new Gn(-1,0,1),new Gn(1,0,-1),new Gn(-1,0,-1),new Gn(0,1,1),new Gn(0,-1,1),new Gn(0,1,-1),new Gn(0,-1,-1)],qn=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],Zn=new Array(512),Jn=new Array(512);Vn.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n=void 0;n=1&t?qn[t]^255&e:qn[t]^e>>8&255,Zn[t]=Zn[t+256]=n,Jn[t]=Jn[t+256]=Kn[n%12]}},Vn.seed(0);var Qn=.5*(Math.sqrt(3)-1),$n=(3-Math.sqrt(3))/6;Vn.simplex2=function(e,t){var n,r,i=(e+t)*Qn,a=Math.floor(e+i),o=Math.floor(t+i),s=(a+o)*$n,l=e-a+s,c=t-o+s;l>c?(n=1,r=0):(n=0,r=1);var u=l-n+$n,h=c-r+$n,d=l-1+2*$n,p=c-1+2*$n,g=Jn[(a&=255)+Zn[o&=255]],f=Jn[a+n+Zn[o+r]],m=Jn[a+1+Zn[o+1]],v=.5-l*l-c*c,y=.5-u*u-h*h,x=.5-d*d-p*p;return 70*((v<0?0:(v*=v)*v*g.dot2(l,c))+(y<0?0:(y*=y)*y*f.dot2(u,h))+(x<0?0:(x*=x)*x*m.dot2(d,p)))};var er=Vn;function tr(e){for(var t=e/500,n=e,r=ve.canvas(e,n),i=r.getContext("2d"),a=i.createImageData(e,n),o=0;o<e;o++)for(var s=0;s<n;s++){var l=4*(s*e+o),c=t+.04*er.simplex2(o/50/t,s/50/t),u=100+(er.simplex2(o/50/c,s/50/c)+1)/2*100;u-=(er.simplex2(o/10/t,s/10/t)+1)/2*100;var h=ve.dist(e/2,n/2,o,s);u*=ve.clamp(1-((h-e/2.5)/(e/14)+er.simplex2(o/22/c,s/22/c)),0,1),u*=2*ve.clamp(1-h/e,0,1),a.data[l]=0,a.data[l+1]=0,a.data[l+2]=0,a.data[l+3]=ve.clamp(u,0,255)}return i.putImageData(a,0,0),r}function nr(e,t,n){var r=ve.Vec2.sub(n,t),i=ve.Vec2.sub(e,t),a=ve.clamp(ve.Vec2.dot(i,r)/ve.Vec2.dot(r,r),0,1);return ve.Vec2.len(ve.Vec2.sub(i,ve.Vec2.mul(r,a)))}function rr(e){var t=.25;for(var n={x:t*e,y:e-e*t},r={x:e-e*t,y:t*e},i=e,a=ve.canvas(e,i),o=a.getContext("2d"),s=o.createImageData(e,i),l=0;l<e;l++)for(var c=0;c<i;c++){var u=4*(c*e+l),h=nr({x:l,y:c},n,r);h=ve.clamp(255-(h-.16666666666666666*e)/(.08333333333333333*e)*255,0,255),s.data[u]=0,s.data[u+1]=0,s.data[u+2]=0,s.data[u+3]=h}return o.putImageData(s,0,0),a}var ir=[];ir[1]=tr(128),ir[2]=rr(128),a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var ar=256;function or(e,t,n){return e<=t?t:e>=n?n:e}var sr=function(){"use strict";function e(){I.default(this,e),this.isTesting=!1,this.size=29,this.opacity=.6,this.blending=.65,this.settingLockLayerAlpha=!1,this.settingSizePressure=!0,this.settingOpacityPressure=!1,this.blendCol={r:0,g:0,b:0,a:1},this.blendMix=.45,this.isDrawing=!1,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0}}return T.default(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=ve.updateBounds(this.redrawBounds,e)}},{key:"getCellsWidth",value:function(){return Math.ceil(this.context.canvas.width/ar)}},{key:"drawChangedCells",value:function(){var e=this,t=this.cells.map((function(e){return null}));this.getTouchedCells(this.redrawBounds).forEach((function(n,r){n&&(t[r]=e.cells[r])})),this.drawCells(t),this.redrawBounds=null}},{key:"getTouchedCells",value:function(e){for(var t=this.cells.map((function(e){return!1})),n=this.getCellsWidth(),r=(e={x1:Math.floor(e.x1/ar),y1:Math.floor(e.y1/ar),x2:Math.floor(e.x2/ar),y2:Math.floor(e.y2/ar)}).x1;r<=e.x2;r++)for(var i=e.y1;i<=e.y2;i++)t[i*n+r]=!0;return t}},{key:"sliceBounds",value:function(e){var t=this,n=this.getCellsWidth(),r=[];return this.getTouchedCells(e).forEach((function(i,a){if(i){var o=a%n*ar,s=Math.floor(a/n)*ar,l=t.cells[a].width,c=t.cells[a].height,u={x1:Math.max(0,e.x1-o),y1:Math.max(0,e.y1-s),x2:Math.min(l-1,e.x2-o),y2:Math.min(c-1,e.y2-s)};u.x1>u.x2||u.y1>u.y2||r.push({index:a,bounds:u})}})),r}},{key:"copyFromCanvas",value:function(e){var t=this;if(e){var n=this.getTouchedCells(e),r=this.getCellsWidth();n.forEach((function(e,n){if(e&&!t.cells[n]){var i=n%r,a=Math.floor(n/r),o=(Math.min(i*ar+ar,t.context.canvas.width)-1)%ar+1,s=(Math.min(a*ar+ar,t.context.canvas.height)-1)%ar+1,l=ve.canvas(o,s).getContext("2d");l.drawImage(t.context.canvas,-i*ar,-a*ar),t.cells[n]=l.getImageData(0,0,o,s)}}))}}},{key:"getAverage",value:function(e,t,n){var r=this;n=Math.max(.5,.75*n);var i=Math.max(0,Math.floor(e-n)),a=Math.max(0,Math.floor(t-n)),o=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),s=Math.min(this.context.canvas.height-1,Math.ceil(t+n));if(i>o||a>s)return{r:0,g:0,b:0,a:0};var l,c=0,u=0,h=0,d=0;return this.sliceBounds({x1:i,y1:a,x2:o,y2:s}).forEach((function(e){for(var t=r.cells[e.index].width,n=r.cells[e.index].data,i=e.bounds,a=i.y1;a<=i.y2;a+=4)for(var o=i.x1,s=a*t*4+4*i.x1;o<=i.x2;o+=4,s+=16)l=n[s+3],c+=n[s]*l,u+=n[s+1]*l,h+=n[s+2]*l,d+=l})),0!==d&&(c/=d,u/=d,h/=d,d=Math.min(1,d)),{r:c,g:u,b:h,a:d}}},{key:"prepDot",value:function(e,t,n){n=Math.max(.5,n);var r=Math.max(0,Math.floor(e-n)),i=Math.max(0,Math.floor(t-n)),a=Math.min(this.context.canvas.width-1,Math.ceil(e+n)),o=Math.min(this.context.canvas.height-1,Math.ceil(t+n));return r>a||i>o?null:{x1:r,y1:i,x2:a,y2:o}}},{key:"drawDot",value:function(e){for(var t=this,n=0,r=e.size>30?1024:512,i=[],a=0;a<r;a++)i[a]=(Math.random()-.5)/1.001+.5;var o=[8,4,4,4,2,2,2,2,2,2][Math.floor(2*e.size)],s=o?o*o:0,l=[];if(o)for(var c=0,u=0;u<o;u++)for(var h=0;h<o;h++,c+=2)l[c]=(u+1)/o,l[c+1]=(h+1)/o;var d=.8*Math.pow(e.opacity,2),p=1-d,g=d/p,f=e.size*e.size,m=f*p/e.opacity,v=(1+g)*e.opacity,y=this.sliceBounds({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),x=this.getCellsWidth();y.forEach((function(a){for(var o=a.index%x*ar,c=Math.floor(a.index/x)*ar,u=t.cells[a.index].width,h=t.cells[a.index].data,d=a.bounds.y1,p=d+c-e.y;d<=a.bounds.y2;d++,p++)for(var g=a.bounds.x1,y=d*u*4+4*a.bounds.x1,b=g+o-e.x;g<=a.bounds.x2;g++,y+=4,b++){var w=0;if(s){for(var C=0;C<l.length;C+=2){var S=ve.lenSquared(b+l[C],p+l[C+1]);S>=f||(w+=or(v-S/m,0,e.opacity))}if(!w)continue;w/=s}else{var k=Math.pow(b,2)+Math.pow(p,2);if(k>=f)continue;w=or(v-k/m,0,e.opacity)}var E=1-w,M=h[y+3]/255;if(t.settingLockLayerAlpha){var I=e.r*w+h[y]*E,T=e.g*w+h[y+1]*E,R=e.b*w+h[y+2]*E;M&&(h[y]=Math.floor(I+i[n]),h[y+1]=Math.floor(T+i[n]),h[y+2]=Math.floor(R+i[n]))}else{var L=e.r*w+h[y]*M*E,A=e.g*w+h[y+1]*M*E,P=e.b*w+h[y+2]*M*E,O=1-E*(1-M);h[y+3]=Math.floor(Math.min(255,255*O)+.5),O&&(h[y]=Math.floor(L/O+i[n]),h[y+1]=Math.floor(A/O+i[n]),h[y+2]=Math.floor(P/O+i[n]))}n=(n+1)%r}}))}},{key:"calcSpacing",value:function(e){return ve.mix(2*e/2,2*e/9,ve.clamp((e-2.7)/9.3,0,1))}},{key:"continueLine",value:function(e,t,n,r){var i,a,o=this;this.drawBuffer=[];var s,l=this.settingSizePressure?Math.max(1,n*this.size):Math.max(1,this.size),c=this.calcSpacing(l),u=e,h=t;if(null===e&&(u=this.lastInput.x,h=this.lastInput.y),0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{var d;if(r)d={r:this.localColOld.r,g:this.localColOld.g,b:this.localColOld.b,a:0};else{var p=[u,h,this.settingSizePressure?Math.max(.5,n*this.size):Math.max(.5,this.size)],g=this.prepDot(p[0],p[1],p[2]);this.copyFromCanvas(g),d=this.getAverage(p[0],p[1],p[2])}s={r:0,g:0,b:0,a:0},d.a>0&&0===this.blendCol.a?(this.blendCol.r=d.r,this.blendCol.g=d.g,this.blendCol.b=d.b,this.blendCol.a=d.a,s.r=this.blendCol.r,s.g=this.blendCol.g,s.b=this.blendCol.b,s.a=this.blendCol.a):(0===d.a&&(d.r=this.color.r,d.g=this.color.g,d.b=this.color.b,d.a=1-this.blending),this.blendCol.r=ve.mix(this.blendCol.r,ve.mix(this.blendCol.r,d.r,this.blendMix),d.a),this.blendCol.g=ve.mix(this.blendCol.g,ve.mix(this.blendCol.g,d.g,this.blendMix),d.a),this.blendCol.b=ve.mix(this.blendCol.b,ve.mix(this.blendCol.b,d.b,this.blendMix),d.a),this.blendCol.a=Math.min(1,this.blendCol.a+d.a),s.r=this.blendCol.r,s.g=this.blendCol.g,s.b=this.blendCol.b,s.a=this.blendCol.a)}var f=function(e){if(!(o.blending>=1&&o.blendCol.a<=0)){var t=e.t;i=o.lastInput2.pressure*(1-t)+n*t,a=o.settingOpacityPressure?o.opacity*i*i:o.opacity,l=o.settingSizePressure?Math.max(.1,i*o.size):Math.max(.1,o.size),0!=o.blending&&(o.mixr=ve.mix(o.localColOld.r,s.r,t),o.mixg=ve.mix(o.localColOld.g,s.g,t),o.mixb=ve.mix(o.localColOld.b,s.b,t)),1===o.blending&&0===o.localColOld.a&&(o.mixr=s.r,o.mixg=s.g,o.mixb=s.b);var r=o.prepDot(e.x,e.y,l);r&&(o.updateRedrawBounds(r),o.drawBuffer.push({x:e.x,y:e.y,size:l,opacity:a,x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2,r:ve.mix(o.color.r,o.mixr,o.blending),g:ve.mix(o.color.g,o.mixg,o.blending),b:ve.mix(o.color.b,o.mixb,o.blending)}))}};null===e?this.bezierLine.addFinal(c,f):this.bezierLine.add(e,t,c,f),this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){o.drawDot(e)})),this.drawBuffer=[],this.localColOld=s}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return this.size}},{key:"setSize",value:function(e){this.size=e}},{key:"getOpacity",value:function(){return this.opacity}},{key:"setOpacity",value:function(e){this.opacity=e}},{key:"getBlending",value:function(){return this.blending}},{key:"setBlending",value:function(e){this.blending=e}},{key:"setColor",value:function(e){this.color=ve.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setSizePressure",value:function(e){this.settingSizePressure=!!e}},{key:"setOpacityPressure",value:function(e){this.settingOpacityPressure=!!e}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setIsTesting",value:function(e){this.isTesting=!!e}},{key:"startLine",value:function(e,t,n){var r=this;this.historyEntry={tool:["brush","BlendBrush"],actions:[]};var i=Math.ceil(this.context.canvas.width/ar)*Math.ceil(this.context.canvas.height/ar);this.cells="0".repeat(i).split("").map((function(e){return null})),this.isDrawing=!0,n=Math.max(0,Math.min(1,n));var a=this.settingOpacityPressure?this.opacity*n*n:this.opacity,o=this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size);if(0===this.blending)this.mixr=this.color.r,this.mixg=this.color.g,this.mixb=this.color.b;else{this.copyFromCanvas(this.prepDot(e,t,o));var s=this.getAverage(e,t,this.settingSizePressure?Math.max(.1,n*this.size):Math.max(.1,this.size));0===s.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:s.r,g:s.g,b:s.b,a:s.a},this.mixr=this.blendCol.r,this.mixg=this.blendCol.g,this.mixb=this.blendCol.b}if(this.localColOld={r:this.mixr,g:this.mixg,b:this.mixb,a:this.blendCol.a},this.redrawBounds=null,this.drawBuffer=[],this.blending<1||this.blendCol.a>0){var l=this.prepDot(e,t,o);l&&(this.updateRedrawBounds(l),this.drawBuffer.push({x:e,y:t,size:o,opacity:a,x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,r:ve.mix(this.color.r,this.mixr,this.blending),g:ve.mix(this.color.g,this.mixg,this.blending),b:ve.mix(this.color.b,this.mixb,this.blending)}))}this.copyFromCanvas(this.redrawBounds),this.drawBuffer.forEach((function(e){r.drawDot(e)})),this.drawBuffer=[],this.bezierLine=new ve.BezierLine,this.bezierLine.add(e,t,0,(function(){})),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2=ve.copyObj(this.lastInput),this.redrawBounds&&!this.isTesting&&this.drawChangedCells()}},{key:"goLine",value:function(e,t,n,r){this.isDrawing&&(this.continueLine(e,t,this.lastInput.pressure,r),this.lastInput2=ve.copyObj(this.lastInput),this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.redrawBounds&&!this.isTesting&&this.drawChangedCells())}},{key:"endLine",value:function(){this.bezierLine&&this.continueLine(null,null,this.lastInput.pressure,!1),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&this.drawChangedCells(),this.historyEntry&&this.history&&this.cells.find((function(e){return!!e}))&&(this.historyEntry.actions.push({action:"drawCells",params:[this.cells]}),this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}},{key:"drawCells",value:function(e){var t=this,n=this.getCellsWidth();e.forEach((function(e,r){if(e){var i=r%n*ar,a=Math.floor(r/n)*ar;t.context.putImageData(e,i,a)}}))}},{key:"drawLineSegment",value:function(e,t,n,r){var i=this;if(this.lastInput.x=n,this.lastInput.y=r,!this.isDrawing&&void 0!==e){var a=Math.ceil(this.context.canvas.width/ar)*Math.ceil(this.context.canvas.height/ar);this.cells="0".repeat(a).split("").map((function(e){return null})),this.redrawBounds=null,this.drawBuffer=[],this.copyFromCanvas(this.prepDot(e,t,Math.max(.1,this.size)));var o=this.getAverage(e,t,Math.max(.1,this.size));0===o.a?this.blendCol={r:this.color.r,g:this.color.g,b:this.color.b,a:1-this.blending}:this.blendCol={r:o.r,g:o.g,b:o.b,a:o.a},this.mixr=this.color.r*(1-this.blendCol.a)+(this.blending*this.blendCol.r+this.color.r*(1-this.blending))*this.blendCol.a,this.mixg=this.color.g*(1-this.blendCol.a)+(this.blending*this.blendCol.g+this.color.g*(1-this.blending))*this.blendCol.a,this.mixb=this.color.b*(1-this.blendCol.a)+(this.blending*this.blendCol.b+this.color.b*(1-this.blending))*this.blendCol.a;for(var s=this.settingOpacityPressure?1*this.opacity*1:this.opacity,l=this.settingSizePressure?Math.max(.1,1*this.size):Math.max(.1,this.size),c=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),u=(n-e)/c,h=(r-t)/c,d=this.calcSpacing(l),p=0;p<=c;p+=d){var g=this.prepDot(e+u*p,t+h*p,l);g&&(this.copyFromCanvas(g),this.drawBuffer.push({x:e+u*p,y:t+h*p,size:l,opacity:s,x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,r:ve.mix(this.color.r,this.mixr,this.blending),g:ve.mix(this.color.g,this.mixg,this.blending),b:ve.mix(this.color.b,this.mixb,this.blending)}))}this.drawBuffer.forEach((function(e){i.drawDot(e)})),this.drawBuffer=[],this.history&&this.cells.find((function(e){return!!e}))&&(this.drawCells(this.cells),this.historyEntry={tool:["brush","BlendBrush"],actions:[{action:"drawCells",params:[this.cells]}]},this.history.push(this.historyEntry),this.historyEntry=null),this.cells=null}}}]),e}(),lr=ve.canvas(32,32),cr=lr.getContext("2d");a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var ur=256;function hr(e,t){for(var n=(t=ve.copyObj(t)).brush.size,r=t.brush.center.x,i=t.brush.center.y,a=t.aP.y*e.width+t.aP.x,o=4*(t.bP.y*e.width+t.bP.x-a),s=0,l=n>30?1024:512,c=[],u=0;u<l;u++)c[u]=(Math.random()-.5)/1.001+.5;var h=Math.max(3,Math.min(8,t.brush.size-8)),d=function(a,o,u,d){var p,g,f,m=ve.dist(r,i,u,d),v=1-t.brush.opacity*(1-(f=1,(p=(m-(n-h))/h)<=(g=0)?g:p>=f?f:p));if(1!==v){if(e.data[a+3])if(e.data[o+3]){var y;y=e.data[a+3]<e.data[o+3]?1-e.data[a+3]/e.data[o+3]*(1-v):e.data[o+3]/e.data[a+3]*v,e.data[o]=Math.floor(ve.mix(e.data[a],e.data[o+0],y)+c[s]),e.data[o+1]=Math.floor(ve.mix(e.data[a+1],e.data[o+1],y)+c[s]),e.data[o+2]=Math.floor(ve.mix(e.data[a+2],e.data[o+2],y)+c[s]),s=(s+1)%l}else e.data[o]=e.data[a+0],e.data[o+1]=e.data[a+1],e.data[o+2]=e.data[a+2];else;t.brush.alphaLock||(e.data[o+3]=Math.floor(ve.mix(e.data[a+3],e.data[o+3],v)+.5))}},p=4*t.bP.x,g=p+4*(t.size.w-1);if(t.aP.y<t.bP.y)for(var f=t.size.h-1,m=t.bP.y+t.size.h-1;f>=0;f--,m--)for(var v=(f+t.bP.y)*e.width*4,y=g+v,x=g+v-o,b=t.bP.x+t.size.w-1;y>=p+v;y-=4,x-=4,b--)d(x,y,b,m);else if(t.aP.y>t.bP.y)for(var w=0,C=t.bP.y;w<t.size.h;w++,C++)for(var S=(w+t.bP.y)*e.width*4,k=g+S,E=g+S-o,M=t.bP.x+t.size.w-1;k>=p+S;k-=4,E-=4,M--)d(E,k,M,C);else if(t.aP.x<t.bP.x)for(var I=t.size.h-1,T=t.bP.y+t.size.h-1;I>=0;I--,T--)for(var R=(I+t.bP.y)*e.width*4,L=g+R,A=g+R-o,P=t.bP.x+t.size.w-1;L>=p+R;L-=4,A-=4,P--)d(A,L,P,T);else for(var O=0,D=t.bP.y;O<t.size.h;O++,D++)for(var B=(O+t.bP.y)*e.width*4,z=p+B,j=p+B-o,H=t.bP.x;z<g+B;z+=4,j+=4,H++)d(j,z,H,D)}var dr=function(){"use strict";function e(){I.default(this,e),this.history=new oi.DecoyKlHistory,this.settingColor={r:0,g:0,b:0},this.settingSize=35,this.settingSpacing=.20446882736951905,this.settingOpacity=.8,this.settingHasSizePressure=!1,this.settingHasOpacityPressure=!1,this.settingLockLayerAlpha=!1,this.lastInput={x:0,y:0,pressure:0},this.lastInput2={x:0,y:0,pressure:0},this.isDrawing=!1,this.bezierLine=null,this.drawBuffer=[]}return T.default(e,[{key:"updateRedrawBounds",value:function(e){this.redrawBounds=ve.updateBounds(this.redrawBounds,e)}},{key:"updateCompleteRedrawBounds",value:function(e,t,n,r){this.completeRedrawBounds=ve.updateBounds(this.completeRedrawBounds,{x1:e,y1:t,x2:n,y2:r})}},{key:"copyFromCanvas",value:function(){var e=this,t=this.copiedCells.map((function(e){return!1})),n=[],r=Math.ceil(this.copyImageData.width/ur);this.redrawBounds&&(n.push({x1:Math.floor(this.redrawBounds.x1/ur),y1:Math.floor(this.redrawBounds.y1/ur),x2:Math.floor(this.redrawBounds.x2/ur),y2:Math.floor(this.redrawBounds.y2/ur)}),n.forEach((function(e){for(var n=e.x1;n<=e.x2;n++)for(var i=e.y1;i<=e.y2;i++)t[i*r+n]=!0})),t.forEach((function(t,n){if(t&&!e.copiedCells[n]){e.copiedCells[n]=!0;var i=n%r,a=Math.floor(n/r),o=(Math.min(i*ur+ur,e.copyImageData.width)-1)%ur+1,s=(Math.min(a*ur+ur,e.copyImageData.height)-1)%ur+1,l=ve.canvas(o,s).getContext("2d");l.drawImage(e.context.canvas,-i*ur,-a*ur);for(var c=l.getImageData(0,0,o,s),u=0;u<s;u++)for(var h=0,d=u*o*4,p=4*((a*ur+u)*e.copyImageData.width+i*ur);h<o;h++,d+=4,p+=4)e.copyImageData.data[p]=c.data[d],e.copyImageData.data[p+1]=c.data[d+1],e.copyImageData.data[p+2]=c.data[d+2],e.copyImageData.data[p+3]=c.data[d+3]}})))}},{key:"prepDot",value:function(e,t,n,r){if(this.lastDot){n=Math.round(n);var i=Math.round(2*n),a=Math.round(2*n),o=function(e,t,n,r,i){if(n.x===r.x&&n.y===r.y)return null;n=ve.copyObj(n),r=ve.copyObj(r),i=ve.copyObj(i);var a=0,o=0,s=0,l=0;return n.x<0&&(l=-n.x),n.y<0&&(a=-n.y),r.x<0&&(l=Math.max(l,-r.x)),r.y<0&&(a=Math.max(a,-r.y)),n.x+i.w>e&&(o=n.x+i.w-e),n.y+i.h>t&&(s=n.y+i.h-t),r.x+i.w>e&&(o=Math.max(o,r.x+i.w-e)),r.y+i.h>t&&(s=Math.max(s,r.y+i.h-t)),n.x+=l,r.x+=l,n.y+=a,r.y+=a,i.w=i.w-l-o,i.h=i.h-a-s,i.w<=0||i.h<=0?null:{aP:{x:n.x,y:n.y},bP:{x:r.x,y:r.y},size:{w:i.w,h:i.h}}}(this.copyImageData.width,this.copyImageData.height,{x:Math.round(this.lastDot.x-n),y:Math.round(this.lastDot.y-n)},{x:Math.round(e-n),y:Math.round(t-n)},{w:i,h:a});if(o){var s={aP:o.aP,bP:o.bP,size:o.size,brush:{center:{x:e,y:t},size:n,opacity:r,alphaLock:this.settingLockLayerAlpha}};this.updateRedrawBounds({x1:s.bP.x,y1:s.bP.y,x2:s.bP.x+2*s.brush.size,y2:s.bP.y+2*s.brush.size}),this.drawBuffer.push(s)}this.lastDot={x:e,y:t}}else this.lastDot={x:e,y:t}}},{key:"continueLine",value:function(e,t,n,r){var i=this;this.drawBuffer=[],null===this.bezierLine&&(this.bezierLine=new ve.BezierLine,this.bezierLine.add(this.lastInput.x,this.lastInput.y,0,(function(){})));var a=[],o=function(e){var t=ve.mix(i.lastInput2.pressure,r,e.t),n=i.settingOpacity*(i.settingHasOpacityPressure?t*t:1),o=Math.max(.1,i.settingSize*(i.settingHasSizePressure?t:1));a.push([e.x,e.y,o,n,e.angle])},s=n*this.settingSpacing/3;null===e?this.bezierLine.addFinal(s,o):this.bezierLine.add(e,t,s,o);for(var l=0;l<a.length;l++){var c=a[l];this.prepDot(c[0],c[1],c[2],c[3]),c}this.copyFromCanvas();for(var u=0;u<this.drawBuffer.length;u++)hr(this.copyImageData,this.drawBuffer[u])}},{key:"startLine",value:function(e,t,n){this.historyEntry={tool:["brush","SmudgeBrush"],actions:[]},n=ve.clamp(n,0,1);var r=this.settingHasOpacityPressure?this.settingOpacity*n*n:this.settingOpacity,i=this.settingHasSizePressure?Math.max(.1,n*this.settingSize):Math.max(.1,this.settingSize);this.lastDot=null,this.isDrawing=!0,this.copyImageData=new ImageData(this.context.canvas.width,this.context.canvas.height);var a=Math.ceil(this.context.canvas.width/ur)*Math.ceil(this.context.canvas.height/ur);this.copiedCells="0".repeat(a).split("").map((function(e){return!1})),this.prepDot(e,t,i,r),this.lineToolLastDot=i*this.settingSpacing,this.lastInput.x=e,this.lastInput.y=t,this.lastInput.pressure=n,this.lastInput2.pressure=n,this.completeRedrawBounds=null}},{key:"goLine",value:function(e,t,n){if(this.isDrawing){this.redrawBounds=null;var r=ve.clamp(n,0,1),i=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);this.continueLine(e,t,i,this.lastInput.pressure),this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.lastInput.x=e,this.lastInput.y=t,this.lastInput2.pressure=this.lastInput.pressure,this.lastInput.pressure=r}}},{key:"endLine",value:function(){this.redrawBounds=null;var e=this.settingHasSizePressure?Math.max(.1,this.lastInput.pressure*this.settingSize):Math.max(.1,this.settingSize);if(this.context.save(),this.continueLine(null,null,e,this.lastInput.pressure),this.context.restore(),this.isDrawing=!1,this.bezierLine=null,this.redrawBounds&&(this.context.putImageData(this.copyImageData,0,0,this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2-this.redrawBounds.x1-1,this.redrawBounds.y2-this.redrawBounds.y1-1),this.updateCompleteRedrawBounds(this.redrawBounds.x1,this.redrawBounds.y1,this.redrawBounds.x2,this.redrawBounds.y2)),this.historyEntry&&this.completeRedrawBounds){var t=this.copyImageData;if(!(0===this.completeRedrawBounds.x1&&0===this.completeRedrawBounds.y1&&this.completeRedrawBounds.x2>=this.context.canvas.width-1&&this.completeRedrawBounds.y2>=this.context.canvas.height-1)){var n=ve.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);n.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),t=n}this.historyEntry.actions.push({action:"drawImage",params:[t,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}),this.history.push(this.historyEntry),this.historyEntry=void 0}this.copyImageData=null}},{key:"drawImage",value:function(e,t,n){e instanceof ImageData?this.context.putImageData(e,t,n):(this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n))}},{key:"drawLineSegment",value:function(e,t,n,r){}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"setColor",value:function(e){this.settingColor.r===e.r&&this.settingColor.g===e.g&&this.settingColor.b===e.b||(this.settingColor={r:e.r,g:e.g,b:e.b},this.settingColorStr=ve.ColorConverter.toRgbStr(this.settingColor))}},{key:"setContext",value:function(e){this.context=e}},{key:"setHistory",value:function(e){this.history=e}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setSpacing",value:function(e){this.settingSpacing=e}},{key:"sizePressure",value:function(e){this.settingHasSizePressure=!!e}},{key:"opacityPressure",value:function(e){this.settingHasOpacityPressure=!!e}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getSpacing",value:function(){return this.settingSpacing}},{key:"getSize",value:function(){return this.settingSize}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}}]),e}();a("cf2NR");I=a("hDZfO"),T=a("3SSYo"),ln=a("2EcGA");var pr,gr=function(){"use strict";function e(){I.default(this,e),this.settingSize=.25,this.settingOpacity=1,this.settingLockLayerAlpha=!1,this.settingIsEraser=!1,this.settingMode="fill",this.settingDistort=0,this.settingXSymmetry=!1,this.settingYSymmetry=!1,this.settingGradient=!1,this.isDrawing=!1}return T.default(e,[{key:"updateCompleteRedrawBounds",value:function(e,t){var n={x1:e,y1:t,x2:e,y2:t};this.settingXSymmetry&&(n=ve.updateBounds(n,{x1:-e+this.copyCanvas.width,y1:t,x2:-e+this.copyCanvas.width,y2:t})),this.settingYSymmetry&&(n=ve.updateBounds(n,{x1:e,y1:-t+this.copyCanvas.height,x2:e,y2:-t+this.copyCanvas.height}));var r="stroke"===this.settingMode?this.settingSize+1:1;n.x1=Math.floor(n.x1-r),n.y1=Math.floor(n.y1-r),n.x2=Math.ceil(n.x2+r),n.y2=Math.ceil(n.y2+r),this.completeRedrawBounds=ve.updateBounds(this.completeRedrawBounds,n)}},{key:"drawShape",value:function(){this.context.save(),this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.drawImage(this.copyCanvas,0,0);var e=ln.default({},this.settingColor);if(this.settingIsEraser?(e.r=255,e.g=255,e.b=255,this.settingLockLayerAlpha?this.context.globalCompositeOperation="source-atop":this.context.globalCompositeOperation="destination-out"):this.settingLockLayerAlpha&&(this.context.globalCompositeOperation="source-atop"),this.path){var t=this,n=new Path2D;this.path.forEach((function(e,t){0===t?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}));var r=ve.ColorConverter.toRgbaStr({r:e.r,g:e.g,b:e.b,a:this.settingOpacity});if(this.settingGradient){var i=this.path[0].x>this.path[this.path.length-1].x,a=this.context.createLinearGradient(0,i?this.minY:this.maxY,0,i?this.maxY:this.minY);a.addColorStop(0,ve.ColorConverter.toRgbaStr({r:e.r,g:e.g,b:e.b,a:this.settingOpacity})),a.addColorStop(1,ve.ColorConverter.toRgbaStr({r:e.r,g:e.g,b:e.b,a:0})),r=a}"fill"===this.settingMode?this.context.fillStyle=r:(this.context.lineWidth=2*this.settingSize,this.context.lineJoin="bevel",this.context.strokeStyle=r);var o=function(){"fill"===t.settingMode?t.context.fill(n):t.context.stroke(n)};o(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,0),this.context.scale(-1,1),this.context.translate(-this.context.canvas.width/2,0),o(),this.context.restore()),this.settingYSymmetry&&(this.context.save(),this.context.translate(0,this.context.canvas.height/2),this.context.scale(1,-1),this.context.translate(0,-this.context.canvas.height/2),o(),this.context.restore(),this.settingXSymmetry&&(this.context.save(),this.context.translate(this.context.canvas.width/2,this.context.canvas.height/2),this.context.scale(-1,-1),this.context.translate(-this.context.canvas.width/2,-this.context.canvas.height/2),o(),this.context.restore()))}this.context.restore()}},{key:"setHistory",value:function(e){this.history=e}},{key:"getSize",value:function(){return"stroke"===this.settingMode?this.settingSize:0}},{key:"setSize",value:function(e){this.settingSize=e}},{key:"getOpacity",value:function(){return this.settingOpacity}},{key:"setOpacity",value:function(e){this.settingOpacity=e}},{key:"setColor",value:function(e){this.settingColor=ve.copyObj(e)}},{key:"setContext",value:function(e){this.context=e}},{key:"setMode",value:function(e){this.settingMode=e}},{key:"getMode",value:function(){return this.settingMode}},{key:"setDistort",value:function(e){this.settingDistort=ve.clamp(e,0,1)}},{key:"getDistort",value:function(){return this.settingDistort}},{key:"setXSymmetry",value:function(e){this.settingXSymmetry=!!e}},{key:"getXSymmetry",value:function(){return this.settingXSymmetry}},{key:"setYSymmetry",value:function(e){this.settingYSymmetry=!!e}},{key:"getYSymmetry",value:function(){return this.settingYSymmetry}},{key:"setGradient",value:function(e){this.settingGradient=!!e}},{key:"getGradient",value:function(){return this.settingGradient}},{key:"getLockAlpha",value:function(){return this.settingLockLayerAlpha}},{key:"setLockAlpha",value:function(e){this.settingLockLayerAlpha=!!e}},{key:"getIsEraser",value:function(){return this.settingIsEraser}},{key:"setIsEraser",value:function(e){this.settingIsEraser=!!e}},{key:"getIsDrawing",value:function(){return this.isDrawing}},{key:"startLine",value:function(e,t){this.isDrawing=!0,this.path=[{x:e,y:t}],this.minY=t,this.maxY=t,this.copyCanvas=ve.canvas(this.context.canvas.width,this.context.canvas.height),this.copyCanvas.getContext("2d").drawImage(this.context.canvas,0,0),this.completeRedrawBounds=null,this.updateCompleteRedrawBounds(e,t)}},{key:"goLine",value:function(e,t){if(this.isDrawing){var n={x:e,y:t};this.settingDistort>0&&(n.x+=(Math.random()-.5)*this.settingDistort*80,n.y+=(Math.random()-.5)*this.settingDistort*80),this.minY=Math.min(this.minY,n.y),this.maxY=Math.max(this.maxY,n.y),this.path.push(n),this.updateCompleteRedrawBounds(e,t),this.drawShape()}}},{key:"endLine",value:function(){if(this.isDrawing=!1,this.completeRedrawBounds=ve.boundsInArea(this.completeRedrawBounds,this.copyCanvas.width,this.copyCanvas.height),this.path.length>1&&this.completeRedrawBounds){var e=ve.canvas(this.completeRedrawBounds.x2-this.completeRedrawBounds.x1+1,this.completeRedrawBounds.y2-this.completeRedrawBounds.y1+1);e.getContext("2d").drawImage(this.context.canvas,-this.completeRedrawBounds.x1,-this.completeRedrawBounds.y1),this.history.push({tool:["brush","ChemyBrush"],actions:[{action:"drawImage",params:[e,this.completeRedrawBounds.x1,this.completeRedrawBounds.y1]}]})}this.path=null,this.copyCanvas=null}},{key:"drawImage",value:function(e,t,n){this.context.save(),this.context.clearRect(t,n,e.width,e.height),this.context.drawImage(e,t,n),this.context.restore()}},{key:"drawLineSegment",value:function(e,t,n,r){}}]),e}(),fr={PenBrush:function(){var e,t,n,r,i,a,o=function(e){return p*(f?e*e:1)},s=function(){if(b!==v&&b!==x)for(var e,t=[[E,128],[M,64],[I,32]],r=0;r<t.length;r++)(e=t[r][0].getContext("2d")).save(),e.clearRect(0,0,t[r][1],t[r][1]),e.fillStyle="rgba("+n.r+", "+n.g+", "+n.b+", "+k[b]+")",e.fillRect(0,0,t[r][1],t[r][1]),e.globalCompositeOperation="destination-in",e.imageSmoothingQuality="high",e.drawImage(ir[b],0,0,t[r][1],t[r][1]),e.restore()},l=function(t,n,i,a,o,s){if(!(i<=0))if(m&&(e.globalCompositeOperation="source-atop"),s&&s[3]===a||(e.globalAlpha=a),s||b!==v&&b!==x||(e.fillStyle=r),b===v)e.beginPath(),e.arc(t,n,i,0,R),e.closePath(),e.fill(),L=!0;else if(b===x)void 0!==o&&(e.save(),e.translate(t,n),e.rotate(o/180*Math.PI),e.fillRect(-i,-i,2*i,2*i),e.restore(),L=!0);else{e.save(),e.translate(t,n);var l=E;i<=32&&i>16?l=M:i<=16&&(l=I),e.scale(i,i),b===y&&e.rotate(53123*(t+n)%R),e.drawImage(l,-1,-1,2,2),e.restore(),L=!0}},c=function(t,n,r,i){null===T&&(T=new ve.BezierLine).add(w.x,w.y,0,(function(){}));var a=[];function s(e){var t=ve.mix(C.pressure,i,e.t),n=o(t),r=Math.max(.1,h*(g?t:1));a.push([e.x,e.y,r,n,e.angle])}var c,u=r*d;null===t?T.addFinal(u,s):T.add(t,n,u,s),e.save();for(var p=0;p<a.length;p++){var f=a[p];l(f[0],f[1],f[2],f[3],f[4],c),c=f}e.restore()},u=new oi.DecoyKlHistory,h=2,d=.8489,p=1,g=!0,f=!1,m=!1,v=0,y=1,x=3,b=v,w={x:0,y:0,pressure:0},C={x:0,y:0,pressure:0},S=!1,k=[1,.9,1,1],E=ve.canvas(128,128),M=ve.canvas(64,64),I=ve.canvas(32,32),T=null,R=2*Math.PI,L=!1;this.startLine=function(r,s,c){(t={tool:["brush","PenBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[f]}),t.actions.push({action:"sizePressure",params:[g]}),t.actions.push({action:"setSize",params:[h]}),t.actions.push({action:"setSpacing",params:[d]}),t.actions.push({action:"setOpacity",params:[p]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setAlpha",params:[b]}),t.actions.push({action:"setLockAlpha",params:[m]}),c=ve.clamp(c,0,1);var u=o(c),v=g?Math.max(.1,c*h):Math.max(.1,h);L=!1,S=!0,e.save(),l(r,s,v,u),e.restore(),i=v*d,w.x=r,w.y=s,w.pressure=c,C.pressure=c,a=[{x:r,y:s,pressure:c}],t.actions.push({action:"startLine",params:[r,s,c]})},this.goLine=function(n,r,i){if(S){t.actions.push({action:"goLine",params:[n,r,i]});var o=ve.clamp(i,0,1),s=g?Math.max(.1,w.pressure*h):Math.max(.1,h);e.save(),c(n,r,s,w.pressure),e.restore(),w.x=n,w.y=r,C.pressure=w.pressure,w.pressure=o,a.push({x:n,y:r,pressure:i})}},this.endLine=function(n,r){var i=g?Math.max(.1,w.pressure*h):Math.max(.1,h);if(e.save(),c(null,null,i,w.pressure),e.restore(),S=!1,b===x&&!L){var s=a[0];a.forEach((function(e){e.pressure>s.pressure&&(s=e)})),e.save();var d=ve.clamp(s.pressure,0,1),p=o(d);l(s.x,s.y,i,p,0),e.restore()}T=null,t&&(t.actions.push({action:"endLine",params:[n,r]}),u.push(t),t=void 0),L=!1,a=[]},this.drawLineSegment=function(t,r,a,o){if(w.x=a,w.y=o,w.pressure=1,!S&&void 0!==t){var s,c=ve.pointsToAngleDeg({x:t,y:r},{x:a,y:o}),v=Math.sqrt(Math.pow(a-t,2)+Math.pow(o-r,2)),y=(a-t)/v,x=(o-r)/v,C=h*d;for(i=h*d,e.save(),s=i;s<=v;s+=C)l(t+y*s,r+x*s,h,p,c);e.restore();var k={tool:["brush","PenBrush"],actions:[]};k.actions.push({action:"opacityPressure",params:[f]}),k.actions.push({action:"sizePressure",params:[g]}),k.actions.push({action:"setSize",params:[h]}),k.actions.push({action:"setSpacing",params:[d]}),k.actions.push({action:"setOpacity",params:[p]}),k.actions.push({action:"setColor",params:[n]}),k.actions.push({action:"setAlpha",params:[b]}),k.actions.push({action:"setLockAlpha",params:[m]}),k.actions.push({action:"drawLineSegment",params:[t,r,a,o]}),u.push(k)}},this.isDrawing=function(){return S},this.setAlpha=function(e){b!==e&&(b=e,s())},this.setColor=function(e){n!==e&&(n={r:e.r,g:e.g,b:e.b},r="rgb("+n.r+","+n.g+","+n.b+")",s())},this.setContext=function(t){e=t},this.setHistory=function(e){u=e},this.setSize=function(e){h=e},this.setOpacity=function(e){p=e},this.setSpacing=function(e){d=e},this.sizePressure=function(e){g=e},this.opacityPressure=function(e){f=e},this.setLockAlpha=function(e){m=e},this.getSpacing=function(){return d},this.getSize=function(){return h},this.getOpacity=function(){return p},this.getLockAlpha=function(e){return m}},BlendBrush:sr,SketchyBrush:function(){var e,t,n,r,i,a=1,o=.2,s=.5,l=1,c=!1,u={x:0,y:0,pressure:0},h=new oi.DecoyKlHistory,d=0;this.setHistory=function(e){h=e},this.setSeed=function(e){d=parseInt(e)},this.getSeed=function(){return parseInt(""+d)};var p=[],g=0,f=[function(e,t){return e},function(e,t){var n=new ve.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n},function(e,t){var n=new ve.RGB(e.r,e.g,e.b);return n.r*=t.r/255,n.g*=t.g/255,n.b*=t.b/255,n}];this.getSize=function(){return a/2},this.setColor=function(e){t=e},this.getOpacity=function(){return o},this.setOpacity=function(e){o=e},this.getBlending=function(){return s},this.setBlending=function(e){s=e},this.setSize=function(e){a=2*e},this.getScale=function(){return l},this.setScale=function(e){l=e},this.setContext=function(t){e=t},this.startLine=function(e,h,d,p){if(p&&u.x){u.x,u.y;c=!0,this.endLine()}else c=!0,n=e,r=h,u.x=e,u.y=h,(i={tool:["brush","SketchyBrush"],actions:[]}).actions.push({action:"setScale",params:[l]}),i.actions.push({action:"setSize",params:[a/2]}),i.actions.push({action:"setOpacity",params:[o]}),i.actions.push({action:"setColor",params:[t]}),i.actions.push({action:"setBlending",params:[s]}),i.actions.push({action:"startLine",params:[e,h,d]})},this.goLine=function(h,m,v,y){if(c&&(h!==u.x||m!==u.y)){var x,b,w,C,S=parseInt(h),k=parseInt(m);p.push([S,k]);var E=t.r,M=t.g,I=t.b;if(null!==y)E=y.r,M=y.g,I=y.b;else if(0!==s&&S+5>=0&&k+5>=0&&S-5<e.canvas.width-1&&k-5<e.canvas.height-1){E=0,M=0,I=0;var T=Math.min(e.canvas.width-1,Math.max(0,S-5)),R=Math.min(e.canvas.height-1,Math.max(0,k-5)),L=Math.min(e.canvas.width-1,Math.max(0,S+5)),A=Math.min(e.canvas.height-1,Math.max(0,k+5));if(A-=R,(L-=T)>0&&A>0){for(var P=e.getImageData(T,R,L,A),O=0,D=0;D<P.data.length;D+=4)E+=P.data[D+0],M+=P.data[D+1],I+=P.data[D+2],O++;E/=O,M/=O,I/=O}var B=f[0](new ve.RGB(E,M,I),t);E=parseInt(""+ve.mix(t.r,B.r,s)),M=parseInt(""+ve.mix(t.g,B.g,s)),I=parseInt(""+ve.mix(t.b,B.b,s))}for(e.save(),e.strokeStyle="rgba("+E+", "+M+", "+I+", "+o+")",e.lineWidth=a,e.beginPath(),e.moveTo(n,r),e.lineTo(S,k),x=0;x<p.length;x++)(C=(b=p[x][0]-p[g][0])*b+(w=p[x][1]-p[g][1])*w)<4e3*l*l&&(d++,.5*Math.sin(6324634.2345*Math.cos(5342.3423*d))+.5>C/2e3/l/l)&&(e.moveTo(p[g][0]+.3*b,p[g][1]+.3*w),e.lineTo(p[x][0]-.3*b,p[x][1]-.3*w));e.stroke(),e.restore(),g++,n=S,r=k,u.x=S,u.y=k,i.actions.push({action:"goLine",params:[h,m,v,{r:E,g:M,b:I}]})}},this.endLine=function(){c=!1,g=0,p=[],i&&(i.actions.push({action:"endLine",params:[]}),h.push(i),i=void 0)},this.drawLineSegment=function(n,r,i,d){if(u.x=i,u.y=d,!c&&void 0!==n){e.save(),e.lineWidth=a;var p=t.r,g=t.g,m=t.b;if(n+5>=0&&r+5>=0&&n-5<e.canvas.width-1&&r-5<e.canvas.height-1){p=0,g=0,m=0;var v=Math.min(e.canvas.width-1,Math.max(0,n-5)),y=Math.min(e.canvas.height-1,Math.max(0,r-5)),x=Math.min(e.canvas.width-1,Math.max(0,n+5)),b=Math.min(e.canvas.height-1,Math.max(0,r+5));if(b-=y,(x-=v)>0&&b>0){var w=Math.min(lr.width,x),C=Math.min(lr.height,b);cr.save(),cr.globalCompositeOperation="copy",cr.drawImage(e.canvas,v,y,x,b,0,0,w,C),cr.restore();for(var S=cr.getImageData(v,y,x,b),k=0,E=0;E<S.data.length;E+=4)p+=S.data[E+0],g+=S.data[E+1],m+=S.data[E+2],k++;p/=k,g/=k,m/=k}}var M=f[0](new ve.RGB(p,g,m),t);p=parseInt(""+(s*M.r+t.r*(1-s))),g=parseInt(""+(s*M.g+t.g*(1-s))),m=parseInt(""+(s*M.b+t.b*(1-s))),e.strokeStyle="rgba("+p+", "+g+", "+m+", "+o+")",e.beginPath(),e.moveTo(n,r),e.lineTo(i,d),e.stroke(),e.strokeStyle="rgba("+p+", "+g+", "+m+", "+o+")",e.restore();var I={tool:["brush","SketchyBrush"],actions:[]};I.actions.push({action:"setScale",params:[l]}),I.actions.push({action:"setSize",params:[a/2]}),I.actions.push({action:"setOpacity",params:[o]}),I.actions.push({action:"setColor",params:[t]}),I.actions.push({action:"setBlending",params:[s]}),I.actions.push({action:"drawLineSegment",params:[n,r,i,d]}),h.push(I)}},this.isDrawing=function(){return c}},PixelBrush:function(){var e,t,n,r,i,a=function(){k.clearRect(0,0,4,4),k.fillStyle=v?"#fff":r;for(var t=0;t<Math.max(1,Math.round(p*E.length));t++)k.fillRect(E[t][0],E[t][1],1,1);i=e.createPattern(S,"repeat")},o=function(t,n,a,o,s){e.save(),v?(e.fillStyle=y?i:"#fff",e.globalCompositeOperation=m?"source-atop":"destination-out"):(e.fillStyle=y?i:r,m&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=y?1:p,t=Math.floor(t),n=Math.floor(n),a=Math.floor(a),o=Math.floor(o);for(var l=Math.abs(a-t),c=t<a?1:-1,u=-Math.abs(o-n),h=n<o?1:-1,d=l+u;s?s=!1:e.fillRect(t,n,1,1),t!==a||n!==o;){var g=2*d;g>=u&&(d+=u,t+=c),g<=l&&(d+=l,n+=h)}e.restore()},s=function(e,t,n,r){var i=function(e,t,n,r,i){var a=ve.Vec2.nor({x:r.x-e.x,y:r.y-e.y}),o=ve.Vec2.nor({x:t.x-e.x,y:t.y-e.y}),s=ve.Vec2.nor({x:r.x-n.x,y:r.y-n.y});return Math.abs(ve.Vec2.angle(a,o)%Math.PI),Math.PI,Math.abs(ve.Vec2.angle(a,s)%Math.PI),Math.PI,Math.max(ve.Vec2.dist(a,o),ve.Vec2.dist(a,s))>i}(e,t,n,r,.1);e.x=Math.floor(e.x),e.y=Math.floor(e.y),r.x=Math.floor(r.x),r.y=Math.floor(r.y);var a=ve.dist(e.x,e.y,r.x,r.y);if(!i||a<7)o(e.x,e.y,r.x,r.y,!0);else{for(var s=Math.max(2,Math.round(a/4)),l=[],c=0;c<=s;c++){var u=c/s,h=Math.pow(1-u,3),d=3*u*Math.pow(1-u,2),p=3*Math.pow(u,2)*(1-u),g=Math.pow(u,3);l.push({x:h*e.x+d*t.x+p*n.x+g*r.x,y:h*e.y+d*t.y+p*n.y+g*r.y})}for(var f=0;f<s;f++)o(Math.round(l[f].x),Math.round(l[f].y),Math.round(l[f+1].x),Math.round(l[f+1].y),!0)}},l=function(t,n,a,o,s){e.save(),v?(e.fillStyle=y?i:"#fff",e.globalCompositeOperation=m?"source-atop":"destination-out"):(e.fillStyle=y?i:r,m&&(e.globalCompositeOperation="source-atop")),e.globalAlpha=y?1:o,e.fillRect(Math.round(t+-a),Math.round(n+-a),Math.round(2*a),Math.round(2*a)),e.restore()},c=function(t,n,r,i){function a(e){var t=ve.mix(b.pressure,i,e.t),n=p*(f?t*t:1),r=Math.max(.5,h*(g?t:1));l(e.x,e.y,r,n,e.angle)}function o(e){s(e.p1,e.p2,e.p3,e.p4)}if(null===C&&(C=new ve.BezierLine).add(x.x,x.y,0,(function(){})),e.save(),1===Math.round(2*h))null===t?C.addFinal(4,null,o):C.add(t,n,4,null,o);else{var c=r*d;null===t?C.addFinal(c,a):C.add(t,n,c,a)}e.restore()},u=new oi.DecoyKlHistory,h=.5,d=.9,p=1,g=!0,f=!1,m=!1,v=!1,y=!0,x={x:0,y:0,pressure:0},b={x:0,y:0,pressure:0},w=!1,C=null,S=(Math.PI,ve.canvas(4,4)),k=S.getContext("2d"),E=[[3,2],[1,0],[3,0],[1,2],[2,1],[0,3],[0,1],[2,3],[2,0],[0,2],[0,0],[2,2],[1,1],[3,3],[3,1],[1,3]];this.startLine=function(e,r,i){(t={tool:["brush","PixelBrush"],actions:[]}).actions.push({action:"sizePressure",params:[g]}),t.actions.push({action:"setSize",params:[h]}),t.actions.push({action:"setSpacing",params:[d]}),t.actions.push({action:"setOpacity",params:[p]}),t.actions.push({action:"setColor",params:[n]}),t.actions.push({action:"setLockAlpha",params:[m]}),t.actions.push({action:"setIsEraser",params:[v]}),t.actions.push({action:"setUseDither",params:[y]}),y&&a(),i=Math.max(0,Math.min(1,i));var o=f?p*i*i:p,s=g?Math.max(.5,i*h):Math.max(.5,h);w=!0,l(e,r,s,o),s*d,x.x=e,x.y=r,x.pressure=i,b=ve.copyObj(x),t.actions.push({action:"startLine",params:[e,r,i]})},this.goLine=function(e,n,r){if(w){t.actions.push({action:"goLine",params:[e,n,r]});var i=ve.clamp(r,0,1),a=g?Math.max(.1,x.pressure*h):Math.max(.1,h);c(e,n,a,x.pressure),b=ve.copyObj(x),x.x=e,x.y=n,x.pressure=i}},this.endLine=function(e,n){var r=g?Math.max(.1,x.pressure*h):Math.max(.1,h);c(null,null,r,x.pressure),w=!1,C=null,t&&(t.actions.push({action:"endLine",params:[e,n]}),u.push(t),t=void 0)},this.drawLineSegment=function(e,t,r,i){if(x.x=r,x.y=i,x.pressure=1,!w&&void 0!==e){if(y&&a(),1===Math.round(2*h))o(e,t,r,i,!0);else{ve.pointsToAngleDeg({x:e,y:t},{x:r,y:i});var s,c=Math.sqrt(Math.pow(r-e,2)+Math.pow(i-t,2)),f=(r-e)/c,b=(i-t)/c,C=h*d;for(s=h*d;s<=c;s+=C)l(e+f*s,t+b*s,h,p)}var S={tool:["brush","PixelBrush"],actions:[]};S.actions.push({action:"sizePressure",params:[g]}),S.actions.push({action:"setSize",params:[h]}),S.actions.push({action:"setSpacing",params:[d]}),S.actions.push({action:"setOpacity",params:[p]}),S.actions.push({action:"setColor",params:[n]}),S.actions.push({action:"setLockAlpha",params:[m]}),S.actions.push({action:"setIsEraser",params:[v]}),S.actions.push({action:"setUseDither",params:[y]}),S.actions.push({action:"drawLineSegment",params:[e,t,r,i]}),u.push(S)}},this.isDrawing=function(){return w},this.setColor=function(e){n!==e&&(r="rgb("+(n=e).r+","+n.g+","+n.b+")")},this.setContext=function(t){e=t},this.setHistory=function(e){u=e},this.setSize=function(e){h=e},this.setOpacity=function(e){p=e},this.setSpacing=function(e){d=e},this.sizePressure=function(e){g=e},this.opacityPressure=function(e){f=e},this.setLockAlpha=function(e){m=e},this.setIsEraser=function(e){v=!!e},this.setUseDither=function(e){y=!!e},this.getSpacing=function(){return d},this.getSize=function(){return h},this.getOpacity=function(){return p},this.getLockAlpha=function(){return m},this.getIsEraser=function(){return v},this.getUseDither=function(){return y}},ChemyBrush:gr,SmudgeBrush:dr,EraserBrush:function(){var e,t,n,r=function(t,n,r,i){e.save(),e.globalCompositeOperation=g?f?"destination-out":"source-atop":"destination-out";var a=e.createRadialGradient(r,r,0,r,r,r),o=Math.pow(i,2);o=Math.max(0,Math.min((r-1)/r,o));var s=Math.max(0,Math.min(1,i)),l=2*s-s*s;a.addColorStop(o,"rgba(255, 255, 255, "+l+")"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=a,e.translate(t-r,n-r),e.fillRect(0,0,2*r,2*r),e.restore()},i=function(e,t,i){var a,h;i=Math.max(0,Math.min(1,i));var p=c?Math.max(.1,i*o):Math.max(.1,o),g=Math.max(1,Math.max(.5,1-l)*p*s);function f(e){var t=e.t;a=d.pressure*(1-t)+i*t,h=u?l*a*a:l,p=c?Math.max(.1,a*o):Math.max(.1,o),r(e.x,e.y,p,h)}null===e?n.addFinal(g,f):n.add(e,t,g,f)},a=new oi.DecoyKlHistory,o=30,s=.4,l=1,c=!0,u=!1,h={x:0,y:0,pressure:0},d={x:0,y:0,pressure:0},p=!1,g=!1,f=!1;this.startLine=function(i,a,m){(t={tool:["brush","EraserBrush"],actions:[]}).actions.push({action:"opacityPressure",params:[u]}),t.actions.push({action:"sizePressure",params:[c]}),t.actions.push({action:"setSize",params:[o]}),t.actions.push({action:"setOpacity",params:[l]}),t.actions.push({action:"setTransparentBG",params:[f]}),g=0===e.canvas.index,m=Math.max(0,Math.min(1,m));var v=u?l*m*m:l,y=c?Math.max(.1,m*o):Math.max(.1,o);p=!0,y>1&&r(i,a,y,v),y*s,h.x=i,h.y=a,h.pressure=m,d=ve.copyObj(h),(n=new ve.BezierLine).add(i,a,0,(function(){})),t.actions.push({action:"startLine",params:[i,a,m]})},this.goLine=function(e,n,r){p&&(t.actions.push({action:"goLine",params:[e,n,r]}),i(e,n,h.pressure),d=ve.copyObj(h),h.x=e,h.y=n,h.pressure=r)},this.endLine=function(){n&&i(null,null,h.pressure),p=!1,n=void 0,t&&(t.actions.push({action:"endLine",params:[]}),a.push(t),t=void 0)},this.drawLineSegment=function(t,n,i,d){if(g=0===e.canvas.index,h.x=i,h.y=d,!p&&void 0!==t){var m,v=Math.sqrt(Math.pow(i-t,2)+Math.pow(d-n,2)),y=(i-t)/v,x=(d-n)/v,b=Math.max(1,Math.max(.5,1-l)*o*s);for(m=0;m<=v;m+=b)r(t+y*m,n+x*m,o,l);var w={tool:["brush","EraserBrush"],actions:[]};w.actions.push({action:"opacityPressure",params:[u]}),w.actions.push({action:"sizePressure",params:[c]}),w.actions.push({action:"setSize",params:[o]}),w.actions.push({action:"setOpacity",params:[l]}),w.actions.push({action:"setTransparentBG",params:[f]}),w.actions.push({action:"drawLineSegment",params:[t,n,i,d]}),a.push(w)}},this.isDrawing=function(){return p},this.setContext=function(t){e=t},this.setHistory=function(e){a=e},this.setSize=function(e){o=e},this.setOpacity=function(e){l=e},this.sizePressure=function(e){c=e},this.opacityPressure=function(e){u=e},this.setTransparentBG=function(e){f=1==e},this.getSize=function(){return o},this.getOpacity=function(){return l}}},mr=20;pr=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("6YIcr");var vr,yr,xr,br=(vr={image:t(pr),tooltip:ze("brush-pen"),sizeSlider:{min:.5,max:100,curve:ve.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:0,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null},yr=[ze("brush-pen-circle"),ze("brush-pen-chalk"),ze("brush-pen-calligraphy"),ze("brush-pen-square")],Be.subscribe((function(){vr.tooltip=ze("brush-pen"),yr=[ze("brush-pen-circle"),ze("brush-pen-chalk"),ze("brush-pen-calligraphy"),ze("brush-pen-square")]})),vr.Ui=function(e){var t,n,r=function(){for(var e=0;e<s.length;e++)s[e].className=e===l?"brush-alpha-selected":"brush-alpha"},i=function(e){o.setSize(e),o.setSpacing(Math.max(2,h.interpolate(e))/15)},a=document.createElement("div"),o=new fr.PenBrush;o.setHistory(we),e.onSizeChange(o.getSize());for(var s=[],l=0,c=0;c<4;c++)!function(e){var t=ve.el({title:yr[e],onClick:function(){var t;l=t=e,o.setAlpha(t),r()}}),n=ve.canvas(70,70),i=n.getContext("2d");0===e||3===e?0===e?(i.beginPath(),i.arc(35,35,30,0,2*Math.PI),i.closePath(),i.fill()):i.fillRect(5,5,60,60):1===e?i.drawImage(tr(60),5,5):2===e&&i.drawImage(rr(60),5,5),t.style.backgroundImage="url("+n.toDataURL("image/png")+")",s.push(t)}(c);r();var u=new Fe({init:o.getLockAlpha(),label:ze("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:ze("brush-lock-alpha-title"),css:{cssFloat:"right",textAlign:"right"}}),h=new ve.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){t=new Ke({label:ze("brush-size"),width:225,height:30,min:vr.sizeSlider.min,max:vr.sizeSlider.max,initValue:o.getSize(),eventResMs:mr,onChange:function(t){i(t),e.onSizeChange(t)},curve:vr.sizeSlider.curve,formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),n=new Ke({label:ze("opacity"),width:225,height:30,min:vr.opacitySlider.min,max:vr.opacitySlider.max,initValue:vr.opacitySlider.max,eventResMs:mr,onChange:function(t){o.setOpacity(t),e.onOpacityChange(t)},curve:vr.opacitySlider.curve,formatFunc:function(e){return Math.round(100*e)}});var r=Ve(!0,(function(e){o.sizePressure(e)})),l=Ve(!1,(function(e){o.opacityPressure(e)}));a.append(ve.el({content:[t.getElement(),r],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),ve.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));for(var c=document.createElement("div"),h=0;h<s.length;h++)c.appendChild(s[h]);c.style.marginTop="10px",a.appendChild(c),c.appendChild(u.getElement())}(),this.increaseSize=function(e){o.isDrawing()||t.increaseValue(e)},this.decreaseSize=function(e){o.isDrawing()||t.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),t.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),n.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(e,t){o.endLine(e,t)},this.getBrush=function(){return o},this.isDrawing=function(){return o.isDrawing()},this.getElement=function(){return a}},vr);xr=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("bB4UN");var wr,Cr=function(){var e={image:t(xr),tooltip:ze("brush-blend"),sizeSlider:{min:.5,max:100,curve:ve.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:.01,max:1},Ui:null};return Be.subscribe((function(){e.tooltip=ze("brush-blend")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e)},a=document.createElement("div"),o=new fr.BlendBrush;o.setHistory(we),t.onSizeChange(o.getSize()),function(){n=new Ke({label:ze("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:29,eventResMs:mr,onChange:function(e){i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return e*=2,Math.round(e)}}),r=new Ke({label:ze("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:o.getOpacity(),eventResMs:mr,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}});var s=new Ke({label:ze("brush-blending"),width:225,height:30,min:0,max:100,initValue:100*o.getBlending(),eventResMs:mr,onChange:function(e){o.setBlending(e/100)}});s.getElement().style.marginTop="10px";var l=Ve(!0,(function(e){o.setSizePressure(e)})),c=Ve(!1,(function(e){o.setOpacityPressure(e)})),u=new Fe({init:o.getLockAlpha(),label:ze("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:ze("brush-lock-alpha-title"),css:{marginTop:"10px",display:"inline-block"}});a.append(ve.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),ve.el({content:[r.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}),s.getElement(),u.getElement())}(),this.increaseSize=function(e){o.getIsDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.getIsDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n,r){o.goLine(e,t,n,r)},this.endLine=function(){o.endLine()},this.getBrush=function(){return o},this.isDrawing=function(){return o.getIsDrawing()},this.getElement=function(){return a}},e}();wr=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("g9P1I");var Sr,kr=function(){var e={image:t(wr),tooltip:ze("brush-sketchy"),sizeSlider:{min:.5,max:10},opacitySlider:{min:.01,max:1},Ui:null};return Be.subscribe((function(){e.tooltip=ze("brush-sketchy")})),e.Ui=function(t){var n,r,i=document.createElement("div"),a=new fr.SketchyBrush;a.setHistory(we),t.onSizeChange(a.getSize()),function(){n=new Ke({label:ze("brush-size"),width:250,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:a.getSize(),eventResMs:mr,onChange:function(e){a.setSize(e),t.onSizeChange(a.getSize())},formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),r=new Ke({label:ze("opacity"),width:250,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:a.getOpacity(),eventResMs:mr,onChange:function(e){a.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}});var o=new Ke({label:ze("brush-blending"),width:250,height:30,min:0,max:100,initValue:100*a.getBlending(),eventResMs:mr,onChange:function(e){a.setBlending(e/100)}}),s=new Ke({label:ze("brush-sketchy-scale"),width:250,height:30,min:1,max:20,initValue:a.getScale(),eventResMs:mr,onChange:function(e){a.setScale(e)}});r.getElement().style.marginTop="10px",o.getElement().style.marginTop="10px",s.getElement().style.marginTop="10px",i.appendChild(n.getElement()),i.appendChild(r.getElement()),i.appendChild(o.getElement()),i.appendChild(s.getElement())}(),this.increaseSize=function(e){a.isDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){a.isDrawing()||n.decreaseValue(e)},this.getSize=function(){return a.getSize()},this.setSize=function(e){!function(e){a.setSize(e)}(e),n.setValue(e)},this.getOpacity=function(){return a.getOpacity()},this.setOpacity=function(e){a.setOpacity(e),r.setValue(e)},this.setColor=function(e){a.setColor(e)},this.setContext=function(e){a.setContext(e)},this.startLine=function(e,t,n){a.startLine(e,t,n)},this.goLine=function(e,t,n){a.goLine(e,t,n,null)},this.endLine=function(){a.endLine()},this.getSeed=function(){return parseInt(a.getSeed())},this.setSeed=function(e){a.setSeed(parseInt(e))},this.getBrush=function(){return a},this.isDrawing=function(){return a.isDrawing()},this.getElement=function(){return i}},e}();Sr=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("4iuI5");var Er,Mr=function(){var e={image:t(Sr),tooltip:ze("brush-pixel"),sizeSlider:{min:.5,max:100,curve:ve.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:0,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null};return Be.subscribe((function(){e.tooltip=ze("brush-pixel")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e),o.setSpacing(u.interpolate(e)/e)},a=document.createElement("div"),o=new fr.PixelBrush;o.setHistory(we),t.onSizeChange(o.getSize());var s=new Fe({init:o.getLockAlpha(),label:ze("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:ze("brush-lock-alpha-title"),css:{marginRight:"10px"}}),l=new Fe({init:o.getIsEraser(),label:ze("eraser"),callback:function(e){o.setIsEraser(e)},css:{marginRight:"10px"}}),c=new Fe({init:o.getUseDither(),label:ze("brush-pixel-dither"),callback:function(e){o.setUseDither(e)}}),u=new ve.SplineInterpolator([[.5,.45],[100,4]]);!function(){n=new Ke({label:ze("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:o.getSize(),eventResMs:mr,onChange:function(e){e=Math.round(2*e)/2,i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return e*=2,Math.round(e)}}),r=new Ke({label:ze("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:e.opacitySlider.max,eventResMs:mr,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},curve:e.opacitySlider.curve,formatFunc:function(e){return Math.round(100*e)}});var u=Ve(!0,(function(e){o.sizePressure(e)}));a.append(ve.el({content:[n.getElement(),u],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),r.getElement());var h=ve.el({parent:a,css:{display:"flex",marginTop:"10px"}});h.appendChild(s.getElement()),h.appendChild(l.getElement()),h.appendChild(c.getElement())}(),this.increaseSize=function(e){o.isDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.isDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(e,t){o.endLine(e,t)},this.getBrush=function(){return o},this.isDrawing=function(){return o.isDrawing()},this.getElement=function(){return a}},e}();Er=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("b6iuj");var Ir,Tr=function(){var e={image:t(Er),tooltip:ze("eraser")+" [E]",sizeSlider:{min:.5,max:200,curve:ve.quadraticSplineInput(.5,200,.1)},opacitySlider:{min:.01,max:1},Ui:null};return Be.subscribe((function(){e.tooltip=ze("eraser")+" [E]"})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e)},a=document.createElement("div"),o=new fr.EraserBrush;o.setHistory(we),t.onSizeChange(o.getSize());var s=!1;!function(){n=new Ke({label:ze("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:30,eventResMs:mr,onChange:function(e){i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),r=new Ke({label:ze("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:1,eventResMs:mr,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}});var l=Ve(!0,(function(e){o.sizePressure(e)})),c=Ve(!1,(function(e){o.opacityPressure(e)}));a.append(ve.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),ve.el({content:[r.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}}));var u=new Fe({init:!1,label:ze("brush-eraser-transparent-bg"),callback:function(e){s=e,o.setTransparentBG(e)},css:{marginTop:"10px"}});a.appendChild(u.getElement())}(),this.increaseSize=function(e){o.isDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.isDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(){o.endLine()},this.getBrush=function(){return o},this.getIsTransparentBg=function(){return s},this.isDrawing=function(){return o.isDrawing()},this.getElement=function(){return a}},e}();Ir=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("592st");var Rr,Lr=function(){var e={image:t(Ir),tooltip:ze("brush-smudge"),sizeSlider:{min:.5,max:100,curve:ve.quadraticSplineInput(.5,100,.1)},opacitySlider:{min:0,max:1,curve:[[0,.01],[.5,.3],[1,1]]},Ui:null};return Be.subscribe((function(){e.tooltip=ze("brush-smudge")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e),o.setSpacing(Math.max(2,l.interpolate(e))/15)},a=document.createElement("div"),o=new fr.SmudgeBrush;o.setHistory(we),t.onSizeChange(o.getSize());var s=new Fe({init:o.getLockAlpha(),label:ze("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:ze("brush-lock-alpha-title")}),l=new ve.SplineInterpolator([[0,15],[8,7],[14,4],[30,3],[50,2.7],[100,2]]);!function(){n=new Ke({label:ze("brush-size"),width:225,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:o.getSize(),eventResMs:mr,onChange:function(e){i(e),t.onSizeChange(e)},curve:e.sizeSlider.curve,formatFunc:function(e){return(e*=2)<10?Math.round(10*e)/10:Math.round(e)}}),r=new Ke({label:ze("opacity"),width:225,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:o.getOpacity(),eventResMs:mr,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},curve:e.opacitySlider.curve,formatFunc:function(e){return Math.round(100*e)}});var l=Ve(!1,(function(e){o.sizePressure(e)})),c=Ve(!1,(function(e){o.opacityPressure(e)}));a.append(ve.el({content:[n.getElement(),l],css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}),ve.el({content:[r.getElement(),c],css:{display:"flex",justifyContent:"space-between",alignItems:"center"}})),ve.el({parent:a,css:{marginTop:"10px"}}).append(s.getElement())}(),this.increaseSize=function(e){o.getIsDrawing()||n.increaseValue(e)},this.decreaseSize=function(e){o.getIsDrawing()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t,n)},this.goLine=function(e,t,n){o.goLine(e,t,n)},this.endLine=function(e,t){o.endLine()},this.getBrush=function(){return o},this.isDrawing=function(){return o.getIsDrawing()},this.getElement=function(){return a}},e}();Rr=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("8PAZJ"),a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var Ar=function(){"use strict";function e(t){var n=this;I.default(this,e),this.value=!!t.init,this.el=ve.el({content:t.label,title:t.title,className:"string"==typeof t.label?"kl-box-toggle":"kl-box-toggle kl-box-toggle--custom-el",onClick:function(){n.value=!n.value,n.update(),t.onChange(n.value)},css:{cursor:"pointer"}}),"string"!=typeof t.label&&ve.css(t.label,{display:"block",pointerEvents:"none"}),this.update()}return T.default(e,[{key:"update",value:function(){this.value?ve.addClassName(this.el,"kl-box-toggle--active"):ve.removeClassName(this.el,"kl-box-toggle--active")}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=!!e,this.update()}},{key:"getElement",value:function(){return this.el}},{key:"destroy",value:function(){ve.destroyEl(this.el)}}]),e}(),Pr=function(){var e={image:t(Rr),tooltip:ze("brush-chemy"),sizeSlider:{min:.25,max:25,curve:ve.quadraticSplineInput(.25,25,.1),isDisabled:!0},opacitySlider:{min:.01,max:1},Ui:null};return Be.subscribe((function(){e.tooltip=ze("brush-chemy")})),e.Ui=function(t){var n,r,i=function(e){o.setSize(e)},a=document.createElement("div"),o=new fr.ChemyBrush;o.setHistory(we),t.onSizeChange(o.getSize()),function(){n=new Ke({label:ze("brush-size"),width:250,height:30,min:e.sizeSlider.min,max:e.sizeSlider.max,initValue:o.getSize(),eventResMs:mr,isEnabled:"stroke"===o.getMode(),onChange:function(e){i(e),t.onSizeChange(o.getSize())},curve:e.sizeSlider.curve,formatFunc:function(e){return(e*=2)<5?Math.round(10*e)/10:Math.round(e)}}),r=new Ke({label:ze("opacity"),width:250,height:30,min:e.opacitySlider.min,max:e.opacitySlider.max,initValue:o.getOpacity(),eventResMs:mr,onChange:function(e){o.setOpacity(e),t.onOpacityChange(e)},formatFunc:function(e){return Math.round(100*e)}}),ve.css(r.getElement(),{marginTop:"10px"});var s=new Fe({init:o.getIsEraser(),label:ze("eraser"),callback:function(e){o.setIsEraser(e)},css:{marginTop:"10px",marginLeft:"10px"}}),l=new Fe({init:o.getLockAlpha(),label:ze("brush-lock-alpha"),callback:function(e){o.setLockAlpha(e)},doHighlight:!0,title:ze("brush-lock-alpha-title"),css:{marginTop:"10px"}}),c=ve.el({css:{display:"flex",marginTop:"10px"}}),u=19,h=new et({optionArr:[{id:"fill",label:ve.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"#000",style:"transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(u,", ").concat(u,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:ze("brush-chemy-fill")},{id:"stroke",label:ve.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(".concat(u,", ").concat(u,") translate(0.5px, 0.5px)"),d:"M 0,0 C 1.5,0 -0.5,1 1,1"}]}),title:ze("brush-chemy-stroke")}],initId:o.getMode(),onChange:function(r){o.setMode(r),e.sizeSlider.isDisabled="fill"===o.getMode(),n.setIsEnabled(!e.sizeSlider.isDisabled),n.setValue(o.getSize()),t.onSizeChange(o.getSize()),t.onConfigChange()}}),d=new Ar({label:ve.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(17.5,",").concat(8," ").concat(17.5,",").concat(27)}]}),title:ze("brush-chemy-mirror-x"),init:o.getXSymmetry(),onChange:function(e){o.setXSymmetry(e)}}),p=new Ar({label:ve.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"path",fill:"none",stroke:"#000",style:"stroke-width: 1px",d:"M ".concat(8,",").concat(17.5," ").concat(27,",").concat(17.5)}]}),title:ze("brush-chemy-mirror-y"),init:o.getYSymmetry(),onChange:function(e){o.setYSymmetry(e)}}),g=new Ar({label:ve.createSvg({elementType:"svg",width:"35",height:"35",childrenArr:[{elementType:"defs",childrenArr:[{elementType:"linearGradient",id:"gradient",x1:"0",y1:"0",x2:"0",y2:"1",childrenArr:[{elementType:"stop",offset:"0%","stop-color":"rgba(0,0,0,0)"},{elementType:"stop",offset:"100%","stop-color":"rgba(0,0,0,1)"}]}]},{elementType:"rect",fill:"url('#gradient')",x:"8",y:"8",width:"19",height:"19"}]}),title:ze("brush-chemy-gradient"),init:o.getGradient(),onChange:function(e){o.setGradient(e)}});ve.css(d.getElement(),{marginLeft:"10px"});var f={marginLeft:"4px"};ve.css(p.getElement(),f),ve.css(g.getElement(),f),c.append(h.getElement(),d.getElement(),p.getElement(),g.getElement()),a.append(n.getElement(),r.getElement(),c,ve.el({content:[l.getElement(),s.getElement()],css:{display:"flex"}}))}(),this.increaseSize=function(e){o.getIsDrawing()||"stroke"!==o.getMode()||n.increaseValue(e)},this.decreaseSize=function(e){o.getIsDrawing()||"stroke"!==o.getMode()||n.decreaseValue(e)},this.getSize=function(){return o.getSize()},this.setSize=function(e){i(e),n.setValue(e)},this.getOpacity=function(){return o.getOpacity()},this.setOpacity=function(e){o.setOpacity(e),r.setValue(e)},this.setColor=function(e){o.setColor(e)},this.setContext=function(e){o.setContext(e)},this.startLine=function(e,t,n){o.startLine(e,t)},this.goLine=function(e,t,n,r){o.goLine(e,t)},this.endLine=function(){o.endLine()},this.getBrush=function(){return o},this.isDrawing=function(){return o.getIsDrawing()},this.getElement=function(){return a}},e}(),Or={penBrush:br,blendBrush:Cr,sketchyBrush:kr,pixelBrush:Mr,chemyBrush:Pr,smudgeBrush:Lr,eraserBrush:Tr};function Dr(e,t,n,r){if(t||!((r.height||window.innerHeight)<500||(r.width||window.innerWidth)<700)){var i,a=ve.el({tagName:"iframe",custom:{src:e},css:{width:"100%",height:"100%"}}),o=ve.el({});t||(i=ve.el({tagName:"a",parent:o,content:ze("modal-new-tab"),custom:{href:"help",target:"_blank"},onClick:function(){s.close()}}),a.onload=function(){ve.setAttributes(i,{href:""+a.contentWindow.location})});var s=new He({target:n,title:o,content:a,width:880,isMaxHeight:!0,onClose:function(){i&&ve.destroyEl(i)}})}else window.open(e)}a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var Br=function(){"use strict";function e(t){var n=t.name,r=t.init,i=t.items,a=t.ignoreFocus,o=this;I.default(this,e),this.inputs=[],this.el=ve.el({className:"kl-radio"}),i.forEach((function(e){var t=ve.el({tagName:"label"}),i=ve.el({tagName:"input",parent:t,custom:{name:n,value:e.value,type:"radio"}});a&&i.setAttribute("data-ignore-focus","true"),r===e.value&&(i.checked=!0),t.append(e.label),o.el.append(t),o.inputs.push(i)}))}return T.default(e,[{key:"getValue",value:function(){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].checked)return this.inputs[e].value;return null}},{key:"getElement",value:function(){return this.el}}]),e}();a("cf2NR");I=a("hDZfO"),s=a("5atYG"),T=a("3SSYo");var zr=function(){"use strict";function e(n,r,i,a){var o,c=this;I.default(this,e);var u=this;this.projectStore=n,this.getProject=r,this.saveReminder=i,this.options=a,this.element=ve.el({css:{display:"grid",gridTemplateColumns:"1fr 0fr",gridTemplateRows:"0fr 0fr 0fr",gap:"0 0",gridTemplateAreas:'"title title" "preview store" "preview clear"'}});var h=ve.el({parent:this.element,content:ze("file-storage"),css:{gridArea:"title",display:"flex",margin:"-5px 0"}});this.infoEl=ve.el({parent:h,content:"?",title:ze("file-storage-about"),css:{cursor:"pointer",marginLeft:"5px",width:"19px",height:"19px",borderRadius:"100%",textAlign:"center",lineHeight:"19px",fontWeight:"bold",boxShadow:"inset 0 0 0 1px #000"},onClick:function(){Dr("./help/#help-browser-storage",!1,i.getEl(),i.getBBox())}}),this.projectStore.isBroken()?ve.el({parent:this.element,content:" "+ze("file-storage-cant-access"),css:{marginTop:"10px"}}):(this.previewEl=ve.el({parent:this.element,title:ze("file-storage-thumb-title"),css:{gridArea:"preview",display:"flex",alignItems:"center",justifyContent:"center",marginTop:"10px",position:"relative",boxShadow:"inset 0 0 0 1px #aaa",background:"#cdcdcd",color:"#545454",colorScheme:"only light",minHeight:"67px"}}),this.ageEl=ve.el({css:{position:"absolute",right:"0",bottom:"0",width:"100%",textAlign:"center",background:"rgba(0,0,0,0.7)",color:"#fff",textSize:"13px"}}),this.storeEl=ve.el({parent:this.element,tagName:"button",className:"gridButton",content:ze("file-storage-store"),css:{gridArea:"store"},custom:{tabIndex:-1},onClick:function(){return c.store()}}),this.storeEl.tabIndex=-1,this.clearEl=ve.el({parent:this.element,tagName:"button",className:"gridButton",content:'<img src="'+t(lt)+'" height="20"/> '+ze("file-storage-clear"),css:{gridArea:"clear"},custom:{tabIndex:-1},onClick:function(){return c.clear()}}),(null===(o=this.options)||void 0===o?void 0:o.hideClearButton)&&(this.clearEl.style.display="none"),this.storeListener={onUpdate:function(e,t){c.updateThumb(e,t)}},this.projectStore.subscribe(this.storeListener),setInterval((function(){return c.updateAge()}),6e4),s.default(t(l).mark((function e(){var n;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.projectStore.read();case 3:(n=e.sent)?u.updateThumb(n.timestamp,n.thumbnail):u.updateThumb(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),setTimeout((function(){throw new Error("storage-ui: failed initial read browser storage, "+e.t0)}),0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))())}return T.default(e,[{key:"updateAge",value:function(){if(this.timestamp){var e,t=(new Date).getTime()-this.timestamp;t=Math.floor(t/1e3/60),e=ze("file-storage-min-ago").replace("{x}",""+t),t>60&&(t=Math.floor(t/60),e=ze("file-storage-hours-ago").replace("{x}",""+t),t>24&&(t=Math.floor(t/24),e=ze("file-storage-days-ago").replace("{x}",""+t),t>31&&(e=ze("file-storage-month-ago")))),this.ageEl.textContent=e}}},{key:"resetButtons",value:function(){this.timestamp?(this.storeEl.textContent=ze("file-storage-overwrite"),this.storeEl.disabled=!1,this.clearEl.disabled=!1):(this.storeEl.textContent=ze("file-storage-store"),this.storeEl.disabled=!1,this.clearEl.disabled=!0)}},{key:"updateThumb",value:function(e,t){this.timestamp=e,this.timestamp?(ve.css(t,{display:"block",maxWidth:"calc(100% - 2px)",maxHeight:"calc(100% - 2px)",margin:"0 auto",background:"url('"+ve.createCheckerCanvas(4).toDataURL("image/png")+"')",boxShadow:"0 0 0 1px #aaa",pointerEvents:"none"}),this.previewEl.innerHTML="",this.updateAge(),this.previewEl.append(t,this.ageEl)):this.previewEl.innerHTML=ze("file-storage-empty"),this.resetButtons()}},{key:"store",value:function(){return s.default(t(l).mark((function e(){var n;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.getProject())){e.next=18;break}return this.storeEl.textContent=ze("file-storage-storing"),this.storeEl.disabled=!0,this.clearEl.disabled=!0,e.next=7,new Promise((function(e){setTimeout((function(){return e(null)}),20)}));case 7:return e.prev=7,e.next=10,this.projectStore.store(n);case 10:this.saveReminder.reset(),e.next=18;break;case 13:e.prev=13,e.t0=e.catch(7),this.resetButtons(),oi.popup({target:this.saveReminder.getEl(),type:"error",message:["".concat(ze("file-storage-failed-1"),"<ul>"),"<li>".concat(ze("file-storage-failed-2"),"</li>"),"<li>".concat(ze("file-storage-failed-3"),"</li>"),"<li>".concat(ze("file-storage-failed-4"),"</li>"),"</ul>"].join(""),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to store browser storage, "+e.t0)}),0);case 18:case"end":return e.stop()}}),e,this,[[7,13]])})).bind(this))()}},{key:"clear",value:function(){return s.default(t(l).mark((function e(){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.storeEl.disabled=!0,this.clearEl.disabled=!0,e.prev=2,e.next=5,this.projectStore.clear();case 5:e.next=12;break;case 7:e.prev=7,e.t0=e.catch(2),this.resetButtons(),oi.popup({target:this.saveReminder.getEl(),type:"error",message:ze("file-storage-failed-clear"),buttons:["Ok"]}),setTimeout((function(){throw new Error("storage-ui: failed to clear browser storage, "+e.t0)}),0);case 12:case"end":return e.stop()}}),e,this,[[2,7]])})).bind(this))()}},{key:"getElement",value:function(){return this.element}},{key:"show",value:function(){}},{key:"hide",value:function(){}},{key:"destroy",value:function(){ve.destroyEl(this.infoEl),ve.destroyEl(this.storeEl),ve.destroyEl(this.clearEl),this.projectStore.unsubscribe(this.storeListener)}}]),e}();a("cf2NR");I=a("hDZfO"),s=a("5atYG"),T=a("3SSYo");a("cf2NR");I=a("hDZfO"),T=a("3SSYo"),s=a("5atYG");function jr(e){for(var t=e.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),n=atob(t[3]),r=new ArrayBuffer(n.length),i=new Uint8Array(r),a=0;a<i.length;a++)i[a]=n.charCodeAt(a);return new Blob([i],{type:t[1]})}function Hr(e){return new Promise((function(t,n){var r=new Image;try{r.src=ve.imageBlobToUrl(e)}catch(e){return void n("imageBlobToUrl, "+e.message)}r.onload=function(){URL.revokeObjectURL(r.src),t(r)},r.onabort=function(){n("layer image failed loading")},r.onerror=function(){n("layer image failed loading")}}))}var Fr=function(){"use strict";function e(){I.default(this,e)}return T.default(e,null,[{key:"createThumbnail",value:function(e){return yt(e,ve.fitInto(e.width,e.height,240,240).width/e.width)}},{key:"createStorageProject",value:function(t){return{id:1,timestamp:(new Date).getTime(),thumbnail:jr(e.createThumbnail(t).toDataURL("image/png")),width:t.width,height:t.height,layers:t.layers.map((function(e){var t;if(!(e.image instanceof HTMLCanvasElement))throw new Error("Not implemented");return t=jr(e.image.toDataURL("image/png")),{name:e.name,opacity:e.opacity,mixModeStr:e.mixModeStr,blob:t}}))}}},{key:"readStorageProject",value:function(n){return s.default(t(l).mark((function r(){var i,a;return t(l).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!n.width||!n.height||isNaN(n.width)||isNaN(n.height)||n.width<1||n.height<1)){t.next=2;break}throw new Error("readStorageProject invalid canvas size: "+n.width+", "+n.height);case 2:return t.t0=n.width,t.t1=n.height,t.next=6,Promise.all(n.layers.map((function(e){return Hr(e.blob)})));case 6:if(t.t2=t.sent.map((function(e,t){return{name:n.layers[t].name,opacity:n.layers[t].opacity,mixModeStr:n.layers[t].mixModeStr,image:e}})),i={width:t.t0,height:t.t1,layers:t.t2},!n.thumbnail){t.next=15;break}return t.next=12,Hr(n.thumbnail);case 12:a=t.sent,t.next=16;break;case 15:a=e.createThumbnail(i);case 16:return t.abrupt("return",{project:i,timestamp:n.timestamp,thumbnail:a});case 17:case"end":return t.stop()}}),r)})))()}}]),e}();function Nr(e){return new Promise((function(t,n){e(t,n)}))}var _r=function(){"use strict";function e(){var n=this;I.default(this,e),this.listeners=[],this.accessHasFailed=!1,window.addEventListener("storage",(function(e){if("indexedDbUpdatedAt"===e.key&&0!==n.listeners.length)try{var r=n;s.default(t(l).mark((function e(){var n;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.read();case 2:(n=e.sent)?r.emit(n.timestamp,n.thumbnail):r.emit();case 4:case"end":return e.stop()}}),e)})))()}catch(e){0===e.message.indexOf("db-error")&&(n.accessHasFailed=!0)}}))}return T.default(e,[{key:"lowLevelStore",value:function(e){return s.default(t(l).mark((function n(){return t(l).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,n){Tn(e,t,n)}));case 2:case"end":return t.stop()}}),n)})))()}},{key:"lowLevelRead",value:function(){return s.default(t(l).mark((function e(){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nr(In);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()}},{key:"lowLevelClear",value:function(){return s.default(t(l).mark((function e(){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nr(Rn);case 2:case"end":return e.stop()}}),e)})))()}},{key:"emit",value:function(e,t){this.listeners.forEach((function(n){n.onUpdate(e,t)}))}},{key:"updateTimestamp",value:function(){me.setItem("indexedDbUpdatedAt",""+(new Date).getTime())}},{key:"read",value:function(){return s.default(t(l).mark((function e(){var n,r;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.lowLevelRead();case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.accessHasFailed=!0,new Error("db-error: "+e.t0);case 11:if(n){e.next=13;break}return e.abrupt("return",null);case 13:return e.prev=14,e.next=17,Fr.readStorageProject(n);case 17:r=e.sent,e.next=23;break;case 20:throw e.prev=20,e.t1=e.catch(14),new Error("format-error: "+e.t1);case 23:return e.abrupt("return",r);case 24:case"end":return e.stop()}}),e,this,[[1,7],[14,20]])})).bind(this))()}},{key:"store",value:function(e){var n=this;return s.default(t(l).mark((function r(){var i,a,o;return t(l).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=Fr.createStorageProject(e),t.next=4,this.lowLevelStore(i);case 4:t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(0),this.accessHasFailed=!0,new Error("db-error: "+t.t0);case 10:return t.next=12,this.lowLevelRead();case 12:return a=t.sent,o=null,t.prev=14,t.next=17,Fr.readStorageProject(a);case 17:o=t.sent,t.next=27;break;case 20:return t.prev=20,t.t1=t.catch(14),t.next=24,this.lowLevelClear();case 24:throw this.updateTimestamp(),setTimeout((function(){return n.emit()}),0),new Error("format-error: "+t.t1);case 27:this.updateTimestamp(),setTimeout((function(){return n.emit(o.timestamp,o.thumbnail)}),0);case 29:case"end":return t.stop()}}),r,this,[[0,6],[14,20]])})).bind(this))()}},{key:"clear",value:function(){var e=this;return s.default(t(l).mark((function n(){return t(l).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.lowLevelClear();case 2:this.updateTimestamp(),setTimeout((function(){return e.emit()}),0);case 4:case"end":return t.stop()}}),n,this)})).bind(this))()}},{key:"subscribe",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.listeners.length;t++)if(e===this.listeners[t])return void this.listeners.splice(t,1)}},{key:"isBroken",value:function(){return this.accessHasFailed}}]),e}();a("cf2NR");var Xr;I=a("hDZfO"),T=a("3SSYo");Xr=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("jiQCe");var Ur=function(){"use strict";function e(n,r,i,a,o,s,l,c,u,h,d,p){var g=this;I.default(this,e),this.exportType=a;var f=this;this.div=document.createElement("div");setTimeout((function(){var e=function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div");return e.appendChild(t),e.appendChild(n),ve.css(t,{clear:"both"}),ve.css(n,{marginLeft:"10px",marginRight:"10px",marginTop:"10px",borderBottom:"1px solid rgba(0,0,0,0.2)",clear:"both"}),e},n=document.createElement("div"),m=document.createElement("button"),v=document.createElement("button"),y=document.createElement("button"),x=document.createElement("button"),b=document.createElement("button");m.style.cssFloat="left",ve.css(v,{cssFloat:"left",clear:"both"}),ve.css(b,{cssFloat:"left",clear:"both"}),m.tabIndex=-1,v.tabIndex=-1,y.tabIndex=-1,x.tabIndex=-1,b.tabIndex=-1,m.innerHTML="<img src='".concat(t(Xt),"' alt='icon' height='20'/>").concat(ze("file-new")),v.innerHTML="<img src='".concat(t(Yt),"' alt='icon' height='20'/>").concat(ze("file-save")),y.innerHTML="<img src='".concat(t(Wt),"' alt='icon' height='20'/>").concat(ze("file-share")),x.innerHTML="<img style='float:left' src='".concat(t(Xr),"' height='20' alt='icon'/>").concat(ze("file-upload")),b.innerHTML="<img src='".concat(t(We),"' alt='icon' height='20'/>").concat(ze("file-copy")),b.title=ze("file-copy-title"),m.className="gridButton",v.className="gridButton",y.className="gridButton",x.className="gridButton",b.className="gridButton",g.importButton=document.createElement("input"),g.importButton.tabIndex=-1,g.importButton.type="file",g.importButton.multiple=!0,g.importButton.accept="image",g.importButton.size="71",g.importButton.textContent="Import";var w,C,S=g.importButton;!function(){(S=document.createElement("div")).className="gridButton",S.style.position="relative",S.style.cursor="pointer",S.style.cssFloat="left";var e=document.createElement("div");e.style.width="120px",e.style.height="28px",e.style.overflow="hidden",e.style.cursor="pointer",e.style.position="relative",S.appendChild(e),e.appendChild(f.importButton);var n=document.createElement("button");n.innerHTML="<img style='float:left' height='20' src='"+t(Ut)+"' alt='icon'/>"+ze("file-import"),n.tabIndex=-1,ve.css(n,{width:"120px",display:"box",position:"absolute",left:"0",top:"0",cursor:"pointer"}),ve.css(f.importButton,{display:"none"}),S.appendChild(n),n.onclick=function(){f.importButton.click()}}(),g.importButton.onchange=function(e){s(f.importButton.files,"default"),f.importButton.value=""},w=ve.el({css:{fontSize:"15px",marginLeft:"10px",marginTop:"10px",cssFloat:"left",width:"calc(50% - 15px)",height:"30px"}}),C=new oi.Select({optionArr:[["png",ze("file-save-png")],["psd",ze("file-save-psd")],["layers",ze("file-save-layers")]],initValue:a,onChange:function(e){o(a=e),l()}}),ve.css(C.getElement(),{width:"120px",height:"30px"}),w.appendChild(C.getElement()),m.onclick=c,v.onclick=function(){l()},y.onclick=function(){y.disabled=!0,"function"==typeof u&&u((function(){y.disabled=!1}))},x.onclick=function(){h()},b.onclick=function(){b.blur(),d()};var k=document.createElement("div");k.textContent=" "+ze("file-no-autosave"),ve.css(k,{textAlign:"center",marginTop:"10px",background:"rgb(243, 243, 161)",padding:"5px 0px",color:"rgba(0,0,0,0.65)",fontSize:"15px"}),r&&(f.fileBrowserStorage=new zr(r,i,p),ve.css(f.fileBrowserStorage.getElement(),{margin:"10px"})),ve.append(n,[k,m,S,ve.el({css:{clear:"both"}}),v,w,ve.el({css:{clear:"both"}}),b,"function"==typeof u&&ve.canShareFiles()?y:null,ve.el({css:{clear:"both"}}),e(),f.fileBrowserStorage?f.fileBrowserStorage.getElement():null,f.fileBrowserStorage?e():null,x]),g.div.appendChild(n)}),1)}return T.default(e,[{key:"refresh",value:function(){}},{key:"getElement",value:function(){return this.div}},{key:"setIsVisible",value:function(e){e&&this.refresh()}},{key:"triggerImport",value:function(){this.importButton.click()}}]),e}();a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var Yr=function(){"use strict";function e(t,n,r,i,a,o,s,l,c,u,h,d){I.default(this,e),this.klApp=t,this.klColorSlider=n,this.layerManager=r,this.setCurrentLayer=i,this.klCanvasWorkspace=a,this.handUi=o,this.getCurrentColor=s,this.getKlMaxCanvasSize=l,this.getKlCanvas=c,this.getCurrentLayerCtx=u,this.isEmbed=h,this.statusOverlay=d,this.isInit=!1,this.div=document.createElement("div")}return T.default(e,[{key:"init",value:function(){var e=function(e,t){var n=document.createElement("button"),i=t[e].buttonLabel?t[e].buttonLabel:t[e].name,a='<img height="20" width="18" src="'+t[e].icon+'" alt="icon" />';return n.innerHTML=a+i,n.className="gridButton",ve.css(n,{lineHeight:"20px",fontSize:"12px"}),n.tabIndex=-1,n.onclick=function(){if("apply"in t[e])if(t[e].isInstant)n.blur(),l(null),r.statusOverlay.out('"'+t[e].name+'" '+ze("filter-applied"),!0);else{var i,a=r.klColorSlider.getSecondaryRGB(),o=t[e].getDialog({context:r.getCurrentLayerCtx(),canvas:r.getKlCanvas(),maxWidth:r.getKlMaxCanvasSize(),maxHeight:r.getKlMaxCanvasSize(),bbox:r.klApp.getBBox(),currentColorRgb:{r:r.getCurrentColor().r,g:r.getCurrentColor().g,b:r.getCurrentColor().b},secondaryColorRgb:{r:a.r,g:a.g,b:a.b}});if(!o)return;o.errorCallback=function(e){setTimeout((function(){throw alert("Error: could not perform action"),e}),0),i()};var s={};"width"in o&&(s.width=o.width+"px"),oi.popup({target:r.klApp.getEl(),message:"<b>"+t[e].name+"</b>",div:o.element,style:s,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(n){!function(n,r){if("Cancel"!=n){var i;try{i=r.getInput()}catch(n){throw-1!==n.message.indexOf(".getInput is not a function")?"filterDialog.getInput is not a function, filter: "+t[e].name:n}l(i)}else r.destroy&&r.destroy()}(n,o)},closefunc:function(e){i=e}})}else alert("Application not fully loaded");function l(n){!1===t[e].apply({context:r.getCurrentLayerCtx(),canvas:r.getKlCanvas(),history:we,input:n})&&alert("Couldn't apply the edit action"),!0===t[e].updateContext&&r.setCurrentLayer(r.getKlCanvas().getLayer(r.layerManager.getSelected())),!0===t[e].updatePos&&(r.klCanvasWorkspace.resetView(),r.handUi.update(r.klCanvasWorkspace.getScale(),r.klCanvasWorkspace.getAngleDeg())),r.layerManager.update()}},o[o.length]=n,n},t=function(e,t){if((t[e].webgl||t[e].ieFails)&&(!t[e].ieFails||"Microsoft Internet Explorer"===navigator.appName)){var n=t[e].buttonLabel?t[e].buttonLabel:t[e].name,r=document.createElement("button"),i='<img style="opacity: 0.5" src="img/'+t[e].icon+'" />',a=t[e].name;return a.length>11&&(a="<span style='font-size: 12px'>"+n+"</span>"),r.innerHTML=i+a,r.className="gridButton",r.disabled=!0,r}},n=function(n,a,o){for(var s in a)!a.hasOwnProperty[s]&&n.includes(s)&&(r.isEmbed&&!a[s].inEmbed||(a[s].webgl&&i||a[s].neededWithWebGL||!a[s].webgl&&!i&&(!a[s].ieFails||"Microsoft Internet Explorer"!=navigator.appName)?o.appendChild(e(s,a)):(o.appendChild(t(s,a)),a[s]=void 0)))},r=this,i=ve.hasWebGl(),a=oi.filterLib,o=[];if(ve.BbLog.emit({type:"init-filters"}),!oi.filterLibStatus.isLoaded)throw new Error("filters not loaded");var s=["cropExtend","flip","glPerspective","resize","rotate","transform"],l=[];for(var c in a)a.hasOwnProperty[c]||s.includes(c)||l.push(c);n(s,a,r.div);var u=document.createElement("div");if(u.className="gridHr",r.div.appendChild(u),n(l,a,r.div),!i){var h=ve.appendTextDiv(r.div,"Some actions are disabled because WebGL isn't working.");h.style.margin="10px",ve.css(h,{fontSize:"11px",color:"#555",background:"#ffe",padding:"10px",borderRadius:"10px",textAlign:"center"})}this.isInit=!0}},{key:"getElement",value:function(){return this.div}},{key:"show",value:function(){this.isInit||this.init(),this.div.style.display="block"}},{key:"hide",value:function(){this.div.style.display="none"}}]),e}();a("cf2NR");var Wr;s=a("5atYG");function Vr(e,t,n,r,i){return Gr.apply(this,arguments)}function Gr(){return(Gr=s.default(t(l).mark((function e(n,r,i,a,o){var s,c,u,h,d,p,g,f;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=jr(n.toDataURL("image/"+a)),c=window.open(),u=c.document.createElement("div"),(h=c.document.createElement("img")).src=t(Wr),u.appendChild(h),ve.css(h,{filter:"invert(1)"}),c.document.body.style.backgroundColor="#121211",c.document.body.style.backgroundImage="linear-gradient(#2b2b2b 0%, #121211 50%)",c.document.body.style.backgroundRepeat="no-repeat",(d=c.document.createElement("div")).style.marginTop="10px",u.appendChild(d),d.textContent=ze("upload-uploading"),c.document.body.appendChild(u),ve.css(u,{marginLeft:"auto",marginRight:"auto",marginTop:"100px",fontFamily:"Arial, sans-serif",fontSize:"20px",textAlign:"center",transition:"opacity 0.3s ease-in-out",opacity:"0",color:"#ccc"}),setTimeout((function(){u.style.opacity="1"}),20),e.prev=18,(g=new FormData).append("title",r),g.append("description",i),g.append("image",s),e.next=25,fetch("https://api.imgur.com/3/image",{method:"POST",headers:{Authorization:"Client-ID "+o},body:g});case 25:p=e.sent,e.next=32;break;case 28:throw e.prev=28,e.t0=e.catch(18),c.close(),new Error(e.t0);case 32:if(p.ok){e.next=35;break}throw c.close(),new Error;case 35:return e.next=37,p.json();case 37:return f=e.sent.data,c.location.href=f.link.replace(/\.(jpg|png)/,""),e.abrupt("return",f);case 40:case"end":return e.stop()}}),e,null,[[18,28]])})))).apply(this,arguments)}Wr=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("iYFqx"),a("cf2NR");var Kr;s=a("5atYG");function qr(){return(qr=s.default(t(l).mark((function e(){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Kr){e.next=5;break}return e.next=3,a("2TDyk");case 3:Kr=e.sent,ve.BbLog.emit({type:"loaded-agpsd"});case 5:return e.abrupt("return",Kr);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var Zr=function(){"use strict";function e(t,n,r,i,a,o,s,l,c){var u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"Klecks";I.default(this,e),this.history=t,this.showReminder=n,this.changeTitle=r,this.onSaveAsPsd=i,this.isDrawing=a,this.projectStore=o,this.getProject=s,this.getEl=l,this.getBBox=c,this.title=u,this.lastSavedActionNumber=null}return T.default(e,[{key:"showPopup",value:function(){var e=this;if(!this.projectStore||!this.getProject||!this.getProject())throw new Error("projectStore and getProject need to be set");var t=Math.round((performance.now()-this.lastSavedAt)/1e3/60),n=ve.el({});n.append(ve.el({content:ze("save-reminder-text",{a:"<strong>"+t,b:"</strong>"}),css:{marginBottom:"20px"}}));var r=ve.el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px"}}),i=ve.el({css:{borderTop:"1px solid #aaa",margin:"0 -20px",padding:"20px",paddingBottom:"0"}});n.append(r,i);var a=ve.el({tagName:"button",className:"kl-button",content:ze("save-reminder-save-psd"),onClick:function(){return e.onSaveAsPsd()}});r.append(a,ve.el({content:ze("save-reminder-psd-layers"),css:{marginTop:"10px"}}));var o=new zr(this.projectStore,this.getProject,this,{hideClearButton:!0});i.append(o.getElement()),oi.popup({target:this.getEl(),message:"<b>".concat(ze("save-reminder-title"),"</b>"),div:n,ignoreBackground:!0,callback:function(){o.destroy(),ve.destroyEl(a),e.closeFunc=null,e.lastReminderShownAt=performance.now()},closefunc:function(t){e.closeFunc=t}}),setTimeout((function(){a.focus()}),40)}},{key:"init",value:function(){var e=this,t=function(e){e.preventDefault(),e.returnValue=""};null===this.lastSavedActionNumber&&(this.lastSavedActionNumber=this.history.getActionNumber(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),this.showReminder&&setInterval((function(){if("visible"===document.visibilityState){var t=Math.abs(e.history.getActionNumber()-e.lastSavedActionNumber);0===oi.dialogCounter.get()&&!e.isDrawing()&&e.lastReminderShownAt+12e5<performance.now()&&t>=100&&e.showPopup()}}),5e3),this.history.addListener((function(){var n=e.history.getActionNumber();e.lastSavedActionNumber!==n?ve.setEventListener(window,"onbeforeunload",t):ve.setEventListener(window,"onbeforeunload",null)})),this.changeTitle&&document.addEventListener("visibilitychange",(function(){if("visible"===document.visibilityState)document.title=e.title,clearInterval(e.unsavedInterval);else{var t=e.history.getActionNumber();if(e.lastSavedActionNumber!==t){var n=e;document.title=ze("unsaved")+" - "+e.title;var r=0;e.unsavedInterval=setInterval((function(){r=(r+1)%2,document.title=1===r?ze("unsaved")+"  "+n.title:ze("unsaved")+" - "+n.title}),18e4)}}})))}},{key:"reset",value:function(){null!==this.lastSavedActionNumber&&(this.lastSavedActionNumber=this.history.getActionNumber(),this.lastReminderShownAt=performance.now(),this.lastSavedAt=performance.now(),ve.setEventListener(window,"onbeforeunload",null),this.closeFunc&&this.closeFunc())}}]),e}();a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var Jr,Qr,$r={};Jr=$r,Qr=function(){"use strict";var e=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){o(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()},t=function(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status},r=function(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}},i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,a=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(n,a,o){var s=i.URL||i.webkitURL,l=document.createElement("a");a=a||n.name||"download",l.download=a,l.rel="noopener","string"==typeof n?(l.href=n,l.origin===location.origin?r(l):t(l.href)?e(n,a,o):r(l,l.target="_blank")):(l.href=s.createObjectURL(n),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(n,i,a){if(i=i||n.name||"download","string"!=typeof n)navigator.msSaveOrOpenBlob((s=n,void 0===(l=a)?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\ufeff",s],{type:s.type}):s),i);else if(t(n))e(n,i,a);else{var o=document.createElement("a");o.href=n,o.target="_blank",setTimeout((function(){r(o)}))}var s,l}:function(t,n,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,r);var s="application/octet-stream"===t.type,l=/constructor/i.test(i.HTMLElement)||i.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||a)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var e=u.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},u.readAsDataURL(t)}else{var h=i.URL||i.webkitURL,d=h.createObjectURL(t);o?o.location=d:location.href=d,o=null,setTimeout((function(){h.revokeObjectURL(d)}),4e4)}});i.saveAs=o.saveAs=o,$r=o},"function"==typeof define&&define.amd?define([],Qr):void 0!==$r?Qr():(Qr(),Jr.FileSaver={});var ei=function(){"use strict";function e(t,n,r,i,a,o){I.default(this,e),this.customSave=t,this.saveReminder=n,this.klRootEl=r,this.getExportType=i,this.getKlCanvas=a,this.filenameBase=o}return T.default(e,[{key:"save",value:function(e){var t=function(e,t,r){for(var i=e.toDataURL(r).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/),a=atob(i[3]),o=new ArrayBuffer(a.length),s=new Uint8Array(o),l=0;l<s.length;l++)s[l]=a.charCodeAt(l);var c=new Blob([s],{type:i[1]});"function"==typeof n.customSave?n.customSave(c,t):$r.saveAs(c,t)},n=this;if(n.saveReminder.reset(),e||(e=n.getExportType()),"png"===e){var r="image/png",i=ve.getDate()+this.filenameBase+".png",a=n.getKlCanvas().getCompleteCanvas(1);try{t(a,i,r)}catch(e){var o=new Image;o.width=n.getKlCanvas().getWidth(),o.height=n.getKlCanvas().getHeight(),o.src=a.toDataURL(r),oi.exportDialog(n.klRootEl,o)}}else if("layers"===e)for(var s=ve.getDate()+this.filenameBase,l=n.getKlCanvas().getLayersFast(),c=0;c<l.length;c++){var u=l[c],h=[s,"_",(""+(c+1)).padStart(2,"0"),"_",u.name,".","png"];t(u.canvas,h.join(""),"image/png")}else if("psd"===e){for(var d=this,p=n.getKlCanvas().getLayersFast(),g={width:n.getKlCanvas().getWidth(),height:n.getKlCanvas().getHeight(),children:[],canvas:n.getKlCanvas().getCompleteCanvas(1)},f=0;f<p.length;f++){var m=p[f];g.children.push({name:m.name,opacity:m.opacity,canvas:m.canvas,blendMode:oi.PSD.blendKlToPsd(m.mixModeStr),left:0,top:0})}oi.loadAgPsd().then((function(e){var t=e.writePsdBuffer(g),r=new Blob([t],{type:"application/octet-stream"});"function"==typeof n.customSave?n.customSave(r,ve.getDate()+d.filenameBase+".psd"):$r.saveAs(r,ve.getDate()+d.filenameBase+".psd")})).catch((function(){alert("Error: failed to load PSD library")}))}}}]),e}();a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var ti=function(){"use strict";function e(t,n,r,i,a,o,s,l,c,u){I.default(this,e),this.brushUiObj=t,this.layerPreview=n,this.layerManager=r,this.handUi=i,this.klCanvasWorkspace=a,this.getInitState=o,this.getKlCanvas=s,this.getCurrentLayerCtx=l,this.setCurrentLayerCtx=c,this.getCurrentBrush=u,this.doIgnore=!1}return T.default(e,[{key:"ignoreTest",value:function(){var e=this;return!this.doIgnore&&(this.doIgnore=!0,setTimeout((function(){e.doIgnore=!1}),0),!0)}},{key:"undo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!we.canUndo())return!1;var t=we.undo();we.pause(!0);var n=this.getInitState(),r=this.getKlCanvas().getWidth(),i=this.getKlCanvas().getHeight();this.getKlCanvas().copy(n.canvas);var a=n.focus;this.setCurrentLayerCtx(this.getKlCanvas().getLayerContext(a));var o={};for(var s in oi.brushes)oi.brushes.hasOwnProperty(s)&&(o[s]=new oi.brushes[s],o[s].setContext(this.getCurrentLayerCtx()));o.SketchyBrush.setSeed(n.brushes.SketchyBrush.getSeed());for(var l=0;l<t.length;l++)!function(n){if("brush"===t[n].tool[0]){var r=o[t[n].tool[1]];if(t[n].actions)for(var i=0;i<t[n].actions.length;i++){var s=t[n].actions[i].params;r[t[n].actions[i].action].apply(r,s)}else{var l=t[n].params;r[t[n].action].apply(r,l)}}else if("canvas"===t[n].tool[0]){var c=t[n].params,u=e.getKlCanvas()[t[n].action].apply(e.getKlCanvas(),c);if("number"==typeof u)for(var h in a=u,e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(a)),o)o.hasOwnProperty(h)&&o[h].setContext(e.getCurrentLayerCtx())}else if("filter"===t[n].tool[0]){var d=[{context:e.getCurrentLayerCtx(),canvas:e.getKlCanvas(),input:t[n].params[0].input,history:new oi.DecoyKlHistory}];oi.filterLib[t[n].tool[1]][t[n].action].apply(null,d)}else if("misc"===t[n].tool[0]&&"focusLayer"===t[n].action)for(var p in a=t[n].params[0],e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(t[n].params[0])),o)o.hasOwnProperty(p)&&o[p].setContext(e.getCurrentLayerCtx());else if("misc"===t[n].tool[0]&&"importImage"===t[n].action){var g=e.getKlCanvas().addLayer();if("number"==typeof g)for(var f in a=g,t[n].params[1]&&e.getKlCanvas().renameLayer(a,t[n].params[1]),e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(a)),o)o.hasOwnProperty(f)&&o[f].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[n].params[0],0,0)}}(l);return r===this.getKlCanvas().getWidth()&&i===this.getKlCanvas().getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg())),this.layerManager.update(a),this.layerPreview.setLayer(this.getKlCanvas().getLayer(a)),this.brushUiObj.sketchyBrush.setSeed(o.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),we.pause(!1),!0}},{key:"redo",value:function(){var e=this;if(!this.ignoreTest())return!1;if(!we.canRedo())return!1;var t=we.redo();we.pause(!0);var n,r=this.getKlCanvas().getWidth(),i=this.getKlCanvas().getHeight(),a={};for(var o in oi.brushes)oi.brushes.hasOwnProperty(o)&&(a[o]=new oi.brushes[o],a[o].setContext(this.getCurrentLayerCtx()));a.SketchyBrush.setSeed(this.brushUiObj.sketchyBrush.getSeed());for(var s=0;s<t.length;s++)!function(r){if("brush"===t[r].tool[0]){var i=a[t[r].tool[1]];if(t[r].actions)for(var o=0;o<t[r].actions.length;o++){var s=t[r].actions[o].params;i[t[r].actions[o].action].apply(i,s)}else{var l=t[r].params;i[t[r].action].apply(i,l)}}else if("canvas"===t[r].tool[0]){var c=t[r].params,u=e.getKlCanvas()[t[r].action].apply(e.getKlCanvas(),c);if("number"==typeof u)for(var h in n=u,e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(n)),a)a.hasOwnProperty(h)&&a[h].setContext(e.getCurrentLayerCtx())}else if("filter"===t[r].tool[0]){var d=[{context:e.getCurrentLayerCtx(),canvas:e.getKlCanvas(),input:t[r].params[0].input,history:new oi.DecoyKlHistory}];oi.filterLib[t[r].tool[1]][t[r].action].apply(null,d)}else if("misc"===t[r].tool[0]&&"focusLayer"===t[r].action)for(var p in n=t[r].params[0],e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(t[r].params[0])),a)a.hasOwnProperty(p)&&a[p].setContext(e.getCurrentLayerCtx());else if("misc"===t[r].tool[0]&&"importImage"===t[r].action){var g=e.getKlCanvas().addLayer();if("number"==typeof g)for(var f in n=g,t[r].params[1]&&e.getKlCanvas().renameLayer(n,t[r].params[1]),e.setCurrentLayerCtx(e.getKlCanvas().getLayerContext(n)),a)a.hasOwnProperty(f)&&a[f].setContext(e.getCurrentLayerCtx());e.getCurrentLayerCtx().drawImage(t[r].params[0],0,0)}}(s);r===this.getKlCanvas().getWidth()&&i===this.getKlCanvas().getHeight()||(this.klCanvasWorkspace.resetView(),this.handUi.update(this.klCanvasWorkspace.getScale(),this.klCanvasWorkspace.getAngleDeg()));var l=this.getKlCanvas().getLayerIndex(this.getCurrentLayerCtx().canvas);return this.layerManager.update(l),this.layerPreview.setLayer(this.getKlCanvas().getLayer(l)),this.brushUiObj.sketchyBrush.setSeed(a.SketchyBrush.getSeed()),this.getCurrentBrush().setContext(this.getCurrentLayerCtx()),this.klCanvasWorkspace.setLastDrawEvent(null),we.pause(!1),!0}},{key:"catchup",value:function(e){if(e&&e.bufferUpdate){var t=this,n=this.getInitState(),r=n.brushes,i=[e.bufferUpdate],a=n.canvas.getLayerContext(n.focus),o=n.canvas,s=n.focus;!function(e){if("brush"===i[0].tool[0]){var n=r[i[0].tool[1]];if(i[0].actions)for(var l=0;l<i[0].actions.length;l++){var c=i[0].actions[l].params;n[i[0].actions[l].action].apply(n,c)}else{var u=i[0].params;n[i[0].action].apply(n,u)}}else if("canvas"===i[0].tool[0]){var h=i[0].params,d=o[i[0].action].apply(o,h);if("number"==typeof d)for(var p in s=d,a=o.getLayerContext(s),r)r.hasOwnProperty(p)&&r[p].setContext(a)}else if("filter"===i[0].tool[0]){var g=[{context:a,canvas:o,input:i[0].params[0].input,history:new oi.DecoyKlHistory}];oi.filterLib[i[0].tool[1]][i[0].action].apply(null,g)}else if("misc"===i[0].tool[0]&&"focusLayer"===i[0].action)for(var f in s=i[0].params[0],a=o.getLayerContext(i[0].params[0]),r)r.hasOwnProperty(f)&&r[f].setContext(a);else if("misc"===i[0].tool[0]&&"importImage"===i[0].action){var m=o.addLayer();if("number"==typeof m)for(var v in s=m,i[0].params[1]&&t.getKlCanvas().renameLayer(s,i[0].params[1]),a=o.getLayerContext(s),r)r.hasOwnProperty(v)&&r[v].setContext(a);a.drawImage(i[0].params[0],0,0)}}(),n.focus=s}}}]),e}();a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var ni=function(){"use strict";function e(t,n,r,i,a,o,s){if(I.default(this,e),this.onSetColor=t,this.onSetSize=n,this.onSetOpacity=r,this.onGetColor=i,this.onGetSize=a,this.onGetOpacity=o,this.onGetSliderConfig=s,this.subscriberArr=[],e.instance)throw new Error("BrushSettingService already instantiated");e.instance=this}return T.default(e,[{key:"emit",value:function(e,t){for(var n=0;n<this.subscriberArr.length;n++)this.subscriberArr[n]!==t&&this.subscriberArr[n](e)}},{key:"emitColor",value:function(e,t){this.emit({type:"color",value:e},t)}},{key:"emitSize",value:function(e,t){this.emit({type:"size",value:e},t)}},{key:"emitOpacity",value:function(e,t){this.emit({type:"opacity",value:e},t)}},{key:"emitSliderConfig",value:function(e,t){this.emit({type:"sliderConfig",value:e},t)}},{key:"setColor",value:function(e,t){this.onSetColor(e),this.emitColor(e,t)}},{key:"setSize",value:function(e,t){this.onSetSize(e)}},{key:"setOpacity",value:function(e,t){this.onSetOpacity(e)}},{key:"getColor",value:function(){return this.onGetColor()}},{key:"getSize",value:function(){return this.onGetSize()}},{key:"getOpacity",value:function(){return this.onGetOpacity()}},{key:"getSliderConfig",value:function(){return this.onGetSliderConfig()}},{key:"subscribe",value:function(e){this.subscriberArr.includes(e)||this.subscriberArr.push(e)}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscriberArr.length;t++)e===this.subscriberArr[t]&&(this.subscriberArr.splice(t,1),t--)}}]),e}();a("cf2NR");var ri;I=a("hDZfO"),T=a("3SSYo");ri=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("77gwM");var ii;ii=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("4EoRT");var ai=function(){"use strict";function e(n,r,i){I.default(this,e);var o=function(){return ve.el({tagName:"a",content:ze("licenses"),onClick:function(){a("ao3kK").then((function(e){new He({target:i,title:ve.el({content:ze("licenses")}),content:ve.el({content:ve.el({content:e.licenses.replace(/\n/g,"<br>"),css:{padding:"20px"}}),css:{height:"100%",overflowY:"scroll"}}),width:800,isMaxHeight:!0})}))}})},s=Be.getLanguage();this.el=ve.el({content:"\n".concat(ze("settings-language"),": ").concat(s.name," (").concat(s.code,")\n            "),css:{margin:"10px"}});var l=ve.el({content:ze("settings-preferred-language")+":<br>",css:{marginTop:"10px"}}),c=[["auto",ze("auto")]].concat(Ie.map((function(e){return[e.code,e.name+" (".concat(e.code,")")]}))),u=new oi.Select({initValue:me.getItem(Re)?me.getItem(Re):"auto",optionArr:c,onChange:function(e){"auto"===e?me.removeItem(Re):me.setItem(Re,e),h.style.display="block"}}),h=ve.el({content:ze("settings-language-reload"),css:{display:"none",marginTop:"5px"}});(l.append(u.getElement(),h),this.el.append(l),ve.el({tagName:"button",parent:this.el,content:'<img height="20" width="18" src="'+t(ii)+'" alt="icon" style="margin-right: 5px"/>'+ze("switch-ui-left-right"),onClick:function(){return n()},css:{marginTop:"20px"},custom:{tabIndex:"-1"}}),this.el.append(ve.el({className:"gridHr",css:{margin:"10px 0"}})),r)?(this.el.append(r),r.innerHTML||ve.el({parent:r,css:{textAlign:"center"}}).append(ve.el({content:'<img alt="icon" height="20" style="vertical-align:middle" src="'.concat(t(ri),'"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a>  2022<br>')}),o())):ve.el({parent:this.el,css:{textAlign:"center"},content:'\n<img alt="Klecks" height="25" src="'.concat(t(_t),'"><br>\n<img alt="icon" height="20" style="vertical-align:middle" src="').concat(t(ri),'"> <a href="https://bitbof.com" target="_blank" tabIndex="-1">bitbof</a>  2022<br>')}).append(o(),document.createTextNode(" | "),ve.el({tagName:"a",content:ze("donate"),custom:{href:"https://kleki.com/donate/",target:"_blank"}}),document.createTextNode(" | "),ve.el({tagName:"a",content:ze("source-code"),custom:{href:"https://klecks.org",target:"_blank"}}));window.addEventListener("storage",(function(e){e.key===Re&&u.setValue(me.getItem(Re)?me.getItem(Re):"auto")}))}return T.default(e,[{key:"getElement",value:function(){return this.el}}]),e}();a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var oi={brushes:fr,brushesUI:Or,BrushSettingService:ni,KlCanvas:wt,drawProject:yt,WorkspaceSvgOverlay:St,KlCanvasWorkspace:At,KlCanvasPreview:Pt,filterLibStatus:Un,filterLib:Yn,UndoRedoCatchup:ti,renderText:vt,floodFillBits:ft,ShapeTool:function(e){var t,n,r;this.onDown=function(e,i,a){t=e,n=i,r=a},this.onMove=function(i,a){e.onShape(!1,t,n,i,a,r)},this.onUp=function(i,a){e.onShape(!0,t,n,i,a,r)}},drawShape:mt,PSD:fn,setDbName:En,indexedDb:wn,ProjectStore:_r,loadAgPsd:function(){return qr.apply(this,arguments)},SaveToComputer:ei,calcSliderFalloffFactor:Ge,Checkbox:Fe,input:Ne,Select:Xe,ImageToggle:Ue,ImageRadioList:Ye,RadioList:Br,penPressureToggle:Ve,KlSlider:Ke,HexColorDialog:Ze,KlColorSlider:function(e){var n=function(e){v=0===e.s?new ve.HSV(v.h,e.s,e.v):new ve.HSV(e.h,e.s,e.v)},r=function(){var e=ve.ColorConverter.toRGB(new ve.HSV(v.h,100,100));ve.setAttributes(C,{"stop-color":"#"+ve.ColorConverter.toHexString(e)})},i=function(){var e=v.s/100*d-7,t=(1-v.v/100)*p-6;ve.css(I,{left:e+"px",top:t+"px"})},a=function(){k.style.backgroundColor="rgb("+m.r+","+m.g+","+m.b+")",ve.testIsWhiteBestContrast(m)?(ve.css(R,{filter:"invert(1)"}),ve.css(A,{filter:"invert(1)"})):(ve.css(R,{filter:""}),ve.css(A,{filter:""}))},o=function(){P.style.backgroundColor=ve.ColorConverter.toRgbStr(y)},s=function(){var e=x;x=v,n(e),e=y,y=m,m=e,E.style.left=parseInt(""+(v.h/359*d-1))+"px",r(),i(),a(),o(),f(new ve.RGB(m.r,m.g,m.b))},l=this,c=function(e){},u=document.createElement("div");u.style.position="relative",u.className="colorSlider";var h=ve.el({css:{display:"flex",alignItems:"center"}}),d=e.width,p=e.svHeight,g=e.height,f=e.onPick,m={r:parseInt(e.startValue.r,10),g:parseInt(e.startValue.g,10),b:parseInt(e.startValue.b,10)},v=ve.ColorConverter.toHSV(e.startValue),y={r:255,g:255,b:255},x=ve.ColorConverter._RGBtoHSV(y),b=ve.el({}),w=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"> <defs> <linearGradient id="value" gradientTransform="rotate(90)"> <stop offset="0" stop-color="rgba(0,0,0,0)"/> <stop offset="100%" stop-color="rgba(0,0,0,1)"/> </linearGradient> <linearGradient id="hue" gradientTransform="rotate(0)"> <stop offset="0" stop-color="#fff"/> <stop id="hue-stop" offset="100%" stop-color="#f00"/> </linearGradient> </defs> <rect x="0" y="0" width="100" height="100" fill="url(\'#hue\')"/> <rect x="0" y="0" width="100" height="100" fill="url(\'#value\')"/></svg>',"image/svg+xml").documentElement,C=w.getElementById("hue-stop");ve.setAttributes(C,{"stop-color":"#f0f"}),ve.css(w,{width:d+"px",height:p+"px"}),b.appendChild(w);var S=document.createElement("div");ve.css(S,{position:"relative",height:g+"px"});var k=document.createElement("div"),E=document.createElement("div");r(),u.style.width=d+"px",u.oncontextmenu=function(){return!1};var M=document.createElement("div");ve.css(M,{width:d+"px",height:p+"px",overflow:"hidden",display:"block",position:"relative",cursor:"crosshair",boxShadow:"rgb(188, 188, 188) 0 0 0 1px"});var I=document.createElement("div");ve.css(I,{width:"12px",height:"12px",borderRadius:"6px",position:"absolute",pointerEvents:"none",boxShadow:"0px 0px 0 1px #000, inset 0px 0px 0 1px #fff"}),M.appendChild(b),M.appendChild(I),i(),u.appendChild(M),u.appendChild(S),h.appendChild(k),ve.css(k,{display:"flex",justifyContent:"space-between",width:2.5*g+"px",height:g+"px",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",colorScheme:"only light"}),ve.css(S,{overflow:"hidden",position:"relative",width:d+"px",height:g+"px",cursor:"ew-resize",boxShadow:"rgb(188, 188, 188) 0 0 0 1px",marginTop:"1px",marginBottom:"1px"}),ve.css(E,{width:"1px",height:g+"px",background:"#000",borderLeft:"1px solid #fff",position:"absolute",top:"0",left:parseInt(""+(v.h/360*d-1))+"px"});var T={h:0,s:0,v:0},R=ve.el({title:ze("eyedropper")+" [Alt]",className:"color-picker-preview-button",css:{width:"30px",height:"30px",backgroundImage:"url("+t(qe)+")",backgroundRepeat:"no-repeat",backgroundSize:"70%",backgroundPosition:"center"}}),L=!1;R.onclick=function(){!1===L?(ve.removeClassName(R,"color-picker-preview-button-hover"),ve.addClassName(R,"color-picker-preview-button-active"),L=!0,c(!0)):(c(!1),l.pickingDone())};new ve.PointerListener({target:R,onEnterLeave:function(e){L||(e?ve.addClassName(R,"color-picker-preview-button-hover"):ve.removeClassName(R,"color-picker-preview-button-hover"))}});k.appendChild(R);var A=ve.el({content:"#",className:"color-picker-preview-button",title:ze("manual-color-input"),css:{height:"100%",width:g+"px",lineHeight:g+"px",fontSize:.65*g+"px"},onClick:function(){Ze({klRootEl:e.klRootEl,color:new ve.RGB(m.r,m.g,m.b),onClose:function(e){e&&(l.setColor(e),f(new ve.RGB(m.r,m.g,m.b)))}})}});new ve.PointerListener({target:A,onEnterLeave:function(e){e?ve.addClassName(A,"color-picker-preview-button-hover"):ve.removeClassName(A,"color-picker-preview-button-hover")}});k.appendChild(A),a(),setTimeout((function(){!function(e){var t=new Image;ve.css(t,{position:"absolute",left:"0",top:"0",display:"none",pointerEvents:"none"});for(var n=ve.canvas(d,g),r=n.getContext("2d"),i=r.createLinearGradient(0,0,d,0),a=0;a<1;a+=.01){var o=ve.ColorConverter.toRGB(new ve.HSV(360*a,100,100)),s=parseInt(""+o.r).toString(16),l=parseInt(""+o.g).toString(16),c=parseInt(""+o.b).toString(16);1===s.length&&(s="0"+s),1===l.length&&(l="0"+l),1===c.length&&(c="0"+c),i.addColorStop(a,"#"+s+l+c)}r.fillStyle=i,r.fillRect(0,0,d,g),e.appendChild(t),t.alt="hue",t.src=n.toDataURL("image/png"),t.style.display="block"}(S),S.appendChild(E),new ve.PointerListener({target:b,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(ve.css(M,{boxShadow:"0px 0px 0px 1px rgb(255,255,255)",zIndex:"1"}),"left"===e.button?(T.s=e.relX/d*100,T.v=100-e.relY/p*100,v=new ve.HSV(v.h,T.s,T.v),m=ve.ColorConverter.toRGB(v),i(),a(),f(ve.ColorConverter.toRGB(v))):(T.s=v.s,T.v=v.v)),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=1;"right"===e.button&&(t=.5),T.s+=e.dX/d*100*t,T.v-=e.dY/p*100*t,v=new ve.HSV(v.h,T.s,T.v),m=ve.ColorConverter.toRGB(v),i(),a(),f(ve.ColorConverter.toRGB(v))}"pointerup"===e.type&&ve.css(M,{boxShadow:"0 0 0 1px rgb(188, 188, 188)",zIndex:"0"})}}),new ve.PointerListener({target:S,maxPointers:1,fixScribble:!0,onPointer:function(e){if("pointerdown"===e.type&&(ve.css(S,{boxShadow:"0px 0px 0px 1px rgba(255,255,255,1)"}),"left"===e.button?(T.h=e.relX/d*359.99,v=new ve.HSV(T.h,v.s,v.v),m=ve.ColorConverter.toRGB(v),E.style.left=Math.round(v.h/359.99*d)-1+"px",r(),a(),f(ve.ColorConverter.toRGB(v))):T.h=v.h),"pointermove"===e.type&&["left","right"].includes(e.button)){var t=Math.abs(e.pageY-e.downPageY),n=Ge(t,"right"===e.button);T.h+=e.dX/d*359.99*n,"right"===e.button&&(T.h=T.h%359.99,T.h<0&&(T.h+=359.99)),T.h=Math.min(359.99,T.h),v=new ve.HSV(T.h,v.s,v.v),m=ve.ColorConverter.toRGB(v),E.style.left=Math.round(v.h/359.99*d)-1+"px",r(),a(),f(ve.ColorConverter.toRGB(v))}"pointerup"===e.type&&ve.css(S,{boxShadow:"rgb(188, 188, 188) 0 0 0 1px"})}})}),1);var P=ve.el({parent:h,title:ze("secondary-color")+" [X]",css:{cursor:"pointer",marginLeft:"5px",width:"22px",height:"22px",boxShadow:"rgb(188, 188, 188) 0px 0px 0px 1px",colorScheme:"only light"},onClick:function(e){e.preventDefault(),s()}});o(),this.setColor=function(e){m={r:parseInt(e.r,10),g:parseInt(e.g,10),b:parseInt(e.b,10)},n(ve.ColorConverter.toHSV(e)),E.style.left=parseInt(""+(v.h/359*d-1))+"px",r(),i(),a()},this.getColor=function(){return new ve.RGB(m.r,m.g,m.b)},this.getSecondaryRGB=function(){return new ve.RGB(y.r,y.g,y.b)},this.setPickCallback=function(e){c=e},this.pickingDone=function(){L&&(L=!1,ve.removeClassName(R,"color-picker-preview-button-active"))},this.enable=function(e){e?(u.style.pointerEvents="",u.style.opacity="1",h.style.pointerEvents="",h.style.opacity="1"):(u.style.pointerEvents="none",u.style.opacity="0.5",h.style.pointerEvents="none",h.style.opacity="0.5")},this.setHeight=function(e){(e=parseInt(""+(e-2*g-3),10))!==p&&(p=e,ve.css(w,{width:d+"px",height:p+"px"}),M.style.height=p+"px",i())},this.swapColors=function(){s()},this.getElement=function(){return u},this.getOutputElement=function(){return h}},KlSmallColorSlider:Je,PointSlider:Qe,ColorOptions:$e,Options:et,BoxToggle:Ar,StatusOverlay:nt,CropCopy:rt,FreeTransform:Ht,FreeTransformCanvas:Ft,Cropper:Nt,LayerPreview:function(e){var t,n,r=function(e){if(l){E.textContent=t.name,T.innerHTML=ze("opacity")+"<br>"+Math.round(100*t.opacity)+"%";var n=t.context.canvas;if(n.width!==p.width||n.height!==p.height){var r=ve.fitInto(n.width,n.height,u,u,1);C.width=Math.round(r.width),C.height=Math.round(r.height),e=!0}g.width=C.width,g.height=C.height,f.save(),f.imageSmoothingEnabled=!1,f.fillStyle=P,f.fillRect(0,0,g.width,g.height),f.drawImage(n,0,0,g.width,g.height),f.restore(),e?(v=0,S.save(),S.drawImage(g,0,0),S.restore()):(v=m,D()),a(),d=we.getState(),p.width=n.width,p.height=n.height}},i=function(){r(!0)},a=function(){if(y&&t){var e=t.context.canvas,n=ve.fitInto(e.width,e.height,h,h,1);L.width=Math.round(n.width),L.height=Math.round(n.height),A.save(),L.width>e.width?A.imageSmoothingEnabled=!1:(A.imageSmoothingEnabled=!0,A.imageSmoothingQuality="high"),A.fillStyle=O,A.fillRect(0,0,L.width,L.height),A.drawImage(e,0,0,L.width,L.height),A.restore();var r=s.getBoundingClientRect();ve.css(R,{top:Math.max(10,r.top+c/2-L.height/2)+"px"})}},o=function(){try{e.klRootEl.removeChild(R)}catch(e){}},s=ve.el({}),l=!0,c=40,u=c-10,h=300,d=-2,p={width:0,height:0},g=ve.canvas(),f=g.getContext("2d"),m=30,v=0,y=!1,x=300,b=ve.el({css:{display:"flex",alignItems:"center",height:c+"px",color:"#666"}}),w=ve.el({css:{minWidth:c+"px",height:c+"px",display:"flex",justifyContent:"center",alignItems:"center"}}),C=ve.canvas(u,u),S=C.getContext("2d");C.title=ze("layers-active-layer"),ve.css(C,{boxShadow:"0 0 0 1px #9e9e9e",colorScheme:"only light"});var k=ve.el({css:{flexGrow:"1",paddingLeft:"10px",fontSize:"13px",overflow:"hidden",position:"relative"}}),E=ve.el({content:"",css:{cssFloat:"left",whiteSpace:"nowrap"}}),M=ve.el({css:{backgroundImage:"linear-gradient(to right, rgba(221,221,221,0) 0%, rgba(221,221,221,0.8) 100%)",position:"absolute",right:"0",top:"0",width:"50px",height:"100%"}}),I=ve.el({css:{position:"absolute",left:"10px",top:"0",width:"90px",height:"100%"}});e.onClick&&(ve.addEventListener(I,"click",(function(){e.onClick()})),ve.addEventListener(C,"click",(function(){e.onClick()})));var T=ve.el({content:ze("opacity")+"<br>100%",css:{minWidth:"60px",fontSize:"12px",textAlign:"center",background:"#dddddd",color:"#555"}}),R=ve.el({onClick:ve.handleClick,css:{pointerEvents:"none",background:"#fff",position:"absolute",right:"280px",top:"10px",border:"1px solid #aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",transition:"opacity "+x+"ms ease-in-out",userSelect:"none",display:"block",webkitTouchCallout:"none",colorScheme:"only light"}}),L=ve.canvas(h,h);R.append(L);var A=L.getContext("2d");ve.css(L,{display:"block"}),s.appendChild(b),b.appendChild(w),w.appendChild(C),b.appendChild(k),k.appendChild(E),k.appendChild(M),k.appendChild(I),b.appendChild(T);var P=f.createPattern(ve.createCheckerCanvas(4),"repeat"),O=S.createPattern(ve.createCheckerCanvas(4),"repeat");function D(){0!==v&&(v--,S.save(),S.globalAlpha=Math.pow((m-v)/m,2),S.drawImage(g,0,0),S.restore(),v>0&&requestAnimationFrame(D))}setInterval((function(){t&&(we.getState()!==d&&(t.opacity=t.context.canvas.opacity,r(!1)))}),2e3),new ve.PointerListener({target:C,onEnterLeave:function(t){!function(t){y!==t&&(clearTimeout(n),y=t,t?n=setTimeout((function(){a(),R.style.opacity="0",e.klRootEl.appendChild(R),setTimeout((function(){R.style.opacity="1"}),20)}),250):(R.style.opacity="0",n=setTimeout(o,x+20)))}(t)}}),this.getElement=function(){return s},this.setIsVisible=function(e){if(l!==e){l=e,b.style.display=l?"flex":"none",s.style.marginBottom=l?"":"10px";var t=we.getState();e&&d!==t&&i()}},this.setLayer=function(e){t=e,i()},this.setUiState=function(e){"left"===""+e?ve.css(R,{left:"280px",right:""}):ve.css(R,{left:"",right:"280px"})}},FittedImage:function(e){var t=ve.fitInto(e.image.width,e.image.height,e.width,e.height,1),n=parseInt(""+t.width),r=parseInt(""+t.height),i=ve.canvas(n,r);i.getContext("2d").drawImage(e.image,0,0,n,r),ve.css(i,{display:"block",boxShadow:"0 0 0 1px #aaa"}),this.getElement=function(){return i}},KlImageDropper:function(e){var t=function(){c=0,u=0,h=0;try{e.target.removeChild(i)}catch(e){}},n=function(e){try{return!e.dataTransfer.types.includes("text/plain")}catch(e){}return!1},r=function(){var e="0 0 20px 4px #fff";u>0?(s.style.boxShadow=e,l.style.boxShadow=""):h>0?(s.style.boxShadow="",l.style.boxShadow=e):(s.style.boxShadow="",l.style.boxShadow="")},i=ve.el({content:"Drop to import",css:{paddingTop:"100px",position:"absolute",left:"0",top:"0",width:"100%",height:"100%",background:"rgba(50, 50, 50, 0.7)",color:"#fff",textShadow:"2px 2px #000",textAlign:"center",fontSize:"25px"}}),a=ve.el({css:{marginTop:"50px",display:"flex",justifyContent:"center"}}),o={width:"200px",padding:"50px",margin:"10px",borderRadius:"20px",border:"1px dashed #fff",background:"#00aefe",fontWeight:"bold"},s=ve.el({content:"As Layer",css:o}),l=ve.el({content:"As New Image",css:o});i.appendChild(a),a.appendChild(s),a.appendChild(l);var c=0,u=0,h=0;ve.addEventListener(s,"dragenter",(function(){u++,r()})),ve.addEventListener(s,"dragleave",(function(){u--,r()})),ve.addEventListener(l,"dragenter",(function(){h++,r()})),ve.addEventListener(l,"dragleave",(function(){h--,r()})),ve.addEventListener(window,"dragover",(function(e){n(e)&&(e.stopPropagation(),e.preventDefault())}),!1),ve.addEventListener(window,"dragenter",(function(t){e.enabledTest()&&n(t)&&(0===c&&e.target.appendChild(i),c++)}),!1),ve.addEventListener(window,"dragleave",(function(t){n(t)&&0!==c&&0===(c=Math.max(0,c-1))&&e.target.removeChild(i)}),!1),ve.addEventListener(window,"drop",(function(a){if(n(a)&&0!==a.dataTransfer.files.length){a.stopPropagation(),a.preventDefault();var o="default";u>0?o="layer":h>0&&(o="image"),e.onDrop(a.dataTransfer.files,o),c>0&&e.target.removeChild(i),c=0,u=0,h=0,r()}else t()}),!1),ve.addEventListener(i,"pointerdown",(function(){t()})),new ve.KeyListener({onDown:function(e){c>0&&"esc"===e&&t()}})},OverlayToolspace:function(e){var t=function(e){s.setColor(e),l.style.backgroundColor="rgb("+e.r+","+e.g+","+e.b+")"},n=function(){a.style.display=i?"block":"none",i&&g&&(a.style.left=g.x-Math.round(r.width/2)+"px",a.style.top=g.y-Math.round(r.svHeight+3*r.hHeight/2)+"px")},r={width:150,svHeight:90,hHeight:20,sliderHeight:25},i=!1,a=ve.el({css:{position:"absolute",left:"500px",top:"500px",background:"rgb(221, 221, 221)",display:"none",border:"1px solid #fff",boxShadow:"0 0 10px rgba(0,0,0,0.5)",colorScheme:"only light"}}),o={color:null,size:null,opacity:null},s=new Je({width:r.width,heightSV:r.svHeight,heightH:r.hHeight,color:e.brushSettingService.getColor(),callback:function(t){l.style.backgroundColor="rgb("+t.r+","+t.g+","+t.b+")",e.brushSettingService.setColor(t,d)}}),l=ve.el({css:{width:r.width+"px",height:r.hHeight+"px",pointerEvents:"none"}}),c=e.brushSettingService.getColor();l.style.backgroundColor="rgb("+c.r+","+c.g+","+c.b+")",a.appendChild(l),a.appendChild(s.getElement());var u=new Ke({label:ze("brush-size"),width:r.width,height:r.sliderHeight,min:0,max:500,initValue:50,resolution:225,eventResMs:1e3/30,onChange:function(t){e.brushSettingService.setSize(t)},formatFunc:function(e){return 2*e<10?Math.round(20*e)/10:Math.round(2*e)}});ve.css(u.getElement(),{marginTop:"2px"}),a.appendChild(u.getElement());var h=new Ke({label:ze("opacity"),width:r.width,height:r.sliderHeight,min:0,max:1,initValue:1,resolution:225,eventResMs:1e3/30,onChange:function(t){e.brushSettingService.setOpacity(t)},formatFunc:function(e){return Math.round(100*e)}});ve.css(h.getElement(),{margin:"2px 0"}),a.appendChild(h.getElement());var d=function(e){"color"===e.type&&(i?t(e.value):o.color=e.value),"size"===e.type&&(i?u.setValue(e.value):o.size=e.value),"opacity"===e.type&&(i?h.setValue(e.value):o.opacity=e.value),"sliderConfig"===e.type&&(u.update(e.value.sizeSlider),h.update(e.value.opacitySlider))};e.brushSettingService.subscribe(d);var p=e.brushSettingService.getSliderConfig();u.update(p.sizeSlider),h.update(p.opacitySlider),u.setValue(e.brushSettingService.getSize()),h.setValue(e.brushSettingService.getOpacity());var g=null;ve.addEventListener(document,"pointermove",(function(e){g={x:e.pageX,y:e.pageY}})),new ve.KeyListener({onDown:function(r,a,s,l){if(!l)return i?(i=!1,void n()):void(e.enabledTest()&&g&&["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(s)&&(a.preventDefault(),i=!0,null!==o.color&&(t(o.color),o.color=null),null!==o.size&&(u.setValue(o.size),o.size=null),null!==o.opacity&&(h.setValue(o.opacity),o.opacity=null),n()))},onUp:function(e,t,r){["ctrl+alt","cmd+alt","alt+ctrl","alt+cmd"].includes(r)&&i&&(i=!1,s.end(),n())},onBlur:function(){i&&(i=!1,s.end(),n())}}),this.getElement=function(){return a}},ToolspaceTopRow:function(e){var n=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=ve.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.contain?t+"px 0":""}}),r=ve.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});return r.style.pointerEvents="none",n.appendChild(r),n.pointerListener=new ve.PointerListener({target:n,onEnterLeave:function(e){e?ve.addClassName(n,"toolspace-row-button-hover"):ve.removeClassName(n,"toolspace-row-button-hover")}}),n},r=document.createElement("div");ve.css(r,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var i=null;"function"==typeof e.onLogo&&((i=n({onClick:e.onLogo,title:ze("home"),image:e.logoImg?e.logoImg:t(_t),contain:!0})).style.width="45px",i.style.borderRight="1px solid rgb(212, 212, 212)");var a=n({onClick:e.onNew,title:ze("file-new"),image:t(Xt),extraPadding:1,contain:!0}),o=n({onClick:e.onImport,title:ze("file-import"),image:t(Ut),extraPadding:1,contain:!0}),s=n({onClick:e.onSave,title:ze("file-save"),image:t(Yt),extraPadding:1,contain:!0}),l=null;ve.canShareFiles()&&e.onShare&&(l=n({onClick:e.onShare,title:ze("file-share"),image:t(Wt),contain:!0}));var c=null;e.onHelp&&(c=n({onClick:e.onHelp,title:ze("help"),image:t(Vt),contain:!0})),i&&r.appendChild(i),r.appendChild(a),r.appendChild(o),r.appendChild(s),l&&r.appendChild(l),c&&r.appendChild(c),this.getElement=function(){return r}},ToolDropdown:Qt,ToolspaceToolRow:function(e){var n=function(t,n){o!==t&&(o=t,s.setActive(o),"hand"===o?ve.addClassName(l,"toolspace-row-button-activated"):ve.removeClassName(l,"toolspace-row-button-activated"),n&&e.onActivate(o))},r=function(e){var t=e.doLighten?"6px 0":"8px 0",n=ve.el({className:"toolspace-row-button nohighlight",onClick:e.onClick,css:{padding:e.contain?"10px 0":""}}),r=ve.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%",transform:e.doMirror?"scale(-1, 1)":"",pointerEvents:"none",opacity:e.doLighten?"0.75":"1"}});return n.appendChild(r),n.pointerListener=new ve.PointerListener({target:n,onEnterLeave:function(e){e?ve.addClassName(n,"toolspace-row-button-hover"):ve.removeClassName(n,"toolspace-row-button-hover")}}),n.setIsSmall=function(r){n.style.padding=e.contain?r?t:"10px 0":""},n},i=function(e){var t=document.createElement("div");ve.css(t,{flexGrow:"1",position:"relative"});var n=ve.createSvg({elementType:"svg",width:"67px",height:"54px",viewBox:"0 0 100 100",preserveAspectRatio:"none"});ve.css(n,{position:"absolute",left:"0",top:"0"});var r=ve.createSvg({elementType:"defs",childrenArr:[{elementType:"filter",id:"innershadow",x0:"-50%",y0:"-50%",width:"200%",height:"200%",childrenArr:[{elementType:"feGaussianBlur",in:"SourceAlpha",stdDeviation:"10",result:"blur"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"SourceAlpha",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"SourceGraphic",operator:"over",result:"firstfilter"},{elementType:"feGaussianBlur",in:"firstfilter",stdDeviation:"10",result:"blur2"},{elementType:"feOffset",dx:"2",dy:"2"},{elementType:"feComposite",in2:"firstfilter",operator:"arithmetic",k2:"-1",k3:"1",result:"shadowDiff"},{elementType:"feFlood","flood-color":"#000","flood-opacity":"0.2"},{elementType:"feComposite",in2:"shadowDiff",operator:"in"},{elementType:"feComposite",in2:"firstfilter",operator:"over"}]}]}),i=ve.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M0,0 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});i.onclick=function(){e.onLeft(),ve.removeClassName(i,"toolspace-svg-triangle-button-hover")};var a=ve.createSvg({elementType:"path","vector-effect":"non-scaling-stroke",d:"M100,100 L 100,0 0,100 z",fill:"rgba(0,0,0,0)",class:"toolspace-svg-triangle-button"});a.onclick=function(){e.onRight(),ve.removeClassName(a,"toolspace-svg-triangle-button-hover")},t.leftPointerListener=new ve.PointerListener({target:i,onEnterLeave:function(e){e?ve.addClassName(i,"toolspace-svg-triangle-button-hover"):ve.removeClassName(i,"toolspace-svg-triangle-button-hover")}}),t.rightPointerListener=new ve.PointerListener({target:a,onEnterLeave:function(e){e?ve.addClassName(a,"toolspace-svg-triangle-button-hover"):ve.removeClassName(a,"toolspace-svg-triangle-button-hover")}}),n.appendChild(r),n.appendChild(i),n.appendChild(a),t.appendChild(n);var o=ve.el({css:{backgroundImage:"url('"+e.leftImage+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",left:"10px",top:"8px",pointerEvents:"none"}});t.appendChild(o);var s=ve.el({css:{backgroundImage:"url('"+(e.rightImage?e.rightImage:e.leftImage)+"')",backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"20px",height:"20px",position:"absolute",right:"10px",bottom:"8px",transform:e.rightImage?"":"scale(-1, 1)",pointerEvents:"none"}});return t.appendChild(s),t.setIsEnabledLeft=function(e){e?(ve.removeClassName(i,"toolspace-row-button-disabled"),ve.removeClassName(o,"toolspace-row-button-disabled")):(ve.addClassName(i,"toolspace-row-button-disabled"),ve.addClassName(o,"toolspace-row-button-disabled"))},t.setIsEnabledRight=function(e){e?(ve.removeClassName(a,"toolspace-row-button-disabled"),ve.removeClassName(s,"toolspace-row-button-disabled")):(ve.addClassName(a,"toolspace-row-button-disabled"),ve.addClassName(s,"toolspace-row-button-disabled"))},t},a=document.createElement("div");ve.css(a,{height:"54px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var o="draw",s=new Qt({klRootEl:e.klRootEl,onChange:function(e){n(e,!0)}});a.appendChild(s.getElement());var l=r({onClick:function(){n("hand",!0)},image:t($t),contain:!0,doLighten:!0});l.style.borderRight="1px solid rgb(212, 212, 212)",l.title=ze("tool-hand"),a.appendChild(l);var c=i({onLeft:e.onZoomIn,onRight:e.onZoomOut,leftImage:t(en),rightImage:t(tn)});c.title=ze("tool-zoom"),a.appendChild(c);var u=r({onClick:e.onZoomIn,image:t(en),contain:!0});u.title=ze("zoom-in"),a.appendChild(u);var h=r({onClick:e.onZoomOut,image:t(tn),contain:!0});h.title=ze("zoom-out"),a.appendChild(h);var d=i({onLeft:e.onUndo,onRight:e.onRedo,leftImage:t(nn),rightImage:null});d.title=ze("tool-undo-redo"),d.setIsEnabledLeft(!1),d.setIsEnabledRight(!1),a.appendChild(d);var p=r({onClick:e.onUndo,image:t(nn),contain:!0});p.title=ze("undo"),ve.addClassName(p,"toolspace-row-button-disabled"),a.appendChild(p);var g=r({onClick:e.onRedo,image:t(nn),contain:!0,doMirror:!0});g.title=ze("redo"),ve.addClassName(g,"toolspace-row-button-disabled"),a.appendChild(g),u.style.display="none",h.style.display="none",p.style.display="none",g.style.display="none",this.getElement=function(){return a},this.setIsSmall=function(e){ve.css(a,{height:e?"36px":"54px"}),s.setIsSmall(e),l.setIsSmall(e),u.setIsSmall(e),h.setIsSmall(e),p.setIsSmall(e),g.setIsSmall(e),e?(c.style.display="none",d.style.display="none",u.style.display="block",h.style.display="block",p.style.display="block",g.style.display="block"):(c.style.display="block",d.style.display="block",u.style.display="none",h.style.display="none",p.style.display="none",g.style.display="none")},this.setEnableZoomIn=function(e){e?ve.removeClassName(u,"toolspace-row-button-disabled"):ve.addClassName(u,"toolspace-row-button-disabled"),c.setIsEnabledLeft(e)},this.setEnableZoomOut=function(e){e?ve.removeClassName(h,"toolspace-row-button-disabled"):ve.addClassName(h,"toolspace-row-button-disabled"),c.setIsEnabledRight(e)},this.setEnableUndo=function(e){e?ve.removeClassName(p,"toolspace-row-button-disabled"):ve.addClassName(p,"toolspace-row-button-disabled"),d.setIsEnabledLeft(e)},this.setEnableRedo=function(e){e?ve.removeClassName(g,"toolspace-row-button-disabled"):ve.addClassName(g,"toolspace-row-button-disabled"),d.setIsEnabledRight(e)},this.setActive=function(e){n(e)},this.getActive=function(){return o}},ToolspaceStabilizerRow:function(e){var t=ve.el({tagName:"label",content:ze("stabilizer")+"&nbsp;",title:ze("stabilizer-title"),css:{display:"flex",alignItems:"center",fontSize:"13px",color:"rgba(0,0,0,0.6)"}}),n=new Xe({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"]],initValue:e.smoothing,onChange:function(t){e.onSelect(parseInt(t))}});t.appendChild(n.getElement()),new ve.PointerListener({target:t,onWheel:function(e){n.setDeltaValue(e.deltaY)}}),this.getElement=function(){return t}},TabRow:function(e){for(var n=function(e,t,n){var r={id:e.id,isVisible:!("isVisible"in e)||e.isVisible,onOpen:e.onOpen,onClose:e.onClose,update:function(e){s.className=e===r?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",s.style.display=r.isVisible?"block":"none"}},s=ve.el({content:"label"in e?e.label:"",title:"title"in e?e.title:void 0,className:t===r.id?n?"tabrow-tab tabrow-tab-opened-accented":"tabrow-tab tabrow-tab-opened":"tabrow-tab",css:{lineHeight:a+"px",display:r.isVisible?"block":"none",zIndex:"0"},onClick:function(){l!==r&&i.open(r.id)}});r.div=s,"image"in e&&ve.css(s,{backgroundImage:"url('"+e.image+"')",backgroundSize:a-7+"px"}),"css"in e&&ve.css(s,e.css),o.appendChild(s);new ve.PointerListener({target:s,onEnterLeave:function(e){e?ve.addClassName(s,"tabrow-tab-hover"):ve.removeClassName(s,"tabrow-tab-hover")}});return t===r.id?(r.onOpen(),r.div.appendChild(c),r.div.appendChild(u)):r.onClose(),r},r=function(){for(var e=0;e<s.length;e++)s[e].update(l)},i=this,a=35,o=ve.el({className:"tabrow",css:{height:a+"px"}}),s=[],l=null,c=ve.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(t(rn),"')"),backgroundSize:"cover",position:"absolute",right:"-10px",bottom:"0",pointerEvents:"none"}}),u=ve.el({css:{width:"10px",height:"10px",backgroundImage:"url('".concat(t(rn),"')"),backgroundSize:"cover",position:"absolute",left:"-10px",bottom:"0",transform:"scale(-1,1)",pointerEvents:"none"}}),h=0;h<e.tabArr.length;h++)s.push(n(e.tabArr[h],e.initialId,e.useAccent));for(var d=0;d<s.length;d++)s[d].id===e.initialId&&(l=s[d]);if(null===l)throw"invalid initialId";this.getElement=function(){return o},this.open=function(e){for(var t=0;t<s.length;t++)if(s[t].id===e){if(l===s[t])return;return l.onClose(),(l=s[t]).onOpen(),l.div.appendChild(c),l.div.appendChild(u),void r()}throw"TabRow.open - invalid tabId"},this.getOpenedTabId=function(){return""+l.id},this.setIsVisible=function(e,t){for(var n=0;n<s.length;n++)if(s[n].id===e)return s[n].isVisible=!!t,void r();throw"TabRow.setIsVisible - invalid tabId"}},ToolspaceCollapser:function(e){var n=function(){o.style.transform="left"===i?r?"rotate(180deg)":"":r?"":"rotate(180deg)"},r=!0,i="right",a=ve.el({css:{width:"36px",height:"36px",background:"rgba(100, 100, 100, 0.9)",color:"#fff",position:"absolute",top:"0",textAlign:"center",lineHeight:"36px",cursor:"pointer",userSelect:"none",padding:"6px",boxSizing:"border-box"},title:ze("toggle-show-tools"),onClick:function(t){t.preventDefault(),r=!r,n(),e.onChange()}}),o=ve.el({parent:a,css:{backgroundImage:"url(".concat(t(on),")"),width:"100%",height:"100%",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",userSelect:"none"}});a.oncontextmenu=function(){return!1},this.isOpen=function(){return r},this.setDirection=function(e){i=e,n()},this.getElement=function(){return a}},BrowserStorageUi:zr,SaveReminder:Zr,ToolspaceScroller:function(){"use strict";function e(t){var n=this;I.default(this,e),this.toolspace=t.toolspace,this.upBtn=ve.el({parent:this.toolspace.parentNode,title:ze("scroll"),className:"kl-scroller",css:{top:"0",transform:"rotate(180deg)"}}),this.downBtn=ve.el({parent:this.toolspace.parentNode,title:ze("scroll"),className:"kl-scroller",css:{bottom:"0"}}),this.updateUiState(t.uiState);new ve.PointerListener({target:this.upBtn,onPointer:function(e){var t=n;if("pointerdown"===e.type&&(n.upInterval=setInterval((function(){t.toolspace.scrollBy(0,-13),t.update()}),20)),"pointerup"===e.type){var r=n;clearInterval(n.upInterval),setTimeout((function(){r.upInterval=null,r.update()}),50)}}}),new ve.PointerListener({target:this.downBtn,onPointer:function(e){var t=n;if("pointerdown"===e.type&&(n.downInterval=setInterval((function(){t.toolspace.scrollBy(0,13),t.update()}),20)),"pointerup"===e.type){var r=n;clearInterval(n.downInterval),setTimeout((function(){r.downInterval=null,r.update()}),50)}}});var r=function(e){n.toolspace.scrollBy(0,Math.round(.7*e.deltaY)),n.update()};this.upBtn.addEventListener("wheel",r),this.downBtn.addEventListener("wheel",r),this.update(),new MutationObserver((function(){return n.update()})).observe(this.toolspace,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("resize",(function(){return n.update()})),Se.subscribe((function(e){n.upBtn.style.opacity=e>=1?"0":"",n.downBtn.style.opacity=e>=1?"0":""}))}return T.default(e,[{key:"update",value:function(){this.toolspace.scrollHeight>this.toolspace.offsetHeight+3?(this.upInterval||(this.upBtn.style.display=0===this.toolspace.scrollTop?"none":"block"),this.downInterval||(this.downBtn.style.display=this.toolspace.scrollTop+this.toolspace.offsetHeight+1>=this.toolspace.scrollHeight?"none":"block")):(this.upBtn.style.display="none",this.downBtn.style.display="none")}},{key:"updateUiState",value:function(e){ve.css(this.upBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null}),ve.css(this.downBtn,{left:"left"===e?"0":null,right:"right"===e?"0":null})}}]),e}(),dialogCounter:Se,popup:je,Popup:He,exportDialog:function(e,t){var n,r,i,a,o,s,l,c;r=!1,i=!1,n=document.createElement("div"),ve.css(n,{width:"308px"}),a=document.createElement("div"),(o=new Image).src=t.src,a.appendChild(o),a.appendChild(t),ve.css(a,{width:"264px",height:"176px",marginTop:"21px",marginLeft:"21px",position:"relative",overflow:"hidden",boxShadow:"0 0 10px 4px rgba(255,255,255, 0)",border:"1px solid rgba(255, 255, 255, 1)",transition:"box-shadow 0.7s linear"}),ve.css(t,{position:"absolute",left:"0",top:"0",width:"264px",height:"176px",opacity:"0"}),(s={width:264,height:264/t.width*t.height}).height<176&&(s.height=176,s.width=s.height/t.height*t.width),ve.css(o,{position:"absolute",top:"88px",left:"132px",width:s.width+"px",height:s.height+"px",marginLeft:-s.width/2+"px",marginTop:-s.height/2+"px"}),function e(){r||((i=!i)?ve.css(a,{border:"1px solid rgba(0, 0, 0, 1)"}):ve.css(a,{border:"1px solid rgba(200, 200, 200, 1)"}),setTimeout(e,510))}(),(l=document.createElement("div")).innerHTML="Right-Click or Press-Hold on the image, then save.",l.ontouchstart=function(){return!1},ve.css(l,{fontSize:"17.6px",color:"#666",padding:"10px",textAlign:"center"}),n.appendChild(a),n.appendChild(l),t.ontouchstart=function(){ve.css(a,{boxShadow:"0 0 10px 8px rgba(0,255,255, 1)"}),!0,c=setTimeout((function(){!1,ve.css(a,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"})}),1500)},t.ontouchmove=function(){ve.css(a,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(c)},t.ontouchend=function(){ve.css(a,{boxShadow:"0 0 10px 4px rgba(0,255,255, 0)"}),!1,clearTimeout(c)},je({target:e,message:"<b>Save Image</b>",div:n,buttons:["Close"],callback:function(e){r=!0}})},clipboardDialog:function(e,n,r,i,a,o){var c=function(){var e,n=g.getCroppedImage().toDataURL("image/png");setTimeout((e=s.default(t(l).mark((function e(){var r,i;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(n);case 3:return r=e.sent,e.next=6,r.blob();case 6:return i=e.sent,e.next=9,navigator.clipboard.write([new ClipboardItem(it.default({},i.type,i))]);case 9:setTimeout((function(){a.out(ze("cropcopy-copied"),!0)}),200),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error(e.t0.name,e.t0.message);case 15:case"end":return e.stop()}}),e,null,[[0,12]])}))),function(){return e.apply(this,arguments)}),0)},u=function(){f()},h=document.createElement("div"),d=n.width<550||n.height<550,p=ve.el({content:ze("crop-drag-to-crop"),css:{textAlign:"center"}});h.appendChild(p);var g=new rt({width:d?340:540,height:d?300:350,canvas:r});ve.css(g.getEl(),{marginTop:"10px",marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),h.appendChild(g.getEl());var f,m=new ve.KeyListener({onDown:function(e,t,n){"ctrl+c"===n&&(c(),f())}});ve.addEventListener(window,"blur",u),je({target:e,message:"<b>"+(o?"".concat(ze("cropcopy-title-copy")," / ").concat(ze("cropcopy-title-crop")):"".concat(ze("cropcopy-title-copy")))+"</b>",div:h,style:d?{}:{width:"500px"},buttons:o?[ze("cropcopy-btn-copy"),ze("cropcopy-btn-crop"),"Cancel"]:[ze("cropcopy-btn-copy"),"Cancel"],primaries:[ze("cropcopy-btn-copy")],callback:function(e){if(e===ze("cropcopy-btn-copy"))c();else if(e===ze("cropcopy-btn-crop")){var t=g.getRect();i({left:Math.round(-t.x),right:Math.round(t.x+t.width-r.width),top:Math.round(-t.y),bottom:Math.round(t.y+t.height-r.height)})}ve.removeEventListener(window,"blur",u),g.destroy(),m.destroy()},clickOnEnter:ze("cropcopy-btn-copy"),closefunc:function(e){f=e}})},showImportAsLayerDialog:function(e){var t=function(e,t){d.move(e,t)},n=document.createElement("div");if(ve.appendTextDiv(n,ze("import-as-layer-description")),e.klCanvas.isLayerLimitReached()){var r=ve.el({content:ze("import-as-layer-limit-reached"),css:{background:"#ff0",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"}});n.appendChild(r)}var i=e.bbox.width<550,a=ve.el({css:{display:"flex"}}),o=ve.el({tagName:"button",content:"1:1",css:{marginRight:"10px"},onClick:function(){d.reset()}}),s=ve.el({tagName:"button",content:ze("import-as-layer-fit"),css:{marginRight:"10px"},onClick:function(){d.setTransformFit()}}),l=ve.el({tagName:"button",content:ze("center"),css:{marginRight:"10px"},onClick:function(){d.setTransformCenter()}});a.appendChild(o),a.appendChild(s),a.appendChild(l),n.appendChild(a);for(var c=[],u=e.klCanvas.getLayers(),h=0;h<u.length;h++)c.push({image:u[h].context.canvas,opacity:u[h].opacity,mixModeStr:u[h].mixModeStr});c.push({image:e.importImage,opacity:1,mixModeStr:"source-over"});var d=new Ft({elementWidth:i?340:540,elementHeight:i?280:350,imageWidth:e.klCanvas.getLayerContext(0).canvas.width,imageHeight:e.klCanvas.getLayerContext(0).canvas.height,layers:c,transformIndex:c.length-1});ve.css(d.getElement(),{marginTop:"10px",marginLeft:"-20px"}),n.appendChild(d.getElement());var p=new ve.KeyListener({onDown:function(e){"left"===e&&t(-1,0),"right"===e&&t(1,0),"up"===e&&t(0,-1),"down"===e&&t(0,1)}});je({target:e.target,message:"<b>".concat(ze("import-as-layer-title"),"</b>"),div:n,style:i?null:{width:"500px"},buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){p.destroy(),d.destroy(),ve.destroyEl(o),ve.destroyEl(s),ve.destroyEl(l),"Ok"===t?e.callback(d.getTransformation(),d.getIsPixelated()):e.callback()}})},newImageDialog:function(e){var t=function(e,t,n,r,i){return ve.fitInto(e,t,Math.min(a,n-i),Math.min(a,r-i),1)},n=function(){f.value=""+Math.min(a,parseInt(f.value)),v.value=""+Math.min(a,parseInt(v.value));var e=parseInt(f.value),t=parseInt(v.value);(e<1||e>a||t<1||t>a)&&(e>a?e=a:t>a&&(t=a),f.value=""+e,v.value=""+t);for(var n=[[1,2],[2,1],[2,3],[3,2],[3,4],[4,3],[4,5],[5,4],[16,9],[9,16],[3,2],[2,3],[5,3],[3,5],[2,1],[1,2],[1.414,1],[1,1.414]],r=ve.reduce(e,t),i=null,o=null,s=0;s<n.length;s++)(0===s||Math.abs(n[s][0]/n[s][1]-r[0]/r[1])<o)&&(i=n[s],o=Math.abs(n[s][0]/n[s][1]-r[0]/r[1]));x.innerText=o>0&&o<.005?ze("new-ratio")+": ~"+i[0]+":"+i[1]:ze("new-ratio")+": "+r[0]+":"+r[1],e,t;var l=e,c=function(e,t){for(var n=e,r=t;;){if(!(n%=r))return r;if(!(r%=n))return n}}(e,t);e/=c,t/=c,t*=260,(e*=260)>260&&(t*=260/e,e=260),t>100&&(e*=100/t,t=100),P.style.width=e+"px",P.style.height=t+"px",ve.createCheckerDataUrl(parseInt(""+e/l*30),(function(e){A.style.background="url("+e+")"}))},r=e.currentColor,i=e.secondaryColor,a=e.maxCanvasSize,o=e.canvasWidth,s=e.canvasHeight,l=e.workspaceWidth,c=e.workspaceHeight,u=e.onConfirm,h=e.onCancel,d=document.createElement("div"),p=document.createElement("div"),g=document.createElement("div"),f=document.createElement("input"),m=document.createElement("div"),v=document.createElement("input"),y=document.createElement("div");p.style.position="relative",p.style.width="145px",p.style.height="35px",p.style.lineHeight="30px",g.style.width="145px",g.style.height="35px",g.style.lineHeight="30px",m.innerText=ze("new-px"),m.style.color="#888",m.style.fontSize="12px",m.style.marginLeft="5px",m.style.cssFloat="right",y.innerText=ze("new-px"),y.style.color="#888",y.style.fontSize="12px",y.style.marginLeft="5px",y.style.cssFloat="right",f.setAttribute("data-ignore-focus","true"),v.setAttribute("data-ignore-focus","true"),f.type="number",f.min="1",f.max=a,f.style.cssFloat="right",f.style.width="70px",v.type="number",v.min="1",v.max=a,v.style.cssFloat="right",v.style.width="70px",f.value=o,v.value=s,f.onclick=function(){this.focus(),n()},v.onclick=function(){this.focus(),n()},p.appendChild(m),p.appendChild(f),ve.appendTextDiv(p,ze("width")+": "),g.appendChild(y),g.appendChild(v),ve.appendTextDiv(g,ze("height")+": ");var x=document.createElement("div");x.style.marginTop="5px",x.style.color="#888";var b=document.createElement("div"),w=document.createElement("button");b.style.marginBottom="10px";var C=document.createElement("button"),S=document.createElement("button"),k=document.createElement("button"),E=document.createElement("button"),M=document.createElement("button");C.textContent=ze("new-current"),w.textContent=ze("new-fit"),M.textContent=ze("new-oversize"),k.textContent=ze("new-landscape"),E.textContent=ze("new-portrait"),S.textContent=ze("new-square"),C.style.marginRight="5px",w.style.marginRight="5px",M.style.marginRight="5px",k.style.marginTop="5px",k.style.marginRight="5px",E.style.marginTop="5px",E.style.marginRight="5px",b.appendChild(C),b.appendChild(w),b.appendChild(M),b.appendChild(S),b.appendChild(k),b.appendChild(E),C.onclick=function(){f.value=o,v.value=s,n()},w.onclick=function(){f.value=l,v.value=c,n()},M.onclick=function(){f.value=l+500,v.value=c+500,n()},S.onclick=function(){var e=t(1,1,l,c,50);f.value=""+Math.round(e.width),v.value=""+Math.round(e.height),n()},k.onclick=function(){var e=t(4,3,l,c,50);f.value=""+Math.round(e.width),v.value=""+Math.round(e.height),n()},E.onclick=function(){var e=t(3,4,l,c,50);f.value=""+Math.round(e.width),v.value=""+Math.round(e.height),n()};var I=new Xe({isFocusable:!0,optionArr:[["screen",ze("new-screen")],["16 9",ze("new-video")+" 16:9"],["3 2","3:2"],["5 3","5:3"],["2 1","2:1"],["paper",ze("new-din-paper")+" 2:1"],["9 16","9:16"],["2 3","2:3"],["3 5","3:5"],["1 2","1:2"],["1 1.4142135623730951","1:2"]],onChange:function(e){if("screen"===e)f.value=""+window.screen.width,v.value=""+window.screen.height;else if("paper"===e){var r=t(Math.sqrt(2),1,l,c,50);f.value=""+Math.round(r.width),v.value=""+Math.round(r.height)}else{var i=e.split(" "),a=t(parseFloat(i[0]),parseFloat(i[1]),l,c,50);f.value=""+Math.round(a.width),v.value=""+Math.round(a.height)}n(),I.setValue(null)}});setTimeout((function(){I.setValue(null)}),0),ve.css(I.getElement(),{width:"80px"}),b.appendChild(I.getElement());var T={r:255,g:255,b:255,a:1},R=[{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1},{r:0,g:0,b:0,a:0}];R.push({r:r.r,g:r.g,b:r.b,a:1}),R.push({r:i.r,g:i.g,b:i.b,a:1});var L=new $e({colorArr:R,onChange:function(e){T=e,P.style.backgroundColor="rgba("+e.r+","+e.g+","+e.b+", "+e.a+")"}}),A=document.createElement("div");ve.css(A,{boxSizing:"border-box",width:"340px",height:"140px",display:"table",backgroundColor:"#9e9e9e",padding:"10px",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",marginLeft:"-20px",colorScheme:"only light"});var P=document.createElement("div");ve.css(P,{width:"200px",height:"100px",backgroundColor:"#fff",marginLeft:"auto",marginRight:"auto",color:"#aaa",fontSize:"16px",fontWeight:"bold",textAlign:"center",verticalAlign:"center",display:"table",overflow:"hidden",boxShadow:"0px 0px 3px rgba(0,0,0,0.5)"});var O=document.createElement("div");O.style.display="table-cell",O.style.verticalAlign="middle",O.appendChild(P),A.appendChild(O);var D=ve.appendTextDiv(P,"");D.style.display="table-cell",D.style.verticalAlign="middle",parseInt(f.value),parseInt(v.value),f.onchange=function(){(""===f.value||parseInt(f.value)<0)&&(f.value="1"),n()},f.onkeyup=function(){n()},v.onchange=function(){(""===v.value||parseFloat(v.value)<0)&&(v.value="1"),n()},v.onkeyup=function(){n()},n(),d.appendChild(b);var B=ve.el({parent:d,css:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}}),z=ve.el({parent:B});z.appendChild(p),z.appendChild(g),z.appendChild(x),B.appendChild(L.getElement()),d.appendChild(A),je({target:e.klRootEl,message:"<b>".concat(ze("new-title"),"</b>"),div:d,buttons:["Ok","Cancel"],callback:function(e){f.onclick=null,v.onclick=null,C.onclick=null,w.onclick=null,M.onclick=null,S.onclick=null,k.onclick=null,E.onclick=null,f.onchange=null,f.onkeyup=null,v.onchange=null,v.onkeyup=null,I.destroy(),L.destroy(),"Cancel"===e||parseInt(f.value)<=0||parseInt(v.value)<=0||isNaN(parseInt(f.value))||isNaN(parseInt(v.value))?h():u(parseInt(f.value),parseInt(v.value),T)},clickOnEnter:"Ok"})},textToolDialog:function(e){var n=function(){f.clearRect(0,0,g.width,g.height);var t=ln.default({},e.color,{a:W.getValue()}),n=vt(g,{x:e.x,y:e.y,textStr:V.value,align:X.getValue(),isItalic:U.getValue(),isBold:Y.getValue(),size:parseFloat(N.value),font:D.getValue(),color:ve.ColorConverter.toRgbaStr(t),angleRad:e.angleRad});n.width=Math.max(n.width,1),n.height=Math.max(n.height,1);var r=ve.rotate(n.x,n.y,-e.angleRad/Math.PI*180),i=ve.rotate(n.width,n.height,-e.angleRad/Math.PI*180),a=e.x+r.x+i.x/2,o=e.y+r.y+i.y/2,s=ve.fitInto(n.width,n.height,u-100,h-100);d=Math.min(1,s.width/n.width),d=Math.min(4,d*Math.pow(2,z)),v.save(),d>=4?v.imageSmoothingEnabled=!1:(v.imageSmoothingEnabled=!0,v.imageSmoothingQuality=d>=1?"low":"medium"),v.clearRect(0,0,b.width,b.height),v.translate(u/2,h/2),v.scale(d,d),v.rotate(e.angleRad),v.drawImage(p[e.layerIndex].canvas,-a,-o),v.drawImage(g,-a,-o),v.restore(),x.save(),x.fillStyle="rgb(158,158,158)",x.fillRect(0,0,u,h),x.save(),x.translate(u/2,h/2),x.scale(d,d),x.rotate(e.angleRad),x.imageSmoothingEnabled=!1;var l=1/d;x.globalAlpha=.2,x.drawImage(k,-a-l,-o-l,g.width+2*l,g.height+2*l),x.globalAlpha=1,x.globalCompositeOperation="destination-out",x.drawImage(k,-a,-o,g.width,g.height),x.restore(),d>=4?x.imageSmoothingEnabled=!1:(x.imageSmoothingEnabled=!0,x.imageSmoothingQuality=d>=1?"low":"medium"),x.save(),x.translate(u/2,h/2),x.scale(d,d),x.rotate(e.angleRad);for(var c=0;c<e.layerIndex;c++)p[c].opacity>0&&(x.globalAlpha=p[c].opacity,x.globalCompositeOperation=p[c].mixModeStr,x.drawImage(p[c].canvas,-a,-o));x.restore(),x.globalAlpha=p[e.layerIndex].opacity,x.globalCompositeOperation=p[e.layerIndex].mixModeStr,x.drawImage(m,0,0),x.save(),x.translate(u/2,h/2),x.scale(d,d),x.rotate(e.angleRad);for(var C=e.layerIndex+1;C<p.length;C++)p[C].opacity>0&&(x.globalAlpha=p[C].opacity,x.globalCompositeOperation=p[C].mixModeStr,x.drawImage(p[C].canvas,-a,-o));x.restore(),x.restore(),w.save(),w.fillStyle=S,w.fillRect(0,0,b.width,b.height),w.drawImage(y,0,0),w.restore(),w.save(),w.globalCompositeOperation="difference",w.strokeStyle="#fff",w.lineWidth=1,w.strokeRect(Math.round(u/2-n.width/2*d),Math.round(h/2-n.height/2*d),Math.round(n.width*d),Math.round(n.height*d)),w.restore()},r=function(t,r){var i=ve.rotate(t,r,-e.angleRad/Math.PI*180);e.x+=i.x/d,e.y+=i.y/d,n()},i=function(e){z=Math.min(2,Math.max(-2,z+e)),n(),H.disabled=!a(1),F.disabled=!a(-1)},a=function(e){return z!==Math.min(2,Math.max(-2,z+e))},o=function(){window.scrollTo(0,0)},s=ve.el({}),l=e.bbox.width<550,c=e.bbox.height<630,u=l?340:540,h=l?c?210:260:c?230:350,d=1,p=e.klCanvas.getLayersFast(),g=ve.canvas(e.klCanvas.getWidth(),e.klCanvas.getHeight()),f=g.getContext("2d"),m=ve.canvas(u,h),v=m.getContext("2d"),y=ve.canvas(u,h),x=y.getContext("2d"),b=ve.canvas(u,h),w=b.getContext("2d");ve.css(b,{display:"block"});var C=ve.el({parent:s,css:{position:"relative",width:u+"px",marginLeft:"-20px",cursor:"move",colorScheme:"only light",touchAction:"none"},onClick:function(){V.focus()}});ve.el({parent:C,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",pointerEvents:"none"}}),C.appendChild(b);var S=w.createPattern(ve.createCheckerCanvas(8),"repeat"),k=ve.canvas(1,1);k.getContext("2d").fillRect(0,0,1,1);var E=new ve.PointerListener({target:b,pointers:1,onPointer:function(e){"pointermove"===e.type&&e.button&&(e.eventPreventDefault(),r(-e.dX,-e.dY))},onWheel:function(e){i(-e.deltaY)}}),M=function(e){e.preventDefault()};ve.addEventListener(b,"wheel",M);var I=ve.el({parent:s,css:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"}}),T=ve.el({parent:s,css:l?{}:{display:"flex",alignItems:"center",justifyContent:"space-between"}}),R=ve.el({parent:T,css:{display:"flex",alignItems:"center",marginTop:"5px"}}),L=ve.el({parent:T,css:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:"5px",width:l?"":"300px"}}),A=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];A.unshift({r:e.secondaryColor.r,g:e.secondaryColor.g,b:e.secondaryColor.b,a:1}),A.unshift({r:e.color.r,g:e.color.g,b:e.color.b,a:1});var P=new $e({colorArr:A,initialIndex:0,onChange:function(t){e.color=t,n()}});P.getElement().title=ze("text-color"),P.getElement().style.marginLeft="-5px",I.appendChild(P.getElement());var O,D,B,z=0,j=ve.el({parent:I,css:{}}),H=ve.el({parent:j,content:'<img height="20" src="'.concat(t(en),'">'),title:ze("zoom-in"),tagName:"button",onClick:function(){i(1)},css:{fontWeight:"bold"}}),F=ve.el({parent:j,content:'<img height="20" src="'.concat(t(tn),'">'),title:ze("zoom-out"),tagName:"button",onClick:function(){i(-1)},css:{fontWeight:"bold",marginLeft:"5px"}}),N=ve.el({parent:R,tagName:"input",title:ze("text-size"),custom:{type:"number",min:1,max:1e4,value:e.size},css:{width:"60px"},onChange:function(){N.value=""+Math.max(1,Math.min(1e4,parseInt(N.value))),n()}}),_=new ve.PointerListener({target:N,onWheel:function(e){N.value=""+Math.max(1,Math.min(1e3,parseInt(N.value)-e.deltaY)),n()}});O=ve.el({css:{fontSize:"15px",marginLeft:"10px"}}),D=new Xe({isFocusable:!0,optionArr:[["sans-serif","Sans-serif"],["serif","Serif"],["monospace","Monospace"],["cursive","Cursive"],["fantasy","Fantasy"]],initValue:e.font,onChange:function(e){n()}}),O.appendChild(D.getElement()),R.appendChild(O),B=new ve.PointerListener({target:D.getElement(),onWheel:function(e){D.setDeltaValue(e.deltaY)}});var X=new Ye({optionArr:[{id:"left",title:ze("text-left"),image:t(sn)},{id:"center",title:ze("text-center"),image:t(cn)},{id:"right",title:ze("text-right"),image:t(un)}],initId:e.align,onChange:function(e){n()}});L.appendChild(X.getElement());var U=new Ue({image:t(hn),title:ze("text-italic"),initValue:e.isItalic,onChange:function(e){n()}});L.appendChild(U.getElement());var Y=new Ue({image:t(dn),title:ze("text-bold"),initValue:e.isBold,onChange:function(e){n()}});L.appendChild(Y.getElement());var W=new Ke({label:ze("opacity"),width:150,height:30,min:0,max:1,initValue:e.opacity,resolution:225,eventResMs:1e3/30,onChange:function(e){n()},formatFunc:function(e){return Math.round(100*e)}});L.appendChild(W.getElement());var V=ve.el({parent:s,tagName:"textarea",custom:{placeholder:ze("text-placeholder"),"data-ignore-focus":"true"},css:{whiteSpace:"nowrap",overflow:"auto",width:"100%",height:"70px",resize:"vertical",marginTop:"10px"},onChange:function(){n()}});V.addEventListener("input",n),setTimeout((function(){V.focus(),V.select()}));var G=new ve.KeyListener({onDown:function(e,t,n){ve.isInputFocused(!0)||("left"===e&&r(-1,0),"right"===e&&r(1,0),"up"===e&&r(0,-1),"down"===e&&r(0,1))}});window.addEventListener("scroll",o),je({target:e.klRootEl,message:"<b>".concat(ze("text-title"),"</b>"),div:s,buttons:["Ok","Cancel"],style:l?{}:{width:"500px"},callback:function(t){var r={x:e.x,y:e.y,textStr:V.value,align:X.getValue(),isItalic:U.getValue(),isBold:Y.getValue(),color:e.color,size:N.value,font:D.getValue(),opacity:W.getValue()};window.removeEventListener("scroll",o),V.removeEventListener("input",n),ve.destroyEl(V),E.destroy(),_.destroy(),B.destroy(),ve.removeEventListener(b,"wheel",M),ve.destroyEl(C),ve.destroyEl(H),ve.destroyEl(F),ve.destroyEl(N),P.destroy(),D.destroy(),G.destroy(),X.destroy(),U.destroy(),Y.destroy(),W.destroy(),"Ok"===t&&e.onConfirm(r)},autoFocus:!1,clickOnEnter:"Ok",ignoreBackground:!0,closefunc:function(e){e}}),n()},showImportImageDialog:function(e){var t,n=function(n,r){var i=ve.fitInto(n,r,e.maxSize,e.maxSize);i.width<n?(t.innerHTML='<span style="color:#f00">'.concat(n," X ").concat(r,"</span>  ").concat(Math.round(i.width)," X ").concat(Math.round(i.height)),t.title=ze("import-too-large")):(t.innerHTML="".concat(n," X ").concat(r),t.title="")},r=ve.el({}),i=e.bbox.width<550||e.bbox.height<550,a=i?{}:{width:"500px"},o=new rt({width:i?340:540,height:i?300:400,canvas:e.image.canvas,isNotCopy:!0,onChange:function(e,r){t&&n(e,r)}});ve.css(o.getEl(),{marginLeft:"-20px",borderTop:"1px solid #bbb",borderBottom:"1px solid #bbb"}),o.getEl().title=ze("crop-drag-to-crop"),r.appendChild(o.getEl()),t=ve.el({parent:r,css:{marginTop:"10px",textAlign:"center",color:"#888",lineHeight:"20px"}}),n(e.image.width,e.image.height);var s,l=!1;if("psd"===e.image.type){var c={background:"rgba(255,255,0,0.5)",padding:"10px",marginTop:"5px",marginBottom:"5px",border:"1px solid #e7d321",borderRadius:"5px"};if(e.image.layers){if(s=new Fe({init:l,label:ze("import-flatten"),callback:function(e){l=e}}),r.appendChild(s.getElement()),e.image.warningArr){var u=ve.el({content:ze("import-psd-limited-support"),css:c});u.appendChild(ve.el({tagName:"a",content:"Details",onClick:function(){!function(e){for(var t=[],n={mask:"Masks not supported. Mask was applied.",clipping:"Clipping not supported. Clipping layers were merged.",group:"Groups not supported. Layers were ungrouped.",adjustment:"Adjustment layers not supported.","layer-effect":"Layer effects not supported.","smart-object":"Smart objects not supported.","blend-mode":"Unsupported layer blend mode.","bits-per-channel":"Unsupported color depth. Only 8bit per channel supported."},r=0;r<e.length;r++)t.push("- "+n[e[r]]);alert(t.join("\n"))}(e.image.warningArr)}})),r.appendChild(u)}}else{var h=ve.el({content:ze("import-psd-unsupported"),css:c});r.appendChild(h)}}je({target:e.target,message:"<b>".concat(ze("import-title"),"</b>"),div:r,style:a,buttons:[ze("import-btn-as-layer"),ze("import-btn-as-image"),"Cancel"],callback:function(t){var n=o.getCroppedImage(),r=o.getRect();o.destroy(),s&&s.destroy(),t===ze("import-btn-as-layer")?e.callback({type:"as-layer",image:n}):t===ze("import-btn-as-image")?"psd"===e.image.type?(l&&(e.image.layers=null),e.callback({type:"as-image-psd",image:e.image,cropObj:r})):"image"===e.image.type&&e.callback({type:"as-image",image:n}):e.callback({type:"cancel"})},autoFocus:"As Image"})},showIframePopup:Dr,imgurUpload:function(e,n,r,i){var a=document.createElement("input");a.type="text",a.value=ze("upload-title-untitled");var o=ve.el({tagName:"textarea",custom:{rows:2},css:{width:"100%",maxWidth:"100%"}}),c=document.createElement("div");c.textContent=ze("upload-name")+":";var u=ve.el({content:ze("upload-caption")+":",css:{marginTop:"10px"}}),h=document.createElement("div");h.innerHTML='<br/><a href="https://imgur.com/tos" target="_blank" rel="noopener noreferrer">'.concat(ze("upload-tos"),"</a> ").concat(ze("upload-tos-2"));var d=new oi.RadioList({name:"filetype",init:"jpeg",items:[{label:"JPG",value:"jpeg"},{label:"PNG",value:"png"}],ignoreFocus:!0});ve.css(d.getElement(),{marginBottom:"10px"});var p,g=document.createElement("div"),f=document.createElement("div");f.className="info-hint",f.textContent=ze("upload-link-notice"),g.append(f,d.getElement(),c,a,u,o,h),oi.popup({target:n,message:"<b>".concat(ze("upload-title"),"</b>"),type:"upload",div:g,buttons:[ze("upload-submit"),"Cancel"],clickOnEnter:ze("upload-submit"),primaries:[ze("upload-submit")],autoFocus:ze("upload-submit"),callback:(p=s.default(t(l).mark((function s(c){var u;return t(l).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c!==ze("upload-submit")&&"Yes"!==c&&"Ok"!==c){t.next=14;break}if(t.prev=1,i){t.next=4;break}throw new Error("imgur key missing");case 4:return t.next=6,Vr(e.getCompleteCanvas(1),a.value,o.value,d.getValue(),i);case 6:u=t.sent,oi.popup({target:n,type:"ok",message:"<h3>".concat(ze("upload-success"),"</h3><br>").concat(ze("upload-delete"),"<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/").concat(u.deletehash,"'>imgur.com/<b>delete</b>/").concat(u.deletehash,"</a><br><br>"),buttons:["Ok"]}),r.reset(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),oi.popup({target:n,type:"error",message:ze("upload-failed")+": "+t.t0.message,buttons:["Ok"]});case 14:case"end":return t.stop()}}),s,null,[[1,11]])}))),function(){return p.apply(this,arguments)})})},HandUi:function(e){var n=function(){u.innerHTML=Math.round(100*a)+"%",d.innerHTML=Math.round(o)+"",h.style.transform="rotate("+o+"deg)",h.style.boxShadow=o%90==0?"inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)":""},r=ve.el({css:{margin:"10px"}}),i=!0,a=e.scale,o=e.angleDeg,s=ve.el({css:{marginBottom:"10px",display:"flex"}}),l=ve.el({css:{display:"flex",marginBottom:"10px"}}),c=ve.el({css:{display:"flex"}});r.append(s,l,c);var u=ve.el({css:{width:"55px",userSelect:"none"}});s.appendChild(u);var h=new Image;h.src=t(tt),ve.css(h,{verticalAlign:"bottom",width:"20px",height:"20px",marginRight:"5px",borderRadius:"10px",background:"rgba(0,0,0,0.2)",userSelect:"none"}),s.appendChild(h);var d=ve.el({css:{userSelect:"none"}});s.appendChild(d),n();var p=ve.el({tagName:"button",content:ze("hand-reset"),onClick:e.onReset});ve.makeUnfocusable(p);var g=ve.el({tagName:"button",content:ze("hand-fit"),css:{marginLeft:"10px"},onClick:e.onFit});ve.makeUnfocusable(g),l.append(p,g);var f=ve.el({tagName:"button",content:'<img height="20" src="'+t(an)+'" alt="Rotate" style="transform: scale(-1, 1)"/>',onClick:function(){e.onAngleChange(-15,!0)}});ve.makeUnfocusable(f);var m=ve.el({tagName:"button",content:"0",css:{marginLeft:"10px"},onClick:function(){e.onAngleChange(0)}});ve.makeUnfocusable(m);var v=ve.el({tagName:"button",content:'<img height="20" src="'+t(an)+'" alt="Rotate"/>',css:{marginLeft:"10px"},onClick:function(){e.onAngleChange(15,!0)}});ve.makeUnfocusable(v),c.append(f,m,v),this.getElement=function(){return r},this.setIsVisible=function(e){i=!!e,r.style.display=i?"block":"none",i&&n()},this.update=function(e,t){a=e,o=t,i&&n()}},FillUi:function(e){var t=ve.el({css:{margin:"10px"}}),n=!0,r=ve.el({parent:t,css:{marginBottom:"10px"}}),i=new Ke({label:ze("opacity"),width:250,height:30,min:0,max:1,initValue:1,onChange:function(e){},formatFunc:function(e){return Math.round(100*e)}});t.appendChild(i.getElement());var a=new Ke({label:ze("bucket-tolerance"),width:250,height:30,min:0,max:255,initValue:51,onChange:function(e){},formatFunc:function(e){return Math.round(e/255*100)}});ve.css(a.getElement(),{marginTop:"10px"}),t.appendChild(a.getElement());var o,s,l,c,u=ve.el({parent:t,css:{display:"flex",marginTop:"10px"}});o=ve.el({content:ze("bucket-sample")+"&nbsp;",title:ze("bucket-sample-title"),css:{fontSize:"15px"}}),s=new Xe({optionArr:[["all",ze("bucket-sample-all")],["current",ze("bucket-sample-active")],["above",ze("bucket-sample-above")]],initValue:"all",onChange:function(e){}}),new ve.PointerListener({target:s.getElement(),onWheel:function(e){s.setDeltaValue(e.deltaY)}}),o.appendChild(s.getElement()),u.appendChild(o),l=ve.el({content:ze("bucket-grow")+"&nbsp;",title:ze("bucket-grow-title"),css:{fontSize:"15px",marginLeft:"10px"}}),c=new Xe({optionArr:[["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"]],initValue:"0",onChange:function(e){}}),new ve.PointerListener({target:c.getElement(),onWheel:function(e){c.setDeltaValue(e.deltaY)}}),l.appendChild(c.getElement()),u.appendChild(l);var h=!0,d=new Fe({init:!0,label:ze("bucket-contiguous"),title:ze("bucket-contiguous-title"),callback:function(e){h=e},css:{marginTop:"10px",paddingRight:"5px",display:"inline-block"}});t.appendChild(d.getElement()),this.getElement=function(){return t},this.setIsVisible=function(i){n=!!i,t.style.display=n?"block":"none",n&&(r.appendChild(e.colorSlider.getElement()),r.appendChild(e.colorSlider.getOutputElement()))},this.getTolerance=function(){return a.getValue()},this.getOpacity=function(){return i.getValue()},this.getSample=function(){return s.getValue()},this.getGrow=function(){return parseInt(c.getValue(),10)},this.getContiguous=function(){return h}},TextUi:function(e){var t=ve.el({css:{margin:"10px"}}),n=!0,r=ve.el({parent:t,css:{marginBottom:"10px"}});ve.el({parent:t,content:ze("text-instruction")}),this.getElement=function(){return t},this.setIsVisible=function(i){n=!!i,t.style.display=n?"block":"none",n&&(r.appendChild(e.colorSlider.getElement()),r.appendChild(e.colorSlider.getOutputElement()))}},ShapeUi:function(e){var t,n,r=function(){var e=ve.clamp(Math.round(C.getValue()/10),1,10)+"px",t=1.35;ve.css(c,{fill:"none",stroke:"black",strokeWidth:e}),ve.css(h,{fill:"black",stroke:"none"}),ve.css(p,{fill:"none",stroke:"black",strokeWidth:e}),ve.css(f,{fill:"black",stroke:"none"}),ve.css(v,{fill:"none",stroke:"black",strokeWidth:e}),M.getValue()?(c.setAttribute("y",""+l),c.setAttribute("height",""+(s-2*l)),h.setAttribute("y",""+l),h.setAttribute("height",""+(s-2*l)),p.setAttribute("ry",""+(s/2-l)),f.setAttribute("ry",""+(s/2-l))):(c.setAttribute("y",""+l*t),c.setAttribute("height",""+(s-l*t*2)),h.setAttribute("y",""+l*t),h.setAttribute("height",""+(s-l*t*2)),p.setAttribute("ry",""+(s/2-l*t)),f.setAttribute("ry",""+(s/2-l*t))),I.getValue()?(v.setAttribute("y1",""+(s-l)),v.setAttribute("y2",""+l)):(v.setAttribute("y1",""+(s-l*t)),v.setAttribute("y2",""+l*t))},i=ve.el({css:{margin:"10px"}}),a=!0,o=ve.el({parent:i,css:{marginBottom:"10px"}}),s=35,l=8,c=ve.createSvg({elementType:"rect",x:""+l,width:""+(s-2*l)}),u=ve.createSvg({elementType:"svg",width:""+s,height:""+s});u.appendChild(c),ve.css(u,{display:"block"});var h=ve.createSvg({elementType:"rect",x:""+l,width:""+(s-2*l)}),d=ve.createSvg({elementType:"svg",width:""+s,height:""+s});d.appendChild(h),ve.css(d,{display:"block"});var p=ve.createSvg({elementType:"ellipse",cx:""+s/2,cy:""+s/2,rx:""+(s/2-l)}),g=ve.createSvg({elementType:"svg",width:""+s,height:""+s});g.appendChild(p),ve.css(g,{display:"block"});var f=ve.createSvg({elementType:"ellipse",cx:""+s/2,cy:""+s/2,rx:""+(s/2-l)}),m=ve.createSvg({elementType:"svg",width:""+s,height:""+s});m.appendChild(f),ve.css(m,{display:"block"});var v=ve.createSvg({elementType:"line",x1:""+l,x2:""+(s-l)}),y=ve.createSvg({elementType:"svg",width:""+s,height:""+s});y.appendChild(v),ve.css(y,{display:"block"});var x=ve.el({parent:i,css:{display:"flex",justifyContent:"space-between",alignItems:"start"}}),b=new et({optionArr:[{id:"rect-stroke",label:u,title:ze("shape-rect")+" "+ze("shape-stroke")},{id:"ellipse-stroke",label:g,title:ze("shape-ellipse")+" "+ze("shape-stroke")},{id:"line",label:y,title:ze("shape-line")},{id:"rect-fill",label:d,title:ze("shape-rect")+" "+ze("shape-fill")},{id:"ellipse-fill",label:m,title:ze("shape-ellipse")+" "+ze("shape-fill")}],initId:"rect",onChange:function(e){var r=e.split("-");t=r[0],n=r[1],ve.css(M.getElement(),{display:"line"===t?"none":null}),ve.css(I.getElement(),{display:"line"===t?null:"none"}),ve.css(C.getElement(),{display:"line"!==t&&"fill"===n?"none":null})},changeOnInit:!0});b.getElement().style.width="120px",x.appendChild(b.getElement());var w=new Fe({init:!1,label:ze("eraser"),callback:function(e){r()}});x.appendChild(w.getElement());var C=new Ke({label:ze("shape-line-width"),width:250,height:30,min:1,max:200,initValue:4,curve:"quadratic",onChange:function(e){r()},formatFunc:function(e){return Math.round(e)}});ve.css(C.getElement(),{marginTop:"10px"}),i.appendChild(C.getElement());var S=new Ke({label:ze("opacity"),width:250,height:30,min:0,max:1,initValue:1,onChange:function(e){},formatFunc:function(e){return Math.round(100*e)}});ve.css(S.getElement(),{marginTop:"10px"}),i.appendChild(S.getElement());var k=ve.el({parent:i,css:{display:"flex",alignItems:"center",marginTop:"10px"}}),E=new Fe({init:!1,label:ze("shape-outwards"),callback:function(e){},css:{width:"50%",marginRight:"10px"}});k.appendChild(E.getElement());var M=new Fe({init:!1,label:ze("shape-fixed"),callback:function(e){r()},css:{flexGrow:"1"}});k.appendChild(M.getElement());var I=new Fe({init:!1,label:ze("shape-snap"),title:ze("shape-snap-title"),callback:function(e){r()},css:{flexGrow:"1"}});k.appendChild(I.getElement()),r(),this.getElement=function(){return i},this.setIsVisible=function(t){a=!!t,i.style.display=a?"block":"none",a&&(o.appendChild(e.colorSlider.getElement()),o.appendChild(e.colorSlider.getOutputElement()))},this.getShape=function(){return t},this.getMode=function(){return n},this.getIsEraser=function(){return w.getValue()},this.getOpacity=function(){return S.getValue()},this.getLineWidth=function(){return C.getValue()},this.getIsOutwards=function(){return E.getValue()},this.getIsFixed=function(){return M.getValue()},this.getIsSnap=function(){return I.getValue()}},FileTab:Ur,FilterTab:Yr,SettingsTab:ai,klLayerManager:function(e,n,r){var i,a=function(e){var n=document.createElement("div"),i=ve.el({content:ze("layers-rename-name")+":",css:{marginRight:"5px"}}),a=ve.el({css:{display:"flex"}}),s=document.createElement("input");s.value=h.getLayer(e).name,s.setAttribute("data-ignore-focus","true");var l=ve.el({tagName:"Button",content:'<img src="'+t(lt)+'" height="20"/>',title:ze("layers-rename-clear"),css:{marginLeft:"10px"},onClick:function(){s.value="",s.focus()}}),c=[ze("layers-rename-sketch"),ze("layers-rename-colors"),ze("layers-rename-lines"),ze("background"),ze("layers-rename-foreground")],u=[],d=ve.el({css:{display:"flex",flexWrap:"wrap",marginTop:"5px",marginLeft:"-5px"}});c.forEach((function(e){var t=ve.el({parent:d,tagName:"Button",content:e,onClick:function(){s.value=t.textContent},css:{margin:"5px 0 0 5px"}});u.push(t)})),n.appendChild(i),i.append(a,d),a.append(s,l),setTimeout((function(){s.focus(),s.select()}),10),je({target:r,message:"<b>".concat(ze("layers-rename-title"),"</b>"),div:n,buttons:[ze("layers-rename"),"Cancel"],primaries:[ze("layers-rename")],callback:function(t){if(ve.destroyEl(l),u.forEach((function(e){ve.destroyEl(e)})),u.splice(0,u.length),t===ze("layers-rename")){if(s.value===h.getLayer(e).name)return;h.renameLayer(e,s.value),o(),we.pause(!0),f(e),we.pause(!1)}},clickOnEnter:ze("layers-rename")})},o=function(){function e(e){var t=h.getLayer(e).name,n=w[e].opacity,i=w[e].context.canvas,o=document.createElement("div");o.className="layerBox",d[e]=o,o.posY=35*(w.length-1)-35*e,ve.css(o,{width:"250px",height:"34px",backgroundColor:"rgb( 220, 220, 220)",border:"1px solid #aaa",position:"absolute",left:"0 px",top:o.posY+"px",transition:"all 0.1s linear",borderRadius:"5px",boxSizing:"border-box"});var u=document.createElement("div");ve.css(u,{position:"relative"});var p=document.createElement("div");ve.css(p,{width:"250px",height:"34px"});var g=document.createElement("div");o.appendChild(u),u.appendChild(p),u.appendChild(g),o.spot=e;var k,M=ve.fitInto(i.width,i.height,30,30,1),I=o.thumb=ve.canvas(M.width,M.height),T=I.getContext("2d");T.save(),I.width>i.width&&(T.imageSmoothingEnabled=!1),T.drawImage(i,0,0,I.width,I.height),T.restore(),ve.css(o.thumb,{position:"absolute",left:(32-o.thumb.width)/2+"px",top:(32-o.thumb.height)/2+"px",colorScheme:"only light"}),ve.createCheckerDataUrl(4,(function(e){I.style.backgroundImage="url("+e+")"})),o.label=document.createElement("div"),o.lname=t,o.label.append(o.lname),ve.css(o.label,{position:"absolute",left:"38px",top:"1px",fontSize:"13px",width:"170px",height:"20px",overflow:"hidden",color:"#666",whiteSpace:"nowrap"}),o.label.ondblclick=function(){a(o.spot)},o.opacityLabel=document.createElement("div"),o.opacity=n,o.opacityLabel.append(parseInt(""+100*o.opacity)+"%"),ve.css(o.opacityLabel,{position:"absolute",left:"194px",top:"1px",fontSize:"13px",textAlign:"right",width:"50px",color:"#666",transition:"color 0.2s ease-in-out"});var R=new Qe({init:o.opacity,width:204,pointSize:14,callback:function(e,t,n){return t?(k=h.getLayer(o.spot).opacity,void we.pause(!0)):n?(we.pause(!1),void(k!==e&&h.layerOpacity(o.spot,e))):(o.opacityLabel.innerHTML=Math.round(100*e)+"%",void h.layerOpacity(o.spot,e))}});ve.css(R.getEl(),{position:"absolute",left:"39px",top:"17px"}),o.opacitySlider=R,ve.setEventListener(o.thumb,"onpointerover",(function(e){if(0===e.buttons||e.pointerType&&"touch"===e.pointerType){var t=ve.fitInto(i.width,i.height,250,250,1);x.width===t.width&&x.height===t.height||(x.width=t.width,x.height=t.height);var n=x.getContext("2d");n.save(),x.width>i.width&&(n.imageSmoothingEnabled=!1),n.imageSmoothingQuality="high",n.clearRect(0,0,x.width,x.height),n.drawImage(i,0,0,x.width,x.height),n.restore(),ve.css(m,{top:e.clientY-x.height/2+"px",opacity:"0"}),!1===b&&(r.appendChild(m),b=!0),clearTimeout(y),y=setTimeout((function(){ve.css(m,{opacity:"1"})}),20),clearTimeout(v)}})),ve.setEventListener(o.thumb,"onpointerout",(function(){clearTimeout(y),ve.css(m,{opacity:"0"}),clearTimeout(v),v=setTimeout((function(){b&&(r.removeChild(m),b=!1)}),300)})),p.appendChild(o.thumb),p.appendChild(o.label),p.appendChild(o.opacityLabel),p.appendChild(R.getEl());var L=!1,A=!1;o.pointerListener=new ve.PointerListener({target:p,maxPointers:1,onPointer:function(e){if("pointerdown"===e.type&&"left"===e.button)ve.css(o,{transition:"box-shadow 0.3s ease-in-out"}),o.style.zIndex="1",D=o.spot,A=!1,o.isSelected||(A=!0,S.activateLayer(o.spot)),L=!0;else if("pointermove"===e.type&&"left"===e.button){L&&(L=!1,ve.css(o,{boxShadow:"1px 3px 5px rgba(0,0,0,0.4)"})),o.posY+=e.dY;var t=Math.max(0,Math.min(35*(w.length-1),o.posY));o.style.top=t+"px",l(o.spot,s(o.posY))}if("pointerup"===e.type){ve.css(o,{transition:"all 0.1s linear"}),setTimeout((function(){ve.css(o,{boxShadow:""})}),20),o.posY=Math.max(0,Math.min(35*(w.length-1),o.posY)),o.style.zIndex="";var n=s(o.posY),r=o.spot;c(o.spot,n),r!=n&&(we.pause(!0),f(C),we.pause(!1)),r===n&&A&&f(C),A=!1}}}),E.appendChild(o)}for(i=we.getState(),d=[];E.firstChild;){var t=E.firstChild;t.pointerListener.destroy(),t.opacitySlider.destroy(),E.removeChild(t)}for(var n=0;n<w.length;n++)e(n);S.activateLayer(C),u()},s=function(e){var t=parseInt(""+(e/(p+g)+.5));return t=Math.min(w.length-1,Math.max(0,t)),t=w.length-t-1},l=function(e,t){if((t=Math.min(w.length-1,Math.max(0,t)))!==D){for(var n=0;n<w.length;n++)if(d[n].spot!==e){var r=d[n].spot;d[n].spot>e&&r--,r>=t&&r++,d[n].posY=(p+g)*(w.length-r-1),d[n].style.top=d[n].posY+"px"}D=t}},c=function(e,t){if(isNaN(e)||isNaN(t))throw"layermanager - invalid move";for(var n=0;n<w.length;n++)!function(n){var r=d[n].spot;d[n].spot===e?r=t:(d[n].spot>e&&r--,r>=t&&r++),d[n].spot=r,d[n].posY=(p+g)*(w.length-r-1),d[n].style.top=d[n].posY+"px"}(n);e!==t&&(h.moveLayer(C,t-e),w=h.getLayers(),C=t,A.disabled=0===C)},u=function(){E.style.height=35*d.length+"px"},h=e,d=[],p=35,g=0,f=n,m=ve.el({onClick:ve.handleClick,css:{position:"absolute",right:"280px",top:"500px",background:"#aaa",boxShadow:"1px 1px 3px rgba(0,0,0,0.3)",pointerEvents:"none",padding:"0",border:"1px solid #aaa",transition:"opacity 0.3s ease-out",userSelect:"none",colorScheme:"only light"}});ve.createCheckerDataUrl(4,(function(e){m.style.backgroundImage="url("+e+")"}));var v,y,x=ve.canvas(200,200);x.style.display="block",m.appendChild(x);var b=!1,w=h.getLayers(),C=w.length-1,S=document.createElement("div");S.style.marginRight="10px",S.style.marginBottom="10px",S.style.marginLeft="10px",S.style.marginTop="10px",S.style.cursor="default";var k=document.createElement("div");ve.css(k,{width:"250px",position:"relative"});var E=ve.el({});S.disableButtons=function(){},S.enableButtons=function(){};var M,I,T,R=document.createElement("button"),L=document.createElement("button"),A=document.createElement("button"),P=document.createElement("button"),O=document.createElement("button");S.appendChild((M=document.createElement("div"),setTimeout((function(){ve.makeUnfocusable(R),ve.makeUnfocusable(L),ve.makeUnfocusable(A),ve.makeUnfocusable(P),ve.makeUnfocusable(O),R.style.cssFloat="left",L.style.cssFloat="left",A.style.cssFloat="left",P.style.cssFloat="left",O.style.cssFloat="left",R.title=ze("layers-new"),L.title=ze("layers-duplicate"),P.title=ze("layers-remove"),A.title=ze("layers-merge"),O.title=ze("layers-rename-title"),R.style.paddingLeft="5px",R.style.paddingRight="3px",P.style.paddingLeft="5px",P.style.paddingRight="3px",L.style.paddingLeft="5px",L.style.paddingRight="3px",A.style.paddingLeft="5px",A.style.paddingRight="3px",O.style.height="30px",O.style.lineHeight="20px",R.innerHTML="<img src='"+t(at)+"' height='20'/>",L.innerHTML="<img src='"+t(ot)+"' height='20'/>",A.innerHTML="<img src='"+t(st)+"' height='20'/>",P.innerHTML="<img src='"+t(lt)+"' height='20'/>",O.innerHTML="<img src='"+t(ct)+"' height='20'/>",R.style.marginRight="5px",P.style.marginRight="5px",L.style.marginRight="5px",A.style.marginRight="5px",M.appendChild(R),M.appendChild(P),M.appendChild(L),M.appendChild(A),M.appendChild(O),M.appendChild(ve.el({css:{clear:"both"}}));var e=document.createElement("div");e.style.clear="both",e.style.height="10px",M.appendChild(e),R.onclick=function(){!1!==h.addLayer(C)&&((w=h.getLayers()).length===bt&&(R.disabled=!0,L.disabled=!0),P.disabled=!1,C+=1,o(),we.pause(!0),f(C),we.pause(!1))},L.onclick=function(){!1!==h.duplicateLayer(C)&&((w=h.getLayers()).length===bt&&(R.disabled=!0,L.disabled=!0),P.disabled=!1,C++,o(),we.pause(!0),f(C),we.pause(!1))},P.onclick=function(){d.length<=1||(h.removeLayer(C),C>0&&C--,w=h.getLayers(),o(),we.pause(!0),f(C),we.pause(!1),1===w.length&&(P.disabled=!0),w.length<bt&&(R.disabled=!1,L.disabled=!1))},A.onclick=function(){C<=0||function(e){var t=document.createElement("div");t.innerHTML=ze("layers-merge-description");var n=new et({optionArr:[{id:e.mixModeStr,label:Ct(e.mixModeStr)},{id:"source-in",label:"source-in"},{id:"source-out",label:"source-out"},{id:"source-atop",label:"source-atop"},{id:"destination-in",label:"destination-in"},{id:"destination-out",label:"destination-out"},{id:"destination-atop",label:"destination-atop"},{id:"xor",label:"xor"}],initId:e.mixModeStr,onChange:function(e){l()},isSmall:!0});n.getElement().style.marginTop="5px",t.appendChild(n.getElement());var i=ve.fitInto(e.topCanvas.width,e.topCanvas.height,200,200,1),a=ve.canvas(i.width,i.height);a.title=ze("preview");var o=document.createElement("div");o.innerHTML="<br/>",o.style.clear="both",t.appendChild(o),t.appendChild(a),ve.css(a,{display:"block",marginLeft:"auto",marginRight:"auto",colorScheme:"only light"}),a.style.boxShadow="0 0 3px rgba(0,0,0,0.5)",ve.createCheckerDataUrl(4,(function(e){a.style.backgroundImage="url("+e+")"}));var s=ve.copyCanvas(a);function l(){var t=a.getContext("2d");t.save(),t.clearRect(0,0,a.width,a.height),a.width>e.topCanvas.width&&(t.imageSmoothingEnabled=!1),t.drawImage(e.bottomCanvas,0,0,a.width,a.height),"as-alpha"===n.getValue()?(t.globalCompositeOperation="destination-in",t.globalAlpha=e.topOpacity,t.drawImage(s,0,0,a.width,a.height)):(t.globalCompositeOperation=n.getValue(),t.globalAlpha=e.topOpacity,t.drawImage(e.topCanvas,0,0,a.width,a.height)),t.restore()}s.getContext("2d").drawImage(e.topCanvas,0,0,s.width,s.height),ve.convertToAlphaChannelCanvas(s),l();var c=new ve.KeyListener({onDown:function(e){"right"===e&&n.next(),"left"===e&&n.previous()}});je({target:r,message:"<b>".concat(ze("layers-merge-modal-title"),"</b>"),div:t,buttons:["Ok","Cancel"],clickOnEnter:"Ok",callback:function(t){c.destroy(),n.destroy(),"Ok"===t&&e.callback(n.getValue())}})}({topCanvas:w[C].context.canvas,bottomCanvas:w[C-1].context.canvas,topOpacity:h.getLayer(C).opacity,mixModeStr:w[C].mixModeStr,callback:function(e){h.mergeLayers(C,C-1,e),w=h.getLayers(),C--,1===w.length&&(P.disabled=!0),w.length<bt&&(R.disabled=!1,L.disabled=!1),o(),we.pause(!0),f(C),we.pause(!1)}})},O.onclick=function(){a(C)}}),1),M)),I=ve.el({content:ze("layers-blending")+"&nbsp;",css:{fontSize:"15px"}}),T=new Xe({optionArr:["source-over",null,"darken","multiply","color-burn",null,"lighten","screen","color-dodge",null,"overlay","soft-light","hard-light",null,"difference","exclusion",null,"hue","saturation","color","luminosity"].map((function(e){return e?[e,Ct(e)]:null})),onChange:function(e){h.setMixMode(C,e),S.update(C)},css:{marginBottom:"10px"}}),I.appendChild(T.getElement()),S.appendChild(I),k.appendChild(E),S.appendChild(k);var D=0;return setInterval((function(){if("block"===S.style.display){var e=we.getState();if(e!==i){i=e;for(var t=0;t<d.length;t++)if(C===d[t].spot&&w[d[t].spot]){var n=d[t].thumb.getContext("2d");n.save(),n.clearRect(0,0,n.canvas.width,n.canvas.height),w[d[t].spot].context.canvas.width<d[t].thumb.width&&(n.imageSmoothingEnabled=!1),n.drawImage(w[d[t].spot].context.canvas,0,0,d[t].thumb.width,d[t].thumb.height),n.restore()}}}}),1),S.update=function(e){w=h.getLayers(),(e||0===e)&&(C=e),P.disabled=1===w.length,w.length===bt?(R.disabled=!0,L.disabled=!0):(R.disabled=!1,L.disabled=!1),setTimeout((function(){o()}),1)},S.getSelected=function(){return C},S.activateLayer=function(e){if(e<0||e>d.length-1)throw"invalid spotIndex "+e+", layerElArr.length "+d.length;C=e,T.setValue(w[C].mixModeStr);for(var t=0;t<d.length;t++)C===d[t].spot?(d[t].style.backgroundColor="rgb( 250, 250, 250)",d[t].label.style.color="#000",d[t].style.boxShadow="",d[t].style.border="1px solid var(--active-highlight-color)",d[t].opacitySlider.setActive(!0),d[t].isSelected=!0):(d[t].style.backgroundColor="rgb( 220, 220, 220)",d[t].label.style.color="#666",d[t].style.boxShadow="",d[t].style.border="1px solid rgb(158, 158, 158)",d[t].opacitySlider.setActive(!1),d[t].isSelected=!1);A.disabled=0===C},S.setUiState=function(e){"left"===""+e?ve.css(m,{left:"280px",right:""}):ve.css(m,{left:"",right:"280px"})},o(),S},klHistory:we,DecoyKlHistory:xe};a("cf2NR");s=a("5atYG");a("cf2NR");I=a("hDZfO"),T=a("3SSYo");var si=function(){"use strict";function e(n){I.default(this,e);var r=function(e){var t=6+(e.extraPadding?e.extraPadding:0),n=ve.el({className:"toolspace-row-button nohighlight",title:e.title,onClick:e.onClick,css:{padding:e.content?"":e.contain?t+"px 0":""}});if(e.content)n.appendChild(e.content);else{var r=ve.el({css:{backgroundImage:"url('"+e.image+"')",backgroundRepeat:"no-repeat",backgroundPosition:"center",backgroundSize:e.contain?"contain":"",height:"100%"}});r.style.pointerEvents="none",n.appendChild(r)}return n.pointerListener=new ve.PointerListener({target:n,onEnterLeave:function(e){e?ve.addClassName(n,"toolspace-row-button-hover"):ve.removeClassName(n,"toolspace-row-button-hover")}}),n},i=document.createElement("div");this.el=i,ve.css(i,{height:"36px",display:"flex",backgroundImage:"linear-gradient(to top, rgba(255, 255, 255, 0) 20%, rgba(255, 255, 255, 0.6) 100%)"});var a=r({onClick:n.onSubmit,title:ze("submit-title"),content:ve.el({content:ze("submit"),className:"toolspace-row-button__submit",css:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"}}),contain:!0});a.style.width="45px";var o=r({onClick:n.onHelp,title:ze("help"),image:t(Vt),contain:!0}),s=r({onClick:n.onLeftRight,title:ze("switch-ui-left-right"),image:t(ii),contain:!0});i.appendChild(a),i.appendChild(s),i.appendChild(o)}return T.default(e,[{key:"getElement",value:function(){return this.el}}]),e}(),li=60,ci=function(){var e,t=function(e,t,n){return Math.max(e,Math.min(t,n))},n=function(t){return{_:t,loadContentsOf:function(t){e=this._.gl,this._.loadContentsOf(t)},destroy:function(){e=this._.gl,this._.destroy()}}},r=function(e){return n(Z.fromElement(e))},i=function(t,n){var r=e.UNSIGNED_BYTE;if(e.getExtension("OES_texture_float")&&e.getExtension("OES_texture_float_linear")){var i=new Z(100,100,e.RGBA,e.FLOAT);try{i.drawTo((function(){r=e.FLOAT}))}catch(e){}i.destroy()}this._.texture&&this._.texture.destroy(),this._.spareTexture&&this._.spareTexture.destroy(),this.width=t,this.height=n,this._.texture=new Z(t,n,e.RGBA,r),this._.spareTexture=new Z(t,n,e.RGBA,r),this._.extraTexture=this._.extraTexture||new Z(0,0,e.RGBA,r),this._.flippedShader=this._.flippedShader||new q(null,"        uniform sampler2D texture;        varying vec2 texCoord;        void main() {            gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));        }    ","flippedShader"),this._.isInitialized=!0},a=function(e,t,n){return this._.isInitialized&&e._.width==this.width&&e._.height==this.height||i.call(this,t||e._.width,n||e._.height),e._.use(),this._.texture.drawTo((function(){q.getDefaultShader().drawRect()})),this},o=function(){return this._.texture.use(),this._.flippedShader.drawRect(),this},s=function(e,t,n,r){(n||this._.texture).use(),this._.spareTexture.drawTo((function(){e.uniforms(t).drawRect()})),this._.spareTexture.swapWith(r||this._.texture)},l=function(e){return e.parentNode.insertBefore(this,e),e.parentNode.removeChild(e),this},c=function(){var t=new Z(this._.texture.width,this._.texture.height,e.RGBA,e.UNSIGNED_BYTE);return this._.texture.use(),t.drawTo((function(){q.getDefaultShader().drawRect()})),n(t)},u=function(){var t=this._.texture.width,n=this._.texture.height,r=new Uint8Array(t*n*4);return this._.texture.drawTo((function(){e.readPixels(0,0,t,n,e.RGBA,e.UNSIGNED_BYTE,r)})),r},h=function(t){return function(){return e=this._.gl,t.apply(this,arguments)}},d=function(e,t,n,r,i,a,o,s){var l=n-i,c=r-a,u=o-i,h=s-a,d=e-n+i-o,p=t-r+a-s,g=l*h-u*c,f=(d*h-u*p)/g,m=(l*p-d*c)/g;return[n-e+f*n,r-t+f*r,f,o-e+m*o,s-t+m*s,m,e,t,1]},p=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=t*a*c-t*o*l-n*i*c+n*o*s+r*i*l-r*a*s;return[(a*c-o*l)/u,(r*l-n*c)/u,(n*o-r*a)/u,(o*s-i*c)/u,(t*c-r*s)/u,(r*i-t*o)/u,(i*l-a*s)/u,(n*s-t*l)/u,(t*a-n*i)/u]},g=function(e){var t=e.length;this.xa=[],this.ya=[],this.u=[],this.y2=[],e.sort((function(e,t){return e[0]-t[0]}));for(var n=0;n<t;n++)this.xa.push(e[n][0]),this.ya.push(e[n][1]);this.u[0]=0,this.y2[0]=0;for(n=1;n<t-1;++n){var r=this.xa[n+1]-this.xa[n-1],i=(this.xa[n]-this.xa[n-1])/r,a=i*this.y2[n-1]+2;this.y2[n]=(i-1)/a;var o=(this.ya[n+1]-this.ya[n])/(this.xa[n+1]-this.xa[n])-(this.ya[n]-this.ya[n-1])/(this.xa[n]-this.xa[n-1]);this.u[n]=(6*o/r-i*this.u[n-1])/a}this.y2[t-1]=0;for(n=t-2;n>=0;--n)this.y2[n]=this.y2[n]*this.y2[n+1]+this.u[n]},f=function(e,t){return new q(null,e+"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;    void main() {        vec2 coord = texCoord * texSize;        "+t+"        gl_FragColor = texture2D(texture, coord / texSize);        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);        if (coord != clampedCoord) {            /* fade to transparent if we are outside the image */            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));        }    }","warp")},m=function(n,r){return e.brightnessContrast=e.brightnessContrast||new q(null,"        uniform sampler2D texture;        uniform float brightness;        uniform float contrast;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.rgb += brightness;            if (contrast > 0.0) {                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;            } else {                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;            }            gl_FragColor = color;        }    ","brightnessContrast"),s.call(this,e.brightnessContrast,{brightness:t(-1,n,1),contrast:t(-1,r,1)}),this},v=function(e){for(var n=new g(e),r=[],i=0;i<256;i++)r.push(t(0,Math.floor(256*n.interpolate(i/255)),255));return r},y=function(t,n,r){t=v(t),1==arguments.length?n=r=t:(n=v(n),r=v(r));for(var i=[],a=0;a<256;a++)i.splice(i.length,0,t[a],n[a],r[a],255);return this._.extraTexture.initFromBytes(256,1,i),this._.extraTexture.use(1),e.curves=e.curves||new q(null,"        uniform sampler2D texture;        uniform sampler2D map;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.r = texture2D(map, vec2(color.r)).r;            color.g = texture2D(map, vec2(color.g)).g;            color.b = texture2D(map, vec2(color.b)).b;            gl_FragColor = color;        }    ","curves"),e.curves.textures({map:1}),s.call(this,e.curves,{}),this},x=function(t){e.denoise=e.denoise||new q(null,"        uniform sampler2D texture;        uniform float exponent;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec4 center = texture2D(texture, texCoord);            vec4 color = vec4(0.0);            float total = 0.0;            for (float x = -4.0; x <= 4.0; x += 1.0) {                for (float y = -4.0; y <= 4.0; y += 1.0) {                    vec4 sample = texture2D(texture, texCoord + vec2(x, y) / texSize);                    float weight = 1.0 - abs(dot(sample.rgb - center.rgb, vec3(0.25)));                    weight = pow(weight, exponent);                    color += sample * weight;                    total += weight;                }            }            gl_FragColor = color / total;        }    ","denoise");for(var n=0;n<2;n++)s.call(this,e.denoise,{exponent:Math.max(0,t),texSize:[this.width,this.height]});return this},b=function(n,r){return e.hueSaturation=e.hueSaturation||new q(null,"        uniform sampler2D texture;        uniform float hue;        uniform float saturation;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */            float angle = hue * 3.14159265;            float s = sin(angle), c = cos(angle);            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;            float len = length(color.rgb);            color.rgb = vec3(                dot(color.rgb, weights.xyz),                dot(color.rgb, weights.zxy),                dot(color.rgb, weights.yzx)            );                        /* saturation adjustment */            float average = (color.r + color.g + color.b) / 3.0;            if (saturation > 0.0) {                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));            } else {                color.rgb += (average - color.rgb) * (-saturation);            }                        gl_FragColor = color;        }    ","hueSaturation"),s.call(this,e.hueSaturation,{hue:t(-1,n,1),saturation:t(-1,r,1)}),this},w=function(n){return e.noise=e.noise||new q(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        float rand(vec2 co) {            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);        }        void main() {            vec4 color = texture2D(texture, texCoord);                        float diff = (rand(texCoord) - 0.5) * amount;            color.r += diff;            color.g += diff;            color.b += diff;                        gl_FragColor = color;        }    ","noise"),s.call(this,e.noise,{amount:t(0,n,1)}),this},C=function(n){return e.sepia=e.sepia||new q(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float r = color.r;            float g = color.g;            float b = color.b;                        color.r = min(1.0, (r * (1.0 - (0.607 * amount))) + (g * (0.769 * amount)) + (b * (0.189 * amount)));            color.g = min(1.0, (r * 0.349 * amount) + (g * (1.0 - (0.314 * amount))) + (b * 0.168 * amount));            color.b = min(1.0, (r * 0.272 * amount) + (g * 0.534 * amount) + (b * (1.0 - (0.869 * amount))));                        gl_FragColor = color;        }    ","sepia"),s.call(this,e.sepia,{amount:t(0,n,1)}),this},S=function(t,n){return e.unsharpMask=e.unsharpMask||new q(null,"        uniform sampler2D blurredTexture;        uniform sampler2D originalTexture;        uniform float strength;        uniform float threshold;        varying vec2 texCoord;        void main() {            vec4 blurred = texture2D(blurredTexture, texCoord);            vec4 original = texture2D(originalTexture, texCoord);            gl_FragColor = mix(blurred, original, 1.0 + strength);        }    ","unsharpMask"),this._.extraTexture.ensureFormat(this._.texture),this._.texture.use(),this._.extraTexture.drawTo((function(){q.getDefaultShader().drawRect()})),this._.extraTexture.use(1),this.triangleBlur(t),e.unsharpMask.textures({originalTexture:1}),s.call(this,e.unsharpMask,{strength:n}),this._.extraTexture.unuse(1),this},k=function(n){return e.vibrance=e.vibrance||new q(null,"        uniform sampler2D texture;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            float mx = max(color.r, max(color.g, color.b));            float amt = (mx - average) * (-amount * 3.0);            color.rgb = mix(color.rgb, vec3(mx), amt);            gl_FragColor = color;        }    ","vibrance"),s.call(this,e.vibrance,{amount:t(-1,n,1)}),this},E=function(n,r){return e.vignette=e.vignette||new q(null,"        uniform sampler2D texture;        uniform float size;        uniform float amount;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        float dist = distance(texCoord, vec2(0.5, 0.5));            color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount + size));                        gl_FragColor = color;        }    ","vignette"),s.call(this,e.vignette,{size:t(0,n,1),amount:t(0,r,1)}),this},M=function(n,r,i){e.lensBlurPrePass=e.lensBlurPrePass||new q(null,"        uniform sampler2D texture;        uniform float power;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color = pow(color, vec4(power));            gl_FragColor = vec4(color);        }    ","lensBlurPrePass");var a="        uniform sampler2D texture0;        uniform sampler2D texture1;        uniform vec2 delta0;        uniform vec2 delta1;        uniform float power;        varying vec2 texCoord;        "+J+"        vec4 sample(vec2 delta) {            /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(delta, 151.7182), 0.0);                        vec4 color = vec4(0.0);            float total = 0.0;            for (float t = 0.0; t <= 30.0; t++) {                float percent = (t + offset) / 30.0;                color += texture2D(texture0, texCoord + delta * percent);                total += 1.0;            }            return color / total;        }    ";e.lensBlur0=e.lensBlur0||new q(null,a+"        void main() {            gl_FragColor = sample(delta0);        }    ","lensBlur0"),e.lensBlur1=e.lensBlur1||new q(null,a+"        void main() {            gl_FragColor = (sample(delta0) + sample(delta1)) * 0.5;        }    ","lensBlur1"),e.lensBlur2=e.lensBlur2||new q(null,a+"        void main() {            vec4 color = (sample(delta0) + 2.0 * texture2D(texture1, texCoord)) / 3.0;            gl_FragColor = pow(color, vec4(power));        }    ","lensBlur2").textures({texture1:1});for(var o=[],l=0;l<3;l++){var c=i+l*Math.PI*2/3;o.push([n*Math.sin(c)/this.width,n*Math.cos(c)/this.height])}var u=Math.pow(10,t(-1,r,1));return s.call(this,e.lensBlurPrePass,{power:u}),this._.extraTexture.ensureFormat(this._.texture),s.call(this,e.lensBlur0,{delta0:o[0]},this._.texture,this._.extraTexture),s.call(this,e.lensBlur1,{delta0:o[1],delta1:o[2]},this._.extraTexture,this._.extraTexture),s.call(this,e.lensBlur0,{delta0:o[1]}),this._.extraTexture.use(1),s.call(this,e.lensBlur2,{power:1/u,delta0:o[2]}),this},I=function(t,n,r,i,a,o){e.tiltShift=e.tiltShift||new q(null,"        uniform sampler2D texture;        uniform float blurRadius;        uniform float gradientRadius;        uniform vec2 start;        uniform vec2 end;        uniform vec2 delta;        uniform vec2 texSize;        varying vec2 texCoord;        "+J+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;            for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","tiltShift");var l=r-t,c=i-n,u=Math.sqrt(l*l+c*c);return s.call(this,e.tiltShift,{blurRadius:a,gradientRadius:o,start:[t,n],end:[r,i],delta:[l/u,c/u],texSize:[this.width,this.height]}),s.call(this,e.tiltShift,{blurRadius:a,gradientRadius:o,start:[t,n],end:[r,i],delta:[-c/u,l/u],texSize:[this.width,this.height]}),this},T=function(t){return e.triangleBlur=e.triangleBlur||new q(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+J+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta * percent);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","triangleBlur"),s.call(this,e.triangleBlur,{delta:[t/this.width,0]}),s.call(this,e.triangleBlur,{delta:[0,t/this.height]}),this},R=function(t,n,r){return e.zoomBlur=e.zoomBlur||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        "+J+"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;            vec2 toCenter = center - texCoord * texSize;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = 0.0; t <= 40.0; t++) {                float percent = (t + offset) / 40.0;                float weight = 4.0 * (percent - percent * percent);                vec4 sample = texture2D(texture, texCoord + toCenter * percent * strength / texSize);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    ","zoomBlur"),s.call(this,e.zoomBlur,{center:[t,n],strength:r,texSize:[this.width,this.height]}),this},L=function(t,n,r,i){return e.colorHalftone=e.colorHalftone||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern(float angle) {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            vec3 cmy = 1.0 - color.rgb;            float k = min(cmy.x, min(cmy.y, cmy.z));            cmy = (cmy - k) / (1.0 - k);            cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(angle + 0.26179), pattern(angle + 1.30899), pattern(angle)), 0.0, 1.0);            k = clamp(k * 10.0 - 5.0 + pattern(angle + 0.78539), 0.0, 1.0);            gl_FragColor = vec4(1.0 - cmy - k, color.a);        }    ","colorHalftone"),s.call(this,e.colorHalftone,{center:[t,n],angle:r,scale:Math.PI/i,texSize:[this.width,this.height]}),this},A=function(t,n,r,i){return e.dotScreen=e.dotScreen||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float angle;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;                float pattern() {            float s = sin(angle), c = cos(angle);            vec2 tex = texCoord * texSize - center;            vec2 point = vec2(                c * tex.x - s * tex.y,                s * tex.x + c * tex.y            ) * scale;            return (sin(point.x) * sin(point.y)) * 4.0;        }                void main() {            vec4 color = texture2D(texture, texCoord);            float average = (color.r + color.g + color.b) / 3.0;            gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);        }    ","dotScreen"),s.call(this,e.dotScreen,{center:[t,n],angle:r,scale:Math.PI/i,texSize:[this.width,this.height]}),this},P=function(t){return e.edgeWork1=e.edgeWork1||new q(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+J+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec3 sample = texture2D(texture, texCoord + delta * percent).rgb;                float average = (sample.r + sample.g + sample.b) / 3.0;                color.x += average * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += average * weight;                    total.y += weight;                }            }            gl_FragColor = vec4(color / total, 0.0, 1.0);        }    ","edgeWork1"),e.edgeWork2=e.edgeWork2||new q(null,"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        "+J+"        void main() {            vec2 color = vec2(0.0);            vec2 total = vec2(0.0);                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec2 sample = texture2D(texture, texCoord + delta * percent).xy;                color.x += sample.x * weight;                total.x += weight;                if (abs(t) < 15.0) {                    weight = weight * 2.0 - 1.0;                    color.y += sample.y * weight;                    total.y += weight;                }            }            float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);            gl_FragColor = vec4(c, c, c, 1.0);        }    ","edgeWork2"),s.call(this,e.edgeWork1,{delta:[t/this.width,0]}),s.call(this,e.edgeWork2,{delta:[0,t/this.height]}),this},O=function(t,n,r){return e.hexagonalPixelate=e.hexagonalPixelate||new q(null,"        uniform sampler2D texture;        uniform vec2 center;        uniform float scale;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 tex = (texCoord * texSize - center) / scale;            tex.y /= 0.866025404;            tex.x -= tex.y * 0.5;                        vec2 a;            if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) a = vec2(floor(tex.x), floor(tex.y));            else a = vec2(ceil(tex.x), ceil(tex.y));            vec2 b = vec2(ceil(tex.x), floor(tex.y));            vec2 c = vec2(floor(tex.x), ceil(tex.y));                        vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);            vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);            vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);            vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);                        float alen = length(TEX - A);            float blen = length(TEX - B);            float clen = length(TEX - C);                        vec2 choice;            if (alen < blen) {                if (alen < clen) choice = a;                else choice = c;            } else {                if (blen < clen) choice = b;                else choice = c;            }                        choice.x += choice.y * 0.5;            choice.y *= 0.866025404;            choice *= scale / texSize;            gl_FragColor = texture2D(texture, choice + center / texSize);        }    ","hexagonalPixelate"),s.call(this,e.hexagonalPixelate,{center:[t,n],scale:r,texSize:[this.width,this.height]}),this},D=function(t){return e.ink=e.ink||new q(null,"        uniform sampler2D texture;        uniform float strength;        uniform vec2 texSize;        varying vec2 texCoord;        void main() {            vec2 dx = vec2(1.0 / texSize.x, 0.0);            vec2 dy = vec2(0.0, 1.0 / texSize.y);            vec4 color = texture2D(texture, texCoord);            float bigTotal = 0.0;            float smallTotal = 0.0;            vec3 bigAverage = vec3(0.0);            vec3 smallAverage = vec3(0.0);            for (float x = -2.0; x <= 2.0; x += 1.0) {                for (float y = -2.0; y <= 2.0; y += 1.0) {                    vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;                    bigAverage += sample;                    bigTotal += 1.0;                    if (abs(x) + abs(y) < 2.0) {                        smallAverage += sample;                        smallTotal += 1.0;                    }                }            }            vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);            gl_FragColor = vec4(color.rgb - dot(edge, edge) * strength * 100000.0, color.a);        }    ","ink"),s.call(this,e.ink,{strength:t*t*t*t*t,texSize:[this.width,this.height]}),this},B=function(n,r,i,a){return e.bulgePinch=e.bulgePinch||f("        uniform float radius;        uniform float strength;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = distance / radius;            if (strength > 0.0) {                coord *= mix(1.0, smoothstep(0.0, radius / distance, percent), strength * 0.75);            } else {                coord *= mix(1.0, pow(percent, 1.0 + strength * 0.75) * radius / distance, 1.0 - percent);            }        }        coord += center;    "),s.call(this,e.bulgePinch,{radius:i,strength:t(-1,a,1),center:[n,r],texSize:[this.width,this.height]}),this},z=function(t,n,r){if(e.matrixWarp=e.matrixWarp||f("        uniform mat3 matrix;        uniform bool useTextureSpace;    ","        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;        vec3 warp = matrix * vec3(coord, 1.0);        coord = warp.xy / warp.z;        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;    "),4==(t=Array.prototype.concat.apply([],t)).length)t=[t[0],t[1],0,t[2],t[3],0,0,0,1];else if(9!=t.length)throw"can only warp with 2x2 or 3x3 matrix";return s.call(this,e.matrixWarp,{matrix:n?p(t):t,texSize:[this.width,this.height],useTextureSpace:0|r}),this},j=function(e,t){var n=d.apply(null,t),r=d.apply(null,e),i=function(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}(p(n),r);return this.matrixWarp(i)},H=function(t,n,r,i){return e.swirl=e.swirl||f("        uniform float radius;        uniform float angle;        uniform vec2 center;    ","        coord -= center;        float distance = length(coord);        if (distance < radius) {            float percent = (radius - distance) / radius;            float theta = percent * percent * angle;            float s = sin(theta);            float c = cos(theta);            coord = vec2(                coord.x * c - coord.y * s,                coord.x * s + coord.y * c            );        }        coord += center;    "),s.call(this,e.swirl,{radius:r,center:[t,n],angle:i,texSize:[this.width,this.height]}),this},F=function(){return e.invert=e.invert||new q(null,"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        gl_FragColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, color.a);    }","invert"),s.call(this,e.invert,{texSize:[this.width,this.height]}),this},N=function(t,n){return e.toAlpha=e.toAlpha||new q(null,"    uniform bool isInverted;    uniform vec4 replace;    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        float alpha = (color.r + color.g + color.b) / 3.0;        if (isInverted) alpha = 1.0 - alpha;        alpha = min(color.a, alpha);        if (replace.a > 0.0) color = replace;        gl_FragColor = vec4(color.r, color.g, color.b, alpha);    }","toAlpha"),s.call(this,e.toAlpha,{isInverted:t?1:0,replace:n?[n.r/255,n.g/255,n.b/255,n.a]:[0,0,0,0],texSize:[this.width,this.height]}),this},_={};!function(){var t,n,r=function(){};try{document.createElement("canvas").getContext("experimental-webgl")}catch(e){}e&&-1===e.getSupportedExtensions().indexOf("OES_texture_float_linear")&&(function(e){if(!e.getExtension("OES_texture_float"))return!1;var t=e.createFramebuffer(),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,e.FLOAT,new Float32Array([2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]));var i=e.createProgram(),a=e.createShader(e.VERTEX_SHADER),o=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,"      attribute vec2 vertex;      void main() {        gl_Position = vec4(vertex, 0.0, 1.0);      }    "),e.shaderSource(o,"      uniform sampler2D texture;      void main() {        gl_FragColor = texture2D(texture, vec2(0.5));      }    "),e.compileShader(a),e.compileShader(o),e.attachShader(i,a),e.attachShader(i,o),e.linkProgram(i);var s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0]),e.STREAM_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);var l=new Uint8Array(4);return e.useProgram(i),e.viewport(0,0,1,1),e.bindTexture(e.TEXTURE_2D,r),e.drawArrays(e.POINTS,0,1),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,l),127===l[0]||128===l[0]}(e)&&(t=WebGLRenderingContext.prototype.getExtension,n=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getExtension=function(e){return"OES_texture_float_linear"===e?(void 0===(n=this).$OES_texture_float_linear$&&Object.defineProperty(n,"$OES_texture_float_linear$",{enumerable:!1,configurable:!1,writable:!1,value:new r}),n.$OES_texture_float_linear$):t.call(this,e);var n},WebGLRenderingContext.prototype.getSupportedExtensions=function(){var e=n.call(this);return-1===e.indexOf("OES_texture_float_linear")&&e.push("OES_texture_float_linear"),e}))}(),_.canvas=function(){var t=document.createElement("canvas");try{e=t.getContext("experimental-webgl",{premultipliedAlpha:!1})}catch(t){e=null}if(!e)throw"This browser does not support WebGL";return t._={gl:e,isInitialized:!1,texture:null,spareTexture:null,flippedShader:null},t.texture=h(r),t.draw=h(a),t.update=h(o),t.replace=h(l),t.contents=h(c),t.getPixelArray=h(u),t.brightnessContrast=h(m),t.hexagonalPixelate=h(O),t.hueSaturation=h(b),t.colorHalftone=h(L),t.triangleBlur=h(T),t.unsharpMask=h(S),t.perspective=h(j),t.matrixWarp=h(z),t.bulgePinch=h(B),t.tiltShift=h(I),t.dotScreen=h(A),t.edgeWork=h(P),t.lensBlur=h(M),t.zoomBlur=h(R),t.noise=h(w),t.denoise=h(x),t.curves=h(y),t.swirl=h(H),t.ink=h(D),t.vignette=h(E),t.vibrance=h(k),t.sepia=h(C),t.invert=h(F),t.toAlpha=h(N),t},_.splineInterpolate=v;var X,U,Y,W,V,G,K,q=(X=function(e){return"[object Number]"==Object.prototype.toString.call(e)},U=function(t,n,r){var i=e.createShader(t);if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw"compile error: "+r+" - "+e.getShaderInfoLog(i);return i},Y=function(t){var n=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,t);return null!==n&&0!==n.precision},W=function(t,n,r){if(this.vertexAttribute=null,this.texCoordAttribute=null,this.program=e.createProgram(),t=t||V,n=n||G,null===K&&(K=Y(e.HIGH_FLOAT)?"highp":Y(e.MEDIUM_FLOAT)?"mediump":"lowp"),n="precision "+K+" float;"+n,e.attachShader(this.program,U(e.VERTEX_SHADER,t,r+"(vertex)")),e.attachShader(this.program,U(e.FRAGMENT_SHADER,n,r+"(fragment)")),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))throw"link error: "+e.getProgramInfoLog(this.program)},V="    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }",G="    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }",K=null,W.prototype.destroy=function(){e.deleteProgram(this.program),this.program=null},W.prototype.uniforms=function(t){for(var n in e.useProgram(this.program),t)if(t.hasOwnProperty(n)){var r=e.getUniformLocation(this.program,n);if(null!==r){var i=t[n];if(a=i,"[object Array]"==Object.prototype.toString.call(a))switch(i.length){case 1:e.uniform1fv(r,new Float32Array(i));break;case 2:e.uniform2fv(r,new Float32Array(i));break;case 3:e.uniform3fv(r,new Float32Array(i));break;case 4:e.uniform4fv(r,new Float32Array(i));break;case 9:e.uniformMatrix3fv(r,!1,new Float32Array(i));break;case 16:e.uniformMatrix4fv(r,!1,new Float32Array(i));break;default:throw"dont't know how to load uniform \""+n+'" of length '+i.length}else{if(!X(i))throw'attempted to set uniform "'+n+'" to invalid value '+(i||"undefined").toString();e.uniform1f(r,i)}}}var a;return this},W.prototype.textures=function(t){for(var n in e.useProgram(this.program),t)t.hasOwnProperty(n)&&e.uniform1i(e.getUniformLocation(this.program,n),t[n]);return this},W.prototype.drawRect=function(t,n,r,i){var a,o=e.getParameter(e.VIEWPORT);n=n!==a?(n-o[1])/o[3]:0,t=t!==a?(t-o[0])/o[2]:0,r=r!==a?(r-o[0])/o[2]:1,i=i!==a?(i-o[1])/o[3]:1,null==e.vertexBuffer&&(e.vertexBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,e.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t,n,t,i,r,n,r,i]),e.STATIC_DRAW),null==e.texCoordBuffer&&(e.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,e.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),e.STATIC_DRAW)),null==this.vertexAttribute&&(this.vertexAttribute=e.getAttribLocation(this.program,"vertex"),e.enableVertexAttribArray(this.vertexAttribute)),null==this.texCoordAttribute&&(this.texCoordAttribute=e.getAttribLocation(this.program,"_texCoord"),e.enableVertexAttribArray(this.texCoordAttribute)),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,e.vertexBuffer),e.vertexAttribPointer(this.vertexAttribute,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,e.texCoordBuffer),e.vertexAttribPointer(this.texCoordAttribute,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)},W.getDefaultShader=function(){return e.defaultShader=e.defaultShader||new W,e.defaultShader},W);g.prototype.interpolate=function(e){for(var t=0,n=this.ya.length-1;n-t>1;){var r=n+t>>1;this.xa[r]>e?n=r:t=r}var i=this.xa[n]-this.xa[t],a=(this.xa[n]-e)/i,o=(e-this.xa[t])/i;return a*this.ya[t]+o*this.ya[n]+((a*a*a-a)*this.y2[t]+(o*o*o-o)*this.y2[n])*(i*i)/6};var Z=function(){var t=function(t,n,r,i){this.gl=e,this.id=e.createTexture(),this.width=t,this.height=n,this.format=r,this.type=i,e.bindTexture(e.TEXTURE_2D,this.id),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&n&&e.texImage2D(e.TEXTURE_2D,0,this.format,t,n,0,this.format,this.type,null)},n=function(e){null==r&&(r=document.createElement("canvas")),r.width=e.width,r.height=e.height;var t=r.getContext("2d");return t.clearRect(0,0,r.width,r.height),t};t.fromElement=function(n){var r=new t(0,0,e.RGBA,e.UNSIGNED_BYTE);return r.loadContentsOf(n),r},t.prototype.loadContentsOf=function(t){this.width=t.width||t.videoWidth,this.height=t.height||t.videoHeight,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,this.type,t)},t.prototype.initFromBytes=function(t,n,r){this.width=t,this.height=n,this.format=e.RGBA,this.type=e.UNSIGNED_BYTE,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,n,0,e.RGBA,this.type,new Uint8Array(r))},t.prototype.destroy=function(){e.deleteTexture(this.id),this.id=null},t.prototype.use=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,this.id)},t.prototype.unuse=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,null)},t.prototype.ensureFormat=function(t,n,r,i){if(1==arguments.length){var a=arguments[0];t=a.width,n=a.height,r=a.format,i=a.type}t==this.width&&n==this.height&&r==this.format&&i==this.type||(this.width=t,this.height=n,this.format=r,this.type=i,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,this.format,t,n,0,this.format,this.type,null))},t.prototype.drawTo=function(t){if(e.framebuffer=e.framebuffer||e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,e.framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.id,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)throw new Error("incomplete framebuffer");e.viewport(0,0,this.width,this.height),t(),e.bindFramebuffer(e.FRAMEBUFFER,null)};var r=null;return t.prototype.fillUsingCanvas=function(t){return t(n(this)),this.format=e.RGBA,this.type=e.UNSIGNED_BYTE,e.bindTexture(e.TEXTURE_2D,this.id),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),this},t.prototype.toImage=function(t){this.use(),q.getDefaultShader().drawRect();var i=this.width*this.height*4,a=new Uint8Array(i),o=n(this),s=o.createImageData(this.width,this.height);e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,a);for(var l=0;l<i;l++)s.data[l]=a[l];o.putImageData(s,0,0),t.src=r.toDataURL()},t.prototype.swapWith=function(e){var t;t=e.id,e.id=this.id,this.id=t,t=e.width,e.width=this.width,this.width=t,t=e.height,e.height=this.height,this.height=t,t=e.format,e.format=this.format,this.format=t},t}(),J="    float random(vec3 scale, float seed) {        /* use the fragment position for a different seed per-pixel */        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);    }";return _}(),ui=null;try{ui=ci.canvas()}catch(e){}function hi(){if(!ui||ui._.gl.isContextLost())try{ui=ci.canvas()}catch(e){}return ui}var di,pi={getDialog:function(e){var t=document.createElement("div"),n={element:t},r=e.context,i=e.canvas;if(!r||!i)return!1;var a=i.getLayers(),o=i.getLayerIndex(r.canvas),s=ve.fitInto(r.canvas.width,r.canvas.height,280,200,1),l=parseInt(""+s.width),c=parseInt(""+s.height),u=ve.canvas(l,c),h=u.getContext("2d");return h.save(),u.width>r.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(r.canvas,0,0,l,c),h.restore(),setTimeout((function(){var e=0,r=0;t.innerHTML=ze("filter-bright-contrast-description")+"<br/><br/>";var i=hi();if(i){var s=i.texture(u);i.draw(s).update();var h=new Ke({label:ze("filter-bright-contrast-brightness"),width:300,height:30,min:0,max:100,initValue:50*(e+1),eventResMs:li,onChange:function(t){e=t/50-1,i.draw(s).brightnessContrast(e,r).update(),m.render()}}),d=new Ke({label:ze("filter-bright-contrast-contrast"),width:300,height:30,min:0,max:100,initValue:50*(r+1),eventResMs:li,onChange:function(t){r=t/50-1,i.draw(s).brightnessContrast(e,r).update(),m.render()}});h.getElement().style.marginBottom="10px",t.appendChild(h.getElement()),t.appendChild(d.getElement());var p=document.createElement("div");ve.css(p,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var g=[],f=0;f<a.length;f++)g.push({image:f===o?i:a[f].context.canvas,opacity:a[f].opacity,mixModeStr:a[f].mixModeStr});var m=new Pt({width:parseInt(""+l),height:parseInt(""+c),layers:g}),v=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+l)+"px",height:parseInt(""+c)+"px"}});v.appendChild(m.getElement()),p.appendChild(v),t.appendChild(p);try{i.draw(s).brightnessContrast(e,r).update(),m.render()}catch(e){t.errorCallback(e)}n.destroy=function(){h.destroy(),d.destroy(),s.destroy()},n.getInput=function(){return n.destroy(),{brightness:e,contrast:r}}}}),1),n},apply:function(e){var t=e.context,n=e.input.brightness,r=e.input.contrast,i=e.history;if(!t||null===n||null===r||!i)return!1;i.pause(!0);var a=hi();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).brightnessContrast(n,r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),i.pause(!1),i.push({tool:["filter","glBrightnessContrast"],action:"apply",params:[{input:e.input}]}),!0}},gi={getDialog:function(e){var t=function(){d=parseInt(k.value),p=parseInt(E.value),g=parseInt(M.value),f=parseInt(I.value);var e=r.getWidth()+d+p,t=r.getHeight()+g+f;e<=0&&(m&&(d=-r.getWidth()-p+1,k.value=""+d),v&&(p=-r.getWidth()-d+1,E.value=""+p),e=1),e>b&&(m&&(d=-r.getWidth()-p+b,k.value=""+d),v&&(p=-r.getWidth()-d+b,E.value=""+p),e=b),t<=0&&(y&&(g=-r.getHeight()-f+1,M.value=""+g),x&&(f=-r.getHeight()-g+1,I.value=""+f),t=1),t>w&&(y&&(g=-r.getHeight()-f+w,M.value=""+g),x&&(f=-r.getHeight()-g+w,I.value=""+f),t=w),H.setTransform({x:-d,y:-g,width:e,height:t}),m=!1,v=!1,y=!1,x=!1},n=function(e){var t=ve.fitInto(e.width,e.height,260,180,1);h=t.width/e.width;var n=ve.centerWithin(340,220,t.width,t.height);i.style.width=r.getWidth()*h+"px",i.style.height=r.getHeight()*h+"px",j.style.left=n.x-e.x*h+"px",j.style.top=n.y-e.y*h+"px",d=parseInt(""+-e.x),g=parseInt(""+-e.y),p=parseInt(""+(e.x+e.width-r.getWidth())),f=parseInt(""+(e.y+e.height-r.getHeight())),k.value=""+d,M.value=""+g,E.value=""+p,I.value=""+f,ve.createCheckerDataUrl(parseInt(""+50*h),(function(e){B.style.background="url("+e+")",0!==A.a&&(i.style.background="url("+e+")")})),B.style.backgroundPosition=n.x+"px "+n.y+"px",H.setScale(h)},r=e.canvas;if(!r)return!1;var i=ve.canvas(),a=ve.fitInto(r.getWidth(),r.getHeight(),560,400,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=o/r.getWidth();i.width=o,i.height=s,i.style.display="block",i.getContext("2d").drawImage(r.getCompleteCanvas(l),0,0,o,s);var c=document.createElement("div"),u={element:c};c.innerHTML=ze("filter-crop-description")+"<br/><br/>";var h,d=0,p=0,g=0,f=0,m=!1,v=!1,y=!1,x=!1,b=e.maxWidth,w=e.maxHeight,C=ve.el({css:{lineHeight:"30px",height:"35px"}}),S=ve.el({css:{lineHeight:"30px",height:"35px"}});c.appendChild(C),c.appendChild(S);var k=Ne({init:0,type:"number",min:-r.getWidth(),max:b,css:{width:"75px",marginRight:"20px"},callback:function(e){m=!0,t()}}),E=Ne({init:0,type:"number",min:-r.getWidth(),max:b,css:{width:"75px"},callback:function(e){v=!0,t()}}),M=Ne({init:0,type:"number",min:-r.getHeight(),max:w,css:{width:"75px",marginRight:"20px"},callback:function(e){y=!0,t()}}),I=Ne({init:0,type:"number",min:-r.getHeight(),max:w,css:{width:"75px"},callback:function(e){x=!0,t()}}),T={display:"inline-block",width:"60px"};C.append(ve.el({content:ze("filter-crop-left")+":",css:T}),k,ve.el({content:ze("filter-crop-right")+":",css:T}),E),S.append(ve.el({content:ze("filter-crop-top")+":",css:T}),M,ve.el({content:ze("filter-crop-bottom")+":",css:T}),I);var R=!0,L=new Fe({init:!0,label:ze("filter-crop-rule-thirds"),allowTab:!0,callback:function(e){R=e,H.showThirds(R)}});c.appendChild(ve.el({css:{clear:"both"}}));var A={r:0,g:0,b:0,a:0},P=[{r:0,g:0,b:0,a:0},{r:255,g:255,b:255,a:1},{r:0,g:0,b:0,a:1}];P.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),P.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var O=new $e({label:ze("filter-crop-fill"),colorArr:P,onChange:function(e){A=e,function(e){var t;0===e.a?(t="rgba(0,0,0,0.5)",z.style.background="",i.style.background=""):(t=e.r+e.g+e.b<382.5?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)",z.style.background=ve.ColorConverter.toRgbStr(e),ve.createCheckerDataUrl(parseInt(""+50*h),(function(e){i.style.background="url("+e+")"}))),i.style.boxShadow="0 0 3px 1px "+t}(e)}}),D=ve.el({css:{display:"flex",justifyContent:"space-between"}});c.appendChild(D),D.appendChild(L.getElement()),D.appendChild(O.getElement());var B=ve.el({css:{width:"340px",marginTop:"10px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",position:"relative",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",userSelect:"none",colorScheme:"only light",touchAction:"none"}});B.oncontextmenu=function(){return!1};var z=ve.el({css:{position:"absolute",left:"0",top:"0",bottom:"0",right:"0"}});B.appendChild(z);var j=document.createElement("div");j.style.position="absolute",j.style.left="0px",j.style.top="0px",B.appendChild(j),ve.appendTextDiv(j,"").appendChild(i),i.style.boxShadow="0 0 3px 1px rgba(0,0,0,0.5)",i.style.position="absolute",i.style.left="0px",i.style.top="0px",c.appendChild(B);var H=new Nt({x:0,y:0,width:r.getWidth(),height:r.getHeight(),scale:h,callback:n,maxW:b,maxH:w});return n(H.getTransform()),j.appendChild(H.getElement()),u.destroy=function(){H.destroy(),L.destroy()},u.getInput=function(){return u.destroy(),{left:d,right:p,top:g,bottom:f,fillColor:0===A.a?null:A}},u},apply:function(e){var t=e.canvas,n=e.history;return!(!t||!n||isNaN(e.input.left)||isNaN(e.input.right)||isNaN(e.input.top)||isNaN(e.input.bottom))&&(n.pause(!0),t.resizeCanvas(e.input),n.pause(!1),n.push({tool:["filter","cropExtend"],action:"apply",params:[{input:JSON.parse(JSON.stringify(e.input))}]}),!0)}},fi={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=ve.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=ve.canvas(o,s),c=l.getContext("2d");c.save(),l.width>t.canvas.width&&(c.imageSmoothingEnabled=!1),c.drawImage(t.canvas,0,0,o,s),c.restore();var u,h=document.createElement("div"),d={element:h};return setTimeout((function(){t.canvas.width;h.innerHTML=ze("filter-curves-description")+"<br/><br/>";var e={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]},n=hi();if(n){var a,c=n.texture(l);n.draw(c).update();var p=new function(e){var t=document.createElement("div");t.oncontextmenu=function(){return!1},t.style.position="relative",t.style.marginBottom="10px";var n="All",r=e.curves;a=new et({optionArr:[{id:"All",label:ze("filter-curves-all")},{id:"Red",label:ze("red")},{id:"Green",label:ze("green")},{id:"Blue",label:ze("blue")}],initialId:"All",onChange:function(e){"All"===(n=e)&&(r={r:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],g:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]],b:[[0,0],[1/3,1/3],[2/3,2/3],[1,1]]});var t=r.r;"Green"===n&&(t=r.g),"Blue"===n&&(t=r.b),p.setPos(0,s-t[0][1]*s),g.setPos(t[1][0]*o,s-t[1][1]*s),f.setPos(t[2][0]*o,s-t[2][1]*s),m.setPos(o,s-t[3][1]*s),v()}}),t.appendChild(a.getElement());var i=document.createElement("div");ve.css(i,{position:"relative",marginTop:"10px",colorScheme:"only light"}),t.appendChild(i);var o=300,s=100,l=ve.canvas(o,s);ve.css(l,{background:"#c6c6c6",boxShadow:"0 0 0 1px rgba(0,0,0,0.3)"});var c=l.getContext("2d");function u(e){return Math.max(0,Math.min(1,e))}function h(e,t,n,r){var a=t,l=e,c=document.createElement("div");return ve.css(c,{position:"absolute",left:e-7+"px",top:t-7+"px",width:"14px",height:"14px",background:"#fff",cursor:"move",borderRadius:"14px",boxShadow:"inset 0 0 0 2px #000",userSelect:"none",touchAction:"none"}),c.pointerListener=new ve.PointerListener({target:c,maxPointers:1,onPointer:function(i){i.eventPreventDefault(),"pointerdown"===i.type&&(l=e,a=t),"left"===i.button&&"pointermove"===i.type&&(r||(l+=i.dX),e=Math.max(0,Math.min(o,l)),a+=i.dY,t=Math.max(0,Math.min(s,a)),ve.css(c,{left:e-7+"px",top:t-7+"px"}),n({x:e,y:t}))}}),i.appendChild(c),c.setPos=function(n,r){a=t=r,l=e=n,ve.css(c,{left:e-7+"px",top:t-7+"px"})},c}function d(e,t,i){"All"===n&&(r.r[e]=[u(t/o),u(1-i/s)],r.g[e]=[u(t/o),u(1-i/s)],r.b[e]=[u(t/o),u(1-i/s)]),"Red"===n&&(r.r[e]=[u(t/o),u(1-i/s)]),"Green"===n&&(r.g[e]=[u(t/o),u(1-i/s)]),"Blue"===n&&(r.b[e]=[u(t/o),u(1-i/s)])}i.appendChild(l);var p=h(0,s,(function(e){d(0,e.x,e.y),v()}),!0),g=h(o/3,s/3*2,(function(e){d(1,e.x,e.y),v()})),f=h(o/3*2,s/3,(function(e){d(2,e.x,e.y),v()})),m=h(o,0,(function(e){d(3,e.x,e.y),v()}),!0);function v(){l.width=l.width,c=l.getContext("2d");for(var t={r:[],g:[],b:[]},i=0;i<r.r.length;i++)t.r.push(r.r[i]),t.g.push(r.g[i]),t.b.push(r.b[i]);function a(e){c.beginPath();for(var t=new ve.SplineInterpolator(e),n=0;n<100;n++){var r=t.interpolate(n/100);r=Math.max(0,Math.min(1,r)),0===n?c.moveTo(n/100*o,s-r*s):c.lineTo(n/100*o,s-r*s)}c.stroke()}c.save(),"All"===n?(c.strokeStyle="black",a(t.r)):(c.globalAlpha=.5,c.strokeStyle="red",a(t.r),c.strokeStyle="green",a(t.g),c.strokeStyle="blue",a(t.b)),c.restore(),e.callback(t)}v(),this.getDiv=function(){return t},this.destroy=function(){p.pointerListener.destroy(),g.pointerListener.destroy(),f.pointerListener.destroy(),m.pointerListener.destroy()}}({curves:e,callback:function(t){e=t,function(){try{n.draw(c).curves(e.r,e.g,e.b).update(),u&&u.render()}catch(e){h.errorCallback(e)}}()}});h.appendChild(p.getDiv());var g=document.createElement("div");ve.css(g,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var f=[],m=0;m<r.length;m++)f.push({image:m===i?n:r[m].context.canvas,opacity:r[m].opacity,mixModeStr:r[m].mixModeStr});u=new Pt({width:parseInt(""+o),height:parseInt(""+s),layers:f});var v=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});v.appendChild(u.getElement()),g.appendChild(v),h.appendChild(g),d.destroy=function(){p.destroy(),c.destroy(),a.destroy()},d.getInput=function(){return d.destroy(),{curves:e}}}}),1),d},apply:function(e){var t=e.context,n=e.input.curves,r=e.history;if(!t||null===n||!r)return!1;r.pause(!0);var i=hi();if(!i)return!1;var a=i.texture(t.canvas);return i.draw(a).curves(n.r,n.g,n.b).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(i,0,0),a.destroy(),r.pause(!1),r.push({tool:["filter","glCurves"],action:"apply",params:[{input:e.input}]}),!0}};di=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("b8E1f");var mi,vi={getDialog:function(e){var n=function(){var e=w.image.getContext("2d");e.save(),e.clearRect(0,0,w.image.width,w.image.height),g&&(d&&(e.translate(w.image.width,0),e.scale(-1,1)),p&&(e.translate(0,w.image.height),e.scale(1,-1)));for(var t=0;t<a.length;t++)e.save(),g||o!==t||(d&&(e.translate(w.image.width,0),e.scale(-1,1)),p&&(e.translate(0,w.image.height),e.scale(1,-1))),e.canvas.width>a[t].context.canvas.width&&(e.imageSmoothingEnabled=!1),e.globalAlpha=a[t].opacity,e.globalCompositeOperation=a[t].mixModeStr,e.drawImage(a[t].context.canvas,0,0,w.image.width,w.image.height),e.restore();C.render(),e.restore()},r=e.context,i=e.canvas;if(!r||!i)return!1;var a=i.getLayers(),o=i.getLayerIndex(r.canvas),s=ve.fitInto(r.canvas.width,r.canvas.height,280,200,1),l=parseInt(""+s.width),c=parseInt(""+s.height),u=document.createElement("div"),h={element:u},d=!0,p=!1,g=!0;u.innerHTML=ze("filter-flip-description")+"<br/><br/>";var f=new Fe({init:d,label:ze("filter-flip-horizontal")+" ",allowTab:!0,callback:function(e){d=e,n()},css:{marginBottom:"10px"}}),m=new Fe({init:p,label:ze("filter-flip-vertical")+" ",allowTab:!0,callback:function(e){p=e,n()},css:{marginBottom:"10px"}});u.appendChild(f.getElement()),u.appendChild(m.getElement());var v=document.createElement("div");ve.setEventListener(v,"onpointerdown",(function(){return!1})),v.textContent=ze("filter-flip-image"),v.style.width="150px",v.style.height="30px",v.style.paddingTop="10px",v.style.textAlign="center",v.style.cssFloat="left",v.style.paddingBottom="0px",v.style.borderTopLeftRadius="10px",v.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",v.style.background="url("+t(di)+") no-repeat 12px 16px",v.style.backgroundSize="8%",v.style.backgroundColor="#9e9e9e";var y=document.createElement("div");ve.setEventListener(y,"onpointerdown",(function(){return!1})),y.textContent=ze("filter-flip-layer"),y.style.width="150px",y.style.height="30px",y.style.paddingTop="10px",y.style.textAlign="center",y.style.cssFloat="left",y.style.paddingBottom="0px",y.style.borderTopRightRadius="10px",y.style.cursor="pointer",y.style.backgroundColor="rgba(0, 0, 0, 0.1)",y.style.backgroundSize="8%",ve.setEventListener(v,"onpointerover",(function(){!1===g&&(v.style.backgroundColor="#ccc")})),ve.setEventListener(v,"onpointerout",(function(){!1===g&&(v.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),ve.setEventListener(y,"onpointerover",(function(){!0===g&&(y.style.backgroundColor="#ccc")})),ve.setEventListener(y,"onpointerout",(function(){!0===g&&(y.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),v.onclick=function(){g=!0,y.style.background="",y.style.backgroundColor="rgba(0, 0, 0, 0.1)",y.style.boxShadow="",y.style.cursor="pointer",v.style.background="url("+t(di)+") no-repeat 12px 16px",v.style.backgroundSize="8%",v.style.backgroundColor="#9e9e9e",v.style.cursor="default",v.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()},y.onclick=function(){g=!1,v.style.background="",v.style.backgroundColor="rgba(0, 0, 0, 0.1)",v.style.boxShadow="",v.style.cursor="pointer",y.style.background="url("+t(di)+") no-repeat 12px 16px",y.style.backgroundSize="8%",y.style.backgroundColor="#9e9e9e",y.style.cursor="default",y.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",n()};var x=document.createElement("div");x.appendChild(v),x.appendChild(y),u.appendChild(x);var b=document.createElement("div");ve.css(b,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});var w={image:ve.canvas(Math.round(l),Math.round(c)),opacity:1,mixModeStr:"source-over"},C=new Pt({width:Math.round(l),height:Math.round(c),layers:[w]}),S=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+l)+"px",height:parseInt(""+c)+"px"}});return S.appendChild(C.getElement()),b.appendChild(S),setTimeout(n,0),u.appendChild(b),h.destroy=function(){f.destroy(),m.destroy()},h.getInput=function(){return h.destroy(),{horizontal:d,vertical:p,flipCanvas:g}},h},apply:function(e){var t=e.context,n=e.canvas,r=e.history,i=e.input.horizontal,a=e.input.vertical,o=e.input.flipCanvas;return!!(t&&n&&r)&&(r.pause(!0),n.flip(i,a,o?null:n.getLayerIndex(t.canvas)),r.pause(!1),r.push({tool:["filter","flip"],action:"apply",params:[{input:e.input}]}),!0)}},yi={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=ve.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=ve.canvas(o,s),c=l.getContext("2d");c.save(),l.width>t.canvas.width&&(c.imageSmoothingEnabled=!1),c.drawImage(t.canvas,0,0,o,s),c.restore();var u=document.createElement("div"),h={element:u};return setTimeout((function(){var e=0,t=0;u.innerHTML=ze("filter-hue-sat-description")+"<br/><br/>";var n=hi();if(n){var a=n.texture(l);n.draw(a).update();var c=new Ke({label:ze("filter-hue-sat-hue"),width:300,height:30,min:-100,max:100,initValue:100*e,eventResMs:li,onChange:function(r){e=r/100,n.draw(a).hueSaturation(e,t).update(),m.render()}}),d=new Ke({label:ze("filter-hue-sat-saturation"),width:300,height:30,min:0,max:100,initValue:50*(t+1),eventResMs:li,onChange:function(r){t=r/50-1,n.draw(a).hueSaturation(e,t).update(),m.render()}});c.getElement().style.marginBottom="10px",u.appendChild(c.getElement()),u.appendChild(d.getElement());var p=document.createElement("div");ve.css(p,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var g=[],f=0;f<r.length;f++)g.push({image:f===i?n:r[f].context.canvas,opacity:r[f].opacity,mixModeStr:r[f].mixModeStr});var m=new Pt({width:parseInt(""+o),height:parseInt(""+s),layers:g}),v=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});v.appendChild(m.getElement()),p.appendChild(v),u.appendChild(p);try{n.draw(a).hueSaturation(e,t).update(),m.render()}catch(e){u.errorCallback(e)}h.destroy=function(){c.destroy(),d.destroy(),a.destroy()},h.getInput=function(){return h.destroy(),{hue:e,Saturation:t}}}}),1),h},apply:function(e){var t=e.context,n=e.input.hue,r=e.history,i=e.input.Saturation;if(!t||null===n||null===i||!r)return!1;r.pause(!0);var a=hi();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).hueSaturation(n,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),r.pause(!1),r.push({tool:["filter","glHueSaturation"],action:"apply",params:[{input:e.input}]}),!0}},xi={apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var r=hi();if(!r)return!1;var i=r.texture(t.canvas);return r.draw(i).invert().update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(r,0,0),i.destroy(),n.pause(!1),n.push({tool:["filter","invert"],action:"apply",params:[{input:e.input}]}),!0}},bi={getDialog:function(e){var n=e.context,r=e.canvas;if(!n||!r)return!1;var i=e.bbox.width<550,a=r.getLayers(),o=r.getLayerIndex(n.canvas),s=ve.fitInto(n.canvas.width,n.canvas.height,i?280:490,i?200:240,1),l=parseInt(""+s.width),c=parseInt(""+s.height),u=Math.min(l,n.canvas.width),h=Math.min(c,n.canvas.height),d=ve.canvas(u,h),p=d.getContext("2d");p.save(),u>n.canvas.width&&(p.imageSmoothingEnabled=!1),p.drawImage(n.canvas,0,0,u,h),p.restore();var g=l/n.canvas.width,f=document.createElement("div"),m={element:f};i||(m.width=500);var v=[];return setTimeout((function(){f.innerHTML=ze("filter-perspective-description")+"<br/><br/>";var e=hi();if(e){var n,r,s,p,y,x,b,w,C=e.texture(d);e.draw(C).update(),n=D(0,0,B),r=D(l,0,B),s=D(l,c,B),p=D(0,c,B),y=D(0,0),x=D(l,0),b=D(l,c),w=D(0,c);var S=!1,k=document.createElement("div");ve.setEventListener(k,"onpointerdown",(function(){return!1})),k.textContent=ze("filter-perspective-before"),k.style.width="150px",k.style.height="30px",k.style.marginLeft=i?"0":"100px",k.style.paddingTop="10px",k.style.textAlign="center",k.style.cssFloat="left",k.style.paddingBottom="0px",k.style.borderTopLeftRadius="10px",k.style.cursor="pointer",k.style.backgroundColor="rgba(0, 0, 0, 0.1)",k.style.backgroundSize="8%";var E=document.createElement("div");ve.setEventListener(E,"onpointerdown",(function(){return!1})),E.textContent=ze("filter-perspective-after"),E.style.width="150px",E.style.height="30px",E.style.paddingTop="10px",E.style.textAlign="center",E.style.cssFloat="left",E.style.paddingBottom="0px",E.style.borderTopRightRadius="10px",E.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",E.style.background="url("+t(di)+") no-repeat 12px 16px",E.style.backgroundSize="8%",E.style.backgroundColor="#9e9e9e",ve.setEventListener(k,"onpointerover",(function(){!1===S&&(k.style.backgroundColor="#ccc")})),ve.setEventListener(k,"onpointerout",(function(){!1===S&&(k.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),ve.setEventListener(E,"onpointerover",(function(){!0===S&&(E.style.backgroundColor="#ccc")})),ve.setEventListener(E,"onpointerout",(function(){!0===S&&(E.style.backgroundColor="rgba(0, 0, 0, 0.1)")})),k.onclick=function(){k.style.background="url("+t(di)+") no-repeat 12px 16px",k.style.backgroundSize="8%",k.style.backgroundColor="#9e9e9e",k.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",k.style.cursor="default",E.style.background="",E.style.backgroundColor="rgba(0, 0, 0, 0.1)",E.style.boxShadow="",E.style.cursor="pointer",y.style.display="none",x.style.display="none",b.style.display="none",w.style.display="none",n.style.display="block",r.style.display="block",s.style.display="block",p.style.display="block",n.copy(y),r.copy(x),s.copy(b),p.copy(w),S=!0,O()},E.onclick=function(){S=!1,E.style.background="url("+t(di)+") no-repeat 12px 16px",E.style.backgroundSize="8%",E.style.backgroundColor="#9e9e9e",E.style.boxShadow="inset 0px 5px 10px rgba(0,0,0,0.5)",E.style.cursor="default",k.style.background="",k.style.backgroundColor="rgba(0, 0, 0, 0.1)",k.style.boxShadow="",k.style.cursor="pointer",n.style.display="none",r.style.display="none",s.style.display="none",p.style.display="none",y.style.display="block",x.style.display="block",b.style.display="block",w.style.display="block",y.copy(n),x.copy(r),b.copy(s),w.copy(p)};var M=document.createElement("div");M.appendChild(k),M.appendChild(E),f.appendChild(M);var I=document.createElement("div");I.oncontextmenu=function(){return!1},ve.css(I,{width:i?"340px":"540px",marginLeft:"-20px",height:i?"260px":"300px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var T=[],R=0;R<a.length;R++){var L=R===o?e:a[R].context.canvas;T.push({image:L,opacity:a[R].opacity,mixModeStr:a[R].mixModeStr})}var A=new Pt({width:parseInt(""+l),height:parseInt(""+c),layers:T}),P=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+l)+"px",height:parseInt(""+c)+"px"}});P.appendChild(A.getElement()),I.appendChild(P),P.appendChild(y),P.appendChild(x),P.appendChild(b),P.appendChild(w),n.style.display="none",r.style.display="none",s.style.display="none",p.style.display="none",P.appendChild(n),P.appendChild(r),P.appendChild(s),P.appendChild(p),f.appendChild(I),O(),m.destroy=function(){for(var e=0;e<v.length;e++)v[e].destroy();C.destroy()},m.getInput=function(){return m.destroy(),{before:[n.x/g,n.y/g,r.x/g,r.y/g,s.x/g,s.y/g,p.x/g,p.y/g],after:[y.x/g,y.y/g,x.x/g,x.y/g,b.x/g,b.y/g,w.x/g,w.y/g]}}}function O(){try{e.draw(C).perspective([n.x,n.y,r.x,r.y,s.x,s.y,p.x,p.y].map((function(e,t){return t%2==0?e/l*u:e/c*h})),[y.x,y.y,x.x,x.y,b.x,b.y,w.x,w.y].map((function(e,t){return t%2==0?e/l*u:e/c*h}))).update(),A.render()}catch(e){f.errorCallback(e)}}function D(e,t,n){var r=document.createElement("div");r.x=e,r.y=t,ve.css(r,{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:r.x-7+"px",top:r.y-7+"px",userSelect:"none",touchAction:"none"});var i=new ve.PointerListener({target:r,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(r.x+=e.dX,r.y+=e.dY,r.style.left=r.x-7+"px",r.style.top=r.y-7+"px",n&&n(),O())}});return r.copy=function(e){r.x=e.x,r.y=e.y,r.style.left=r.x-7+"px",r.style.top=r.y-7+"px"},v.push(i),r}function B(){y.copy(n),x.copy(r),b.copy(s),w.copy(p)}}),1),m},apply:function(e){var t=e.context,n=e.history,r=e.input.before,i=e.input.after;if(!(t&&r&&i&&n))return!1;n.pause(!0);var a=hi();if(!a)return!1;var o=a.texture(t.canvas);t.canvas.width,t.canvas.height;return a.draw(o).perspective(r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","glPerspective"],action:"apply",params:[{input:e.input}]}),!0}};mi=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("bkm0n");var wi={getDialog:function(e){var n=function(){if(0===v.value.length&&w||0===y.value.length&&b)return b=!1,void(w=!1);if(v.value=""+Math.max(1,parseInt(v.value)),y.value=""+Math.max(1,parseInt(y.value)),S&&(b&&(v.value=""+parseInt(""+parseInt(y.value)*C)),w&&(y.value=""+parseInt(""+parseInt(v.value)/C)),parseInt(v.value)>p||parseInt(y.value)>g)){var e=ve.fitInto(parseInt(v.value),parseInt(y.value),p,g,1);v.value=""+parseInt(""+e.width),y.value=""+parseInt(""+e.height)}parseInt(v.value)>p&&(v.value=""+p),parseInt(y.value)>g&&(y.value=""+g),b=!1,w=!1,h=parseInt(v.value),d=parseInt(y.value);var t=ve.fitInto(h,d,280,200,1),n=parseInt(""+t.width),i=parseInt(""+t.height);s=n/h;var a=ve.centerWithin(340,220,n,i);"smooth"===E.getValue()?(I.style.imageRendering=s>1?"pixelated":"",I.width=r.getWidth(),I.height=r.getHeight(),T.save(),T.imageSmoothingQuality="high",T.drawImage(l,0,0),ve.resizeCanvas(I,h,d),T.restore()):(I.style.imageRendering="pixelated",I.width=h,I.height=d,T.save(),T.imageSmoothingEnabled=!1,T.drawImage(l,0,0,I.width,I.height),T.restore()),I.style.width=Math.max(1,n)+"px",I.style.height=Math.max(1,i)+"px",L.style.left=a.x+"px",L.style.top=a.y+"px",L.style.width=Math.max(1,n)+"px",L.style.height=Math.max(1,i)+"px"},r=e.canvas;if(!r)return!1;var i=ve.fitInto(r.getWidth(),r.getHeight(),280,200,1),a=parseInt(""+i.width),o=parseInt(""+i.height),s=a/r.getWidth(),l=r.getCompleteCanvas(1),c=document.createElement("div"),u={element:c},h=r.getWidth(),d=r.getHeight();c.innerHTML=ze("filter-resize-description")+"<br/><br/>";var p=e.maxWidth,g=e.maxHeight,f=ve.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),m=ve.el({css:{width:"150px",height:"35px",lineHeight:"30px"}}),v=ve.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+p,value:""+r.getWidth()}}),y=ve.el({tagName:"input",css:{cssFloat:"right",width:"90px"},custom:{type:"number",min:"1",max:""+g,value:""+r.getHeight()}});v.onclick=function(){this.focus(),w=!0,n()},y.onclick=function(){this.focus(),b=!0,n()},v.onchange=function(){w=!0,n()},y.onchange=function(){b=!0,n()},f.append(ze("width")+": ",v),m.append(ze("height")+": ",y);var x=ve.el({css:{background:"url("+t(mi)+") no-repeat 140px 5px",backgroundSize:"50px 52px"}});x.append(f,m),c.appendChild(x);var b=!1,w=!1,C=r.getWidth()/r.getHeight(),S=!0,k=new Fe({init:!0,label:ze("constrain-proportions"),allowTab:!0,callback:function(e){(S=e)?(v.value=""+r.getWidth(),y.value=""+r.getHeight(),x.style.background="url("+t(mi)+") no-repeat 140px 5px",x.style.backgroundSize="50px 52px",n()):x.style.background=""}});c.appendChild(ve.el({css:{clear:"both"}}));var E=new Xe({isFocusable:!0,optionArr:[["smooth",ze("algorithm-smooth")],["pixelated",ze("algorithm-pixelated")]],title:ze("scaling-algorithm"),initValue:"smooth",onChange:function(){n()}}),M=ve.el({parent:c,css:{display:"flex",justifyContent:"space-between"}});M.appendChild(k.getElement()),M.appendChild(E.getElement());var I=ve.canvas(a,o);I.style.imageRendering="pixelated";var T=I.getContext("2d"),R=document.createElement("div");ve.css(R,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",position:"relative",userSelect:"none",colorScheme:"only light"});var L=ve.appendTextDiv(R,"");return L.appendChild(I),L.style.width=a+"px",L.style.height=o+"px",L.style.position="absolute",L.style.overflow="hidden",L.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",L.style.overflow="hidden",ve.createCheckerDataUrl(8,(function(e){R.style.background="url("+e+")"})),c.appendChild(R),n(),u.destroy=function(){k.destroy()},u.getInput=function(){return u.destroy(),{width:h,height:d,algorithm:E.getValue()}},u},apply:function(e){var t=e.canvas,n=e.history,r=e.input.width,i=e.input.height,a=e.input.algorithm;return!(!t||!n)&&(n.pause(!0),t.resize(r,i,a),n.pause(!1),n.push({tool:["filter","resize"],action:"apply",params:[{input:e.input}]}),!0)}},Ci={getDialog:function(e){var t=function(){if(f.style.WebkitTransform="rotate("+u+"deg)",f.style.MozTransform="rotate("+u+"deg)",f.style.OTransform="rotate("+u+"deg)",f.style.msTransform="rotate("+u+"deg)",90===Math.abs(u%180)){var e=ve.fitInto(a,i,280,200,1),t=parseInt(""+e.height)/i;f.style.WebkitTransform="rotate("+u+"deg) scale("+t+")",f.style.MozTransform="rotate("+u+"deg) scale("+t+")",f.style.OTransform="rotate("+u+"deg) scale("+t+")",f.style.msTransform="rotate("+u+"deg) scale("+t+")"}},n=e.canvas;if(!n)return!1;var r=ve.fitInto(n.getWidth(),n.getHeight(),280,200,1),i=parseInt(""+r.width),a=parseInt(""+r.height),o=i/n.getWidth(),s=ve.canvas(i,a);s.style.display="block",s.getContext("2d").drawImage(n.getCompleteCanvas(o),0,0,i,a);var l=document.createElement("div"),c={element:l},u=0;l.innerHTML=ze("filter-rotate-description")+"<br/><br/>";var h=document.createElement("button");h.innerHTML="<span style='font-size: 1.3em'></span> 90";var d=document.createElement("button");d.innerHTML="<span style='font-size: 1.3em'></span> 90",d.style.marginRight="5px",h.onclick=function(){u+=90,t()},d.onclick=function(){u-=90,t()},l.appendChild(d),l.appendChild(h);var p=document.createElement("div");ve.css(p,{width:"340px",marginLeft:"-20px",height:"220px",display:"table",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",colorScheme:"only light"});var g=document.createElement("div");g.style.display="table-cell",g.style.verticalAlign="middle";var f=ve.appendTextDiv(g,"");return f.appendChild(s),p.appendChild(g),f.style.width=i+"px",f.style.height=a+"px",f.style.marginLeft="auto",f.style.marginRight="auto",f.style.boxShadow="0 0 5px rgba(0,0,0,0.8)",f.style.overflow="hidden",ve.createCheckerDataUrl(4,(function(e){f.style.background="url("+e+")"})),f.style.transition="all 0.2s ease-out",l.appendChild(p),t(),c.getInput=function(){return{deg:u}},c},apply:function(e){var t=e.canvas,n=e.history,r=e.input.deg;return!(!t||!n)&&(n.pause(!0),t.rotate(r),n.pause(!1),n.push({tool:["filter","rotate"],action:"apply",params:[{input:e.input}]}),!0)}},Si={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=ve.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Math.min(o,t.canvas.width),c=Math.min(s,t.canvas.height),u=ve.canvas(l,c),h=u.getContext("2d");h.save(),l>t.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(t.canvas,0,0,l,c),h.restore();var d=l/t.canvas.width,p=o/t.canvas.width,g=document.createElement("div"),f={element:g},m=[];return setTimeout((function(){var e=20,t=200;g.innerHTML=ze("filter-tilt-shift-description")+"<br/><br/>";var n=hi();if(n){var a,l,c=n.texture(u);n.draw(c).update(),a=k(parseInt(""+o/6),parseInt(""+s/2)),l=k(parseInt(""+(o-o/6)),parseInt(""+(s-s/3)));var h=new Ke({label:ze("filter-tilt-shift-blur"),width:300,height:30,min:0,max:200,initValue:e,eventResMs:li,onChange:function(t){e=t,S()}});h.getElement().style.marginBottom="10px",g.appendChild(h.getElement());var v=new Ke({label:ze("filter-tilt-shift-gradient"),width:300,height:30,min:0,max:1e3,initValue:t,eventResMs:li,onChange:function(e){t=e,S()}});g.appendChild(v.getElement());var y=document.createElement("div");y.oncontextmenu=function(){return!1},ve.css(y,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var x=[],b=0;b<r.length;b++)x.push({image:b===i?n:r[b].context.canvas,opacity:r[b].opacity,mixModeStr:r[b].mixModeStr});var w=new Pt({width:parseInt(""+o),height:parseInt(""+s),layers:x}),C=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});C.appendChild(w.getElement()),y.appendChild(C),C.appendChild(a),C.appendChild(l),g.appendChild(y),S(),f.destroy=function(){for(var e=0;e<m.length;e++)m[e].destroy();h.destroy(),v.destroy(),c.destroy()},f.getInput=function(){return f.destroy(),{a:{x:a.x/p,y:a.y/p},b:{x:l.x/p,y:l.y/p},blur:e,gradient:t}}}function S(){try{n.draw(c).tiltShift(a.x/p*d,a.y/p*d,l.x/p*d,l.y/p*d,e*d,t*d).update(),w.render()}catch(e){g.errorCallback(e)}}function k(e,t){var n=ve.el({css:{width:"14px",height:"14px",backgroundColor:"#fff",boxShadow:"inset 0 0 0 2px #000",borderRadius:"14px",position:"absolute",cursor:"move",left:e-7+"px",top:t-7+"px",userSelect:"none",touchAction:"none"}});n.x=e,n.y=t;var r=new ve.PointerListener({target:n,maxPointers:1,onPointer:function(e){e.eventPreventDefault(),"left"===e.button&&"pointermove"===e.type&&(n.x+=e.dX,n.y+=e.dY,n.style.left=n.x-7+"px",n.style.top=n.y-7+"px",S())}});return m.push(r),n}}),1),f},apply:function(e){var t=e.context,n=e.history,r=e.input.a,i=e.input.b,a=e.input.blur,o=e.input.gradient;if(!t||!n)return!1;n.pause(!0);var s=hi();if(!s)return!1;var l=s.texture(t.canvas);return s.draw(l).tiltShift(r.x,r.y,i.x,i.y,a,o).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(s,0,0),l.destroy(),n.pause(!1),n.push({tool:["filter","glTiltShift"],action:"apply",params:[{input:e.input}]}),!0}},ki={getDialog:function(e){var t,n=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(o){var t=o.getTransform();if(JSON.stringify(t)!==$||e){$=JSON.stringify(t),f<1&&(t.x*=f,t.y*=f,t.width*=f,t.height*=f);var n=K[c].image,r=n.getContext("2d");r.save(),r.clearRect(0,0,n.width,n.height),ve.drawTransformedImageWithBounds(r,l[c].context.canvas,t,m,"pixelated"===V.getValue()||ve.testShouldPixelate(t,t.width/w.width,t.height/w.height)),r.restore(),J.render()}}},r=function(){o.setPos({x:parseInt(R.value)+w.x,y:parseInt(T.value)+w.y}),o.setAngleDeg(parseInt(L.value)),n()},i=e.context,a=e.canvas;if(!i||!a)return!1;var o,s=e.bbox.width<550,l=a.getLayers(),c=a.getLayerIndex(i.canvas),u=ve.fitInto(i.canvas.width,i.canvas.height,s?280:490,s?200:240,1),h=parseInt(""+u.width),d=parseInt(""+u.height),p=Math.min(h,i.canvas.width),g=Math.min(d,i.canvas.height),f=h/i.canvas.width,m={x:0,y:0,width:0,height:0},v={x1:null,y1:null,x2:null,y2:null},y=i.getImageData(0,0,i.canvas.width,i.canvas.height);if(y.data[3]>0&&y.data[y.data.length-1]>0)v.x1=0,v.y1=0,v.x2=i.canvas.width-1,v.y2=i.canvas.height-1;else for(t=3;t<y.data.length;t+=4)if(y.data[t]>0){var x=(t-3)/4%i.canvas.width,b=Math.floor((t-3)/4/i.canvas.width);(v.x1>x||null===v.x1)&&(v.x1=x),null===v.y1&&(v.y1=b),(v.x2<x||null===v.x2)&&(v.x2=x),(v.y2<b||null===v.y2)&&(v.y2=b)}if(null===v.x1||null===v.y1)return alert(ze("filter-transform-empty")),!1;m.x=v.x1,m.y=v.y1,m.width=v.x2-v.x1+1,m.height=v.y2-v.y1+1;var w={x:m.x+m.width/2,y:m.y+m.height/2,width:m.width,height:m.height,angleDeg:0},C=document.createElement("div"),S={element:C};s||(S.width=500),C.innerHTML=ze("filter-transform-description");var k=new ve.KeyListener({onDown:function(e){ve.isInputFocused(!0)||("left"===e&&(R.value=""+(parseFloat(R.value)-1),r()),"right"===e&&(R.value=""+(parseFloat(R.value)+1),r()),"up"===e&&(T.value=""+(parseFloat(T.value)-1),r()),"down"===e&&(T.value=""+(parseFloat(T.value)+1),r()))}}),E=document.createElement("div"),M=document.createElement("div"),I=document.createElement("div"),T=document.createElement("input"),R=document.createElement("input"),L=document.createElement("input");(E.style.width="100px",E.style.height="30px",M.style.width="100px",M.style.height="30px",M.style.display="inline-block",E.style.display="inline-block",I.style.display="inline-block",I.style.width="150px",I.style.height="30px",T.type="number",R.type="number",L.type="number",R.style.width="70px",T.style.width="70px",L.style.width="70px",T.value="0",R.value="0",L.value="0",T.onclick=function(){this.focus(),r()},R.onclick=function(){this.focus(),r()},L.onclick=function(){this.focus(),r()},T.onchange=function(){r()},R.onchange=function(){r()},L.onchange=function(){r()},T.onkeyup=function(){r()},R.onkeyup=function(){r()},L.onkeyup=function(){r()},E.append("X: ",R),M.append("Y: ",T),I.append(ze("filter-transform-rotation")+": ",L),s)||ve.el({parent:C,css:{marginTop:"10px"}}).append(E,M,I);var A={marginLeft:"10px",marginTop:"10px"},P=ve.el({parent:C,css:{display:"flex",flexWrap:"wrap",marginLeft:"-10px"}}),O=ve.el({parent:P,tagName:"button",content:ze("filter-transform-flip")+" X",onClick:function(){var e=o.getTransform();o.setSize(-e.width,e.height)},css:A}),D=ve.el({parent:P,tagName:"button",content:ze("filter-transform-flip")+" Y",onClick:function(){var e=o.getTransform();o.setSize(e.width,-e.height)},css:A}),B=ve.el({parent:P,tagName:"button",content:"-90",onClick:function(){var e=o.getTransform();e.angleDeg-=90,e.angleDeg%=360,o.setAngleDeg(e.angleDeg),L.value=""+Math.round(e.angleDeg),n()},css:A}),z=ve.el({parent:P,tagName:"button",content:"+90",onClick:function(){var e=o.getTransform();e.angleDeg+=90,e.angleDeg%=360,o.setAngleDeg(e.angleDeg),L.value=""+Math.round(e.angleDeg),n()},css:A}),j=ve.el({parent:P,tagName:"button",content:"2x",onClick:function(){var e=o.getTransform();_.getValue()?o.setSize(o.getRatio()*e.height*2,2*e.height):o.setSize(2*e.width,2*e.height)},css:A}),H=ve.el({parent:P,tagName:"button",content:"1/2x",onClick:function(){var e=o.getTransform();o.setSize(Math.round(e.width/2),Math.round(e.height/2))},css:A}),F=ve.el({parent:P,tagName:"button",content:ze("center"),onClick:function(){var e=o.getTransform();o.setPos({x:i.canvas.width/2,y:i.canvas.height/2}),o.setAngleDeg(e.angleDeg),n()},css:A}),N=!0,_=new Fe({init:!0,label:ze("filter-transform-constrain"),title:ze("constrain-proportions"),allowTab:!0,callback:function(e){N=e,o.setConstrained(N)},css:{display:"inline-block"}}),X=!1,U=new Fe({init:!0,label:ze("filter-transform-snap"),title:ze("filter-transform-snap-title"),allowTab:!0,callback:function(e){X=e,o.setSnapping(X)},css:{display:"inline-block",marginLeft:"10px"}}),Y=ve.el({});Y.append(_.getElement(),U.getElement()),C.appendChild(ve.el({css:{clear:"both",height:"10px"}}));var W=ve.el({parent:C,css:{display:"flex",justifyContent:"space-between"}}),V=new Xe({isFocusable:!0,optionArr:[["smooth",ze("algorithm-smooth")],["pixelated",ze("algorithm-pixelated")]],initValue:"smooth",title:ze("scaling-algorithm"),onChange:function(){n(!0)}});W.append(Y,V.getElement());var G=document.createElement("div");G.oncontextmenu=function(){return!1},ve.css(G,{width:s?"340px":"540px",marginLeft:"-20px",height:s?"260px":"300px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var K=[],q=0;q<l.length;q++){var Z=void 0;if(q===c)(Z=ve.canvas(parseInt(""+p),parseInt(""+g))).getContext("2d").drawImage(l[q].context.canvas,0,0,Z.width,Z.height);else Z=l[q].context.canvas;K.push({image:Z,opacity:l[q].opacity,mixModeStr:l[q].mixModeStr})}var J=new Pt({width:parseInt(""+h),height:parseInt(""+d),layers:K}),Q=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+h)+"px",height:parseInt(""+d)+"px"}});Q.appendChild(J.getElement()),G.appendChild(Q);var $=void 0;return o=new Ht({x:w.x,y:w.y,width:w.width,height:w.height,angleDeg:w.angleDeg,isConstrained:!0,snapX:[0,i.canvas.width],snapY:[0,i.canvas.height],callback:function(e){R.value=""+Math.round(e.x-w.x),T.value=""+Math.round(e.y-w.y),L.value=""+Math.round(e.angleDeg),n()},scale:f}),ve.css(o.getElement(),{position:"absolute",left:"0",top:"0"}),Q.appendChild(o.getElement()),n(),C.appendChild(G),S.destroy=function(){k.destroy(),o.destroy(),_.destroy(),U.destroy(),ve.destroyEl(O),ve.destroyEl(D),ve.destroyEl(B),ve.destroyEl(z),ve.destroyEl(j),ve.destroyEl(H),ve.destroyEl(F)},S.getInput=function(){var e=o.getTransform(),t={transform:e,bounds:m,isPixelated:"pixelated"===V.getValue()||ve.testShouldPixelate(e,e.width/w.width,e.height/w.height)};return S.destroy(),JSON.parse(JSON.stringify(t))},S},apply:function(e){var t=e.context,n=e.history;if(!t||!n)return!1;n.pause(!0);var r=e.input,i=ve.copyCanvas(t.canvas);return t.clearRect(0,0,t.canvas.width,t.canvas.height),ve.drawTransformedImageWithBounds(t,i,r.transform,r.bounds,r.isPixelated),n.pause(!1),n.push({tool:["filter","transform"],action:"apply",params:[{input:r}]}),!0}},Ei={getDialog:function(e){var t=e.canvas,n=e.context;if(!t||!n)return!1;var r=t.getLayers(),i=t.getLayerIndex(n.canvas),a=ve.fitInto(n.canvas.width,n.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Math.min(o,n.canvas.width),c=Math.min(s,n.canvas.height),u=ve.canvas(l,c),h=u.getContext("2d");h.save(),l>n.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(n.canvas,0,0,l,c),h.restore();var d=l/n.canvas.width,p=document.createElement("div"),g={element:p};return setTimeout((function(){var e=10;p.innerHTML=ze("filter-triangle-blur-description")+"<br/><br/>";var t=hi();if(t){var n=t.texture(u);t.draw(n).update();var a=new Ke({label:ze("radius"),width:300,height:30,min:1,max:200,initValue:e,eventResMs:li,onChange:function(r){e=r,t.draw(n).triangleBlur(e*d).update(),f.render()}});p.appendChild(a.getElement());var l=document.createElement("div");ve.css(l,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var c=[],h=0;h<r.length;h++)c.push({image:h===i?t:r[h].context.canvas,opacity:r[h].opacity,mixModeStr:r[h].mixModeStr});var f=new Pt({width:parseInt(""+o),height:parseInt(""+s),layers:c}),m=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});m.appendChild(f.getElement()),l.appendChild(m),p.appendChild(l);try{t.draw(n).triangleBlur(e*d).update(),f.render()}catch(e){p.errorCallback(e)}g.destroy=function(){n.destroy(),a.destroy()},g.getInput=function(){return g.destroy(),{radius:e}}}}),1),g},apply:function(e){var t=e.context,n=e.history,r=e.input.radius;if(!t||!r||!n)return!1;n.pause(!0);var i=hi();if(!i)return!1;var a=i.texture(t.canvas);return i.draw(a).triangleBlur(r).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(i,0,0),a.destroy(),n.pause(!1),n.push({tool:["filter","glBlur"],action:"apply",params:[{input:e.input}]}),!0}},Mi={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=ve.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=Math.min(o,t.canvas.width),c=Math.min(s,t.canvas.height),u=ve.canvas(l,c),h=u.getContext("2d");h.save(),l>t.canvas.width&&(h.imageSmoothingEnabled=!1),h.drawImage(t.canvas,0,0,l,c),h.restore();var d=l/t.canvas.width,p=document.createElement("div"),g={element:p};return setTimeout((function(){var e=2,t=.51;p.innerHTML=ze("filter-unsharp-mask-description")+"<br/><br/>";var n=hi();if(n){var a=n.texture(u);n.draw(a).update();var l=new Ke({label:ze("radius"),width:300,height:30,min:0,max:200,initValue:2,eventResMs:li,onChange:function(r){e=r,n.draw(a).unsharpMask(e*d,t).update(),v.render()},curve:[[0,0],[.1,2],[.5,50],[1,200]]}),c=new Ke({label:ze("filter-unsharp-mask-strength"),width:300,height:30,min:0,max:50,initValue:5.1,eventResMs:li,onChange:function(r){t=r/10,n.draw(a).unsharpMask(e*d,t).update(),v.render()},curve:[[0,0],[.1,2],[.5,10],[1,50]]});l.getElement().style.marginBottom="10px",p.appendChild(l.getElement()),p.appendChild(c.getElement());var h=document.createElement("div");ve.css(h,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var f=[],m=0;m<r.length;m++)f.push({image:m===i?n:r[m].context.canvas,opacity:r[m].opacity,mixModeStr:r[m].mixModeStr});var v=new Pt({width:parseInt(""+o),height:parseInt(""+s),layers:f}),y=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});y.appendChild(v.getElement()),h.appendChild(y),p.appendChild(h);try{n.draw(a).unsharpMask(e*d,t).update(),v.render()}catch(e){p.errorCallback(e)}g.destroy=function(){l.destroy(),c.destroy(),a.destroy()},g.getInput=function(){return g.destroy(),{radius:e,strength:t}}}}),1),g},apply:function(e){var t=e.context,n=e.history,r=e.input.radius,i=e.input.strength;if(!t||null===r||null===i||!n)return!1;n.pause(!0);var a=hi();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).unsharpMask(r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","glUnsharpMask"],action:"apply",params:[{input:e.input}]}),!0}},Ii={getDialog:function(e){var t=e.context,n=e.canvas;if(!t||!n)return!1;var r=n.getLayers(),i=n.getLayerIndex(t.canvas),a=ve.fitInto(t.canvas.width,t.canvas.height,280,200,1),o=parseInt(""+a.width),s=parseInt(""+a.height),l=ve.canvas(o,s),c=l.getContext("2d");c.save(),l.width>t.canvas.width&&(c.imageSmoothingEnabled=!1),c.drawImage(t.canvas,0,0,o,s),c.restore();var u=document.createElement("div"),h={element:u};return setTimeout((function(){u.appendChild(ve.el({content:ze("filter-to-alpha-description"),css:{marginBottom:"5px"}}));var t=hi();if(t){var n=t.texture(l);t.draw(n).update();var a="inverted-luminance",c=new et({optionArr:[{id:"inverted-luminance",label:ze("filter-to-alpha-inverted-lum")},{id:"luminance",label:ze("filter-to-alpha-lum")}],initialId:a,onChange:function(e){a=e,b()}});u.appendChild(c.getElement());var d={r:0,g:0,b:0,a:1},p=[null,{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1}];p.push({r:e.currentColorRgb.r,g:e.currentColorRgb.g,b:e.currentColorRgb.b,a:1}),p.push({r:e.secondaryColorRgb.r,g:e.secondaryColorRgb.g,b:e.secondaryColorRgb.b,a:1});var g=new $e({label:ze("filter-to-alpha-replace"),colorArr:p,initialIndex:1,onChange:function(e){d=e,b()}});g.getElement().style.marginTop="10px",u.appendChild(g.getElement());var f=document.createElement("div");ve.css(f,{width:"340px",marginLeft:"-20px",height:"220px",backgroundColor:"#9e9e9e",marginTop:"10px",boxShadow:"rgba(0, 0, 0, 0.2) 0px 1px inset, rgba(0, 0, 0, 0.2) 0px -1px inset",overflow:"hidden",position:"relative",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",colorScheme:"only light"});for(var m=[],v=0;v<r.length;v++)m.push({image:v===i?t:r[v].context.canvas,opacity:r[v].opacity,mixModeStr:r[v].mixModeStr});var y=new Pt({width:parseInt(""+o),height:parseInt(""+s),layers:m}),x=ve.el({css:{position:"relative",boxShadow:"0 0 5px rgba(0,0,0,0.5)",width:parseInt(""+o)+"px",height:parseInt(""+s)+"px"}});x.appendChild(y.getElement()),f.appendChild(x),u.appendChild(f),setTimeout((function(){try{b()}catch(e){u.errorCallback(e)}}),1),h.destroy=function(){n.destroy(),c.destroy()},h.getInput=function(){return h.destroy(),{sourceId:a,selectedRgbaObj:d}}}function b(){t.draw(n).toAlpha("inverted-luminance"===a,d).update(),y.render()}}),1),h},apply:function(e){var t=e.context,n=e.history,r=e.input.sourceId,i=e.input.selectedRgbaObj;if(!t||!r||!n)return!1;n.pause(!0);var a=hi();if(!a)return!1;var o=a.texture(t.canvas);return a.draw(o).toAlpha("inverted-luminance"===r,i).update(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(a,0,0),o.destroy(),n.pause(!1),n.push({tool:["filter","toAlpha"],action:"apply",params:[{input:e.input}]}),!0}};function Ti(e,t){t.getDialog&&(e.getDialog=t.getDialog),e.apply=t.apply}a("cf2NR");s=a("5atYG");function Ri(e){return Li.apply(this,arguments)}function Li(){return Li=s.default(t(l).mark((function e(n){var r,i,o,s,c,u;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=n.getLayersFast(),i={width:n.getWidth(),height:n.getHeight(),children:[]},o=0;o<r.length;o++)s=r[o],i.children.push({name:s.name,opacity:s.opacity,canvas:s.canvas,blendMode:oi.PSD.blendKlToPsd(s.mixModeStr),left:0,top:0});return e.next=5,a("2TDyk");case 5:return c=e.sent,u=c.writePsdBuffer(i),e.abrupt("return",new Blob([u],{type:"application/octet-stream"}));case 8:case"end":return e.stop()}}),e)}))),Li.apply(this,arguments)}var Ai;Ai=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("eWrXl");var Pi;Pi=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("l1oc0");var Oi;Oi=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("4vTN0");var Di,Bi;function zi(e,n,r){var i,a=function(e){return 1==e?.5:2==e?.84:3==e?.965:4==e?.9825:5==e?.99125:e},o=function(e){N.emitSize(e),W&&W.setCursorSize(2*e)},c=function(e,t,n){function r(e,t){var n=parseInt(e),r=parseInt(t);return n>b&&(r*=b/n,n=b),r>b&&(n*=b/r,r=b),{width:n=parseInt(""+n),height:r=parseInt(""+r)}}function i(e){var n=r(e.width,e.height),i=ve.canvas(e.width,e.height);i.getContext("2d").drawImage(e,0,0),ve.resizeCanvas(i,n.width,n.height),A.reset({width:n.width,height:n.height,image:i,layerName:t}),ge.update(0),p(A.getLayer(0)),W.resetView(),ce.update(W.getScale(),W.getAngleDeg()),!1}function a(e,t){function n(e,t,n){t.width=t.width,t.getContext("2d").drawImage(e,-n.x,-n.y),e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(t,0,0)}if(t&&(t.width!==e.width||t.height!==e.height)){var i=ve.canvas(t.width,t.height);if(e.width=t.width,e.height=t.height,e.layers||n(e.canvas,i,t),e.layers)for(var a=0;a<e.layers.length;a++){n(e.layers[a].image,i,t)}}var o=r(e.width,e.height);if(e.width=o.width,e.height=o.height,e.layers||ve.resizeCanvas(e.canvas,e.width,e.height),e.layers)for(var s=0;s<e.layers.length;s++){var l=e.layers[s];ve.resizeCanvas(l.image,e.width,e.height)}var c=void 0;c=e.layers?A.reset({width:e.width,height:e.height,layers:e.layers}):A.reset({width:e.width,height:e.height,image:e.canvas}),ge.update(c),p(A.getLayer(c)),W.resetView(),ce.update(W.getScale(),W.getAngleDeg()),!1}function o(e){oi.showImportAsLayerDialog({target:E,bbox:x(),klCanvas:A,importImage:e,callback:function(n,r){if(n){we.pause(!0),A.addLayer();var i=A.getLayers().length-1;t&&A.renameLayer(i,t);var a=A.getLayerContext(i);ve.drawTransformedImageWithBounds(a,e,n,null,r),p(A.getLayer(i)),ge.update(i),we.pause(!1),we.push({tool:["misc"],action:"importImage",params:[ve.copyCanvas(a.canvas),t]})}}})}!e||isNaN(e.width)||isNaN(e.height)||e.width<=0||e.height<=0?oi.popup({target:E,type:"error",message:ze("import-broken-file"),buttons:["Ok"]}):("default"!==n&&n||oi.showImportImageDialog({image:e,target:E,bbox:x(),maxSize:b,callback:function(e){"as-image"===e.type?i(e.image):"as-image-psd"===e.type?a(e.image,e.cropObj):"as-layer"===e.type?o(e.image):e.type}}),"layer"===n&&o(e.canvas),"image"===n&&("psd"===e.type?a(e):i(e.canvas)))},u=function(e,t){function n(){oi.popup({target:E,type:"warning",message:ze("import-psd-unsupported")+"<br /><br />",buttons:["Ok"]})}for(var r,i=!1,a=0;r=e[a];a++){var o=r.name.split(".");"psd"===(o=o[o.length-1].toLowerCase())?function(r){var i=4096;if(r.size>=1073741824)oi.popup({target:E,type:"error",message:"File too big. Unable to import.<br /><br />",buttons:["Ok"]});else{var a,o=1===e.length&&r.size>=26214400,s=!0;o&&oi.popup({target:E,message:ze("import-opening"),callback:function(e){s=!1,a=null},closefunc:function(e){a=e}});var l=new FileReader;l.onload=function(e){oi.loadAgPsd().then((function(l){if(!o||s)try{var u;if((u=l.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0,skipCompositeImageData:!0})).width>i||u.height>i)return a&&a(),void oi.popup({target:E,type:"error",message:ze("import-psd-too-large").replace(/{x}/g,"4096")+"<br /><br />"+ze("import-psd-size")+": "+u.width+" x "+u.height+" pixels<br /><br />",buttons:["Ok"]});u=null;try{u=l.readPsd(e.target.result)}catch(e){}if(u){var h=oi.PSD.readPsd(u);"image"===t&&h.error&&n(),a&&a(),c(h,r.name,t)}else u=l.readPsd(e.target.result,{skipLayerImageData:!0,skipThumbnail:!0}),"image"===t&&n(),a&&a(),c({type:"psd",width:u.width,height:u.height,canvas:u.canvas,error:!0},r.name,t)}catch(e){a&&a(),oi.popup({target:E,type:"error",message:"Failed to load PSD.<br /><br />",buttons:["Ok"]})}})).catch((function(){a(),alert("Error: failed to load PSD library")}))},l.readAsArrayBuffer(r)}}(r):r.type.match("image.*")?function(e){window.URL=window.URL||window.webkitURL;var n=window.URL.createObjectURL(e),r=new Image;r.src=n,ve.loadImage(r,(function(){c({type:"image",width:r.width,height:r.height,canvas:r},e.name,t)}))}(r):i=!0}i&&oi.popup({target:E,message:ze("import-unsupported-file"),type:"error",buttons:["OK"]})},h=function(){I<w?($.getElement().style.display="block",$.setDirection(C),$.isOpen()?("left"===C?(ve.css($.getElement(),{left:"271px",right:""}),ve.css(W.getElement(),{left:"271px"})):(ve.css($.getElement(),{left:"",right:"271px"}),ve.css(W.getElement(),{left:"0"})),J.style.display="block",W.setSize(Math.max(0,I-R),T),Z.setWide(!1)):("left"===C?(ve.css($.getElement(),{left:"0",right:""}),ve.css(W.getElement(),{left:"0"})):(ve.css($.getElement(),{left:"",right:"0"}),ve.css(W.getElement(),{left:"0"})),J.style.display="none",W.setSize(Math.max(0,I),T),Z.setWide(!0))):($.getElement().style.display="none","left"===C?ve.css(W.getElement(),{left:"271px"}):ve.css(W.getElement(),{left:"0"}),J.style.display="block",W.setSize(Math.max(0,I-R),T),Z.setWide(!1))},d=function(){"left"===C?(ve.css(J,{left:"0",right:"",borderLeft:"none",borderRight:"1px solid rgb(135, 135, 135)"}),ve.css(W.getElement(),{left:"271px"})):(ve.css(J,{left:"",right:"0",borderLeft:"1px solid rgb(135, 135, 135)",borderRight:"none"}),ve.css(W.getElement(),{left:"0"})),Z.setUiState(C),fe.setUiState(""+C),ge.setUiState(""+C),h(),Me.updateUiState(C)},p=function(e){F=e.context,z.setContext(e.context),fe.setLayer(e)},g=function(){oi.newImageDialog({klRootEl:E,currentColor:B,secondaryColor:re.getSecondaryRGB(),maxCanvasSize:b,canvasWidth:A.getWidth(),canvasHeight:A.getHeight(),workspaceWidth:x().width<w?I:I-R,workspaceHeight:T,onConfirm:function(e,t,n){A.reset({width:e,height:t,color:1===n.a?n:null}),ge.update(0),p(A.getLayer(0)),W.resetView(),ce.update(W.getScale(),W.getAngleDeg()),!1},onCancel:function(){}})},f=function(e){ve.shareCanvas({canvas:A.getCompleteCanvas(1),fileName:ve.getDate()+S+".png",title:ve.getDate()+S+".png",callback:e||function(){}})},m=function(){if(P)for(var e=ne.getActive(),t=P.getOpenedTabId(),n=Object.keys({draw:{},hand:{},fill:{},text:{},shape:{}}),r=0;r<n.length;r++)e===n[r]?P.setIsVisible(n[r],!0):(P.setIsVisible(n[r],!1),t===n[r]&&P.open(e))},v=function(e){oi.clipboardDialog(E,x(),A.getCompleteCanvas(1),(function(e){if(0!==e.left||0!==e.right||0!==e.top||0!==e.bottom){var t={context:F,canvas:A,input:e,history:we};oi.filterLib.cropExtend.apply(t),ge.update(),W.resetView(),ce.update(W.getScale(),W.getAngleDeg())}}),Z,e)},y=function(){if(n.bottomBar){var e=x(),t=617<e.height&&Q.scrollHeight+50<e.height;ke.style.display=t?"":"none"}},x=function(){return{width:r?r.clientWidth||r.offsetWidth:window.innerWidth,height:r?r.clientHeight||r.offsetHeight:window.innerHeight}},b=Math.min(4096,Math.max(2048,Math.max(window.screen.width,window.screen.height))),w=820,C=n.embed?"left":me.getItem("uiState")?me.getItem("uiState"):"right",S=(null===(i=n.app)||void 0===i?void 0:i.filenameBase)?n.app.filenameBase:"Klecks",k=n.projectStore,E=document.createElement("div");E.className="g-root";var M=x(),I=Math.max(0,M.width),T=Math.max(0,M.height),R=271,L="png",A=new oi.KlCanvas(e?{projectObj:e}:{width:Math.max(10,Math.min(b,M.width<w?I:I-R)),height:Math.max(10,Math.min(b,T))},n.embed?-1:0);A.setHistory(we);var P,O=null;n.saveReminder||(n.saveReminder={init:function(){},reset:function(){}});e?(e.layers.forEach((function(e){e.image=null})),e=null):(we.pause(!0),A.addLayer(),A.layerFill(0,{r:255,g:255,b:255}),we.pause(!1));try{O={canvas:new oi.KlCanvas({copy:A},n.embed?-1:0),focus:A.getLayerCount()-1,brushes:{}}}catch(e){throw"kl-create-canvas-error"===e.message&&A.destroy(),e}for(var D in oi.brushes)oi.brushes.hasOwnProperty(D)&&(O.brushes[D]=new oi.brushes[D],O.canvas&&O.brushes[D].setContext(O.canvas.getLayerContext(O.focus)));var B=new ve.RGB(0,0,0),z=void 0,j=void 0,H=0,F=A.getLayerContext(A.getLayerCount()-1),N=new oi.BrushSettingService((function(e){re.setColor(e),z.setColor(e),B=ve.copyObj(e)}),(function(e){z.setSize(e),W.setCursorSize(2*e)}),(function(e){z.setOpacity(e)}),(function(){return re.getColor()}),(function(){return G[j].getSize()}),(function(){return G[j].getOpacity()}),(function(){return{sizeSlider:oi.brushesUI[j].sizeSlider,opacitySlider:oi.brushesUI[j].opacitySlider}})),_=new ve.EventChain.LineSmoothing({smoothing:a(1)}),X=new ve.EventChain.LineSanitizer,U=new ve.EventChain.EventChain({chainArr:[X,_]});U.setChainOut((function(e){"down"===e.type&&(J.style.pointerEvents="none",z.startLine(e.x,e.y,e.pressure),W.requestFrame()),"move"===e.type&&(z.goLine(e.x,e.y,e.pressure,!1,e.isCoalesced),W.setLastDrawEvent(e.x,e.y,e.pressure),W.requestFrame()),"up"===e.type&&(J.style.pointerEvents="",z.endLine(),W.requestFrame()),"line"===e.type&&(z.getBrush().drawLineSegment(e.x0,e.y0,e.x1,e.y1),W.requestFrame())}));var Y={size:20,align:"left",isBold:!1,isItalic:!1,font:"sans-serif",opacity:1},W=new oi.KlCanvasWorkspace({klCanvas:A,width:Math.max(0,I-R),height:T,onDraw:U.chainIn,onPick:function(e,t){N.setColor(e),t&&(re.pickingDone(),W.setMode(ne.getActive()))},onFill:function(e,t){var n=A.getLayerIndex(F.canvas);A.floodFill(n,e,t,re.getColor(),ue.getOpacity(),ue.getTolerance(),ue.getSample(),ue.getGrow(),ue.getContiguous()),W.requestFrame()},onText:function(e,t,n){oi.dialogCounter.get()>0||oi.textToolDialog({klRootEl:E,bbox:x(),klCanvas:A,layerIndex:A.getLayerIndex(F.canvas),x:e,y:t,angleRad:n,color:re.getColor(),secondaryColor:re.getSecondaryRGB(),size:Y.size,align:Y.align,isBold:Y.isBold,isItalic:Y.isItalic,font:Y.font,opacity:Y.opacity,onConfirm:function(e){var t=e.color;t.a=e.opacity,Y.size=e.size,Y.align=e.align,Y.isBold=e.isBold,Y.isItalic=e.isItalic,Y.font=e.font,Y.opacity=e.opacity;var r=A.getLayerIndex(F.canvas);A.text(r,{textStr:e.textStr,x:e.x,y:e.y,size:e.size,font:e.font,align:e.align,isBold:e.isBold,isItalic:e.isItalic,angleRad:n,color:ve.ColorConverter.toRgbaStr(t)}),W.requestFrame()}})},onShape:function(e,t,n,r){"down"===e&&pe.onDown(t,n,r),"move"===e&&pe.onMove(t,n),"up"===e&&pe.onUp(t,n)},onViewChange:function(e){e.changed.includes("scale")&&Z.out({type:"transform",scale:e.scale,angleDeg:180*e.angle/Math.PI}),ne.setEnableZoomIn(e.scale!==W.getMaxScale()),ne.setEnableZoomOut(e.scale!==W.getMinScale()),ce.update(e.scale,180*e.angle/Math.PI)},onUndo:function(){we.canUndo()&&xe.undo()&&Z.out(ze("undo"),!0)},onRedo:function(){we.canRedo()&&xe.redo()&&Z.out(ze("redo"),!0)}}),V=new ve.KeyListener({onDown:function(e,r,i){if(!(oi.dialogCounter.get()>0)&&(!ve.isInputFocused(!0)&&!(X.getIsDrawing()||W.getIsDrawing()))){if("plus"===i&&W.zoomByStep(V.isPressed("shift")?.125:.5),"minus"===i&&W.zoomByStep(V.isPressed("shift")?-.125:-.5),"home"===i&&W.fitView(),"end"===i&&W.resetView(!0),["ctrl+z","cmd+z"].includes(i)&&(r.preventDefault(),xe.undo()),(["ctrl+y","cmd+y"].includes(i)||(ve.sameKeys("ctrl+shift+z",i)||ve.sameKeys("cmd+shift+z",i))&&"z"===e)&&(r.preventDefault(),xe.redo()),n.embed||(["ctrl+s","cmd+s"].includes(i)&&(r.preventDefault(),be.save()),["ctrl+shift+s","cmd+shift+s"].includes(i)&&(r.preventDefault(),s.default(t(l).mark((function e(){var r;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=13;break}return r=!0,e.prev=2,e.next=5,k.store(A.getProject());case 5:e.next=12;break;case 7:e.prev=7,e.t0=e.catch(2),r=!1,setTimeout((function(){throw new Error("keyboard-shortcut: failed to store browser storage, "+e.t0)}),0),Z.out(" "+ze("file-storage-failed"),!0);case 12:r&&(n.saveReminder.reset(),Z.out(ze("file-storage-stored"),!0));case 13:case"end":return e.stop()}}),e,null,[[2,7]])})))()),["ctrl+c","cmd+c"].includes(i)&&(r.preventDefault(),v(!0))),["ctrl+a","cmd+a"].includes(i)&&r.preventDefault(),V.comboOnlyContains(["left","right","up","down"])&&("left"===e&&W.translateView(1,0),"right"===e&&W.translateView(-1,0),"up"===e&&W.translateView(0,1),"down"===e&&W.translateView(0,-1)),["r+left","r+right"].includes(i)&&("left"===e&&(W.setAngle(-15,!0),ce.update(W.getScale(),W.getAngleDeg())),"right"===e&&(W.setAngle(15,!0),ce.update(W.getScale(),W.getAngleDeg()))),["r+up"].includes(i)&&(W.setAngle(0),ce.update(W.getScale(),W.getAngleDeg())),"sqbr_open"===i&&z.decreaseSize(.03/W.getScale()),"sqbr_close"===i&&z.increaseSize(.03/W.getScale()),"enter"===i&&(A.layerFill(A.getLayerIndex(F.canvas),re.getColor()),Z.out(ze("filled"),!0)),["delete","backspace"].includes(i)){var a=A.getLayerIndex(F.canvas);0!==a||G.eraserBrush.getIsTransparentBg()?A.clearLayer(a):A.layerFill(a,{r:255,g:255,b:255},"source-in"),Z.out(ze("cleared-layer"),!0)}"e"===i&&(r.preventDefault(),W.setMode("draw"),ne.setActive("draw"),P.open("draw"),m(),se.open("eraserBrush")),"b"===i&&(r.preventDefault(),W.setMode("draw"),ne.setActive("draw"),P.open("draw"),m(),se.open(H)),"g"===i&&(r.preventDefault(),W.setMode("fill"),ne.setActive("fill"),P.open("fill"),m()),"t"===i&&(r.preventDefault(),W.setMode("text"),ne.setActive("text"),P.open("text"),m()),"u"===i&&(r.preventDefault(),W.setMode("shape"),ne.setActive("shape"),P.open("shape"),m()),"x"===i&&(r.preventDefault(),re.swapColors())}},onUp:function(e,t){}});n.embed||(new oi.KlImageDropper({target:E,onDrop:function(e,t){oi.dialogCounter.get()>0||u(e,t)},enabledTest:function(){return 0===oi.dialogCounter.get()}}),ve.addEventListener(window,"paste",(function(e){oi.dialogCounter.get()>0||(e.stopPropagation(),e.preventDefault(),e.clipboardData.files[0]?function(e,t){0==e.clipboardData&&"function"==typeof t&&t(void 0);var n=e.clipboardData.items;if(null==n)"function"==typeof t&&t(void 0);else for(var r=0;r<n.length;r++)if(-1!=n[r].type.indexOf("image")){var i=n[r].getAsFile();"function"==typeof t&&t(i)}}(e,(function(e){if(e){var t=new Image;t.onload=function(){URL.revokeObjectURL(t.src),c({type:"image",width:t.width,height:t.height,canvas:t},null,"default")};var n=window.URL||window.webkitURL;t.src=n.createObjectURL(e)}})):e.clipboardData.items[0]&&e.clipboardData.items[0].getAsString((function(e){if((e=e.trim()).match(/^https?/)){var t=new Image;t.onload=function(){c({type:"image",width:t.width,height:t.height,canvas:t},null,"default")},t.onerror=function(e){console.log("error loading",e)},t.crossOrigin="Anonymous",t.src=e}else if(e.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)){var n=ve.ColorConverter.hexToRGB(e.replace("#",""));N.setColor(n)}})))}),!1));var G={};for(var K in oi.brushesUI)if(oi.brushesUI.hasOwnProperty(K)){var q=new oi.brushesUI[K].Ui({onSizeChange:o,onOpacityChange:function(e){N.emitOpacity(e)},onConfigChange:function(){N.emitSliderConfig({sizeSlider:oi.brushesUI[j].sizeSlider,opacitySlider:oi.brushesUI[j].opacitySlider})}});G[K]=q,q.getElement().style.padding="10px"}ve.css(E,{position:"absolute",left:"0",top:"0",right:"0",bottom:"0"});var Z=new oi.StatusOverlay(E),J=ve.el({}),Q=ve.el({parent:J});J.oncontextmenu=function(){return!1},J.onclick=ve.handleClick;var $=new oi.ToolspaceCollapser({onChange:function(){h()}});h();var ee=void 0;setTimeout((function(){ee=new oi.OverlayToolspace({enabledTest:function(){return 0===oi.dialogCounter.get()&&!X.getIsDrawing()},brushSettingService:N}),E.appendChild(ee.getElement())}),0),ve.append(E,[W.getElement(),J,$.getElement()]),ve.css(J,{position:"absolute",right:"0",top:"0",bottom:"0",width:R-1+"px",overflow:"hidden",backgroundColor:"#ddd",borderLeft:"1px solid rgb(135, 135, 135)",userSelect:"none",touchAction:"none"});var te=void 0;te=n.embed?new si({onHelp:function(){Dr(n.embed.url+"/help.html",!!n.embed,E,x())},onSubmit:function(){oi.popup({target:E,message:ze("submit-prompt"),buttons:[ze("submit"),"Cancel"],callback:s.default(t(l).mark((function e(r){var i;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r===ze("submit")){e.next=2;break}return e.abrupt("return");case 2:i=ve.el({parent:E,className:"upload-overlay",content:'<div class="spinner"></div> '+ze("submit-submitting")}),n.embed.onSubmit((function(){n.saveReminder.reset(),E.removeChild(i)}),(function(){E.removeChild(i)}));case 4:case"end":return e.stop()}}),e)})))})},onLeftRight:function(){C="left"===C?"right":"left",d()}}):new oi.ToolspaceTopRow({logoImg:n.logoImg,onLogo:n.onLogo,onNew:function(){g()},onImport:function(){Ce&&Ce.triggerImport()},onSave:function(){be.save()},onShare:n.isShare?function(){f()}:null,onHelp:n.helpPath?function(){Dr(n.helpPath+"/help.html",!!n.embed,E,x())}:null}),ve.addClassName(te.getElement(),"toolspace-row-shadow"),te.getElement().style.marginBottom="10px",Q.appendChild(te.getElement());var ne=new oi.ToolspaceToolRow({klRootEl:E,onActivate:function(e){if("draw"===e)W.setMode("draw");else if("hand"===e)W.setMode("hand");else if("fill"===e)W.setMode("fill");else if("text"===e)W.setMode("text");else{if("shape"!==e)throw new Error("unknown activeStr");W.setMode("shape")}P.open(e),m(),re.pickingDone()},onZoomIn:function(){W.zoomByStep(V.isPressed("shift")?.125:.5)},onZoomOut:function(){W.zoomByStep(V.isPressed("shift")?-.125:-.5)},onUndo:function(){xe.undo()},onRedo:function(){xe.redo()}});ne.setIsSmall(T<540),we.addListener((function(){ne.setEnableUndo(we.canUndo()),ne.setEnableRedo(we.canRedo())})),ve.addClassName(ne.getElement(),"toolspace-row-shadow"),Q.appendChild(ne.getElement());var re=void 0;(re=new oi.KlColorSlider({width:250,height:30,svHeight:100,startValue:new ve.RGB(0,0,0),onPick:function(e){B=e,z.setColor(e),N.emitColor(e),re.pickingDone()},klRootEl:E})).setHeight(Math.max(163,Math.min(400,T-505))),re.setPickCallback((function(e){e?W.setMode("pick"):(W.setMode(ne.getActive()),m())}));var ie=document.createElement("div"),ae=document.createElement("div");ve.css(ae,{margin:"10px",display:"flex",flexWrap:"wrap",justifyContent:"space-between",alignItems:"flex-end"});var oe=new oi.ToolspaceStabilizerRow({smoothing:1,onSelect:function(e){_.setSmoothing(a(e))}});ie.appendChild(ae),ve.append(ae,[re.getElement(),re.getOutputElement(),oe.getElement()]);var se=new oi.TabRow({initialId:"penBrush",useAccent:!0,tabArr:function(){for(var e=function(e){return{id:e,image:oi.brushesUI[e].image,title:oi.brushesUI[e].tooltip,onOpen:function(){var t;G[e].getElement().style.display="block","eraserBrush"!==(t=e)&&(H=t),re&&("eraserBrush"===t?re.enable(!1):re.enable(!0)),j=t,(z=G[t]).setColor(B),z.setContext(F),W.setMode("draw"),ne.setActive("draw"),m(),re.pickingDone(),N.emitSliderConfig({sizeSlider:oi.brushesUI[e].sizeSlider,opacitySlider:oi.brushesUI[e].opacitySlider}),o(G[e].getSize()),N.emitOpacity(G[e].getOpacity())},onClose:function(){G[e].getElement().style.display="none"}}},t=[],n=Object.keys(G),r=0;r<n.length;r++)t.push(e(n[r]));return t}()});for(var le in ie.appendChild(se.getElement()),oi.brushesUI)oi.brushesUI.hasOwnProperty(le)&&ie.appendChild(G[le].getElement());var ce=new oi.HandUi({scale:1,angleDeg:0,onReset:function(){W.resetView(!0),ce.update(W.getScale(),W.getAngleDeg())},onFit:function(){W.fitView(),ce.update(W.getScale(),W.getAngleDeg())},onAngleChange:function(e,t){W.setAngle(e,t),ce.update(W.getScale(),W.getAngleDeg())}}),ue=new oi.FillUi({colorSlider:re}),he=new oi.TextUi({colorSlider:re}),de=new oi.ShapeUi({colorSlider:re}),pe=new oi.ShapeTool({onShape:function(e,t,n,r,i,a){var o=A.getLayerIndex(F.canvas),s={type:de.getShape(),x1:t,y1:n,x2:r,y2:i,angleRad:a,isOutwards:de.getIsOutwards(),opacity:de.getOpacity(),isEraser:de.getIsEraser()};"line"===de.getShape()?(s.strokeRgb=re.getColor(),s.lineWidth=de.getLineWidth(),s.isAngleSnap=de.getIsSnap()||V.isPressed("shift")):(s.isFixedRatio=de.getIsFixed()||V.isPressed("shift"),"stroke"===de.getMode()?(s.strokeRgb=re.getColor(),s.lineWidth=de.getLineWidth()):s.fillRgb=re.getColor()),e?(A.setComposite(o,null),A.drawShape(o,s)):A.setComposite(o,{draw:function(e){oi.drawShape(e,s)}}),W.requestFrame()}}),ge=oi.klLayerManager(A,(function(e){p(A.getLayer(e)),we.push({tool:["misc"],action:"focusLayer",params:[e]})}),E),fe=new oi.LayerPreview({klRootEl:E,onClick:function(){P.open("layers")}});fe.setIsVisible(T>=579),fe.setLayer(A.getLayer(A.getLayerIndex(F.canvas)));var ye=new oi.FilterTab(this,re,ge,p,W,ce,(function(){return B}),(function(){return b}),(function(){return A}),(function(){return F}),!!n.embed,Z),xe=new oi.UndoRedoCatchup(G,fe,ge,ce,W,(function(){if(!O)throw new Error("initState not initialized");return O}),(function(){return A}),(function(){return F}),(function(e){F=e}),(function(){return z}));we.addListener((function(e){xe.catchup(e)}));var be=new oi.SaveToComputer("function"==typeof n.customSave?function(e,r){oi.popup({target:E,message:ze("submit-prompt"),buttons:[ze("submit"),"Cancel"],callback:s.default(t(l).mark((function i(a){var o;return t(l).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a===ze("submit")){t.next=2;break}return t.abrupt("return");case 2:o=ve.el({parent:E,className:"upload-overlay",content:'<div class="spinner"></div> '+ze("submit-submitting")}),n.customSave(e,r,(function(){n.saveReminder.reset(),E.removeChild(o)}),(function(){E.removeChild(o)}));case 4:case"end":return t.stop()}}),i)})))})}:null,n.saveReminder,E,(function(){return L}),(function(){return A}),S),Ce=n.embed?null:new oi.FileTab(E,k,(function(){return A.getProject()}),L,(function(e){L=e}),u,(function(){be.save()}),g,n.isShare?f:null,(function(){oi.imgurUpload(A,E,n.saveReminder,n.app&&n.app.imgurKey?n.app.imgurKey:null)}),v,n.saveReminder),Se=new oi.SettingsTab((function(){C="left"===C?"right":"left",d(),n.embed||me.setItem("uiState",C)}),n.aboutEl,E);P=new oi.TabRow({initialId:"draw",tabArr:[{id:"draw",title:ze("tool-brush"),image:t(Gt),onOpen:function(){"eraserBrush"===j&&re.enable(!1),ve.append(ae,[re.getElement(),re.getOutputElement(),oe.getElement()]),ie.style.display="block"},onClose:function(){ie.style.display="none"},css:{minWidth:"45px"}},{id:"hand",title:ze("tool-hand"),image:t($t),isVisible:!1,onOpen:function(){ce.setIsVisible(!0)},onClose:function(){ce.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"fill",title:ze("tool-paint-bucket"),image:t(Kt),isVisible:!1,onOpen:function(){re.enable(!0),ue.setIsVisible(!0)},onClose:function(){ue.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"text",title:ze("tool-text"),image:t(qt),isVisible:!1,onOpen:function(){re.enable(!0),he.setIsVisible(!0)},onClose:function(){he.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"shape",title:ze("tool-shape"),image:t(Zt),isVisible:!1,onOpen:function(){re.enable(!0),de.setIsVisible(!0)},onClose:function(){de.setIsVisible(!1)},css:{minWidth:"45px"}},{id:"layers",title:ze("tab-layers"),image:t(Di),onOpen:function(){ge.update(),ge.style.display="block"},onClose:function(){ge.style.display="none"},css:{minWidth:"45px"}},{id:"edit",title:ze("tab-edit"),image:t(Ai),onOpen:function(){ye.show()},onClose:function(){ye.hide()},css:{minWidth:"45px"}},{id:"file",title:ze("tab-file"),image:t(Pi),isVisible:!n.hideFile&&!!Ce,onOpen:function(){Ce&&(Ce.getElement().style.display="block",Ce.setIsVisible(!0))},onClose:function(){Ce&&(Ce.getElement().style.display="none",Ce.setIsVisible(!1))},css:{minWidth:"45px"}},{id:"settings",title:ze("tab-settings"),image:t(Oi),onOpen:function(){Se.getElement().style.display="block"},onClose:function(){Se.getElement().style.display="none"},css:{minWidth:"45px"}}]});var ke=ve.el({css:{width:"270px",position:"absolute",bottom:"0",left:"0"}});n.bottomBar&&(ke.append(n.bottomBar),new MutationObserver((function(){return y()})).observe(Q,{attributes:!0,childList:!0,subtree:!0}));ve.append(Q,[fe.getElement(),P.getElement(),ie,ce.getElement(),ue.getElement(),he.getElement(),de.getElement(),ge,ye.getElement(),Ce?Ce.getElement():null,Se.getElement(),ve.el({css:{height:"10px"}}),ke||null]);var Ee,Me=new oi.ToolspaceScroller({toolspace:J,uiState:C});this.getBBox=x,this.getEl=function(){return E},this.resize=function(e,t){window.scrollY>0&&window.scrollTo(0,0),I===Math.max(0,e)&&T===Math.max(0,t)||(I=Math.max(0,e),T=Math.max(0,t),h(),y(),fe.setIsVisible(T>=579),re.setHeight(Math.max(163,Math.min(400,T-505))),ne.setIsSmall(T<540))},this.out=function(e){Z.out(e)},this.getPNG=function(){return jr(A.getCompleteCanvas(1).toDataURL("image/png"))},this.getPSD=(Ee=s.default(t(l).mark((function e(){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ri(A);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return Ee.apply(this,arguments)}),this.getProject=function(){return A.getProject()},this.swapUiLeftRight=function(){C="left"===C?"right":"left",n.embed||me.setItem("uiState",C),d()},this.saveAsPsd=function(){be.save("psd")},this.isDrawing=function(){return X.getIsDrawing()||W.getIsDrawing()},this.resize(I,T),d();var Ie=this;ve.addEventListener(window,"resize",(function(){var e=x();Ie.resize(e.width,e.height)})),ve.addEventListener(window,"orientationchange",(function(){var e=x();Ie.resize(e.width,e.height)}));var Te=ve.el({parent:r||document.body,css:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",pointerEvents:"none",zIndex:"-1",userSelect:"none"}});try{var Re=this;new ResizeObserver((function(){var e=x();Re.resize(e.width,e.height)})).observe(Te)}catch(e){Te.parentNode.removeChild(Te)}ve.addEventListener(this.getEl(),"wheel",(function(e){e.preventDefault()}));var Le=function(e){e.preventDefault()};window.addEventListener("gesturestart",Le),window.addEventListener("gesturechange",Le),window.addEventListener("gestureend",Le)}function ji(e){var t=document.body;try{t=document.getElementById("loading-screen").parentNode}catch(e){}var n=document.createElement("div");n.style.textAlign="center",n.style.background="#fff",n.style.padding="20px",n.innerHTML="<h1>App failed to initialize</h1>",n.innerHTML+="Error: "+(e.message?e.message:""+e),t.append(n),console.error(e)}Di=a("d6Kdu").getBundleURL("jdbgX")+a("a3WMe").resolve("j3U20"),Un.isLoaded||(Bi,Ti(Yn.glBrightnessContrast,pi),Ti(Yn.cropExtend,gi),Ti(Yn.glCurves,fi),Ti(Yn.flip,vi),Ti(Yn.glHueSaturation,yi),Ti(Yn.invert,xi),Ti(Yn.glPerspective,bi),Ti(Yn.resize,wi),Ti(Yn.rotate,Ci),Ti(Yn.glTiltShift,Si),Ti(Yn.transform,ki),Ti(Yn.glBlur,Ei),Ti(Yn.glUnsharpMask,Mi),Ti(Yn.toAlpha,Ii),Un.isLoaded=!0),s.default(t(l).mark((function e(){var n,r,i,a,o;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return o.apply(this,arguments)},o=function(){return(o=s.default(t(l).mark((function e(){var i,o,s,c;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ve.removeEventListener(window,"DOMContentLoaded",a),i=new oi.ProjectStore,o=null,e.prev=4,e.next=7,i.read();case 7:(s=e.sent)&&(o=s.project),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(4),c=0===e.t0.message.indexOf("db-error")?"Failed to access Browser Storage":(e.t0.message.indexOf("format-error"),"Failed to restore from Browser Storage"),setTimeout((function(){throw r&&r.out(c),new Error("Initial browser storage error, "+e.t0)}),100);case 16:n(o,i),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(0),ji(e.t1);case 22:case"end":return e.stop()}}),e,null,[[0,19],[4,11]])})))).apply(this,arguments)},n=function(e,t){if(r)throw"onKlProjectObjLoaded called more than once";var n=document.body,i=document.getElementById("loading-screen");try{(n=i.parentNode).removeChild(i)}catch(e){}n.style.position="relative";var a=new oi.SaveReminder(we,!1,!0,(function(){return r?r.saveAsPsd():null}),(function(){return!!r&&r.isDrawing()}),t,(function(){return e}),(function(){return r?r.getEl():n}),(function(){return r?r.getBBox():{}}));r=new zi(e,{saveReminder:a,projectStore:t,onLogo:function(){},hideFile:!1,isShare:!0,helpPath:"."},n),a.init(),e&&setTimeout((function(){r.out(ze("file-storage-restored"))}),100),n.appendChild(r.getEl())},i=!1,e.prev=5,ve.addEventListener(window,"DOMContentLoaded",(function(){i=!0})),e.next=9,Be.setLanguage(Ae);case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),ji(e.t0),e.abrupt("return");case 15:i?a():ve.addEventListener(window,"DOMContentLoaded",a);case 18:case"end":return e.stop()}}),e,null,[[5,11]])})))()}();